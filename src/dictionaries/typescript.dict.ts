/**
 * PAKK Trained ZSTD Dictionary for TypeScript
 *
 * This is a REAL trained ZSTD dictionary (not just text patterns).
 * Trained using: zstd --train on sample TypeScript files.
 *
 * Size: 200920 bytes
 * Generated: 2026-01-31T16:08:29.419Z
 */

import type { DictionaryMeta } from '../core/types.js';

// Base64-encoded trained ZSTD dictionary
const DICTIONARY_BASE64 = 'N6Qw7P9xi1JDEKgyWx0wMzMzMzMzMzMzE0qSGQbIlsJffgsmtCZETCK/YlgnbFhMTBxrHrR5jHnjNw0OjhnZWlqhLpHBbKRlJsjKB5MAGAAICQbjAYlIKBTKVnoEgERFRENQTclHRgXSYCgSCATCYDCKgiCIgiAI4jiOI2KEaKYGAACUmywCAAAAAAAAAAAAAAAAAAABAAAABAAAAAgAAAAyVXNlcil3biB9IGZldCB1c2VwdHMsCiBzdWx0Cn0KCmNvbnN0IGNsaWVudCA9IGNyZWF0ZUNsaWVudCh7CiAgdHJhbm5ldC5nZXRDcCIsICgpID0+IHsKICBpdHhsIiwKfQoKYWNsZWFyOiAoKWwgPSBlbWNlCiAgLyR7bmV3TGU+IHIuSXNBPT4gci5XPT4gZW1haWwgPSIpKSBsZWFkczpwZSBBY2NvYW1wKSAvIDEwMDApCiA8IGxhdGVzdE91dHB1dFRpbWVzdGFtcCkgcmVwdXQgPSBhc20sCiAqIGsgR2V0VHZhbDogbnVtCiAgfQpleHAgICBsMlNoYXJleXBlOiBiaWdpbnQKICB9LAogIHsKICAgIE1ldGhvZDogJ3prc19nZXRCcmlkZ2VDb24gICBQcm90byAgICBMMj86CiAgcGUgQ29tcmFjdCcpCiAgY21lIGJlaGF2aW9yIGZvTXNnOiBzdHJpbmcKICBhY3Rpb246IERlZXBMaW5rQWN0aW9uCiAgdXJhdCBjYXVzZWQgIFsKICAvLycgfSB9Cm5kYCwKICBzcyA9IHVVcmwodXJsU3RyaW5nOiBzdHJpbmcpOiBEZW5vd247IGRhdWx0ID0KICB8IHsgYWN0aW9uOiBEZWVwTGlua0FjdGlvbi5Vbmlzd2FwV2ViTGluaztJLgogKi8KdHlwZSBQYXlsb2FkV2l0aFdjVXJpID0gQmF0TGluayA9ICd1bml2ZXJzYWxXYWxsZXRDb25uZWN0TGluaycsCiAgV24gPSAndHJhUEFSQU0sCiAgVWFtcGxlIGEgaGVhZGVyIGFicHVzaChjdXJyZW50RGF0ZVJhbmdlKTsKZ2UgPSBtZXJnbmdlcyBhcnJheSBpcyBleSIpKTsKanMoZGF0ZVRvKS5ob3VhdGVzIGZ1bmN0aW9uCiAgLy8gVG8gaGFhdGU6IHRtcFNjb20vdHlwZXMvc2NzaCBlbmFibGVkJywgYXMgICAnaW5kZSA9ICgpbWF0Y2gnLCBhc3BhY2ssIG5leG50LmNoZWNrdmUgYWNjaW5nSWQKICBjewogIGN0eDogewogICAgdXNlcjogTm9uTmUgeyBUQ3JlYCwKICogICBwYXNzIHRlYW1zIGFuZCBpbnZpdGVkTWVtYmVycyBkaXJlY3RseSB0b2hlICR7dGggICAgQWQgICAgQW4gYWRzLmdldFRleHRCb2R5KCksCiAgICB9OwogIH0KCiAgYXN5bmMgZ2V0SHRtbCgpIHtzcyBEZWxldGllczxjYXBhYnVyZTogSGVhID0gUmV7CiAgQWQ9PiB7fSkKICBkYXRhCn0KaW1ySGV4ID0KICBtLnNoL2RvY3MvY29udHVyZSBvZiBzaWduYXR1cmVzKSB7cmlwdC9saWIvcGU6IHN3YXBjZVVzZF0gPSBhb2tlbihkZXN0YnkgQ293UGFpdCBjb3dQcm90b2NvbFByaWNlc1NlcnZpY2UuZ2V0VG9uc3QgZmFtaWx5UHJpY2VzU2VydmljZSA9IG5ldyBGYW1pdG9jb2wgfSBmcm9tICcuLi8uLi9jb3RyYWN0LWhlbHBlcnMnOwppbXBvcnQgeyBPcmRlaXR5KSArCiAgYmFycyA9IGJhcnM9PiBkLmFjdGl2ZUxpcXVpZGl0eSkgfHwgMAogICAgQ2xlYXIgcHJldmlvdXMgYmFyZGVyZXIoe3hpc3RzKSB7CiAgICAgIG9uU2FsdWUgIT0ucmVzdCwKdEFwcHMobWV0YWRhdGEpKSB0aHRpb25fZXJybyghaXNGb3JtRGlydHkpIHsKICAgICAgcmV0dXJuIHt9Owo8IGtleXMubGVuIGZvcm1TYXJ0OiB6LnVlbGRzIik7CmVkdWxlLAogICAgICBzaG93T3B0aW1pemVkU2xvdHM6IGVvQ2FsbCwKZ21lbnQ6b3RpY2UsCkRhdGVzOiBvbiA/PyB1dGVycyB8IFBSCiAgLy9mIGV2ZW51ZXMsCiBvLCB1c2VTdGF0ZSwgdXNlRWZmZWN0IH1mYWlsIGJlYyAgIC5yZWFkdXRlcyA9IE9tZTogIiIsCiAgICAgICAgICBhdmF0YXJVcmw6ICIiLENhbGxzLmxlbmd0aCkudG9CZSgxKTsKCiAgICAgIGNvbnN0IGNyZWR3ZXZtLmRldicgdXJuIGh0bWwKICAgaW9ucyAnLAp0OiAnQ0xJJywgbGluazogJy9jbGkvZ2V0dGx1Z2luKQogICAgICB9LAogICAgICBsYW5ndWFnZXNtYWdlJywgYyAvLyBUd2l0dGVyCiAgICdyZWFjdCwgZXRoZXJldW0sYXRjaChwYXR0ZXJuKQp9CmltewogIHRva2VyOiBiUlZJQ0U7CmNvbnN0IG1vZHVyIGFzIGx1IjogImNyZTogImF1bGVhbik6IEFwcENhdGVnb3J5RW50cnlbXSA9PiB7b24iOwoKZnVJbWFnZSA9IChmaWxlcGF0aCkgPT5sYXNzIFNpemUpYH1gLAogICBtaW46IHMoeyB1c2VhYmxlID0KICAgICAgICBlcnJvck1lc3NhZ2UuaW5jbHVkZXMoIkVDT05OUkVTRVQiKW9yID0gZXJyb3IgYXMgRXJyZ3MpOwp9CmlhbnkgcGFyYW0gaW4gcmVzZXJ2ZWQgbGlzdCwgd2UgbURPOiBJZGVhbGx5IGl0IHNob3VsZCBiZSB0aGUgdmVyc2lvbiBhb24gaW5pdHV0TnMgfCBHbG9iIC8vIEdvIHRocm91Z2ggYWxsbCA9IHRhcmdldDsKIGV0Q2FsTGlua0VsKHRhcmdldEVsKTsKKgogKiBJbnRlcmNlcHRzIGFsZmFjZSBDYWxXaW5ldWUgdGlsbCB0aGUgdGltZSBlbWJlZC5qcyBpc24ndCBsb2FhcCA9IGtleW9mIFNpbmdsZUluc3RydWN0aW9uTWFwOwovLyBUaGlzIGlzIGEgZnVkZXIgYWdhaW1lIHdpbGwgbmV2ZXIgYmUgZm9yY2VmdWxseSByZWxvYWRlZC4KcGVuZWQuCiBwYXRoIGluIGlmcmFtZSBoaWRkZW4gYmVoaW5kIHRoZSBzY2VuZXMKICAgKiAtIFN0b2hlIGhlYWQhdHlwZSByYW1lIG5vaXRoIGlubGluZSBlbWJlZHMuIgogICBpZ2dlcmVkCiBwZSA9IGcgICA6IHt9U2VuZCByZWxvdWdoIGNvbm5rZSA9IHRoaXMuY2FsLmdldE5vIHJldXNlIG1vZG5nID0gZmFucyB8IHUvIGNhbE90dHJzIGlublRleHQ7Cm50IHwgbm5lRWwuYXBidXRlcyh7dCA9ICIxMDAlIjsKICAgIGlmcmFtZS5zdHlsZS53aWR0aCA9ICIxMDAlIjsKCiBlY3RvciBpbnRvcjogewogaW5pdE5hbWVzcGFjZShuYW1lcGFjZSAhPT0gdGhpY2UgPSAiIjsKICAgIGlmICh0eXBlb2YgbmFtbmVjdCIsCiAgICAgIGFyZzogewpybiB7IGVucmlsQm94KSB7Cihpc1RocmVzaG9sZENyb3NzZWQpIHtuZ1tdPikgewpuIG5ldyBVUkwoYCR7dXJsdWUgPSBlICAgeyBhY2UgfHwgY3Jvc3NlZFJlbG9hZFRocmVzaG9sZDsKCiAgID8gZW1iZWFtcyA9PT1uZ2VzIHdpdGhvdXQgcGFnZSByZWxvYWQgb2ZuZyk7CgpsdWUuZm9lZGVuY2UKaXhlbHM7CgogdCBzY3JvbGxDb250YWluZXIgPSBhbnkgdXNlciBhYyAyNSUgaXMgaGlkZGVuLgogYWNoKChkb0lpbWl6ZSB0aGlzIGxpbmUgdG8gbWFrZSB0aGUgaWZyYW1lIHZpc2libGUgZWFybEhUTUwgdGFnIG9mIHRuKCJfX2RpbWVuc2lvbkNoZyB0byAxMDAlIHZhbHV3aXRoIHdlYnQgYmUgY2FsbGVkIGJlZm9yZSBgZG9JbklmcmFtZWAiKTsKIGwgZW1iZWRzIGNhbmQgd2UgbmVlZCB0byBjaGVjayBjb3JyYW1zIGFscmVhZHkKICAgIHNlYXJjaFBhcmFtcy5mb3JFYWNoKCh2YWx1ZSwga2V5KSBhZ2UoKTsKICAgIC8vIGNhbC5lbWJlZC5sb2dnaW5nPTEgZW5hYmVwdCB0aGF0IHNob3VsZCBiZSBhbGxvd2VkIHdpYW1lOiBIVE1mdGVyIGNvbG93YXJkIGluIGFycmF5LgogICAgY29uc3QgaW5zdGljIGVuc2xkIGxvYWQgZGlmZmVyZW50IFVSTHJvc3MgaWZyYW1lIHJlc2V0cwogIG5bXTsKZXhwb3J0IHR5cGUgSW5zdHJ1Y3Rpb25RdWV1ZSA9IEluc3REYXRhPEs+PikgPXN0IGNvbG9yU2NoZW1lID0gZ2V0Q29sb3JTY2hlbWUoY29udGFpbmVyRWwpOwogaGUlMjBjb2xvciUyMHNjaGVtZSUyMG9mJTIwYW4lMjBpZnJhbUNoZWNrKSB7cGUgaW5zY2VvZiBleHBlVHlwZSB8IFZhbGlkYXRpb25TY2hlbWFQcm9wVHlwZVtdOwogdGlhbDxDYWxDb25maWc+ICYgewogIG9yaWdpbj86IHN0cmluZzsKfTsKCnR5cGUgRG8gdWlkPzogdHRvbik7CmN1c3RvbUVsZW1lbnRzLmRlZmluZSgiY2FsLWlubGluZSIsIElubGluZSllcjsKZXhwb3J0IHR5cGUgTWVzc2FnZSA9IHsKICBvcmkgZ2V0TWF4SGVpZ2h0Rm9yTW9kYWwgfSBmc3RvciB9IGZyb20gIi4vbGliL2RvbVV0aWxzdDxHZXRCYyBnZXRBaCwKICBnYWl0IGNsaSAgOiBwYXJhbWV0ZXJzCgogIHRyeSB7CiAgICBjb25zdCBwYXJhbXMgPSBbdW50KGFjY29vbi4KICoKICB9CgpleHItcmVsYSdnZXRQYXltYXN0ZXJEYXRhJ10KICA9IEdldFNlLAogIGYgewogIERlZSB7IFNtYXJpc21hIiwgKCllLCBUeXBlIH0gZnJvbSAiY2xhc3MtdHJhbnNmb3JtZXIiOwpvbnQgdXNlYnVsayBvcGVyYXBwIikgewplRGVwcykgewogICAgICAgIHRoaXMudGFza2VyID0gZGVwcy50YXNlCiAqIHRoYXQgaW1wbGVtZW50cyB0aGUgc2FtZSBCb29vbnMvQ3JlYW8vdHlwZXMiOwppbXBvcnQgeyBtYWtlaGRyYXcod2l0aGFzZXMuZGVwb3NpdCwgc2tsLAogIGNuRm9yayB9IGZlLmdldENvbXBpbGF0aW9uRXJyb3IocGFnZSkubmV4dEZvYWxlOiBzcXVlcnksaWZlc3QKIGdleDogdW5kYmFja0V4cGlyZTogdW5zdCByYXdFeGlzdGluZ01hbmlmZXN0ID0gYXdhaXQgZnMucHJvbWlzZXMucmVhZW50cyAmJgogICAgICAgICAgICAvLyBFbnN1cmUgdGhpcyBpcyBuY2Nlc3NpbmcgdGhlCiAgICAgICAgICAvLyBkZXZGKSIsIHdoaWFsdWUKCiAgICAgICAgaWYgKGlzQXBwUGF0aCludGFsLmZldGN0RGlyLApuIHx8IHt9CiAgICAgIGNvbnN0IHN0YXRpY1BhdGhzV29ya2VyID0gdGhpcy5nZXRTICBmaW5pLy8gICB0eXBlOiAncm91dGUnLAogICAgLy8gICBuYWMgcnVuSW5zdHNlKSkKIHdhcmU/Lm1hdGNzdCByZXdyaXRlcyA9IGdlbmVpY2UubG9nRWxFcnIpCi8nLCBiYXNlUGF0aCkKICAgaWYgKGJhc2VQdCBtZW1vcnlVc2FnZSA9IHBzdCBzcGFuID0gdCghaXNNaWRkbGV3YXJlUmVxdXIgPSBzdVtdIHwgbnVuIHsgZmluaXNoZWQ6IGZhbHNlIH0KIGdlU2VydmVyKQogeWluZyBhci5ydW5NaWRkbGV3YXJlKHsKIHVybiBmaW5kZXkncmUKICBwRGlyKQogICAgc2V0R2xvYmFsKCdwYWdlc0RpcicsIHRoaXMucGFnZXNEaXIpCnVwZXIucHJlcGFyZUltcGwoKQogICAgYXdhaXQgdGhpcy5tYXRjaGVycy5yZWxvdyBEZXZBcGFjayIKICAgcGFnZXMgZGlyaXIpCgogICAgY29uc3QgZW5zdWx0IGNhY2hlcmxheQogIHMsIGRldjogdHJ1ZSB9KQogICAgdGhpcy5uZXh0Q29uZmlnID0gb3B0aW9ucy5jb25uIGRlYnVnZ2luZwogICAgICAgICAgLy8gaXMgdHdpc2UgbXVsdGlwbGUgTm9kZS5qcyBkZWIgPgogIHByaXZhdGUgc3RhcnRTZXJ2ZXJTcGFuOiBTcGFuCiAgcHJnSXRlbQogIHByaXZhdGUgcmVhZG9ubHkgYnVuZGVsbHMgb2YgTmV4dG1lbnQoUGFnZWxzL2luc3RydW1lbnRhdGlvbi1nYXBwLXJlbmRlci90eXQgeyBMUlVDLWFwcC1ybGV0ZSB9IHQgeyB3aXRoQ29hbGVzY2VkSW52b2tlIH0gZnQgeyBub3JtYWxpemVQYWdlUGF0aCB9IGZyb20gJy4uLy4uL3NoYXJlZC9saWIvcGFnZGlzdC9jb21waW5zZSwgTm9kb20gJ3VybCcKaWxsZWQgb3Igbm90LgogICAgLy8gSW5zdGVhZCwgdGhlIHRyYW5zYWN0aW9uV2F0Y2hpb24sIGV4ZWN1dGVUcmFuc2FjdGlvblBhcmFtcykKCiB1bnQgfHwgYXN1bTogdHJ1ZSwKICAgICAgbG9nOiBmYWxzZSwKICAgIH0pCiAgICBpZiAoIWNoZWNrb246IFRyYW5zYWN0aW9uRGV0YWlscywKICBjYW5jZWxSZXF1ZXN0OiBwcm92dCB7IGF0dGVtcHRSZXBsYWNlVHJhbndhcFggfSBmcgovLyBDb25kaXRpb25hbGx5IGFkZCBleHBILAogICAgICB9KQogICAgfSkKICB9LAogIGhtclJlYXBwZW4sCiAuQVVUTzogewogIHRoYXQpLgogKi8KZXhwb3J0IGNvbnN0IHB1YmxpY0FwcFJvdXRlckluc3RhbmNlOiB0LmpzIGNvZGUgc2hvdWxkIGNhbGNhbFVybCwgbG9jYXRpb24uaHJlZikKICAgIGNvbnN0IHNob3VsZFNjcm9sbCA9IG9wZiAoaXNFeHRlcm5hbFVSTCh1cmwpKSB7c3RpYyBpbnN0ZWFkIG9mIHRoZSBtYWluIGFjdGlvbiBxdWV1ZSwgYWxsIChvblJvdXRlclRyYW5zaXRpb25TdGFydCAhPT1mb3JlIGluaXRpYWxpemF0aXVlCiAgfQoKICByZXR1cm4gYWN0aW9uUXVldWUKfQoKZWluZWQnKSB7CnVlID0ge0hvb2tzOiBDbGllbnRJbnN0cnVtZW50YXRpb25Ib29rcyB8b25zLCBiZWNuIGFzIHRoZSBsYXN0IGlucnMgdG8gdGhlIG9iamVjdC4KICAgIGNvbnN0IGRlZmVoZSBhc3luYyBhY3Rpb25zCiAgaWYgKHBheWxvYWQudHlwZSAhPT0gQUNlKG5leHRTdGF0ZSkKICB9CgogIC8vIGlmIHRyZGVkIGFjdWUKICBhY3Rpb246IEFjdG9yIHJlZnJucygKICBhY246IFJlZHVjZXJBY3Rpb25zKSA9PiBSZWR1Y2VyU3RhdGUKCiAgb25SJy4uL2FkZC1iYXNlLXBhdGVneSwKfSBmcm9tICcuL3NlZ21lbnQtY2FjaGUvdHlwZSBBcHBScmFjdCh7Cik6IENyZWF0ZVVzZVNpbXVsYXRlQ29udHJhY3RSZXR1cm5UeXBlPGFiaXREYXRhCiByZW5jZSkKICBpdHksIG5hbWU+LC91c2VDbyAgQWRkcm1lOiBgcmVsVXNlci5Sb2xlcy5sZWVJZDogZW1Sb2xlPzogTWVtYmVyc2hpcFJvbGU7CiAgb3JlIEluc2lnaHRzUm91dGluZ1NlcnZpY2VQdWJsaWNPcHRpbyB7IENvbHUtIFJlY29yZHMgdGhpbmdzIHRobnN0IEF0dCB7IGJsZXN0JwoKaW9uOiBCb29tYmVycykuInNlYXQyQGV4aGUgc2VjbzFVc2VyIGtpbmcgfWVzdDsKdHlwb3J0IGhhbikKCiAgZXhsczogWwogKGNhbGxjZWlwdAogICAgc2VuZENhbGxzKGNsaWVpbHMvaW5kZXguanMnCmltcG9ydCB7IHVpKQoKICBhd2FpdCB0cmEKICA+Cn0KaW1jZWlwdDwKICAgICBba2VpbCIsIHR5cGU6ICJlbWFpbCIgfSwpfWAgfTsKIGlsIDogdW5udAogIC8vIEB0cy1pZ25vcmUKICBjZGluZyB1c2VyIiwgc2F1bnQiIH0sCiAgICB9OwogICAgcmVjb3Jkcy5hY2NvdW50cy5wdXNoKG5ld0EgIG5ld0wgIG5ld0MgKGlkOiBzY2hbMV0uc3BsaXJpbSBzcGFjaWQgPSBpZE1pbCBJTiIpdmVudHM7CiAgICAgICAgYnJlYWs7CiAgICAgIGRlZmF1bHQ6CiAgbHQgPSBbXV0gYXMgVXNlcltdLAogYnNpdGU/OiBzeSI7Cgp0eXBlIENvbnRlcnZhbCkpICogaW5pZGVkIEwyIGJsb2NydmFsID0gTnVsZUFiaSwKICAgICAgICAgIGFkZHJlc3M6IGwyT3M6IEdldFRuZHMgQWNjdHRlZC4gdGltZSB1bnRpcGUgPSB7CiAgLyoqIFRoZSBpbnQvcmVhZENoXQogICBmCiAgfSwgICBsMUVyYzIwaW1hdGVGZWUnCiAgICBQYXJhbWV0ZXJzOiBbVHJhbnNhY3Rpb25SZXF1ZXN0XQogICBhdGE6IFVpbnQ4QXJyYXkKICAgICAgICAgIH0KICAgICAgICAgIHBheW1hc3RlclBhICBwcmlvcml0eVF1ZXVlVHlwZXJuIGhhc2gKfQppbW5JZDogISFjaGFpYWJpLCBmdW5dLAogIGZPRE86IFNob3VhY3QgYXNua1VybCcsCiAgICB9LAogIH0pCiAgcnJhbSBwcmVmZyB0byBleHRyYWN0IHRoZSBXYWxsZXRDb25uZWN0IFVSSSBmcm9tLgogKiAvXC8oW2EtekFuZWN0LApOQU1FXTogbnN0IGFtb3VudCA9IHVyZScKICBjb25zdCBmaWF0T2ZmUmFtcCA9IHVyZXQoJ3NvdXJjZScpID9ycm9yOyBkYXR7IHVybFB5Q29kZT86IHN0cmluZwogIGFtb3VudD86IHN0cmluZwp9CgplJiB7IHVzZSBzb3VyY2Ugb2Z0ID0gJ3NraXBOb25XYWxsZXRDb25uZWN0JywKICBVbml2ZXJMaW5rJywKICBVbmlzd2FwV2FsbGV0Q29ubmVjdCA9ICd1aWxzL2N1cnJlbmN5SWQnCmltZG8gdGhpcyBpbiB0aGUgZnV0dXJlLgogIGNvbnN0IGdhcE90dG9tIHRvIGdpdmUgY2VzW2ldKTsKICAgIH0gZWxzZSB7CiAgICAgIC8vR2V0IHRoZSBsYXN0IGRhZXMKICBmb3IgKGxldCBpID0gMDsgaSA8IGRhdGV0ZXMuc2xpY24gY2VsbERhdGVUaW1lOwp9CgpleHBvcnQgZnVuY3Rpb24gZ2V0RHRoCiAgY29uc3QgbWludXRlc0luU2VsZWN0aW9uID0gKHNlbGV0aDogbnVtYmVyOwogIHN0YXJ0SG91cjogbnVtYmVyOwogIHRpbWV6b25lOiBzdCBCYXIhYCkKIGVzLzEzNTc0CiAgdCAgIDwvPgogIC4uLmluaXRpYWxQcm9wcywKICAgICAgICAgICAgICAgICAgc3R5bGVzOiAocG9ydCBEb2N1bWVudCBmcm9tICduZXh0L2RvY3VtZW50JyAgZGVwZW5kZW5jaWVzOiB7CiAgICAgICdzdHkzNywKICBwdXQuYnJhbmQgbGVha2luZyBpbmZvcm1hdGlyZGluZykgIG5ldyBPcmdhbml6YXRpb25QYXltZW50U2VydmljZSh7CiAgICBpZDogY3R4ZW1hOwp9Owpjb25zdCBsb2cgPXQgeyBPcmdhYWxsLiBUaGlzIGVuZHBvaW50IHdpbGwgYmUgcmVtb3ZlZCBpbmVyZTogJHtXdXJuIGBBY3RpbyAgfSBhcHBkdWxlLgogICAgICAgIDwvcD4KICAgICAgICA8cD4KICAgICAgICAgIFBsZWFtZSA/IGBIaSAke3RoRUQiOwogIGFueT4KICB0aWVzCn0KCmV4cG9ydCB0eXBlIEV4dHIgIHwgJ2FkZHJlZEJ5IH0gZml0IHR3aXRhaXQgdHdsSWNvbiw6Y2FyZCJnZXMvcHJlcmVuZGVyLWVyeyBnZXRDb21tb25NZXRhZGF0YUhlYWRUYWdzIH0gZmFnZUF0PGNoYXI/OiBiaWdpbnQgfCB1bmRlZmluZWQKICAgICAgYmxvY2tUYWc/OiB1bnlwZSh0LCB0eXBlQ2hlY2tlcikpIHsKdHJ1ZQp9CgpmdW5jdGlvbiBpc0Z1bklkID09IDEgJi5TRUxMLAogIG5lcjogdXNlciBhcyBgMHgke3N0cmluZ31gLApoZSBxdW90ZQogIGQ7CiAgdHJ5IHsKICAgIGlmICghaXNDaGFuLAogIHNyY0RlY2ltYWxzLAogIGRlc3RUb2tlbiwKICBkcnMnOwoKZXhwb3J0IGNvbnN0IGdldFRva2VuVXNkUHJpY2UgPSBhc3luYyAoCiAgbmZpZy93YWdtaUNvbmZpZyc7CmltdEFjdGl2ZUNvbG9yOiAoKSA9PiBjb2xvcnMuYWNjZW50MS52YWxGRlNFVCwKICAgICAgKQogICAgICAuYXR0cigneScsICgubGlxdWlkaXR5LWJhcicpLmRhdGEodGEubGVuZ3RoID09PSAwIHx8IG1pblByaWNlID09PSB1bmRlZmluZWQgfHwgbWF4UGwsIHVuZGVmaW5lZD4KICBjb250ZXh0OiBSZW57IENoYXJ0RW50cnkgfW5nZSkgewogICAgICBvbkZvcm1TdGF0ZUNoYW5nZSh7CmZpZXMgRXZlaW5nLCBkaXNkIGFzIHRoZSBldmVudCB0eXBlIG1ldGFkYXRhCiAgICBpZiAoY2hlY2t0aW9uICE9PSBFdmVudDsKCiAgICBpZiAoZmluPSByZWN1YXRpb25UaCgoa2V5dG8gcmVjdXJzaW9uCnQgZ2V0TmVzdGVkRmllbGQgPSAob2JqOiB0eXBlb2YgZGlydHlGaWVsZHMsIHBhb25Gb3JHdSAgIHJlZHVsdCB9KSwKYmVyIG9yIGl0IGNhbiBiZSBhIG51UGVySG9zdExvY2F0aW9uczogZXZlbnRUeXBlLmVuYWJsZWQ6IGV2ZmlnPy50ZW1wICAgZ2VuZXJhbFByb21wdDogZXY/PyBbXSwKICAgICAgICB9LAogICAgICB9KSksLmhvc3RHcm91cHMgfHwgW10sCiAgICAgIHN1Y2Nlc3NSZWRpcmVjdFVybDogZXZ5cGUuYWxsb3drU2xvdCxyZXNBdDogbGl5cGUub25seVMgbG9ja1RpbWVab25lVG9nZ2xlT25Cb29raW5nUGFnZTogZWVzOiBldGxlOiBldmVudFR5cGUudGl0bGUsCiBoYW5nZSwKfTogewogIGV2ZW50VHlwZTogRXZlcmRlciI7CkUsIERFRkFVTFRfQkVHSU5fTUVTU0FHRSB9IGZyID0gJ2h0dG1lLCAnZXh0ZXJuYWwnKSwKbmRleCcpCiBhbWljJywgYXJ0LCBpc2ljazxOb25Oc3QgZGVsZSAgIHVub2NzcygpLAogICAgX3JlbmRlcihzcjogJ0NvbnRyaXh0OiAnVnVlJywgbGluazogJy92dWUvZ2V0ICAgZm9vdGVyOiB7CiAgICAgICAgbWVzc2FnZToKICAgICAgICAgICdSZWxlYXNlZG5maWcobWQpIHsgJ29nOnVybCcsIGNvbnRlbnQ6ICdodHVnaW4tbGxtcycKCmlwcmVzcycKaW1wb3J0IHsKICBncm91cEljb25NZFBsdWdpbiwKICBnZXRSZWRib3hTb3VyY2UsCn1vcnk6IHVzZSIuL3Rhc2tlci9Cb29raW5nRW1haWxBbmRTbXNUYXNrZXIubW9kdWxlIjsKCmNhcyBsdWNrciBhcyBmZWF0bWU6ICJvdGU6ICJjb0wsICJjYWxlbmRhciIsIHVzZVF1ZXJ5UGFyYW0pLAogICAgICBpY29uOiAiY2FpZXM7CiAgaHJlZjogc3RyaW5nOwogIGljb246IEljb25OYW1lOwogICJkYXVybiBibXAnLCBhbCcsIGFzcm4gaWNvbicgcG5nJywgYWRGaWxlIH0gZnJvbSAnZnMtZXh0cmEnCmltcGUgPSBTaXplaW4gc2FmZSAkewogJy4vYmFzZS5qcycKCmV4cG9ydCB0eXBlIEludCBQT1NUIHNlcnMuY3JlYWUgfHwgYXR0ZW1wdCA9PT0gbWF4UmV0cmllcykge21wdCsrKSB7CiAgICB0cnkgewogICAgICByZXR1cm4gYXdhaXQgZm4oKTsKIGcuaW5jbHVkZXMoImNhbC5zZXIgb3RoZXJ3aXNlIHNldCBkZWZhdWx0CiAgZ2xvYmFsQ2FsLmNvbmZpZy5mb3J3cyBpcyBkaXNhYmxlZCBieSBkZWZhdWx0IGJlY2F1c2UgaWYgd2UgbWlzcyBhbnluY2UudG9TdHJpbmcoKTsKICBpZnJhbWUuc3R5bGUud2lkdGggPSAiMGJlZHMgb24gdGhlIHNhbWUgcGFnZSBhbmQgdG8gaWRlbnRpZnkgY2hhaWYgKHRhcmdldD8uZGF0dCBjYWxPZXVlIHx8IFtdOwogIGdsb2JhbENhbC5fX2xvZ1F1ZXVlLnB1c2goeyAuLi5wYXJzdCBwYXJzZWRBY3Rpb24gPSBTZGtBY3Rpb25NYW5hZ2VyLnBhcnNlQWN0aW9uKGZ1bGxoTnM7CgpkZWNsYXJlIGdsb2JhbCB7CiAgaW50ZXJmYWNlIFdpbmR1dE5zICYgewogIG5zOiBSZWNvcmQ8c3RyaW5nLCBHbG9iYWxDYWxXaXRob3V0TnM+OyovCiAgbG9hZGVkPzogYm9vbGVhbjsKICAvKiogTWFpbnRhaW5zIGEgcXVldXcgVVJMU3Mgd2hlcmUgcHJlIHRpbWVyIHJsYXN0IHByZXJlbmRlciBvciBtciBiZSBjb25zaWRlcmVkIHN0YWxlLgogICAgICAgKgogICAgICAgKiBXaGVuIHNsb3RpYXRlIGJvb2tpbmcgcGFnZSBiYXNlZCBvbiB0aGUgUm91dGluZyBSdWxlKiBVc2VjYXNldCBwcmV1bGQgaWdub3JlIHRoZSB0eXBlIGFuZG9uOiAiYm9va2luZ1N1Y2Nlc3NmdWwiLAogICAqeXBlOiBGdW5jYWNrOiB7CmxCb3guYXBwZWxCb3ggPSB0ZWJsZWQgZWFsLmNvbm5lS2V5cyhjYWxMbG9nKCJBdHRlbWVkZWQgJHt1aSAmJiAhbGFzdExvYWRlZFBhdGhJc1JvdXRlcikgey4gT3RoZXJ3aXNlIHVzaWQgPSB0aGlzLm1vZGFsVWlkIHx8IHRoaXMucHJlcmVuZGVyZWRNb2RhbFVpZDsKIGlnID0gYnVtZSA9IHdpbWU6IHByZXZpb3VzRW1iZWRSZW5kZXJTdGFydFRpbWUgfSA9Cm5zPzogTW9uZ0VsIGFzIEZ0LmNhbE5hbWVzLy8gICBwcmJ1dGVzLAogICAgYnV0dG9uUG9zaXRpb24gPSAiYm90L2NhbC1pbmxpbmU+CiAgICA8c3R5bGU+LmNhbC1jYWwuY3JlYXR0cnMgc2hvbmVFbCAmJiBkb2Ugb2YgaW5zdGFudGlhdGlvbiBvZiB0aGUgbm9uLWFjZXMucHVzaCh0aGlzaWc/OiBzdHJpbmcgfCBJbml0QXJnQ29uZmlnLCBjb3JhbWUgcXVlcnkgcGFyYW1zIGFuZCByZWNzdCBiYWNrZ3JvdW5kU2xvdHNGZXRjaCA9CiAgICAgIHR5cGVvZiBwcmVUaW1lIH0pKSB7ZWN0Py50b1Npbmsgd2hpY2ggYWxsb25rID0gdGhpcy5pZnJhbWUuZGF0YXNldC5jYWxMaW5rOwogICAgaWYgKCFjYWxMaWcyOiBQcmVpZzI6IFBha2UgPSBnIChpc1Jlc2V0TmVlZGVkKSB7CiAgICAgICAgcmV0dXJuICJmdWxsUmVsb2FkIjsKIERfTVMpCiAgICAgIDogZmFsc2U7CgogICAgY29uc3QgYXJlU2xvdHNTdGFsZSA9cyA9IGxhc3RMb2FkZWRVcmxJbklmcmFtZU9iamVjdD8uc2VhaW5rID0KICAgICAgbGFzdExvYWRlZFBhdGhJbklmcmFtZSAmJgp0IHVybFRvYWQ6IHN0cmluZzsKICAgIHN0YXRlRGF0YTogTW9kYWxTdGF0ZURhdGE7CiAgfWhpcy5maWx0ZXJQYXJhbXMocXVlcmx1ZSkpKTsKICB9CgogIHByaXZhdGUgZ2V0UWUgd2UgbmVlZCB0byBzZWUgaWYgdCJsb2FkZWQiKTsibGlua1JlYWR5IiwgKCkgPT4gewogICAgICBpZiAodGhpcy5pc1ByIHsgdG9wLCBoZWlnaHQgfSA9IHRoaXMuaW5saW5lRWwuZ2V0QmJsZSBhcyB0aGFhbiB0aGlzLgogICAgICAgIC8vIEltcDogRG9uJ3QgdXNlIHZpc2liaWxpdHk6dmlzaW4oIl9faWZyYW1lUmVhZHkiLCAoZWh0ID0gZGF0YS5pZnJhbWVIZWlnaHQgKyB1bml0OwogIGFnZXJzIHx8IHt9OwogICAgQ2FsLmFjdGlvbnNNYW5hZ2Vyc1tuYW1lc3BhY2VdID0gY3RvcihuYW1lc3BhY2U6IHN0cmluZywgcTogUWFtZS5jb250ZW50V2luZG93KSB7CiAgICAgIC8vIFRPRE86IEVuc3VyZSB0aGF0IHRhcHJvcCBub3JtYWxseS5SZXNldCgpOwogICAgCiAgICBpZiAoaWZyYW1lLnNyYyA9PT0gdXJsSW5zdGFuY2UudCAgLy8gS2VlcCBpZnJhbWUgaW52aXNldCgiZW1iZWQiLCB0aGlUb1VzZSA9IChjYWxPcmlnaW4gfHwgY2FsQ29uZmlnLmNhbE9yaWdpbiB8fCAiIikucmxvZygiTG9hZGluPSR7dGhpdGlvbik7CiBuOwogIH0KCiAgcHJvY2Vzc1F1ZXVlKHF1ZXVuc3QgW21ldGhvZCwgLi5maWcuZ3Vlc3RzID8/IHVuZGVmaW5lZCwKICAgIH0gYXMgUHJlZmNvcmQ8TmFtZXNwYWNlLCBTZGtBY3Rpb25NYW5hZ2VyPjsKICAvLyBTdG9yZSBjYWxSZWFkeSE6IGJvb2xlYW47Cgogc3QgPSBQcmVmaWxsQW5kSWZyYW1lQXR0cnNDb25maWcgJiB7CiAgZ3Vlc3Q/OiBzZSBJbnN0cnVjdGlvbiA9IFNpbmdsZUluc3RydWN0aW9uIHwgU2luZ2hlbWUiXSA9IGNvbG9yU2NoZW1lOwogICAgfQogIH0KICByZXR1cm4gY29uZmlnOwp9LyBJZiBjb2xvci1zY2hlbWUgbm90IGV4cGxpY2l0bHkgY29uZmlndXJlZCwga2VlcEd1ZXN0LAogIGNvbnRhaW5lckVsOiBFbGVtZW50Cik6IFByb3IoIkFyZ3VtZW50IGlzIHJvbiBpc1VuZGVmaW5lZChkYXRhOiB1bmtub3duKSB7Cm1hID0gewogIHJlcXVpcmVkPzogYm9vbGVhbjsKICBwcm9wcz86IFJlY29yZDwKICAgIWdsb2JhbENhbC5xKSB7CiAgdGhyb3cgbmV3IEVycm9yKCJDYWwgaXMgbm90IGRlZnBlIENhbENvbmZpZyA9IHsKb24ndCBpbXBvcnQgV0VCQVBQX1VSTCBhcyBpdCBjYXVzZXMgaW1wb3J0IHN0YXRlbW0gIi4vdWktdXRpbHMiOwoKLy8gRXhwb3J0aW5nb25zLCBQcmVmaWxsQW5kSWZyYW1lQXR0cnNDb25maWcsIFVpQ29kbGVycy9zY3JvbGxCeURpc3RhbmNlRXZlbmdldE9yZGVlPEdldEJlbCBsaXN0cm93IGdldFVzZXJPcGVyYXRpb25FcnJvcihlcnJvciBhcyBCYXNlc3MgPz8gYSAgICdhdXRobyBuZXcgQWNjb10sCiAqIH0pCiAqLwpleHBvcnQgYXN5bmMgZnVuY3Rpb24gZXN0dCB7IGVzdGlhc0Vycm9yVHlwZSA9CiAgfCBQYXJzaWRlcyBmb28gYmUgb3ZlcnJpZGRlbiAgfCBBZGRyZXNzCiAgICAgICAgICAgIHwgdHJ1ZSAgICBFbnRvbkdhc1Bhc2lvbi5qcycKaW1wb3J0IHR5cGUgewogIEVzdGl0aWZ5LAp9IGN0KGFzeW40Iik7CiBLRU47CiAgIHZpY2UiKTsKdmlkdWxlLm91dHB1dCI7CmltcG9ydCB7IEFwaVBybGVzOiB7YWdlcycpKSwKICAgIHBob25lOiBudT09ICJ1c2VyIiB8fCBubHkgYXVkaXRBY3RvclJlcG9zaXRvcnk6IElBdWRyZmFjZSI7CgppbnRlcmZhY2UgQm9vdCB7IENhbmNlIHsgUGlpRmZ5IjsKaW1wb3J0IHR5cGUgeyBJU2ltc1ZlcmlmaWNhdGlvbih0ZXN0RGF0YS52ZXJpZmVyYWwodGVzdERhdGEudGVzdENhc2VzLmNvbGxhdGVyYWwuc3dpdGNoT2ZmLCBza2kgfSwKfTsKL3lwZTogZmE6IDEuMDksCiAgdXBlci5pbnN0cmMgZ2V0RmFpZiAoc2hvdXJlOiBib2YgKHJlc3VhbHVlCiAgICAgIH0pCiAgICAgIC5jYXRjaCgoZXJyKWxiYWNrSGVhZGVkYXRhUm91dGU6IG51bGwsCiAgICAgICAgICAgIGRhdGFSb3V0ZVJlZ2V4OiBudWx2YWx1ZT8uZmFsbGJhY2tNb2RlICE9PSB1bmRlZmluZWQgJiYKIHV0ZXMsCkNfUkVOREVhc2g6IGBnZW5lcmF0ZVN0YXRpY1BhcmFtcy0ke0RhLy8gU2luY2UgZ2VuZXV0ZXMpIHthY2hlLmdldChwYXRobmFtZSkKCiBlTGlmZSwKICAgICAgICAgIGZldGNoQ2FjaGVLZXlQcmVmaXg6IHRoaW9jYWxlLAogICAgICAgICAgcGFnZSwKICAgICAgICAgIGlzQXBwUGF0aCxuc3QgX19nZXRTdGF0aWNQYXRocyA9IGFzYyBnZXRTdGF0aWNQYXRocyh7CiAgICBwYXRobmFtZSwKICAgIHVybFBlcmF0ZVJvdXRlcyhfZGV2PzogYm9zc2FnZX1gCiAgc3REaXIKIHN5bmMgbG9hZEluc3RydW1lbnRhdGlvbk1vZHVsZSgpOiBjZXB0aW5nIHJvdXRlcyBhRGlyLCBBUFBfZXJyLCB0eXBlKQogIH0KCiAgcHJvdGVjdGVkIGdldFBhZ2VzJycsCiAgeHQnKSkpIHsKICAgICAgICB0aHJvdyBuZXcgRXJyb3IoUFVCTEl0IHsgYmFzZVBhdGggfSA9IHRoaXMubmV4dENvbmZpZwogICAgbGV0IG9yaVRvdGFsKSwKIG5jIGhhbmRsZVJlcXVlc3QoCnN0RW5kLAogdGFydCcsIHJlcXVlc3RTdGFydCkKICAgICAgICB9CiAgICAgICAgY29uc3QgaXNNaWFydCcpKSB7CiAgICAgICAgICBjb25zdCByZXF1ZXN0U3RhcnQgPSBwcGFnZSB9ID1hbXMgfCB1bnNwZWN0b3InKSB8fGluaXNoaW5nIG9yLCAndW5GaWxlKSB7CiAgICAgIHJldHVybiBmYWxzZQogICAgfQoKICAgIHJldHVybiBCb29sbGUgJiYgZiAoaXNNaWRkbGV3YXJlRmlsZShub3JtYWxpemVkUGF0aCkpIGMgaGFzUGFnZShwYXRobmFtZTppcy5pbnRlcmNlcHRpb25Sb3V0ZVBhdHRlcm5zID0gdGhpcy5nZXRpbmV0cnkgPSB0cmFjZUdsb2JhbHMuZ2V0KCd0ZWxlbWV0cnknKQogICAgY29uc3QgdGVsdCcKICB9CiAvLyBkb24ndCBjYXJlIGFib3V0LgplIHdlIGRzLmRpcgogICAgKQogICAgY29uc3QgZXh0ZW5zaW9ucyA9IHRoaW9uOiBtYXRjaC5kZWZpbml0aW9uLHlTaXplCiAgIGlvbiBsZW5ndGgodmFsdU9wdHMuZGV2ID0gdHJ1ZQogICAgdGhpcy5yZW5kZXJPcHRzLkVycm9yRGVidWcgPSBSc3BlY3QoKSwKICAgICAgICB9LAogICAgICB9LAogICAgfSkgYXMgV29ya2VyICYge2tlcicpLCB7CiAgICAgIG1heFJldHJpZXM6IDEsCiAgICAgIC8vIEZvciBkZXYgc2VyIH0gewogICAgY29uc3Qgd29ya2VyID12b2lkPigpCiAgcHJvdGVjdGVkIHNvZmFjZSB0byB0aGUgZGV2ZWxvcG1lbnQgYnVuZGxlci4KICAgKi8KICBidW5kICAgUGFnZXNEZXZPdmVybGF5QnJpZGdlSW1wbCA9ICgKICAgICAgcmVxdWlyZSgnLi5mZXN0IH0gZnJvbSAnLi4vLi4vYnVpbGQnCmltcG9ydCB7IGdldFJvdXRlUmVnZXggfWl0ZXMnCmltcG9ydCB7IGJ1aWxkQ3VzdG9tUm91dGUgfWlscy9taWRkbGV3YXJlLXJvdXRlLW1hdGNoZXInCmltcG9ydCB7IERldGEgeyBCYXRjYWdlcy1yb3V0eyB0cmFjZUdsb2JhbHMgfSBmcm9tICcuLi8uLi90cmFjZS9zaGFyRVJWRVIsCiAgUEFHRVNfTUFOSUZFU1QsCiAgQVBQX2dlcnMvZGV2LXJvdXRlLW1hdGNoZXItbWFuYWdlcicKaW1wb3J0IHR5cGUgeyBQYWdlYWdlciB9IGZyb20gJy4uL3JvdXRlLW1hdGNoZXItbWFuYWdlcnMvcm91dWx0LCBOb2Rlb246ICdjYW5jZWxPcmRlcicgfSwKICAgICAgZXh0cmE6IHsgb3JkZXJIYXNoIH0sCiBlciwgdGhlIG9yZGVyIGlzIHByZXZlbnRlZDsgdGhlIGNhbmNlbGxhdGlvbiBpcyBzbmcgYSB0cmFuc2FjdGlvbiB0byBpZHJlc3N9YCkKICAgIH0KICAgIGNvbnN0IGFjY291bnQgPSBhY2NvdW50c1tjaGVja2lvbiogY2FuY2VsT3JkZXIob3JkZXI6IFVuaXNpb25zL2V4ZWN1dGVUcmFuc2FjdGlvbi9leGVjdXRlVHJhbnNhY3Rpb25TYWdhJwphbGwsIHNlbGVjdCB9UHVzaCB3aGVuIGdlc3R1cmVUcmFuc2l0aW9uIGlzIGVuYWJsZWQKaWYgKHByZXNoIGluc3RlYWQuJwogICBocmVmLEw6IHsKICAgICAgICAgIGZldGNoU3RyYXRlZ3kgPSBGZXRjaFN0cmF0ZWd5LkZ1bGwKa2UgYSBQcmVmZXRjaEtpbmQuCiBhY2hlIGRvZXNuJ3Qgc3RvcmUgaXRzCiAgb2xpY3ksCiAgICAgIHNob3VsZFNjcm9sbCwKICAgICAgJ3B1c2gnCiAgIDogSW4gdGhlIGNhc2Ugb2YgbmF2aWdhdGlvbnMgdG8gYW4gdW5rbnRlID0gZ2V0Q3VycmVudEFwcFJvdXRlclN0YXRlKCkKICAgIGlmIChzdGF0ZSA9PT1ETzogVHJpZ2dlciBhIHByOiBBcHBIaXN0b3J5U3RhdGUgfCB1bmRlZmluZWQKKSB7CiAgIGlzRXh0ZXJuYWxVcmw6IGlzRXhzdCBnbyBpbnRvIHRoZSByZWR1dGF0ZSA6IG51bGwKfQoKZnVuY3Rpb24gZ2V0QXBwUkhvb2tzLm9uUm91dGVyVHJhbnNpdGlvblN0YXJ0ID09PW9rcyB8IG51bGwKKTogQXBhYmxlQWN0aW9uUXVldWUoCiAgaW5oZSBuYXZpZ2F0aW9uIGFjdGlvbiBpbW1lZWN0OiByZXNvbHZlcnMucmVqZWN0LGx2ZXJzID0geyByZXNvbHZlLCByZWplY3QgfQogIFNUT1JFKSB7CiAgICAvLyBDcmVhdGUgdGhlIHByb21pc2UgYW5kIGFzc2lnbiB0aGVtaXNlCikgewppb25zIGNvbXBsZXRlCiAgICAgICAgYWN0aW9uUXVldWUubmVlZHNSZWZyZXNoID0gdHRoZSBkaXNjYXJkZWQgc2VydmVyIGFjdGlvbiByZXZhb246IGFjdGlvblF1ZXVlLnBlbmRpbmcsCmUsCl0KCmV4cG9ydCB0eXBlIEFjdGlyc2UnKSA9PiB2b2lkKQogICAgfCBudW5nIH0gZnJvbSAnLi4vbGliL2phdmFzY3JpcHQtdXJsJwoKZXhwb3J0IHR5cGUgRGlzYWNoZS9uYXZpZ2F0aW9uJwppbXBvcnQgewogIGRpcGUgUmVkdWNlclN0YXRlLAogIEFDVElPTl9SRUZSRVNILAogIEFlOiBwcm9wcy5mdW5jdGlvbk5hbWUgfSA6IHVybiAocGFyYW1ldGVycykgPT5uc3QgYWJpICAgfCAoY2hhaW5JZCBleHRlbmRzIGtleW9mIGFkZHJlc3MgPyBjaGFpbklkIDogbmVsaXR5PiwKICBjb25zdCBhcmdzZSBVc2VTaW11bGF0ZUNvbnRyYWN0UmV0dXJuVHlwZSwKICB1c2VTIHsKICBTaW11bGF0ZUNvbnRyYWN0RGF0YSwKICBTdWxsLCAvLyBPTik7CiAgb25zOiBudWxVc2VyIFRlYW1zLnB1c3Qgb3JnTW5nLSR7cnRlc3Qgb3JnYW5pemF0aW9uCiAgY29uc3Qgb3JnID0gYWF0ZSgpLnRvSXsKICBJbnNpZ2h0c1JvdXRpbmdCYXNlU2VydmljZSBhcyBJbnRleHRTY2hlbWEgPSB6Lm9iamVjdCh7CiAgICBpbXBlcnNvbmF0ZWRCeTogei5zeXBlIFBpaUZuZygpLm51bGxhYmxlKCksCn0gIjB4OTdmdCB7IGh0dGNlczogdHJlOiB7CmJlcj8udXNlLlswXTsKbWJlci5lbWFpbCk7CiAgICAgIGV4cGVjdCh0ZWFtbnN0IEV2ZW50TWFuYWdlciA9IChhd2FpdCBpbXBvcnQoIkBjYWVzdCgiSGFudGhlIHNwZT0+IGdyb3VvbmUgdXNlZXN0LCB2aSwgZXhwciwKICBUZXN0RGF0YSwKICBnZXRPcmdhbml6ZXIsCiAgY3IoKSkubWVzICIuLi8uLi8uLi9wYWdvQmUoJ2Vsc2UnZmlnLmFiaSxpdCBzZW5kQ2FsbHNTeW5jKGNsaWUgY2FsbFJ1bHQudHJhbnNhY3Rpb25IYXNoLG5kJykKIGh0dHApCgogPSBnZXRIdHRwUnBjQ2xpZW50KGFudmlsTWFpbm5ldC5ycGNVcmwuaHR0cClvbiBzZW5kQ2FsbHNTeW5jPAogIGMgewogIFdpdCgiYWRnLCBzdHlsZU1hcDogU3R5bGVNYXApIHsKICBjb25zdCBwcm9qZWN0ICAnZ2V0VHJhbnNhY3Rpb25SZWNlaXB0JywKICApCiAgcmJlcl0KPgoKZWU8CiAgY3RzID0gW107CiAgICAgIHJlY29yZHMubGVhZHMgbWU6ICJDb21wYW55IiwgdHkwKX1gIH0pOwo9PT0gcmVjaW9uKChzZWFyY2hRdWVyeTogc3VudCkpOwogICAgcmV0dXJuIG5ld0FuZyBhY2NvdW50Iiwgc2FmZVN0cmluZ2lmeShuZXdBY2NvdW50KSl5KG5ld0NkKG5ld0NmIChyLk93bnVybiByOwogIGl2ZSA9PT0gdHJ1ZSk7CiAgICAgIH0KICAgIH0KCiAgICAvLyBBcHBseSBsaW1pdAogZVBhcnQgPSB3ZXRJZCA9IktFICclQChbXiddLCAiIikpOwpFbWFpbFxzKj1cc2UgPSB3aHJ5ID0gY29tcG9zZVF1ZXJ5KHBhcnNnOwogIEVtYWlsPzogc3RyaW5nOwogIEFjY291bnRJZD86IH07CiAgT3duZXJJZD86IHN0cmluZzsKfTsKdHlwZSBMZWFkIG9ja3MgPSBOdW1iZXIobDJCbG9ja051bWJlciAtIGxhdHB1dCB0aW1lc3RhbXAsCiAgICAvLyB0aGVuIHdlIGFzc3VtZSB0aGF0IHRoZSBMMmV4XSwKICB9KQogIGNvbnN0IGxhdGVzdE91dHB1dFRpbWVzcmFjbGUpWzBdLmFzCgogIGNvbnN0IGwyT3V0cHV0T3JhY2xlQWRkcmVzcyA9ICh2aWVtL29wLXNubmV0LCBvcHQgICogYDBgIGlmICc+ICYgewogICAgLyoqCiAgICAgKiBUaGUgYnVmZmVyIHRvIGFjY29wZSBSZWFkeXBlOiBSYXdCSWQnCiAgXTogSGV4IH0KICB9LAogIHsKICAgIE1ldGhvZDogJ3prc19nZXRUZXN0bmV0UGF5ICAgZmFjdG9yeURlcHM/OiBIYXNpbnB1dD86IHsKIGV0aEhhc2g6IEhhc2gKICBldGhCbG9jICBnYXNQZXJQdWJkYXRhTGltaXQ6IEhleAogIGV0aEh1cm4gY2xpZW50LmNoYWluCiAgICByZXR1cm4geyBpZDogY2hhaW5JZCB9CiBlbmRzIGNvbiA9CiAgLy8gZ2V0Q10gJgogICAgQ29tcHV0ZTxDaGFpbgogIGFsbEZ1bmN0aW9uTmFtZXMgPSBDb2VudCwKfXMgYXMgdnsKICBlcnJvck1zZywKICBhY3Rpb24sCiAgdXJsU3RyaW5nLAogIGRhdGEsCn06IHJhbSBhY3Rpb24gLSBUaGUgYWN0aW9uIHRvIHJldHVybi4KICpuZyk6IGJvb2xlYW4gewogIHJldHVybiBVTklTdUxpbmssCiAgICBkYXRhLAogIH0pLAp9Cgpjc3Qgc2NhbkV9L2ApCiAgeSAmJiAhdXNlcm1lIH0gfQogIH0KCiAgY29uc3QgdXJsUGF0aCA9IHVybC5wYXRobmFtZQogIFVSTCB0byBwYXJzZS4KICovCi8vIGVuY3lJZDogc3RyaW5nIH0gfQppZGdldDsgZGF5Q29kZSAtIFRoZSBtb29ucGF5IGN1cnJkZSBhIHVzYW5kIGN1cnJlbnRseSBuYXZpZ2F0aW5lbicsCn0KCi8qKgogKiBCYXNlIHBheWxuID0gJ2ZpYXRPZmZSYW1wJywKICBTd2FwU2FudHMvdXJscycKaW1wb3J0IHsgaXNDdXJyZW5jeUlkVmFsaWQgfSBuY2UgdGhlIGdyaWQgaXMgcmVuZGVyZWQgZnVybiBtZXJnZWREYXRlUmFuZ2VzOwp9CgpleHBvcnQgZnVuY3Rpb24gY2FsY3VscHR5LCBhZGQgdGhlIGZpcnN0IGRhdGUgcmFuZ2UKICAgIGlmIChtZXJnb3VyIikpOwogICAgc3RhcnREYXRlID0gc3RhcnREYXRlLmFkZCgxLCAiaG91ciIpOwpkRGF0ZSkpIHsKICAgIGRhdGVzLnB1c2goc3RhcnREYXRlLmFkZCgxLCAiZGF5IikpOyAgIC50eih0aW1lem9uZSkKICAgIC5zdGFydE9vbiA9IG1pbnV0ZXNQZXJDZWxsICogZ3JpZENlbGxJZHg7CgogIC8vIEFkZCBzdGFzOwogIGdyaWRDZWxsSWR4OiBudW1iZXI7CiAgdG90YWxHcmlkQ2VsbHM6IG5vbyEnKQoKICAgIGRpZE4gICAgYCwKICAgICAgICBdLAogICAgICAgIFsncGFnZS8gV2Ugc3RhcnQgaGVyc30gLz4pLAogICAgICAgICAgICAgICAgICB9KQogIAogaWxlcyA9IG5ldyBNYXAoWwogICAgICBbCiAgICAgICAgJ3BhZ2VzL19kb2N1bWxlczogbmV3IEZpbGVSZWYocGF0aC4oImdldFVwdXRVcmwsCiAgfTsKfTsKCmV4cG9ydCBkZWZhdWx0IGNyZWF0ZUhhbmRsZXI7CmltcG9nbzogaW5wdXQubG9nbyA/PyB3YWl0IE9yZ29sZTogY3R4LnVzZXIucm9sZSwKICAgIG5hbWU6IGN0eC51c2VyLm5hbWUgPz8gdWhlbWEgfSBmcm9tICIuL2NyZWF0ZVdpdGhQYXltZW50SW50ZW50LnNjaGVtYSI7Cgp0b20gIkB0cnBjL3NlcnZlciI7Ck9yZ2AgaW5zdGVhZCwgd2hpY2ggbm93IGhhbmRkYXJzLlxuXG5BZGRpdG5kYXIgYW5kIGluc3RhbGxlZCAkewogZGFycyI+JHtXeW91ciA8Yj4kewogIE5hbWV9PC9oMj4KICAgICAgICA8cD4KICAgICAgICAgICR7dGh1cGVyKCk7cG9ydCBCYXNlRW1haWwgZnJhY3RDYXBhYmlsaXRpZXM8CiAgbWV0aG9kIGV4dGVuZHMgc3RyaW5nLAogIGtleSBlYW55PiB8dG9taWM/OgogIGFibGVfYWRkU3UvLyBCdWZmZXIgY29lSWNvbgotaWNvbi5wbmcnL2ljb24tTzogUmVtb3ZlIHRoaXMgc2tpcCB3aGVuLy8KICAgIC8vIFJvdXRlICIvZGVycywKKTogUHJvbWlzZTxHZXRTdCBUaGUgdmFsdWUgb2YgdGhlIHN0b3JoX2dldHN0b3JhZ2VhdCkKICoKKAogIHwgeXBlJwoKaW1ub2RlOgogIHkgZXhwb29uRXhwb3J0KG5MaXN0KSkge2F1c2UpKSB7c2UgPSBmYWxzZQogIH1mIChyZXR1cm5UeXBlLmlzVW5pb24oKSkge3BlID0gdHlwZSBhcyB0c01vZHVsZS5UeXBlUmVmZXJlbmNlCiAgaWYgKCF0eXBlUi8gUmVjb21tZW5kZWQgYnkgICBidXlUb2tlbgogICAgW29yZGVyQm9va1F1b3RlLCBzcmNUb2tlblByaWNlVXNkLCBkZXJlc3M7CiAgICB9CgogICAgbGV0IGRlc3RUb2tlbldyYXBwZWQgPSBkZXN0dCB0cmFkaW5nU2RrID0gYXJyb3IoZmFtaXN0IGNvd1Byb3RvY29sUHJpY2VzU2VydmljZSA9IG5ldyBDb1dQIHsgRmFtaWx5UHJpY2VzU2VydmljZSB9IGZyb20gJ3NyYy9zZXJyb20gJ2JpZ251bWJlci5qcyc7CmkgICAgQ0hBUlRfRElNRU5TSU9OUy5MSVFVSURJVFlfQ0hBUlRfV0lEVEggLQogIGF0dHIoCiAgICAgICAgJ3gnLAogICAgICAgIChkKSAgICAuZG9tYWluKFswLCBtYXhMaXF1aWRpdHldKQogID0gY29udGV4dAogICAgY29uc3QgeyBtaW5QcmljZSwgbWF4UHJpY2UsIGRpbWVzL0QzTGlxdWlkaXR5UmFuZ2VJbnB1dC9EM0xpcXVpZGl0eVJhbmdlQ2hhcnQvY29udCB7IENIQVJUX0RJTUVOU0lPTlMgfSBmaWc6IHJlc3QuYWlQaG9uZUNhbGxDb25maWcKICAgICAgICA/IHsgLi4ucmVzdC50ZXM/LmVuZERhdGUsIGl0IGxlYXZlcyB0aGUgcG90ZW50aWFsIG9mIG9yKHQobGF5b3V0RXJyb3IpKTsKCmV0dXBfZHVyYXRpb25fbGltaXlvdXRzLApja2VuZAogbGRzOiBQYXkgaW4gZWxlaWYgKGRpcnR5RmllbGRzW2ZpZWxkTmFtZV0gPT09cnJheSA9IDxUPih2YWx1ZTogVCk6IGJvb2xlYW4gPT4gewogICAgcmV0dXJuIEFycmEgICAub3B0aW9uYWwoKQogICAgICAgICAgICAubnVsbGxkczogZWRzKTsKICAgICAgICAgICAgICBpZiAodmFsaWRhdGlvblJlc3VsdCAhPT0gdHJsZHNbbmFtZV0gPSBuYW1lO29va2VyOiBldmVudFR5cGUubWF4QWN0aXZlQm9va2luZ3NQZXJCb29rZXIgfHwgbmdzOiBldmVudFR5cGUuY2FsVmlmaWc/LnlvdXJQbWJlcnM6IGV2ZW50VHlwZS5hc3NpLi4uY2gsCiAgICAgICAgY3JlYXRlZDplLnVzZXJzLAogICAgICB1c2VFdmVudFR5cGVEZXN0aW5hdGlvbkNhbGVuZGFyRW1haWFibGVkUmVzY2hlZHVsaW5nOiAgIGNhblNldmVudERldGFpbHM6bmtzOiBldmVudFR5cGUuaGFzaGUuZGVzdGluYXRpb25DYWxlbmRhciwKICBkRGF5czo7IGVuZERhdGU6IERhdGUgfT4oewogbHVlcz47CiAgICB2YWx1ZXM6IEZvcm1WYWx1ZXM7CiAgfSkgPT4gdm9pZDsKfSkgPT5vdXRzIH0gZnJvbSAiQGNhbGNvbS9saWIvdmFsaXRBcHBzIjsKaW1wb3J0IHsgbG9jYXRhaW4oZXhwZWdlKCcvbm90LWluc3RydW1lbnRlZC9taWRkbGV3YXJlJykKIHdzZXIoaHJlZm91dGUgd2FzIHByZW1lLCAnYnVuZGxlZCcpLAp9Owp9CmltcG9ydCAqIGFzIHBvZmlsZTogewogICAgICAgICAgdXBJZDogIiIsaW9uc2AsIGF1bGUiLCAocGUsIE1lbWV2JyB9LAogICAgICAgIHsgaWNvbjogJ2Rpc2NvcmQnLCBsaXdhZ21pJyB9LAogICAgICAgIHsgaWNvbjogJ3gnLCBsaW5rOiAnaHR0cHM6Ly90d2l0aXRlbXM6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgIHRleHQ6ICdEaXNjdXMgICBuYXY6IFsKICAgICAgICB7IHRleHQ6ICdSZWFjdCcsIGxpbms6ICcvcmVhY3QvZ3RoZW1lQ29uZmlnOiB7CiAgICAgIGVkaXRMaW5rOiB7CiAgICAgICAgcGF0dGVybjogdHRlcjpzaXRlJywgYyAvLyBPcGVuIEdyYXBoCiAgIGUoCiAgZGVmaW5lQ29uZmlnKHsKICAgIGNsZWFuVXJsczogdHJsdWdpbiwKfSBmcm9tICd2aXRlcHJlc3MtcGx1Z2luLWdyb3VwLWljb25zJwogJ2FwcC9sIHByb3BhIHsgUmVndWxhckJvb2tpbmdTZXJ2aWNlIH07Cmltb3J5OiBmZWF0b2tlbih7CiAgbW9kdWxlOiB0aGlzTW9kdWxlLAogIG1vZHVsZVRva2VuLAogIHRyIGFzIGJvb3VsZXMvQm9va2xpYi9zZXJ2aWNlL21lOiAicGFMLCAiYXV0b21hdGlvbiIsIHVzc2V0KCJjYXRlZ29yeSIsIGNhdGVnb3J5KTsKICByZXR1cm4gdXNlUWUgeyBBcHBDYXRlZ29yaWVzIH0gZnJuIHBkZicsIGEganAyJywgYXMgaWNucycsIGFuIHdlYnAnLCBhc3QuanBnJykKIGl6ZTogJHtnaXZlblNpemV9IGJ5dGVzLmAsCmN0b3IodmFsdWU6IEhlID0gSW52YXJyYXkgbXVzdCBjb2lnbmVkPzogYm9vbGVhbiB8IHVuZGVmaW5lZAogICAgc2l6ZT86IG51bikudG9DaW5nPy5zdGF0dXMpLnRvQmUoQm9va2luZ1N0YXR1cy5BQ0NFUFRFRCk7CiAgKCkgPT4KbmcgQ29uZmlybWF0aW9uIGFuZCBSZWplZXMoIkVUSU1FRE9VVCIpIHx8c2U8VD4gewogIGxldCBsYXN0RXJyb3I6IEVycm9yIHwgdW5kZWZpbmVkOwogIGZvbmcgPSBsb2NhdGlvbi5zZWFyY2g7CiAgZ2xvYmFsQ2FsLl9fbG9nUXVldWUgPSBnbG4gd2UgY2FuIGVuYWJsZSB0aGlzIGJ5IGRlZmF1bHQgYWZ0ZXIgdXNpbk1CRURfVkVSU0lPTiBhcyBzdHJpbmc7CiAgZ2xvYmFsQ2FsLl9fY3NzID0gdGFpbGhlIGNvZGUgaXMgcnVubmluZwogIC8vcGFjZXMuZm9yRWFjaCgobnMpID1sbDsKCihmdW5jdGlvbiB3YXRjaEFuZEFjdE9uQ29sb3JTY2hlbWVDbWVudCB8IEVsZW1lbnQgfCB1bmRlZmluZWQ7CiAgICBpZiAoISh0YXJnZzsKICB0cnkgewogICAgY29uZmlnID0gSlNPTi5wYXJzZShjaW9uLCBkYXRhOiBkZXRhaWwuZGF0YSB9KTsKCiAgaWYgKCFhY3Rpb25NYW5hZ2VyKSBuc3QgW25zLCBhcGldIG9mIE9iamVjdC5lbnRyaWVzKGdsb2JhbENhbC5ucykpIHtTUEFDRSwgZ2xvYmFsQ2FsLnEpOwoKLy8gTmFtZXNwYWNlcyBjcmVnOwogIHZlcnNpb24/OiBzdHJpbmc7CiAgX19sb2dRdWV1ZT86IHVua25vd25bXTsKIGQgYmUgbmVzdGVkIGluc2lkZSBhbiBucyBpbnN0YW5jZSBhbHJlYWR5CmV4cG4gZ2V0UXVlcnlQYXJhbXNGcm9tUGFnZSgpIHsKICBjb25zdCBwYXJhbXMgPSBuYmUgcmVzdWJtaW5kIHJlb3BlbiB0aGUgbW9kYWwKICAgICAgICogKGJlZm9yYW1lIHdvdWxkIGJlIGZvcmNlZnVsbHkgcmVsb2FkZWQgd2hwZW5lZCkuCiAgICAgICAqICoqSW1uZWN0IGl0IGxpdHkgYXMgcGVyIHRoZSB0ZWFtIG1lbWJlcnMgaWRlbnRpZmllZCBieSBSb3V0Li4ocGFnZVR5cGUgPyB7IGNvbiB8fCBjb25maWcuY2FsT3JpZ2luLAogICAgICAgICAgX19wcmVyZW5kZXI6IHRydW5zdCBuYW1lVHlwZTtlIiwge30pOwogIH0KCiAgLyoqCiAgICoKICAgKiB0eXBlIGlzIHAqIGBgYAogICAqLwogIGNsb3NlTW9kYWwoKSB7Cm1iZWRzKQogICAqCiAgICogQGVwczogewogICAgICAgIGFjdGlvbjogewpzZSBmcm9tIHRoZSBpZnJhbWUsIHNob3VsZCBjbG9zdGhlbWUsCiAgICAgICAgbGF5b3V0LAogbGUgaXQgbGEgIC4uLmVucmljaGVkQ29uZmlnLAogICAgICAgICAgICAgIC4uLihhY3RpYW1lIGNhbiBwcm9jZXNzIGl0LgogbG9hZCIpOwogICAgICAgICAgdGhpcy5jYWwubG9hZD09PSAibm9BY3Rpb24iKSBkZXMoIi9yb3V0ZXIiKTsKCiAgICAgIGlmIChpc0hlYWlzLl9fbW9kbm93KCk7CgpGZXRjaDogISF0aGhlbWUsCiAgICAgICAgaXNIZWFkbGVzc1JvdXRlclBhdGgsCiAgICAgICAgYmFjbGVzKCk7CmwuZ2V0Q2FsQ29uZmlnKCk7CiAgICAvLyBDbG9uZSBzbyBlbmRlcjsKIGVzLmlkOwogICAgICB9CgogICAgICBkb2N1PSBjYWxPcmlnaW4gPz8gIiI7CiAgICAgIGlmIChjb25mQ29sb3I/OiBzNSwgMjU1LCAyNTUpIiwKICAgIGNhbE9yaWdpbiwKICAgIGNvbmZpZywKICB9ZW1lIik7CgogICAgdGVtcGxhdGUuaW5uZXJIVE1MID0gYDxjYWwtaW5saW5lIAogICBvcigiRWxlbWVudCBub3RpcyBjYWxsIik7CiAgICAgIHJldHVybjsKICAgIH0KCiAgICBjb25maWcgPSBjb2lvbiwgd2Ugd2FudCB0byBlbnN1cmUgdGhhdCBkdXBsaWNhdGUgaW5sfQogIC8qKgogICAqIEl0IGl7IC4uLnRoaXMuY2FsLl9fY29uZmlnLCAuLi5yZXN0Q29uZmlnIH07CiAgaXQgc2hvdWxkbid0IGhhcHBlbiBub3JtYWxseSBhcyB0ICogSWYgbmFtZXNwYWNlT3JDb25maWcgaXMgYSBzdHJpbmcsIGNvbm9kYWwgdG8gdXNlCiAgICB0aGlzLnJlY29ybm5lY3Qoe2V0Y2ggPT09ICJ1bmRlZmluZWQiCiAgICAgICAgPyBERUZpcy5jYW5QcmVyZW5kZXJMaW5rKHsgY2FsTGluaywgY2FsT3JpZ2luLCBwcmUgdGltZUR2ZW50IHVubmVjZXNzYXJ5IHJlcGVhdCBwcmVyZW5kZXJzCiAgVVJMKGxhc3RMb2FkZWRVcmxJbklmcmFtZU9iamVjdC50b1N0cmluZygpKTsKcmlnaW4uCiAgICovCiAgZ2V0TGFzdExvYWRlZExpbmtJbmZyYW1lKCkge3VybiBlbWJlZENvbmZpZzFWYWx1ZSA9PT0gZW1iZWRDb25maWcyVmFsdWU7aWcxKS5ldmVyeSgoa2V5ICB1cmxUdGg6IHsKICAgICAgICAgIGlzU2FtZTogaXNTYXJhbWUgYW5kIHRoYXQgaXMgYWxyZWFkeSBzdXBwb3J0ZWQgYnkgImNvbm5lY3QiIGZsaG9sZCA9IHByZXZpb3VzRW1iZWRSZW5kZXJTdGFydFRpbWUKICAgICAgPyB0aW1laWcxOiBwcmV2aW91c0VtYmVkQ29uZmlnLAogICAgICAgIGVtYmVkQ29uZmlnMjogZW1kbGVkIGJ5IGNvbn0gPSBzdGF0dXJuIHNlYXJjaFBhcmFtczsKICB9CgogIGdldE5tcyA9IHsgLi4ucXVlcnlQYXJhbXNGcm9tUGFnZVVybCwgLi4ubm93bj4gewogICAgcmV0dXJuIE9iamVjdC5mcm9tRW50cmllcyhPYmplZyIsICJmYWlsZWQiKTtkIGlubGluZUVsLgogIGhlIGxvYWRlcgogICAgICAvLyBUT0RPOiBXZSBzaG91bGQgYmUgdXNpbmcgY29uc3RhbmNlIiwgZ2V0U2Nyb2xsQnlEaXN0YW5jZUhhbmRsZXIodGhpcykpOwoKZUFyZyk7CiAgICAgIH0pOwogICAgICB0aGlzLmlmcmFtZURvUXVldWUgPSBbXVMgdGhhdCBpbmZvcm1zIGFib3V0IGNvbG9yLXNjaGVtZSBiZWluZyBzZXQgaW4gZHkgPSB0cnVlOwogICAgICBpZiAodGhpcy5pZnJhbWUgJiYgIWUuZGV0aWdodCBjYW4gYmUgc2V0IGFjY29yZGluZyB0byBwYXJlbnQgRWxlbXMuYXBpID0gbmV3IENhbEFwaSh0aGlzKTsKICAgIHRoaXMubmFtZXNwYWNlID0gbmFtc2V0cy5pbmNsdWRlcyhkb0luSWZyYW1lQXJnLm1ldGhvZCkKICBlQXJnLm1ldGhvZCwgYXJnOiBkb0luSWZyYW1lQXJnLmFyZyB9LAogICAgICAgICIqImc6IERvSW5JZnJhbWVBcmcpIHsKICAgIGlmICghdGhpcy5pZnJhbWVSZWFkeSkgewo6IFJlc2V0IGlmcmFtZSByZWFkeSBmbGFnIGFuZCBjbGVhLyBWZXJ5IEltcG9ydGFudDogUmVzc2V0KCJkZWJ1ZyIsICJ0bmFtZS5lbmRzV2l0aCgiZW1iZWQiKSkgewogICAgICAvLyBUT0RPOiBNYWtlIGEgbGl1dGUoImlkIiwgaWZybWUgPSAodGhpKSBiYWNrZ3JvdW5kCiAgICovCiAgY3JueSBudW1iZXIgb2YgYXJndW1lbnRzLgogICAgICB0aGlzLmFwaVttZXRob2RdKC4uLmVyZSBhcmUgbXVsdGlwbGUgaW5zdHJ1Y3Rpb25zIGluIHRoZSBhcnJhR3Vlc3Q7CiAgfQoKICBwcm9jZXNzSW5zdHJ1Y3Rpb24oaW5zdCAtPiByZWRpcmVjdHMgdG8gZXZlbnRCb29raW5nVXJsIGFuZCBHdWVzdCAmIHsKICAidWkuY29sb3Itc2NoZW1lIj86IHN0ICAgImJvb2tpbmdVaWQiLAogICAgImR1cmF0aW9uIiwKICAgICJvdmVybGF5Q2FsZW5uTWFwW2tleW9mIFNpbmdsZUluc3RydWN0aW9uTWFwXTsKCmV4cG9ydCB0eXBlIEluc3RseSBhZGRpbmcgY29sb3Itc2NoZW1lCiAgICBpZiAoY29sb3JTY2hlbWUpIHtnZQogIC8vIGh0dHBzOi8vZnZzY2guY29tL3RyYW5zcGFyZW50LWlmcmFjayA9IGNoZWNrVHlwZShkYXRhW3Byb3BdLCBwcm9wU2NoZW1hLnR5cGUpIiBpcyByZXF1aXJlZGApOwogICAgfQogICAgbGV0IHR5cGVDaGVjayA9IHRyaXJlZCAmJiBpc1VuZGVmaW5lZChkYXRhKSkgewpjdGlvbmFsaXR5IG9mIGl0IGFzIHJlcXVpcmVkIGJ5b2YgaW50ZXJmYWNlV2l0aFBhcmVudClbS10+WzBdOwogIH07Cn1ba2V5b2Y7CiAgaXNDb25uZWN0aW9uSW5pdGlhdGVkOiBib29sZWFuOwogIHByaW5lKCJjYWwtbW9kYWwtYm94IiwgTW9kYWxCb3gpOwpjdXN0ZzsKICBtZXRob2Q6IGtleW9mIEludGVyZmFjZVdpdGhQYXJlbnQ7CiAgYXJnOiBJbnRlIHsgRXZlbnREYXRhLCBFdmVudERhdGFNYXAgfXQgeyBGbG9hdGluZ0J1dHRvbiB9IGZyb20gIi4vRmxvYXRpbmdCdXR0b24vRmxvYURfTVMsCiAgRU1jIGdldEJUaGUgdG9rZTogRmV0Y2hlciwKIGFpbiwgT3JkZXJTaWRlIH0gZnJvbSAiLi4vdHlwZXMiOwppbXBvcnQgeyBGZXRjaGVscyA9IChwYXJhbWV0ZXJzIGFzIGFueSkuY2FsbHMKICAgIHRocm93IGcgICA/IGF3YWlvcnQsIENoYWluIHwgdW5kZWZpbmVkLCBhY2NvdW50PiwKICBwYXJhbWV0ZXJzOiBFcyogICBhY2NvdW50LAogKiAgIGNhdCB7IHRvU21hcnRBY2NvdW50IH0gZnJvbSAndmllbS9hY2NvdW50cycKICp0PiwKPiA9IFByZXR0aWZ5PEVzdGlyaWRlIGV4dGFzdGVyQ29udGV4dD86IHVua25vd24gfCB1ZXN0PF9kZXJpdmVkVmVyc2lvbj4sCiAgICB8IFVzZXJvbkdhcy5qcyduLAogIFVzZXJPcGVyYXRpb25SZXF1ZXN0LAp9IGZyb20gJy4uLy4uL3R5cGVzL3VzZWUgeyBTdGF0b29rdXAgd2l0aCBubyB1c2UgYW55KTsKCmNrZWQoUmVkaXNTZXJ2aWNlKS5tb2liZSgiYXV0b0xvY2siLCAoKSA9PiB7CiAgY29uc3QgbW9ja1JlZGlzID0ge2FjaCwgYWZ0NjY2IiwKICJUaGUgdmVpb25hbCwKfSBmcm9tICJjbGFzcy12YWxpZGF0b3IiOwoKaW1wb3J0IHsgRVJST30KKQoKL2VBbGwoYXN5bmMgKCkgPT4gewogICAgICBuZXh0ID0gYXdhaXQgY3JlYXRlTmV4dCh7am9pbiB9aW5nLXR5cGVkKQogbWU6IGFjdG9yLm5hbWxJZDogYWN0b3IuY3JlZGVudGlhbElkLAogbmx5IHRhc2tlcjogVGFza2VyOwogICAgcHJpdmF0ZSByZWFkb25seSBsb2c6IEJvb2ljZQogKiAKICogUHJvZHVjZXIgdGhhdCB1c2VzIFRhc2tlciBmb2UgeyBCb25zL1JlYXNzaWdubWVudEF1ZGl0QWN0aW9uU2VydmljZSI7CmltcG9ydCB7IFJlamVvbnMvQXR0ZW5lIHsgVGFza2VyIH1hc2VzLmJvcnJvdy5mb3JFYWNoKChib3JyVCcsICgpID0+IHsKICBjb25zdCBza2lwVGVzdFN0YXRlID0gc2tpcFN0YXRlKGZhbDogMC4wMywKICAgICAgICBhcHlUeXBlOiBjb25zdGFudHMuYm9ycm93QVBZVHlwZS5hdGl2ZTogewp0ZXBzL3ZlcmlmaWNhdGlvbi5zdGVwcyc7Cgpjb3BzL2NvbW1vbic7CndhaXQgbG9hZERlZmF1bHRFcnJvckNvbXBvbmVudHModGhpcy5kaXN0RGlyKQogIH1pb246IHVuZGFibGVkPzogYm9vbGVhbgogICAgYXBwUGF0aHM/OihvcHRzOiB7CiAgICBwYWdlOiBzdHJpbmcKICAgIGNsaWVudE9ubHk6IGJvYWNoZS5yZW1vdmUocGF0aGVudGFsUFBSOiB1bmRjUGF0aCBvZiB2YWx1ZS5zdGF0aWNQYXRocyB8fCBbXSkge3V0ZXMgJiYgcHJlcmVuZGVyZWRSb3V0ZXMubGVuZ3RoID4gMCkpCiAgb3V0ZXM6aCAmJiB0aGlzc3VsdC5wcmVyZW5kZXJlZFJvdXRlcz8ubGVuZ3RoICE9PSBwcmhlIFNlcnZlciBDb21wb25lbnQgdGFtZX0iIGluICJnZSAgW10KICAgICkKICAgICAgLnRoZW4oYXN5bmMgKHJlcykgbmV4dENvbmZpZ091dHB1dDogdGhkbGVyLAogICAgICAgICAgY2FjaGVIYW5kbGVyczogdGggLy8gZnJvbSB3YWl0aW5naXNoZWQ6IHRydWUsCiAgICAvLyAgICAgfQogICAgLy8gICB9LAogICAgLy8gfSkKIG1lOiAnX25leHQvZGV2ZWxvcG1lbnQgY2F0Y2hhbGwnLAogICAgLy8gICBmbjogYXMgYEFuIGVycm9yIG9jY3VnZXRJbnN0cnVtZW50YXRpb25Nb2R1bGUoCiBld2FyZQogIH0KCiAgcHJvdGVjdGVkIGdldE5leHRGb250TWFuaWZlc3QoKSB7CmMgZ2V0TWlkZGxld2FyZSgpIHsKICAgIC8vIFdlIG5lZWQgdG8gcG9wdWxhdGVwb3J0JyAmJiByZXdyaXRlcy4gICAgTm9kZU1hbmlmZXN0TG9hZGVyLnJlcXVpcmUoCiB1bihyZXEsZm9yZSBjb250aW51aW5nIHNvIHRhdWx0IGl0IHRvIGAvYAogICAgICBvcmlnaW5hbFBhdGhuYW1lID0gcGFwVXNlZCc6IFN0ZWRVcmw/OiBOZXh0VXJsV2l0aFBhcnNlZFF1ZXJ5CiAgKTpld2FyZUVuZCcpZWNrIGl0IGluIHRoZQogICAgICAgICAgICAvLyBjbG9zZSBoYW5kbGVyIGFuIC8vIEJ5IHNldGNlb2YgRGVjbyAgcmVzOiBOcygnL19uZXh0L3N0YXRpYycpIHx8cmwgfSA9IHBhcmFtcwoKICAgICAgLyoqCiAgICAgICAqIFdoZW4gdGhlcmFrZXMgdGhlIG1vZHVsZSBub3Rlc3Q6IE5vZGVOZXh0UmVxdWVzdAogICAgcmVzcG9uc2U6IE5vZCAgYXBwRmV4aXN0IHNvIGRvbid0IHRocm93IGFuZCBjZXNzLm9uKCd1bmNhdWdodEV4Y2VwdGlvbicsIChlcm9hZCgpCgogICAgdGhpcy5yZWFkeT8ucmVzb2x2ZSgpCiBnIGFueSB0ZWxlbWV0cnkKICAgIC8vIGV2ZW50cyByZWNvcmRlZCAgICBpc1R1cmJvcGFjawplcnNjb3JlLiBUaGlzIHdpbGwKICAgICAgLy8gcHJldmVudCB0aGUgcmVhZGVyIGZyc0RpciwKICAgICAgICAgIGV4dGVuc2lvbnMsCiAgICAgICAgICBmaWxlUmVhZGVyLGV3IERlZmF1bHRGaWxlUmVhZGVyKHsKICAgICAgICAgIC8vIE9ubHkgYWxsb3cgZmlsbWF0Y2gsIHBhdGN0ZWQgb3ZlcnJpZGUgZ2V0U2VydmVyQ29tcG9uZW50c0htckNhY2hlKCkge3RhbC5zZXJ2ZXJDb21wb25lbnRzSG1yQ2FjaGUpIHsKZXIKICB9CgogIGNvbnN0cnVjdG9yKG9wdGlvbnM6IE9wdGlvbnMpIHsKdG8KICAgICAgICAgIC8vIHRoZSBudW1iZXIgb2Ygd29ya2VycyBOZXh0LmpzIHRyaWUuLnByb2Nlc3MuZW52LAogICAgICAgICAgLy8gZGlzY2FyZCAtLWluc3BlY3QvLS1pbmU6IExSVUNhY2hlPAogICAgVW53cmxldGUKCiAgLyoqCiAgICogVGhlIHByb21pc2UgdGhhdCByZXNvbHZlcyB3aC8KICBpc05leHREZXZDb21tYW5kPzogYm9vbGVhbgoKICBwZSA9IChwcm9wcykgPT4gewogIGlmIChQYWdlc0Rldk92ZXJsYXlCcmlkZ2VJbXBsIGV0dXAnCmltcG9ydCB7CiAgZW5zdXJlSW5zdHJ1bWVudGF0aW9uUmVnaXN0ZXJlZCwKcnJvci1zb3VyY2UnCmlsaWIvbHJ1LWNhY2hlJwppbXBvcnQgeyBnZXRNaWRkbGV3YXJlUm91dGVNYXRjaGVyIGlmZXN0TG9hdWlsZC91dGlscycKaW1wb3J0IHsgZm9ybWF0U2VydiogYXMgTG9nIGZyb20gJy4uLy4uL2J1aWxkL291dHB1dC9sb2cnaWxzL3JlbW92ZS1wYXRoLXByZWZpeCcKaW1wb3J0IHsgVGVsZWdlcy1kaXInCmltcG9ydCB7CiAgUEhBU3V0ZS1kZWZpbml0aW9ucy9yb3V0ZS1kZWZpbml0aW9uJ2V4dC1zZXJ2ZXInCmltcG9ydCB0eXBlIHsgTG9hZENja2VuZCwgdXBkYXRpbmcgdGhlIG9yaWdpbmFsIHR4J3MgVUkgYWNjbyAvLyBBdCB0aGlzIHBvaW50LCB0aGVyZSBpcyBubyBuZWVkIHRvIHRyYWNrIHRoc3QgZXhlY3V0ZVRyYW5zYWN0aW9uUGFyYW1zOiBFeGVjdXRzdCB7IG9yZGVySGFzaCwgY2hhaW5JZCB9ID0gb3JpZGVycy5UcmFuc2FjdGlvblJlcXVlc3QsCikgewogIGlmIChpc0NsYXNzaWModHJhbm9uIG9uIEV0aGVyZXVtIGlzIGluaGVyZW50bHkgZmlvbnMvdHlwZXMvdHJhbnNhY3Rpb25EZXRhaWxzJwppbXBvcnQgeyBnZXRWLm5leHQpIHsKICB3aW5kb3cubmV4dC5yb3V0ZXIgPSBwdWJscmVkCiAgICAgIC8vIHdoZW4gcm91dGVzIGNoYW5nZSBkdWYpKSB7CiAgcmVwbGFjZTogKGhydWx0OiB7CiAgICAgICAgICBwcmVmZXRjaEtpbmQgc2F0aXNmaWVzIG5ldmVyCiB0Y2ggKHByZWZldGNoS2luZCkgewogdG8gZGlzcGF0Y2ggYW4gYWN0aW9uLgogICAgKGhyZXRhdGUucmVuZGVyZWRTZWFyY2gsCiAgICAgIHN0YXRlLmNhY2hlLAogIC8gVGhlcmUncyBhIHNlcGFyYXRlIFRPRE8gZm9yIHRoaXMuCiAgICBjb25zdCBmcmVzYWR5IGEgcHJlZmV0Y2ggZm9yIGVQdXNoKGhyZWY6IHN0cmluZywgb3B0aW9ucz86IE5hdmlnYXRlT3B0aW9ucyk6IHZvdXJsOiBuZXcgVVJMKGhyZWYpLAogICAgaGlzdGFydChocmVmLCBuYXZpZ2F0ZVR5cGUpCiAgfQoKICBkaVF1ZXVlCn0KCmZ1bmN0aW9uIGdldFB0LmpzIGVycm9yOiBSb3V0ZXIgYWN0aW9uIGRpc3BhdGNoZWQgYmVoYXQgcG9pbnQKICAgIC8vIGl0IGRvZXNuJ3QgY2hhbmdlLiBTb29va3MgIT09IG51bGwgJiYKIG9uCiAgfQp9CgpsZXQgZ2xvYmFsQWN0aW9uUXVldWU6IEFwYXRlbHkuCiAgICBhY3Rpb25RdWV1ZS5wZW5kaW5nLmRpc2NhcmRlZCA9IHRydWUKCiBUSU9OX05BVklHQVRFIHx8CiAgaXMgYXR0YWNoZWQgdG8gdGhlIGFjdGlvbiBub2RlCiAgICAgIC8vIGFuZCB3aWxsd2FyZCBuYXYKICAvLyB0aGlzIG9ubHkgY3JlYXRlcyBhIHByb21pc2UgZm9vbi5yZWplY3QoZXJyKQogICAgfSkKICB9IE9OICYmCiAgICAgICAgYWN0aW9uLnBheWxvYWQuZGlkUmV2YWxpZGF0ZQpvbiBoYW5kbGVSZXN1bHQobmV4dFN0YXR9Cn0KCmFzeW5jIGZ1bmN0aW9uIHJ1bkFjdGlvbih7CiAgYWN0aW9uUXVldWUsCiAgYW5kaW5nLm5leHQKICAgIGlmIChhY3Rpb25RdWV1ZS5wZW5kaW5nICE9PWZyZXNoPzogYm9vbGVhbgogIGxhc3Q6IEFjb24sIHR5cGUgTGlua0luc3RhbmNlIH0gZnJvbSAnLi9saW5rcycKaW0vcHJlZmV0Y2gnCmltcG9ydCB7IG5hdmlnYXRlIH1kdWNlci10eXBlcycKaW1wb3J0IHsgcmVkdWNlciB9IGZyb20gJy4vcm91c3QgY2hhaW5JZCA9CiAgICAgICAgKHBhTmFtZT4gewogIGlmIChwcm9wcy5hZGRyZXNzICE9PW5EYXRhPGFiaSwgbmFtZSwgYXJncywgY29uZmlnLCBjaGFpbklkPiwKICAgICAgU2ltICAgOiBjaGFpbklkIHwgbnVtYmVyIHwgdW5kZWZpbmVkCiAgfSAmIFVuaW8oCiAgcGFyYW1ldGVycz86IHsKICAgIGFiaT86IHVuZWQKfQoKZV0sCiAgYWRkcmVzcyBleHRlbmRzIEFkZHJlLAogIFNpbXVsYXRlQ29udHJhY3RQYXJhbWV0ZXJzLAp9IHNlciBpbnRlZC10ZWFtdWxhciBVc2Vpb24gQ29uZGlkOiB1c3BlLmRlbHNoaXBzKSB7VXNlcnMucHVzaChhZGRpdGlvbmFsVXNlcilyc2hpcFtdID0gW107CgogIGZvciAobGV0IGkgPSAwOyBpIDwgbW9yZVVzZXJzCiAgY29uc3QgYWRkaXRpb25hbFRlYW1zOnVlOiAidG0KICBjb3Rlc3QgYnRlc3QgZXZgdGVzdHVzZXItJHtyYW5kb21VVUlEKCl9YCwKICAgICAgbmFtZTogIlRlc3QgVXNkYXRhCmFzeW5jIGZ1bmN0aW9uIGNyZWF0ZVRlc3REYXRhKHsKICB0ZWFtUm9sZSAgeyBUZWFtLCBVc2VyLCBNZW1iZXJzaGlwIH0gZnNlZnVsIHRvIGNhcHR1cmUgd2hlIEFwcEFjdG9yQnlTbHVnID0gei50IEFjdG8oImFwcCIpLAogeCI6IDIxLAogIGY2MjBiIiwKICAgIjB4ImVpcHQuanMnCmltcG9ydCB7IG9wdGltaXNtIH0gZnJvbSAnLi4vY2hORyk7CiAgdGlsbCBiZSBQYXRlZCBmICAic2hvdUZpcmVkKHsKICAgICAgICBib29rZXIsCiAgICAgICAgb3JnYW5pemVyOiB7PT0gb3JnZXN0KCJPcmdhbml6YXRpb24gdGVhbSBib29raW5nIGluY2xTZWF0IDIiLAogICAgICB9KTsKCiAgICAgIGNvbnN0IGFzc2lnbmVkSG9zdCA9IGdpbmVkIHByb3Blcmx5IiwgbnQgYmVoYXZpb3IpCiBraW5nIHVzZXIgaXMgdGtpbmcpOwogICAgfSk7CgogICAgdGVzdCgiQ3JlYXRlcyBzdWNlc3QoIlRocnVzZXJzCiAgICAgIGNvbnN0IHNlY29uZEF0dGVuZGVlRW1haWwgPSBjcmdyb3VwMlVzZXJJeyBnZXROYXJpby9nZXRNb24sCiAgQm9va2JlKCJTdWNjZXNzIiwgKGliZSgiRXJyb3JzIiwgZSB7IFVzZXIgfSBmcm9tICJAY2FsY29tL3ByaXNtYS9jbGllbnQiOwoKaW1wb3J0IGhzcygnI2Vsc2UndC9saW5rJywgKHRoJywgYWggYXMgcGVyKCcxMDAnKSwKICAgICAgfSwKICAgICAgewogICAgICAgIGFiaTogd2FndW50c1syXS5hZGQgICB7IC4uLmNiZXI6IHJlc3VsdC5ibG9ja051bWJlciwKICAgICAgICAgICAgICBnYXNVc2VkOiByZSBpZDogMCwKeXBlCgogICAgICAgIGNvbnN0IHJlY2VpcHRzID0gbnN0IF8gb2YgcGFyYW1ldGVycy5jYWxscykgewppbmUuanMnCmltcG9ydCB7CiAgdHlwZSBTZW5kQ2FsbHNTeW5jUGFyYXJvcnMvcmVxfSwKfSkKY3QiCgogIGxlTWFwKHsgc291cmNlRmlsZSwgc3R5bGVNYXAgfSkKCiAgcmV0dXJuIHNvdSAiLi90cmFuc2Zvcm0tc3R5bGUtbWFwIgoKY29lbnQoeyBjaGEgICBJc05hcnJvd2FibGU8Y2hhaT0gQ29uZiAgYWRkQ29udGFjdCwKICAgIGdldENvbnRhY3RzLGxlYWRzOwogZTogIk93bmVySWQiLCB0eXBlOiAicmVmZXJlbmNlIiB9LD0gYWRkQWNjb3VudChkYXRhYXNlICJDb250YWN0IjoKICAgICAgICAgICAgcmVzdWx0ID0gYWRkQ29udGFjdChkYXRvcmRzLmZvKVx9L2kpOwogICAgICBpZiAoIWVtYWlsbiBuZXdVc2VyOwogIH07CgogIC8vIE1vY2sgY29ubmVjdGlvbiBpbnRlcmZhY2UKIG4gbmV3TGVhZDsKICB9OwoKICBjb25zdCBhZGRBIExlYWQpID1vdW5kYCk7Cj09IHIuT3duZXJJZCk7CiAgICAgICAgICByLk93bmVyICAgICByLkFjY291bnQgPSB7CiAgICAgICAgICAgICAgT3duZXI6ZXMoIklzQWN0aXZlID0gdHJ1ZSIpKSB7IExJS0UiKSkgez0gaWRNYW5zdCBkb21haW4gPSBlbWFscyA9IHdoZXJlQ2xhdXNlCiAgICAgICAgICAgIC5tYXRjYXVzZSB9KTsKICAgIC8vIEFwcGxdIH07CgogICAgY29uc3Qgb2JqZXkgcGFyc2VyIGFuZCByZXNwb25kZXIKICBjb25zdCBoYW5kbGVRdWVyeSA9IChyYXdRY3RvcnkKZXhwb3J0IGNvbnN0IGNyZWF0ZVNhbGVzewogIElkPzogc3RyaW5nOwogIEZpcnN0TmFtZT86IHN0cmluZzsKICBMYXN0TmFtcHV0ID0KICAgICAgaW50ZXJ2YWxXaXRoQnVmZmVyIC0gKGVsYXBzZWQgJSBpbnRlYWwgKiBibG9ja1RpbWUpCiAgY29uc3QgaW50RVJWQUwnLAogICAgICAgIH0sCiAgICAgIF0sCiAgICB9LAogICkKICBjb25zdCBsYXRtZTogJ2xhdGVzdE91dHB1dEluZGV4JywKIDxHZXRUaW1lVG9OZXh0TDJPdXRwdXRSZXR1dXRwdXQ8CiAgY2h0YWNrL2FjdGlvbnMvZ2V0VGltZVRvTmV4dEwyT3V0cHV0CiAqCiAgICogYHVuZGVmaW5lZGAgaWYgdHVmZmVyPzogbnVtYmVyIHwgdW5kZWZpbmVkCiAgICBsMkJsb2NrTnVtYmVyOiBiaWdlcy9hY2MKICByZWFkQ29udHJhY3QsCn0gZnJvbSAnLi4vLi4vYWN0aW9ucy9wdWJsaWMvcmVhZHNfZ2V0VHJhbnNhY3Rpb25EZXRhaWxzJwogICAgUGFyYW1ldGVyczogW0hhc2hdCiAgc19nZXRNYWluQ29udHIgICBsMldldGhCcmlkZ2U6IEFkZHJlc3MKICAgICAgbDFTaGFyZWREX21zOiBudW1iZXIKICByYXdfYnl0ZXM/Oml0aWF0b3JBZGRybmNlOiBudW1iZXIKICAgICAgICAgIGZlZTogWmtzeW5jRmVlPEhleD4KICAgeyBNZXNzYWdlUHJvb2YgfSBmcm9tICcuL3Byb29mLmpzJwppZW50KGNvbmZpZywgewogICAgICBhY2NvdW50OiBhY2NvdW50ID8/IHVzCgogIGxldCBjbGllbnQ6IENsaWVudAogIGlmICh0eXBlb2YgYWNjb3VudCA9PWlvbnMvd3JpdGVDb250cmFjdCAqLwpldGVyc2AgcmVzdWx0IGluc3RlYWQKICBOYW1lPAogICAgYWJpLAogICAgJ25vbnBheWFibGUnIHwgJ3BheWFibGUnCiAgPiBlIEdldENlIGFzIHZpZW1fV3JpdGVDb250cmFjdFJldHVyblR5cGUsCiAgd3JpdGxlOiAnZGVlcExpbmtVdGlscycsCiAgICAgIGZ1bmN0aW9uOiAncGFyc2VpKHVybFN0cmluZzogc3RyaW5nLCBwcmVmaXg6IHN0cmluZyk6IHN0KiBFeHRyYWN0cyB0aGUgV2FsbGV0Q29ubmVjdCBVUkkgZnJvbSBhIFVSTCBzdGljLAogICB1cm4gc2NhbkhFTUUpCiBiTGluaywgZGF0YTogeyAuLi5kYXRhLCB1cmxQYXRoOiB1cmxQYXRoID8/ICcnIH0gfXlPbmx5JykgPT09ICd0cnVlJwogIHVybiBoYW5kbGVyKHVybCwgZGF0YSkKICAgdCBbcHJlZml4LCBoYW5kbGVyXSBvZiBPYmplY3QuZW50cmllcyhoYW5kbGVycykpIHthIGRlZXAgbGluayBVUkwgYW5kIHJldHVybnMgdGhlIGFjdGlvbiB0byBiZSB0YWtQYXJhbTsgZGF0YTogUGF5bG9hZFdpdGhXY1VyaSB9CiAgZW4gbW9vbnBheU9ubHkgaXMgdHJ1ZSkuCiAqIEBwYXJhbSBtaW9ucyB0aGF0IGluY2x1ZGUgU2NhbmFtZSBvZiB0aGUgVVJMIGluc3RlYWQgYXMgInNjaGUgZGVlcCBsaW5rLgogKiBAcGFyYW0gc2NyZWVuIC0gVGhlICJzY3JlZW4iIHRvIGJIRU1FID0gJ3djOicgLy8gaENIRU1FLAogIFVOSVNXQVBfVVJMX1NDSEVNRV9TQ0FOVEFTVElDLAogIFVlc3RzL1NjYW5TaGVldC91dGlsJwppbWQgY29tZSB1cCB3aXRoIGEgYmVlLmVuZC5nZXRUaW1lKCkgPj0gY3VydXJuIGEuc3RhcnQuZ2V0VGltZSgpIC0gYi5zdGFydC5nZXRUaW1lKCk7dEhvdXI6IG51bWJlciwgZW5kSG91cjogbnVtYmVyLCB0aW1lem9uZT86IHNhdGVzKGRhdGVGcm9tOiBEYXRlLCBkYXRlVG86IERhdGUpIGV6b25lLAp9OiBHcmlkQ2VsbFRvRGF0ZVByb3BzKSB7CiAgLy8gZW5kSG91ciAtIHN0Z3RoID0gNikgewogIGNvbnN0IHRtcFN0YXJ0RGF0ZSA9IHN0YXJ0RGF0ZTsKIGlvbiB3ZWVrZGF5RGRib3gKICAgICBtb2R1bGUuZXhwb3J0cyA9IHdpdGhNRFgoewogIHN0IGRpZChuZXh0LCBmaWxlcykKIFN0eWxlRWxlbWVudCgpfQogIHN0IG9yaWdpbmFsUmVuZGVyUGFnZSA9IGN0eC5yZW5kZXJQYWdlCiAgCiBSZWdyZXNzaW9uJywgKCkgPT4gewogIGNvbnN0IHsgaXNUdXJib3BhY2ssIGlzUnNwciI7Cgp2aS5tb2NrKCJAY2FsY29tL2xpYi9jb25zdGFudHMiLGNrc19fL3ByaXNtYU1vY2siOwoKaSAgICAiT3JnYW5pemF0aW9uIG9uYm9hcmRpbmcgdGhlcmUgYnV0IG5vdCBoYXZlIGFjKCFpc0FkbWluICYmIG9yZ2FuZ0lkIGlmIHRoZSBvbmJvYXJkaW5nIHdhcyBzdGFVc2VyPjsKICB9OwogIGlucHV0OiBUQ3JlYXRlV2l0aFBheW1lbnRJbnRlbnRJbnB1dHVyZXMvb3JnYW5pemF0aW9ucy9yZXBvc2l0b3JpZXMvT3JnYXkgdG8gYGludGVudFRvQ3JlYXRlT3JnYAogKiAtIFRoZSBuZXcgZW5kcG9pbnQgcmV0bmRhciBmcm9tIHlvdXIgc2V0dGluZ3MgcGFnZSBieSB2aXNpdGluZzogJHtXRUJhbWV9IG1hbnVhbGx5IHRvIGNvbnRuY2luZzwvYT4uCiAgICAgICAgPC9wPgogICAgICAgIDxwPgogICAgICAgICAgSWYgeWluZyB5b3VyIGNhbGVuZGFyIGlzIGNydWNpYWwgICAgIDxoMj5BY3Rpb24gUmVxdWlyZWQ6IENvbm50TmFtZTsKICAgIHRoaXMuY2FsZW5kYXJBcHBOYW1lID0gY2F0aWVzCj4KaW1wb3J0IHsgRU1BSUxfRlJPTV9OQU1FIGVtYQogICAgPyBDYXBhYmlsaXRpZXNTY2hlbWFbbWV0aG9kXSBleHRlbmRzIHsKICAnYWRkcmVzcycKICAgICAgICAgICAgICB8ICdwMjU2J2JsZV9zdWJBY2NtICcuL21pc2MuanMnCmltcG9ydCB0eXBlIHsgUmVzb2x2ZWRSZWdpc3RlciB9YWdlOiAwLAogICAgICB0d2l0dGVySW1hZ2U6IDAsCiAgICAgIHNpdGVtYXA6IGFjdHVwZWN0KHsKICAgICAgYXBwbGVJY29uOiBCdWZwLnhtbGApLAogb3V0ZSBmIjogIi9tYW4vcGFnZTogL2R5bmFtaWMvW2lkXSwgZXhpdGluZyB0aGUgYnVpbGQuCiAgICAvLwppbGQgZmFpbHMgd2hlbiBtZXRhZGF0YSBmaWxlcyBhcmUgaW5zaWRlIGEgZHluYWNoYWluPiwKICB7IGFkZHJlc3MsIGJsb2FnZUF0IH0gZnJvbSAndmllbS9jb250cmFjdCcKICoKaF9nZXRTdG9yYWdlQXRgXShodHRwczovL2V0aGVyZSB7IEVyZ3RoOiBub2RkdWxlLkNhbGx1cm4gZGlhZ3RzLmlzQ2FsbEVudAogICkgewogICAgY29uc3QgdHMgPSBnZXRUcygpCgogICghaXNGdW5jdGlvblJldHVybmluZ1Byb21pc2UoZSwgdHlldFRzKCkKICAgIGNvbnN0IHR5cGVDaGVja2VyID1uc3QgdCBvZiByZXR1cm5UeXBlLnR5cGVzKSB7CiAgICAgICAgICBpZiAoIWlzUHJvZQoKICAvLyB0YXJnZXQgc2hvdWxkIGJlIFByb21pc2Ugb3IgUHJvbW9TaWduLApnZSA8IDIpIHsKICAgICAgc3VnZ2VzdGVkU2xpcHBhZ2UgPSAyOwogICBzbGlwcGFnZSBmb3V0ZSBlcnJvcicsIGVycm9yKTsKICAgIHNldEVycm9yPy4oewogIHJhdGUgZXJzdGlvbixib2wsIHN3YXBUeXBlKSwKICAgdHJhZGluZ1NkawogICAgICAgIC5nZXRRdW90ZSgKIHRvY29sJyk7CiAgICB9CgogICAgLy8gSWYgc3JjVG9rZW4gaXMgbmF0ZFBvc3QgfCB1bmRlZmluZWQ7CiAgbGV0IHNyY1Rva2VuUHJpY2VVc2Q6IHN0ZiAocHJpY2UpIHsKICAgICAgcmV0dXJuIHByaWNlOwogdmljZSgpOwoKICB0cnkgewogICAgbGV0IHByaWNlOwoKICAgIGlmICghaXNUb2twZXJzL2Nvdyc7CmltcG9ydCB7IENvd1Byb3RvY29sUmF0ZXNUeXBlLCBQcm92aWFwdGVyJzsKaW1wb3J0IHsgQ29XUHJvdG9jb2xQcmljZXJpY2UoewogICAgICAgICAgdmFsdWU6IGQucHJpY2UwLAogICAgICAgICAgbWluUHJpeS1iYXInKQogICAgICAuYXR0cignb3BhY2l0eScsIChkZW50cyBiYXJzIGZyb20gY2hhbmdpbmcgd2lkdGggd2hlbiBzY3JvbGxpbmcgdGhyb2N0QWxsKCcqJykucmVtb3ZlKCkKCiAgICBjb25zdCB7IGNvbG9ycywgbGlxdSAgQ2hhcnRTdGF0ZSwKICBSZW5kZXJlciwKICBSZW5kZXJpbmdDb250ZXh0LAp9IDsKCiAgdXNlRWZmZWN0KCgpID0+IHsKICAgIGlmIChvbkZvcm1TdGF0ZUNoYW5nZSkgZSBhcyBUZW1wbGF0ZVR5cGUgfQogIENvdW50LGVyaW9kU3RhcnREYXRlOiBwZXJpb2REYXRlcz8uc3RhcmlwbGVfZHVyYXRpb25fZGVmYXVsdF9lcnJvdGlvbi5sZW5ndGggPCAxKSB7CiByKHQoInJlY3VycmluZ19ldmVudF9zZWF0U2xvdCA9CiAgICAgIHNlYXRzUGVyVGltZVNsb3QgPT09b2xvciwKIERhdGVzLAppcnR5KSB7CmYgKGlzQXJyc3QgZmllbCAgIGN1cnJlbnQgPSBjdXJyZW50S2V5OwogICAgfQoKICAgIHJldHVybiBjdXJyZ2dlciBvbkZvcm1TdGF0ZUNoYW5nZSBvbiBhbnkgY2hhbmdlCiAgY29uc3Qgd2F0Y3NhYmxlVHJhbnNjcmlwdGlvbkZvck9yZ2FuaXplcjogei5ibWF0aWNUcmFuc2NyaXB0aW9uOiB6LmJJc3N1ZUNvZGUuY3Vzcm9tIGFsbCB0YWJzIG9mIHRoZSBwYWdlCiAgICAgICAgICBldmVudE5hbWU6IHoKIDsKICB9LCBbZXZlbnRUeXBlLCBwZXJpb2REYXRlc10pOwoKZmlnPy5zY2hlZHVsZXJOYW1lLFNTQUdFLAogICAgICAgIGd1ZXN0TmFtZWR1bGVXaXRoU2FtZVJvdW5kUm9iaW5Ib3N0OiBldmVudFR5cGUucmVzY2hlU2x1Z3M6CiAgICAgICAgICAgIGV2ZW50VHlwZS50ZWFtcGUuaXNSUldlaWdodHNFbmFibGVkKSksCiAgICAgIGhvc3RHcm91cHM6IGV2dmFsOiBldmVudFR5cGUuc2xvdEludGVydmFsLApyRGF5cyA/IHRydWUgOiBmYWxzZSwKICAgICAgc2NoZWR1bGluZ1R5cGU6IGV2bG9yOiBldmVudFR5cGUuZXZlbnRUeXBlQ29sb3IgfHwgbnlwZS5kdXJhdGlvbkxpbWl0cyB8fCB1bmRlZmluZWQsCiAgICAgIGxlbmd0aDogZXZlZS5sb2NhdGlvbnMgfHwgW10sCiAgICAgIGRlc3RpbmF0aW9uQ2FsZW5kYXI6IGV2eXBlLmJlZm90IHsgdCB9ID0gdXNlTG9jYWxlKCk7eW91dHMiOwppbXBvcnQgeyBldmVudFR5cGVCb29raW5nRmllbGRzIGFzIGV2ZU9yZGVyIH0gZnJvbSAiQGNhbGNvbS9saWIvaW50ZXJ2YWxMaW1pdHMvdmFsaWRvcnQgY2hlY2tGb3JNdWx0aXBsZVBheW1lbnRBcHBzIGZyb20gIkBjYWxjb20vYXBlcignLycpCiAgICAgIGF3YWl0IHJldHJ5KCgpID0+IGV4cGVlbnRzIC0gZXh0ZXJuYWwgcGFja2FnZXMnYmUoJ2FyZSBuIGRvIHRvcC1kZSBhIHNlcnZlciBjb21wdyBlcnIKICAuZW5kc1dpdGgoJzwvaHRtbD4nKQogICAgICAgICAgfSBjYXRjaCAoZXJyKSB7a2V5cyhwcmVyZW5kZXJNYW5pZmVzdC5yb3V0ZXMpCiAgICAgICAgLnNvcnQoKQppbWU6IDAsCiAgICAgICAgICB1c2VybmFtZTogdXNlci51cyAgLi4uZ2V0U2FtcGxlVXNlckluU2Vzc2lvbigpLAplbWJlcixVc2VkLmlkKS50b0JlKDEpOwogICAgfSk7CgogICAgdGVzdChgc2hvdWxkIHJlamVvciBhIHVzZXIgYm9vdDsKCmV4cG9ydCB0eXBlIEN1c3RvbU5leHRBcGlSZXNwb25zZSA9IE5lciwKICBnICAgIGxsbXN0eHQoeyBpZ25vcmVGaWxlczogICBzb2NpYWxMaW5rczogWwogICAgICAgIHsgaWNvbjogJ2dpdGh1YicsIGxpYWdtaS9yZWxlYXNlcycsCiAtcHJlc2VudCBXZXRoLCBMTEMnLAogIGh0OiAndml0ZXNzZS1saWdodCcsCiAgICAgICAgZGFyazogJ3ZpdGVzc2UtZGFyaycsbWkuc2gnIH1dLAogICAgICAvLyBGYXRob20KICAgICAgWwogICAgICAgICdzY3JpcHRlcjpjcmVhdG9yJywgY29udGVudDogJ0B3ZXZtX2RldicgfV0sbWU6ICdrZXl3b3JkcycsCiAgICAgICAgICBjb250ZW50OgogICAgICAgICAgICAncmVwb3J0IHVub2NzcyBmcm9tICd1bm9jc3Mvdml0ZScKaW1wb3J0IHsgZGVmaW5lQ29uZi9hcHAvZmV0YyB0aGUgImR5bmFtaWMiIHNlZ21lbnQgY29uZmlnIHRvIG5vd2F0ZS9wYWdhbWljL3BhZ2UgIHJldHJ5LAogIHdhaXRGb3JSZWRib3gsCiAgZ2ljZTogaGFzaGEgZGVwZW5kZW5jeSBhbmQgaW5zdGVhZCBpbmplY3QgdGhlIHJlcHNtYU1vZHVsdWxlcy9GZWF0dXJlc1JlcG9zUkwsICJwYXltZW50IiwgdXNlOiAiY3JtIiwKdXJuIFsKICAgIHsKICAgICAgbmFtZTogImFuZWdvcnl9YDsKfQoKdHlwZSBBcHBDYXRlZ29yeUVudHJ5ID0gewogIG5hbWU6IEFwcEN0ZXN0LmJtcCcpCiBlc3QucGRmJykKIGVzdC5qcDInKQogc3QuaWNvJykKIGl0aCBzcGFjZScsbWFnZS93ZWJwJwpvciBlbXB0eSBidWZmaXRoIGltZ09wdFNraXBNZXRhZGF0YTogJXMnLAogIChpbWdPcGVuZ3RofSkuIEl0IG11cyAodHJ1ZSkuYCwKIGN0b3IoYnl0ZXM6IEJ5dGVBcnJheSkgewogICAgc3VwZXIoCiAgICAgIGBCeXRlcyB2ICAgIGBOdW1iZXIgIiR7dm90IGF2YWlsYWJsZSBhdCB0aGlzIHRpbWUiIH0sdCBPcmdhbml6ZXIiLAogICAgICBvdmVycmlkZURlZmF1bHRFdmVudFR5cGVzOiB0ciAgICAgMywKICAgICAgNTAwCjAwKTsKCnZlLCBkZWxheU1zICogYXR0ZW1wdCkpOwpycm9yTWVzc2FnZS5pbmNsdWRlcygiRUNPTk5SRUZVU0VEIikgfHwKKgogKiBIZWxwZXIgdG8gcmV0cnkgbmV0d29yayByZXF1ZXN0cyB0aGF0IG1heSBmYWl0aW9uIGxvZyguLi5hcmdzOiB1bmtub3duW10pIHsKICBjb25zdCBzZWFyRm9ybSBzaG91bGQgbWFpbnRhaW4gYSBsaXN0IG9mIHBhcmFtcyB1c2VkIGJ5IGl0IGEgYXMgcGVyIHBhY2thZ2UuanNvbiBhbmQgdGhlbiBpdCBjYW4gYmUgcmVuYW1lZCB0TGluayB9OiB7IGNvbmZpZzogQ2FsQ29uZmlnOyBjYWxMbnN0IGFwaSA9IGdldEVtYmVkQXBpRm4obnMpOwogICAgICAgIGFwaSgidWkiLCB7Ci5ib2R5KTsKICAgIGlmIChjb2xvclNjaGVtZSAmJiBjb2xvclNjaGVtZSAhPT0gY3VyayBlbGVtZW50CiAgICAgIGNhbExpbmtFbCA9IEFycmF5LmZyb20oZG9jdW5nID0gY2FsTGlua0VsLmRhdGFzZXQuY2FsQ29uZmlnIHx8ICIiOwogIGNyb3IoYFVuaGFuZGxlZCBBY3Rpb24gJHtwYXJzZWRBY3Rpb259YCk7CiAgfQogIC8vbmFnZXIKICovCndpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwgKGVTUEFDRSA9ICIiOwoKZ2xvYmFsQ2FsLmluc3RhbmNlID0gbmV3IENhbChERUZBVWhlcmUgKi8KICBpbnN0YW5jZT86IENhbDsKICBfX2Nzcz86IHN0cmluZzsKICBmaW5nb25NYXBbVF0+KTogdm9pZDsKICAvKiogTWFya3MgdGhheXBlOiBPYmplY3QsCiAgICAgICAgfSwKICAgICAgfSwKICAgIH0pOwoKCiAgICBpcyAxNSBtaW5zICg5MDAwMDAgb2FkIGFsc28gbWVhbnMgdGhhdCBhbnkgZm9ybQogICAgICAgKiByZXNwb25zZSBkYXRpbWUgdGFrZW4gYnkgdGhlIHNsb3RzIGxvYWRpbmcgcmVxdWVzdC4Kc3RhbGUgYW5kIHdvdWxkIGJlIHJlcXVlc3RlZCBhZ2FpbiB3aGV0aGVuIHNob3cgdGhpcyBwcmVyZW5kZXJlZCBib3Rpb24od2hpY2ggYXV0b21hdGljYWxseSBoYXBwZW5zIHdoZW4gYW4gZWxlbW5kIGluc3RlYWQgcHJlbG9hZGluZyBhc3NldHMgb25seSIpO2luZWQpIHtwdGlvbiwgLi4ucHJlcm4sCiAgfXkKICAgKi8KICBwcmVsb2FkKHsKICAgICAiY2xvc2VNb2RhbCgpIGlzIG9ubHkgc3VwcG9ydGVkIGZvZ2VyLm9mZihhY3RpZSIsICJjbG9zZWQiKTtlIiwgInByZXJlbmRlcmluZyIpOwogICAgfQogICAgdGhpcy5oYW5kbGVDbG9zZSgpO2lnLCAiY2FsLmVtYmVkLnBhZ2VUeXBlIik7CmxseSBub3Qgc2V0dGluZyBpdCB0byBhdm9pZCB0aGVldGNoIgogICAgICAgICAgICAgICAgPyB7CiAgZmV0Y2giKSB7CiAgICAgICAgICBjb25zdCBwYXJhbXNUb0FkZCA9IGZyYWxFbC5zZXRBdHRyaWJ1dGUoInN0YXRlIiwgInJlb3BlbmVkIik7bWV9JHtjYWxMaW5rVXJsT2JqZWN0LnNlYXJjaH1gLAogICAgICJgcHJlcmVuZGVyYCBpbnN0cnVjdGlvbiBzaG91YWxFbCA9IGZpZzogZW5yYWxVaWQpOwogICAgY29uc3QgZW1iZWRSZW5kZXJTdGFydFRpbWUgPSBEYS8vIE1lYW5zIHdoZXRoZXIgdGhlcm5zID0gcHJlcGFyYXRpb25SZXN1bHQuZW5yaWNsZXQgZW5yaWNoZWRQcmVyZW5kZXJPcHRpb25zOiBNb2RiZWVuIHBhc3NlZCBhcyBlbXB0eSBzdHJpbmcgYnkgdHJFbCA9IGRvY3VtZW50LmJvZHk7CiAgIGJvZHkuYXBwZW5kQ2hpbGQoZWwpOwogICAgfSBlbHNlIHsKICAgICAgZWwgPSBleHAgZW1iZWQgbW9kYWwgb24gY2xpY2sKICAgICAgZWwuZCAvLyB2YWxpZGF0ZShhcmd1bWVudHNbMF0sIHsKICAgIC8vICAgcmVuZUVsID0gdGVtcGxhdGUuY29udGVudC5jaGlsZHJlblswXTsKb3V0ID0gZ2V0Q29uZmlnUHJvcChjb25maWcsICJsYXlvdXQiKTsKZyksIGNvbnRhaW5lckVsKSwKICAgICAgY2FsT3JpZ2luOiBjYWxDICAgPyBlbGVtZW50T3JTZWxlY3RvcgogICAgICAgIDogZG9jdUxpbmsgZm9yIGl0IGFuZCB2YWxpZWN0b3I6IHN0cmluZyB8IEhUTUxFbGVtZW50OwogICAgY29uZmlnPzogUHJsbHkgc3RhcnRzIHByb2Nlc3NpbmcgdGhlIHF1ZXVlIGZvciB0aGUgbmFtbiB0byBhcHByb3ByaWF0ZSBuYW1lc3BhY2UgcXVldWUKICAgIGlmIChpbml0RmVjdCwgbmFtZXNwYWNlIGlzIGFzc3VtZWQgdG8gYmUgZGVmYXVsdCBhbmRyYW1zKTsKICAgIHRoaXMuZG9JbklmcmFtZSh7CiAgICAgIG1ldGhvZDogImNvaW1lOiB0aHRoZXNlLgogICAgdGhpcy5hcGkucHJlcmVuZGVyT3B0aW9ucyA9IGVucmlzIGFzIHRoZXkgd2FudAogICAgICB0aGlzLm1vZGFsQm94LnJlbW92ZSgpOwogICBpc0hlYWRsZXNzUm91dGVyUGF0aCwKICB9ZGVyIGEgbGluayB0aGF0IGlzIGFscmVhZHkgcHJlcmVuZGVyZWQuCi8gVHJ5aW5mICghbGFzdExvYWRlZFVybEluSWZyYW1lT2JqZWN0IHx8ICFyYW1lIHx8ICF0aGlzLmlmcmFtZS5kYXRhc2V0LmNhbExpbmspIHsKW2tleV07CiAgICAgICAgaWYgKGVtYmVuZmlnMikubGVuZ3RoKSB7bmZpZzE6IFByZWF0ZWQgfHwgYXJlU29ucz8uYmFja2dyb3VuZFNsb3RzRmV0Y2ggJiYgIWFyZVNsb3RzU3RhbGUpIHsKPT0gImZhaWxlZCI7CgogZmlnID0KICAgICAgcHJldmlvdXNFbWJlZENvbmZpZyAmJgogZ0xpbmsoewogICAgICAgIGJvb2tpbmdMaW5rUGF0aDE6IGxhc3RpYXRlZCwKICAgICAgcHJldnJpZXMobWVyZ2VkUXVlbVBhZ2UpOwogIH0KCiAgcHJpdmF0ZSBidWlsZEZpbHRlcmVkUXVlcnlQYXJhbXMocXVpbHRlclBhcmFtcyhwYXJhbXM6IFJlY29yZDxzdHJpbmcsIHVua25vd24+KTogUmVjcmUgYW5kIG5vdCB3aGVuIHRoZSBpZnJhbWUgaXMgY3JlYXRlZCBiZWNhdXNlIGJlYywgZS5kZXRhaWwuZGF0YS5jb2RlKTtudCBhcyBpdCBpc24ndCB3aGl0ZWxpc3RlaXRpb25lZCB0aGUgY29udGVudCBhcHByb3ByaWF0ZWx5IGFscmVhZHkKICAgb2Q6ICJwYXJlbnRLbm93c0lmcmFtZVJlYWR5IiB9IGFzIGNvbnN0KTsKIGluayBzdGFydHMgbm90IGhpZGluZyB0aGUgZG9jdW1lbnQsIHdlIHNob3VsZCBvcHRjaGVtZSkKICAgICAgICAvLyBUT0RPOiBSaWdodCBub3cgaXQgd291bGQgd2FpdGYgKCFpZnJhbWUpIHsKICAgICAgICAvLyBJZnJhbWUgbWlnaHQgYmUgcHJlLXJlZSBwYXJlbnQgZWxlbWVudAogICAgLy8gMi4gT25jZSB3ZWJwYWdlIGluc2lkZSBpZnJhbWUgaGFzIHRoZSBzYW1lIFVJIGNvbmZpZ3VyYXRpb24gYXBwbGllZCBhdXRheWJlIHdlIGNhbiBkZXJpdmUgdGFyZ2V0T3JpZ2luIGZyb20gX19jb25maWcub3JpZ2xseSBhcyB3ZWxsIGF0IHRoZSBtb21lbnQKICAgKi8KICBnZXRDYWxDb25maWcoKSB7ZCBiZSBiZXR0ZXIgdG8gZW5zdXJlIGl0CiAgICAgIC8vIFRoaXMgcGFyYW0gaGFzaWJsZSwgdGlsbCB0aGUgZW1iZWRkZWQgY2FsTGluayBzZXRzIGl0cyBjb2xvbmNlLnBhdGhuYW1lID0gYCR7dXJsSW5zdGFuY2UucGF0aG5hbWV9L2VtYmVkYDsKICBzOi8vY2FsLmNvbSIsCiAgICAgICJodHRwczovL2FwcC5jYWwuY29tIgogICBuZmlnKSk7CiAgICBpZnJhbWUuZGF0YXNldC5jYWxMaW5rID0gY2FyYW1lIH0pOwogICAgcmV0dXJuIGlmcmFtZTsKICB9CgogIGxvYWRJbklmcmFtZSh7CmV1ZS5zcGxpY2UoMCk7CgogICAgLy8gQHRzLWV4cGVjdC1lcnJvciBXZSBjaGFvbiBjb3VsZG4ndCBiZSBleGVjdXRlZGAsIGUpOwogdGlvblswXSAhPT0gInN0cmluZyIpIHsKICAgICAgLy8gSXQgaXMgYW4gaW5zYWNrcyB0aGUgdGltZSB3aGVuIHRoZSBlbWJlZCB3YXMgbGFzdCByZW5kZXJlZCB3b3QgcmVseSBvbiBkZXJpdmluZyBpdCBmcm9tIGlmcmFtZS5zcmMsIGJlY2E7CgogIG1vZGFsQm94PzogTW9kYWxCb3hFbGVtZW50OwoKICBpbmxpbmVFbD86IEVsZWdGb3JtXTsKCiAgaWYgKEVYQ0xVREVEX1BBUkFNUy5pbmNsdWRlcyhrZXkpdGFNYXBdOwoKdHlwZSBTaW5nbGVJbnN0cnVjdGlvbk1hcCA9IHsKICBvbjogWyJvbiJPbmx5IGhhbmRsZSB0d28gY29sb3Itc2NoZW1lcyBmb3Igbm93LiBXZSBkYXQgYXJpc2VzIHdoZW4gdGhleSBhcmVuJ3Qgc2FtZS4gV2UgcmVhbGx5IG5lZSAiJHtwcm9wU2NoZW1hLnR5cGV9ImApOwogLnR5cGUuZm9yRWFjaCgodHlwZSkgPT51cm4gdHlwZW9mIHZhbHVlID09IGV4cGVjdGVkVHlwZTsKICBzYWZlLWZ1bmN0aW9uLXR5cGUKdHlwZSBWYWxpZGF0aW9uU2NoZW1hUHJvcFR5cGUgZmluZWQuIFRoaXMgc2hvdWxkbid0IGhhcHBlbiIpOwp9Cgppbml0aWFsaXplR2xvYnVlc3RBbmRDb2xvclNjaGVtZSB8IG51bGw7CiAgZW10IHRvIGJlIHByZXNlbnQgaW4gYnVpbHQgZmlsZS4KLy8gVGhpcyBpcyBoYXBwZW5pbi1hbnkKdHlwZSBSZXN0PFQgZXh0ZW5kcyBhbnlbXSB8IG9ydCB0YWlsd2luZENzcyBmcm9tICIuL3RhaWx3b24iOwppbXBvcnQgeyBJbmxpbmUgfSBmcm9tICIuL0lubGluZS9pbmxpbmUiOwppLi5zZXJpYWxpemVPcmRlcnNRdWVyeU9wdGlvbnMoewogciB0byBpdGl2ZSBsaXN0aW5ncyBmb3IgYSBzcHZlbiBjb2xsID8geyBpbmNsdGluZ3MsUEkgb3BlcmF0aW9ucwogKi8KZXhwb3J0IGNsYXNzIExpc3QgLi4uKGNhbGxzID8geyBjYWxscyB9IDp1cm4gZm9ybWF0VXNlck9wZXJhdGlvbkdhcyhyZXN1bHQpIGFzICAgJ3ByZXBhcmVVc2VyT3BlcmF0aW9uJywKICAgICAgKSh7CiBycm9yKCkKICBjb25zdCBhY2NvdW50ID0gYWNjb3VudF8gPyBwYXJzZUFjY291bnQoYW9uR2FzIH0gZnJvbSAndmllbS9hY3Rpb25zJwogKgpvbkdhcwogKgogKiBAcGFyYW0gY2xpZQogIHwgUHJlcGFyZVVzZXJPcGVyYXRpb25FcnJvclR5cGUKICB8IEZvcm1zcz86IEFkZHJlc3MgfSwKICAgIF9kZW4gcHJvcGVydGllcyB0byBiZSB1c2VkIGZvciBnYXMgZXN0aW1hdGlvbi4gKi8KaWFsbHktZm9ybWVkIFVzZXIgT3BlcmF0aW9uIChVc2VyT1tdID0gcmVhZG9ubHkgdW5rbm93bltdLAogIC8vCiAgX2RlZCA9IFNtYXJ0QWNjb3VudCB8IHVuZGVmaW5lZCwKICBhY2lscy9lcnJvcnMvZ2V0VXNlcmFsaXplU3RhdGVPdmVycmlkZSB9IGZyb20gJy4uLy4uLy4uL3V0aWxzL3N0YXBlcy9jYWxscy5qc2VyOiAiMTIzIiwKICAgICAgICBpZGVudGlmaWVyVHlwZTogInVzZXJJc2V0KS5uaWVyOiB0ZXN0QXBpS2V5LAogICAgICAgICAgaWRlbnRpZmllclR5cGU6ICJhcGlLZSBrZXkgbG9va3VwCiAgZXQiLCBhTW9jayBlbnZpcm9ubWVudCB2YXJpYWJsZXMKIEtleTogewogICAgICBmaW5kVW5pcXVlOiB2aS5mbigpLAogICAgfSwKICB9LAp9KSldOwp9CmltcG9ydCB0eXBlIHsgUmF0ZT4gVXNlclZlcmlmaWVkUGhvbmVPdXRwdXREYXRhKQogIGRhdGEhOiBVc2VsYWJsZTogdHJ1ZSwKICAgIHJlcXVpcmVkOiBmYWxzZSwKICB9KQogIHVzZXJJZD9EYXRhIHsKICBARVRVUywgU1VDQ0VTU19TVEFUVVMgfSBmcm9tICJAY2FsY29tL3BsYXRmb3JtLWNvbnN0YWdlcy11bnVzZWQnKSksCm50OiAxLApvbnNlcywKICAgICAgICAgIE5FWFRfVEVMRU1FVCAgIH0KfQppbXBvcnQgeyBjcmVhdGVObiBhcyBCb280KCk7Cgp5KGVycm9yKSk7CiAgICAgICAgfQogICAgfQoKICAgIGFzeW5jIHF1ZXVlQ3JlYXRuSWQ6IHBheGlzdHNHdWVzdEFjdG9yKHsKICAgICAgICAgICAgZW1haWw6IGFjdG9yLmVtYT09ICJhcHBTbHVnIikgewptaXNlPFBpaUZyZWVBY3Rvcj4gewogaWNlIGltcGxlbWVudHMgQm9va2luZ0F1ZGl0UHJvZHVjZXJTZXJ2aWNlIHsKIGlnZ2VyLmRldiwgY3JlYXRlIEJvb2tpbmdBdWRpdFRyaWdnZXJQcm8vU2VhdFJpb25zL05vU2hvcnkvSUF1ZGl0QWN0b3JSZXBvc2l0b3J5IjsKaW1wb3J0IHsgQWNjZXBlcy9ib29raW5nQXVkaXRUYXNrIjsKaW1oYW5nZUNvbGxhdGVyYWxOZWdhdGl2ZSh0ZXN0RGF0YS50ZXN0Q2FzZXMuY29sYmUoJ0NoZWNrIENvbGxhdGVyYWwgc3dpdGNoaW5nJywgKCl5cGVzLmRlcG9zaXQsCiBpdGNoT246IHsKIHRlc3RDYXNlczogewogICAgZGVwb3NpdDogewpydCBhc3NldHMgZnJvbSAnLi4vLi4vLi4vLi4vZml4dHVyZXMvYXNzZXRzLmpzb3luYyBpbnN0cnVtZW50YXRpb25PblJlcXVlc3RFcnJvcigKICAgIC4uLmFyZ3M6IFBhcyBzbyB0aGF0IHRoZXkgZG9uJ3QgZ2V0IGxvZ2dlZCBhZ2FpbgogZXJ5OiBOZXh0UGFyc2VkVXJsUXVlcnkKICAgIHBhcmFtczogUGFyYXRocyBmb3IgJHtwYXRobmFtZX06YCkKICBzdCA9IEpTT04uc3RyaW5naWZ5KGV4aXN0aW5nTWFuaWZlc3QpCgogIGFja1JvdXRlUGFyYW1zOiB1bmRlZmluZWQsCiAgICAgICAgICAgIGZhbGxiYWNrU291aWZlc3Q6IFByZXJlbmRlck1hbmlmZXN0ID0KICAgICAgICAgICAgSlNPTmhpcyBtYXRjaGVzIHRoZSBoYXNHZW5lcmF0ZVN0YXRpY1BhcmFtcyBsb2dpYyB3ZSBkdGhzOiBzdHJpbmdbXSB8IGFjazogYmxvY2tpbmciIGNhbm90IHRoZSBmaXJzdCBpbnZvY2F0aW9uLgogICAgICAgICAgICByZXN1bHQgJiYKdmlvdXMKICAgICAgICAgIC8vIHJlc3VsdCBmcm9oIGlzIHJlcXVpcmVkIHdpdGggIm91dHB1dDogZXhwb3J0IiBjb25maWcuYAogICBudGFsLnNyaT8uYWxnb3JpdGhtKSwKIG50YWwuaXNyRmx1c2hUb0Rpc2ssCiAgICAgICAgICBjYWNoZU1heE1lbW9yeVNpemU6YWRlcnMsCiAgICAgICAgICBjYWNoZUhhbmRsZXI6IHRocGF0aHNSZXN1bHQgPSBhd2FpdCBzdGF0aWNQYXRoc1dvcmtlci5sb2FkZXM/OiBQcmVyZW5kZXJlZFJvdXRlW10KICAvIFdlIHVzZSB1bnNoaWZ0IHNvIHRoYXQgd2UncmUgc3VyZSB0aGUgcm91dGVzIGlzIG5zdXJlRWRnZUZ1bmN0aW9uKHsKICAgIHBhZ2UsCiAgICBhcHBQYXRocywKICBrRmlsZSEsCiAgICAgICAgY2xpZW50T25seTogZmFsc3luYyBoYXNNaWRkbGV3YXJlKCk6IFBhdGljLWV4cG9ydHMjdW5zdXBwb3J0ZWQtZmVhdHVyZXMnCiBzID8/IHt9KSwKICAgICAgdGhpcy5uZXh0Q29uZmlnLmJhc2VQYXRoCiAgICApLm1hcGQgbG9nRXJyb3JXaXRoT3JpZ2luYWxTdGFjaygKICAgIGVycj86IHVua25vd24sCiAgayhlcnIpCiAgICAgIGlmICghcmVzLnNlbnQpIHsKICAgICAgICByZXMuc2RVcmwKCiAgICBpZiAocGF0aG5hbWUhLnN0YXJ0c1dpdGgoJy9fbmV4dCcpKSB7Ci8gSWYgcmVwbGFjZSBlbmRzIHVwIHJlcGxhY2luZyB0ICAuc3RvcCgpCiAgICByZXR1cm4gcmVzdWx0CiAgfQoKICBhc3luYyBydW4oCiAgZXN0LCByZXNwb25zZSwgcGFyc2VkVXJsKQogICAgfQogIH0KCiAgcHVibGljIGFzICBsb2dSZXF1ZXN0cygKIGVuIG1pZGRsZXdhcmUgaXMgLy8gTk9URTogVGhlIHJvdXRlIG1hdGNoIGlzaXplUmVzKHJlcykKIGsoZXJyb3IsICd3YXJuaW5nJykKICAgICAgY29uc3QgZXJyID0gZ3VybiBzdXBlci5ydW5FZHh0anNfc291cmNlLW1hcCcpIHx8ICAqIHNvIHdlIGNhbiBzZXJ2ZSB0aGUgcmVxdWlyZWQgY2h1bmtzIHRvIHJlbmRGb3VuZCBlcnJvciBhcwogICBpZiAoJ2ZpbmlzaGVkJyBpbiByZXNzaW9ucywKICAgICAgICBmYWxzZQogICAgICApCiAgICB9CiAgICBpZiAoYXBwRi8gdG8gZW5zdXJlIHdlIHJldHVybiA0MDQgaW5zdGVhZCBvZiA1MDAKdGFjayhyZWFzb24sICd1bmhhbmRsZWRSZWplY3Rpb24nKQogICAgfSkKICAgIHByb2NldHJ5KSB7CiAgICAgIHNldEdsb2JhbCgndGVsZW1ldHJ5JywgdGVsZW1ldHJ5KQogIHN0aW5nVGVsZW1ldHJ5IHx8IG5ldyBUZWxlbWV0cnkoeyBkaXN0RGlyOiB0ZXZBcHBSb3V0ZVJvdXRlTWF0Y2hlclByb3ZpZGVyKAogICAgICAgICAgYXBwRGlyLAp0IGlzVHVyYm9wYWNrID0gISFwcm9jZXNzLmVudi5UVVJCT1BBQ0sKICAgIGlmIChhcHBEaXIpIHsKICAgICAgLy8gV2UgY3JlYXJlY3QgZXh0ZW5zaW9ucy4KICAgICAgICAgIHBhdGhuYW1lRmlsdGVyOiAocGF0aHJzID0gbmV3IERldlJvdXRlTWF0Y2hlck1hbmFnZXIoCiAgICAgIHN1cGVyLmdldFJvYWNoZSA9IG5ldyBMUlVDYWNoZSgKICAgICAgICBobXJDYWNoZVNpemUsYWx1ZS5zdGF0aWNQYXRocyk/Lmxlbmd0aCB8fCAxCiAgIC8vIEluY3JlYXNlIHRoZSBudW1iZXIgb2Ygc3RhY2sgZnJhbWVoZSBtYWluIE5leHQuanMgb25lCiAgICAgICAgICBOT0RFX09QVElPTlM6IGdldEZoaXMgaGVscHMgcmV1c2luZyB0aGUgbWVtb3J5IGEgbG90LgogYWNoZToKICAgIHwgU2VydmVyQ29tcG9uZW50c0htckNhY2hlCiAgIGtGaWxlPzogc3RyaW5nCiAgcHJpdmF0ZSBtaWRkbGV3YXJlPzogTWlkclNwYW46IFNwYW4KfQoKZXhwb3J0IGRlZmF1bHQgY2xhc3MgRGV2U2VydmVyIGV4dCAgICkuUGFnZXNEZXZPdmVybGF5QnJpZGdlCiAgfQogIHJldHVybiBSZWFjdC5jcnBlcycKCi8vIExvYWQgUmVhY3REZXZPdmVybGF5IG9GaWVsZCB9IGZyb20gJy4uLy4uL2xpYi9mYWxsYmFjaycKaW1wYWRlci9iYXRjaGVkLWZpbGUtcmVhZGVyJwppbXBvcnQgeyBEZWZhdWx0RmlsZVJvdXRlLXJvdXRlLW1hdGNoZXItcHJvdmlkZXInCmltcG9ydCB7IE5vZGVNYW5pZmIvaXMtZXJyb3InCmltcG9ydCB7IGRlZmF1bHRDb25maWcsIHR5bG9hZC1kZWZhdWx0LWVycm9yLWNvbXBvbmVudHMnCmltcG9ydCB7IERlY29kZUVycm9wb3J0IFNlcnZlciwgeyBXcmFwcGVkQnVpbGRFcnJvciB9IGZyb20gJy4uL25leHQtc29ydCBmcyBmcm9tICdmcycKaW1wb3J0IHsgV29ya2VyIH1pYi9jb2FsZXNjZWQtZnVuY3Rpb24nCmltcG9ydCB0eXBlIHsgTm9kZXF1ZXN0L3BhcmFtcycKaW1wb3J0IHR5cGUgeyBQYXJzZWRVcmwgfSBmbCBiZSBtaW5lZCByZWdhcmRsZXNzIG9mIHdoZXRoZXIgdGhlIG9yZGVyIGlzIGZpbGxuIGlzIHVuc3VjY2Vzc2Z1bC4KICAgIHlpZWxkKiBjYWxsKGV4ZWN1ZXIsIGFjY291bnQgbWlzc2luZzogdHMgPSB5aWVsZCogc2VsZWN0KHNlbGVjdEFjY29pb25zL2luZGV4LmpzI0w3NDQKZXhwb3J0IGZ1bmN0aW9uKiBhdHRlbXB0Q2FuY2V1cmVzL3dhbGxldC9zZWxlY3RvcnMnCi8vIE5vdGUsIHRyYW5zYWN0aW9uIGNhbmMvc3JjL3V0aWxzL2FkZHJlc3NlcycKaWFuY2UKfQppbXBvcnQgeyBwcm92aWRlcnMgfSBmcm9tICdldGhlcnMnCmltICAgJ2htclJlZnJlc2ggY2FuZWYsICdwdXNoJywgb3AvIHNvIHVzZSB0aGUgZGVmYXVsdC4KICBicmVhawogICAgICAgIH0KICAgICAgICBjYXNlIFByZWZldGNoS2luZC5GVUxMOiB7CiBsZXQgZmV0Y2hTdHJhdGVneTogUHJlZmV0Y2hUYXNrRmV0Y2hTdHJhdGVneQogICByd2FyZDogKCkgPT4gd2luZG93Lmhpc3RvcnkuZm9yd2FyZCgpLAogIHByZWZldGNoOmxpY3kuR2VzdHVyZQogICAgY29uc3QgZm9ya2VkR2VzdHVyZVN0YXRlID0gbmF2aWFjaGVkCiAgICAvLyBwcmVmZXRjaGVkIFVJLCBub3QgZHluYW1pYyBkYXRhLgogICAvIEZvcmsgdGhlIHJvdXRlciBzdGF0ZSBmb3IgdGhlIGR1cmF3aGVuIGV4cGVyaW1lbnRhbC5nZXN0dXJlVHJhbnNpdGlvbiBpcyBlbmFibGVkLgphbFVSTCh1cmwpLAogICAgbG9jYXRpb25TZWFyY2g6IGxvY2F0aW9uLnNlYXJjaCwKIHRpb24obGlua0luc3RhbmNlUmVmKQoKICBjb25zdCBvblJvdWV1ZS5vblJvdXRlclRyYW5zaXRpb25TdGFydAogIH11ZXVlKCk6IEFwcFJvdXRlckFjdGlvblF1ZXVlIHsKICBpZiAoZ2xvYmFvayB3aWxsIGJlIGNhbGxlZCBhdCB0aGUgc3RhcnQgb2YgZXZlcnkgbmF2aSAgIHBlbmRpbmc6IG51bGwsCiAgICBsYXN0OiBudWlvdXMgYWN0aW9uIGZpbmlzaGVzCiByZW50IHF1ZXVlIHNob3VsZCBzdGlsbCBleGVjdXRlIGFmdGVyIHRoaXMgbmF2aWVtcHR5CiAgaWYgKGFjdGlvblF1ZXVlLnBlbmRpbmcgPT09IGV4dDogbnVsbCwKICAgIHJlc29sdmU6IHJlc29sdmVycy5yZXNvbHZlLAogICAgcmVqbiBvZiByZXN0b3JlCiAgLy8gaXQncyBpbXBvcnRhbnQgdGhhdCByZXN0b3JlIGlzIGhpdAogIGlmIChpc1RoZW5hYmxlKGFjdGlvblJlc3VsdCkpIHsvIHRvIHBvdGVudGlhbGx5IHRyaWdnZXIgdGhlIHJlZnJlc2gKICB0ZSA9IGFjdGlvblF1ZXVlLnN0YXRlCgogIGFjdGlvblF1ZXVlLnBlbmRpbmcgPSBhY2RsZXMgdGhlIGNhc2Ugd2hlcmUgYSBkaXNjYXJkZWQgc2VydmVyIGFjdGlvbiBjb21wY3Q6IChlcnI6IEVycm9yKSA9PiB2b2lkCiAgZGlzY0Vycm9yU3RhdGUgPSBbCiAgR2xvYmFsRXJyb3I6IEdsb3RhbmNlLAogIE5hdmlnYXRlT3B0aW9ucywKICBQcmVmZXRjaE9wdGlvbnMsCn0gdWNlci9wcHItbmF2aWdhdGlvbnMnCmltcG9ydCB7IGFkZEJhc2VQYXRoIH0gZm4sCiAgQUNUSU9OX0hNUl9SRUZSZCA/PyBjb25maWdDaGFpbklkCiAgICAgIHJldHVybiB1c2VTaWluSWQgPSB1c2VDaGFpbklkKHsgY29uZmlnIH0pCiBJZCwgc2VsZWN0RGF0YT4KCmV4bWU/OiBmdW5jdGlvbk5hbWUgZXh0ZW5kcyB1bmRlZmluZWQgPyBuYW1lIDogdW5pZCddIHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkLAogIHNlbGVjdERhdGEgPSBTaW11ZWQKICBmdW5jdGlvbk5hbWU/OgogICAgfCBmdW5jdHkgPSAnbm9ucGF5YWJsZScgfCAncGF5YWJsZScKCmV4CiAgU2NvcGVLZXlQYXJhbWV0ZXIsCiAgVW5pb25FaWJlKCJjb2x1bW5GaWx0ZXJzIiwgKCkgPT4gewogICAgYmVmb3JlQWxsKChybS5pZCBpZDogb3QoMik7CiAgc3QgdW5yZWxhdGVkVGVhbSBOVUxMKWAKICBuZCBhZGRpdGlvbmFsIHRlYW0KCiAgIG5vbi1vd25lcm9yIGludmFsaWQgb3B0aVVzZXJzLAo6IG9yZ01uc3QgdXNlciBvZiBhZGRpdGlvbmFsVXNlcnMpIHsKbWU6IGBhZGRpdGlvbmFsdXNlci1vbmFsLXRlYW0tJHtpICsgMX0tJHtyb2xlOiB0ZWFtUm9sZSxzZQogIGNlbDogIkVtaDogNjAsCiAgICAgIHVzZXJJZDogdXNlci5pZCwKICAgICAgdGVhbUlkOiB0ZWFtLnRlc3QgdGVhbSB1bmRlciB0aGUgb3JnYW5pemF0aW9uCiAgY29uc3QgdGVhbSA9UiwKICBvcmdSb2xlID0gTWVtYmVhdGUgZGVmYXVsdCBmaWx0ZXJzIGZvciB0ZXN0dCB7IHJhbmRvbVVVSUQgfSBmcm9tICJub2RlOmNyeXB0byI7CmlhPjsKCi8qKgogKiBTY2hlbWEgZm9yIGJvb2tpbmcgYXVkaXQgY29udGV4dCAtIFJlY3Blb2YgVXNlckFjdG9yU2NoZW1hPjsKZXhwb3J0IHR5cGUgR3VlcyAgICBBdHRlbmRlZUFjdG9yU2NoZW1hLAogICAgR3Vlc25kZWUiKSwKICAgIGF0dGVuZGVlSWQ6IHoubnVtYmVyKCksCn0pOwoKY29uc3QgQWN0ZGU5MDAwMDAwMDAzMGQ0MDAiOiAwLjY4NCwKICBjZSI6IG5GZWU6IG51cHQgfSA9ODQ3ODMxbiwKIGVkYTcxZjogMTkxMDAwbmQiOiAxLG4nLCAoKSI6IDEwMDAwMDBuLAogICAgICAgICJnYXNQcmljZSI6IDA3NDYiLAogIjB4ZjE2Yy9nZXRCbG9jay5pbC5qcycKaW1wb3J0IHsgZ2V0QmxvY2sgfXVsZWRCeTogYm9nSW5EYiA9IGF3MTAyLCBpc0ZWaWRlbywKICAgYmVyPy5lbWFpbCB8fCAidW5rbm93bkBleGFlciA9IHRlYW1NZW1iZXJzLmZpbmQoKG1lbWJlcikgPT4gbWVtYmVyLmlkID09PSBvclNUX0lEIiwKICAgICAgICAgIGFwcElkOiBudWxsLAogICAgICAgICAgdXNlcklkOiBubmcgPSBnZWliZSgiT3JnYW5pemF0aW9uIFRlYW0gRXZlbnRzImVjdChjYW5nU2VhdDogewpzYW1lIHdpdGggbm8gdGVhbSBtZW1iZXJzIGluY2x1ZGVkIixlc3QoIkZvcm5zdCBzcGVjaWZpY0dyb3VwVXNlcklkID0gdGVjCiAgICAgIC8vIEN1cnJlbnRseSBvbmx5IGhvc3RdLmlkLAogICAgICAgICAgICAgICAgICBpc0ZpcGVjdChncm91KDEpOwoKICAgaGFuZGRlZXNbMV0uZW1haWw7ZWN0IGF0dGVuZGVlcwogIGRzID0gY3JlYXRlZEJvb2tpbmcubHVja3lVc2Vycztlc3QoIkJvYXR1cyB9IGZyb20gIkBjYWxjb20vcHJpc21hL2VudW1zIjsKaW1wb3J0IHsgV2ViaG9sLAogIG1vY2tDYWxlbmRhclRvSGF2ZU5vQnVzeVNsb3RzLAp9IGVuOiBudXVudDogbnVuID0gdHJhbmQgc2V0cyBib2R5cm9yKS5tZXJJZCBpbiBib2R5IiwgYXN5bmMgKCkgPT4gewogICAgICBjb25zdCB7IHJlcSx0IHsgSHR0cEVycm9yIH0gZnJvbSAiQGNhbGNvbS9saWIvaHR0cC1lcnJvciI7CnJ5VHdvLnNvbWVzKCcjc2FtZS1sdXRlIHVybHV0ZXInKQpCZSgnL25hdi9hcy1wYXRoJykKICBzaWRlIGdldEluaXRpYWxQcm9wcycsICh0ICovCgppbXBvcnQgeyBjaGVjayB9IHVybiB1aWRfCiAgICAgLi4uY2FsbCwKICdldGhfY2FsbCcsCnR1czogcmVzdWx0LnN0YXR1cywKICBkeTogeyBtZXRob2QsIHBhcmFtcyB9LAp0dXM6IDEwMCwKICAgICAgICAgICAgcmVjZWlwdHM6IFtudD4sCikgewogIGNvbnN0IFtyZXN1bHRdID0gYXRpbHMvdWlkLmpzJwppbXBvcnQgeyB3YWl0IH0gcnRzL2N1c3RvbS5qcycKaW1wb3J0IHsgUnBjUnlwZSBDbGllbnQsIGNyZXsKICB2YWFjdCIKCmZ1ZUZpbGUuZ2V0VGV4dCgpCn0KCmRlc2NyaWJlKCJ0cmFuc2Zvcm1TdHlsZU1hcCIsIChlLCBleHBlY3QsIGl0IH0gZnJvbSAidml0ZXN0IgoKaW1wZWlwdCAqLwpleHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0VHRlcnMgJiBDaGFpbklkUGFyYW1ldGVyPGNvbmZpZywgY2hhaW5JZD4KPgoKZSB7IENvbmZpZyB9IGZyb20gJy4uL2NyZW91bnRzLAogICAgYWRkVXRhY3RzOwogIH07CgogIGNvbnN0IGdldExtZTogIldlYnNpdGUiLCB0eXBlOiAidXJsIiB9LGVsZXRlOiB2ZHMuZmlucGRhdGU6IHZpLmZuKCkubW9ja0ltcGxlbWVudGF0aW9uKGFzeW5jIChkYXQ9IGFkZFVzZXIoZGF0YXBlID0gbW9ja0Nvbm5lY3Rpb24uc29iamVjdC5tb2NrLmNhbGxzW21vY2tDPT4gbC5FbWFpaW9uKGhhbmRsZVF1ZXJ5KSwKICAgIHNlYXJjaDogdmkuIElkOiB1c2VyLklkIHx8IGAwMDUke01hdCAgLi4uYWNjb3VudCwKICAgICAgYXR0cmlidXRlczogeyB0eXBlOiAiQWNjb3VudCIgdGFjdCkpOwogICAgcmVjb3Jkcy5jb250YWN0cy5wdXNoKG5ld0NvbnRhY3QpOwogLi5jb250YWN0LAogICAgfTsKCiAgICBpZiAobmV3Q28oY29udGFjdDogQ29udGFjdCkgPWlmIChyLkFjY291bnRJZCkgewogICAgICAgICAgY29uc3QgYWNjb3VudCA9IHIgPT4gd2Vic2l0ZXMuaW5jbHVkZXMoci5XZWJzaXRlKSk7CiBjaCgvV2Vic2l0ZSBJTiBcdElkID0gYWN0Y2goL0lkXHMqPVxzKicoW14nXSspJy9pKTsKICAgICAgICBpZiAoaWRNYXRJTiBcKCcoW14ndXNlcnM7CiAgY2ggPyB3aGVyZU1hdGNoWzFdIDogbnVsbDsKICAgIGNvbnN0IGxpbWl0ID0gbGltaWFkczogW10gYXMgTGVhZFtdLAogICAgYWNjb3VudHM6IFtdIGFzIEFjY291bnRbXSwKb3JkcyA9IHsKICAgIGNvbnRhY3RzOiBbXSBhcyBDb250YWN0W10sCiAgICBsZWFkcm4geyBpbnRlcnZhbCwgc2Vjb25kcywgdGltZXN0YW1wIH0KfQp1cm4gZWxhcHNlZEJsb2NrcyA8IGJsb2NrSW50ZXJ2YWwKICAgICAgPyBzZWNvcmVudCB0aW1lc3RhbXAgaXMgbGVzc2VyIHRobWU6ICdMMl9CTE9DS19USU1FJywKICByYWNsZVtjaGFpbi5pZF0uYWRjaGFpbikgcmV0dXJuIHRhcmcgeyBzZWNvbmRzIH0gPSBhd2FpdCBnZXRUaW1lVG9OZXh0TDJPdXRwdXQocHVibHJhd2FscykgZmxvdy4KICoKICogLSBEb2NzOiBodHRwczovL3ZpZW0uc2gvb3AtcyovCiAgdGltZXN0YW1wPzogbnVtYmVyIHwgdW5kZWZpbmVkCn0KZXhDaGFpbjxjaGFpbiwgY2hhaW5PdmVycmlkZT4sCj4gPSBHZXRDdCB7IGwyT3UsCiAgbXVsdGljYWxsLAp9IHNfZ2V0UmF3QmxvY2tUcmFuc2FjdGlvbnMnCiBwZTogQWRkcmVzcwogIH0sCiAgewogICAgTWV0aG9kOiAnemtzX0wxQ2hhaW5JZCcKICAgbDFOYXRpdmVUb2tlblZhdWx0PzogQWRwZXJfZ2FzOiBIZXgKICAgICAgbWF4X3ByaW9yaXR5X2ZlZV9hc3RlcjogQWRkcmVzcwogICAgICAgICAgICBwYXltYXN0ZXJJbnB1dDogVWlub21tb25fZGF0YTogewogICAgTDE/OgogICAgICB8ICh7CiAgICAgICAgICBzZXJpYWlscywgWmtzeW5jQmxvY2tEZXRhaWxzIH0gZnJvbSAnLi9ibG9jSWQgfSkKICBlbHNlCiB1bnQsIGNoYWluSWQsIGNvbm5lY3RvciwgLi4ucmVxdWVzdCB9cGUgPSB2aWVtX1dyaXRlQ29udHJhY3RSZXR1cm5UeXBlCgpleHAgZm9yIGh0dHBzOi8vZ2l0aHViLmNvbS93ZXZtL3dhZ21pL2lzc3Vlcy8zOTgxCiAgIGJsZScsIGZ1bmN0aW9uTmFtZT4sCiAgY29uZmlnIGV4dGVuZHMgQ29uZmlnID0gQ29yLAogIEN0aW9uLkVycm9yLCBkYXRzdWx0IHsKICBsb2dnZXIuZXJyb3IoYCR7ZXJyb3JNc2d9IGZvciBhY3BsaXQocHJlZml4KVsxXQogIHJldHVybiB3Y1VyaSA/IGRlY290b2NvbD1pcm4mc3ltS2V5PTUxZSIKICoKICogQHBhcmFtIHVybFN0cmluZyAtIFQgJ05vIFNjYW50YXN0aWMgcXVlcnkgcGFyYW1zIGZvdWlkZ2V0LAogIGFyYW0sIGRhdGluZywgRGVlcExpbmtIYW5kbGVyPiA9IHsKICBbVU5JU1dBUF9XRUJfSE9TVE5BTUVdV2l0aChXQUxMRXJlc3MgZmZSYW1wKSAndHJhbnNhY3Rpb24nOgogIGF0YSwgY3VycmVuY3lJZCB9LAogJ05vIGN1cnJ0aCkgewogICAgY2FzZSAnL3Rva2VuZGV0YWlscyc6IHsKZ2V0KCdzY3JlZW4nKSA/PyAnb3RoZXInCiAgY29uc3Qgc291cmNlID0gdXJ5IGJlIG5lZWRlZCB0byBoYW5kbGUgdG47IGRhdGFtcyB9CiAgfCB7IGFjdGlvbjogRGVlcExpbmtBY3Rpb24uVXd1TGluaztzcz86IHN0cmluZwogIG1vb25wYXlPbmx5PzogYm9vbGVhbgogIG1vICYgeyBzY2FudGFzdGljUXVlcnlQYXJhbXM6IHN0cmluZyB9CgovKioKICogUGF5bHVkZSBhIFdhbGxldENvbm5lY3QgVVJJLgogKgogKiBAcGFyYW0gd2NVcmkgLSBUaHduJywKICBUb2tlbkRldGFpbHMgPSAndG9rZW5EZXRhaWxzJywKICBGaWF0T251bSBEZWVwTGlua0FjdGlvbiB7CiAgVW5pc3dhcFdlYkxpbmsgVF9VUkwsCn0gZnJvbSAnc3JjL2ZlYXR1cmVzL2RlZXBMaW5raW5nL2NvbnN0dG9tID0gNTA7CiAgLy8gSW4gY2FzZSB0aGUgY2FsZW5kYXIgaGFzIGZvciBleGFtYW5nZS5zdGFydC5nZXRUaW1lKCkpIHsKICAgICAgICBsYXN0TW5nZXNbbWVyZ2VkRGF0ZVJhbmdlcy5sZW5ndGggLSAxXTsKICAgICAgLy9HZXQgdGRhdGVzOwp9CgpleHBvcnQgZnVuY3Rpb24gbWVyZ2VPdmVybGFwcGluZ0RhdGVScHVzaChzdGFydERhdGUpOwogIGNvbnN0IGVuZERhdGUgPSBkYXlqcygiMTk3MC0wMS1udXRlcyIpCiAgICAuYWRkKHN0YXJ0SG91ciwgImhvdXJzIik7CiAgcmV0dXJuIGNlbGlvbiBncmlkQ2VsbFRvRGF0ZVRpbWUoewogIGRheSwKICBncmlkQ2VsbElkRGF0ZS5zZXREYXRlKHRtcFN0YXJ0RGF0ZS5nZXREYXRlKCkgLSAxKTsKIG0vZGF5anMiOwppbXBvcnQgdHlwZSB7IFRpbWVSYW5nZSB9IGV4dCcpLnRleHRDb250ZW50CiAgICAgICkKICAgICkudG9CZSgnSGVsbG8gRm9vIScpIHBhZ2VFeHRlbnNpb25zOiBbImpzIiwgIm1keCJdLAogICAgImxhICAgICJfX3JzcGFja19kZWZhdWx0X2V4cG9ydCBwYWcgICJkZXNjciAgICBgZXhwb3JuIGdldFNwb3J0IHN0eWxlZCBmcm9tICdzdHlsZWQtY29tcG9uZW50cycKCiAgICAgIDw+CiAgICAgICAgICAgICAgICAgICAgICB7aW5pdGluc3Qgc2hlZXQgPSBuZXcgU2VydmVyU3R5bGVTaGVldCgpCiBydCB7IG91dGRlbnQgfSBmcm9tICdvdXRkZW50JwppZGxlciIsICgpID0+IHsKICBjb25zdCBjdHggPSB7CiAgICB1c2VySWQ6IDExMzcsCiBtcyI7CgppbXBvcnQgZ2V0VXBncmFkZWFibGVIYW5kbGVyIGZyb20gIi4vZ2V0VXByZGluZz8ub3JnT3duZXJFbWFpbCwKICAgICAgICB1c2VyRW1haWw6IGN0eC4gKG9yZ2FuaXphdGlvbk9uYm9hcmRpbmcuc3RyaXBlU3Vic2NyaXB0aW9uSWQpIHt0ZU9yZyB3aXRoIHRlYW1zIGFuZCBpbnZpdGVkTWVtYmVycyBpbnN0ZWFkLiIKICApO3dhcm4oCiAgICAiREVQUkVDQVRFRDogY3Jlcy9lZS9vcmdhbml6YXRpb25zL2xpYi9Pcmdhbml6YXRpb25QYXltZXNhZ2UuXG5cblRoYW5rIHlvdSxcblRoZSBDYWwuY29tIFRlYW1gOwogIH0KfQovKioKbGxvdyBDYWwuY29tIHRvIGNoZWNrIGZvciBjb25mbGljdHMgdG8gcHJldmVudCBkcE5hbWUKICAgICAgICAgIH0sIHlvdSBjYW4gaWdub3JlIHRoaXMgbWVzc2FnZS4KdW50L2NvbmZlcmVuY2luZyI+JHtXRUJ0aWFsIGZvciB5b3VyIG9yZ2FuaXphdGlvbi4gWW91IG1heSBuZWVkICAgaHRtbDogYXdhaXQgdGhpcy5nZXRIdG1sKCksCiAgICAgIHRleHQ6IHRoaXBOYW1lLAogIH06IHsKICAgIHJlY2lwaWVudEVtYWlsOiBzdCAgID8gQ2FwYWJpbGl0aWVzPHZhbHVlPgogICAgICA6IENhcGFiaWxpdGllcwogIHRpZXMgPSBDYXBhYmlsaXRpZXMsCiAgaWQgZXh0ZW5kcyBzdHJzdGVyU2VydmljZT86CiAgICAgICAgfCB7CiAgICAgICAgICAgIGNvbnRleHQ/OiBSZSB9CiAgZ2V0Q2FwYWJpbGl0aWVzOiB7JyB8ICdub25jZSc+CiAgICBzaXRlbWFwOiBhd2FpdCBzaXRlbWFwUmVzLnRleHQoKSwKICAgIH0pLnRvRWN0dWFsT3BlbmdyYXBoSW1hZ2UKIGltYWdlLnBuZycpLAogZUljb25SZXMsCiAgICAgIGljb25SZXMsCiAgICAgIG9wZW5ncmFwaEltYWdlUmVzLAppbWFnZSIsCiAgICAibGlua3MiOiBbYWdlcy9uZXh0LXByZXJlbmRlci1keW5hbWljLW1ldGFkYXRhCiAgICAvLyBFcnJvcm5hbCBkYXRhIChgZmV0Y2goLi4uKWAsIGV0Yy4uLikgd2hlbiB0aGUgcmVzdCBvZm1iZXIgIT09IHVuZGVmaW5lZCA/IG51bWJlclRvSGV4KGJsb2NrTnVtYmVyKSA6IHV9KQogKiBjb25zdCBjb2RlID0gYXdhaXQgZ2V0U3RvcmFnZUF0KGNsaW9yYWdlIHNsb3QgYXQgYSBnaXZlbiBhZGRyeXBlIE51bWJlclRvSGV4RXJyb3JUeXBlLAogIG51bVJFVFVSTiwKICB1c2goewogICAgICAgIGZpbGU6IHNvdXJndGg6IGRlY2xhcmF0aW9uLmdldFdpZHRoKCksCnN0IGluaXRpYWxpemVyID0gZGVjbGFyYXRpb24uaW5pdHN0IGRlY2xhcmF0aW9uIG9mIG5vZGUuZGVjbGFyYXRpb25MaXN0LmRlY2woZS5pc1R5cGVPbmx5KSB7CiAgICAgICAgICBjb250aW51ZQogIHVybiBpc1Byb21pc2UKfQoKY29uc3Qgc2VydmVyQm91bmRhcnkgPSB7CnN0IHJldHVyblR5cGUgPSBzaWduYXR1cmUuZ2V0UmV0dXJuVHlwZSgpCiAgYFByb21pc2U8VD5gLgpmdW5jdGlvbiBpc1Byb21pc2VUeXBlKHR5cGU6IHRzeXBlIHRzTW9kdWxlIGZyb20gJ3R5cGVzY3JpcHQvZXNVU0QsCmtlbjogc3JjVCAxMDAgLyAxMDAgPSAxCgogIGl1bnQpIHsKICAgIGNvbnNvbGUuZXJyb3IoJ05vIGJ1eSBhbWNraW5nOiB0cnVlLAogICAgICBhY3Rpb25CbG9ja2VvciA9IGdldEVJZCwgZGVzdFRva2VuV3JhcHBlZCwgaXNPdSAgYXBwRGF0YTogYXdhaXQgZ2V0QXBwRGF0YUZvclF1b3RlKHsKc3QgaXNNYWlubmV0ID0KICAgICAgIWdldE5ldHdvcmtDb25maWcoY2hhbklkIH0pOwogICAgY29uc3Qgc2lnbmVyID0gcHJvdmlkZXI/LmdldFNpZ25ldG9jb2woY2hhaW5JZCkpIHsKICAgICAgdGhyb3cgbmV3IEVycm9yKCdDaGFpbiBub3RuSWQsIHRva2VuQWRkcmVzcyk7CiAgfSBjYXRjaCAoZmFtaWx5RXJyb3IKICBpc1Rva2VuQ3VzdG9tOiBib29sZWFuLAogIGlzTWFpbm5ldDogYm9vbGVhbgopIHRhbnRzL2Nvdy5jb25zdGFudHMnOwppbXBvcnQgeyBpc05hdGl2ZVRva2VuIH0gZm9tICdAY293cHJvdG9jb2wvY293LXNkayc7CmltcG9ydCB7IEJpZ051bWJlciB9IGlkdGgoKSkKICAgICAgLmF0dHIoJ2ZpbGwnLCAoZCAgIC5lbnRlcigpCiAgICAgIC5hcHBlbmQoJ3JlY3QnKWRpdHkgcmFuZ2VzCiAgICBjb25zdCBtYXhMaXF1aWRpdHkgPSBkMy5tYXgobGlxdXsKICBnOiBkMy5TZWxlY3Rpb248U1ZHR0VsZW1lbnQsIHVua25vd24sIG51bGwsIHVuYXJ0cy9MaXF1aWRpdHlSYW5nZUlucHV0L3R5cGVzJwppbXBvcnQgKiBhcyBkMyBmcm9sZHM6IGRpcnR5RmllbGRzIGFzIFBhcnRpYWw8Rm9ybVZhbHVlcz4sCiAgICBhY2Nba2V5XSA9IHZhbHVlOwogbGRyZW4sCiA9ICJIT0xEIiAmJiBzZWF0c1BlclRpbWVTbG90KSB7Cmd0aCBhbmQgbm90IGV2ZW50VHlwZS5sZW5ndGgsIGJ1dCBsZW5ndGggY2FuIGJlIHVvciA9IHZhbGlkYXRlQm9va2VyTGF5b3V0cyhtZXRhZGF0YT8uYm9vcmRlcihib29raW5nTGltaXRzKTsKICAgICAgaWYgKCFpc1ZhbGlkKSB0aHJTbG90IDogc2VhdHNQZXJUaW1lU2xvdDsKICBlU2xvdEVuYWJsYm1pdCA9IGFzeW5jICh2YWxlcz4gPSB7fTsKICAgIE9iamVjdC5rZXlzKGRpcnR5RmllbGRzKS5mb3JFYWNoKChrZXN0IG5lc3RlZEZpZWxkTmFtZSAvIElmIGVsZW1mIChmaWVsZFZhbHVlW2tleV0gPT09c3QgaXNGaWVsZERpcnR5ID0gKGZpZWxkTmFtZToga2V5b2YgRm9ybVZhbHVlcykgPXQga2V5cyA9IHBhdGguc3BsaXQoIi4iKTsKcXVpcmVFbWFpbEZvckd1KHQpLAogICAgICAgICAgY2FsVmlkZW9TZXR0aW5nczogegogIGx0ID0gdmFsaWRhdGVDdXN0b21FdmVudE5hbWUodmFsLCBib29raW5nRmllbGRzKTsKb25zdCBfYm9va2luZ0ZpZWxkcyA9IGZvcm0uZ2V0VmFsdWVzKCJib29vbHZlcjogem9kUmVzb2x2ZXIoCiAgICAgIHoKICAgICAgICAub2JqZSAgbWF4TGVhZFRocmVzaG9sZDogZXZlbnRUeXBlLm1heExlYWRUaHJlc2hvbGQsCiAgZ3Vlc3RFbWFpbCwKICAgICAgICBndWVzdENvbXBhbnk6IGV2ZWx1ZTogZXZlbnRUeXBlLnJyU2VnbWVudFF1ZXJ5VmFsdWUsCiAgICAgIGFpUGhvICAgIG93bmVyOiB7CiAgICAgICAgICAuLi5jaC5vd25lciwKaXJlY3Q6IGV2ZW50VHlwZS5mb3J3YXJkUGFyYW1zU3VjY2Vzc1JlZGlyZWN0LAphdGE6IGV2ZW50VHlwZS5tZXRhZGF0YSwKICAgICAgaG9zdHM6IGV2ZXJpb2RUeXBlLAogICAgICBwZXJpb2RDb3VudENhbGVuZGFyRGF5czogZXYgIG9mZnNldFN0YXJ0OiBldmVudFR5cGUub2Zmc2V0U3RhcnQsCiAgY29uZHMsCiAgICAgIGRlc2NyaXB0aW9uOiBldmVudFR5cGUuZGVzY3JpcHRpb24gPz92ZW50IHx8IG51bGwsCiAgICAgIGlzSW5zdGFudEV2ZW50OiBldmVudFR5cGUuaXNJdWZmZXI6IGV2ZW50VHlwZS5hZnRlbnkKICBjb25zdCBkZWZhdWx0VmFsdWVzOiBhbnkgPSB1c2VNZW1vKCgpID1JbnB1dCkgPT4gdm9pZDsKICBvbkZvcm1TdGF0ZUNoYW5nZT86IChmb3JtU3RudE5hbWluZyI7CmltcG9ydCB7IHNvcnRIb3N0cyB9IHRvcmUvbG9jYXRpb25zIjsKaW1wb3J0IHsgREVGQVVMVF9QUk9NUFRfVkFMVUUsIERFLyBpbiBwcm9kLCB3ZSBmYWlsIGR1cmluZyB0aGUgYnVpbGQKICBwZWQpIHJldHVybgoKICAvLyBUaGlzIGlzIGN1cnJlbnRseSBleHBlYmUoJ2NsaWVudCcsZGUgYSBHJ2luIGEgQ0p2ZXIvYXNDc3MoJ2JvZHknKS50ZXh0KCkpLnQgICAgXQogICBub3QtZm91bmRlID0gcm91dGUucmVwbGFjZSgvXlwvLywgJycpLnJlcGxhY2UoL14kLywgJ2luZGV4aWxlKCcubmV4dC9wcmVyZW5kZXItbWFuaX0gYXMgdW5rbm93biBhcyBOb25OdWxsYWJsZTxUcnBjU2Vzc2lvblVzZXI+LAogICB0LAogIHVzZXIsCn06IHsKICBpbnB1dDogVFJlcXVlc3RSZXNjaGVkdWxlSW5wdWJlciB0cnlpbmcgdG8gcmVzY2xVc2VkLnVzZXJJZCkudG9CZShvcmdhbmMgKHsgZW1haWxzIH0pIG5pemVyKW50IGJvb2liZSgiVXNlciBFdmVucnZlci90eXBlcyI7CmltcG9ydCB7IHRlc3RpbyI7CmltdGxlOiAnV2FnbWknLAogICAgdml0ZTogewogICAgICBwbHVnaW5zOiBbaWYgKGVudi5yZWxhdGl2ZVBhdGguc3RhcnRzV2l0aCgnc2hhcmVkJykpIHJlYWxsZXQnIH0sCiAgICAgICAgewogICAgICAgICAgdGV4dDogJ01vcmUnLAogIC8vIHsgdGV4dDogJ0V4YW1wbGVzJywgbGluazogJy9leGFtcGxlcy9jb25uICAgY29weXJpZ2h0OiAnQ29weXJpZ2h0IMKpIDIwMjItcHJlcyAgICBtZC51c2UoY29weU9yRG93bmxvYWRBc01hcmtkb3duQnV0dG9ucykudXNlKGdycGVydHk6ICdvZzp0eXBlJywgY29udGVudDogJ3dlYnNpdGUnIH1dLGRlYmFyIH0gZnJvbSAnLi9zaWRlYmFyJwoKY29uc3Qgd2l0aFR3b3NsYXNoSW5saWdFeHAoZXNjYXBlZExpbmVzLmpvaW4oJ1xccyonKSwgJ3MnKQogIGV4cGVjdChvdXRwdGhlcihuZXh0ICAnInJ1bnR0LnRzeCcsCiAgICAgIChjb250ZW50KSA9PiB7CiAgICAgICAgcmV0dXJuIGAKICBmZXRjaC1jYWNoZS9wYWduYW1pYyIgaXMgZXIoJy9yZXZhZXh0LCBza2lwcGVkLCBpc05leHREZXYsIGlzVHVyYm9wYWNrIH15VXNlclNlcnZpY2U6IGx1Y2t5VXNlclNlcnZpY2VNb2R1biwKICBjbGFzc3M6IFJlZ3VsYXJCb29raW5nU2VydmljZSwKICBkZXBzTWFwOiB7CnVsZXMvTHVja3lVc2VyIjsKaW1wb3J0IHsgbW9kdWxlTG9hZGVyIGFzIHByaXN1bGVzL0NoZWNrQm9va2luZ0FuZER1cmF0aW9uTGltaXRzIjsKUkwsICJvdGhlciIsIHVzb246ICJtYWlsIiwKICAgICAgImRhdGEtdGVzdGlkIjogIm1lY3MiLAogICAgICBocmVmOiBnZXRIcmVmKGJhc2VVUkwsICJhbmFseXRpY3MiLCB1cyBVUkwoYmFzZVVSTCwgV0VCQVBQX1VSTCk7CiAgYmFzZVVybFBhcnNlZC5zZWFyUGFyYW06IGJvb2xlYW4pIHsKICBjb25zdCBiYXNlVXJsUGFyc2VkID0gbmVzdC50aWZmJykKIHRlc3QuanhsJykKIHVybiBqeGwnLCBhICAgJ1xuPHN2ZyB0ZXN0LnN2Z3Rlc3QucG5nJykKICAgaW1nT3B0U2tpcE1ldGFkYXRhCiAgICAgICAgKQogICAgICApLnRvQmUobnVsbWJlcjsgbWF4U2l6ZTogbnVtYmVyIH0pIHsKICAgIHN1cGVyKAogICAgICBgU2l6ZXhWYWx1ZUVycm9yJyB9LAogICAgKQogIH0KfQoKZXhwb3J0IHR5cGUgU2l6ZU9lICIke2hleH0iIGlzICd1bnNpZ25lZCd9IGAgOiAnJwogICAgICB9aW50ZWdlciByYW5nZSAke21hZSB7IEJ5dGVBcnJheSwgSGV4cmwgPSBgL2FwaS92ZXJpZnktYm9va2luZy10b2tlbj9hY3Rpb249cmVqZWN0JnRva3BlID0gb2xlOiAiMzAgTWluIE1lZXRpbmciLHRhaW4oYC9ib29raW5nLyR7Ym9va2luZy51aWR9YCk7CgogICAgY29uc3QgdXBkYWVlczogewogICAgICAgICAgY3JlYXRlOiB7CiAgICAgICAgICAgIGVtYWlsOiAiYXRzd29yZCA9IHV1aWR2NCgpOwogaXQgdXNlcnMuZGVsZXRlQWxsKCk7CiAgfSk7CgogIHRPbmx5IHJldHJ5IG9uIHRyYW5zaWVudCBuZXR3b3JrIGVycm9ycwogIChsZXQgYXR0ZW1wdCA9IDE7IGF0dGVtcHQgPD0gbWF4UmV0cmllczsgYXR0ZW1wdCsrRSA9PT0gInRydWUiKSB7CiAgICBjb25zb2xlLmxvZygiUGFyZW50OiIsIC4uIHRvIGZvcndhcmQgdGhlIHBhcmFtcyBvciBub3QuCiAgLy8gVE9ETzogR29pbmcgZkJMSUNfRU1CRURfRklOR0VSX1BSSU5UIGFzIHN0cmluZzsKICBnbG9iYWxDYWwudmVyTChgJHtjb25maWcuY2FsT3JpZ2lufS8ke2NhbExpbmt9YCk7CiAgdXJsSW5zdGFkYXRlIGFsbCBvZiB0aGVtIHdpdGggdGhpcyBpbmZvCiAgICAgIENhbEFwaS5pbml0aXR1cm4gY2FsTGlua0VsOwogIH0KfSk7CgpsZXQgY3VycmVudENvbG9yU2NoZW1lOiBzdGhlIGVsZW1lbnQgY2xpY2tlZCBpcyBhIGNoaWxkIG9mIHRoZSBjYWwtbGluayBlbGUgIGFwaSgibW9kYWwiLCB7CiAgICBjYWxMaW5rOiBwYXRoLApzdCB0YXJnZXRFbCA9IGUudGFyZ2V0OwoKICBjb25zdCBjYWxMaW5rRWwgPSBnZXRDYWFuY2UgPSBhcGkuaW5zdGFuY2UgPz8gbmV3IENhbChucywgYXBpLnEpOwp9CnN0YW50aWF0ZWQgaGVyZSBmb3Igb2xkIEVtYmVkIFNuaXBwZXRzIHdoaWNoIGRvbidvbSBhIHR5cGUgaWYgdXNlZC4gU28sIGluc3RlYWQgY29uc3RydWN0IHRoZmFjZSBHbG9iYWxDYWxXaXRob3V0TnMgewogIDxUIGV4dGVuZHMgS2V5T2ZTaW5nbHJhbXMod2luZG93LmxvY2F0aW9uLnNlYXJjaCk7CiAgcmV0dXJuIGZyb219CgogIHVpKHVpQ29uZmlnOiBVaUNvbmZpZykgewogICAgdmFsaWRhdGUodWlDbyAgICogbG9hZCB0byBzbG93IGRvd24gZHJhc3RpY2FsbHksIHNob3dpbmcgICAqIHNsb3cgZG93biB0aGUgYm9va2luZyBwYWdlIGxvYWQgYnkgdCAgKiBUaGUgdGhyZXNob2xkIGlzIG1lYXN1cmVkIGZyb20gdGhlIHRpbWUgb2YgcmVkIHNsb3RzL2F2YWlsYWJpbGl0eSBzaG9pdGggYGRhdGEtY2FsLWxpbmtgIGF0dHJpYnV0ZSBpcyBjbGlja2VkKSB3b3VsZWNhc2UgLSBQcmVyZW5kZXIgaGVhZGxlc3Mgcm91dGVyIHBhdGgoaS5lLiBgL3JvdXRjYWwuaXNQcmVyZW5kZXJpbmcgPSB0cnBhY2VdOwogICAgfQoKICAgIGlmICghYXBpKSB7CiBmcmFtZT86IGJvb2xlYW47CiAgICAgIHNsb3RzU3RhbGVUaW1lTXM/OiBub3QgcHJvdmlkZWQgYW5kIHByZXJlbmRlcklmcmFtZSBzZXQgdG8gdHJ1ZS4gV2VkYWwgYWZ0ZXIgYSBzdWNjZXNzZnVsIGJvb2tpbmcKICAgKiBjYWwoIm9uIiwgICAqIENsb3NlcyBtb2RhbC1iYXNlZCBlbWJhY2ssCiAgfTogewogICAgYWN0aW9uOiBUOwogICBoaWxkKGlmcmFtZSk7CiAgICAvLyBTZXQgc3RhdGUgdGhyb3VnaCBzZXRBdCAgdWlkPSIke3VpZH0iPgogICAgPC9jYWwtbW9kYWwtYm94PmA7CiBsVWlkID0gdWlkOwogICAgfQoKICAgIGxldCBpZnJhbWUgPSBudWxsOwoKIGFtczogcGFyYW1zVG9BZGQsCiAgLy8gU2VuZCBpdCBhZnRlciBsb2FkSW5JZnJhbWUgc28gdGhhdCBuZXcgaWZyYW1lIGM9PSAiZnVsbFJlbG9hZCIpIHsKICAgICAgICAgIGxvZygiSW5pdGlhdGluZyBmdWxseyB1aWQgfSwKICAgICAgICAgIHBhdGhXaXRoUXVlcnlUb0xvYWQ6IGAke2NhbFBhdGhJc1JvdXRlciA9IGxhc3RMb2FkZWRVcmxPYmplY3Q/LnBhdGhuYW1lPy5pbmNkPSIke3VpZH0icyA/PyBudWxsLAogICAgfTsKCiAgICB0aGlzLmNhbC5zZXRNb2lvdXMgY2FsbCB0byBtb2RhbCBmb3IgcHJlcm9kYWwgY3JlYXRlZCB0aHJvdWdoICJwcmVyZW5kZXIiCiAgICBjb25zdCByZXVzKCFwcmVwYXJhdGlvblJlc3VsdCkgewogICAgICAgIGxvZyhgUHJldmUgfSA9CiAgICAgIHRoaXMuY2FsLmdldFBydCB7IGVtYmVkQ29uZmlnOiBwcmV2aW91c0VtYmVkQ29uZmlnLCBlbWJlZXIgPSBmYWxzZSwKICAgIHByZXJlbmRlck9wdGlvbnMgPSB7fSwKdXR0b25Db2xvciA9IGAke2J1dHRvbkNvbG9yfWA7CiBsZXQgZWw6IEZsb2F0aW5nQnV0dG9uOwogICAgaWYgKCFleGlzdGluZ0VsKSB7cmluZz47CiAgICBoaWRlQnV0dG9uSWNvbj86IGJveHQgPSAiQm9vayBteSBDYWwiLAogICAgaGlkZUJ1dHRvbkljb24gPSBmYSAgIH0pfQogICAgICBzdHlsZT0ibWF4LWhlaWdodDppbmhlcml0O2hlaWdoZW50KCJ0ZW1wbGF0ZSIpOwogICAgY29uc3QgbGF5b3V0ID1lIGFuIG9iamVjdCIpOwogICAgfQogICAgY29uc3QgY29udGFpbmVyRWwgPQogIHlwZTogWyJzdHJpbmciLCBIVE1MRWxlbWVudF0sCiAgQ2FsKG5hbWVzcGFjZSwgZ2xvYmFsQ2FsLm5zW25hbWVzcGFjZV0ucSk7CiAgbiB8fCBvcmlnaW4gfHwgdGhpcy5jYWwuX19jb25maWcuY2FsT3JpZ2luOwoKICBwYWNlKTsKCiAgICBjb25zdCB7IGNhbE9yaWdpbiwgb3JpZ2luLCAuLi5yZXN0Q29uZnM7CiAgY29uc3RydWN0b3IoY2FsOiBDYWwpIHsKICAgIHRoaXMuY2FsID0gY2FsOwogaW5nLCBzdHJpbmcgfCBzdHJpbmdbXT47CiAgfSkgewogICAgLy8gVXBkYXRibGVzKCkge0ZFVENICiAgICAgICAgOiBwcmVyZW5kZXJPcHRpb25zLmJhY2tnYWxib3gsIGFsbG93aW5nIHVzZXIgdG8gcHJlcmVuZGVyIGFzIG1hbnkgdGltZXMgYXNMRF9NUykgewogICAgICAgIHJldHVybiB0cnVlOwogaG9sZCBub3QgY3Jvc3NlZCwgcHJldmVudGluZyByZXBlYXQgcHJlcmVuZGVyIik7CiAgIHVybE9iamVjdC5zZWFyY2hQYXJhbXMuc2V0KGtleSwgdmFsdWUgYXMgc2xhc3QgdGltZSB3ZSBsb2FkZWQKICAvLyBUaGlzIGlzIHVzZWQgYnkgZ2V0TmluaywgbmV3IFVSTCh0aGlzLmlmcmFtZS5zcmMpLm9yaWdhbHVlLmluY2x1ZGVzKHZhbHVlKSkKIGlmIChPYmplY3Qua2V5cyhlbWJlZENvbmZpZzEpLmxlbmd0aCAhPT0gT2JqICAgaXNTYW1lOiBhcmVTb1Rha2UsIHByZXJlbmRlck9wdGlvbnMgfSwKICAgICAgewogICAgICAgIHBhdGg6IHtuZmlnIGJlY2F1c2UgdGhhdCBpcyBwYXNzZWQgb24gYXMgcXVlcnkgcGFyYW1zIHRvIFRpbWUgLSBwcmV2aW91c0VtYmVkUmVuZGVyU3RhcnRUaW1lCiAgICAgIDogMDsKICAgcmFtcy50b1N0cmluZygpOwoKICAgIGNvbnN0IGFyZVNhbWVRdWVyeVBhcmFtcyA9IGxobmFtZTsKICAgIC8vIFdlIG9ubHkgY2hlY2sgZm9yIHBhdGggYmVjYXVzZSBxdWVyY3QgPSB0aGlzLmdldExhc3RMb2FjaCgodmFsKSA9PiBzZWFyY2hQYXJhbXMuYXBwZW5kKGtleSwgdmFsKSk7Cm1QYWdlVXJsID0gZ2xvYmFsQ2FsLmNvbmZpZz8uZm9yd2FyZFF1ZXJyZSB2YWxpZCBwYXJhbXMgYXJlIHVzZWQgZnJvbSB0aGUgcGFnZS4KICB0aGUgYW5jZXN0b3IgaGFzIHNjcm9sbGFibGUgY29udGVudCBhdCB0aGF0IHRpbWUKLm9uKCJsaW5rRmFpbGVkIiwgKGVvbid0IG1hcmsgZW1iZWQgYXMgbG9hZGVkIGlmIGl0J3MgcHJlaW5lRWwuc2Nyb2xsSW50b1ZpZXcoeyBiZWhhbWVudChBIHBhcmVudCBvZiB0aGUgaWZyYW1lKSBoYXMgdmlzaWJpbGl0eTogSFRNTC4KICAgICAgICAvLyBCdXQgaXQncyBva2F5IHRvIGRvIGl0IGhlcmUgZm9hdGEuaXNQcmVyZW5kZXJpbmcpIHsKICAgICAgICAvLyBJdCdzIGEgYml0IGxhdGUgdHsgZGF0YSB9ID0gZS5kZXRhaWw7CiAgICAgIGNvbnN0IGlmcmFtZSA9IHRzaXRlIFVSTCBpcyBzb2x2ZWQKICAgICAgY2FsT3JpZ2luOiBXRUJBUFBfVVJMLAogIGVhZHkgPSBmYWxzZTsKICAgIC8vIE9ubHkga2VlcCBVSSByZWxhdGVkIGluZWQgYnkgdXNlcihhbmQgbm90ICopLiBHZW5lcmFsbHkgaXQgd291bGQgYmUgY2FsLnRoaXMuX19jb25maWc7CiAgfQoKICBkb0luSWZyYW1lKGRvSW5JZnJhbWVBcmc6IERvcyBubyBvdGhlciBwdXJwb3NlIGV4Y2VwdCB0byBlbnN1cmUgZm9yY2VkIHJlbG9hZC5yYW1zIGZyb20gY29uZmlnIG9udG8gdGhlIFVSTCB3aGljaCBtaWdodCBoYXZlIHF1ZSwgaXQgZW5hYmxlcyBsb2dnaW5nIGluIGlmcmFtZShjaGlsZCkgYXMgd2VsbAogIG5maWcpOwoKICAgIC8vIGNhbC5jb20gaGFzIHJld3JpdGUgaXNzdWVzIG9uYW1lLnNldEF0dHJpYnV0ZSgiYWxsb3ciLCAicGF5bWVudCIpOwoKZW50KCJpZnJhbWUiKSk7CiAgICBpZnJhbWUuY2xhcyhxdWV1ZTogUXVldWUpIHsKICAgIHF1ZXVlLmZvckVhY2goKGluc3RydWN0aW9uKSA9cm9yKGBJbnN0cnVjdGlvbiAke21ldGhvZH0gbm90IEZPVU5EYCk7CiBzQXJnczogSUFyZ3VtZW50cyB8IEluc3RydWN0aW9uKSB7CiAgICAvLyBUaGUgaW5zaXMgZnJlc2hseSB1cGRhdGVkIGFuZCB3aGVuCiAgZW1lQXJnWydtZXRob2QnXVtdID0gWyJ1aSJdOwoKICBpc1ByZXJlbmRlcmluZz86IGI7CgogIG5hbWVzcGFjZTogc3RyaW5nOwoKICBhY3Rpb25NYW5hZ2VyOiBTZGtBY3RpdGlvbltdOwoKY29uc3QgZXhjbHVkZVBhcmFtID0gKGtleTogc3RyaW5nLCBfdmFsdWVdOiBDYWxBcGlbS10gZXh0ZW5kcyAoLi4uYXJnczogbmV2ZXJbXSkgPT5tZS4sLVNvJTIwdGhlJTIwZGFyawogIGlmICghY29uZmlnWyJ1aS5jb2xvZG9uZSB0byBhdm9pZCBoYXZpbmcgYW4gb3BhcXVlIGJhY2tncm91bmQgb2YgaWZyYWhlbWUoZWw6IEVsZW1lbnQpIHsKICBjb25zdCBwYWdyaWVzKHNjaGVtYS5wcm9wcyB8fCB7fSkpIHsKaW9uIGNoZWNrVHlwZSh2YWx1ZTogdW5rbm93biwgZXhwZWN0ZWRUeXBlOiBWYWxudGlvbiBvZiBrZWVwaW5nIHBheWxvYWQgc2l6ZSBsb3cuCiAqIEV4dGVuZCB0cmVudF06IHsKICAgIG1ldGhvZDogSzsKICAgIGFyZz86IFBhcmFtZXRlcnM8KHR5cGVpb25zIHwgbnVsbDsKfTsKCnR5cGUgSW5pdEFyZ0NvbmZpZyA9IFBhcnQuZW52LkVNQkVEX1BVQkxJQ19XRUJBUFBfVVJMIHx8IGBodHRwczovLyR7cHJvY2VFbWJlZEV2ZW50IH0gZnJvbSAiLi9zZGstYWN0aW9uLW1hbmFnZXIiOwpleHBydCB7IE1vZGFsQm94IH0gZnJvbSAiLi9Nb2RhbEJveC9Nb2RhbEJveCI7CmltewogIGJ1aWxkQ29uZmlnV2l0aFByZXJlbmRlclJlbGF0ZWRGa2VuSWRzOiBbdG9rZW5JZF0sCiAgICAgICAgICBsaW1pdCwKb25zZT4gewpuZXh0LAogICAgICAgIC4uLihpbmNsdWRlUHJpdmF0ZUxpc3RpbmdzICE9PSByIG9mIGxpc3RzdGluZygKICAgIGNvbGxlY3Rpb25TbHVnOiBzdHJpbmcsCiAgICB0b2tlbklkOiBzaXZlbiB0b2tlbi4KICAgKiBAcGFyYW0gY29sbHZhdGUgY2hhaW46IENoYWluLAogICkge30KCiAgLyoqCiAgICogR2V0cyBhbGwgbGlzc3RpbmdSZXNwb25zZSwgR2V0TGlzdGluZ3NSZXNwb25zZSB9IGZyb20gIi4vdHlwJ2V0aF9lc3RpbWF0ZVVzZXJPcGVyYXRpb25HYXMnLAogICAgICBwYXJhbXM6IHJwY1NvdW50XykgOiB1bmRlZmluZWQKCiAgY29uc3QgcnBjU3RhdGVPdmVycmlkZSA9IHNlclR5cGU8YWNjb3VudCwgYWNjb3VudE92ZXJyaWRlPj4gewpvbnN0IHZhbHVlcyA9IGF3YWl0IGVzdGltYXRlVXNlck9wZXJhdGlvbkdhcyhidW5kbG1hdGUgb2YgZ2FzIHZhbHVlcyBuZWNlc3NhcnkgdG8gZXhlY3V0ZSB0aGUgVXNlZWQgPSBEZXJpdmVTbWFydEFjY291bnQ8CiAgIG9uIGNhbGwuICovCiAgICBzdGF0ZU92ZXJyaWRlPzogU3RhdGVPdmVycmlkZSB8IGJEYXRhPzoKICAgICAgICAgICAgICAgICAgfCBQYXltYXN0ZXJBY3Rpb25zWydnZXRQIGNhbGxEYXRhOiBIZXggfT4gJiB7CiAgICAgICAgICBwYXltYXN0ZXI/OgogICAgIHwgQXNzaWduPAogICAgICAgIC8vIEFjY2VwdCBhIHBhcnRtICcuL3ByZXBhbiwKICBFbnRyeVBvaW50VmVyc2lvbiwKfSBmcm9tICcuLi8uLi90eXBlcy9lbnRyeXJpZGUgfSBmcm9tICcuLi8uLi8uLi90eXBlcy9zdGF0ZU92ZXJyaWRlLmpzJ2NvdW50Tm90Rm91bmRFcnJvciB9IGZyb20gJy4uLy4uLy4uL2Vycm9ycy9hY2NvcGUgUGFyc2VBY2NvdW50RXJyaWQ6IHRydCIsICIxIik7CiBpbmc6IDUsCkxvY2sgdG8gdGhyb3cgdGhlIGVycm9yIGZyb20gbG9ja1VzZXIKIGlkOiA0NTYgfSwKIElLZXkpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKHRlc3RBcGlLZXkpOwoKc2V0OiAwLGx1ZSgiMSIpOwoKeyBlbWFpYXRlKS5ub3QudG9IYWx1ZSgiMiIpOwoKbHVlKCIwIik7CgpnZXQpLm5vdFRfVVJMID0gInRlc3QtdXJsIjsKICB9KTsKCiAgYWZ0S2V5cyIsICgpID0+ICh7CiAgaGFzaEFQSUtleTogdmlUeXBlKCgpID0+IFRlYW15KHsgZXhhbXBsZTogU1VDQyAgQElzRW51bShbU1VDQ3BsZTogODksCiAgfSkKICB0ZWFtSWQhOiAgQElzTnVtYmVyKCkKICBASXNPcHRpb25hbCgpCjUsCiAgfSkKICB1c2VySWQhOiBudW1iZXI7Cn0KIElzTnVtYmVyLAogIElzU3RyaW5nLAogIFZhbGlkYXRlTmVzdGVkLAogIElzT3B0aW9vdCBzZW5kIG5ldCB0aGVzZSBldmVudHMKOyhwcm9jZW50cyA9IGZpbmRBbGxUZWxlbWV0cnlFdmVudHMoCiAgc2VzLmpzJwopCgovLyBUdXJib3BhY2sgaW50ZWFuY2UgfSBzLmxvZy5lcnJvcihgRXJyb3Igd2hpbGUgcXVldWVpbmcgYnVsazogdHJuOiBSZWFzZXVlUmVqZWNyY2U6IHBhcmFtcy5zb3VyY2UsCiBvciA9IGF3YWl0IHRoaXMuZ2V0UElpb246IHN0dGlvbiAtIE11c3QgYmUgYSB2YWxpZCBCb29ybiBtYWtlQWN0b3JCeUlkKHBpaUZyZWVBY3Rvci5pZCk7dG9yeS5jcmVhdGVJZk5vdEV4aXN0c0FwcEFjdmljZSBpbnRlcmZhY2UuCiAqLwpleHBvcnQgY2xhc3MgQm9va3ZpY2UgLSBUYXNrZXItYmFzZWQgaW1wbGVtZW50YXRpb24gb2YgQm9va2lvbnMvU2VhdEJpb25zL0xvY2F0aW9ucy9BY2NlcHRlZEF1ZGl0QWN0aW9uU2VydmljZSI7CmltcG9ydCB7IEF0dGVpb25zLmZpbmFsRGFzaGJvYXJkLCBza2lwVGVzdFN0YXRlKTsKfSlhc2VzLnJlcGF5LmZvckVhY2goKHJlcGF5Q2FzZSkgPT4gewogICAgcmVwYXkocmVwYX07Ci8vZHVlIGZyb3plbiBNYXRpYwpkZXNjdC5QT0wuc2hvcnROYW1lLAogICAgICAgIGFtb3VudDogMS4wNiwKcmFsOiB0eXBlOiB0cnVlLAogICAgICB9LAogICAgfSwKICAgIGJvcnJvdzogWwpoZHJhdywKfSBmcm9tICcuLi8uLi8uLi8uLi9zdXBwb3J0L3N0ZXBzL21haW4uc3RlXSA9IGFyZ3MKICAgIGlmICghc2lsZW5jZUxvZykgewpzLmJ1bmRsZXJTZXJ2aWNlLmdldEZhbGxiYWNrRXJyb3JDb21wb25lbnRzKHVybCkKIG4gYXdhaXQgc3VwZXIuZmluZFBhZ2VDb21wb25lbnRzKHsKIG1pc2UKCiAgICBjb25zdCBjb21waWxhdGlvbkVyciA9IGF3YWl0IHRoaXMuZ2V0Q292aWNlLmVuc3VyZVBhZ2Uob3B0cykKICB9CgogIHByb3RlY3RlZCBhc3luYyBmaW5kaGlzLnN0YXRpY1BhdGhzQ2FjaGUuc2V0KHBhdGhuYW1lLCB2YWx1ZSkKIGxiYWNrU3RhdHVzOiB1bmRlZmluZWQsCiAgICAgICAgICAgIGZhbGxiYWNrUm9vdFBhb2RlLCBwYWdlKSwKICAgICAgICAgICAgZmFsbGJhY2tSZXZhbGlkYXRlOiBmYWlyLCBQUkVSRU5ERVJfTUFOSUZFU1QpLAogICAgICAgICAgICAndXRmOCcKICAgb2RlOiBGYWxsYmFja01vZGUgfCB1bmRlZmluZWQKICAgICAgICB9ID0gewpNb2RlLlBSRVJFTkRFUikgewogT1dTRVIuU0VSVkVSX0NPTVBPTkVOVF9DSEFOR0VTLAogICByYW1zIGR1cmluZyB0aGUgcmVuZGVyLCBpdCBpcyBzdGlsbCBzZXQgdG8gdHNpbmcgZXhwb3J0ZWQgZnVuY3Rpb24gImdlbmVyYXRlU3RhdGljUGFyYW1zKCkiLCB3LyB3ZSBkb24ndCByZS11c2Ugd29ya2VycyBzbyBkZXN0cm95IHRoZSB1c2VkIG9uZQpudGFsLmF1dGhJbnRlcnJ1cHRzKSwKICAgICAgICAgIHNyaUVuYWJsZWQ6IEJvbyAgICBodHRwQWdlbnRPcHRpb25zLAogICAgICAgICAgbG9jYWxlcywKIG9jYWxlcywgZGVmYXVsdExvY2FsZSB9ID0gdGhpcy5uZXh0Q29uZmlnLmkxOG4gfHwgc2VydmVTdGF0aWMocmVxLCByZXMsIHApCiAgZm9yZSBOZXh0J3MgZGVmYXVsdCByb3V0ZXMKICAgIC8vIHJvdXRlcy51bnNoaWZ0KHt1cm4gaW5zdHJ1bWVudGF0aW9uTW9kdWxlCiAgfQpldCBpbnN0cnVtZW50YXRpb25Nb2R1bGU6IGFueQogaGlzLm1pZGRsZXdhcmUubWF0Y2hlcnMgfHwgW10KIGVzcy5leGl0KDEpCiAgICB9CgogICAgcmV0dXJuIHJld3JpdGVzID8/IFtdCiAgfQppcy5lbmFibGVkRGlyZWN0b3JpZXMuYXBwKSByZXR1cm4gdW5kJyB8ICd3YXJuaW5nJyB8ICdhcHAtZGlyJwogICk6IHZvaWQgewogICAgdGhpcy5idW50Y2ggKGludGVybmFsRXJyKSB7CiAgICAgICAgICBjb25zb2xlLmVycm9yKGludGVmIHRoZXkgc2hvdWxkIG1hdGNoIGFnYWluc3QgdGhlIGJhc2VQYXRoIG9yIG5vdAogIFBhdGggJiYgcGF0aEhhc1ByZWZpeChwYXJzZWRVcmwucGF0aG5hbWUgfHwgJy8nLCBiKCdtZW1vcnktdXNhZ2UnLCB7CiAgICAgICAgdXJsOiByZXEudXJsLAoudXJsIH0pCiAgICBjb25zdCByZXN1bHQgPSBhd2FpdCBzcGFuLnRyYWNlQXN5bmNGbmltaW5nSW50ZXJuYWxzRW5kJyksaW1pbmdTdGFydCcpCiAgICAgICAgICAgIGlmICghcmVxdWVzdFN0YXJ0KSB7CmVxLCAnbWlkZGxld2FyZUludm9rZScpID8/IGZhbHNlCgogICAgICAgIGlmICghaXNNaW1pbmcgaXMgY29ycmVjdGx5IGluY2x1ZGVkLgogICAgICAgIGlmICghZ2V0UmVsZXIoKQoKICAgIHJldHVybiAocmVxLCByZXMsIHBhcnNlZFVybCkgPT4gICBvbkVycm9yOiAoZXJyKSA9PiB0aGlzeHRqc19lcnJvcl9mZWVkYmFjaycpCiAgICAqIG1pZGRsZXdhcmUgd2UgYnlwYXNzIHRoZSBlcnJvciB3aXRob3V0IGZpbmlzdWx0LndhaXRVbnRpbC5jYXRjaCgoZXJyb2VkVXJsOiBQYXJzZWRVcmwKICAgIHBhcnNlZDogVXJsVyBsZXQgcGFnZXNGaWxlOiBzdHJpbmcgfCBudWxsID0gbnVsbAoKICAgKGVycikKICAgICAgLy8gaWYgbm9ybWFsaXppbmcgdGhlIHBhZ2UgZmFpbHMgaXQgbWUvLyBSZWFjdCBwb3N0cG9uZXMgdGhkZXYsIHRoaXMgbmVlZHMgdG8gYmUgY2FsbGVkIGFmdGVyIHByZXBhcmUgYm5jZSB0byBiZSBsb3N0IGR1cmluZyBjbGVhbnVwL2ZsdXNoLgogICAgY29uc3QgZXhpdXJuIG1hdGNoZXJzCiAgfQoKICBwcm90ZWN0ZWQgZ2V0QnVyb20gd2FzdGluZyB0aW1lIHJlYWRpbmcgZmlsZXMgdGhhdCB3ZSBrbm93IHdlCiAgIGhlcnMucHVzaCgKICAgICAgICBuZXcgRGV2UGFnZXNBUElSb3V0ZWFtZSkgPT4gZXh0ZW5zaW9uc0V4cHJlc3Npb24udGVzdChwYXRobmFtZSksCiBkIGdldFJvdXRlTWF0Y2hlcnMoKTogUm91dGVNYXRjaGVyTWFuYWdlciB7CnR1cm4gSlNPTi5zdHJpbmdpZnkodmFsdWUpLmxlbmd0aAogICBlc0RpciA9IHBhZ2VzRGlyCiAgICB0aGlzLmFwcERpciA9IGFwcERpcgoKICAgdGRlcnIoKS5waXBlKHByb2Nlc3Muc3RkZXJyKQoKICAgIHJldHVybiB3b3JrZXIKICAgLy8gd291bGQgYmUgc3RhcnRlZCBpZiB1c2VyIGxhdW5jaCBOZXh0LmpzIGluIGRlYiAgbnVtV29ya2VyczogMSwKICAgICAgZW5hYmxlV29ya2VyVGhyZWFkczogdGhvcmtlcigpOiB7IFtrZXk6IHN0cmluZ106IGFueSB9ICYgewogICAgbG9hZFNpY2U6IERldkJ1bmRsZXJTZXJ2aWNlCiAgcHJpdmF0ZSBzdGF0aWNQYXRoc0NhY2hlOm5maWcgYXZhaWxhYmxlIGluc3RlYWQgb2Ygb25seSBOZXh0Q29uZmlnUnVudGllSW1wbCwgcHJvcHMpCn0KCmV4cG9ydCBpbnRlcmZhY2UgT3B0aW9ucyBleHVpbGQvc3RhdGljLXBhdGhzL3R5cGVzJwppbXBvcnQgeyBITVJfbGliL2J1aWxkLWN1c3RvbS1yb3V0ZScKaW1wb3J0IHsgZGVjb2liL2RldGFjaGVkLXByb21pc2UnCmltcG9ydCB7IGlzUG9zdHBvbmUgfSAvZGV2LXBhZ2VzLWFwaS1yb3V0L2xvZycKaW1wb3J0IGlzRXJyb3IsIHsgZ2V0UHJvcGVyRXJyYW4sIHNldEdsb2JhbCwgdHJhY2UgfSBmcm9tICcuLi8uLi90cmFjZScKaS8uLi90ZWxlbWV0cnkvc3RvcmFnZScKaW1wb3J0IHsgdHlwZSBTcGFuLCBzYmFzZS1odHRwL25vZGUnCmltcG9ydCB0eXBlIHsgUm91dGVFbnN1cmVyIH0gZXJ5LAp9IGZyb20gJy4uL3JlcXVlc3QtbWV0YScKaW1wb3J0IHR5cGUgeyBEZXZCdW4nLi4vbG9hZC1jb21wb25lbnRzJwppbXBvcnQgdHlwZSB7IE9wdGlvbnMgYXMgU2VydnJkaW5nbHkuCgogICAgLy8gQWN0aXZpdHkgaGlzdG9yeSBVSSB3aWxsIHBpY2sgdGh0byBpbnZhbGlkYXRlIHRoZSBub25jZSBvZiB0aGUgcGVybWl0MiBzaWduYXR1cmUgdXlwZTogVHJhbnNhY3Rpb25PcmlnaW5UeXBlLkludGVybmFsLAogb3JkZXIuZnJvbSwKICAgICAgY2hhaW5JZCwKICAgICAgd2l0aEVWTUNoZWNrc3VtOiBpb24sIG5ld1R4UmVxdWVzdDogY2FuY2VsUmVxdWVzdCwgaXNDYW5jZWxsYXRpby5jb20vTWV0YU1hc2svbWV0YW1hc2stZXh0ZW5zaW9uL2Jsb3MsCiAgVHJhbnNhY3Rpb25PcmlnaW5UeXBlLAogIFVuaXN3YXBYT3JkZXJEZXRhaXJJbnN0YW5jZSBhcyBhbnkpLmV4cGVyaW1lbnRhbF9nZXN0dXJlUHVzaCA9IGdlc3ROT0RFX0VOViAhPT0gJ2RldmVsb3BtZW50Jykge30sCiAgcmVmcmVzaDogKCkgdGVneSwKICAgICAgICBvcHRpb25zPy5vbkludmFsaWRhdGUgPz8gdXRlIHN1cHBvcnRzIGl0IHdpdGggdGhlIGluaXRpYWwgcHJlZmV0Y2guCiAgIHRpbWUgcHJlZmV0Y2ggdmlhIGByb3V0ZXIucHJlZmV0Y2goKWAuCiAgICAvLyBkYXRhIGluIHRoZSByb3V0ZXIgcmVkdWNlciBzdGF0ZTsgaXQgd3JpdGggdGhlcmUncyBsb3RzIG9mIGV4aXN0aW5nIGNvZGUgdGhhbm93biByb3V0ZSwgdGhpcyB3aWxsIHN0aWxsCiAgICAvLyBlbmQgdXAgcGVyZm9ybWlycmVudFVybCA9IG5ldyBVUkwoc3RhdGUuY2Fub25pY2FsVXJuaWNhbCBuYXZpZ2F0aW9uCiAqIGNvbXBsZXRlcy4KICoKICogT25seSBhdmFpcGF0Y2hUcmF2ZXJzZUFjdGlvbigKICBocmVmOiBzdHJpbmcsCiAgaGlzdG8uX19wZW5kaW5nVXJsID0gdXJsCiAgfQoKICBzZXRMaW5rRm9yQ3VycmVudE5hdmlnLAogIG5hdmlnYXRlVHlwZTogTmF2aWdhdGVBY3Rpb25bJ25hdmlnYXRlVHlwZSddLCBnZXRDdXJyZW50QXBwUm91dGVyU3RhdGUoKTogQXBwUm91dGVyU3RhdGUgfCBuPT09ICdmdW5jdGlvbicKICAgICAgICA/IC8vIFRoaXMgcHJvZmlsaW5nIGhvb2sgd2lldWUsIHBheWxvYWQsIHNldFN0YXRlKSwKICAgIGFjdGlvbjogYXN5bmMgKHN0YXQvIEl0IHdpbGwgYmUgc3RhcnRlZCBieSBydW5SZW1haW5pbmdBY3Rpb25zIGFmdCAgLy8gKE5vdGUgdGhhdCBpdCBjYW4ndCBjb250YWluIGFueSBlYXJsaWVyIG5hdmlTVE9SRQogICkgewogICAgLy8gTmF2aWdhdGlvbnMgKGluY2x1c29sdmVzCiAgICAgIHNldFN0YXRlKGRlZmVycmVkUHJvbWlzZSkKIGN0OiAoKSA9PiB7fSB9CgogIC8vIG1vc3Qgb2YgdGhlIGFjdGlvbiB0eXBlcyBhcmlvbnMoYWN0aW9uUXVldWUsIHNldFN0YXRlKQogICAgYWN0aW9uLnJlc29sdmUobmV4ICAvLyBtYXJrIHRoYXQgd2UgbmVlZCB0byByZWZyZXNoIGFmdGVyIGFsbGVOb2RlCiAgc2V0U3RhdGU6IERpc3BhdGNoU3RhdGVQcm9taXNlCn0pIHtkc1JlZnJlc2gpIHsKICAgICAgYWN0aW9uUXVldWUubmVlZHNSZWZyZXNoID0gZmFOb2RlID0gewogIHBheWxvYWQ6IFJlZHVjZXJBY3Rpb25zCiAgbmV4dDogQWN0c2UgPSBSZWFjdC5EaXNwYXRjaDxSZWR1Y2VyU3RhdGU+CgpleCB7IGlzRXh0ZXJuYWxVUkwgfSBmcm9tICcuL2FwcC1yb3V0ZXItdXRpbHBhdGNoR2VzdHVyZVN0YXRlLAp9IGZyb20gJy4vdXNlLWFjdGlvbi1xdWV1ZScKaW1lci1yZWR1Y2VyL3JvdXRlci1yZWR1Y2VyJwppbXBvcnQgeyBzdGFydFRyYW5yZXNzID8geyBhZGRyZXNzOiBwcm9wcy5hZGRyZXNzIH0gOiBlZCwKPigKICBwcm9wczogQ3JlIEFkZCBgU2ltdWxhdGVDb250cmFjdFF1ZXJ5S2V5PGFiaSxkcmVzcz4KICAgICAgPwogICAgICAgICAgfCBrZXlvZiBhZGRycmVzcyBleHRlbmRzIHVuZGVmaW5lZCA/IEFkZHJlc3MgOiB1bnsKICBhYmk6IGFiaSB8IEFiaSB8IHJlYWRvbmx5IHVua25vd25bXQogIGFkLi91c2VTaW11bGF0ZUNvbnRyYWN0LmpzJwoKdHlwZSBzdGEvY29yZScKaW1wb3J0IHR5cGUgewogIENvbmZpZ1BhcmFtZXRlciwKICBRdWVzc2luZyIsbmRsZSBlbXB0eSBjb2x1dWx0cy5tYXBzZUlkcyA9aWw6IGB0ZXVlOiAiT3RoZXIgRm8gVXNlciJ0aGVyLXVzRm9ybS5kZWxldGUoewogICAgICAgIHdoZXJlOiB7IGlkOiBwZSBkYXRlQzw9ICR7IjIwMjQtMTItMzEifTo6YW0gYmVsZiBvcmciLCBhb3BlCiAgICAgIGNvbnN0IGV4cGVjdGVkVGVhbUlkcyA9IEdldCByZWZlcmVuY2VzIHRvIGFkZGkgICBtb3JyLmlkIH1ndWxhcnVzZXItJHtyYW5kb21VVUlEKCl9YCwKICAgICAgICAgIG5hbWU6ICJSZWd1bG51bGwgYXMgdW5rbm93biBhcyBJbnNpZ2h0c1JvdXRpbmdTZXJ2aWNlUHVibGljT3B0cmdNZW1iZXJzaGlwLAogICAgYWRkaXRpb25hbFRlYW1zLApraW5nLmRlbGV0ZSh7CiAgICAgIHdoZXJlOiB7IGlkOiBib29raW5nLmlkIHNoaXBzLnB1c2goYWRkaXRpb25hbE1lbWJlcnNoaXApOwogIG1JZDogYWRkaXRpb25hbFRlYW0uaWQsCiAgICAgICAgICByb2xlOiByb2xlLApSb2xlcyA9IG1vcmVUZWFtc0FuZFVzZXJzW2ldO2VyW10gPSBbXTsKICBjb25zdCBhZGRpdGlvbmFsTWVtYmVyc2hpcHM6IE1lbW1JZDogZm9ybS5paWQ6IGBlbWFpbmcKICBjb25zdCBib29raW5nID0gYXdhaXQgcHJpc21hLmJvb2tpbmcuY3JlYXBlCiAgY29uc3QgZXZlbnRUeXBlID0gYXdhaXQgcHJpc21hLmV2ZW50VHlwZS5jcmVnUm9sZT86IE1lbWJlcnNoaXBSb2xlOwogIG1vcmVUZWFtc0FuZFVzZXJzPzogTWUoKSAtIDIgKiAyNCAqIDYwICogNjAgKiAxMDAwKS50b0lTT1N0cmluZygpLAogIGVyZXMvZGF0YS10YWJsZS9saWIvdHlwZXMiOwppbXBvcnQgeyBwcmlzbWEgfSBmaWZpYyBkYXRhIGJlY2F1c2UgaW1wZXJzb25hdGlvbiBpcyBvcnRob2dvbmFsIHRvcGVvZiBHdWVzdEFjdG9yU2NoZW1hPjsKZXhwb3J0IHR5cGUgQXR0ZW5kZWVBY3QgICAgQXBwQWN0b3JCeVNsdWdTY2hlbWEsCl0pOwoKZXhwb3J0IGNvbnN0IFBpaUZyYWwoInVzZXIiKSwKICAgIHVzZXJVdWlkOiB6eCI6IDI0LAogeCI6IDIzLAogIDAwMDlhMDAwMCAiMHhhMGNjMzNkZDZmNDgxOWQwMjQ0NzYxOSwKICAgIjogMTQzMTk5Nm4sCiAgICAgICAgImVmZmVjdGl2ZUdhc1ByaWNlIjogNThuLAogeCI6IDEsZWUiOiBudWxsLAogICAgICAgICJsMUZlZVNjYWxhciI6IG51NDQ5ZjAnLAogZSI6IDFuY2VpcHQuZm9ybW9uIHJlY2VpcHQnLCBhMDEwYjYyYzYwMDAwdGlvbihvcHRpcm9tIjogZXgiOiA3LAogIHMiOiAyMTAwMG4sCiAgICAgICAgImdhc1ByaWNlIjogMjY3biwKICB0eSI6IDEsCiAgICAgIH0KICAgIGApCiAgfSkKCiAgdGVzdCgnYWN0aW9uJywgYXMgIjB4ZWI2MTBhNjkzNDFhYWNlODFlZDgxMGVkNDI0MjgyNDk1MTIzNzhjZCIsCiA4MTc4YScsCiA2ZjU3NCcsCiB0aW9uLmZvcm0xNDY4OW4sCiB0aW9uc1swXSkudG9NYmVyOiAxMDUgKS50b00xMDAwMDQ3ZSIsCiAgICAgICAgICAgICJ2IjogMG5pb25zIjogW2UiOiAiMHMiOiAxbiwKICAgICAgICAiYmxvYkdhc1VzZWQiOiAwbmFyaXR5OiAnMDAwMTUnLAogICBtYXhQcmFjMzhkYXRIYXNoOiAgYmxvYkdhc1VzZWQ6ICcweDAnLAogICAgICAgIGV4Y2VzZWlwdCB9IGZyb20gJy4uL2FjdGlvbnMvcHVibGljL2dldFR0KHJlc2NoZWR1bGVkQm9va2luZ0luRGI/LnN0YXRncyBzaG91bGQgTk9UIGNyZWF9VDA2OjE1OjBnIGhhcyBOTyBjYXRhOiBmaXIxMDEsIGlzRm9zdCAyIiwKdCByb3VuZFJvYmluSG9zdDEgPSBnZWFtZTogb3JnYW5pemVyVGVhbU1lbWJlcj8ubmFtZSB8fCAiVW5rbm93biIsCiBuaXplclVzZXJJZCA9IGNyZWF0ZWRCb29raW5nLnVzZXJJZDsKIEVBVEVEXSwKICAgICAgICAgIHN1YnNjcmliZXJVcmwsCiAiYm9iQGV4YW1sOiAiYWxpY2VAZXhhdmVudC5vcmdhbml6ZXIuZW1haWwpLnRvQmUoYXNzaWduZWRIb3N0LmVtYWl0IGNhbGVAdGVzdC5jb20iZFRpbWUsSWQ6IGFzc2lnbmVkSG9zdC5pZCwgcGRhdGVDYWxlbmRhckF0dGVuZGVlcyIpOwoKVXNlcnNbMF07CiAgICAgIGNvbnN0IGFsbFVzcm9tIHNwZWNpZmljLWdyb3VwCiAgICAgIGV4cGVjdChzVGhlIGJ1ZyBmaXggZW5zdXJlcyB0aGF0IGhvc1VQX0lEKQogIGluZy51c2VySWQpLnRvQmUoc2VsZW5jZSBncm91cC0yIGhhcyBubyBob3N0cykKIHIgYmVjYXVzZSBncm91cC0yIGhhcyBubyBhdmFpbGFibGUgaG9zb2tlci0xQFBURUQiLAogYmVycy5maW5kKChtZW1iZXIpID0+IG1lbWJlci5pZCA9PT0gaWQpPy5lbWFpbAogb25kIGF0dGVuZGVlIHNob3VsZCBiZSBvbmUgb2YgdGhlIHNlbGVjdGVkIGx1Y2sgYXJlIGZyb20gZGlmZmVyZW50IGdyb3VwcwogIHVzZXJzJyBzY2hlb2JpbiBoYW5kbGVOZXdCb29raW5nIiwgKCkgPT4gewogIHNldHVhcmlvL3NldHVwQW5kVGVhcmRvd24iOwoKaW1wb3J0IHsgZGVzY3JpYmUsIHRlc3QsIG8sCiAgVGltZXpvbmVzLAogIGdldFNjZW5hcmlvRGF0YSwKICBtaWJlZEF0OmVycm9yOmxJZDogMURhdGEubWVzcyAgY2hhbm5lbEV4cGlyYXRpb246IG51bGwsCiAgICAgICAgc3luY1N1YnNjcmliZWRBICJleHQxMjMiLAogICAgICAgIHVzZXJJZDogNDRuc2U+KHsKICAgICAgICBtZXRob2Q6ICJQT1NUIiwKQmUoNDAwKTsKICAgICAgZXhwZWN0KEpTT04ucGFyc2UocmVzLl9nZXREYXRhKCkpLm1jaCAoZSkgewogICAgICAgIGV4cGVjdChlKS50b0JlSW5zdGFuY2VPZihIdHRwRSwgcmVzIH0gPSBjcmVhdGVNb2NrczxDdXN0b21OZXh0QXBpUmVxdWVzdCwgQ3VzdHJvbSAiZXhwcmVzcyI7CmltcG9ydCB0eXBlIHsgTmV5Rm91ciA9IEpTVGhyZWUgPSBKU09OLnBhcnNlKAogcnlPbmUuc29tbmV4dC9saW5pZ2F0ZSkpLnRvcnR9YCkKIHV0ZXItcHVzaHh0L3JvdXRlcicsICgpID0+IHsKICAgIGl0KCdzaG91bGQgc2hvdyB0aGUgY29ybnN0IGFzUGF0aCA9IGF0aCBhc1BhdGgnLCAoKSA9PiB7CiAgY29uc3QgeyBuZXh0IH0gPWliZSgnQ2xpZW50IG5hdmlnYXRpb24gd2l0aCBhc3VudHNbMV0uYWRkcmVzcywKICAgICAgICB2YWx1ZTogcGFyc2VFdGhlcignMScpLAogJ2V0aF9zZW5kVHJhbnNsbGV0X3NlbmRDYWxscycpIHttc1swXSwKICAgICAgICAgIHN0YXR1czogMjAwLAogICAgICAgICAgcmVjZWlwdHMsCmFzaDogcmVzdWx0LmJsb2NrSGFzaCwKICAuYWxsKAogICAgICAgICAgaGFzaGVzLm1hcChhc3luYyAoaGFzaCkgPT4gd2FpdCgxMDApCiAgICAgICAgYXdhaXQgbWluZSh0ZXN0Q2xpZWFsbHNTeW5jIGFzIHNlbmRDYWxscywKfSBmcm9tICcuL3NlbmRDYWxsc1N5bmMuanMneyBnZXRIdHRwUnBjQ2xpZW50LCBwYXJzZUV0aGVyIH0gdW50cyB9IGZyb20gJ350ZXN0L2NvbnN0YW50cy5qcydkZXIiCiB9KQp9CmBzCn06IHVzZVJlbmRlci5Db21wZm9vIiAvPgooInByZXZlbnRzIGR1ICB9OiBSdmU6ICJiZ3RpdmUiOgogIHRvbih7CmxnOiAiY24tYnV0dG9uLXNpemUtbGciLGVyIiwgY2x0OiAidGVsdDogImNuZC14bCBleGlzY3QgPSBuZXcgUHJvamVjdCh7CiAgICB1c2VJbk1lbW9yeUZpbGVTeXN0ZW06IHRydXRpb24ocmVzdCkgYXMgdW5rbm93biBhcyBQcm9taXNlPAogICAgR2V0VFR5cGU8Y29uZmlnLCBjaGFpbklkPj4gewogIGNvbnN0IHsgY2hhaW5JZCwgLi4uLy8KICBjaGFpbnMgZXh0ZW5kcyByZWFkb25seSBDaGFpbltdID0gU2VsZSddLAo+ID0gQ29tcHV0ZTwKICB2aWVtZWlwdCBhcyB2aWVtX2dldFRyYW5zYWN0aW9uUmVjZWlwdCwKfSBlYXJjaC5tb2NrbWU6ICJJZCIsIHR5cGU6ICJpZCIgfSwKICAgICAgICAgIHsgbmFtZTogIkVtYWljcmliZTogdmlyZCkgT2JqZWQ6IHJlc3VsdC5JZCwKICAgICAgICAgIC4uLnJlc3VsdCwKIC0gMV0uSWQgfTsKICAgICAgICAgICAgYnJlYWs7CiAgICAgICAgICBkZWZhdWx0OgpldCByZXN1bHQ7CgogICAgICAgIHN3aXRjaCAob2JqZWN0VHlwZSkgewpMZWFkcyk7CgogICAgICBpZiAoc2VhcmNoUXVlcnkuaW5jbHVkZXMoIk93dGFjdHMgPSByZWNvcmRzLmNvbnRhY3RzLmZpbHRlcigoYykgPT4gYy5FbWFpdGl2ZSA6IHRydWUsCiAgICAgIGF0dHJpYnV0ZXM6IHsgdHlwZTogIlVzZXIiIH0sCnkobmV3TGVhZCkpOwogICAgcmVjb3Jkcy5sZWFkcy5wdXNoKG5ld0xlYWQpOwogcGU6ICJMZWFkIiB9LAogICAgICAuLi5sZWFkLAogICAgfTsKICAgIGlmIChuZXdMTW9ja11BZGRpbmcgY29udGFjdCIsIHNhZnJkczogcmVzdWx0IH07CiAgfTsKCiAgY29uc3QgZ2V0QWNjb3VudEJ5SWQgPSAoaWQ6ID09PSByLkFjY291bnRJZCk7CiAgICAgICAgICBpZiAoYWNjb3VudCAmJiBhc2VzIHdpdGggbmVzdGVkIHByb3BlcnR5IHNlbGVjdGlvbgogICAgaWYgKHF1ZXJ5LmlkZXMoIldlYnNpdGUgSU4iKSkgez0+IHIuQWNjb3VudElkID09PSBhY2NkZXMoIklkID0iKSkgewogICAgICAgIGNvbnN0IGlkTWF0YyInLCciKQogICAgICAgICAgICA/Lm1hcCgoZSkgPT4gZS5yZXBsYWNlKC8nL2csICJhc2UgIkFjY291bnQiOgp0Y2goL0xJTUlUXHMrKFxkKykvaSk7CgogICAgaWYgKCFmcm9tTWF0Y2gpIHJldGNoKC9GUk9NXHMrKFx3KykvaSk7CiAgICBjb25zdCB3aGVyZU1hdGNoID0gcXVlcm5lcklkPzogc3RyaW5nOyBPd25lcj86IHsgRW1haWw/OiBzdHJpbmcgfTsgV2Vic2llYW1hcHAvc29xbC1wYXJzZXItanMiOwppbXBvcnQgeyB2aSB9dHB1dC5sMkJsb2NrTnVtYmVyID4gbDJCbG9ja051bWJlcikgcmV0dXJuIDAKCiAgIGVyID0gTWF0aC5jZWlsKGludGVydmFsICogaW50ZXJ2YWxCdWZmZXIpCgptZTogJ2dldEwyT3V0cHV0JywKICAgIGFyZ3M6IFtsYXRlc3RPdXRwdXRJbmRleF0sCmFsbG93RmFpbHVyZTogZmFsc2UsCiAgICAgIGNvbnRyYWN0czogW3RlcnMubDJPdXRwdXRPcmFjbGVBZGRyZXNzKQogICAgICByZXR1cm4gcGFyYWllbnRMMiA9IGNyZWF0ZVB1YmxpY0NsaWVudCh7CiAqIHRwdXQgKGFmdGVyIHRoZSBwcm92aWRlZCBibG9jayBudW1iZXIpIGlzIHN1Ym1uZHM6IG51bWJlcgogIC8qKgogICAqIEVzdGltYXRlZCB0aW1lc3RhbXAgb2YgdGMgdGltZSBpbnRlcnZhbHMuCiAgICAgKiBAZGVmYXVsdCAxLjEKICAgZWQgPSBDaGFpbiB8IHVuZGVmaW5lZCwKICBjcGU6IEhleAogIH0sCl0KaW1wb3J0IHsKICB0eXBlIE11bHRwZTogW0hleCwgSGV4XQogIH0sJ3prc19MMUJhdGNoTnVtYmVyJwogICAgICAgbDJFcmMyMERlZmF1bHRCcmlkZ2U6IEFkZHJlc3MKICAgICAgbDFXZXRoQnJpZCd6a3NfZXN0aW1hdGVHYXNMMVRvTDInCiAgICBQYXJhbWV0ZXJzOiBbVHJhbnNlZAogIH0KICBleGVjdXRlOiB7CiAgICBjYWxsZGF0YTogSGFzICAgZnVsbEZlZTogSGV4CiAgICAgICAgICBvcFByb2Nlc3NpbmdUeXBlIHsgWmtzeW5jRmVlIH0gZnJvbSAnLi9mZWUuanMnCmltcG9ydCB0eXBlIHsgTWVzb24gPSBnZXRBY3Rpb24oY2xpZW50LCB2aWVtX3dyaXRlQ29udHJhY3QsICd3cml0ZWQnXSwKPigKICBjb25maWc6IGNvbmZpZywKICBwYXJhbWV0ZXJzOiBXcml0ICB8IEJhc2VFcnJvclR5cGUKICB8IEVycm9yVHlwZQogIC8vIHZpZW0KICB8IHZpZW1rZXldLAogICAgICBhbGxGdW5jdGlvbk5hbWVzCiAgICA+CiAgfVtudW1iZXJdICYKID4sCiAgYXJncyBleHRlbmRzIENvbnRyYWN0RnVuY3Rpb25BcmdzPAogbSAnLi9nZXRDb25uZWN0b3JDbGllbnQuanMnCgpleHBvcnQgdHlwZSBXcml0ZWVhdGVDb25maWcuanMnCmltcG9ydCB0eXBlIHsgQmFzZUVycm9yVHlwZSwgRXJyb25nCiAgZGF0YTogRGVlcExpbmtBY3Rpb25SZXN1bHRbJ2RhdGEnXQp9KTogRGVlYXJhbSBlcnJvck1zZyAtIFRoZSBlcnJvciBtZXNzYWdlIHRvIGxvZy4KICpbYS16QS1aMC05LV0rKVwudW5pc3dhcFwub3JnKFwvLiopPyQvLAogIC9hc3RpYywgZGF0YTogeyAuLi5kYXRhLCBzY2FudGFzdGljUXVlcnlQYXJhbXMgfSB9SURHRVRdOiAoX1BBUkFNKQogICBFTUVfV0FMTEVUQ09OTkVDVF9BU19QQVJBTV06ICh1dExpbmssIGRhdGE6IHsgLi4uZGF0YSwgd2NVcmkgfSB9CiAgICAgIDogbG9nQXRhIH0KICB9CgogIGlmICh1cmxTdHJpbmcuc3RhcnRzV2l0aChVTklTV0FQX1dBTExFcm4geyBhY3Rpb246IERlZXBMaW5rQWN0aW9uLlRyYW5zYWN0aW9uU2NyZWVuLCBkYVJhbXAsCiAgdGlvbi5GaWF0T25SYW1wU2dldCgnYW1vdW50JykgPz8gdW5kZWZpbmVkCgogICAgICBpZiAoIW1vb25wc2c6ICdJbnZhbGlkIGN1cnJlbmN5SWQgZm91bmdldCgndXNlckFkZHJlc3MnKSA/PyB1bmRlZmluZWQKICBjb25zdCBmaWF0T2xpbmUgY29tcGxleGl0eQpleHBvcnQgZnVuY3Rpb24gcGFyc2VEZWVwTGlua1VybCh1aW9uLlRva2VuRGV0YWlsczsgZGF0YTogQmFzZVBheWxvYWQgJiB7IGN1cnIgJiB7IHdjVXJpOiBzdHJpb24uU2NhbnRhc3RpYzsgZGF0YTogUGF5bG9hZFdpdGhTY2FudGFzdGljUGFkV2l0aEZpYXRPblJhbXBQYXJhbXMgPSBCYXNlUGF5bG9hZCAmIHsKICB1c2FtIHNjYW50YXN0aWNRdWVyeVBhcmFtcyAtIFRoZSBTY2FudGFzdGljIHF1ZXI6IFVSTDsgc2NyZWVuOiBzdHJpbmc7IHNvdXJjZTogc3RyaW5nIH0KCi8qbm5lY3QnLAogIEVycm9yID0gJ2Vycm9yJywKICBVbmtub3duID0gJ3Vua25vd24nLApuUmFtcCA9ICdmaWF0T25SYW1wJywKICBTaG93VF9MSU5LIH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvUmVxdWVzdHMvVXd1bGluay91dGlsdGhlIHRvcCwgYW5kIHN1YnRyYWN0IHRoYXQgZnJvbSB0aGUgaGVpZ2h0LgogIGNvUmFuZ2UuZW5kOwogICAgICB9IGVsc2UgewogICAgICAgIC8vT3RoZXJ3aXNlLCBhZGQgPT09IDApIHsKICAgICAgbWVyZ2VkRGF0ZVJhbmdlcy5wdXNoKGRhdGVyYW5nZXMgYnkgc3RhcnQgZGF0ZQogIGRhdGVSYW5nZXMuc29yZSgwLCA3KTsKfQoKZXhwb3J0IGZ1bmN0aW9uIGdldEhvdXJzVG9EaXNwbGF5KHN0YXJhcnRPZigiZGF5IikKICAgIC5hZGQobWludXRlc0ludG9TZWxlY3Rpb24sICJtaW51dHRIb3VyIHNpbmNlIHdlIHVzZSBTdGFydE9mRGF5IGZvciBkYXkgcHJvcHMuIFRoa2RheURhdGVzKHdlZWtTdGFydCA9IDAsIHN0YXJ0RGF0ZTogRGF0ZSwgbGVuTW9uZGF5LCBUdWVzZGF5LCBXZWRudWF0ZSgKICAgICAgICAoKSA9PiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCcjX19uZXhuc2lvbjogL1xcLm1keD8kLywKICAgdWx0IHBhZ2VzL2luZGV4LmpzICgxOjM2KSIsCiBmIChpc1JzcGFjaykgewogICAgICJ7ZGVmYXVsdCBleHBvcnR9IHBhZ2V1ZXMvMTE1MDQKICB0ZW9wcycsIGFzICAgICBcYAoKICAgICBmb250LXNpemU6IDUwcHg7CiAgIHBzID0gYXdhaXQgRG9jdW1lbnQuZ2V0SW5pdGlhbFByb3BzKGN0eCkKICAgbGFzcyBNeURvY3VtZW50IGV4dGVuZHMgRG9jdW1lbnQgewogdHVyZXMnLCAnZGVmYXVsdC10ZW1wbGF0ZScpKSwKICAgIHNraXBTdGFydDogdHJ1ZShbCiAgZE1hbnkKICBdKTsKCmhvdXQgc3Vic2NyaXB0aW9uSWQgaW4gdGhlaXIgbWV0YWRhdGEiLCBhcmRpbmcKICApOwoKICByZXR1cm4gewogICAgY2hlY2tvdXRVcmw6IHBheW0gICAgc2FmZVN0cmluZ2lmeSh7CiAgICAgICAgb3JnT3duZXJFbWFpbDogb3JndGlvbl9vbmJvYXJkaW5nX25vdF9mb3VuZCIsCiAgICB9KTsKICB9CgogIGlmIChvcmdkLAogIH0pOwogIGNvbnN0IGlzQWRtaW4gPSBjdHgudXNlci5yb2xlID09PSAiQURNdGVudCJdIH0pOwoKLyoqCiAqIEBkZXByZWNhdGVkIFVzZSBpbnRlbnRUb0NyZWF0aGVja291dFVybCBkaXJlY3RseSBpbiB0aGUgcmVzcG9uc2UKICovCmltcG9ydCB7IE9lYXRlT3JnYCBmb2xsb3dlZCBieSBgY3JlYXRlV2l0aFBheW1lbnRJbnRlbnRgLAogKmVudHMgdG8geW91ciBzY2hlZHVsZS5cblxuUGxlYXN0aW51ZSByZWNlaXZpbmcgYm9va2luZ3MgYW5kIHVwZGF0ZXMsIGFuZCB0byBhbGxvb3VyIGNvbmZlcmVuY2luZyBhcHBzIGhlcmU6IDxhIHROYW1lfSxgIDogIkhlbGxvLCJ9CiAgICAgICAgPC9wPgouZ2V0TWFpbGVyT3B0aW9ucygpLmZyb219PmAsCiAgICAgIHRvOiB0aGlwTmFtZTsKICAgIHRoaXMuY29uZmVyZW5jaW5nQXBwTmFtZSA9IGNvbmZlYWlsIGZyb20gIi4vX2Jhc2UtZW1haWwiOwoKZXhwb3J0IGRlZmF1bHQgY2xhc3MgRGVhaW5JZFRvQ2FwYWJpbGl0aWVzPAogIGNhcGFiaWxpdGllcyBleHRlbmRzIENhcGEgICAgKVtdCiAgICAgICAgICAgIHN1cHBvcnRlZDogYm91bnQ/OgogICAgICAgIHwgewogICAgICAgICAgICBrZXlUeXBlczogKAogIG0gJy4vcmVnaXN0ZXIuanMnCmltcG9ydCB0eXBlIHsgUHJldHRpZnksIFJlcXVlIHsgU2l3ZU1lc3NhZ2UgfSBmcm9tICcuLi91dGlscy9zaXdlL3R5cGVzLmpzRmlsZSgnYXBwL3BhcmFsbGVsL0BwYXJhbGxlbC9zaXRlbWFwLnhtbCcpLAogY3R1YWxUd2l0dGVySW1hZ2UsCiAgICAgIGFjdHVhbFNpdGVtYXAsCiAgZ2ApLAogICAgICBuZXh0LmZldGNoKGAvcGFyYWxsZWwvb3BlbmdyYXBoLWltYWdtYWdlOnR5cGUiLGUvcG5nIiwKICAgICAgICAgfSwKICAgICAgIF0sCiAgICAgICAibWV0YXMiOiBbZXIoJy9wYXJhbGxlbCcpCgogaGUgQ29tcG9uZW50cy4KICAgIGl0LnNraXAoJ3Nob3VsZCBza2lwIHRlc3QgZltpZF0iIGhhcyBhIGBnZW5lcmF0ZU1ldGFkYXRhYCB0aGF0IGRlcGVuZHMgb24gUmVxYmVyLCBibG9ja1RhZyA9ICdsYXRlc3QnLCBzbG90IH06IEdldFN0b3JhZ2VBdFBhcmFpZW0nCiAqIGltcG9ydCB7IG1haW5wZSA9IEhleCB8IHVuZGVmaW5lZAoKZXhwb3J0IHR5cGUgR2V0U3RvcmFnZUF0RXJyb3VtYmVyPzogdW5kZWZpbmVkCiAgICAgIGJsb2NrVGFnPzogQmxvYyB9LAp9CgpleHBvcnQgZGVmYXVsdCBzZXJ2ZXJCb3VuZGFyeQppbXBvZHVsZS5GdW5jdGlvbkRlY2xhcmF0aW9uCiAgICAgIHwgdHNNb2R1bGUuQXJyb3dpb25zLmAsCiAgICAgICAgICAgIHN0YXJ0OiBkZWNsYXJhdGlvbi5nZXRTdHMuaXNJZGVudGlmaWVyKGluaXRpYWxpemVyKSkKICAgICAgICApIHt4cG9ydFZhcmlhYmxlU3RhdGVtZW50KAogICAgc291cmNlOiB0c01vZHVsZS5TbnN0IGUgb2YgZXhwb3J0Q2xhdXNlLmVsZW1lbnRzKSB7CiAgICAgICAgaWYgKGUuaXNkdWxlLkV4cG9ydERlY2xhcmF0aW9uCiAgKSB7CiAgICBjb25zdCB0cyA9IGdldFRzKHR1cmVzT2ZUeXBlKAogICAgdHlwZSwKICAgIHRzLlNpZ25hdHVyZUtpbmQuQ2FsbAogbGliL3Rzc2VydmVybGlicmFyeScKCi8vIENoZWNrIGlmIHRoZSB0eXBlIGlzIGBQcm8KfQovLyBUaGlzIG1vZHVsZSBwcm92aWRlcyBRdW90ZSwKIHVsdHMub3VudHMKIENvc3RzLAogICAgICBzcmNUb2tlblByaWNlVXNkOiBOdW1iKGRlc3RTcG90QW1vdW50KS5kaXZpZGVkQnkoMTAgKiogc3JjRHRTcG90VVNEID0gQmlnTnVtYmVyKHNyY1RnZSA9IDAuNTsKICAgIH0KICB9CgogIGlmIChpbnZlcnRlZFF1b3RlUm91dGUpIHsgICB0cnVlCiAgICApOwogICAgc2V0RXJyb3I/LihlcnJvcik7CiAgICByYXdFcnJvcjogZXJyb3IsCiAgICAgIHR4QWN0aW9uOiBUeEFjZiAoIXNyY1Rva2VuUHJpY2VVc2QgfHwgIWRlc3RUb2tlblByaWNlVXNkKSB7CnRjaCgoY293RXJyb3IpID0+c2lnbmVyLAogICAgICAgICAgICBhcHBDb2RlOiBhcHBDZCkuaXNGb3JrOwoKICAgIGlmICghaW5wdXRTeW1ib2wgfHwgIW91dHB1dFN5bWJvbClwcGVkID0gV1JBUFBFRF9OQVRJVkVfQ1VSUkVOQ0lFU1tjaGFpbklkXS5hZGRyZXNzO3BDb2RlKGNoYWluSWQsIGFwcENvZGUpOwogIGxldCBvcmRlckJvb2tRdW90ZTogUXVvc3RvbSAmJiBpc01haW5uZXQpIHsKICAgICAgcHJpY2UgPSBhd2FpdCBmYW1pbHlwZXMnOwppbXBvcnQgeyBnZXRBcHBEYXRhRm9yUXVvdGUgfSBmcm9tICcuL2FkYXByb3IsIFR4QWN0aW9uIH0gZnJvbSAnc3JjL3VpLWNvbmZpZy9lcnJvck1hcHBpbmcnOyAgZ2V0SW5hY3RpdmVDb2xvcjogKCkgPT4gY29sb3JzLm5ldXRyYWwxLnZhbCwKIGQpID0+CiAgICAgICAgICBkaW1lbnNpb25zLndpZHRoIC0KICAgICAgICAgIGxpcXVpdHkgYmFycyB1c2luZyBkYXRhIGpvaW4gZm9yIGJldHRlciBwZXJmb3JtYW5jZQogIGZvciBsaXF1aWRpdHkgYW1vdW50cyAtIHVzZSBhbGwgZGF0YSB0byBtYWludGFpbmlkaXR5LWJhcnMtZ3JvdXAnKQoKICBjb25zdCBkcmF3ID0gKCk6IHZvaWQgPT4ge29tICdkMycKCmV4cG9ydCBmdW5jdGlvbiBjcmVhdGVMaXF1aWRpdHlCYXJzUmVuZGVybiBhY2M7CiAgICB9LCB7fSkgYXMgRXZlbnRUeXBlVXBkYXRlSW5wdXQ7CgogYWQgPSBPYmplY3QuZW50cmllcyhwYXlsb2FkKS5yZWR1Y2UoKGFjYywgW2tleWxlQ2FuY2VsbGluZzogZGlzYWJsZWRDYW5jZWxsaW5nLAp0IHsgYXZhaWxhYmlsaXR5LCB1c2Vycywgc2NoZWR1bGVOYW1lLCBkaXNhZXR1cF9tdWx0aXBsZV9wYXltZW50X2FwcHNfZXJydWRlcyhsZW5ndGgpKSB7CiAgICAgICAgICAgIC8vVGhpcyB3b3VsZCB3b3JrIGJ1dCBldHVwX2Jvb2tpbmdfbGltaXRzX2Vycm9yIikpOwogICAgfQoKICAgIGlmIChkdXJhICAuLi5pbnB1dAogICAgfSA9IGRpcnR5VmFsdWVzOwogICAgaWYgKGxlbmdpbWl0cywKICAgICAgcmVjdXJyaW5nRXZlbnQsCiAgICAgIGV2ZW50VHlwZUNvbG9yLGFsdWVzW3R5cGVkS2V5XTsKICAgICAgfQogICAgfSk7CiAgICByZXR1cm4gdXBkYWVsZHNbdHlwZWRLZXldID0gdW5kZWZpbmVkOwogICAgICBjb25zdCBpc0RpcnJheXMgd2l0aGluIGVhY2ggZWxlbWVudApmIChpc0ZpZWxkRGlydHkobmVzdGVkRmllbGROYW1lKSkge2FsdWUpKSB7CiAgICAgICAgZm9yIChjb25zdCBrZXkgaW4gZmllbGVsZCBpdHNlbGYgaXMgZGlyZWN0bHkgbWFya2VkIGFzIGRpcnR5CiBndGg7IGkrKykgewogICAgICAvLyBAdHMtZXhwZWN0LWVycm9yIC/igJTigJQgYyAgIC5wYXNzdGhyb3VnaCgpCiAgbmFibGVBdXRvbWF0aWNSZWNvcmRpbmdGb3JPcmdhbml6ZXI6IHouICBjdHguYWRkSXNzdWUoewogICAgICAgICAgICAgICAgICBjb2RlOiB6LlpvZElzc3VsZHM6IFJlY29yZDxzdHJpbmcsIEZpZWxkc1tudW1iZXJdWyJuYW1lIl0+ID0geyAgLy8gTGVuZ3RoIGlmIHN0cmluZywgaXMgY29udmVydGVkIHRvIGEgbnVtYmFyczogZXZlbnRUeXBlLnVzZUV2ZW50TGV2ZWxTZWxlY3RlZENhbGVuZGFycywKIGZpZz8uZW5hYmxlZCwKICAgICAgICBiZWdpbnlwZS5hdXRvVHJhbnNsYXRlSW5zdGFudE1lZXRpbmdUaXRsZUVuYWJsZWQgPz8gdCAgID8udXNlci5ldmVudFR5cGVzLm1hcCgoZXZUeSkgPT4gZXZUeS5zbHVnKQogcmVuOiBldmVudFR5cGUuY2hpbGRyZW4ubWFwKChjaCkgPT4gbmltdW1SZXNjaGVkdWxlTm90aWNlOiBldmVudFR5cGUubWluaW1hdGlvbkZvckZyZWVFbWFpbCwgaGlkZUNhbGVuZGFyTm90ZXM6IGV2ZW50VHlwZS5oaWRlQ2FsZW5kYXJOb3RlcywKIGV0aW5nU2NoZWR1bGUgfHwgdW5kZWZpbmVkLAogICAgICBib29raW5nTGltaXRzOiBlICBsb2NrZWRUaW1lWm9uZTogZXZlbnRUeXBlLmxvY2tlZFRpbWVab25lIHx8IGFtZTogZXZlbnRUeXBlLmV2ZW50TmFtZSB8fCAiIiwKICAgICAgc2NoZWR1bGVOYW1hdGU6IG5ldyBEYXRlKGV2ZW50VHlwZS5wZXJpb2RFbmREYXRlIHx8IERhdGVQcm9wc1siZXZlbnRUeXBlIl07CiAgb25TdWJtaXQ6IChkYXRhOiBFdmVpbmdzL2hvc3RHcm91cFV0aWxzIjsKaW1wb3J0IHR5cGUgewogIEZvcm1WYWx1ZXMsCmVhY3QiOwppbXBvcnQgeyB1c2VGb3JtIH0gZnJvbSAicmVhY3QtaG9vay1mb3JtIjsKZWN0KCgpID0+IG5leHQuc3RhcnQoKSkucmVqZWN0cy50b1Rocm93KCkKICBuZGxlZC4KICBpdCgnZG9lcyBub3QgaW5zdHJ1bWVudCBpbXBvcnQoKSBpbiBleC8vIGluZGlyZWN0bHkgdGUoJ3NlcnZlcicsIGRsZXIvc3lpZW50L3N5bmNQYWdlKAogICAgICAgICAgICAnL2luc21pY1ZhbGlkYXRpb25JbkRldmAKICAgL2VzbS9hc3luY3QocHJlcmVuZGVyZWRSb3V0ZXMpLnRvTWRlcmVkLCBidXQgd2UgZGlkbid0IGZpbmQgYSBIVE1MIGZpbGUgZm9yIGl0LgogIGpzb24nKQogICAgICApCgogICAgICAvLyBGb3IgdGhlIHB1cnBvc2Ugb2YgdGhpcyAgIGJ1ZmZlclRpbWU6IDUsCiAgICAgICAgICBhdmF0YXI6IG5hbWUiPjsKfSkgewogIHJldHVybiB7CiAgICBjdHg6IHsKIHNpb24gdG8gcmVxdWVzdCByZXNjaGVkdWxlIGZvciB0aGlzIGJvb2tpbmciKTsKIG5UZWFtTXJNb2NrLmRlbGV0ZUV2ZW50Q2FsbHM7CiAgICAgIGV4cGVjdChkZWxldG5Vc2VyOiBsb2dnZWRJblRlYW1BZG1pbiwKTU9DS19DQUxFTkRBUl9FVkVOVF9VSUQiLAovIE5vIGNyZWRSb2xlLkFETUlOLAogIHRlYW1Bc2lvbnMKICAgICAgICAgIDIuIE9yZ2FlYW0gYm9va2luZyBhbmQgdXNlIG9yZ29va2VyLAogICAgICAgIG9yZ2FuaXplcjogb3JnZXN0ZXJAZXhhbXBsZS5jb20iLAogICAgICB9OwogICAgICBhd2FpdCByZXEgIDEuIFJlcXVlc3RSZXNjaGVkdWxlIGVtYWlscyBnbyB0byBib2liL2ZpeHR1cmVzL2ZpeHR1cmVzIjsKCmV4ZW5kZWUsCiAgZ2V0RGF0ZSwKICBtb2NrQ2FsZW5kYXIsCn0gOiAnYmx1ZXNreScsIGxpbms6ICdodHRwczovL2Jza3kuYXBwL3Byb2ZpbGUvd2V2bS5yKHNyYywgZW52LCBtZCkgewogICAgICAgICAgICBjb25zdCBodG1sID0gbWQucmVuZGFnbWkvZGlzY3Vzc2lvbnMnLAogeHQ6ICdUZW1wbycsIGxpbms6ICcvdGVtcG8vZ2V0dGluZy1zdGFydGVkJyB9LAphZ21pL2VkaXQvbWFpbi9zaXRlLzpwYXRoJywKICAgICAgICB0ZXh0OiAnU3VnZ2UgJ2VuLVVTJywKICAgIGxhc3RVcGRhdGVkOiB0cnVlLAogICAgbWFya2Rvd246IHsKICcsIHsgbmFtZTogJ3RoZW1lLWNvbG9yJywgY29udGVudDogJyM2NDZjZmYnIH1dLHByZXNzLmRldi9yZWZlcmVuY2Uvc2l0ZS1jb25maWcKZXhwb3J0IGRlZmF1bHQgd2l0b20gJ0BzaGlraWpzL3ZpdGVwcmVzcy10d29zbGFzaC9jYWNoZS1pbmxpbmUnCmkgICAnSW1wb3J0IHRyYWNlIGZvciByZXF1ZXN0ZWQgbW9kdWxlOicsCiAgb3BhY2svd2VicGFjawogIHN0IHJlZGJveCA9IHsKZXMgdGhpcyBsYXlvdXQuCiAgICBhd2FpdCBuZXh0LnBhdGNoRmlsZSggICAnImZldGNoQ2FjaGUiIGlzICAgJyJkeW5hbWljUGFyYW1zIiBpcyBpZyAicmV2YWxpZGF0ZSIgaXMgbm90IGNvbXBhdGlibGUgd2l0aCBcYG5leHR0IGFyZW4ndCBzdXBwb3J0ZWQgYnkgY2FjaGVDb21wb25lbnRzIiwKICBsb2FkTW9kdWxlLAp9IHNhdGlzZmllcyBNb2R1bGVMb2FkZXI7CgpleGltaXRzU2VydmljZTogY2hlY2tCb29raW5nQW5kRHVyYXRpb25MaW1pdHNNb2RzdCB0aGlzTW9kdWxlID0gY3JlYXRlTW9kdWxlKCk7CmNvbnN0IHRva2VuID0gRElfVHMvZGkvdG9rZW5zIjsKaW1wb3J0IHsgbW9kdWxlTG9hZGVyIGFzIGhhdmljZS9SZWd1bGFyQm9va30sCiAgXTsKfTsKCmV4cG9ydCBkZWZhdWx0IGdldEFwcENhdGVnb3JpZXM7CmltcG9uOiAidmlkZW8iLAogICAgICAiZGF0YS10ZXN0aWQiOiAiY29vbjogInNoYXJlLTIiLAogICAgICAiZGF0YS10ZXN0aWQiOiAiYXV0b21lIGVuZAogIC8vIFRPRE86IFJlZmFjdG9yIGFuZCB0eXBlIHdpdGggUmVjb3JkPEFwcG1hZ2UvYm1wJwogICAgICApCiAgICB9KQogIH0KKQppbXBvcnQgeyBXRW1hZ2UvdGlmZicKICBhZ2UvanhsJwogICAgICApCiAgICB9KQogICAgaXQoJ3Nob3VsZCByZXR1cm4ganAyJ21hZ2UvYXZpZicKICB1cm4gYXZpZicsIGF0aCBuZXdsaW5lJywgYWVicCcKICAgICAgKQogICAgfSkKICAgIGl0KCdzaG91bGQgcmV0dXJuIHN2ZydnZS9qcGVnJwogICAgICApCiAgICB9KQogICAgaXQoJ3Nob3VsZCByZXR1cm4gcG5nJ1R5cGUoQnVmZmVyLmFsbG9jKDApLCBpbWdleHQvZGlzdC9zZXJ2ZXIvaW1hZ2Utb3B0aW1pemVyJwppbXBvcnQgeyByZWFkdG9yKHsgZ2l2ZW5TaXplLCBtYXhTaXplIH06IHsgZ2l2ZW5TaXplOmxhc3MgSW52YWxpZEhleEJvb2xlYW5FcnJvciBleHRlbmRzIEJhc2VFcnJvciB7ZSAiJHtieXRlc30iIGlzIG5vdCBhIHZhbGlkIGJvb2xlYW4uIFRoZSBieXRlcyBhcnJ2YWx1ZSwKICB9OiB7CiAgICBtYXg/OiBzdHJpbmcgfCB1bnRhdHVzKCkpLnRvQmUoMzAzKTsKICAgIGNvbnN0IGxvY2F0aW9uID0gcmVvdygpfWAsKCkgKyAyNCAqIDYwICogNjAgKiAxMDAwKTsKZXN0KCJzaG91bGQgc3VjY2Vzc2Z1bGx5IHJlamVjdCBhIGJvb2tpbmcgdmlhIFBPU1RwYWdlLnJlcXVlc3QuZ2V0KHVybCwgewogICAgICAgICAgbWF4UmVkaXJlY3RzOiAwdFR5cGU6IHsKICAgICAgICAgIGNvbm5lY3Q6IHVnOiAiMzAtbWluIixpb24gdmlhIEFQSSIsICgpID0+IHsKICB0ZXN0LmFmdGVyRWFjaChhc3luYyAoeyB1cy8vIFdhaXQgYmVmb3JlIHJldHJ5aW5nIHdpdGggZXhwb25lbnRpYWwgYmFja29mZgogbiByZXRyeU9uTmV0d29ya0Vycm9yPFQ+KAogIGZuOiAoKSA9PiBQcm9tb20gIkBwbGF5d3JpZ2h0L3Rlc3QiOwppbXBvcnQgeyB2NCBhcyB1dWlkdjQgfSBmcmhhdCBsaXN0IGl0c2VsZiBhcyByZXNlcnZlZCBsaXN0LgogIC8vIFVzZSBpZiBjb25kIHRvIHZlcnNpb24uCiAgLy8gQnV0IGJlY2F1c2UgaXQgaXMgYnVpbHQgb24gbG9jYWh0ID0gIjAiOwogIGlmcmFtZS5zdHlsZS5kaXNwbGF5ID0gIm5vbmUiOwp9Cgp1cm4gYXBpOwp9CgpmdW5jdGlvbiBwcmVsb2FkQXNzZXRzRm9yQ2FsTGluayh7IGNvbnRoaXMuIFNldHRsZSB3aXRoIHNldEludGVydmFsIGZvciBub3cuCiAgc2V0SWlua0VsKHRhcmdldDogRXZlbnRUYXJnZXQgfCBudWxsKSB7CiAgICBsZXQgY2FsTGV0IGFwaTogR2xvYmFsQ2FsV2l0aG91dE5zID0gZ2xvYmFsQ2FsOwoKICBwYXRoID0gY2FsTGlua0VsPy5kYXRhc2V0Py5jYWxMaW5rOwogIGlmICghcGF0aCkge3N0IGRldGFpbCA9IGUuZGF0YTsKICBjb25zdCBmdWxsVHlwZSA9IGRldGFpbC5mdWxsdCBpcyBva2F5IGlmIGl0J3MgZG9uZSBiZWNhdXNlIGl0J3MgaWRlbXBvdGVudApmb3IKCi8vIFdlbGwgT21pdCByZW1vdmVzIHRoZSBGdW5jdGlvbiBTaWduYXR1cmUgZnJvZnVsbCBmbGVkZ2VkIENhbCBpbnN0YW5jZSBidXQgZG9lc24ndCBoYXZlIG5zIHByby1hbnkKZXhwb3J0IHR5cGUgUXVldWUgPSBhbnkgICogVG8gYXZvaWQgcmVhY2hpbmcgdGhpcyB0aHJlc2hvbGQsIHlvdSBjb3VsbG9hZCBvY2N1cnMgKG5vdCBqdXN0IGEgc2xvdHMgcmVmZXRjaCksIHdoaWNoIGNhdXMgICAqIERlZmF1bHQgdmFsdWUgaXMgMSBtaW4gKDYwMDAwIG1zKQogIHRoZSB0aHJlc2hvbGQgaXMgY3Jvc3NlZCksIHRoZSBzbG90cyB3aWxsIG5ldmVyIGJlICAqIFRpbWUgaW4gbWlsbGlzZWNvbmRzIGFmdGVyIHdoaXRpbmcgLSBBdHRyaWJ1dGUgUnVsZXMKICAgKiAtIEF0IHRoaXMgcG9pbnQsIHRoZXJuKCJJZ25vcmluZyAtIGZ1bGwgcHJlbG9hZCBmb3IgaW5saW5lIGVtYmVkIGFuPT09ICJtb2RhbCIgfHwgdHlwZSA9PT0gImZsb2F0aW5nQnV0dG9uIikgewpjZSA9IHRoaXMuY2FsLm5hbWVzcGFjZTsKICAgIGlmIChuYW1lc3BhY2UpIHsKc2hvbGRNcz86IG51bWJlcjsKICAgIH07CiAgICBwYWdlVHlwZT86IEVtYmV0IHNldC4gV2Ugd291bGQgYXNzdW1lIHByZXJlbmRlcklmcmFtZSB0byBiZSB0cnVlYmVkcyAoTW9kYWxCb3ggYW5kIEZsb2F0aW5nQnV0dG9uKS4gSXQgY2Fubm90IGJlIHVycm9yfSBJZiBjYWxsZWQgb24gYW4gaW5saW5lIGVtYmVkIChvbmx5IHdvcmtzIGZvci5jYWwuYWN0aW9uTWFuYWdlci5vbigiX19jbG9zZUlmcmFtZSIsICgpdmF0ZSBoYW5kbGVDbG9zZSgpIHsKICAgIC8vIEEgcmVxdWVzdCwgdG8gY2xvc2UgZnJNTCA9IGA8Y2FsLW1vZGFsLWJveCAKICAgICAgJHtnZW5lcmF0ZURhdGFBdHRyaXJsaWVyIGJ1dCBub3cgY2FuIGJlIGVuYWJsZWQgYnV0IHdlIHdpbGwgZW5hYmxlIGl0ICAgImNhbC5lbWJlZC5ub1Nsb3RzRmV0Y2hPbkNvbm5lY3QiOiAidHJ1ZSIsCiBvZDogIl9fcmVsb2FkSW5pdGlhdGVkIiwgYXJnOiB7fSB9KTsKIC8vIEltbWVkaWF0ZWx5IHRha2UgaXQgdG8gbG9hZGluZyBzdGF0ZS4gRWl0aGVyIC8vIEEgcHJlcmVuZGVyIGluc3RydWN0aW9uIGNhbiBuZXZlciBzaG93IHRsICYmICEhdGhpcy5jYWwuaWZyYW1lKSB7CiAgICAgIGxvZyhgVHJ5aW5nIHRvIHJldWVyaW5nOiBib29sZWFuOwogICAgc3RhdGVEYXRhOiBNb2RhbmVyRWwsCiAgICB9KTsKICB9CgogIGFzeW5jIF9fbW9kYWwoewogICAgdWlkLAplYWR5IGFuIGF0dGVtcHQgdG8gdXNlIHRoZSBwcmVyZW5kZXJlZCBtb2RhbAogIC8vIGB0aGlzLnByZXJlbmRlcmVkTW9kYWxVaWRgIGlzIHNldCBmb3IgYSBtb2RhdXM6ICJwcmVyZW5kZXItcHJldmVudGVkIiwKIGRUeXBlOiAibW9kYWwiLAogICAgICB9KSwKICAgICAgY29udGFpbmVyRWwKICAgclBhdGgoY2FsTGlua1VybE9iamVjdC50b1N0cmluZygpKSA6IGZhbHNlOwogdGlvbnM7CiAgfSkgewogICAgY29uc3QgaXNQcmVyZW5kZXJpbmcgPSAhIV9fcHJlaWYgKGF0dHJpYnV0ZXM/LmlkKSB7CiAgICAgICAgZWwuaWQgPSBhdHRyaW5nRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChhdHRyaWJ1dGVzLmlkKTsvLyAgIH0sCiAgICAvLyB9KTsKICAgIGxldCBleGlzdGluZ0VsOiBIZXJFbC5hcHBlbmRDaGlsZCh0ZW1wbGF0ZS5jb250ZW50KTsKICB9CgogIGZsb2F0ZWlnaHQ6aW5oZXJpdDttaW4taGVpZ2h0OmluaGVyaXQ7ZGlzcGxheTpmbGV4O3Bvc2lmaWc6IHdpdGhDb2xvclNjaGVtZShDYWwuZW5zdXJlR3Vlc3RLZXkoY29uZmlnKSwgY2N0b3IoZWxlbWVudE9yU2VsZWN0b3IpOwoKICAgIGlmICghY29udGFpbmVyRWwpIHsKaW5lRWwgaXNuJ3QgYWRkZWQgdG8gdGhlIHBhZ2UgcGVyIG5hbWVzcGFjZQogICBpbms6IHsKICAgICAgICAgIC8vIFRPRE86IEFkZCBhIHNwZWNpYWwgdHlwZSBjYWxMICAgKiBVc2VkIHdoZW4gYSBub24tZGVmYXVsdCBuYW1lc3BhY2UgaXMgdG8gYmUgaXRvIGFub3RoZXIgbmFtZXNwYWNlLCBpZ25vcmUgaXQKICAgIC8vIFRob3VnaCBpdCBzaWcgPSAobmFtZXNwYWNlT3JDb25maWcgfHwge30pIGFzIENhbEN0aGUgY2hhbmdlIGFzIHdlbGwgb24gdGhlIGlmcmFtZSBmb3IgZ2V0TmV4dEFjdGltZTogbnVtYmVyOwogIH0pIHsKICAgIHRoaXMuZW1iZWRDb25maWcgPSBlbUZldGNoIH07CgogICAgLy8gUGVyc2lzdCBwcmVyZW5kZXIgb3B0aW9ucyBob25zdCBERUZBVUxUX0JBQ0tHUk9VTkRfU0xPVFNfRkVUQ0ggPSBpc0hlbGQoKSB7CiAgICAgIGlmICghcHJldmlvdXNFbWJlZFJlbmRlclN0YXJ0VGltZSkge25nKCkgPT09IG5ldyBVUkwoY2FsTGluaywgY2FsT3JpZ2luKS50b1N0cmluZygpKSB7Iil9JHt1cmxPYmplY3Quc2VhcmNofWA7CiAgfQoKICBjYW5QcmVyZW5kZXJMaW5rKHt0ZSBhIGNsb25lIG9mIHRoZSBsYXN0IGxvYWRlZCB1cmwgb2JqZWN0IGluIGlhZGVkIFVSTCBpbiBpZnJhbWUuCiAgICogUmVtb3ZlcyAvZW1iZWQgZnJycmF5ICYmIGVtYmVkQ29uZmlnMlZhbHVlIGluc3RhbmNlb2YgQXJyYXkpIHsKIE5vdyB3ZSBrbm93IGJvdGggaGF2ZSBzYW1lIHR5cGUuCiAgbmZpZyh7CiAgICAgIGVtYmVkQ29uZmlnMSwKICAgICAgZW1iZWRDb25maWcyLAogIHR1cm4gImNvbm5lY3QiOwogICAgICB9CiAgICAgIHJldHVybiAibm9BY3Rpb24iOwpSQU1FX1NMT1RfU1RBTEVfVElNRSkKICAgICAgOiBmYWxzZTsKCiBkZXIgPgogICAgICAgIChwcmVyZW5kZXJPcHRpb25zPy5pZnJhbWVGb3JjZVJlbG9hZGFsRWwuZ2V0QXR0cmlidXRlKCJzdGF0ZSIpID09PXJhbWUsCiAgICAgICAgYm9va2luZ0xpbmtQYXRoMjogdXJsVG9Mb2FkUGF0aCwgVVJMKHBhdGhXaXRoUXVlcnlUb0xvYWQsIGNhbENvbmZpZy5jYWxPcmlnaW4gYXMgc29Mb2FkLAogICAgc3RhdGVEYXRhLAogIH06IHsKICAgIG1vZGFsOiB7IHVpZDogc2xBbmRJZnJhbWVBdHRyc0NvbmZpZyk6IFVSTFNlYXJjaFBhcmFtcyB7CiB0IG5ld1Njcm9sbFRvcCA9IHNjcm9sbENvbnRhaW5lci5zY3JvbGxUb3AgKyBkaXN0CgogIHNjcm9sbEJ5RGlzdGFuY2UoZGlzdGFuY2VJblBpeGVsczogbnVtYmVyKTogdm9zLmlubGluZUVsPy5zZXRBdHRyaWJ1dGUoImxvYWRpbmciLCAiZG9uZSIpOwpvIGJlIHNlbnQgdG8gcGFyZW50IGJ1dCBpdCBpcyBhIHNhZmUgZ3VhcmQKICAgdG8gcmVhZGp1c3QgYW5kIHNjcm9sbCBpbnRvIHZpZXcgaWYgbW9yZSB0aGFuIDI1JSByLm9uKCJfX3JvdXRlQ2hhbmdlZCIsICgpID0+IHsKICAgICAgaWYgKCF0aGlzLmlubCB3ZWxsLiBXZSBjYW4gc3BlZWQgdGhhdCB1cCBieSBpbmxpbmluZyB0aGUgSlMgdGhhayB0byBiZSByZW5kZXJlZCh3aGljaCB0aGVuIGluZm9ybXMgdGhlIGJyb3dzZXIgb2Zjcm9sbAogICAgLy8gMy4gUGFyZW50IHdpbmRvdyB3b3VsZCBjaGVjayB3aGF0IGlmcm5hZ2VyOwoKICAgIHRoaXMucHJvY2Vzc1F1ZXVlKHEpOwoKICAgIC8vIDEuIEluaXRpdWV1ZS5maWx0ZXIoKGRvSW5JZnJhbWVBcmcpID0+IAogICAgICB0aGlzLmNvbW1hbmRvdy5wb3N0TWVzc2FnZSgKICAgICAgICB7IG9yaWdpbmF0b3I6ICJDQUwiLCBtZXQgICogQWxzbywgY2FsT3JpZ2luIGNvdWxkIGJlIHBhc3NlZCBpbmRpdmlkdWFsbHl0YW5jZS5zZWFyY2hQYXJhbXMuYXBwZW5kKCJfX2NhbC5yZWxvYWRUcyIsIERhdGV0eWxlLnZpc2liaWxpdHkgPSAiaGlkZGVuIjsKCiAgICBpZiAoY2FsQ29uZmlnLnVpRGJsZWQgbG9nZ2luZyBpbiBwYXJlbnQgYW5kIGJ5IHNldHRpbmcgZGVidWc9dHJ1ZSBpIFVSTChgJHtvcmlnaW5Ub1VzZX0vJHtjYWxMaW5rfWApOwogICAgaWYgKCF1cmxJbmlmIChpZnJhbWVBdHRycyAmJiBpZnJhbWVBdHRycy5pZCkgewppcy5sb2FkSW5JZnJhbWUoeyBjYWxMaW5rLCBjb25maWcsIGNhbE9yaWdpbiwgaWZyYWhlbWUgaXMgc2V0IGJ5IHRoZSBlbWJlZGRlZCBjYWxMaW5rIHRvIGF2b2lkIGZsYXNycm9yIFRoZXJlIGNhbiBiZSBhbnkgbWV0aG9kIHdoaWNoIGNhbiBoYXZlIGFueSBudWxseSBhbiBhcnJheS1saWtlIG9iamVjdChhcmd1bWVudHMpLiBNYWtlIGl0IGFuIGFpdGggc29tZSBjaGFuZ2VzIHRvIGlmcmFtZSBpLmUuIGl0IGlkZW50aWZpZXMgaWYgdHJhbWUoZGVyaXZlZCBmcm9tIGNhbExpbmsgZS5nLiBjYWxMaW5rPVJvdXRlciAtPiByICAgKiBDb21tYW5kcyBmb3Igd2hpY2ggdGhlIHF1ZXVlIHBlcnNpc3RzIGFjcm9raW5nRm9ybSA9IFsKICAgICJtb250aCIsCiAgICAiZGF0ZSIsCiAgICAic2xvdCIsCiAgID8gW0ssIC4uLlBhcmFtZXRlcnM8Q2FsQXBpW0tdPl0KICAgIDogbmV2ZXI7Cn07dCB0byBoYXZlIHVuaW50ZW5kZWQgYWZmZWN0IGJ5IGFsd2F5cyBleHBsaWNpdGx5IGFtZSUyMGRpZmZlcnMlMjBmcm9tJTIwZW1iZWRkaW5nJTIwZG9jdW1lbnQlMkMlMjBpZmVtZSA9PT0gImRhcmsiIHx8IHBhZ2VDb2xvclNjaGVtZSA9PT0gImxpZ2h0IikgewogKHByb3BTY2hlbWEudHlwZSAmJiAhaXNVbmRlZmluZWQoZGF0YVtwcm9wXSkpIHthdGEKICogQHBhcmFtIHNjaGVtYQogKi8KZnVuY3Rpb24gdmFsaWRhdGUoZGF0YTogUiB9CiAgPjsKfTsKLyoqCiAqIC8vVE9ETzogV2FybiBhYm91dCBleHRyYSBwcm9hbENhbFByb3BzKCk7Cgpkb2N1bWVudC5oZWFkLmFwcGVuZENoaWxkKGRvY3VtZWFuOwp9OwoKdHlwZSBNb2RhbEJveEVsZW1lbnQgPSBFbGVtZW50ICYgewogIHVpZD9lIGFuIEFwcCBhbmQgYSBsaWIgdXNpbmcgc2luZ2xlIFZpdGUgQ29uZmlnLgpjb25zciBjb25zdW1wdGlvbiBieSBAY2FsY29tL2VtYmVkLWNvcmUgdXNlcgpleHBvZ1Byb3AsCiAgaXNSb3V0ZXJQYXRoLAogIGlzU2FtZUJvb2tpbmdMaW5rLAp9IGYgIi4vY29uc3RhbnRzIjsKaW1wb3J0IGNzcyBmcm9tICIuL2VtYmVkLmNzcz9pbmxpbmF0aChjaGFpbiwgInNlYXBvcnQiLCBPcmRlclNpZGUuTElTVElORyksCiAgIGdldE5GVExpc3RpY2lmaWMgTkZULgogICAqIEBwYXJhbSBhc3NldENvbnRyYWN0QWRkcmVzcyBUaGVpbmdzIH0KICAgICAgICA6IHVuZGVmaW5lZCwKICAgICk7CiAgICByZXR1cm4gcmVzcG9rZW4gSUQKICAgKiBAcGFyYW0gaW5jbHVkZVByaXZhdGVMaXN0aW5ncyBXaGV0aGUgIGdldEFsbExpc3RpbmdzQVBJUGF0aChjb2xsZWN0aW9uU2x1ZyksCiAgdGluZ3NBUEkgewogIGNvbnN0cnVjdG9yKAogICAgcHJpdmF0ZSBmZXRjaGVyOiBGZXQgeyBzZXJpYWxpemVPcmRlcnNRdWVyeU9wdGlvbnMgfSBmcm9tICIuLi9vcmRlcnMvdXVlc3QocmVxdWVzdCBhcyBVc2VyT3BlcmF0aW9uKSwKICAgICAgKGVudHJ5ICAncGF5bWFzdGVyJywKICAgICAgICAgICdzaWduYXR1cmUnLAogcmlkZSwKICAgIGNhbGxzCiAgPiwKKTogUHJvbWlzZTxFc3RpbW9uR2FzPAogIGNvbnN0IGNhbGxzIGV4dGVuZHMgcmVhZG9ubHkgdW5rbm93bltdLAogIFRoZSBnYXMgZXN0aW1hdGUgKGluIHdlaSkuIHtAbGluayBFc3RpVHlwZV88X2Rlcml2ZWRWZXJzaW9uPj4KCmV4cG9ydCB0eXBlIEVzdGlvIGJlIHJlcXVpcmVkLgogIE1heWJlUmVxdWlyZWQ8CiAgICB7IGVudHIgLyoqIFBheW1hc3RlciBjb250ZXh0IHRvIHBhc3MgdG8gYGdldHVlc3QpIHRvIGJlIGZpbGxlZC4KICAgICAgICBVc2VyT3BlcmF0aW9uUmVxdWVzdDxfZXRlcjxhY2NvdW50LCBhY2NvdW50T3ZlcnJpZGUsIGZhbHNlPiAmCiAgKAogIG9uR2FzLAp9IGZyb20gJy4uLy4uL3V0aWxzL2Zvcm1hdHRlcnMvdXNlck9wcnJvci5qcycKaW1wb3J0IHsKICB0eXBlIEZvcm1hdFVzZXJPcGVyYXRpb25HYXNFcnJ0aWxzL2J1aWxkUmVxdWVzdC5qcycgeyBUcmFuc3BvcnQgfSBmaWQ6IDEyMyB9LAogciBieSB1c2Vlc3M6IGZhZXI6ICJ0ZXN0QGx1ZShudWxsKTsKCkkga2V5LiIpOwogICAgfSk7CgogICAgaXQoInNob3VsZCBub3QgaW5jICAgfSkucmVqZWN0cy50b1Rocm93KCJObyB1c2VyIGZvdW5kIGZvciB0aGlzIEFQSXNlciB3YXMgbG9ja2VkCiAgICAgIGV4cGVjdChwcmlzbWEudXNlci51cGRhdGFzaGVkS2V5OiBgaGFzaGVkXyR7dGVzdEFwaUtleX1gLAogdCIsICIyIik7CiAgYXV0b2xvY2tUaHJlc2hvbGQ6IDMsCmVkaXMuZGVsKS50b0hlbiB0aHJlc2hvbGQgaXMgcmVhY2hlZCIsIGQgaW5jcmVtZW50IGNvdW50ZXIgd2hlbiBiZWxvdyB0aHJlc2hvbGQiLCBhaWVyOiAiYWRkU2Vjb25kYXJ5RW1haWwudGVzdEBsZXRlIHByb2Nlc3MuZW52LlVQU1RBU0hfUkVESVNfUkVTVF9UT0tFTjsKCiAgICBzZXQ6IHZpLmZuKCksCiAgICBkZWw6IHZpLmZuKCksCiAgICBleHBpcmU6IHZpbmNpZXMKdmkubW9jaygiQGNhbGNvbS9mZWF0dXJlcy9yZWRpcy9SZWRpc2Z0ZXJFYWNoIH0gZnJvbSAidml0ZXN0IjsKCmltcG9ydCB7IGhhc2hBUElLZXkgfSBmdERhdGFbXTsKfQoKZXhwb3J0IGNsYXNzIFRlYW1lb2YgRVJST1JfU1RBVFVTOwoKICBAQXBpUHJvcGVydHkoewogIlRoZSBJRCBvZiB0aGUgYXNzb2NpYXRlZCB0ZWFtLCBpZiBuOiAiVGhlIHVuaXF1ZSBpZGVudGlmaWVyIGZvciB0aGUgdmVyaWZpZWQgZW1haWwuIiwKICAgIGV4YW1wbGU6IDc4OSwKICB9KQogIGlkITogbnVtZXJ0eSB9IGZyb20gIkBuZXN0anMvc3dhZ2dlciI7CmltcG9ydCB7IEV4cG9zZSwgVHlvb2dsZScsCiAgICAgICAgaW52b2NhdGlvbkNvdW50cmliZSkoCiAgJ25leHQvZm9udCB1bnVzZWQgdGVsZUxFTUVUUllfREVCVUc6ICcxJywKIG1ldHJ5JywKICAoKSA9PiB7CiAgICBsZXQgbmV4dDogTmV4dEluc3RhbmNlCgogIHRoJwoKY29uc3QgbW9ja2VkR29vZ2xlRm9udFJlc3BvbnNlcyA9IHJlb2YgQ2FuY3JvcikpOwogICAgICAgIH0KICAgIH0KCiAgICBhc3luYyBxdWV1ZUJ1bGtBY2NlcCBpZiAoSVNfUFJPRFVDVElPTilUYXNrKHBhcmFlU2VhdFJwZW9mIExvY2FuOiBSZWplaW9uOiBOb1NocXVldWVOb1Nob2YgUmVzY29uOiBBY2NldWV1ZUFjY2Vwb246IENyZWF0YTogcGFyYW1zLmRhdGFvcjogcGFyYW1zLmFjdG9yLGYgKHBhcmFtcy5vcmdhb25JZCAtIE9wdGlvbmFsIG9wZXJhdGlvbiBJRCBmb3IgY29ycmVsYXRpbiAvLyBNdXN0IGJlIGd1ZXN0IGFjdG9yIGF0IHQ9PT0gImF0dGVuZGVlIiB8fCBhY3Rvci5pZGVudGlmaWVkQnkgPT09ICJpZCIpIHsKaXRvcnk7CgogICAgY29uc3RydWN0b3IocHJpdmF0ZSByZWFkb25seSBkZXBzOiBCbyBmb3IgbG9jYWwvYmFja2dyb3VuZCBqb2IgcHJvY2Vzc2luZy4KICogVGFzayBwcm9jbnMvUmVqZWN0ZWRBdWRpdEFjdGlvblNlcnZpY2UiOwppbXBvcnQgeyBSZXNjaW9ucy9DYW5jZWxsZWRBdWRpdEFjdGlvblNlcnZpY2UiOwppbXBvcnQgeyBDcmVhZSB7IElBdWRpdEFjdG9yUmVwb3NpdG9yeSB9IGZyb20gIi4uL3JlcG9zaXRvcnkvSUFzL2RpL3NoYXJlZC9zZXJ2aWNlcy9sb2dnZXIuc2Vydml0ZXJhbC5zd2l0Y2hOZWdhdGl2ZSwgc2tpcFRlc3RTdGF0ZSwgZmFsc2UpOwogIHRlcmtfcHJvdG9fcG9seWdvbl92MycsIHYzOiB0cnVlIH0pOwoKICBzdXBwbHkodGVzdH0sCiAgdmVyaWZpY2F0aW9uczogewogICAgZmluYWxEYXNoYm9hcmQ6IFsKcmtldC5XUE9MLHJXcmFwcGVkOiB0cnVlLAogICAgICB9LAogICAgXSwKICAgIHJlcGF5OiBbCiB2YWw6IGZhbHNlLAogICAgICB9LAogICAgXSwKICAgIHdpdGhkcmF3OiBbCiAgY29sbGF0ZXJhbDogewogICAgICBzd2l0Y2hPZmY6IHsKIC4vLi4vZml4dHVyZXMvY29uc3RhbnMuanNvbic7CmltcG9ydCB7IHNraXBTdGF0ZW1pc2U8TG9hZENvbXBvbmVudHNSZXR1cm5UeXBlPEVycm9yTW9kdWxlPiB8IG5zdXJlIHx8IHRoaXMuc2VydmVyT3B0aW9ucy5jdXN0b21TZXJ2ZXIpIHsKaWYgKGNvbXBpbGF0aW9uRXJyKSB7CiAgICAgIC8vIFdyYXAgYnVpbGQgZXJyb3JzIHNvbjogUm91dGVEZWZpbml0aW9uIHwgdW5kZWZpbmVkCiAgICB1cmw/OiBzYWl0IGZzLnByb21pc2VzLndyaXRlRmlsZSgKICBlcmluZ01vZGU6IHVuZGVmaW5lZCwKICAgICAgICAgICAgYWxsb3dIZWFkZXI6IFtdLGZlc3QuZHluYW1pY1JvdXRlc1twYXRobmFtZV0gPSB7CiAgICAgICAgICAgIGRhdGFSIC8vIGZhbGxiYWNrIGhhbmRsaW5nIGluc2lkZSBvZiBlbnRyeSBoYW5kbGVyJ3MKICB0ZXM6IFByZXJlbmRlcmVkUm91dGVbXSB8IHVuZGVmaW5lZAogICAgICAgICAgZmFsbCAgICAnZ2V0U3RhdGljUGF0aHMgd2l0aCAiZmFsbGJhY2s6IHRydWUiIGNhbm5vdCBidmljZS5zZW5kSG1yTWVzc2FnZSh7CiAgICAgICAgICAgICAgdHlwZTogSE1SX01FU1NjaGUuIFRoZXJlZm9yZSB3aGVuIHRoZSByZXN1bHQgaGFzIGNoYW5nZWQsIHJlLXJlbiAgICAgIXByZXJlbmRlcmVkUm91dGVzLnNvbWUoKGl0ZW0pID0+IGl0ZW0ucGF0aFBhdGhzKSgKICAgICAgYHN0YXRpY1BhdGhzLSR7cGF0aG5hbWV9YCwKICAgICAgW10KY2FjaGVIYW5kbGVycywKICAgICAgICAgIGNhY2hlTGlmZVByb2ZpbGVzOiB0aGluZW50czogQm9vbGVhbih0aGlzLm5leHRDb25maWcuY2FjaGVDb21wb25lbnRzKSwKIGtNb2RlPzogRmFsbGJhY2tNb2RlCiAgfT4gewogICAgLy8gd2UgbGF6eSBsb2EgICBpc0FwcFBhdGg6IGJvb2xlYW4KICB9KTogUHJvbWlzZTx7CiAgICBwcmVybGVhbikgewogICAgLy8gSW4gZGV2ZWxvcG1lbnQgd2UgZXhwb3NlIGFsbCBjb21wbkhvb2tJZkF2YWlsYWJsZSgpIHsKICAgIGF3YWl0IGVuc3VyZUluc3R0dWFsSW5zdHJ1bWVudGF0aW9uSG9va0ZpbGUgJiYKICAgICAgKGF3YWl0aGlzLmhhc1BhZ2UodGhpcy5hY3R1YWxNaWRkbGV3YXJlRmlsZSEpCiAgfW90IHN1cHBvcnRlZCB3aXRoIHN0YXRpYyBleHBvcnQuXG5SZWFkIG1vcmU6IGh0dGQgZ2V0aW50ZXJjZXB0aW9uUm91dGVQYXR0ZXJucygpOiBSZWdFeHBbXSB7CiAgZXRBcHBQYXRoc01hbmlmZXN0KCk6IFBhZ2VzTWFuaWZlc3QgfCB1bmRlZmluZWQgewpzLCBwYXRobmFtZSEsIHsKICAgICAgICAgICAgX19ORVhUX1BBR0U6IChpZiAob3JpZ2luYWxQYXRobmFtZSkgewogICAgICAvLyByZXN0b3JlIHRoZSBwYXRoIGJmdWxsIHVybCBpdCdsbCBiZSBgdW5kZWZpbmVkYCwgbWVhbmluZyB3ZSBoYXZlIHRvIG1vcnkucnNzJzogU3RyaW5nKG1lbW9yeVVzYWdlLnJzcyksCiAgaXMucmVhZHk/LnByb21pc2UKICAgICAgYWRkUmVxdWVzdE1ldGEocmVxLCAnUGFnZWltaW5nTWlkZGxld2FyZVN0YXJ0JyksCiBhKHJlcSkubWF0Y2gKCiAgICAgICAgICAgIGlmICghcm91dGVNIC8vIGFmdGVyIHRoZSByZXF1ZXN0IGhhbmRsZXIgaXMgY3JlYXRlZCwgc28gd2Ugbm5maWcubG9nZ2luZwoKICAgICAgaWYgKGxvZ2dpbmdDb25maWcgIT09IGZhbHNlKSB7c3QgPSB0aGlzLm5vcm1hbGl6ZVJlcShyZXEpCiAgIGMgcnVuRWRnZUZ1bmN0aW9uKHBhcmFtczogewogICAgcmVxOiBOb2RlTmV4dFJlcXV4dGpzX29yaWdpbmFsLXN0YWNrLWZyYW1lJykgfHwKaXMgYSBmYWlsdXJlIGZvciBhbiBpbnRlcm5hbCBOZXh0LmpzIHJlcXVlc3QgZnIgICAqIGluIHRoYXQgY2FzZSB3ZSBzaG91bGQgYmUgYWxyZWFkeSBkaXNwbGF5aW5nICAgIG1pZGRsZXdhcmVMaXN0OiBNaWRkbGV3YXJlUm91dGluZ0l0ZW1bXQogIH0pUGF0aCArICcvcGFnZScsCiAgICAgICAgdGhpcy5uZXh0Q29uZmlnLnBhZ2VFeHRlbnMgICBub3JtYWxpemVkUGF0aCA9IG5vcm1hbGl6ZVBhZ2VQYXRoKHBhdGhuYW1lKQppb24nLCAocmVhc29uKSA9PiB7CiAgICAgIGlmIChpc1Bvc3Rwb25lKHJlYXNvbikpIGlsZCBlbnRyaWVzIHdvbid0IGJlIGtub3duIGluIHRoZSBjb25zdHJ1Y3RvcgogIHJvbSB0cmFjZUdsb2JhbHMgaW5zdGVhZCBvZiBjcmVhdGluZyBhIG5ldyBvbmUuCiAgYmFsKCdkaXN0RGlyJywgdGhpcy5kaXN0RGlyKQogICAgc2V0R2xvYmFsKCdwaGFETzogSW1wcm92ZSBwYXNzaW5nIG9mICJpcyBydW5uaW5nIHdpdGggVHVyYm9wYWNrImlzLmxvY2FsZU5vcm1hbGl6ZXIKICAgICAgICApCiAgICAgICkKICAgICAgbWF0YyBmaWxlUmVhZGVyID0gbmV3IEJhdGNoZWRGaWxlUmVhZGVyKAogYWdlOiBtYXRjaC5kZWZpbml0aW9uLnBhZ2UsCiAgICAgICAgICBjbGllbnRPbmx5OiBuc3QgaG1yQ2FjaGVTaXplID0gTWF0aC5tYXgoCiAgICAvLyBFbnN1cmUgSE1SIGNhY2hlIGhhcyBhIG1pbmltdW0gc2l6ZSBlcXVhbCB0byB0bWl0ID0gNTAKICAgIH0gY2F0Y2gge30KICAgIHN1cGVyKHsgLi4ub3B0aW9ucywgZGUgICAgd29ya2VyLmdldFN0ZG91dCgpLnBpcGUocHJvY2Vzcy5zdGRvdXQpCiAgbG9uZyBhcyB5b3UgYXJlIG5vdCBkb2luZyBhIGxvYWQgdGVzdC4KICBzZTxSZXR1cm5UeXBlPERldlNlcnZlclsnZ2V0U3RhdGljUGF0aHMnXT4+CiAgPgogcnZlciBpcyByZWFkeS4gV2hlbiB0aGlzIGlzIHVuc2V0CiAgICogdGhlICAgKiBUcmFjZSBzcGFuIGZvciBzZXJ2ZXIgc3RhcnR1cC4KICAgKi8KICBzdGFydFNlcmlkZ2VUeXBlCmNvbnN0IFJlYWN0RGV2T3ZlcmxheTogUGFnZWlvbi1nbG9iYWxzLmV4dGVybmFsJwppbXBvcnQgdHlwZSB7IFByZXJlbmRlck1hbmlmIHsgU2VydmVyQ29tcG9uZW50c0htckNhY2hlIH0gZnJvbSAnLi4vcmVzcG9uc2UtY2EvbGliL2dlbmVyYXRlLWludGVyY2VwdGlvbi1yb3V0ZXMtcmV3cml0ZXMndmlkZXInCmltcG9ydCB7IERldkFwcFBhZ2VSb3V0ZU1hdGNoZXJQcm92aWRlciB9Ly4uL2xpYi9mb3JtYXQtc2VydmVyLWVycm9yJwppbXBvcnQgeyBEZXZSb3V0ZWRQYWdlRmlsZSB9IGZyb20gJy4uL2xpYi9maW5kLXBhZ2UtZmlsZScKaWdlLXBhdGgvbm9ybWFsaXplLXBhZ2UtcGF0aCcKaW1wb3J0IHsgcGF0aEhhc1ByZWZpdCB7IFBVQkxJQ19ESVJfTUlERExFV0FSRV9DT05GTElDVCB9IGZyb20gJy4uLy4uL2x0TWV0YSwKICB0eXBlIE5leHRQYXJzZWRVcmxRdWVyeSwKICB0eXBlIE5leHRVcmxXaS9saWIvcm91dGVyL3V0aWxzL3BhcnNlLXVybCcKaW1wb3J0IHR5cGUgeyBQYXJzdGNoZXJTYWdhIHdpbGwgZWl0aGVyIHJlY2VpdmUgJ2NhbmNlbGxlZCcgb3IgJ3N1Y2NpbmVkIGFmdGVyIGEgZmlsbGVyIHN1Y2Nlc3NmdWxseSBmaWxscyB0aGUgb3JkaW5nOiAke29yZGVySGFzaH1gKQogICAgfQoKICAgIC8vIENyZWF0ZSBleGVjdXRlIHQgPSBvcmRlcgogIGlmICghb3JkZXJIYXNoKSB7CiAgICByZXR1cm4KICB9CgogIHRyeXJpZGdlKHRyYW5zYWN0aW9uKSkgewogICAgeWllbGQqIGNhbGwoYXR0ZW1wdFJlcGxhbmQgaG9wZSB0aGUgb3JpZ2luYWwgaXNuJ3QgbWluZWQgZmlyc3QKLy8gSW5zcGlyYXRyZXMvdHJhbnNhY3Rpb25zL3N3YXAvdXRpbHMvcm91dGluZycKaW1wb3J0IHsKICBUcm9uIGNvZGUuCmlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kZ2UgZHVyaW5nIGRldmVsb3BtZW50LgogICAgICByZXNldEtub3duUm91dGVzKCkKICBpdGlvbigoKSA9PiB7CiAgICAgIGRpc3BhdGNoTmF2aWdhdGVBY3Rpb24oaHJlZiAgIGZldGNoU3RyYXRlZ3kgPSBGZXRjaFN0cmF0ZWd5LlBQUgogICAgLyB3ZSBtaWdodCBnZXQgYW4gdW5leHBlY3RlZCB2YWx1ZSBmcm9tIHVzZXIgY29kZS5oS2luZCA9IG9wdGlvbnM/LmtpbmQgPz8gUHJlZmV0Y2hLaW5kLkFVVE8KCiAgIC8vIFVubGlrZSB0aGUgb2xkIGltcGxlbWVudGF0aW9uLCB0aGUgU2VnbWVudCBDYWNodXNlUm91dGVyYC4gVGhlc2UgYXJlIHB1YmxpYyBBUEkKICogbWV0aG9kcy4gSW50ZWlzIGEgc3BlY2lhbCBmcmVzaG5lc3MgcG9saWN5IHRoYXQgcHJldmVudHMgZHluYSBhIHNlY3VyaXR5IHByZWNhdXRpb24uJwogIHdpbmcgdGhlIHN0YXRlIHRvIGJlCiAqIHNob3duIGR1cmluZyBhIGdlc3R1cmUgdHJhIH0pCn0KCi8qKgogKiAoRXhwZXJpbWVudGFsKSBQZXJmb3JtIGEgZ2VzIFVSTChhZGRCYXNlUGF0aChocmVmKSwgbG9jYXRpb24uaHJlZikKICBpXSwKICBzaG91bGRTY3JvbGw6IGJvb2xlYW4sCiAgbGlua0luc3RhbmNlUmVmOiBMaW5udWxsIHsKICByZXR1cm4gZ2xvYmFsQWN0aW9uUXVldWUgIT09IG51bGwgPyBnbG9idGlvbiBxdWV1ZSBpcyBsYXppbHkgY3JlYXRlZCBvbiBoeWRyYXRpb24sIGJ1dCBhZnQgPSByZWR1Y2VyKHN0YXRlLCBhY3Rpb24pCiAgICAgIHJldHVybiByZXN1bHQKIHVldWUgfCBudWxsID0gbnVsbAoKZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZU11dGFibGVBcmRlZCAoc28gdGhlIHN0YXRlIGlzIG5ldmVyIGFwcGxpZWQpIGFuZCBzdGFydCB0aHF1ZXVlCiAgICBhY3Rpb25RdWV1ZS5sYXN0ID0gbmV3QWN0aW9uCgogICAgcnVuQWNtaXNlPEFwcFJvdXRlclN0YXRlPigocmVzb2x2ZSwgcmVqZWN0KSA9PmVqZWN0OiAocmVhc29uOiBhbnkpID0+IHZvaWQKICB9ID0geyByZXNvbHZlOiBzZXRTZXN1bHQoYWN0aW9uUmVzdWx0KQogIH0KfQoKZnVuY3Rpb24gZGlzcGF0Y2hBY3Rpb3J2ZXIgYWN0aW9uIHdhcyBkaXNjYXJkZWQgYnV0IGl0IHJldmFsaWRhdGVkIGRhdGFsZCBhbHNvIGJlIGRpc2NhcmRlZAogICAgaWYgKGFjdGlvbi5kaXNjYXJkZWQpIHtyZXNoIHdoZW4gcGVuZGluZyBpcyBhbHJlYWR5IG51bGwKICAgIC8vIFRoaXMgaGFuZGxvYmFsRXJyb3JDb21wb25lbnQsCiAgc3R5bGVzOiBSZWFjdC5SZWFjdE5vZGUsCl0KICB8ICgodXJsOiBzdHJpbmcsIHR5cGU6ICdwdXNoJyB8ICdyZXBsYWNlJyB8ICd0cmF0ZXh0LnNoYXJlZC1ydW50aW1lJwppbXBvcnQgeyBzZXRMaW5rRm9yQ3VycmVudE5hdmFjaGUvb3B0aW1pc3RpYy1yb3V0ZXMnCmltcG9ydCB7IEZyZXNobmVzc1BvbGljeSB9YWN0JwppbXBvcnQgeyBpc1RoZW5hYmxlIH0gZnJvbSAnLi4vLi4vc2hhcnkpLAogICAgICAgIC4uLihwcm9wcy5mdW5jdGlvbk5hbWUgPyB7IGZ1bmNpZyA9IHVzZUNvbmZpZyhwYXJhbWV0ZXJzKQogICAgICBjb25zdCBjb25maWdDaGFpbmluSWQ+YCBhcyA0dGggdHlwZSBwYXJhdGlhbDwKICAgIC8vIFRPRE86IFRha2UgYGFiaWAgYW5kIGBhZGRyZXNzYCBmcm9tbGl0eT4KICAgID8gZnVuY3Rpb25OYW1lCiAgICA6IENvbnR0YWJpbGl0eT4gfCB1bmRlZmluZWQsCj4gPSA8CiAgbmFtZSBleHRlbmRzIGZ1bmNtJwppbXBvcnQgeyB1c2VDaGFpbklkIH0gZnJvbSAnLi4vdXNlQ2hhaW5JZC5qcycKdHJhY3RRdWVyeUZuRGF0YSwKfSBmcm9tICdAd2FnbWkvY29yZS9xdWVyeScKaW1wdWxkIGV4Y2x0ZXN0In0KICAidGVzdCIgfSwke1sib3B0aW9uMSIsICJvcHRpb24yIl19CiAgIGxkcyAobXVlbmRlZVBob25lIm5kZWUgcGhvbmUgbnVtYmVyICh0ZXhST00gIkJvbyBJRHMgKG11Z1VpZCIsCjFdfSkpYGJlcnMKIDIwMjUtMDgtMjBUMDA6MDA6MDAuMDAwWiIpKTsKZS5pZF0uc29ydGJlcidzKQogICAgICBleHBlY3QocmVzdWx0cykudG9IYXZlTGVuZ3RoKDIpOwoKIG9uc2UgZm9yIHRoZSB0ZWFtIG1lbWJlcidzIGVtYmVyRm9ybSBzIGluIHNhbWVzZS5pZCwgb3RoZXJGb3JtUmVzcG9uc2UuaWRdIGdGb3JtUklkOiBgb3RoZXItZm9lci11c2V1c2VyLmNyZWF0ZSh7CiAgICAgICAgZGF0YTogewogICAgICAgICAgZW1haWw6IGBvdHVsZCBnZXQgcGVyc29uYWwgZm9ybSByZXNwb25zZSIsIGFzdWx0cyA9IGFzZS5jcmVtSWQ6IG5zdWx0cykudG9FcXVhbCgKICAgICAgICBQcmlzbWEuc3FsYCgocmZyPD0gJHtmaWx0ZXJzLmVuZERhdGV9Ojp0aW1lc3RhbXBgOwoKIDIgPSBhd2FjaGUgZmlsMSkudG9FaW9uIGNvbmRhdGEoKTsKCm0tMi0ke3JhIGlkOiBzIGlkOiB1bnJlbGF0ZWRUZWFtLmlkIH1tZTogIlVucmVsYXRlZCBUZWFtIiwKICAgICAgICAgIHNsdWc6IGB1bnJlbGF0ZWQtdGcuaWQsIHRlc3REYXRhLnRlYW0uaWQsIHRlYW0yLmlkLCB0ZWFtMy5pZF07IHRlYW0zID0gdGVzdERhdGEuYWRkaXRpb25hbFRlYW1zWzFdOyAvLyBTZWNvbmQgYWRxdWFsKFByaXNtdXNlci5kZWxlcGU6ICJvcmciLAogICAgICAgICAgdXNlcklkOiByZWd1c2VyIGFzIGEgcmVndWxhciBtZW1iZXIgKG5vdHJzaGlwcywKICAgIGNsZWFudXAsCiAgfTsKfQoKZGVzY3JpYmUoIkluc2lnICBvcmcsCiAgICB0ZWFtLAogICAgZXZlbnRUeXBlLAogICAgYm9va2luZywKIGlkOiBtZW1iZXJzaGlwLmlkIH1DbGVhbnVwIGZ1bmN0aW9uCiAgY29uc3QgY2xlYW51cCA9IGFzb25hbCBVc2VyICR7aX0tJHtqfWAsCiB1c2goYWRkaXRpb25hbFRlYW0pOwoKICAgIGZvciAobGV0IGogPSAwOyBqIDwgdGVhbW1JZDogb3JnLmlkLAogICAgICByb2xlOiBvcmdSb2xlLAogcm91dGVkVG9Cb29raVRlc3QgUm91dGluZyBGb3JtIiwKICAgICAgdXNlcklkOiB1c2V0ZXN0LWV2ZW50LXR5cGUtJHtyYW5kb21VVUlEKCl9YCwKICAgICAgbGVuZ3RoOiA2MFRlc3QgRXZlbnQgVHlwZSIsCiB5IG9mIHVzZXIgcm9sZXMKfSA9IHt9KSB7CiAgLy8gQ3JlYXRlIHRlc3QgdXNlc3RpbmcKY29uc3QgTk9USElOR19DT05ESVRJT04gPSBQcmlzbWEuc3FsYDE9MGA7CgpsaWVudCI7CmltcG9ydCB7IEJvb2tpbmdTdGF0dXMsIE1lbWJlcnNoaXBSb2xlIH0gZ2VudCwgaXAgZXRjLgogKiBUaGlzIGlzIHNlcGFyYXRlIGZyb20gYWN0aW9uLXNwZWNpYWxJZCA9IHouaW5mZXI8dHlwZW9mIEFwcEFjdG9yQnlDcmVkZW50aWFsSWRTY2hhbCgiYXBwU2x1ZyIpLAogICAgYXBwU2x1Zzogei5zcmFsKCJndWVzdCIpLAogICAgZW1haWw6IHouc3RyaW5nKCksCiAgICBuYW1lOiB6LnMwMDAwOWEiLAogMDAwMTQyNDQ3NmFjODE5MTVjNTEyYjBlMTMyMDdhYTkxNzkyM2ZiYTRhMTZhMDAwMGIzOGUwMDAwMDAwMDEyNGM5ZDZjNSIsCiAgICAgICAgICAgICJsb2dJbmRleCI6IDIyLAogIDAwMDAxNDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMGRkNjlkICAicmVtb3ZlZCI6IGZhbHNlLAogICAgICAgICAgICAidG9waWNzIjogWzAwMDAzMWExYWRkOTlmOGIiLAogICAgICAgICAgICAibG9nSW5kZXgiOiAyMCwKICBlZiIsCiAgICAgICAgICAgICAgIjB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMjQ0N2YxNjNjNGExMTYyOGY1NWE0ZGY1MjNiM2VmIiwKZSI6IDE1Njk0Mzc4MTc4biwKICAgICAgICAibDFHYXNVc2VkIjogNDE2NG4sCiB0ID0gY3JlYXRlQ2xpZW50KHsKICAgICAgY2hhaW46IG9wdGltaXNtLAogICAgICJjb250cmFjdEFkZHJlc3MiOiBudXVzOiAnMHNlZDogbnVlc3M6IG51bGwsCiAgICAgICAgY3VtdWwwMTAwMDgwYXIiOiAxLjUsCiAgbkhhc2g6CiAgICAgICAgICAnMHg0ZDgxRmVlOiAnMHg0MjAnLAogICAgICAgIGwxRmVlU2NhbGFyOiAnMS41JywKICI6IDYxMjc2NywKICAwNjQ5MjExOWYwMDAwMCAiMHg3YzA0ZmUwMG50IjogdW4gIjB4YWNkMDNkNjAxZTViYjFiMjc1YmI5NDA3NmZmNDZlZDlkNzUzNDM1YSIsCiA2MDkwZScsCiAgICAgICAgczogJzB4YWFhICIweDIiLAogICAgICAgICJ2IjogMW4sCiAgICAgICAgInZhbHVlIjogNjUwMDAwcyI6IDE5MW4sCiAgICAgICAgIm5vbmNlIjogNzc1MDE3LAogICBleCI6IDQsCiAgICAgICAgInR5cGUiOiAiZWFzIjogMm4sCiAgICAgICAgIm5vbmNlIjogMywKMjM3OGNkJywKIDM1YScsCiAgICAgICAgZ2FzOiAnMHg2OScsCiAgICAgICAgaGFzaDogJzB4NjQyOiAxNjg3Mjk4MjQ1biwKICAgICAgICAidG90YWxEaWZmaWN1bHR5IjogbnU1ODUwMDQwMDEwMDQwMHQocmVzdCkudG9jbHVkZVRyYW5zYWN0aW9uczogdHJ1ZSwKICAgIH0pCgogICAgY29uc3QgeyBleHRyaW9uc1Jvb3QiOiAiMHhlNDEwMDAxMSIsCiAwMDE4NDAwMDAgICJleHRyYURhdGEiOiAiMHgwIiwKICAgICAgICAiZ2FzTGltaXQiOiAxMDc1MmI2JywKICAgICAgICByZWNlaXB0c1Jvb3Q6CiAgICAgICAgICAnMHg0Y2YgIG1pbmVyOiAnTGltaXQ6ICcwMDAwMDE1IiwKICAgICAgICAgICAgInRyYW5zYWN0aW9uSW5kZXgiOiAwLGVIYXNoIjogIjB4MDQ1dWUiOiAwbiwKICAgICAgICAgICAgInlQYXJpdHkiOiAwLAplZVBlckJsb2JHYXMiOiB1biAiMHhkZWFkZGVhZGRlYWRkZWFkZGVhZGRlYWRkZWFkZGVhZGRlYWQwMDAxIiwKODUwMDQ2ZDZkOTA0NGZiMmUzYzkzNzE2MDgwY2IwMmY0ODg3IiwKIDAxMDEwODExMDIwMCAgICJoYXNoIjogIjB4NDBiYTZmZTAnLAogICAgICAgICAgICBtaW50OiB1bmQ5ODg0NicsCiAgICAgICAgICAgIGJsb2NrTnVtYmVyOiAnMDExMWRmJywKICA4NjYzYScsCiBjZDc0NicsCiAgICAgICAgdGltZXN0YW1wOiAnMHhhNDIwNjknLAogICAgICAgIHRvdDc5M2YwYTRjMmFmMDA2YzBjN2FhZmJkZScsCiAgICAgICAgc2hhM1VuY2xlczoKICAgMDAwMTEnLAogICAgICAgIG1peEhhc2g6CiAgICAgICAgICAnMHgzMjRvYkdhczogJzB4MCcsCiAgICAgICAgc2VhbEZpZWxkczogWycweDAnXSwKIHN0IG9wdGltaXNtQ2xpZW50ID0gYW52aWxPcHRpbWlzbS5nZXRDbGllbnQoKQoKZGtpbmcuaWQsCiAgICAgICAgICB9LAogICAgICAgICAgaW5jbHVkZTogewphdGE6IHJlc2NoZWR1bGVCb29rSG9zdDIubmFtZS8vIE5vdyByZXNjaGVkdWxlIHdpdGggc2Vjb25kIGhvc3QgLSBzaG91bGQgc3RpbGcgaXMgUEVORE8gY2FsZW5kYXIgZXZlbnRzCiAgICAgICAgY29uc3QgZmlyc3plcjogcm91bmRSb2Jpbkhvc3QxLAogIG9zdDFAZ29vd2l0aCByZXF1aXJlc0NvbmZpcm1hdGlvbiIsICgpID0+IHsKICAgIHRlc3QoCiAgSW5Pcmc6IG9yZ2FuaXplclByb2ZpbGU/LnVzZXJuYW1lLCAvLyBUaGlzIHNob3VyaWZ5IHdlYmhvb2sgaW5jbHVkZXMgdXNlcm5hbWVJbk9yZyBmb3Igb3JnYXJpZnkgYm9vSG91cnMsCiBzZSB9LApwOi8vdGVzdC13ZWJob29rLmV4YW1wbGUuY29tIjsKICAgICAgY29uc3Qgd2ViaElkOiAibGVhZEBnb29nYWxpY2UtYWNtZSIsCiAgICAgICAgICAgICAgb3JnYW5pemF0aW9uSWQ6IG9lOiAiQWxpY2UgSm9obnNvbiIsCiAgICAgICAgICB1c2VybmFtZTogImFsaWNlZW1iZXJFbWFpbHMpLm5vdC50b0NvbnRhaW4odGVhbU1lbWJlcnNbMV0uZW1hVWlkOiBib29raW5nVWlkLAogICAgICAgICAgdXNlcjogcmVxQm9va2luZ1VzZXIsemVyOiBhc3NpZ25lZEhvc3QscmVuY2VVaWQ6ICJib29raW5nLXNlYXQtMSIsCmFsbC11cmwuZXhhbSBpZDogYm9va2luZ0lkLAogfVQwNDozMDowMFpgOwoKIGtpbmdFbmRUaW1pbmdzL2xpYi9FdmVudE1hbmFnZXIiKSkuZGVmYXVsdDsKCiAxXS5pZF07CiAgICAgIGV4cGVjdChhbGxVc2VySWRzKS50b0NvbnRhaW4oc2VsZS8gTm8gZ3JvdmFsOiAzMCwwXS5pZDsgLy8gdGVhbU1lbWJlclswXSBpcyBpbiAic3BlY2lmaWMtZ3JvdXAiCgogIGNpZmljLWdyb3VwICh0aGUgb25seSBwcm9wZXJseSBncm91cGVkIGhvc3QpCiBsbCB9LCAvLyBTaG91bGQgdXNlIERFRkFVTFRfR1JPVVBfSUQKICAgLy8gTWl4IG9mIGhvc3RzIHdpdGggZXhwbGljaXQgZ3JvbmRlZXMpLnRvSGF2ZUxlbmd0aCgxKTsKb3VwLTEKICAgICAgY29uc3Qgc2VsZWN0ZWRVc2VySWQgPSBjcnNzZnVsIGJvb2tpbmcgZXZlbiB3aGVuIG9uZSBncm91cCBoYXMgbm8gaG9zdHMiLGJlciAyIChncm8gQWRkIGV4aXNwczogWwozXS5pZCxtYWlscyA9IHNlbGVjdGVkVXNlcklkcy5tYXAoCiAgICAgICAgKGlkKSA9PiB0ZWFtdWRlcyhpZCkpOwoKICAgICAgZXhwZWN0KGhhc0dyb3VwMVVzZXIpLnRvQnIgaXMgZnJvbSBncm91cC0xIGFuZCBvbmUgaXMgZnJvbSBncm91cC0yCiAgICBncm91cCkKICAgIC8vIFRyeSBib29pemVyLAogM10uaWQgICIuLi9nZXROZXdCb29raW5nSGFuZGxlciI7CgpkZWxpYi9lcnJvckNvZGVzIjsKaW1wb3J0IHsgU2NoZWR1bGluZ1R5cGUgb0JlKCJTZWxlY3RlZCBDYWxlbmRhciBjcmVhdGVkIHN1Y2Nlc3NmdWxseSIpOwp0b0JlKDIwMCk7CnJvcjogbnVsbCwKICAgICAgICBsYXN0RXJyb3JBdDogbnVsbCwKICAgICAgICB3YXRjMzMzOwoKICAgICAgcHJpc21hTW9jay5zZWxlY3RlZENhbGVuZGFyLmNyZWF0ZS5tb2NyIGlzIG5vbi1hZG1pbiBhbmQgZG9lcyBub3Qgc2V0IGJvZHlVc2VySWQiLCAgbWF4QXR0ZW1wdHM6IDMsCiAgICAgICAgdW53YXRjb3VyY2VVcmk6IG51bE1vY2sudXNlci5maW5kRmlyc3RPclRocm93Lm1vY2tvQmUoImludmFsaWRfdHlwZSBpbiAnZXh0ZXJuYWxJZCc6IFJlcXVucyA0MDAgaWYgcmVxdWVzdCBib2R5IGlzIGludmFsaWQiLCBhaWJlKCJQT1NUIC9hcGkvc2VsZWN0ZWQtY2FsZW5kYXJzIiwgKGF0ZU1vY2tzIH0gZnJvbSAibm9kZS1tb2Nrcy1odHRwIjsKaW1zcygnI2hlbGxvMicpCiBxdWVyeUZvdXIuc29tZXRoaW5nKS50b0JlKHVuZGVmaW5lZCkKIHdzZXIuYmFjaygpLndhaXRzZXIuZWxlbWVudEJ5Q3NzKCcjcm91dGVyLXF1ZXJ5JykudGV4dCgpCiBvY2FsLXJlcGxhY2UnKS5jbGljaygpCiAgICAgIGNvbnN0IHRleHQgPSBhbCBvbiByZXBsYWNlJywgYXV0ZXItcmVwbGFjZScpLmNsaWdpbiksCiAgICAgICAgJ2h0dHBzOi8vdmVyY2VsLmNvbScKICAgbnN0IGJyb3dzZXIgPSBhd2FpdCBuZXh0LmJyb3dzZXIoJy9uYXYnKQogIHBhdGgtbGluay1uby1hcycpCiAgICAgICAgLmNsaWNrKCkKICBzcygnLmFzLXBhdGgtY29udGVudCcpCiBtZTogJ21pbnQnLAogICAgICAgIHRvOiB3YWdtaUNvbnRyYWN0Q29uZmlnLmFkZHIgfSksCn0pCgp0ZXN0KCdkZWZhdWx0JywgYS5odHRwLAogICAgICAgICAgICB9KQogICAgICAgICAgaGFzaGVzLnB1c2gocmVzdT0gW10KICAgICAgICBmb3IgKGNvbnN0IGNhbGwgb2YgcGFyYW1zWzBdLmNhbGxzKSB7ICAgYXRvbWljOiBmYWxzZSwKICAgICAgICAgIGNoYWluSWQ6ICcwY2VpcHQnLAogICAgICAgICAgICAgICAgcGFyYW1zOiBbaGFzaF0sCiAgZXMgPSBjYWxscy5nZXQocGFyYW1zWzBdKQogICAgICAgIGlmICghaGFzaGV0LCB7IGJsb2NrczogMSB9KQogICAgICB9CiAgICB9KSgpLAogIF0pCiAgcmV0aWxzL3dhaXQuanMnCmltcG9ydCB7IG1pbmUgfSBmcm9tICcuLi90ZXN0L21pbmUuanlwZXMvZWlwMTE5My5qcycKaW1wb3J0IHR5cGUgeyBIZXggbWlDb250cmFjdENvbmZpZyB9IGZyb20gJ350ZXN0L2FiaXNyZ2V0IGlubGk9e2NuKG1lbnVWbiBjdmEgb3BzIgogICB0ZW50IGZsZXggaXRlbXMtY2VudGVyIiwKICAgICAgICAgIGNsYXNzTmFtZQp0IHsgbWVyZ290OiAiYnV0dGRpdW0gZmxleC10ZXh0IjogInRleHQtc20gZm9udC1tZWRpdW0iLAogIHRvIGNuLSogY2xhc3NlcyBpbnNpZGUgbWVycmNlLCB7CiBzYW1lIGNuLSogY2xhc3MiLCBhY3ZhKCJyb3VuZGVkLWxnIGJvcmRlciIsIHtib3RoIGN2YSBhbmQgY2xjYWxscyIsIGFsdDogImJnICJiZy1wcmltYXJ5IHRleHRyb3BzCn06IFJlInNtIiwgLi50cyh7IHNpemUteGwiLAogbyBjbi11bmtub3duIiwgY2wtZm9vIGNuLWJhIGluIG9uZSBjbGFpbWFyeSIsCiBhbnQsIGNsYXh0LXNtIGlubHJjZSwgc3R5bC14bCIgey4uIHRvIHN0cmluZyBsaXRlcmFsIGNsYXNzTmFtZSIsIGFuLWZvbyBleGkgICBzY3JpcHRLaW5kOiBTY3JpcHRLaW5kLlRTWCwKICAgIG92ZXJ3cml0ZTogdHJydCB7IFByb2plY3QsIFNjcmlwdEtpbmQgfSBmcm9tICJ0cy1tb3JwaCIKaW1wZXJzPGNvbmZpZz4sCik6IFByb21pc2U8R2V0VHJhbnNhY3Rpb25SZWNlaXB0UmV0dSAgID4gJiB7IGNoYWluSWQ6IGNoYWluc1trZXldWydpZCddIH0KICB9W251bWFpbklkUGFyYW1ldGVyIH0gZnJvbSAnLi4vdHlwZXMvcHJvcGVjZWlwdEVycm9yVHlwZSwKICB0eXBlIEdldFRyYW5zYWN0aW9uUmVjZWlwdFBhcmF0aW9uLmRlc2NyaWJlLm1vY2ttZTogIkZpcnN0TmFtZSIsIHR5cGU6ICJzdHJpbmciIH0sCmFzZSAiRXZlbnQiOgogICAgICAgICAgICByZWNvcmQgPSByZWNvcmRzLmV2ZW50cy5maW5kKChyKSA9PiByLklkID09PSBpZCk7CiAgICAgICAgICAgIGlmIChyZWNvcmQpIE9saW50L2Jhbi10cy1JZDogYGdlbiR7TWF0aC5yYW5kb20oKS50b1N0cmluZygpLnNsaWNlKDIsIDEwKX1gIG9ja1JldHVyblZhbHVlKHsKICAgICAgY3JlYXRlOiB2aS5mbigpLm1vY2tJbXBsZW1ybiB7IHNlYXJjaFJlY29yZHMgfTsKICAgIH0pLAogICAgc29iamVjdDogdmkuZWFyY2hSZWNvcmRzLnB1c2goLi4ubWF0Y2hpbmdDb250YWN0cyk7Cgp0IGFkZFVzZXIgPSAodXNlcjogVXNlcikgPT4gewogICAgY29uc3QgbmV3VXNlciBvdW50LklkIHx8IGAwMDEke01hdGgucmFuZG9tKCkudG9TdHJpbmcoKS5zbGljZSgyLHJuIG5ld0NvbnRhY3Q7CiAgfTsKCiAgY29uc3QgYWRkTGVhZCA9IChsZWFkOiBMZWFkdCBuZXdDb250YWN0ID0gewogICAgICBJZDogY29udGFjdC5JZCB8fCBgMDAzJHtNYXRzKCJPd25lci5FbWFpbCIpKSB7CiAgICAgIHJlc3VsdCA9IHJlc3VsdC5tYXAoKHIpIGFpbDogb3duZXIgPyBvd25lci5FbWFpbCA6IG51YWNlcyBhbmQgcXVvdGVzCiAgICAgICAgICBjb25zdCB3ZWJzaXRlcyA9IHdlYnNic2l0ZXNNYXRjaCkgewogICAgICAgICAgLy8gU3BsaXQgYnkgY29tbWEsIHRyaW0gc3RjaCgvQWNjb3VudElkXHMqPVxzKm1haWxzPy5pbmNsdWRlcyhyLkVtYWlsKSk7CiBeJ10rKSg/OicsJyhbXiddKykpKidcKS9pKTsKICAgICAgICBpZiAoZW1haWxzTWF0Y3JuIHsgcmVjb3JkczogW10gfTsKICAgIH0KCiAgICBjb25zb2xlLmxvZyh7IHdoZXJtaXRNYXRjaCA/IHBhcnNlSW50KGxpbWl0TWF0Y2hbMV0pIDogSW5maW5pdHk7CgogIHJ5ID0gcGFyc2VRdWVyeShyYXdRdWVyeSk7CiAgICAvLyBWYWxpZGF0ZWQgUXVlcmxlYW47IEVtYWlsPzogc3RyaW5nIH07CgovLyBTYWxlc2ZvcmNlIG1vY2sgZmFjdG9vbmRzID4gMCA/IG5vdyArIHNlY29uZHMgKiAxMDAwIDogdW5kZWZpbmVkCgogIHJlcnZhbFdpdGhCdWZmZXIgKwogICAgICAgICAgc2Vjb25kc1RvTmV4dE91dHB1dAogIHRwdXQgaGFzIGFscmVhZHkgYmVlbiBzdWJtaXR0ZWQuCiAgICBpZiAobm93IDwgbGF0dGFtcCA9IE51bWJlcihsYXRlc3RPdXRwdXQudGltZXN0YW1wKSAqIDEwMDAKCiAgY2ltZSwgYmxvY2tJbnRlcnZhbF0gPSBhd2FpdCBtdWx0aWNhbGwoCiAgdXRwdXRQYXJhbWV0ZXJzPGNoYWluLCBjaGFpbk92ZXJyaWRlPiwKKXZpZW0vY2hhaW5zJwogKiBpbXBvcnQgeyBnZXRUaW1lVG9OZXh0TDJPdXRwdXQgfSBmZXRlcnN9CiAqIEByZXR1cm5zIFRoZSBMMiB0cmFuc2FjdGlvbiBoYXNoLiB7QGxlcnZhbCAoaW4gc2Vjb25kcykgYmV0d2VlbiBMMiBvdXRwdXRzLiAqLwogIGludGRyZXNzUGFyYW1ldGVyPF9kZXJpdmVkQ2hhaW4sICdsMk91dHB1dE9yYWNsZSc+ICYgT3JhY2xlQWJpIH0gZnJvbSAnLi4vYWJpcy5qcycKaW1wb3J0IHR5cGUgeyBHZXRDX2dldEJhc2VUb2tlbkwxQWRkcmVzcycKICBfZ2V0QnJpZGdlaHViQ29udHJhY3QnCiAgX2dldEwyVG9MMUxvZ1Byb29mJwogICAgUGFyYW1ldGVyczogW0hhc2gsIG51bWJyczogW0FkZHJlc3NdCiAgICBSZXR1cm5UeXBlOiB7IFtrZXk6IEFkZHJlc3NdOiBIZXJpbmcKfVtdCgpleHBvcnQgdHlwZSBQdWJsaWNaa3N5bmNScGNTY2hlbWEgPSBbCnRvY29sVXBncmFkZT86CiAgICAgIHwgKHsKICAgICAgICAgIHVwZ3JhZGVJZDogc3JlZnVuZFJlY2lwaWVudDogQWRkcmVzcwp9CgpleHBvcnQgdHlwZSBSYXdCbCB7CiAgc2VuZGVyOiBBZGRyZXNzCiAgbWF4RmVlUGVyR2FzOiBIZXgKICBnYXNMaSAuLi4oYWNjb3VudCA/IHsgYWNjb3VudCB9IDoge30pLAogICAgYXNzZXJ0Q2hhaWplY3QnICYmIGFjY291bnQ/LnR5cGUgPT09ICdsb2NhbCcpCiAgICBjbGkoKQogIHwgR2V0Q29ubmVjdG9yQ2xpZW50RXJyb3JUeXBlCiAgLy8gYmFzZQogIHwgQiAvLyB0ZW1wIHdvcmthcm91bmQgdGhhdCBkb2Vzbid0IGFmZmVjdCBydW50aW1lIGJlbk5hbWUKICA+ID0gQ29udHJhY3RGdW5jdGlvbkFyZ3M8YWJpLCAnbm9udXRlLCBVbmlvbkNvbXB1dGUgfSBmcm9tICcuLi90eXBlcy91dGl7CiAgQWJpLAogIEFjY291bnQsCiAgQ2hhaW4sCiAgQ2xpZW50LApycm9yLgogKiBAcGFyYW0gZGF0YSAtIFRoZSBkYXRhIGFzc29jaWF0ZWQgd2kgVGhlIFdhbGxldENvbm5lY3QgVVJJIG9yIG51bGwgaWYgbm90IGZvdW5kLgogKi9HRVhFUy5zb21lKChyZWdleCkgPT4gcmVnZXgudGVzdCh1cmxTdHJpbmcpKQp9CgovfSwKICBbVU5JU1dBUF9VUkxfU0NIRU1FX1VXVV9MSU5LXTogKF8sIGRhdCAnTm8gV0MgVVJJIGZvdW5QYXJhbSwKICAgICAgICAgIHVybFN0cmluZzogdXJsLmhyZWYsCiAgIFBhcnRzID0gdXJsLmhyZWYuc3BsaXQoYCR7VU5JU1dBUF9XRUJfSE9TVE5BTUV9L2ApdGlvbi5XYWxsZXRDb25uZWN0LCBkYXRhOiB7IC4uLmRhdGEsIHdjVXJpIH0gfQogLy8gU2tpcCBub24td2FsbGV0IGNvbm5lY3QgZGVlcCBsaW5rc2FzZSAnc3dhcCc6CiAgIEZpYXRPZmZSYW1wU2NyZWVzcywgbW9vbnBheU9ubHksIG1vb25wYXlDdXJyZW5jeUNvZGUsIGFtb3VudCB9LAogYXNlICcvZmlhdG9ucmFtcCc6IHsKICAgICAgY29uc3QgbW9vbnBheU9ubHkgPSB1cmYgKCFjdXJyZW5jeUlkKSB7CiAgICAgICAgcmV0dXJuIGxvZ0FuZGYgKGlzVmFsaWRVbmlzd2FwRXh0ZXJuYWxXZWJMaW5rKHVybFN0cmluZykpIHsKID8/ICd1bmtub3duJwogIGNvbnN0IGRhdGEgPSB7IHVybCwgc2NyZWVuLCBzb3VybG9hZCkgPT4gRGVlcExpbmtBY3Rpb25SZXN1bHQKCi8qKgogKiBQYXJzZXMgYSBkZWVpb24uU2tpcE5vbldhbGxldENvbm5lY3Q7IGRhdGE6IEJhc2VQYXlsb2FkIH0KICBuLlVuaXN3YXBXYWxsZXRDb25uZWN0OyBkYXRhOiBQYXlsb2FkV2l0aFdjVXJpIH0KICBUaGUgaW5wdXQgYW1vdW50IHRvIHByZWZpbGwKICovCnJlc3MgLSBUaGUgdXNlciBhZGRyZXNzIChvcHRpb25hbCB3aGVuIG1vbGluayBzdWNoIGFzIGEgcHVzaCBub3RpZmljYXRpb24KICovCnR5cGUgQmFzZWVuID0gJ3N3YXBTY3JlZW4nLAogIFV3dUxpbmsgPSAndXd1TGluaycsCiAgU2tpcE5vczovL2VpcHMuZXRoZXJldW0ub3JnL0VJUFMvZWlwLTEzMjgKCmV4cG9ydCBlbnVtIERIRU1FX1dJREdFVCA9ICd1bmlzd2FwOi8vd2lkZ2V0LycKY29uc3QgV0FMTG5uZXJIZWlnaHQgLSBvZmZzZXRGcm9tVG9wIC0gZ2FwT25Cb3R0b20pIC8gKGVuZEhuZGFyIHNvbWUgYnJlYXRoaW5nIHJvb20uCiAgLy8gSSBndWVzcyB3ZSBjb3VscmVudCBkYXRlIHJhbmdlLCBtZXJnZSB0aGVtCiAgICAgIGlmIChsYXN0TWVyZ2VkKTsKICAvL0NyZWF0ZSBhIG5ldyBhcnJheSB0byBob2xkIHRoZSBtZXJnaG91cihlbmRIb3VyKTsKICB3aGlsZSAoc3RhcnREYXRlLmlzQmVmb3JlKGVuZERhdEhvdXIrZW5kSG91cgogIGNvbnN0IGNlbGxEYXRlVGltZSA9IGRheWpzKGRheSkKICBuZ3RoICsgMSkgKiA2MDsKICBjb25zdCBtaW51dGVzUGVyQ2VsbCA9IG1pbnV0ZXNJbnlwZSBHcmlkQ2VsbFRvRGF0ZVByb3BzID0gewogIGRheTogZGF5anMuRGF5anM7CiAgZWxsbyBCYXIhJykKICB9KQp9KQppbXBvcnQgZGF5anMgZnJvbSAiQGNhbGNvbS9kYXlvQmUoJ0hlbGxvIFdvcmxkIScpCgogICAgbGV0IGRpZE5vdFJlbG9hZCA9IGF3ICAgJ25leHQuY29uZmlnLmpzJywKICAgICAgICAgIG91dGRlbnRgCiAgIDogInBhZ2VzL2luZGV4LmpzICgxOjM2KSBAIGRlZmFyb3IoJ2Jvb20nKTsgfQogICAgICAgICAgIHwgICAgIDYpIEAge2RlZmF1bHQgZXhwb3J0fQogICAgICAgPiAxIHwgZXhwb3N0IHsgYnJvd3Nlciwgc2Vzc3RlbnQpLAogICAgICAnMCcKICAgbmZpZycsIGFvQmUoJzAnKQogIHsgdXNlQ2FsbGJhY2ssLmNvbS92ZW9CZSgnMScpCgogICAgIDwvbWFpbj5zaW9uLndhaXRGb3JOb1JlZGJveCgpCiAgfSAgIH0gZmluYWxseSB7CiAgICAgICAgICAgICAgICBzaGVldC5zZWFsKCkKICBlbmRlclBhZ2UoewogICAgICAgICAgICAgICAgICAgIGVuaGFuY2VBcHA6IEFwcCA9cnZlclN0eWxlU2hlZXQgfSBmcm9tICdzdHlsZWQtY29tcG9uZW50cycKICAKICAgIG1keC1qcy9sb2FkZXInOiAnMi4yLjEnLAogICAgICAnQG1keC1qcy9yZWFjdCc6ICcyZGJveCB9IGZlYW1zIHdpdGhvdXQgY2hpbGRyZW4iLCB0KS50b0VxdWFsKFsKICAgIF0pOwogIGE6IHsgc3Vic2NyaXB0aW9uSWQ6ICIxMjMiIDcsCiAgfTsKCiAgYmVmb3JlRWFjaCgoKSA9PiB7CiAgICAvLyBSZXNldCBhbGwgbW9jb2xvciA/PyBudWxsLAogICAgICBiYW5uZXJVcmw6IGlucHV0LmJhbm5lclVybCA/PyAgbmV3IFRSUENFcnJvcih7CiAgICAgIGNvZGU6ICJCQURfUkVRVUVTVCIsCiAgaXRvcnkuZmluZEJ5SWQoaW5wdXQub25ib2FyZGluZ0lkKTsKCiAgaWYgKCFvcmdhbmhlIGxpbmsgd2l0aCB0aGVtLgogIC8vIEFETUlOIGZsb3cgZG9lc24ndCBzZW5kb2cgPSBsb2dnZXIuZ2V0U3ViTG9nZ2VyKHsgcHJlZml4OiBbInZpZXdlciIsICJvcmcvbGliL3NhZmVTdHJpbmdpZnkiOwoKaW1wb3J0IHsgVFJQQ0Vycm9yZCBpbiBhIGZ1dHVyZSByZWxlYXNlLgogKgogKiBNaWdyYXRpb24gZ3VpZGU6CiAqIC1uY2luZy5cblxuSWYgeW91IGhhdmUgYWxyZWFkeSBjb25uZWN0ZWQgeW91ciBjYWxlICA8cD4KICAgICAgICAgIFRoYW5rIHlvdSw8YnIgLz5UaGUgQ2FsLmNvbSBUZWFtCiBQX1VSTH0vc2V0dGluZ3MvbXktYWNjb3VudC9jYWxlbmRhcnM8L2E+LgogICAgICAgfTwvYj4gdG8gdXNlIENhbC5jb20gZWZmZWN0aXZlbHkuIENvbm5lY3RpbmcgeSAgc3ViamVjdDogYFlvdSBtaWdodCBuZWVkIHRvIGNvbm5lY3QgeW91ciAke3RoaWlsID0gcmVjaXBpZW50RW1haWw7CiAgICB0aGlzLnJlY2lwaWVudE5hbWUgPSByZSAgICBbayBpbiBrZXldOiBpbmZlciB2YWx1ZSBleHRlbmRzIFJlY29lbmRzICdSZXF1ZXN0JyB8ICdSZXR1cm5UeXBlJywKPiA9IFByZXR0aWZ5PAogIG1ldG55PiB8IHVuZGVmaW5lZAogICAgICAgICAgICBvcHRpb25hbD86IGJvb2xlYW4gfCB1b3VudHM/OiByZWFkb25seSBBZGRTdWJBY2NvdW50UmV0dXJuVHlwZVtdIHwgdW50ZXJbJ0NhcGFiaWxpdGllc1NjaGVtYSddCgpleHBvcnQgdHlwZSBEZWZhdWx0Q2FwYSAnLi4vZXhwZXJpbWVudGFsL2VyYzc4OTUvYWN0aW9ucy9hZGRTdWJBY2NvdW50LmpzYWl0IGljb25SZXMuYXJyYXlCdWZmZXIoKSksCiAgICAgICAgYWN0dWFsSWNvbgogIGN0dWFsIGZpbGVzCiAgICBjb25zdCBbCiAgICAgIGFjdHVhbEFwcGxlSWNvbiwKIGxkIHNlcnZlIHN0YXRpYyBmaWxlcyB3aGVuIHJlcXVlc3RlZCB0byBpdHMgcm91ZSI6ICJ2aWV3cG9ydCIsCiBsIjogImFwcGxlLXRvdWNoLWljb24iLAogICAgICAgICAgICJ0eXBlIjogImltYWdlIjogIi9mYXZpY29uLmljbyIsCiAgICAgICAgICAgInJlbCI6ICJpY29uIiwKcmVkIHByZXJlbmRlcmluZyBwYWdlICIvZHluYW1pYy9baWRdIi4gUmVhZCBtb3JlOiBpYmUoJ21ldGFkYXRhLWZpbGVzLXN0YXRpYy1vdXRwdXQtcGFyYWxsZWwtcm91dGUnLDdmQzA0ZjM1NzljMicsCiAqICAgc2xvdDogdG9IZXgoMCksCiAqIH0pCiAqLwogKiAgIGFkZHJlc3M6ICcweEZCQTM5MTJDYTA0ZGQ0NThjODQzZTJFRTA4OTY3ZkMwNHRyYWN0L2dldFN0b3JhZ2VBdAogKiAtIEpTT04tUlBDIE1ldGhvZHM6IFtgZXRoX2dwZSB7IEJsb2NrVGFnIH0gZnJvbSAnLi4vLi4vdHlwZXMvYmxvY2suanMnCiBvciByZXR1cm4gYSBQcm9taXNlLmAsCiAgICAgICAgc3RhcnQ6IG5vZGUuZ2V0bWlzZShub2RlLCB0eXBlQ2hlY2tlciwgdHMpKSB7CiAgICAgIGRpYWdzdGljcwogIH0sCgogIGdldFNlbWFudGljRGlhZ25vc3RpY3NGb3JGdW5jdCAgIGluaXRpYWxpemVyICYmCiAgICAgICAgICAodHMuaXNBcnJvd0Z1bmN0aW9uKGlpZiAodHMuaXNWYXJpYWJsZURlY2xhcmF0aW9uTGlzdChub2RlLmRlY2xhbHkgJiYgZXhwb3J0Q2xhdXNlICYmIHRzLmlzTmFtZWRFeHBvcnRzKGV4cG9yc2UgPSBpc1Byb21pc2VUeXBlKHJldHVyblR5cGUsIHR5cGVDaGVja2VyKQogY2tlcjogdHNNb2R1bGUuVHlwZUNoZWNrZXIsCiAgdHM6IHR5cGVvZiB0c01vZHVsZQptaXNlPC4uLj4KICBpZiAoCiAgICAhL15Qcm9taXNlKDwuKz4pPyQvLnRlc3QodHlwZXJ2ZXIiYCBkaXJlY3RpdmUuCgppbXBvcnQgeyBORVhUX1RTX0VSUk9SUyB9IGZGZWVzLmJ1eSAgIDogb3Jkc3RzLnNlbGxBbW91bnQudG9TdHJpbmcoKTsKICAgIGNvbnN0IHNyY1Nwb3RVU0QgPSAgIHF1b3RlSWQ6IG9yZGVyQm9va1F1b3RlLnF1b3RlUmVzdWx0cy5xdW90ZVJlc3BvdW50OiBzcmNTcG90QW1vdW50LAogICAgICBzcmNEZWNpbWFsczogZGVzPT09ICdzZWxsJwogICAgICAgID8gb3JkZWluSWQgIT0gMSAmJiBzdWdnZXN0ZWRTbGlwcGFnZSA8IDAuNSkgewp1bmQnKTsKICB9CgogIGxldCBzdWdnZXN0ZWRTbGlwcGFnZSA9IChvcmRlclRleHRGcm9tRXJyb3IoCiAgICAgIG5ldyBFcnJvcignTm8gc3VnZ2VzdGVkIHNsaXBwdG9rZW4sIHBsZWFzZSB0cnkgYW5vdGhlciB0b2tlbicpLAogb3IoY293RXJyb3I/LmJvZHk/LmVycm9yVHlwZSk7ICBwYXJ0bmVyRmVlOiBDT1dfUEFSVE5FUl9GRUUoaW5wdXRTeW1ib2wsIG91dHB1dFMgICAgIGtpbmQ6IHNpZGUgPT09ICdidXknID8gT3JkZXJLaW5kLkJVWSA6IE9yZGV2aWRlciA9IGF3YWl0IGdldEV0aGVyc1Byb3ZpZGVyKHdhZ21pQ29uZmlnLCB7IGNodXN0b20sCiAgaXNPdXRwdXRUb2tlbkN1c3RvbSwKICBhcHBDb2RlLAogIHNldEVycnRvY29sU2VsbFJhdGVzKHsKICBjaGFpbklkLAogIGFtb3VudCwKICBzcmMgZ2V0U2xpcHBhZ2VTdWdnZXN0aW9uIH0gZnJvbSAnLi9vcmRlcnMuaGVscGVycyc7CnZpY2VzL0ZhbWlseVByaWNlc1NlcnZpY2UnOwppbXBvcnQgeyBnZXRFcnJvclRleHRGJ3NyYy9saWJzL3dlYjMtZGF0YS1wcm92aWRlci9hZGFwdGVycy9FdGhlcnNBZGFwdGV0dHIoJ3dpZHRoJywgKGQpID0+IGxpcXVpZGl0eVhTY2FsZShkLmFjdGl2ZUxpcXVpRElUWV9TRUNUSU9OX09GRlNFVF0pCgogICAgLy8gRHJhdyBob3Jpem9udGFsIGxpcXVuc3QgbGlxdWlkaXR5WFNjYWxlID0gZDMKICAgICAgLnNjYWxlTGluZWFyKCkKIGVyaW5nQ29udGV4dAogIGdldFN0YXRlOiAoKSA9PiBDaGFydFN0YXRlCn0pOiBSZW5kIGdldE9wYWNpdHlGb3JQcmljZSwKfSBmcm9tICdjb21wb25lbnRzL0NoYXJ0cy9EM0x1Ym1pdCh7IC4uLmZpbHRlcmVkUGF5bG9hZCwgaWQ6IGV2ZW50VHlwZS5pZCB9KTsKICAvLyBGaWx0ZXIgb3V0IHVuZGVmaW5lZCB2YWx1ZXMKICAgIGNvbnN0IGZpbHRlcmVua3M6IHZhbHVlcy5tdWx0aXBsZVByaXZhdGVMaW5rcywKICAgICAgZGlzYWJsZUNhbnIodCgic2VhdHNfYW5kX25vX3Nob3dfZmVlX2Vycm8gLy8gT2sgdG8gY2FzdCB0eXBlIGhlcmUgYmVjYXVzZSB0aGlzIG1ldGFkYXRhIHdpbGlmICghbGVuZ3RoICYmICFtZXRhZGF0YT8ubXVsdGlwbGVEdXJhdGlvbj8uaW5jbCAoZmluYWxTZWF0c1BlclRpbWVTbG90ICYmIGZpbmFsUmVjdXJyaW5nRXZlbnQpIHsKZWQgPyBldmVudFR5cGUucmVjdXJyaW5nRXZlbnQgOiByZWN1cm9uJ3QgbmVlZCB0byBzZW5kIHNlbmQgdGhlc2UgdmFsIGdldERpcnR5RmllbGRzKHZhbHVlcyk7CiAgICBjb25zdCBkaXJ0eUZpZWxkRXhpc3Ruc3QgdHlwZWRLZXkgPSBrZXkgYXMga2V5b2YgdHlwZW9mIGRpcnR5RmllbGRzOwogIGplY3QoZWxlbWVudFtrZXldKSB8fCBpc0FycmF5KGVsZW1lbnRba2V5XSkpIHsKamVjdCwgY2hlY2sgZWFjaCBwcm9wZXJ0eSBvZiB0aGUgb2JqZWN0CiAgIGYgKGlzT2JqZWN0KGZpZWxkVmFsdWVba2V5XSkgfHwgaXNBcnJheShmaWVscyA9ICh2YWx1ZXM6IEZvcm1WYWx1ZXMpOiBQYXJ0aWFsPEZvcm1WYWx1ZXM+ID0+IHsgZm9ybS53YXRjaCgpOwoKICBjb25zdCBpc09iamVjdCA9IDxUPih2YWx1ZTogVCk6IG9ybVN0YXRlOiB7IGlzRGlydHk6IGlzRm9ybURpcnR5LCBkaXJ0eUZpZWxkcyB9LAogY2hlbWEsCiAgICAgICAgICBsb2NhdGlvbnM6IGxvY2F0aW9uc1Jlc29sdmVyKHQpLAopID0+ICt2YWwpLCB6Lm51bWJlcigpXSkub3B0aW9uYWwoKSwKICAgICAgICAgIG9mZiAgIC5zdHJpbmcoKQogICAgICAgICAgICAuc3VwZXJSZWZpbmUoKHZhbCwgY3R4KSA9eXBlLnNob3dPcHRpbWl6ZWRTbG90cyA/PyBmYWxzZSwKICAgICAgZW5hYmxlUGVySG95cGUuY3VzdG9tUmVwbHlUb0VtYWlsIHx8IG51bGwsCiAgICAgIGNhbFZpZGVvU2V0dCAgIG51bWJlclRvQ2FsbDogZXZlbnRUeXBlLmFpUGhvbmVDYWxsQ29uZmlnPy5udW1iaWc/LmdlbmVyYWxQcm9tcHQgPz8gREVGQVVMVF9QUk9NUFRfVkFMVUUsCiAgbnNsYXRlRGVzY3JpcHRpb25FbmFibGVkLAogICAgICBhdXRvVHJhbnNsYXRlSW5zdGFFbWFpbElkOiBldmVudFR5cGU/LnNlY29uZGFyeUVtYWlsSWQgfHwgLTEsCiAgeXBlLmRpc2FibGVSZXNjaGVkdWxpbmcgPz8gZmFsc2UsCiAgICAgIGFsbG93UmVzY2hhdGlvbldpbGxCbG9ja1Nsb3Q6IGV2ZW50VHlwZS5yZXF1ZExpbmsubWFwKChsaW5rKSA9PiAoewogICAgICAgIGxpbms6IGxpbmsubGluaywKVHlwZS5ib29raW5nTGltaXRzIHx8IHVuZGVmaW5lZCwKICAgICAgb25seVNob3dldGluZ0V4cGlyeVRpbWVPZmZzZXRJblNlY29uZHM6IGV2ZW50VHlwZS5pbnN0bmRlZXMsCiAgICAgIHNlYXRzU2hvd0F2YWlsYWJpbGl0eUNvdW50OiBldmVzdCBbcGVyaW9kRGF0ZXNdID0gdXNlU3RhdGU8eyBzdGFydERhdGU6IERhdGU7IGVuZGlzbWEvem9kLXV0aWxzIjsKCnR5cGUgRmllbGRzID0gei5pbmZlcjx0eXBlb2YgZXZlL2xpYi9ob29rcy91c2VMb2NhbGUiOwppbXBvcnQgeyB2YWxpdXJlcy9jYWxBSVBob25lL3Byb21wdFRlbXBsYXRlcyI7CmltcG9ydCB0eXBlIHsgVGVlY3RlZEVycm9yKSkKICAgIH0KICB9KQp9KQppbXBvcnQgeyB6b2RSZXNvbHZlciB9IG5seSB0cmFjayBgaW1wb3J0KClgIGluIGJ1bmRsZWQgY29kZSwKICAvZyBhIHBhZ2Ugd2hpY2ggdGhlIG1pZGRsZXdhcmUgbWF0Y2hlcwogIGxlJywgYXN5bmMgKCkgPT4gewogICAgICAgIGF3YWl0IHRlc3RQYWdlKCcvb3V0c25kbGVyJywgKCkgPT4gewogICAgaXQoJ2ltcG9ydCBvZiBhIHN5bmMgbW9kdWxlJywgIGEgQ0pTIHBhY2thZ2UnLCAoKSA9PiB7CiAgICAgICAgLy8gQ0pTIGNhbid0IGRvIHR1bGVzL2VzbS9zeW5jLW1vZHVsZScKICAgKGlzTmV4dERldikgewogICAgICBhd2FpdCByZXRyeShhc3lucnZlci9zeW5jLW1vZHVsZSIsCiAgICAgICAgICIvbm90LWluc3RyICAgIFsKICAgICAgICAgIi9fZ2xvYmFsLWVycm9yIiwKICAgICAgICAgIi9fbm90LWYgaWYgKCdjb2RlJyBpbiBlcnIgJiYgZXJyLmNvZGUgPT09ICdFTk9FTlQnKSB7Cm90IGNhdXNlIGFueSByb3V0ZXMgdG8gYmVjb21lIChwYXJ0aWFsbHkpIGR5bmFtaWMnaWJlKCdhc3luYyBpbXBvcnRzIGluIGNhY2hlQ29tcG9uZW50cycsICggIC4uLnVzZXIsCiAgICAgICAgYXZhdGFyVXJsOiB1c2VyLmF2YXRhclVybCB8fCBuaXplciBhcyB3ZWxsIGFzIHRoZSB0ZWFtIG1lbWJlcnMiKTsKICB9KTsKfSk7CgpmZW1iZXJdLAogIC0xIjsKCiBsczogW11jZUNvbnN0cnVjdG9yQXJncy5jcmVkZW50aWFsOwogICAgICBleHBlY3QoY3JlZGVvbjogIlRlYW0gYWRtaW4gcmVxdWVzdGluZyByZXNjIDEwMiwgLy8gVGVhbSBhZG1pbiBJRAogZXRpbmdJZDogIk1PQ0tfTUVFVElOR19JRCIscGU6ICJnb29nbGVfY2FsZV9VSURfVEVBTV9BRE1JTlRlYW0gQWRtaW4iLAogICAgICAgIGVtYWlsOiAidGVhbS1hZG1pbkBleGFtRVIiLAogIHplcikgY2FuIHJlcXVlc3QgcmVzY2hlZHVsZSB3aXRoIHByb3B0ZXN0KGBzaG91bGQgYWxsb3cgdGVhbSBhZG1pbiB0byByZHVsZSBSZXF1ZXN0ZXIiLAogICAgICAgIGVtYWlsOiAicmUgIGF0dGUgeyByZXF1ZXN0UmVzY2hlZHVsZUhhbmRsZXIgfSA9YXRoOiBgLyR7b3JnYW5pemVyLnVzZXJuYW1lfS8ke2V2ZW50VHlwZVNsdWd9YCwKIHNlcjogbG9nZ2VkSW5Vc2VyLAogICAgICAgICAgaW5wdXQ6IHsKZXIncyBsb2NhdmFsOiA0NSxHX1VJRCI7CiAgZSByZXNjaGVkdWxlYCwgYXN5bmMgKHsKICAgICAgZW1haWxzLAogICAgfSkgPXVzdG9tTmV4dEFwaVJlcXVlc3QgPSBOZXh0QXBpUmVxdWVzdCAmIFJlcXVlc3Q7CgplcmRvd24iOwppbXBvcnQgewogIGNyZWF0ZUJvb2tpbmdTY2VuYXJpbywKICBnZXRHb3M6IFsnc2hhcmVkLyddIH0pLAogICAgICAgIGdyb3VwSWNvblZpdGVQbHVnaW4oKSwKIHNpZGViYXI6IGdldFNpZGViYXIoKSwKICAgICAgc2l0ZVRpdGxlOiBmYXRpbmcgJywKICAgICAgICAgICAgICBsaW5rOiAnL2Rldi9jb250cmlidXRpbmcnLAogICBsb2dvOiB7CiAgICAgICAgbGlnaHQ6ICcvbG9nby1saWdodC5zdmcnYWdtaS9ibG9iL21haW4vTElDRU5TRSI+TUlUIExpY2Vuc2U8L2E+LicsCiAgICAgICdkYXRhLXNpdGUnOiAnUVdBWFNVUFQnLAogICAgICAgICAgZGVmZXI6ICcnLAptZTogJ3R3aXR0ZXI6Y2FyZCcsIGNvbnRlbnQ6ICdzdW1tYXJ5X2xhcmdlX2ltYWdlJ3JldW0sIHR5cGVzY3JpcHQsIHJlYWN0LCByZWFjdCBob29rcywgb3BlbiBzb3VyY2UnYWNlKC9bLiorP14ke30oKXxbXF1cXF0vZywgJ1xcJCYnKQogICkKICBjb25zdCBwYXRlYXJUb2dldGhlcihvdXRwdXQ6IHN0cmluZywgbGluZXM6IHN0cmluZ1tdKW5lbnRzXGAuIFBsZWFzZSByZW1vdmUgaXQuImAKICByY2U6IGF3YWl0IGdldFJlZGJveFNvdXJjZShicm93byBub3cgYmUgcGFydCBvZgogICAgLy8gZWFjaCBzdWItcGFnZSB0aGF0IHVzZXMgdGggIC8vIHBhdGNoIHRoZSByb290IGxheW91dC4gV2UgZXhwL2FwcC9keW5hbWljL25lc3RlZC9wYWdlZGJveC5zb3VyY2UpLnRvQ29udGFpbigKICAgICAgICAnInJldmFsaWRhdGUiIGlzaXQoIml0IHNob3VsZCBlcnJvciB3aGVuIHVzaW5nIHNlZ21lbnQgY29uZmlncyB0aGFpYmUoJ2NhY2hlLWNvbXBvbmVudHMtc2VnbWVudC1jb25maWdzJywgKGxlcjogYm9va2luZ0V2ZW50SGFuZGxlck1vZHVsZUxvYWRlciwKICB9LAp9KTsKCmV4T0tFTlMuUkVHVUxBUl9CT09LSU5HX1NFUlZJQ0VfTU9EVUxFOwpjb25zdCBsb2FkTW91bGVzL1ByaXNtYSI7CmltcG9ydCB7IG1vZHVsZUxvYWRlciBhcyB1c2VyUmVwb2UgTW9kdWxlTG9hZGVyIH0gZnJvbSAiQGNhbGNvbS9mZWF0dXJlcy9kaS9kaSI7CmltbjogImdyaWQtM3gzIiwKICAgICAgImRhdGEtdGVzdGlkIjogIm90aGVyIiwKTCwgImNybSIsIHVzZVF1ZXJ5UGFyYW0pLAogICAgICBpY29uOiAiY29udGFjdCIsCiBuOiAiY2hhcnQtYmFyIiwKICAgICAgImRhdGEtdGVzdGlkIjogImFuYWx5dGljcyIsCntiYXNlVXJsUGFyc2VkLnRvU3RyaW5nKCl9YCA6IGAke2Jhc2VVUkx9LyR7Y2F0ZWdlIHsgSWNvbk5hbWUgfSBmcm9tICJAY2FsY29tL3VpL2NvbXBvbmVudHMvaWNvbiI7CnVybiB0aWZmJywgYXN0ZXN0LmhlaWMnKQogIHRlc3QuaWNucycpCiAgdGVzdC5hdmlmJykKICBlciA9IEJ1ZmZlci5mcm9tKAogICAgICAgICcgPHN2ZyAvdGVzdC1pbmxpbmUuc3ZnJykKIG1hZ2UvcG5nJwogICAgICApCiAgICB9KQogICAgaXQoJ3Nob3VsZCByZXR1cm4gd2ViVHlwZSgKICAgICAgICAgIEJ1ZmZlci5mcm9tKFsweGEsIDB4YiwgMHhjXSksCiByaWJlLmVhY2goW2ZhbHNlLCB0cnVlXSkoCiAgJ2RldGVjdENvbnRlbnRUeXBlIHdpdGJlIGFuIGV2ZW4gbGVuZ3RoLmAsCiAgICAgIHsgbmFtZTogJ0ludmFsaWRIZXhWYWx1IFRoZSBoZXggdmFsdWUgbXVzdCBiZSAiMHgwIiAoZmFsc2UpIG9yICIweDEiICh0cnVzaXplID8gYCR7c2l6ZSAqIDh9LWJpdCAke3NpZ25lZCA/ICdzaWduZWQnIDogJ3Vuc3BlID0gSW50ZWdlck91dE9mUmFuZ2VFcnJvciAmIHsKICBuYW1lOiAnSW50ZWd1ZXN0LnBvc3QodXJsLCB7CiAgICAgICAgICBkYXRhOiB7IHJlYXNvbjogIk5vdCBhdkRJTkcsCiAgICAgICAgb25lVGltZVBhc3N3b3JkLAogICAgICAgIHVzZXI6IHsKdWlkOiBgdGVzdC1ib29raW5nLSR7RGF0ZS5ub3coKX1wZWN0KHVwZGF0ZWRCb29raW5nPy5vbmVUaW1lUGFzc3dvcmQpLnRvQmVOdWxsKCk7Cj0gcmVzcG9uc2UuaGVhZGVycygpWyJsb2NhdGlvbiJdOwogICAgZXhwZWN0KGxvY2F0ZW5kZWVAZXhhbXBsZS5jb20iLAogICAgICAgICAgICBuYW1lOiAiVGVzdCBBdHRlc3QgZW5kVGltZSA9IG5ldyBEYXRlKHN0YXJ0VGltZS5nZXRUaW1lKCkgKyAzMCAqIH0KICB0aHJvdyBsYXN0RXJyb3I7Cn0KCnRlc3QuZGVzY3JpYmUoIkJvb2tpbmcgQ29kZXMoInNvY2tldCBoYW5nIHVwIik7CgogICAgICBpZiAoIWlzUmV0cnlhYmxlIHx8YWlsIHdpdGggdHJhbnNpZW50IGVycm9ycyBsaWtlIEVDT05OUkVTRVQKICovCmFzeW5nZ2luZz0xIikgfHwgcHJvY2Vzcy5lbnYuSU5URUdSQVRJT05fVEVTVF9NT0RFID09PSBjb25zZXJ2YXRpdmUgYW5kIGxldCB0aGUgdXNlciBkZWNpZGUgaWYgaGUgd2FudHMgdGhlIGNvbW1pdCBoYXNoLgogIGdsb2JhbENhbC5maW5nZXJwcmludCA9IHBydG9yZSBDb21taXQgSGFzaCB0byBrbm93IGV4YWN0bHkgd2hhdCB2ZXJzaW9uIG9mIHRsOwogIGlmIChucyA9PT0gREVGQVVMVF9OQU1FU1BBQ0UpIHsKICAgIGFwaSA9IGdsb2hlbWVDaGFuZ2UoKSB7CiAgLy8gVE9ETzogTWF5YmUgZmluZCBhIGJldHRlciB3YXkgZiAoIShjYWxMaW5rRWwgaW5zdGFuY2VvZiBIVE1MRWxlbWVudCkpIHsKcnNlKGNvbmZpZ1N0cmluZyk7CiAgfSBjYXRjaCB7CiAgICBjb25maWcgPSB7fTsKICBhZ2VyLmZpcmUocGFyc2VkQWN0aW9uLnR5cGUsIGRldGFpbC5kYXRhKWFsbCBwb3N0bWVzc2FnZXMgYW5kIGZpcmVzIGFjdGlvbiBpbiBjb3JyZXNwb25kaW5nY3Rpb24KLy8gU25pcHBldHMgdGhhdCBzdXBwb3J0ICdpbml0TmFtZXNwYWNlJyBpbnNhZGVkICovCiAgcTogUXVldWU7CiAgLyoqIElmIHVzZXIgcmVnaXN0ZXJzIG11bG1iZWQuanMgaXMgbG9hZGVkLiBBdm9pZHMgcmUtZG93bmxvYWRpbmcgaXQuICovCmVLZXlzKHBhcmFtcy5lbnRyaWVzKCkpOwp9CgovLyBlcyAgICogaGFzIGJlZW4gZG9uZSBhIGxvbmcgdGltZSBhZ28uCiAgICAgICAqCiAgICB0aGUgc2tlbGV0b24gbG9hZGVyIGluIHRoZSBtZWFudGltZS4gVGhpcyBmdWxsIHJlbGRhbCBBUEkgY2FsbCAobm90IGZyb20gd2hlbiB0aGUgZW1iZWQgd2FzIGZpcnN0IG9wc2lkZXJlZCBzdGFsZSwgb25seSB0aGUgYXZhaWxhYmlsaXR5L3Nsb3RzIGFyZSByZWZhdCByZWNvcmRzIHRoZSBmaWVsZCB2YWx1ZXMgbm93IGFzIGEgcmVzcG9uc2UgYW5kZGVuIGJlaGluZCB0aGUgc2NlbmVzCiAgICoKICAgKiBBIGNhbGwgdG8gYG1vZGFsYF9JRH0mcGFyYW0xPXZhbHVlMSYuLi4uLi5gKQogICAqCiAgICogLSBMb2FkcyB0aGVyYW1lID0gcHJlcmVuZGVySWZyYW1lT3B0aW9uOwogICAgaWYgKHR5cGUgJiYgcHJlcnJvcihgTmFtZXNwYWNlICR7bmFtZXNwYWNlfSBpc24ndCBkZWZpbmVkYCk7CiBwZT86ICJtb2RhbCIgfCAiZmxvYXRpbmdCdXR0b24iOwogICAgb3B0aW9ucz86IHsKYW1lIHNldCB0byBmYWxzZS4gV2Ugd291bGQgcHJlbG9hZCBhc3NldHMgb25seQogIHsKICAgKiAgICAgY2FsKCJjbG9zZU1vZGFsIik7CiAgICogICB9CiAgICogfSk7Cmlvbk1hbmFnZXIub24oYWN0aW9uLCBjYWxsYmFjayk7CiAgfQoKICBvZmY8VCBleH0KCiAgb248VCBleHRlbmRzIGtleW9mIEV2ZW50RGF0YU1hcD4oewogLmNhbC5tb2RhbEJveC5zZXRBdHRyaWJ1dGUoInN0YXRlIiwgImxvYWRpbmciKTsKCm5zdCB0aGVtZSA9IGdldENvbmZpZ1Byb3AoZW5yaWNoZWRDb25maWcsICJ0aGVtZSIpdHlsZS5ib3JkZXJSYWRpdXMgPSAiOHB4IjsKICAgIGlmcmFtZS5zdHlsZS5oZWlnaGxvZyhgQ3JlYXRpbmcgbmV3IG1vZGFsICR7dWlkfWApOwoKICAgIGlmIChpc1ByZXJlb2FkSW5pdGlhdGVkIG1lc3NhZ2UgdG8gaWZyYW1lIHNvIGl0IGNhbiB0cmFjayBpdAp0ZW1wdGluZyB0byBsb2FkL2Nvbm5lY3QgcmVndWxhciBib29raW5nIGxpbmsiKTsKIC8vIFJlb3BlbiB0aGUgbW9kYWwsIG5vdGhpbmcgZWxzZSB0byBkbwogICAgaGF2ZSBiZWVuIGZpcmVkIHdpdGggaGVhZGxlc3Mgcm91dGVyIHBhdGggYXMgY2FsTCAvLyBpc0Nvbm5lY3Rpb25Qb3NzaWJsZQogICAgaWYgKCEhZXhpc3RvbnM6IGVucmljaGVkUHJlcmVuZGVyT3B0aW9ucyA/PyB0aGlzLnByZXJlLyBJZiBwcmVyZW5kZXJPcHRpb25zIGFyZSBhdmFpbGFibGUsIHVzZSB0aGVtLiBPdGhuc3QgdWlkID0gcmV1c2FibGVNb2RhbFVpZCB8fCBTdHJpbmcoRGF0ZS5ub3coKSk7Cm50ZWQgdW5uZWNlc3NhcnkgcmVwZWF0IHByZXJlbmRlciBmb3IgJHtjYWxMaW5rfWApbnN0IHByZXBhcmF0aW9uUmVzdWx0ID0gdGhpcy5jYWwucHJlcGFyZUZvclByZXJlc24ndCBtdXRhdGUgdGhlIG9yaWdpbmFsIGNvbmZpZwogICAgY29uZmlnID0geyAuLmZpZzsKICAgIGNhbE9yaWdpbj86IHN0cmluZzsKICAgIF9fcHJlcmVuZGVyPzogYm90YXNldCA9IGVsLmRhdGFzZXQ7CiAgICBkYXRhc2V0LmJ1dHRvblRleHQgPSBidXR0IC8vIEl0IG1ha2VzIGl0IGEgdGFyZ2V0IGVsZW1lbnQgdGhhdCBvcGVucyB1cCBlbWJlcz86IFJlY29yZDwiaWQiLCBzdHJpbmc+ICYgUmVjb3JkPHN0cmluZyB8ICJpZCIsYWluZXJ7c2Nyb2xsYmFyLXdpZHRoOm5vbmV9PC9zdHlsZT5gOwogIGFpbmVyOjotd2Via2l0LXNjcm9sbGJhcntkaXNwbGF5Om5vbmV9LmNhbC1pZmlnLmVtYmVkVHlwZSA9ICJpbmxpbmUiOwogICAgY29uc3QgY2FsQ29uZmlnID0gdGhzb2xlLndhcm4oIklubGluZSBlbWJlZCBhbHJlYWR5IGV4aXN0cy4gSWdub3JpbmcgLyBJZiBzb21lb25lIHJlLWV4ZWN1dGVzIGlubGluZSBlbWJlZCBpbnN0CiAgaW5saW5lKHsKICAgIGNhbExpbmssCiAgICBlbGVtZW50T3JTZWxlY3RvciwKIGxpemVkCiAgICogSXQgYWxsb3dzIGRlZmF1bHQgcXVldWUgdG8gdGFrZSBjYXJlICAvLyBKdXN0IGluIGNhc2UgJ2luaXQnIGluc3RydWN0aW9uIGJlbG9uZ3MgdG8gYW5uZmlnIGlzbid0IHByb3ZpZGVkCiAgICovCiAgaW5pdChuYW1lc3BhY2VPckNvbmZsaXplZE5hbWVzcGFjZXMgPSBbXSBhcyBzdHJpbmdbXTsKICBtb2RhbFVpZD86IHNtZSA9IGVtYmVkUmVuZGVyU3RhcnRUaW1lOwogIH0KCiAgZ2V0UHJldmlvdXNNb2RhbG9ucyBoZXJlIHNvIHRoYXQgZHVyaW5nIENUQSBjbGljayB3ZSBjYW4gdXNlIHRoZXNlbG9nKCJEZXN0cm95aW5nIHByZXZpb3VzIHByZXJlbmRlcmVkIG1vZGFsYm94Iik7CiBEaWZmID0gRGF0ZS5ub3coKSAtIHByZXZpb3VzRW1iZWRSZW5kZXJTdGFydFRpbWU7CnN0IGlzVGhyZXNob2xkQ3Jvc3NlZCA9IGhhc0Nyb3NzZWRUaHJlc2hvbGQoKTsKTGluayA9IGAke3VybE9iamVjdC5wYXRobmFtZS5yZXBsYWNlKC9eXC8vLCAiIil9JHtNb2RhbAogIHJlY29yZFVwZGF0ZWRQYXJhbXNGb3JJZnJhbWUocGFyYW1zOiBSZS8gV2UgcmVjb3JkIHRoZSB1cGRhdGVkIHBhcmFtcyBvbiBkYXRhc2V0LmNhbExpICAgZW1iZWRDb25maWcxVmFsdWUuZXZlcnkoKHZhbHVlOiBzdHJpbmcpID0+IGVtYmV0aGUgdHdvIGNvbmZpZyBoYXZlIGFsbCBwcm9wcyBhcyBzYW1lCiAgIHVybiBhY3Rpb25Ub1Rha2U7CgogICAgZnVuY3Rpb24gaXNTYW1lRW1iZWRDb1Rha2UoKTsKCiAgICBsb2coCiAgICAgICJOZXh0IE1vZGFsIEFjdGlvbjoiLAogIHN0IGlzUmVzZXROZWVkZWQgPSAhaXNTYW1lQ2FsTGluayB8fCBpc0lubmRlciA+IChwcmVyZW5kZXJPcHRpb25zPy5zbG90c1N0YWxlVGltZU1zID8/IEVNQkU9PT0gdXJsVG9Mb2FkT2JqZWN0U2VhcmNoUGFyYW1zOwoKICAgIGNvbnN0IGlzU2FtbmVjdCBmbG93CiAgICAvLyBBbHNvIG9yaWdpbiB3ZSBhc3N1bWUgbmV2ZXIgY2hhbm9hZGVkTGlua0luZnJhbWUoKTsKICAgIGNvbnN0IGxhc3RMb2FkZWRQYXRoSW5JZnIgY29udGludWU7CiAgICAgIH0KICAgICAgaWYgKHZhbHVlIGluc3RhbmNlb2YgQXJyYXJhbXMgPyB0aGlzLmdldFF1ZXJ5UGFyYW1zRnJvbVBhZ2UoKSA6IHt9OwoKIHJhbXMpLmZpbHRlcigoW2tleSwgdmFsdWVdKSA9PiAhZXhjbHVkZVBhcmFtKGtleSwgbGFibGVBbmNlc3Rvcih0aGlzLmlmcmFtZSk7CiAgICBpZiAoIXNjcm9sbENvbnRhYXBwcm9hY2ggb2YgInN0YXRlIiBhdHRyaWJ1dGUgZm9yIG1vZGFsQm94IGFuZCBpbmwgIC8vIGxpbmtSZWFkeSBldmVudCBpc24ndCByZWNlaXZlZCBhbnl3YXkgYnkgcGFyZWlmICh0b3AgPCAwICYmIE1hdGguYWJzKHRvcCAvIGhlaWdodCkgPj0gMC4yNSkgewogaGF0IHdvdWxkIG1ha2UgdGhlIGlmcmFtZSBzaG93IGV2ZW4gaWYgdGhlIGhvc3QgZWxhcmVudEtub3dzSWZyYW1lUmVhZHlgIG1lc3NhZ2UoSXQgaGFzIGl0J3Mgb3duIHJlYXR5bGUubWF4SGVpZ2h0ID0gYCR7Z2V0TWF4SGVpZ2h0Rm9yTW9kYWwoKX1weGA7CiAgYmUgaW5jcmVhc2VkIHNvIHRoYXQgbXkgZW50aXJlIGNvbnRlbnQgaXMgdmlzaW1lIHJlbmRlcnMsIGl0IHdvdWxkIHRlbGwgaG93IG11Y2ggaWZyYW1lIGhlaWdodCBzIFVzZSBXRUJBUFBfVVJMIHRpbGwgZnVsbCBwYWdlIHJlbG9hZCBwcm9ibGVtIHdpdGhyb3IoImlmcmFtZSBkb2Vzbid0IGV4aXN0LiBgY3JlYXRlSWZyYW1lYCBtdXN0ZSB0aGVpciBvd24gZW1iZWQgY29uZmlnIHBhc3NlZCB2aWEgYGNvbmZpZ2AgcHJvcCBjbGVhciBxdWV1ZSwgYXMgaWZyYW1lIG1pZ2h0IGxvYWQgYSBmcmVzaCBVUkwgYW5kIHJkZXIgPSAiMXB4IHNvbGlkIGdyZWVuIjsKICAgIH0KCiAgICAvLyBNZXJnZSBzZWFydGhhdCAiVGhlIHBhZ2UgaXNuJ3Qgb3B0aW1pemVkIGZvciBlbWJlZGRpbmciCiAgICBvbiBTYWZhcmkgdGhhdCBzb21ldGltZXMgY2F1c2UgNDA0IGZvciBhc3NldHMuCiAgc3QgeyBpZnJhbWVBdHRycywgLi4ucXVlcnlQYXJhbXNGcm9tQ29uZmlnIH0gPSBjb2UgPSAiY2FsLWVtYmVkIjsKICAgIGlmcmFtZS5uYW1lID0gYGNhbC1lbWJlZD0ke3RoICAqIElmcmFtZSBpcyBhZGRlZCBpbnZpc2libGUgYW5kIHNob3duIG9ubHkgYWZ0ZS5hcmdzXSA9IGluc3RydWN0aW9uOwogICAgaWYgKCF0aGlzLmFwaVttZXRob2RdKSB7aW9uOiBJbnN0cnVjdGlvbiA9IFtdLnNsaWNlLmNhbGwoaW5zdHJ1Y3Rpb25Bc0FyZ3NjY2VwdHMgZ3Vlc3QuIFNvIGRvIHRoZSBtYXBwaW5nCiAgICAgIGd1ZXN0OiBjb24qLwogIGNvbW1hbmRzUGVyc2lzdEFjcm9zc0lmcmFtZVJlc2V0czogRG9JbWU/OiBIVE1MSUZyYW1lRWxlbWVudDsKCiAgX19jb25maWc6IENhbENvbmZpZzsKCiBvbnN0IEVYQ0xVREVEX1BBUkFNUyA9IFsuLi5wYXJhbXNSZXNlcnZlZEJ5Qm9va2lsYmFja3NBbmRBY3Rpb25zXTsKICBvZmY6IFsib2ZmIiwgYWxsUG9zc2libGVDYWxsZnJhbWUlMjBnZXRzJTIwYW4lMjBvcGFxdWUlMjBjYW52YXMlMjBiYWNrZ3JhbWVzIzp+OnRleHQ9dGhlJTIwcmVzb2x1dGlvbiUyMHdhcyUzQS0sSWYlMjB0aGUlcm9yKGAiJHtwcm9wfSIgaXMgb2Ygd3JvbmcgdHlwZS5FeHBlY3RlZCB0eXBlICIke3VpcmVkIik7CiAgfQoKICBmb3IgKGNvbnN0IFtwcm9wLCBwcm9wU2NoZW1hXSBvZiBwZW9mIGRhdGEgPT09ICJ1bmRlZmluZWQiOwogIH0KCiAgaWYgKHNjaGVtYS5yZXF1aW9ucwogKiBBIHZlcnkgc2ltcGxlIGRhdGEgdmFsaWRhdG9yIHdyaXR0ZW4gd2l0bnN0IGdsb2JhbENhbCA9IHdpbmRvdy5DYWw7CmlmICghZ2xvYmFsQ2FsIHx8ICFnbG9yaWdpbjogc3RyaW5nOwogIGRlYnVnPzogYm9vbGVhbjsKICB1aURlYnVnP01CRURfUFVCTElDX1ZFUkNFTF9VUkx9YDsKCmN1c3RvbUVsZW1lbnRzLmRlZmluZSgiZXlvZiBJbnRlcmZhY2VXaXRoUGFyZW50XTsKfTsKLy8gSEFDSzogUmVkZWZpbmUgYW5sd2luZENzcyI7CmltcG9ydCB0eXBlIHsgRW1iZWRQYWdlVHlwZSwgTW9kYWxQcmVyZWhQYXJlbnQsIGludGVyZmFjZVdpdGhQYXJlbnQgfSBmcm9tICIuL2VtYmVkLWlmcmFtbnNlOwogIH0KfQovLy8gPHJlZmVyZW5jZSB0eXBlcz0iLi4vZW52IiAvPgoKaW1wIG5leHQ/OiBzdHJpbmcsCiAgICBjaGFpbjogQ2hhaW4gPSB0aGlzLmNoYWkgVGhlIE5GVCBjb250cmFjdCBhZGRyZXNzCiAgICogQHBhcmFtIHRva2VuSWQgVGhlIHRpbmdzKAogICAgY29sbGVjdGlvblNsdWc6IHN0cmluZywKICAgIGxpbWl0PzogbnV1ZGUgcHJpdmF0ZSBsaXN0aW5ncyAoZGVmYXVsdDogZmFsc2UpCiAgICovCiAgYXNkICYmIHsKICAgICAgICAgIGluY2x1ZGVfcHJpdmF0ZV9saXN0aW5nczogaW5jbG5TbHVnIFRoZSBjb2xsZWN0aW9uIHNsdWcKICAgKiBAcGFyYW0gbGltaXQgVGhlcmRlcnNBUElQYXRoLAp9IGZyb20gIi4vYXBpUGF0aHMiOwppbXBvcnQgeyBHZXRCZXNyaWRlID8gWy4uLnBhcmFtcywgcnBjU3RhdGVPdmVycmlkZV0gOiBbLi4ucGFyYW1zXXJyaWRlKHN0YXRlT3ZlcnJpZGUpCgogIGNvbnN0IHJlcXVlc3QgPSBhY2NvdW50CiAgdW50OiBhY2NvdW50XyA9IGNsaWVudC5hY2NvdW50LAogICAgZW50cnlQb2ludEFkZHJhaXQgdG9TbWFydEFjY291bnQoeyAuLi4gfSkKICoKICogY29uc3QgYnVucGxlCiAqIGltcG9ydCB7IGNyZWF0ZUJ1bmRsZXJDbGllbnQsIGh0dHAsIHBhcnMKICB8IEVycm9yVHlwZQoKLyoqCiAqIFJldHVybnMgYW4gZXN0aW1hdGUgZGRlbiwgaWYgbm8gQWNjb3VudCBpcyBwcm92aWRlZCwgaXQgd2lsbCBuZWVkIHRvIGJhc3RlckRhdGFgIGFuZCBgZ2V0UGF5bWFzdGVyU3R1YkRhdGFgIGNhbGxzLiAqLwogICAgfCB7CiAgICAgICAgICAgICAgICAvKiogUmV0cmlldmVzIHBheW1hc3Rlci1yZWxzaW9uID0gRGVyaXZlRW50cnlQb2ludFZlcnNpb248X2Rlcml2ZWRBY2NvdW50PiwKPmUgUHJlcGFyZVVzZXJPcGVyYXRpb25QYXJhbWV0ZXJzLAogIHByZXBlcml2ZVNtYXJ0QWNjb3VudCwKICBHZXRTbWFydEFjY291bnRQYXJhbWV0ZXIsCn0gZmVudHMvZGVjb3JhdG9ycy9wYXltYXN0ZXIuanMnCi4vLi4vZXJyb3JzL3V0aWxzLmpzJwppbXBvcnQgdHlwZSB7IENhbGxzIH0gZgp9KTsKaW1wb3J0IHR5cGUgeyBBZGRyZXNzLCBOYXJyb3cgfSBmcmFpbDogdHJ1ZSwKICAgICAgICAgIHVzZXJuYW1lOiB0cnNlciBieSBlbWFpbCIsIGFzLmdldC5tb2NrUmVqZWN0ZWRWYWx1ZShuZXcgRXJyb3IoIlJlZGlzIGNvbm5sZCBpbml0aWFsaXplIGNvdW50ZXIgd2hlbiBpdCBkb2Vzbid0IGV4aXN0IiwgYXNpZmllclR5cGU6ICJlbWFpbCIsCiAgICAgICAgcmF0ZSAgdmkubW9ja2VkKHByaXNtYS5hcGlLZXkuZmluZFVuaXF1ZSkubW9jb3VsZCB0aHJvdyBlcnJvciB3aGVuIEFQSSBrZXkgaGFzIG5vIGFzc28gdGVzdEFwaUtleSA9ICJ0ZXN0X2FwaV9rZXlfMTIzIjsKCiAgICAgIC8vIE1vY2sgQWVkaXMuc2V0KS50bGQgcmVzcGVjdCBjdXN0b20gdGhyZXNob2xkIGFuZCBkdXJhdGlvbiIsIGFwZGF0ZSkudG9IYXZlQmVlbkNhbGxlZFdpdGgoewogICAgICAgIHdoZXJlOiB7IGVtYW50IiwgIjMiKTsKICAgICAgZXhwZWN0KG1vY2tSZWRpcy5leHBpcmUpLnRvSG1haWw6YWRkU2Vjb25kYXJ5RW1haWw6dGVzdEBleGFtcGxlLmNvbS5jb3VudCIpOwogbmRsZSBpZGVudGlmaWVyIHdpdGgga2V5d29yZCBjb3JyZWN0bHkiLCBSRVNUX1VSTDsKICB9KTsKCiAgZGVzY3JpYmUoImhhbmRsZUF1dG9Mb2NrIiwgKCl0aW9uKGZ1bmN0aW9uKCkgeyByZXR1cm4gbW9ja1JlZGlzIGFzIGFueTsgfSk7CnJ0IHsgaGFuZGxlQXV0b0xvY2sgfSBmcm9tICIuL2F1dG9Mb2NrIjsKCi8vIE1vb20gIkB1bmtleS9yYXRlbGltaXQiOwppbXBvcnQgeyB2aSwgZGVzY2VkdWxlT3V0cHV0LAogIH0pCiAgQElzTm90RW1wdHlPYmplY3QoKQogIEBJc0Fycmxhc3MgVXNlclZlcmlmaWVkUGhvbmVzT3V0cHV0IHsKICBAQXBpUHJvcGVydHkoeyBlQVRVU10pCiAgc3RhdHVzITogdHlwZW9mIFNVQ0NFU1NfU1RBVFVTIHwgdHlwZW9mIEUgZm9ybWF0OiAicGhvbmUiLAogIH0pCiAgcGhvbmVOdW1iZXIhOiBzdHJpbmc7CgogIGlmaWVkIHBob25lIG51bWJlci4iLAogICAgZXhhbXBsZTogIiszNzI1NTU1NjY2NiIsbSAiQC9lZS9zY2hlZHVsZXMvc2NoZWR1bGVzXzIwMjRfMDRfMTUvb3V0cHV0cy9zY2h2ZW50cykudG9Db250YWluRXF1YWwoewogICAgICAgIGZlYXR1cmVOYW1lOiAnbmV4cGFnZXM6IG5ldyBGaWxlUmVmKGpvaW4oX19kaXJuYW1lLCAndGVsZW1ldHJ5L3BhZ2VlckFsbCgoKSA9PiBuZXh0LmRlc3Ryb3koKSkKCiAgICBpdCgnc2hvdWxkIHNlbmQgbi5lbnYuSVNfVFVSQk9QQUNLX1RFU1QgPyBkZXNjcmliZS5za2lwIDogZGVzY3JpYmUpZWF0ZU5leHQsIEZpbGVSZWYgfSBmcm9tICdlMmUtdXRpbHMnCmltcG9ydCB7IE5leHR1bGtSZXNjaEJ1bGtDcmVhdGVCdWxrQ2FuY2VuZyBidWxrICR7cGFyYW1zLmFjdGlvbn0gYXVkaXRgLCBzYWZlU3RyaW5naWZ5KGVycm5nczogcGFyYW1zLmJvb2tpbmdzLAogICAgICAgICAgICAgICAgYWN0b3I6IHBpaUZhdGE6IHVua25vd247CiAgICAgICAgfT47CiAgaW9uOiBTZWF0QmlvbjogTG9jYXF1ZXVlTG9jYXRldWVSZWFzc29mIFJlamVjcGVvZiBOb1NocXVldWVBdHRlbmlvbjogQ2FuY2VxdWV1ZUNhbmNlaW9uOiBSZXNjaHBlb2YgQ3JlYXN0YW1wOiBEYXRlLm5vdygpLAogICAgICAgICAgICAgICAgYWN0aW9uOiBwYXIgICBpc0J1bGs6IGZhbHNlLAogICAgICAgICAgICAgICAgYm9va2luZ1VpZDogcGFyLm9yZ2FuaXphdGlvbklkID09PSBudWxsKSB7CiAgICAgICAgICAgIHJldHVybjsKICB0aW9uIHZhbHVlIChUWVBFIGZyb20gYWN0aW9uIHNlcnZpY2VzIGFyZSBzdHJpbmctdGx1ZywgYWN0b3JUeXBlOiAiYXBwIiB9KTsKICAgICAgICAgICAgY29uc3QgcGlpRnJlc3QgeyBhY3RvciB9ID0gcGFyYW1zOwoKICAgICAgICBpZiAoYWN0b3IuaWRlbnR0VGFza2VyUHJvZHVjZXJTZXJ2aWNlRGVwc1sibG9nIl07CiAgQXVkaXRUYXNrQ29uc3VtZXIuCiAqIAogKiBGb3IgZnV0dXJlIG1pZ3JhdGlpb25zL1Jlc2NoZWR1bGVkQXVkaXRBY3Rpb25TZXJ2aWNlIjsKaW1wb3J0IHsgU2VhdHJ0IHsgTm9TaG93VXBkYXRlZEF1ZGl0QWN0aW9uU2VydmljZSB9IGZyb20gIi4uL2FjckJ5SWQsIGJ1aWxkQWN0b3JFbWFpbCB9IGZyb20gIi4uL21ha2VBY3RvciI7Cml1cmVzL3Rhc2tlci90YXNrZXIiOwppbXBvcnQgeyBJU19QUk9EVUNUSU9OIH0gZnJ0YS50ZXN0Q2FzZXMud2l0aGRyYXcuZm9yRWFjaCgod2l0aGRyYXdDYXNlKSA9b25maWdFbnZXaXRoVGVuZGVybHlQb2x5Z29uRm9yayh7IG1hcmtldDogJ2ZvcmtfcHJlcmFsVHlwZTogY29uc3RhbnRzLmNvbGxhdGVyYWxUeXBlLmlzQ29sbGF0ZXJhbCwKIHJrZXQuYVdQT0wsCiAgICAgICAgYW1vdW50OjogMC4wMSwKICAgICAgICBoYXNBcHByb3ZhbDogdHJ1ZSwKICAgICAgICBmb3JXcmFwbnQ6IDAuMDYsCiAgICAgICAgYXB5VHlwZTogY29uc3RhbnRzLmJvcnJvd0FQWVR5cGV7CiAgYm9ycm93c1VuYXZhaWxhYmxlLAogIGRhc2hib2FyZEFzc2V0VmFsdWVzVmVyaXJyb3IoLi4uYXJncykKCiAgICBjb25zdCBbZXJyLCAsICwgc2lsZW5jZUxvZ10gPSBhdENvbXBpbGF0aW9uRXJyb3IocGFnZTogc3RyaW5nKTogUHJvbWlzZTxhbnk+IHsKICBuZXcgV3JhcHBlZEJ1aWxkRXJyb3IoY29tcGlsYXRpb25FcnIpCiAgbmcKICB9KTogUHJvbWlzZTxGaW5kQ29tcG9uZW50c1Jlc3VsdCB8IG51bGw+IHsKIHVybiBuZXh0SW52b2tlIGFzIE5vbk51bGxhYmxlPHR5cGVvZiByZXN1bHQ+CiAgfQppZiAodXBkYXRlZE1hbmlmZXN0ICE9PSByYXdFeGlzdGluZ01hbmlmZXN0KSB7Cm91cmNlUm91dGU6IHBhdGhuYW1lLAogICAgICAgICAgICBwcmVmZXRjaERhdGFSb3V0bGJhY2s6IGZhbGxiYWNrTW9kZVRvRmFsbGJhY2tGaWVsZChyZXMudmFsdWUuZmFsbGIvIHdlIHdyaXRlIHRoZSBzdGF0aWMgcGF0aHMgdG8gcGFydGlhbCBtYW5pZmVzdCBmb1BhdGhzOiBwcmVyZW5kZXJlZFJvdXRlcz8ubWFwKChyb3V0ZSkgPT4gcm91dGUucGF0b2NzL2FkdmFuY2VkLWZlYXR1cmVzL3N0YXRpYy1odG1sLWV4cG9ydCcKICAgbGUgb2JqZWN0cywgYnV0IHRoYXQgaXMgdG9vIGV4cGVuc2l2ZS4KICB0IHRvIHN5bmMgdGhlIGRldkZhbGxiYWNrUGFyYW1zIHdpdGggdGhlIG5ldyByZXN1bmZpZy5vdXRwdXQgPT09ICdleHBvcnQnKSB7CiAgICAgICAgICAgIGlmICghcHJlcmVkZXJlZFJvdXRlcywgZmFsbGJhY2tNb2RlOiBmYWxsYmFjayB9ID0gcmVzLnZhbHVlCmlsZElkOiB0aGlzLmJ1aWxkSWQsCiAgICAgICAgICBhdXRoSW50ZXJydXB0czogQm90aHMoewogICAgICAgICAgZGlyOiB0aGlzLmRpciwKICAgICAgICAgIGRpc3REaXI6IG5nIG9uIHRoZW0gZm9yIHRoZSBwYWdlIHRvIGxvYWQgaW4gZGV2IG1vZGUKCiAgIGVzdEhlYWRlcnM6IEluY3JlbWVudGFsQ2FjaGVbJ3JlcXVlc3RIZWFkZXJzJ10KICAgdGNoOiBnZXRQYXRoTWF0Y2goJy9fbmV4dC9kZXZlbG9wbWVudC86cGF0aConKSwKIGlvblJlZ2lzdGVyZWQodGhpcy5kaXIsIHRoaXMubmV4dENvbmZpZy5kaXN0RGlyKQogIChlcnI6IGFueSkgewogICAgICAgIGVyci5tZXNzYWdlID0gYEFuIHN5bmMgZW5zdXJlTWlkZGxld2FyZSh1cmw6IHN0cmluZykgewpjcy9hcHAvYnVpbGRpbmcteW91ci1hcHBsaWNhdGlvbi9kZXBsb3lpbmcvc3RhdG91dGVzUmV3cml0ZXMoCiAgICAgIE9iamVjdC5rZXlzKHRoaXMuYXBwUGF0aFJvdXRldGhpcy5zZXJ2ZXJEaXN0RGlyLCBQQUdFU19NQU5JRkVTVCkKICAgICAgKSA/PyAgIHJlcy5ib2R5KCdJbnRlcm5hbCBTZXJ2ZXIgRXJyb3InKS5zZW5kKCkKIGYgKGZzLmV4aXN0c1N5bmMocGF0aEpvaW4odGhpcy5wdWJsaWNEaXIsICdfbmV4dCcpIC8vIHN0cmlwIGJhc2VQYXRoIGJlZm9yZSBoYW5kbGluZyBkZXYgYnVuZGxlc1VzYWdlLmhlYXBVc2VkKSwKICAgICAgICAnbWVtb3J5LmhlYXBUb3RhbCc6IFN0cidQYWdlc0Vycm9yRGVidWcnLCB0aGlzLnJlbmRlck9wdHMuRXJyb3JEZWJ1ZykKICAgICdkZXZHZW5lcmF0ZVN0YXRpY1BhcmFtc0R1cmF0aW9uJykKICB0YXJ0IHRpbWUgd2UgY2FuIGVuc3VyZSB0aGF0IHRoZSBtaWRkbGV3YXJlIHRpbWluZ29uc2Uub3JpZ2luYWxSZXNwb25zZS5vbmNlKCdjbG9zZScsIChUaGUgY2xvc3VyZSB2YXJpYWJsZSBpcyBub3QgdXNlZCBoZXJlIGJlY2F1c2UgdHVibGljIGdldFJlcXVlc3RIYW5kbGVyKCk6IE5vZGVSZXF1ZXN0SGFuZGxlciB7CiB0YWNrKGVyciwgJ2FwcC1kaXInKSwKICAgICAgICBvbldhcm5pbmc6ICh3YXJuKSA9PnVlc3QudXJsLmluY2x1ZGVzKCcvX19uZXh0anNfYXR0YWNoLW5vZGVqcy1pbnNwZWMgICBkZWNvcmF0ZVNlcnZlckVycm9yKGVyciwgQ09NUElMRVJfTkFNRVMuZWRnZVNlciAgICogV2Ugb25seSBsb2cgdGhlIGVycm9yIHdoZW4gaXQgaXMgbm90IGEgTWlkZGxlYW4oYXBwRmlsZSB8fCBwYWdlc0ZpbGUpCiAgfQoKICBhc3luYyBydW5NaWRkbCAgKS50aGVuKEJvb2xlYW4pCiAgICB9CgogICAgbGV0IGFwcEZpbGU6IHN0bWlzZTxib29sZWFuPiB7CiAgICBsZXQgbm9ybWFsaXplZFBhdGg6IHN0cmluZwogICAvLyBub3QgcmVhbGx5IGVycm9ycy4gVGhleSdyZSBqdXN0IHBhcnQgb2YgcmUgdHJhY2luZyBzdWJzeXN0ZW0uCiAgICBzZXRHbG9iYWwoJ2FwcERpcicsIHRoaXMoJ3BoYXNlJywgUEhBU0VfREVWRUxPUE1FTlRfU0VSVkVSKQoKICAgIC8vIFVzZSBleGdldEJ1aWxkSWQoKTogc3RyaW5nIHsKICAgIHJldHVybiAnZGV2ZWxvcG1lbnQnCiAgZ25vcmVQYXJ0RmlsdGVyOiAocGFydCkgPT4gcGFydC5zdGFydHNXaXRoKCdfJyksCiAgLy8gdG8gaW5jbHVkZSBhbnkgZm9sZGVycyBvciBmaWxlcyBzdGFydGluZyB3dG9yeSBpcyBhdmFpbGFibGUsIHRoZW4gY29uZmlndXJlIHRob3NlIG1hdGNoZXJzLgpzdXJlcjogUm91dGVFbnN1cmVyID0gewogICAgICBlbnN1cmU6IGFzeW5jIChtYXRjaGNhY2hlTWF4TWVtb3J5U2l6ZSwKICAgICAgLy8gYnV0IGFsbG93IGl0IHRvIGdyb3cgdyBMUlVDYWNoZSgKICAgICAgLy8gNU1CCiAgICAgIDUgKiAxMDI0ICogMTAyNCwKICBhcnRTZXJ2ZXJTcGFuID8/IHRyYWNlKCdzdGFydC1uZXh0LWRldi1zZXJ2ZXInKQogICB0byBsYXVuY2guIFRoZSBvbmx5IHdvcmtlciB1c2VycyBhcmUgaW50ZXJlc3RlZCBpc3BlY3QtYnJrIGZsYWdzIGZyb20gcHJvY2Vzcy5lbnYuTk9ERV9PUFRJT05TLiBPdGhydCgnLi9zdGF0aWMtcGF0aHMtd29ya2VyJykubG9hZFN0YXRpY1BhdGhzCiAgfSB7CiByZWFkeS4KICAgKi8KICBwcml2YXRlIHJlYWR5PyA9IG5ldyBEZXRhY2hlZFByb21pbnRpbWUKICBjb25mOiBOZXh0Q29uZmlnQ29tcGxldGUKICAvKioKICAgKiBUZWxscyBlcmxheS1zZXR1cCcpIGFzIHR5cGVvZiBpbXBvcnQoJy4uLy5TU0FHRV9TRU5UX1RPX0JST1dTRVIgfSBmcm9tICcuL2hvdC1yZWxvYWRlci10eXBlc20gJy4vbG9nLXJlcXVlc3RzJwppbXBvcnQgeyBGYWxsYmFja01vZGUsIGZhbGxiL2Rldi9oZWxwZXJzL2ZpbGUtcmVhZGVyL2RlZmF1bHQtZmlsZS1yZWFkZXInCmkgJy4uL3JvdXRlLW1hdGNoZXItcHJvdmlkZXJzL2Rldi9kZXYtYXBwLXBhZ2Utcm91dC4vY29uZmlnLXNoYXJlZCcKaW1wb3J0IHsgaXNNaWRkbGV3YXJlRmlsZSB9IAogIGxvYWREZWZhdWx0RXJyb3JDb21wb25lbnRzLAogIHR5cGUgRXJyb3JNb2R1bHMvcGF0aC1oYXMtcHJlZml4JwppbXBvcnQgeyByZW1vdmVQYXRoUHJlZml4IH0gZi4vLi4vYnVpbGQvd2VicGFjay9wbHVnaW5zL3BhZ2VzLW1hbmlmZXN0LXBsdWdpbicKbGliL2luY3JlbWVudGFsLWNhY2hlJwppbXBvcnQgdHlwZSB7IFVud3JhcFByb21pcGUgeyBNaWRkbGV3YXJlUm91dGluZ0l0ZW0gfSBmcm9tICcuLi9iYXNlLXNlcnZlcidib3ZlIHRyYW5zYWN0aW9uIHVwIGFzIGEgZ2VuZXJpYyAiUGVybWl0MiIgdHguCiAgfXIsIHRoZSB0eCB3aWxsIHN1Y2NlZWQgYnV0IGhhdmUgbm8gZWZmZWN0OyB0aGUgY2FufHwgYWNjb3VudC50eXBlICE9PSBBY2NvdW50VHlwZS5TaWduZXJNbmVtb25pYykgewpvdW50cykKICAgIGNvbnN0IGNoZWNrc3VtbWVkQWRkcmVzcyA9IGdldFZhbGlkQWRkcm4vYmxvYi9kZXZlbG9wL2FwcC9zY3JpcHRzL2NvbnRyb2xsZXJzL3RyYXRseSBmbGFreQovLyBUaGUgYmVzdCB3ZSBjYW4gZG8gaXMgcmVwbGFjZSB0aGUgdHJhdW50cy90eXBlcycKaW1wb3J0IHsgaXNCcmlkZ2UsIGlzQ2xhc3NpYywgaXNVbmlzd05FWFRfR0VTVFVSRV9UUkFOU0lUSU9OKSB7CiAgOyhwdWJsaWNBcHBSb3V0ZXJJbnN0dXRlcyB0YWJsZSBzbyB0aGF0IHJvdXRlIHByZWRpY3Rpb25zIGFyZSBjbGVhcmVkCiApCiAgfSwKICBwdXNoOiAoaHJlZjogc3RyaW5nLCBvcHRpb25zPzogTmF2aWdhdGVPcC5zdGF0ZS5uZXh0VXJsLAogICAgICAgIGFjdGlvblF1ZXVlLnN0YXRlLnRyZWUsCiAgLy8gRGVzcGl0ZSB0eXBlc2NyaXB0IHRoaW5raW5nIHRoYXQgdGhpcyBjYW4ndCBoYXBsIGJlIHBvc3NpYmxlIHdoZW4gd2UgdXBkYXRlIGl0cyBBUEkgdG8gbm90IHRha3dyaXRlcyBpbnRvIGEgZ2xvYmFsIG11dGFibGUKICAgIC8vIGNhY2hlLiBTbyB3ZSBkY2FsbCB0aGUgbG93ZXIgbGV2ZWwgbWV0aG9kcyBkaXJlY3RseQogKiAoYWx0aG91Z2ggZnJvbQogICAgLy8gYmVpbmcgc3Bhd25lZC4gRHVyaW5nIHRoZSBnZXN0dXJlLCB3ZXRoaXMgcm91dGUuCiAgICBpZiAoaXNKYXZhU2NyaXB0VVJMU3RyaW5nKGhyZWYpKSB7dGlvbi4gVGhpcyBkaXNwYXRjaGVzIHRocm91Z2ggUmVhY3QncwogKiB1c2VPcHRpbT0gZ2V0UHJvZmlsaW5nSG9va0Zvck9uTmF2aWdhdGlvblN0YXJ0KCkKICBpZiAob25STkVYVF9BUFBfTkFWX0ZBSUxfSEFORExJTkcpIHsKICAgIHdpbmRvdy5uZXh0Ll9fcGVkdWNlci4gTGVhdmluZyBhcy1pcyBmb3Igbm93CiAgLy8gc2luY2Ugd2UncmUgYWJvUXVldWUgd2FzIGNhbGxlZCBtb3JlICcgKwogICAgICAgICAgJ3RoYW4gb25jZScKICAgLy8gaXQgYXJvdW5kIGV2ZXJ5d2hlcmUgdmlhIHByb3BzL2NvbnRleHQuCiAgYXRlOiBpbml0aWFsU3RhdGUsCiAgICBkaXNwYXRjaDogKHBheWxvYWQ6IFJlZCBub3QgZW1wdHksIHNvIGFkZCB0aGUgYWN0aW9uIHRvIHRoZSBlbmQgb2YgbmRpbmdgIGJ5IGNhbGxpbmcgYHJ1bkFjdGlvbmApCiAgICBuZXdBY3Rpb24ubmV4dG5jbHVkaW5nIGJhY2svZm9yd2FyZCkgdGFrZSBwcmlvcml0eSBvdmVyIGFueSBwZW5kdGVseSBub3RpZnkgUmVhY3Qgb2YgdGhlIHBlbmRpbmcgcHJvbWlzZSAtLSB0aGUgZGxlZCBxdWlja2x5IHNpbmNlIGl0J3MgZmlyZWQgb24gdGhlIHBvcHN0YXRlIGV2ZW4gaXMgYSBwcm9taXNlLCBzZXQgdXAgYSBjYWxsYmFjayB0byByZXNvbHZlIGl0CiAgLy8gU3RpbGwgbmVlZCB0byBydW4gcmVtYWluaW5nIGFjdGlvbnMgZXZlbiBmb3QgPSBhY3Rpb25RdWV1ZS5hY3Rpb24ocHJldlN0YXRlLCBwYXlsb2FkKQoKICBmdXVldWUuZGlzcGF0Y2goeyB0eXBlOiBBQ1RJT05fUkVGUkVTSCB9LCBzZXRTdGF0ZSkKYXJkZWQ/OiBib29sZWFuCn0KCmZ1bmN0aW9uIHJ1blJlbWFpbmluZ0FjdGlvbnMoCiBvbnMsIHNldFN0YXRlOiBEaXNwYXRjaFN0YXRlUHJvbWlzZSkgPT4gdm9pZAogIGFjdGxpZW50SW5zdHJ1bWVudGF0aW9uSG9va3MgfSBmcm9tICcuLi9hcHAtaW5kZXgnCmltZmV0Y2hXaXRoU2VnbWVudENhY2hlIH0gZnJvbSAnLi9zZWdtZW50LWNhY2hlL3ByZWZOX05BVklHQVRFLAogIEFDVElPTl9SRVNUT1JFLAogIHR5cGUgTmF2aWdhdGVBY3Rpb3Jlc3M/LltjaGFpbklkXSwKICAgICAgICBhYmk6IHByb3BzLmFiaSwKdHJhY3RQYXJhbWV0ZXJzPGFiaSwgYWRkcmVzcywgZnVuY3Rpb25OYW1lPiwKKTogQ3JpZ1BhcmFtZXRlcjxjb25maWc+ICYKICAgIFF1ZXJ5UGFyYW1ldGVyPAogICAgICBTaWluSWQ+CiAgPiAmCiAgICBTY29wZUtleVBhcmFtZXRlciAmCiAgICBDb25maWdQYXJpZyA9IFJlc29sdmVkUmVnaXN0ZXJbJ2NvbmZpZyddLAogIGNoYWluSWQgZXh0eXBlIENyZWF0ZVVzZVNpbXVsYXRlQ29udHJhY3RSZXR1cm5UeXBlPAogIGFiaSBlcmVzcz4gfCB1bmRlZmluZWQgPSB1bmRlZmluZWQsCiAgZnVuY3Rpb25OYW1lIGV4dGVuaW9uRXhhY3RQYXJ0aWFsLAp9IGZyb20gJ0B3YWdtaS9jb3JlL2ludGVybmFsJwppbSgke1syXX0pKSkiLCAvLyBTeXN0ZXtbMiwgMV19KSkpIEFORCAocmZyZC4iZm9ybUlkIiA9ICR7ImZvcm0tNDU2In0pYApmb3JtLTQ1NiIsCiAgIH06OnRpbWVzdGFtcCkgQU5EIChyZnJkLiJmb3JtSWQiID0gJHsiZm9ybVR5cGUuU0lOR0xtIElEIChzaW5nbGUtc2VsZXNxbGAoKChyZnJkIFsiMiJdLCAvLyBTdHJpbmcgdmFsdWUgdGhhYmluZSBtdWx0aXBsZSBmaWx0ZXJzIHdpdGggQU5EIiwgYXREYXRlfWluZyIgPSAkeyJ0ZXN0IHZhbHVlIn0KICAidGVzdCB2YWx1ZSIgfSxyIGJ5IGN1c3RvbSBmb3JtIGZpZWxkcyAodGV4TkQgYS4icGhvbmVOdW1iZXIiIElMSUtFICR7IiUwMDAlIn0KIG5kOiAiMDAwIiB9LApORCBhLmVtYWlsIElMSUtFICR7IiVAZ21haWwuY29tIn0KICBkZWVFbWFpbmRlZSBlbWFpbCAodGV4bmQ6ICJqb2huIiB9LApjdChmaWx0ZWVySWQiLApnVXNlcklkIiA9IEFOWSgke1t0ZXN0RGF0YS51c2VyLmlkLCA5OTldfSkpYAp0YTogW3Rlc3REYXRhLnVzZXIuaWQsIDk5OV0sCiAgPD0gJHsKICAgICAgICAgIGRlZmF1bHRGaWx0ZXJzLmVuZERhdGUKICAgICAgICB9Ojouc3FsYChyZnJkLiJjcmVhdGVkQXQiID49ICR7ZGtpbmcgVUlEICh0ZXhhc29uIiBJTElLRSAke2AlbWFudWFsJWB9KWAKIGluZyBhc3NpZ25tZW50IHJlYXNvbiAodGV4YTogWyIyIiwgIjEiXSwgL2VyczogdW5kbmRsZSB1bmRlZmluZWQgY29sdWkudXNlUmVhbFRpbWVycygpOwogICAgICB2aS5yZXN0b3JlQWxsTW9uc2VJZHMpLnRvRXF1YWwoZXhwZWN0ZWRJZHMpOwoKdHVybiBib3RoIGZvcm0gcmVzcG9uc2VzIChvcmlnaW5hbCB1c2VyJ3MgYW5kIHRlYWB0ZWFtLW1lbWJlci1mb3JtbWJlciBGb3JtIiwKICAgICAgICAgIHVzZXJJZDogdGVhbU1lbWJlci5pZHRlIGEgZm9ybSB1bmRlciB0aGUgdGVhbSBtZW1iZXIKbWU6IGB0ZWFtbWVtYmVyLSR7LmlkKS5ub3QudG9CZShvdGhlckZvcm1Sc3QgYmFzZUNvbmRpdGlvbnMgPSBhd2FpdCBzZXJ2aWNlLmdldEJhc2UgPSBhd2FpdCBwcmlzbWEuYXBwX1JvdXRpbmdGb3Jtc19Gb3JtUmVzcG9uc2UuY3JtZTogYG90aGVydXNlci11ZTogIlBlcnNvbmFsIEZvcm0gUmVzcG9uc2UiLAp1aXJlZDogdHVsdHNbMV0/LmlkKS50b0JlKHBlcnNvbmFsRm9ybVJlc3BvbnNlLmlkKTsKCiB1bGQgb25seSByZXR1cm4gdGhlIGF1dGhvcml6ZWQgdXNlcidzIGZvcm0gcmVzcElkOiBgcGVyc29uYWwtZm9ybS1maWxsbnN0IHBlcnNvbmFsRm9ybSAgTlVMTCkgQU5EICgke2RhdGVDb25kaXRpb259KSlgCiAgb24gPSBQcmlzbWEuc3FsYHJmcmQuImNyZWF0ZWRBdCIgPj0gJHtmaWx0ZXJzLnN0YW9uczEpLnRvQmVEZWZpbmVkKCk7CgogICAgICAvLyBTZWNvbmQgY2FsbGlvbnMyKS50b0VxdWFsKGNvbmRpdGlvbnMxKTsKCiB0aW9uczEgPSBhd2liZSgiQ2FjaGluZyIsICgpID0+IHsKICAgIGl0KCJzaG91bGQgY2FjaGUgYXV0OiAiMjAyNC0wMS0wMSIsCiAgICAgICAgICBlbmREYXRlOiAiMjAyNC0xMi0zMSIsCiBpYmUoIkZpbHRlciBDb25kaWU6ICJTdGFuZGF0dXJuIE5PVEhJTkdfQ09ORElUSU9OIGZvciB0ZWFtIHNjb3BlIHdoZW4gdGVhbSBiZXRJZDogbnN0IHN0YW5kYWxvbmVUZWFtID0gYXdhaXQgcHJpc21hLnRlYW0uY3JlLyBOb3QgcGFydCBvZiB0dGUgYSB0ZWFtIHRoYXQgaXMgbm90IGEgY2hpbGQgb2YgdGhlIG9yZwogICBkIiA9IEFOWSgke2V4cGVjdGVkVGVhbUlkc30pKSBPUiAocmZyVGVhbSAzOiAxIHVzZXIgd2l0aCBNRU1CRVIgcm9sZQogICAgICBbTWVtYmVyc2hpcFJvbGUuTUVNQkVSXSwgLy8gVGVhbSAyOiAxIHVzZXIgd2lpbGQgdGVhd2l0aCB1bmRlZmluZWQgb3JnSXVpbGQgdXNlciBzY29wZSBjb25kaXRpb25zIHdpdGggbnVsbCBvcmdJZCIsIGFnSWQ6IHRucygpOwogICAgICBleHBlY3QoY29uZGl0aW9ucykudG8obm90IG93bmVyL2FkbWluKSB0byB0aWw6IGByZWd1bGFyLXVzZXItJHtyYW5kb21VVUlEKCl9QGV4YW1wbGUuY29tYCwKICB2aWNlIEludGVncmF0aW9uIFRlc3RzIiwgKCkgPT4gewogIGRlc2NyaWJlKCJBdXRob3RlYW0uZGVsZXRlKHsKICAgICAgd2hlcmU6IHsgaWQ6IG9yZy5pZCB9dGVhbSBvZiBhZGRpdGlvbmFsVGVhbXMpIHsKICAgICAgYXdhaXQgcHJpc21hLnRlYSBrZXkgY29uc3RyYWludHMKICAgIGZvciAoY29uc3QgbWVtYmVyc2hpcCBvZiBhZGRpaW9uYWxNZW1iZXJzaGlwID0gYXdhaXQgcHJpc21hLm1lbWJlcnNoaXAuY3JlYWFtZTogYEFkZGl0aW9uYWwgVGVhbSAke2kgKyAxfWAsCiAgICAgICAgc2x1ZzogYGFkYW1zOiBUZWFtW10gPSBbXTsKICBjb25zdCBhZGRpdGlvbmFsVXNlcnM6IFVzZXJbXSB1ZTogIlRlc3QgTmFtZSIsCiAgICAgICAgfSwKICAgICAgICBbYGVtYWlsLWZpZWwgICBmaWVsZHM6IFsKICAgICAgICB7CiAgICAgICAgICBpZDogYHRleHRpbWU6IG5ldyBEYXRlKERhdGUubm93KCkgKyA2MCAqVGVzdCBUZWFtIiwKICAgICAgc2x1ZzogYHRlc3QtdGVhbS0ke3JhcFJvbGVbXVtdOyAvLyBBcnJheSBvZiB0ZWFtcywgZWFjaCB0ZWFtIGhhcyBhcnJ9KTsKCi8vIEhlbHBlciBmdW5jdGlvbiB0byBjcmVhdGUgdW5pcXVlIHRlc3QgZGF0YXQsIGl0LCB2aSwgYmVmb3JlQWxsLCBhZnRlckFsbCB9IGZyb20gInZpdGVzdCI7Cgppb24gaXMgcGVyZm9ybWVkLgogKiBlLmcuIGltcGVyc29uYXRpb24sIHVzZXJBZ2VudCx5cGUgQWN0b3JCeUlkID0gei5pbmZlcjx0eXBlb2YgQWN0b3JCeUlkU2NoZW1hPjsKZSA9IHouZGlzY3JpbWluYXRlZFVuaW9uKCJpZGVudGlmaWVkQnkiLCBbCiAgICBBY3RvYWwoImlkIiksCiAgICBpZDogei5zdHJpbmcoKSwKfSk7Cgpjb25zdCBHdWVzdEFjdG8wMDEwMDIwMHgiOiAxMDU1ODI1MjA2YjJiODUzMWUyMDJiZTBkMCIsCiAgIjB4N2Y5YWQ4YzU4YzdkZGE5NzE4YTU0Y2JlYTgyIiwKIDAwMDAwZDQwMDAwMDAwMDAwMDQ5ZDFhMDA2ZmRkNjlkMDc0ZGFjZGJkZmI2YjU3NGI0MmM4MTQ2IiwKNDgxOWQ0NzMyMjYyNTc3OTJhZmUyMzBlYzNjNjdmIiwKIDVkODRjZGFmYzE0MTU4MWJiODc1N2E0ZiIsCiAwMDAwMjIwMDAxYTBhZTBmYmYzZjc4ZGI1MTc0YTM0OTMiLAogICAgImFkZHJlc3MiOiAiMDAwMDhlMWJjOWJmMDQwMDAwIiwKICAgICAgICAgICAgImxvZ0luZGV4IjogMTksCiBkIjogMjI4NzE5biwKICAgICAgICAibDFCYXNlRmVlU2NhbGFyIjogIjB4YTZmZTBuc3QgdHJhbnNhY3Rpb24gPSBhd2FpdCBnZXRUcmFuc2FjdGlvblJlY2VpcHQoY2xpIjB4ZGQ2OWRiMjVmNmQ2MjBhN2JhZDMwMjNjNWQzMjc2MWQzNTNkM2RlOSIsCiAgICJsMUdhc1VzZWQiOiBudWxsLAogICAgICAgICJsb2dzIjogWzIwMDAxMDAwMDAwMTAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAnLAogMDAwMjgwMDAgICAgZWZmZWN0aXZlR2FzUHJpY2U6ICcweDEnLAogICAgICAgIGZyb206ICcweDI0NDAwMDA2MDAwMDAwMDA4MDEwMDBlZCI6IDI3MDQ0MW4sCiAgICAgICAgImwxRmVlIjogMWNiYTk4MmIyMWQ5ZjljMWVmYWQ4MDgyMTJjNmQ2YTY1ZDMnLAogIGxvZ3NCbG9vbToKICAgICAgICAgICcweDAwMDRhMTZhJywKICAgICAgICBnYXNVc2VkOiAnMHg0MjA2OScsCiAgICAgICAgbDFGZWU6MjJmNjVlNWMwNjQxODU2OWViOGRlZTEiLAogNmRlZGRlZTA1Njk0MTJhYWZiMzg4ZDhjMTUxMGY5ZTA4MDAwMDI1ZDI2NGE1NWU2NWE1OCIsCiAgICAgICAgImJsb2NrTnVtYmVyIjogMTA1ODQ3ODNkYTcxZjE4NGU2YjI5N2NiZTdmNjIwYicsCiAgICB9KQoKICAgIGV4cGVjdCh0cmFuczFmODIyIiwKICAgICAgICAiaW5wdXQiOiAiMHgiLAogICAgICB2OiAnMHgxJywKICAgICAgICB2YWx1ZTogJzB4NjknLAogICAgICAgIHlQYXJpOiAnMHgyJywKICAgICAgICBub25jZTogJzB4MycsCiAgICAgICAgcjogJzB4ZjUyCn0pCgpkZXNjcmliZSgndHJhbnNhY3Rpb24gKGRlcG9zaXQpJywgKCkxMDU4NDg4OTJuLAogICAgICAgICJjaGFpbklkIjogMTAsCiAgICAgICAgImZyb20iOiAgICAiYWNjZXNzTGlzdCI6IFtdLAogICAgICAgICJibG9ja0hhc2giOiAiMHhkOThhNDI0OWM2YjE3NGQ3MTRjZDZkMWVhZjFhMWVjYjY2NDYzYmU2Y2ZjODI0NmY1NzQiLAogICAgICAgICJibG9ja051bWJlciI6IDFuYzYxODBlNTg5NzliZjU4OTQ0NjFmODIyJywKICAgICAgICBpbnB1dDogJzBjY2Vzc0xpc3Q6IFtdLAogICAgICAgIGJsb2NrSGFzaDoKICAgICAgICAgICcweGQ5NDkzNDciLAogICAgICAgICJzaXplIjogNDA3Mm4sCiAgMTAwMTAiLAogICAgICAgICJtaW5lciI6ICIgICAiYmFzZUZlZVBlckdhcyI6IDgzbiwKICAgICAgICAiYmxvYkdhc1VzZWQiOiB1bmNlIjogNjE0NjcwLAogICAgICAgICJyIjogIjBhdGE6IF9leHRyYURhdGEsIHRyYW5zYWN0aW9ucywgLi4ucmVzdCB9ID0gYmxvY2sKbnN0IGJsb2NrID0gYXdhaXQgZ2V0QmxvY2sob3B0aW1pc21DbGllbiAgICJudW1iZXIiOiA0MzExMzZuLAogICAgICAgICJwYXJlbnRIYXNoIjogIjB4MTUyMDAwMTk4MDIwMDAwMDAwMDEyMDAwMDAwODA0MDAxNDAxMDAwMDAwMDAwMDAwMDAxODRuczogWycweCddLAogICAgICAgIHVuY2xlczogW11lUm9vdDoKICAgICAgICAgICcweDk1Njc2ZjNhMjhkMmM4YTBiZjY0ZDA0MDAwYTAwMDAwMDAwMDg0MDQwMDAyMDgwMDAwMDAwODEwMDAwODA0NDAwMDAyMDAwMDAwMDA0NjA4MDAxMDBiMzFkNSIsCiAgICAgICAgInVuY2xlcyI6IFtdLAogICAgICB9CiAgICBgKQoKIDAwMDAwYmMwMDAwMCAiZ2FzIjogMTA1Nm4sCiAgICAgICAgICAgICJnYXNQcmljZSI6IHVuICAibWludCI6IDBuLAogICAgICAgICAgICAibm9uY2UiOiAxMDU2LAogICAgICAidGltZXN0YW1wIjogMTA3NTYyMDFuLAogICAgICAgICJ0b3RhbERpZmZpYyAgIjB4MCIsCiAgICAgICAgXSwKICAgICAgICAic2hhM1VuY2xlcyI6ICIweDFkYzAwMDAyNjgwODAwMDAwMDhjMWEwMjQwMDA4MDQwMDA4MDAwMjAwMDAyICAgImRpZmZpY3VsdHkiOiAwbiwKICAgICAgICAiZXhjZXNzQmxvYkdhcyI6ICAgIHM6ICcweDAnLAogICAgICAgICAgICBzb3VyY2VIYXNoOgogIG5wdXQ6CiAgICAgICAgICAgICAgJzB4MDE1ICcweGRlYWRkZWFkZGVhZGRlYWRkZWFkZGVhZGRlYWRkZWFkZGVhZDAwMDEnLAogICBtaW50OiAnMHgwJywKICAgICAgICAgICAgbm9uY2U6ICcweDQyMCcsCiAwMDAxMGI2NDAyMDAwYzM4ZGExZjdlZmQwMzU1MzYzYjMxZDUnLAogICAgICAgIHRyYW5zYWN0aW9uczogWwo0OGE3NDEzZjBhMTQyZmQ0MGQ0OTM0NycsCiAgICAgICAgc2l6ZTogJzB4Njk0MjAnLDAwMDQwMTAwODA0MDAxMDAwNDA5MDAwMDAwMDAwNDgwMDA4MDEwMDEwJywKICAgIGRpZmZpY3VsdHk6ICcweDAnLAogICAgICAgIGV4dHJhRGF0YTogJzB4JywKICAoKQoKZGVzY3JpYmUoJ2Jsb2NrJywgKCkgPT4gewogIHRlc3QoJ2Zvcm1hdHRlcicsIGR1bGVkQm9va2luZ0luRGI/LnJlZmVyZW5jZXMpLnRvSGF2ZUxlbmd0aCgwKTsKICB0aGUga2V5IGZpeDogcmVzY2hlZHVsaW5nIHVuY29uZmlybWVkIGJvb2tpbmdzIHNobmd9VDA2OjAwOjBuZGFyIHJlZmVyZW5jZXMgKG5vIGNhbGVuZGFyIGV2ZW50cyBjcmVhdGVkKQogIERJTkcpOwoKICAgICAgICAvLyBWZXJpZnkgZmlyc3QgYm9va2luZyBoYXNzZXI6IHJvdW5kUm9iaW5Ib3N0MS5uYW1lZXI6IFtyb3VuZFJvYmluSG9zdDJdLAogIGlvbjogdHJ1b3N0MkBleGFuSG9zdDIgPSBnZXRPcmdhbml6ZXIoewogICAgICAgICAgbmFtZTogIlJSIEhvc3QgMm9iaW4gYm9va2luZ3Mgb24gZmlyc3QgYm9va2luZyBhbmQgcmVzY2hlZHVsZSJUaGlzIHRlc3Qgd2lsbCBpbml0aWFsbHkgZmFpbCBkdWUgdG8gdGhlIGJ1ZwogICBuaXplclByb2ZpbGUgPSBvcmdhbml6ZXJUZWFtTWVtYmVyPy5wcm9maWxlcz8uWzBdO31UMTA6MzA6MG5nfVQxMElkOiAidGVhbUBnb29nbUlkOiAxaG9va3MgPSBbCiAgICAgICAgewogICAgICAgICAgaWQ6ICJXRUJIT09LX1RFU1RfSURUZWFtIExlYWQiLAogICAgICAgIGVtYWlsOiAibGVhZEBleGFtICBwcm9mOiAiQm9iIFNtaXRoIiwKICAgICAgICAgIHVzZXJuYW1lOiAiYm9iIixlcyB1c2VybmFtZUluT3JnIGluIHdlYmhvb2sgcGF5bG9hZCIsIGFhaWxzID0gY2FsZW5kYXJFdmVudC50ZWFtPy5tZW1iZXJzLm1hcCgobWVtYmVyKSA9PnZlbnQgPSBldmVudE1hbmFnZXJTcHkubW9jay5jYWxsc1swXVswXTsKCiBlcjogWy4uLnRlYW1NZW1iZXJzXSwKbWU6ICJTZWF0IDEiLAogICAgICAgICAgICAgICAgICBlbWFpbDogInNlYXQxQHRlc3RlIGFzc2lnbmVkIGhvc3QgZm9yIHRoZSBib29raW5nCiBlU2xvdDogMywKICAgICAgICAgICAgICBzZWF0c1Nob3dBdHRlbmRlZXM6IGZhdWc6ICJzZWF0ZWQtcm91bmQtcm9iaW4tZXZlbnQibmdJZCA9IDE7CiAgICAgIGNvbnN0IGJvb2tpbmdVaWQgPSAiYWJjMTIzIjsKICBtZTogIkFzc2koIkZvciBzZWNvbmQgc2VhdCBib29raW5nLCBvcmdhbml6ZXIgcmVtYWlucyB0aGliZSgiU2VhdGVkIFJvdW5kIFJvYmluIEV2ZW50IiwgKClhdGE6IG1vY2tCb29raW5nRGF0YSx9VDA5OjMwOjBudWxsIH0sCiBwZXJ0eQogICBkbGVzIGVkZ2UgY2FzZSB3aGVyZSBob3N0Lmdyb3VwSWQgaXMgbnVsbCB2cyB1bmRlcElkIGFyZSBoYW5kbGVkIHByb3Blcmx5IGluIHRoZSBncm91cGluZyBsb2dpYwogICBiamVjdENvbnRhaW5pbmcoe25nfVQwOTowMDowaW5nLTFgLAogIHVwSWQgcHJvcGVydHkpCiAgIHVwSWQgYW5kIGhvc3RzIHdpdGhvdXQgZ3JvdXBJZCAoc2hvdWxkIGZhbGwgYmFja2dldEJvb2VySWQpOwogICAgfSk7CgogICAgdGVzdCgiQ29ycmVjdGx5IGhhbmRsZXMgaG9zdG5zdCBncm91cDFVc2VySWRzID0gW3RlYW1NZW1iZXJzWzBdLmlkLCB0ZWFtbnMuQ2FsVmlkZW8gfSwKIGRhciIsIHsKICAgICAgICBjcmVhdGU6IGFkYXRhTG9va3VwS2V5dWxlOiBUZXMuaWQgfV0sCmhyb3coRXJyb3JDb2RlLlJvdW5kUm9iaW5Ib3N0c1VuYXZhaWxhYmxlRm9yQm9vbnNlczogewppbDogImV4aXN0aW5nLWJvb2tlci0yQH1UMTE6NDU6MDAuMDAwWmAsCiAgICAgICAgICAgICAgc3RhdHVzOiAiQUNDRVBURUQiMF0uaWQsIC8vIFRlYW0gTWVtYmVyIDEgKGdyb3VwLTEpCiAgIGQ6ICJldmVudC10eXBlLTFAZ29vZzFdLmlkIH0sCiAgICAgICAgICAgICAgICB7IGlkOiB0ZWFtTWVtYmVyc1syXS5pZCBtYmVyIDQiLAogICAgICAgICAgdXNlcm5hbWU6ICJ0ZWFtLW1lbWJlci00IiwKZWN0KHNlbGVjdGVkVXNlckVtYWlscykudG9Db250YWluKHNlY29uZEF0dGVuZGVlRW1raW5nLmF0dGVuZGVlc1swXS5lbWFpbCkudG9CZShib29rZXIuZW1haWwpOwoKIGJlcnNbM10uaWRdOyAvLyBncm91cC0yCgogICAgICAvLyBDaGVjayB0aGF0IG9uZSB1dGhhdCBsdWNreSB1c2VycyB3ZXJlIHNlbGVjdGVkIChvbmUgZnJvbSBlYWNoIGdyb2luZ31UMTE6MzA6MDAubFVJRDogIk1PQ0tFRF9HT09HTEVfQ0FMRU5EQVJfSUNTX0lEIix1cC0xIiwgbmFtZTogIkdyb3VwIDEiIH0sYmVyc1syXS5pZCwgaXNGaXhlZDogZmFsc2UsIGdyb3VwSWQ6ICJncm91cC0yIiB9LG1iZXItNEBleGFtcGxlLmNvbSIsCiAgICAgICAgICBpZDogMTA1LAogIGJlci0zQGV4YW1wbGUuY29tIiwKICAgICAgICAgIGlkOiAxMDQsCiAgYmVyLTFAZXhhaW9uOiBUZXN0cmRvd24oKTsKCiAgZGVzY3JpYmUoIlJvdW5kIFJvYmluIHdpdGggZ3JvdXBzIiwgKGlzbWEgZnJvbSAiQGNhbGNvbS9wcmlzbWEiOwppbXBvcnQgeyBFcnJvckNvZGUgeHBlY3RCb29raW5nQ3JlYXRlZFdlYmhvb2tUb0hhdmVCZWVuRmlyZWQgfSBmZGxlcihyZXEsIHJlcyk7CgogICAgICBleHBlY3QocmVzLnN0YXQgICAgZG9tYWluV2lkZURlbGVncklkOiAzMzMzMzMsCiAgICAgICAgZ29vZ2xlQ2hhbm5lbElkOiBudCByZXNwb25zZURhdGEgPSBKU09OLnBhcnNlKHJlcy5fZ2V0RGF0YSgpKTsKICBzeW5jZWRBdDogbnVsbCwKICAgICAgICBzeW5jRXJyb3JBdDogbmFubmVsS2luZDogbnVsbCwKICAgICAgICBnb29nbGVDaGFubmVsUmVzb3VyY2VJZDogICAgICBxdWVyeTogewogICAgICAgICAgYXBpS2V5OiAidmFsaWRBcGlLZXkiLAogICByZXEudXNlcklkID0gMzMzMzMzOwogICAgICByZXEuaXNTeXN0ZW1XaWRlQWRtaW5wZWN0KChlIGFzIEh0dHBFcnJvcikuc3RhdHVzQ29kZSkudG9CZSg0MDMpOwogIGVzdCgiUmV0dXJucyA0MDMgaWYgbm9uLWFkbWluIHVzZXIgdHJpZXMgdG8gc2V0IHVzb3J0IHByaXNtYU1vY2sgZnJvbSAiQGNhbGNvbS90ZXN0aW5nL2xpYi9fX21vY2tzX19oZWxsby1zb21ldGhpbmctZWxzZScpCiAgICAgIGNvbnN0IHF1ZXJ5VHdvID0gSlMgICAgLndhaXRGb3JFbGVtZW50QnlDc3MoJyNuYXYtYXMtcGF0aC1wdXNoc3RhdGUnKXBlY3QocXVlcnlUaHJlZS5zb21ldGhpbmcpLnRvQmUoJ2hlbGxvIHVzZSBwdXNoU3RhdGUgd2l0aCBzYW1lIGhyZWYgYW5kIGRpZmZlcmVudCBhc1AgPT4gKHdpbmRvdy5fZGlkTm90TmF2aWdhdGUgPSB0cnVlKSkKICBDc3MoJy5uYXYtYWJvdXQnKQogICAgICAgIC5lbGVtZW50QnlDc3MoJ3AnKQogd3Nlci53YWl0Rm9yRWxlbWVudEJ5Q3NzKCcjcm91dGVyLWxvY2FsLXB1c2gnKS5jbG5leHQuYnJvd3NlcihgL2Fic29sdXRlLXVybD9wb3J0PSR7bmV4dC5hcHBQb3J0fWApd3Nlci5jbG9zZSgpCiAgICB9KQogIH0pCgogIGRlc2NyaWJlKCd3aXRoIG5leHQvcm8gICAudGV4dCgpCgogICAgICBleHBlY3QoYXNQYXRoKS50b0JlKCcvYXMvcGF0aCcpCk5FWFRfSEVBRDogU3RyaW5nKHRydWUpLAogIHQocmVzcG9uc2UucmVjZWlwdHMpLnRvSGF2ZUxlbmd0aCg1KQp9KQovKiBlYXRhOiAnMHhjYWZlYmFiZScsCiAgICAgICAgdG86IGFjY291bnRzWzNdLmFkZGlmIChlcnJvcikKICAgICAgICAgICAgdGhyb3cgbmV3IFJwY1JlcXVlcnJvcihjYWxsUmVzdWx0LmVycm9yLm1lc3NhZ2UpCgogc3VsdC5nYXNVc2VkLAogICAgICAgICAgICAgIGxvZ3M6IHJlc3VsdC5sb2dzLAogICAgYm9keTogewogICAgICAgICAgICAgICAgbWV0aG9kOiAnZXRoX2dldFRyIChtZXRob2QgPT09ICd3YWxsZXRfZ2V0Q2FsbHNTdGF0dXMnKSB7CiBudCwgeyAuLi5wYXJhbWV0ZXJzLCB0aW1lb3V0OiA1XzAwMCB9KSwKICAgIChhc3luaWVudCgpCgp0eXBlIFVpZCA9IHN0cmluZwp0eXBlIFR4SGFzaGVzID0gSGV4W10KY29vcnRzL2NyZWF0ZVRyYW5zcG9ydC5qcycKaW1wb3J0IHsgY3VzdG9tIH0gZnlwZSBDaGFpbiwgbWFpbm5ldCB9IGZyb20gJy4uLy4uL2NoYWlucy9pbmQtbWVudSI6ICJiZy1iYWNrZ3JvdW5kIHJvdW5kZWQtbGciLAogdCBjbi1tZW51IGlubGllZC1tZCBjbi1tZW51LXRhcmdldCBmbGV0ZW50IjogImJnLWJhY2tncm91bmQgcm91bmRlZC1tZCIsCiBpdiIsCiAgICBwcm9wczogbWVyZ2VQcm9wczwiZGl2Ij4oCiAge2NuKCJ6LTUwIG9yaWdpbi10b3AgY24tbSBpdCgicHJlc2VydmVzIGFsbG93bGlzdGVkIGNsYXNzZXMgZXZlbiB3aGVuIGluIHMgTWVudSh7IGNsKCJjbi1tZW51LXRhcmdldCBjbi1mb28iLCBjbHV0dG9uR3JvdXBUZXh0KHsKIHNOYW1lOiBjbigKICAgICAgICAgICJjbi1idXR0b24tZ3JvdXAtdGV4dCBmbGV4IHsgdXNlUmVuZGVyIH0gZnJvbSAiQGJhc2UtdWkvcmVhY3QvdXNlLXJlbmRlciIKaW1wYW1lPSJiZy1iYWNrZ3JvdW5kIGdhcC00IHJvdW5kZWQteGwiIC8+CiAgRm9vKCkgewogIHJldHVybiAoCiAgICA8c2VjdGltZSB9KSwgImNuLWJ1dHRvbiIpfSB7bHMiCgpjb25zdCBidXR0b25WYXJpYW50cyA9IGN2YSgiY24tYnV0dG9uIiwgewogIHZ4bCIsICJleGlzdGluZy1jbGFzcyIpfSB7dHMoeyB2YXJpYW50LCBzaXplLCBjbGEgICAicm91bmRlZC1sZyBib3JkZXIgZm9udC1tZWRpdW0gaW5saWUtc20iOiAiaC04IHB4LTMgdGV4dGl2ZTogImNuLWJ1dHRvbi12YXJpYW50LWRlc3RydWN0aXZlIiwKIG50ZXIganVzdGlmeS1jZW50ZXIiLAogIHtzdCBidXR0b25WYXJpYW50cyA9IGN2YSgKICAgICAgICAiaW5saW5pemU6IHsKICAgICAgICBzbTogImNuLWJ1dHRvbi1zaXplLXNtIixuc3Qgc291byIsICJjbi1iYXIiLCBjbHQpLnRvTWRsZXMgY2xhc3NOYW1lIHdpdGggbm8gY24tKiBjbGFzc2VzIiwgaXQoInNraXBzIGNuLSogY2xhc3NlcyBub3QgaW4gc3R5bGVNYXAiLCBhZ2FwLTQiLAogICAgICAiY24tYmFyIjogInJvdW5kZWQteGwgYm9yZGVyIiwKYW1lLCB2YXJpYW50ID0gImRlZmF1bHQiLCAuLi5wcm9wcyB9OiBSZWFpdHkiCiAgICAgIGltcG9ydCB7IGNuIH0gZnQgc291cmNlID0gYGltcG9ydCAqIGFzIFJlYWN0IGZyb20gInJlYWN0IgppbXBsaWVzIHZhcmlhbnQgY2xhc3NlcyB0byBjdmEgdmFyaWFudCBlbnRyaWVzIiwgYW9wczwiYnV0dG9uIj4pIHsKICByZXR1cm4gKAogICAgPGJ1dHRvbiBjbGFzIGl0KCJhcHBsaWVzIGJhc2UgY2xhc3NlcyB0byBjdmEgYmFzZSBzdHJpbmciLCBhc3R1cm4gPGRpdiBjbGFzc05hbWU9ImNuLWZvbyIgey4uLnByb3BzfSAvPgp9CmAKb3BzIH06IHsgY2xhc3NOYW1lPzogc3RyaW5nIH0pIHtsZSA9IHByb2plY3QuY3JlYXRlU291cmNlRmlsZSgiY29tcG9uZW50LnRzeCIsIHNvdXJ0IHsgdHlwZSBTdHlsZU1hcCB9IGZyb20gIi4vY3JlYXRlLXN0eWxlLW1hcCIKaW1wCgovKiogaHR0cHM6Ly93YWdtaS5zaC9jb3JlL2FwaS9hY3Rpb25zL2dldFRyYWFpbnNba2V5XSwgQ2hhaW4+IGV4dGVuZHMgdHJ1ZSA/IGNoYWluc1trZXldIDogdW5keyBnZXRBY3Rpb24gfSBmcm9tICcuLi91dGlscy9nZXRBY3Rpb24uanMnZGRVc2VyLAogICAgZ2V0UmVjb3JkczogKCkgPT4gcmVjb3JkcywKICB9Owp9OwppbXB0aW9uLnF1ZXJ5Lm1vY2tDbGVhcigpOwogICAgICBtb2NrQ29ubmVjdGlvbi5zZWFybWU6ICJOb1Nob3dfX2MiLCB0eXBlOiAiYm9vbGVhbiIsIGxlbmd0aDogMCB9LAogICAgc3VjY2VzczogISFyZWNvcmQsCiAgICAgICAgICBpZDogcmVjb3JkPy5JZCwKIGFzZSAiVXNlciI6CiAgdGFjdCI6CiAgICAgICAgICAgIHJlY29yZCA9IHJlY29yZHMuY29udGFjdHMuZmlsdCA9IHsgSWQ6IHJlY29yZHMuZXZlbnRzW3JlY29yZHMuZXZlbnRzLmxlY2FzZSAiTGVhZCI6CiAgICAgICAgICAgIHJlc3VsdCA9IGFkZExlYWQoZGF0YSlhY2goKHJlY29yZCkgPT4gewogICAgICAgICAgaWYgKHJlY29yZC5Pd25lcklkKSB7CmVtYWlsTWF0Y2ggPSBzZWFyY2hRdWVyeS5tYXRjaCgvRklORCBceyhbXn1dKylcfS9pZ2lmeShuZXdVc2VyKSk7CiAgICByZWNvcmRzLnVzZXJzLnB1c2gobmV3VXNlcik7CiBudCA9IChhY2NvdW50OiBBY2NvdW50KSA9PiB7CiAgICBjb25zdCBuZXdBY2NvdXN0IG5ld0xlYWQgPSB7CiAgICAgIElkOiBsZWFkLklkIHx8IGAwMFEke01hdHJvcihgQWNjb3VudCB3aXRoIGlkICR7bmV3Q29udGFjdC5BY2NvdW50SWR9IG5vdCBvdW50cy5maW5kKChhKSA9PiBhLklkID09PSBpZCk7CiAgICBPd25lcklkOiBhY2NvdW50Lk93bmVySWQsCiAgICAgICAgICAgIH07CiAgIGxpdCgiLCIpLm1hcCgodykgPT4gdy50cmltKCkucmVwbGFjZSgvXid8JyQvZywgIiIpc2l0ZSBMSUtFICclKFteJ10rKSUnL2kpOwogICAgICAgIGlmICh3ZWJzaXRlTGlrZU1kZXMoIkFjY291bnRJZCAhPSBudWxsIikpIHsKICAgICAgICByZXN1bWFpbCAmJiByLkVtYWlsLmVuZHNXaXRoKGBAJHtkb21haW59YCkpOwogbWFpbCBJTiBcKCguKylcKS9pKT8uWzFdCiAgICAgICAgICAgID8uc3BsaXQoIicsJyJsYXVzZSkgewogICAgICBpZiAod2hlcmVDbGF1c2UuaW5jbHVkZXMoIkVtYWlsID0iKXRjaCgvV0hFUkVccysoLis/KSg/OlxzK0xJTUlUfFxzK09SREVSfFxzKiQpL2kpOwogLy8gU2ltcGxlIFNPUUwgcGFyc2VyCiAgICBjb25zb2xlLmxvZyh7IHF1ZXJ5IH0pO2luZyB9Owp0eXBlIFVzZXIgPSB7IElkPzogc3RyaW5nOyBJc0FjdGl2ZT86IGJvZzsKICBBY2NvdW50PzogQWNjb3VudDsKICBPd25lcj86IHsKICAgIEVtYWlsPzogc3R1bWJlcikKCiAgICBjb25zdCBlbGFwc2VkID0gTWF0aC5jZWlsKChub3cgLSBsYXRlLyBJZiB0aGUgbGF0ZXN0IEwyIG91dHB1dCBibG9jayBpcyBuZXdlciB0aGFuIHRoZXJlc3MsCiAgICAgICAgICBmdW5jdGlvbk5hbWU6ICdTVUJNSVNTSU9OX0lOVEVSVkFMdHVybiBPYmplY3QudmFsdWVzKHRhcmdldENoYWluIS5jb250cmFjdHMubDJPdXRuc3QgewogICAgaW50ZXJ2YWxCdWZmZXIgPSAxLjEsCiAgICBjaGFpbiA9IGNsaWVzdGFjaycKICoKICogY29uc3QgcHVibGljQ2xpZW50TDEgPSBjcmVhdGVQdWJsaWMuIFVzZWQgZm9yIHRoZSBbV2l0aGRyYXdhbF0oL29wLXN0YWNrL2d1aWRlcy93aXRoZHV0cHV0RXJyb3JUeXBlID0KICB8IE11bHRpY2FsbEVycm9yVHlwZQogIHwgUmVhZENvbnQgZm9yIGRpc2NyZXBhbmNpZXMgYmV0d2VlbiBub24tZGV0ZXJtaW5pc3RpYyB0aW1wZXMvY29udHJhY3QuanMnCgpleHBvcnQgdHlwZSBHZXRUaW1lVG9OZXh0TDJPdXRwemtzX2dhc1BlclB1YmRhdGEnCiAgICBQYXJhbWV0ZXJzPzogdW5kZXJdCiAgICBSZXR1cm5UeXBlOiBaa3N5bmNCYXRjaERldGFpbHMKICB9c19nZXRMMUJhdGNoQmxvY2tSYW5nZScKICAgIFBhcmFtZXRlcnM6IFtudW1iZXJdCiBhcmVkRGVmYXVsdEJyaWRnZTogQWRkcmVzcwogICAgICBsMU51bGxpZmllcj86IEFkZCAgICBnYXNfcGVyX3B1YmRhdGFfbGltaXQ6IEhleAogICAgICBtYXhfZmVlX3Blcl9nYXR1cmU6IFVpbnQ4QXJyYXkKICAgICAgICAgIHRyYW5zYWN0aW9uVHlwZTogc3QgICBkZWFkbGluZUJsb2NrOiBudW1iZXIKICAgICAgICAgIGxheWVyMlRpcEZlZTogSHVlc3QsCiAgWmtzeW5jVHJhbnNhY3Rpb25EZXRhaWxzLAp9IGZyb20gJy4vdHJhbmlmICghY2hhaW5JZCB8fCBjbGllbnQuY2hhaW4/LmlkID09PSBjaGFpbklkKSByZXRJZD4sCik6IFByb21pc2U8V3JpdGVDb250cmFjdFJldHVyblR5cGU+IHsKIGluSWQ+PiAmCiAgICBDb25uZWN0b3JQYXJhbWV0ZXIKPgoKZXhwb3J0IHR5cGUgV3JpIHVzZSBgVW5pb25TdHJpY3RPbWl0PC4uLiwgJ2NoYWluJz5gIG9uIGB2aWVtX1dyaXRhYmxlJz4sCiAgY2hhaW5zIGV4dGVuZHMgcmVhZG9ubHkgQ2hhaW5bXSAnLi4vZXJyb3JzL2Jhc2UuanMnCmltcG9ydCB0eXBlIHsgU2VsZWN0Q2hhaW5zIH0gZmN0IGFzIHZpZW1fd3JpdGVDb250cmFjdCwKfSBmcm9tICd2aWVtL2FjdGlvbnMnCgppdGlvbj0ke2FjdGlvbn0gaW4gZGVlcCBsaW5rIHVybD0ke3VybFN0cmluZ31gLCB7CiByZWZpeCAtIFRoZSBwcmVmaXggdG8gc3BsaXQgdGhlIFVSTCBzdHJpbmcgYnkuCiAqIDpcL1wvY3J5cHRvdGhlZ2FtZVwuY29tKFwvLiopPyQvLApdCgpmdW5jdGlvbiBpc1ZhbnN0IFVOSVNXQVBfRVhURVJOQUxfV0VCX0xJTktfVkFMSURfUkVHRVhFUyA9IFsKICByYW1zID0gZ2V0U2NhbnRhc3RpY1F1ZXJ5UGFyYW1zKHVybC5ocmVmKQogICByaSA9IGV4dHJhY3RXYWxsZXRDb25uZWN0VXJpKHVybC5ocmVmLCBVTklTbFBhdGggPSB1cmxQYXJ0cy5sZW5ndGggPj0gMSA/IHVybFBhcnRzWzFdIDogJycKIENIRU1FKSkgewogICAgY29uc3Qgd2NVcmkgPSBkZWNvZGVVUklDb21wb25lbnQodXJsX1VSTCkpIHsKICAgIGNvbnN0IHdjVXJpID0gdXJsU3RyaW5nLnNwbGl0KFVOSVNXZXNzIGZvdW5kJywKICAgICAgICAgIGFjdGlvbjogRGVlcExpbmtBY3Rpb24uVHJhbnNuUmFtcCwgZGF0YTogeyAuLi5kYXRhLCB1c2VyQWRkcmVzcyB9IH0KaWYgKGZpYXRPblJhbXApIHsKICAgICAgICBpZiAoIXVzZXJBZGRyZXNzKSB7Ck1zZzogYE5vIHVzZXJBZGRyZXNzIG9yIG1vb25wYXlPbmx5IHBhcmFtIGZvdW5kYCwKICghaXNDdXJyZW5jeUlkVmFsaWQoY3VycmVuY3lJZCkpIHsKZ2V0KCdmaWF0T2ZmUmFtcCcpID09PSAndHJ1ZScKCiAgc3dpdGNoICh1cmxQYXRoKSBXaXRoKHByZWZpeCkgfHwgdXJsLmhvc3RuYW1lID09PSBwcmVmaXgpIHsKbG9hZCB9Cgp0eXBlIERlZXBMaW5rSGFuZGxlciA9ICh1cmw6IFVSTCwgZGF0b24uVW5pdmVyc2FsV2FsbGV0Q29ubmVjdExpbms7IGRhdGE6IFBheWxvYWRXaXRoV2Npc3dhcEV4dGVybmFsQnJvd3Nlckxpbms7IGRhdGE6IEJhc2VQYXlsb2FkICYgeyB1cnJlbmN5IGNvZGUgKGV0aCwgdXNkYywgZXRjKS4KICogQHBhcmFtIGFtb3VudCAtIFRoaGF0IGluY2x1ZGUgZmlhdCBvbnJhbXAgcGFyYW1zLgogKgogKiBAcGFyYW0gdXNlcmcgdG8gcGFydHMgb2YgYSBzY3JlZW4uCiAqIEBwYXJhbSBzb3VyY2UgLSBUaGUgc291byBiZSBkaXNwbGF5ZWQuIFRoaXMgd2lsbCBiZSBzdXBlcnNlZGVkCiAqIGJ5IHVzaW5pZGdldCcsCiAgU2NhbnRhc3RpYyA9ICdzY2FudGFzdGljJywKICBUcmFuc3J0IHsgVU5JU1dBUF9XRUJfSE9TVE5BTUUgfSBmcm9tICd1bmlzd2FwL3NyYy9jb25zbnRSZWY/LmdldEJvdW5kaW5nQ2xpZW50UmVjdCgpLnRvcCA/PyA2NTsKICBydWxhdGVIb3VyU2l6ZUluUHgoCiAgZ3JpZEVsZW1lbnRSZWY6IEhUTUxPTGlzdEVsZW1zdCBjdXJyZW50RGF0ZVJhbmdlID0gZGF0ZVJhbmdlc1tpXTsKICAgICAgLy9JZiB0aGFuZ2VzKGRhdGVSYW5nZXM6IFRpbWVSYW5nZVtdKSB7CiAgLy9Tb3J0IHRoZSBkYXRldERhdGUgPSBzdGFydERhdGUuYWRkKDEsICJkYXkiKTsKICB9CgogIHJldHVybiBkYXRzKGRhdGVGcm9tKS5ob3VyKDApLm1pbnV0ZSgwKS5zZWNvbmQoMCkubWlsbGlzZWNvbmQgYmUgaW1wcm92ZWQgYnkgY2hhbmdpbmcgdGhlIGdldERheXNCZXR3ZWVuRGF0ZXMgdGU7CiAgd2hpbGUgKHRtcFN0YXJ0RGF0ZS5nZXREYXkoKSAhPT0gd2Vla1N0YXJ0KSAgV2VkbmVzZGF5LCBUaHVyc2RheSwgRnJpZGF5LCBTYXR1cmRheSkKZXhwb3J0IGZ1bmVsbG8gV29ybGQhYF0sCiAgICAgIF0pLAogICAgICAnL21keCcKICAgbnN0IHdpdGhNRFggPSByZXF1aXJlKCJAbmV4dC9tZHgiKSh7CiAgICAgICBeIiwKICAgICAgICAgInN0YWNrIjogWwogICAgICAgICAgICJkZWZhdWx0IHBleC5qcyAoMTozNikgQCBfX3JzcGFja19kZWZhdWx0X2V4cG9ydAogICAgICAgPiAxIHB0aW9uIjogImJvb20iLAogICAgICAgICAiZW52aXJvbm1lbnRMYWJlbCI6IG51bHRpb24gKCkgeyB0aHJvdyBuZXcgRXJyb3IoJ3ByZSBib29tJyk7IH1gCiAgIHVudDogMScpCiAgYWl0IGNoZWNrKAogICAgICAoKSA9PiBzZXNzaW9uLmV2ID0ge30KCiAgc3QgeyBzZXNzaW9uIH0gPSBzYW5kYm94CgogIG50LCBzZXRDb3VudF0gPSB1c2VTdGF0ZSgwKQogICAgICA8bWFpbj4KICAgICAgICAgICAgICA8cD57Y291bm9tL3ZlcmNlbC9uZXh0LmpzL2lzc3Vlcy8xMzk3OAogIHRlc3QoJ2NhbiAudGV4dENvbnRlbnQpCiAgICApLnRvQmUoJ0NvdW50OiAyJykKICB9KQoKICAvLyBodHRvcignYnV0dG9uJykuY2xpY2soKSkKICAgIGV4cGVjdCgKICBhdGljUHJvcHMoKSB7CiAgICAgICAgICByZXR1cm4geyBwcm9wczogeyB9IH0KICBhdWx0ICgpID0+IDxUaXRsZT5NeSBwYWdlPC9UaXRsZT4KICAgb25zdCBUaXRsZSA9IHN0eWxlZC5oMVxgCiAgICAgICAgICBjb2xvcjogcmVkOwogUHJvcHMuc3R5bGVzfQogICAgICAgICAgICAgICAgICAgICAge3NoZWV0LmdldFN0eWxhdGljIGFzeW5jIGdldEluaXRpYWxQcm9wcyhjdHgpIHsKbmVudHMnOiAnNi4xLjE2JywKICAgICAgJ0BuZXh0L21keCc6ICdjYW5hcnknLApyb20gJ2RldmVsb3BtZW50LXNhbmRib3gnCmltcG9ydCB7IEZpbGVSZWYsIG5leHRlbjogW3sgaWQ6ICJjaGlsZC1pZC0xIiB9XSwKIGlzT3JnYW5pemF0aW9uOiBmYWxzZSwKICAgICAgICAgIGNoaWxkcmVuOiBbXSxNb2NrIHRoZSByZXR1cm4gdmFsdWUgb2YgcHJpc3QgZ2V0VXBncmFkZWFibGVIYW5kbGVyKGN0eCk7CgogPT4gKHsKICBJU19URUFNX0JJTExJTkdfRU5BQkxFRDogdHJ1ZSwKfSkpOwoKZCAgICBiaW86IGlucHV0LmJpbyA/PyBudWxsLAogICAgICBicmFuZENvbG9yOiBpbnB0ZW50ID0gYXdhaXQgcGF5bWVudFNlcnZpY2UuY3JlYXRlUGF5bWVudEludGVudCgKIHJkaW5nLm9yZ093bmVyRW1haWwgIT09IGN0eC51c2VyLmVtYWlsKSB7CmFydGVkIGJ5IEFETUlOL3NvbWVvbmUgZWxzZSBhbmQgdGhleSBzaGFyZWQgdGhlIGxpYyAoeyBpbnB1dCwgY3R4IH06IENyZWF0ZU9wdGlvbnMpID0+IHsKICBsb2cud2FybihhdGlvbk9uYm9hcmRpbmdSZXBvc2l0b3J5IjsKaW1wb3J0IGxvZ2dlciBmcm9tY2F0ZWQgVGhpcyBlbmRwb2ludCBpcyBkZXByZWNhdGVkLiBVc2UgYGludGVudFRvQ3JuY2luZ0FwcE5hbWV9IGFwcCBpbnN0YWxsZWQuIFlvdSBjYW4gbWFuYWdlIHlvdXIgYyAgIDwvZGl2PgogICAgYDsKICB9CgogIHByb3RlY3RlZCBnZXRUZXh0Qm9keSgpOiBzbSB5b3VyIHNldHRpbmdzIHBhZ2UgYnkgdmlzaXRpbmc6IDxhIGhyZWY9IiR7V0VCQVBlbnQgZG91YmxlIGJvb2tpbmdzIGFuZCBhdXRvbWF0aWNhbGx5IGFkZCBuZXcgZXZlbjxkaXYgc3R5bGU9ImZvbnQtZmFtaWx5OiBBcmlhbCwgc2Fucy1zZXJpZjsiPgogIGN0ZWQgYXN5bmMgZ2V0Tm9kZU1haWxlclBheWxvYWQoKTogUHJvbWlzZTxSZWNvcm5DcmVkZW50aWFsRGlzYWJsZWRFbWFpbCBleHRlbmRzIEJhc2VFbWFpbCB7CiAgaW5nLCBhbnk+ID0ge30+ID0gewogIFtrZXk6IHN0cmluZ106IGFueQp9ICYgY2FwYWIgfCAnd2ViY3J5cHRvLXAyNTYnCiAgICAgICAgICAgICAgfCAnd2ViYXV0aG4tcDI1NnR1czogJ3N1cHBvcnRlZCcgfCAncmVhZHknIHwgJ3Vuc3VwcG9ydGVkJwogICAgICB8IFJlcXVpcmVkQnk8UGFydGlhbDxTaXdlTWVzc2FnZT4sICdjaGFpbklkJyB8IG9tcGFyaXNvbiByZXR1cm5zIDAgZm9yIGVxdWFsCiAgICAgIGFwcGxlSWNvbjogMCwKICAgICksCiAgICAgIHR3aXR0ZXJJbWFnZTogQnVmZmVyLmNvbXBhcmUoCiAgbmV4dC5yZWFkRmlsZUJ1ZmZlcignYXBwL3BhcmFsbGVsL0BwYXJhbGxlbC9pY29uLnBuZXh0LmZldGNoKGAvcGFyYWxsZWwvdHdpdHRlci1pbWFnZS1rempsdHAucG5nYCksCiAgICAicHJvcGVydHkiOiAib2c6aW1hZ2U6d2lkdGgiLAogICAgICAiaHJlZiI6ICIvcGFyYWxsZWwvYXBwbGUtaWNvbi1rempsdHAucG5nIiwKdCBnZXRDb21tb25NZXRhZGF0YUhlYWRUYWdzKGJyb3dzZXIpKS50b00vIEV4cG9ydCBlbmNvdW50ZXJlZCBhbiBlcnJvciBvbiAvZHluYW1pYy9baWRdL3BhZ2RhdGEgKGBjb29raWVzKClgLCBldGMuLi4pCiAgICAvLyBvciB1bmNhY2hlZCBleHRlbXM6IFthZGRyZXNzLCBzbG90LCBibG9ja051bWJlckhleCB8fCBibG9ja1RhZ10sCiBlIHNsb3QuIHtAbGluayBHZXRTdG9yYWdlQXRSZXR1cm5UeXBlfQogKgogKiBAZXhhbWVyZXVtLm9yZy9lbi9kZXZlbG9wZXJzL2RvY3MvYXBpcy9qc29uLXJwYy8jZXRoX2dlbWJlclRvSGV4LAp9IGZyb20gJy4uLy4uL3V0aWxzL2VuY29kaW5nL3RvSGV4LmpzJwppb25zLiBBZGQgImFzeW5jIiB0byB0aGUgZnVuY3Rpb24gZGVjbGFyYXRpb24gb3IgcnN0IGRpYWdub3N0aWNzOiB0c01vZHVsZS5EaWFnbm9zdGljW10gPSBbXQoKICAgY2F0ZWdvcnk6IHRzLkRpYWdub3N0aWNDYXRlZ29yeS5FcnJvcixzdGljcy5wdXNoKAogICAgICAgICAgICAuLi5zZXJ2ZXJCb3VuZGFyeS5nZXRTZW1hbmFydDogZS5nZXRTdGFydCgpLAogICAgICAgICAgICBsZW5ndGg6IGUuZ2V0V2lkdGgoc2UgPSBub2RlLmV4cG9ydENsYXVzZQogICAgaWYgKCFub2RlLmlzVHlwZU9ubHkgJiZlY2tlcigpCiAgICBpZiAoIXR5cGVDaGVja2VyKSByZXR1cm4gW10KCiAgIGNrZXIuZ2V0VHlwZUF0TG9jYXRpb24obm9kZSkKICBjb25zdCBzaWduYXR1cmVzID0gZWNrZXIudHlwZVRvU3RyaW5nKHR5cGVSZWZlcmVuY2VUeXBlLnRhcmdldCkpCiAgKSAnLi4vY29uc3RhbnQnCmltcG9ydCB7IGdldFRzLCBnZXRUeXBlQ2hlY2tlciB9IG1iZXIoYWZ0ZXJGZWVzQW1vdW5hZnRlck5ldHdvZVVzZCksCiAgICB9OwogIH0gZWxzZSB7CiAgICAvLyBDYWxjdWxhdGUgQW1vdW50cwogICBzdWdnZXN0ZWRTbGlwcGFnZSwKICAgICAgYW1vdW50QW5kQ29zdHM6IG9yZCAgc3JjVG9rZW46IGRlc3RUb2tlbiwKICAgICAgc3JjU3BvdFVTRCwKICBzZCkKICAgICAgLm11bHRpcGxpZWRCeShCaWdOdW1iZXIoc3JjU3BvdEFvc3RzLmJlZm9yZU5ldHdvcmtDb3N0cy5idXlBbW91bnQudG9TdGdlQnBzID8/IDEwMCkgLyAxMDA7IC8vIEUuZy4gMTAwIGJwcyAtPiAxJSAxMDAgdWx0cy5zdWdnZXN0ZWRTbGlwcGFnZUJwcykgewooJ05vIHByaWNlIGZvdW5kIGZvciB0b2tlbicpOwogICAgICBjb25zdCBlcnJvciA9IGxzZSwgaXNNYWlubmV0KSwKICAgICAgZ2V0VG9rZW5Vc2RQcmljZShjaGFpbklkLCBkcHBlZCwKICAgICAgICAgICAgc2VsbFRva2VuRGVjaW1hbHM6IHNyY0RlY2ltcm9yKCdObyBpbnB1dCBvciBvdXRwdXQgc3ltYm9sIHByb3ZpZGVkJyk7CiAgZWQgPSBzcmNUb2tlbjsKICAgIGlmIChpc05hdGl2ZVRva2VuKHNyY1Rva2VuKSkgewppZGUgPSAnc2VsbCcsCiAgaW52ZXJ0ZWRRdW90ZVJvdXRlID0gZmFsc2UsCn06IFByb2ltYWxzLAogIHVzZXIsCiAgc3dhcFR5cGUsCiAgaW5wdXRTeW1ib2wsCiAgb3V0cGV0Q293VHJhZGluZ1Nka0J5Q2hhaW5JZEFuZEFwcENvZGUgfSBmcm9tICcuL2Vudi5odCB7IENPV19QQVJUTkVSX0ZFRSwgaXNDaGFpbklkU3VwcG9ydGVkQnlDb1dQcm90b3JLaW5kLCBRdW90ZUFuZFBvc3QsIFdSQVBQRURfTkFUSVZFX0NVUlJFTkNJRVMgfSBmaWRpdHkpKQogICAgICAuYXR0cignaGVpZ2h0JywgdGlja1NjYWxlLmJhbmR3aWR0aChHcm91cC5zZWxlY3RBbGw8U1ZHUmVjdEVsZW1lbnQsIENoYXJ0RW50cnk+KCcubGlxdSAgICAucmFuZ2UoWzAsIENIQVJUX0RJTUVOU0lPTlMuTElRVUlESVRZX0NIQVJUX1dJbnN0IGJhcnNHcm91cCA9IGcuYXBwZW5kKCdnJykuYXR0cignY2xhc3MnLCAnbGlxdWlSYW5nZUlucHV0L0QzTGlxdWlkaXR5UmFuZ2VDaGFydC91dGlscy9jb2xvclV0aWxzJyAgfSwgW2lzRm9ybURpcnR5LCBkaXJ0eUZpZWxkcywgd2F0Y2hlZFZhbHVlcywgb25GZmlnLCB0ZW1wbGF0ZVR5cGU6IHJlc3QuYWlQaG9uZUNhbGxDb25maWcudGVtcGwgICAgcGVyaW9kQ291bnRDYWxlbmRhckRheXMsCiAgICAgIGlkOiBldmUgaWYgKG1ldGFkYXRhPy5hcHBzPy5zdHJpcGU/LnBheW1lbnRPcHRpb24gPT09ICJIT2hlY2sgYmVpbmcgdXNlbGVzcy4gTmVlZCB0byBjaGVjayBhZ2FpbnN0IGxlbmd0aCBhLyBpZiBsZW5ndGggaXMgdW5jaGFuZ2VkLCB3ZSBza2lwIHRoaXMgY2hlY2sKICBzdCBpc1ZhbGlkID0gdmFsaWRhdGVJbnRlcnZhbExpbWl0T3JkZXIoZHVyYXR2ZW50X3NldHVwX2xlbmd0aF9lcnJvciIpKTsKCiAgICBjb25zdCBmaW5hbFNlYXRzUHQvbm8tdW51c2VkLXZhcnMKICAgICAgbWluaW11bUJvb2tpbmdOb3RpY2VJbkR1cmF0dCB7IGNoaWxkcmVuIH0gPSB2YWx1ZXM7CiAgICBjb25zdCBkaXJ0eVZhbHVlcyA9IGdEaXJ0eSA9IGlzRmllbGREaXJ0eSh0eXBlZEtleSk7CiAgICAgIGlmIChpc0RpcnR5KT0gYCR7ZmllbGROYW1lfS4ke2tleX1gIGFzIGtleW9mIEZvcm1WYWx1ZXM7CiAgIC8vIFJlY3Vyc2l2ZSBjYWxsIGZvciBuZXN0ZWQgb2JqZWN0cyBvciBhcnJheXMKICAgbHVlOiBhbnkgPSBnZXROZXN0ZWRGaWVsZChkaXJ0eUZpZWxkcywgZmllbGROYW1lKTtleSA9IGN1cnJlbnRba2V5c1tpXV07CiAgICAgIGlmIChjdXJyZW50S2V5ID09PSB1bnBlb2YgdmFsdWUgPT09ICJvYmplY3QiICYmICFBcnJheS5pc0FycmF5KHZhbHVlKTsKT0RPOiBBZGQgc2NoZW1hIGZvciBvdGhlciBmaWVsZHMgbGF0ZXIuCiAgICAgICAgLnAgIHJlZGlyZWN0VXJsT25FeGl0OiB6LnN0cmluZygpLnVybCgpLm51bGxpc2goKSwKIGdlOiB0KCJpbnZhbGlkX2V2ZW50X25hbWVfdmFyaWFibGVzIiwgeyBpdGVtOiB2YWxpICAgICBfYm9va2luZ0ZpZWxkcy5mb3JFYWNoKCh7IG5hbWUgfTogeyBuYSAgbWF4QWN0aXZlQm9va2luZ1BlckJvb2tlck9mZmVyUmVzY2hlZHVsZTogZXZUeXBlID8/ICJDVVNUT01fVEVNUExBVEUiLAogICAgICAgIHNjaGVkdWxlck5hbWU6ZmlnPy5ndWVzdENvbXBhbnksCiAgICAgICAgeW91clBob25lTnVtYmVyOiBldmVzc2lnblJSTWVtYmVyc1VzaW5nU2VnbWVudCwKICAgICAgcnJTZWdtZW50UXVlcnlWYSAgLmZpbHRlcigoc2x1ZykgPT4gc2x1ZyAhPT0gZXZlbnRUeXBlLnNsdWcpID8/IFtdeXBlLmhvc3RzLnNvcnQoKGEsIGIpID0+IHNvcnRIb3N0cyhhLCBiLCBldmVuZWR1bGVOb3RpY2UgPz8gbnVsbCwKICAgICAgZGlzYWJsZWRDYW5jZWxsaW5nOiBldm5kQ2FsVmlkZW9UcmFuc2NyaXB0aW9uRW1haWxzOiBldmVudFR5cGUuY2FuU2VuZENhIGxpbmsuZXhwaXJlc0F0LAogICAgICAgIG1heFVzYWdlQ291bnQ6IGxpbmsubWF4VXNpZGRlbjogZXZlbnRUeXBlLmhpZGRlbiwKICAgICAgbXVsdGlwbGVQcml2YXRlTGlua2FnZTogZXZlbnRUeXBlLmxvY2tUaW1lWm9uZVRvZ2dsZU9uQm9va2luZ1BhZ2UsCiAgVHlwZS5wZXJpb2REYXlzLAogICAgICByZXF1aXJlc0Jvb2tlckVtYWlsVmVyaWYgaXMgYSBuaWdodG1hcmUgdG8gdHlwZSwgd2lsbCBkbyBpbiBmb2xsb3cgdXAgUFIKIHRUeXBlRm9ybSA9ICh7CiAgZXZlbnRUeXBlLAogIG9uU3VibWl0LAogIG9uRm9ybVN0CiAgRXZlbnRUeXBlU2V0dXBQcm9wcywKICBFdmVudFR5cGVVcGRhdGVJbnB1dCwKfSBvbSAiQGhvb2tmb3JtL3Jlc29sdmVycy96b2QiOwppbXBvcnQgeyB1c2VNZW1vLCB1c2Vsc2UgewogICAgICAvLyBpbiBkZXYsIHdlIGZhaWwgd2hlbiB2aXNpdGluZyBzdCB7IG5leHQsIGlzTmV4dFN0YXJ0LCBza2lwcGVkIH0gPSBlbnRlZCBpbiBlZGdlJywgKCkgPT4gewogICAgaXQoJ21pZGRsZXdhcmUnLCBhaWJlKCdvdXRzaWRlIG9mIHJlbmRlcicsICgpID0+IHsKICAgIGRlc2NyaWJlKCdzZXJ0UGFnZSgnL2luc2lkZS1yZW5kZXIvY2xpZW50L2FzeW5jLW1vZHVsZScpCiApCgogIGRlc2NyaWJlKCdpbnNpZGUgYSBjbGllbnQgY29tcG9uZW50JywgKClpYmUoJ2luIGFuIEVTTSBwYWNrYWdlJywgKCkgaXQoJ2ltcG9ydCBvZiBtb2R1bGUgd2l0aCB0b3AtbGV2ZWwtYXdhaXQnLCBhdW1lbnRlZC9taWRkbGV3YXJlIiwKICAgICAgICAgIi9vdXRzaWRlLW9mLXJlbmRuZGVyL3NlcnZlci9mcm9tLW5vZGUtbW9kdWxlcy9janMvc3luYy1kRmlsZVN5bmMoYC5uZXh0L3NlcnZlci9hcHAvJHtmaWxlbmFtZX0uaHRtbGApCiAgdGVzdCB3ZSBkb24ndCBjb25zaWRlciBhbiBpbmNvbXBsZXRlIHNoZWxsLgogICAgICBpbnB1dDogaW5wdXQsCiAgICBzb3VyY2U6ICJXRUJBUFAiIGFzIGNvbnN0LAogblVzZXI+LCAiaWQiIHwgImVtYWlsIiB8ICJ1c2VybmFtZSI+PiAmCiAgICBQaWNrPE4gdGVzdC50b2RvKCJWZXJpZnkgdGhhdCB0aGUgZW1haWwgc2hvdWxkIGdvIHRvIG8gICBub1Nob3c6IGZhbCBpZDogMiwKIFR5cGVzOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBpZDogMSwgeyBkYXRlU3RyaW5nOmlsOiAib3JnYW5pemVyQGV4bnRpYWxVc2VkID0gZGVsZXRlRXZlbnRDYWxsc1swXS5jYWxlbmRhclNlcnZpY2VDb25pbmdSZXF1ZXN0UmVzY2hlZHVsZWRFbWFpbHMoewogICAgICAgIGJvb2tpbmc6IHsKIGdlZEluVGVhbUFkbWluID0ge2V0aW5nVXJsOiAiaHR0cHM6Ly9VTlVTRURfVVJMIiwKICAgMTAxLCAvLyBCb29raW5nIGJlbG9uZ3MgdG8gb3JnYW5pemVyCiAgIGFjdGl2ZTogdHJ1ZW5kYXJNb2NrID0gYXdhaXQgbW9ja0NhbGVuZGFyKCJnb29nbGVjYWxlbmRhciIpOwpsZTogImVuIiwKICAgICAgICB0aW1lWm9uZTogIkFtZXJpY2EvTmV3X1lvcmsiLAogIHRlYW1zOiBbCiAgICAgICAgICB7CiAgICAgICAgICAgIG1lbWJlcnNoaXA6IHsKIHRpYWxzIGFyZSB1c2VkIHRvIGRlbGV0ZSBjYWxlbmRhciBldmVudHNgLCBhc3luaXplcidzIGNyZWRlbnRpYWxzCiAgICAgICAgICAxLiBUZWFtIGFkbWluIChub24tb21lOiAicmVzY2hlZHVsZS1yZXF1ZXN0ZXIiLAogICAgICAgIG5hbWU6ICJSZXNjaCJoaSIsCiAgICAgICAgICAgICAgICAgIC8vIEJvb2tlcidzIHRpbWV6b25lIHdoZVR5cGUuQ09MTEVDVElWRSwKICAgICAgICAgICAgICBsZW5ndGg6IDQ1LHQgZXZlbnRUeXBlU2x1ZyA9ICJldmVudC10eXBlLTEiOwogIFRlYW0gMSIsCiAgICAgICAgICAgICAgc2x1ZzogInRlYW0tMSIsCnRlcnMvdmlld2VyL2Jvb2tpbmdzL3JlcXVlIGJlIGFibGUgdG8gcmVxdWVzdC1yZXNjaGVkdWxlIGZvciBhIHRlYW0gZXZlbnQgYm9lZHVsZUhhbmRsZXIoCiAgICAgICAgZ2V0VHJwY0hhbmRsZXJEYXRhKGVlczogWwogICAgICAgICAgICAgICAgZ2V0TW9ja0Jvb2tpbmdBdHRlbmRlZSh7CiBuZ3M6IFsKICAgICAgICAgICAgewogICAgICAgICAgICAgIHVpZDogYm9vZXJVcmw6ICJodHRwOi8vbXktd2ViaG9vay5leGFtIDEgfSk7CiAgICAgIGNvbnN0IGJvb2tpbmdVaWQgPW9uc2UgJiBSZXNwb25zZTsKCmRlc2NyaWJlKCJIYW5kbGVyOiByZXF1ZHVsZS5zY2hlbWEiOwppbXBvcnQgdHlwZSB7IFRycGNTZXNzaW9uVXNlciB9IGFyaW8vZXhwZWN0cyI7CgppbXBvcnQgdHlwZSB7IFJlcXVlc3QsIFJlc3BvcHM6Ly9kaXNjb3JkLmdnLzl6SFBYdUJwcXknIH0sCiAgICAgICAgeyBpY29uOiAnYmxmIChlbnYuZnJvbnRtYXR0ZXI/LnNlYXJjaCA9PT0gZmFsc2UpIHJldHVybiAnJwogICAgIHRleHQ6ICdSZWxlYXNlIE5vdGVzICcsCiAgICAgICAgICAgICAgbGluazogJ2h0ICAgZGFyazogJy9sb2dvLWRhcmsuc3ZnJywKICAgICAgICBhbHQ6ICd3YWdtaSBsb2d1YWdlczogWydqcycsICdqc3gnLCAndHMnLCAndHN4J10sCiAgICAgIHRoZW1lOiB7CiAgICBzcmM6ICdodHRwczovL2Nkbi51c2VmYXRob20uY29tL3NjcmlwdC5qcycsICAgWydsaW5rJywgeyByZWw6ICdpY29uJywgaHJlZjogJy9mYXZpY29uLnN2ZycgfV1vbjogJ1JlYWN0aXZpdHkgZm9yIEV0aGVyZXVtIGFwcHMnLAogICAgaGVhZDogWwogcG9ydCBsbG1zdHh0LCB7IGNvcHlPckRvd25sb2FkQXNNYXJrZG93bkJ1dHRvbnMgfXRwdXQsIFsKICAgICAgICAgICAgICAgICcuL2FwcC9sYXlvdXQudHN4OjI6MjQnLAogbmVudHNgLiBQbGVhc2UgcmVtb3ZlIGl0LicKICAgICAgICAgICAgKQoKaW9uOiBhd2FpdCBnZXRSZWRib3hEZXNjcmlwdGlvbihicm93c2VyKSwKICBuc3QgcnVudGltZSA9ICdub2RlanMnOwogICAgICAgICAgJHtjb250ZW50fQogICBwcm9wYWdhdGUgY29uZmlndXJhdGlvbnMgZnJvbSBsYXlvdXRzIHRvIHBhZ2VzJywgYW5hbWljLXBhcmFtcy9bc2x1Z10vcGFnZS50c3gnKQogICAgIGAiRWNtYXNjcmlwdCBmaWxlIGhhZCBhbiBlcnJvciJgCiAgIGlkYXRlJykKICAgICAgYXdhaXQgd2FpdEZvclJlZGJveChicm93c2VyKQogICBsZXM6IF9fZGlybmFtZSArICcvZml4dHVyZXMvZGVmYXVsdCcsCiAgICBza2lwU3RhcmtpbmdFbWFpbEFuZFNtc1Rhc2tlck1vZHVsZUxvYWRlciwKICAgIGZlYXR1cmVzUmVwT0RPOiBJbiBhIGZvbGxvd3VwIFBSLCB3ZSBhaW0gdG8gcmVtb3ZlIHByaXNtYSBkZXB1cmVzL2RpL21vZHVsZXMvVXNlciI7CmltcG9ydCB7IERJX1RPS0VOUyB9IGZycnQgeyBiaW5kTW9kdWxlVG9DbGFzc09uVG9rZW4sIGNyZWF0ZU1vZHVsZSwgdHlwY29uOiAiY3JlZGl0LWNhcmQiLAogICAgICAiZGF0YS10ZXN0aWQiOiAicGF5bWVudCJtZTogIm1lc3NhZ2luZyIsCiAgICAgIGhyZWY6IGdldEhyZWYoYmFzZVVSTCwgIm1lc2VzLCBBcHBDYXRlZ29yeUVudHJ5PiB0byBlbmZvcmNlIGNvbnNpc3RlbmN5CiAgcmUvLyBNYW51YWxseSBzb3J0ZWQgYWxwaGFiZXRpY2FsbHksIGJ1dCBsZWF2aW5nICJPdG4gZ2V0SHJlZihiYXNlVVJMOiBzdHJpbmcsIGNhdGVnb3J5OiBzdHJpbmcsIHVzZW1hZ2UvaGVpYycKICAgICAgKQogICAgfSkKICAgIGl0KCdzaG91bGQgcmV0dXJuIHBkdHVybiBoZWljJywgYXMveC1pY29uJwogICAgICApCiAgICB9KQogICAgaXQoJ3Nob3VsZCByZXR1cm4gaWNucyBzdmcgd2hlbiBzdGFydHMgd2l0aCB0YWInLCBhcyIgdmlld0JveD0iMCAwIDEgMSI+PC9zdmc+JwogICB0dXJuIHN2ZyBmb3IgaW5saW5lIHN2ZycsIGFnZXMvYW5pbWF0ZWQud2VicCcpCiAgbnVsbCBmb3IgdW5yZWNvZ25pemVkIGJ1ZmZlcicsIGFgU2l6ZSBjYW5ub3QgZXhjZWVkICR7bWF4U2l6ZX0gYnl0ZXMuIEdpdmVuIHNpemU6ICAgICBgSGV4IHZhbHVlICIke3ZhbHVlfSIgaXMgYW4gb2RkIGxlbmd0aCAoJHt2YWx0YWluIGEgc2luZ2xlIGJ5dGUgb2YgZWl0aGVyIGEgMCBvciAxIHZhbHVlLmAsCiAgJHttYXggPyBgKCR7bWlufSB0byAke21heH0pYCA6IGAoYWJvdmUgJHttaW59KWB9YCxjdG9yKHsKICAgIG1heCwKICAgIG1pbiwKICAgIHNpZ25lZCwKICAgIHNpemUsCiAgbmdVaWQ9JHtib29raW5nLnVpZH0mdXNlcklkPSR7b3JnYW5pemVyLmlkfWA7CgogbmRlZSIsCiAgICAgICAgICAgIHRpbWVab25lOiAiRXVyb3BlL0xvbmRvbiIsCnJvcigiRXZlbnQgdHlwZSBub3QgZm91bmQiKTsKICAgIH0KCiAgICBjb25zdCBvbmVUa2luZy10b2tlbiIsIGFzeW5jICh7IHBhZ2UsIHVzZXJzIH0pID0+IHRva2VuP2FjdGlvbj1hY2NlcHQmdG9rZW49JHtvbmVUaW1lUGFzc3dvcmR9JmJvb2tpICAgdGl0bGU6ICJUZXN0IEJvb2tpbmciLAogICAgICAgIHN0YXJ0VGltZSwKIGUgPSBvcmdhbml6ZXIuZXZlbnRUeXBlc1swXTsKICAgIGlmICghZXZlbnRUeXBlKSB7ZnVsbHkgY29uZmlybSBhIGJvb2tpbmcgdmlhIEdFVCAvYXBpL3ZlcmlmeS1ib29raXQgbmV3IFByb21pc2UoKHJlc29sdmUpID0+IHNldFRpbWVvdXQocmVzb2x2ZSwgZG1pc2U8VD4sCiAgbWF4UmV0cmllcyA9IDMsCiAgZGVsYXlNcyA9IDUwMAopOiBQcmxDYWwuX19sb2dRdWV1ZS5wdXNoKGFyZ3MpOwogIGlmIChzZWFyY2hTdHJpbmcuaW5jZCB1cCBicmVha2luZyBlbWJlZCBCb29raW5nIEZvcm0gZm9yIGEgbG90IG9mIHVzZW9jYWwgbWFjaGluZSByaWdodCBub3csIGl0IGlzIG11Y2ggbW9yZSByZWxpYWJsZSByYW1zLnNldCgicHJlbG9hZCIsICJ0cnVlIik7CiAgaWZyYW1lLnNyYyA9IHVybEluc30KICB9LCA1MCk7Cn0pKCk7CgpmdW5jdGlvbiBnZXRFbWJlZEFwaUZuKG5zOiBzdCBpbiBjb2xvci1zY2hlbWUsIGEgbXV0YXRpb24gb2JzZXJ2ZXIgc2VlbXMgb3ZlcmtpZWN0b3JBbGwoIltkYXRhLWNhbC1saW5rXSIpKS5maW5kKChlbCkgPT4gZWwuY29udGlnaW4gPSBjYWxMaW5rRWwuZGF0YXNldC5jYWxPcmlnaW4gfHwgIiI7CiAgbGV0IGNvdGEpOwp9KTsKCmRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoImNsaWNrIiwgKGUpID1uYWdlciA9IENhbC5hY3Rpb25zTWFuYWdlcnNbcGFyc2VkQWN0aW9uLm5zXTsKICBnbGFsV2luZG93IGV4dGVuZHMgV2luZG93IHsKICBDYWw6IEdsb2JhbENhbDsKfQoKY29udGhlIHR5cGVzIGxpa2UgdGhpcy4KdHlwZSBHbG9iYWxDYWxXaXRoTnMgPSBHbG9iY3Rpb25NYXA+KG1ldGhvZE5hbWU6IFQsIC4uLmFyZzogUmVzdDxTaW5nbGVJbnN0ci5jYWwuZG9JbklmcmFtZSh7IG1ldGhvZDogInVpIiwgYXJnOiB1aUNvbmZpZyB9KTsKIGFnYWluIGJlZm9yZSB0aGlzIHRpbWUgaXMgcmVhY2hlZCBpbiB1c2VjYXNlcyB3aGVtZXIgcmVzZXRzLiBUaGlzIG1lYW5zIGlmIHlvdSBmcmVxdWVudGx5IGNsb3NlIGFuZGV0Y2hlZCAobm90IGEgZnVsbCBpZnJhbWUgcmVsb2FkKSwgd2hpY2ggY291bGQKICAgICoqSW1wb3J0YW50Kio6IEVhY2ggdGltZSB0aGUgbW9kYWwgaXMgb3BlbmVkLCB0aGVnIHBhZ2Ugc2VuZGluZyBhIHJlcXVlc3QgYHF1ZXVlZC1yZXNwb25zZWAgdGhhdCByZW9uc2UgaW4gYSB0ZW1wb3JhcnkgcXVldWUgYXQgYmFja2VuZC4KICAgKiAtIFJlZGlyZmlnOiB7ICJjYWwuZW1iZWQucGFnZVR5cGUiOiBwYWdlVHlwZSB9IH0gOiB7fSksCiAgICB0aHJvdyBuZXcgRXJyb3IoIllvdSBzaG91bGQgcHJvdmlkZSAndHlwZSciKTsKIC5nZXRDYWxDb25maWcoKTsKICAgIGNvbnN0IHsgcHJlcmVuZGVySWZyYW1lOiBwcmVybGluZSBwcmVmZXItcmVzdC1wYXJhbXMKICAgIHZhbGlkYXRlKGFyZ3VtZW50c1swXSxyb3IgYXMgd2UgZG9uJ3Qga25vdyB3aGF0IHRvIHByZXJlbmRlcgogICAqIHR5cGUgaWFtcGxlCiAgICogYGBgamF2YXNjcmlwdAogICAqIC8vIENsb3NlIHRoZSBtb2RhbCBhZW1iZWRzIHByb2dyYW1tYXRpY2FsbHkuCiAgICoKICAgKiBAdGhyb3dzIHtFcnJvcn1jazogKGFyZzA6IEN1c3RvbUV2ZW50PEV2ZW50RGF0YTxUPj4pID0+IHZvaWQ7CiAgaWJ1dGUgc28gdGhhdCBvbkF0dHJpYnV0ZUNoYW5nZWRDYWxsYmFjayBpcyB0cmlncmFtZS5zdHlsZS53aWR0aCA9ICIxMDAlIjsKICAgIGNvbnN0IHRlbXBsYXRlID0gZG9oYXZpb3VyIG9mIHJldXNpbmcgdGhlIHNhbWUgbW9kYWwuIEl0IHdhcyBkaVdlIHJlYWNoIGhlcmUgaW4gY2FzZSBvZiBjb25uZWN0IG9yIGZ1bGxSZWxvYWQKICAgbm5lY3QiIHx8IGFjdGlvblRvVGFrZSA9PT0gImNvbm5lY3Qtbm8tc2xvdHMtZmV0Y2h0IG9yIHRocm91Z2ggbG9hZEluSWZyYW1lLCBpdCB3b3VsZCBsYXRlciBiZSB1cGRhIGxvZyhgUmVvcGVuaW5nIG1vZGFsIHdpdGhvdXQgYW55IG90aGVyIGFjdGlvbiBuZWVsTGluayhpLmUuIHJvdXRlcj9mb3JtPXtGT1JNX0lEfSZQQVJBTVM9VkFMVUVTKSIKIGVEYXRhOwogICAgY29udGFpbmVyRWw6IEhUTUxFbGVtZW50OwogIH0pIHtMaW5rLAogICAgZW5yaWNoZWRDb25maWcsCiAgICBjYWxPcmlnaW4sCiAgICBpc1ByZXN0IGlzQ29ubmVjdGlvbkluaXRpYXRlZCA9ICEhKHRoaXMubW9kYWxVaWQgJiYgdGhpaW4gbm9uLXByZWxvYWQgY2FzZShUZW1wb3JhcmlseSBub3QgYmVpbmctc2V0KQogIGllbGRzKHsKICAgICAgICBjb25maWc6IGNvbmZpZ1dpdGhHdWVzdEtleUFuZENvbG9yY2hlbWUoCiAgICAgIENhbC5lbnN1cmVHdWVzdEtleSh7CiAgICAgICAgLi4uY29uZmlzdCBpc0hlYWRsZXNzUm91dGVyUGF0aCA9IGNhbExpbmtVcmxPYmplY3QgPyBpc1JvdXBlb2YgY29uZmlnLmlmcmFtZUF0dHJzID09PSAic3RyaW5nIiB8fCBjb25mIGRhdGFzZXQuaGlkZUJ1dHRvbkljb24gPSBgJHtoaWRlQnV0dG9uSWNvbn1gOwogZW50KCJjYWwtZmxvYXRpbmctYnV0dG9uIikgYXMgRmxvYXRpbmdCdXR0b247CiAgdXR0b25Qb3NpdGlvbj86ICJib3R0b20tbGVmdCIgfCAiYm90dG9tLXJpZ2h0IjsKICAicmdiKDAsIDAsIDApIiwKICAgIGJ1dHRvblRleHRDb2xvciA9ICJyZ2IoMjU1LCAyNTtwb3NpdGlvbjpyZWxhdGl2ZTtmbGV4LXdyYXA6d3JhcDt3aWR0aDoxMDAlIj4KICAgbnRhaW5lckVsLmNsYXNzTGlzdC5hZGQoImNhbC1pbmxpbmUtY29udGFpbmVyIik7CgomJiBkb2N1bWVudC5ib2R5LmNvbnRhaW5zKHRoaXMuY2FsLmlubGluZUVsKSkgewppZGF0ZSB0aGF0IGl0IGRvZXNuJ3Qgc3RhcnQgd2l0aCAvIG9yIGh0dHBzPzovLwogIHJ1Y3Rpb24gdGhhdCBhZGRzIGVtYmVkIGlmcmFtZSBpbmxpbmUgYXMgbGFzdCBjaGkgICAgZ2xvYmFsQ2FsLm5zW25hbWVzcGFjZV0uaW5zdGFuY2UgfHwgbmV3IENhbCh0aGUgc25pcHBldCB0YWtlcyBjYXJlIG9mIGRlbGVnYXRpbmcgdGhlIGluaXQgaW5zdG5maWcgPSB7fSBhcyBJbml0QXJnQ29uZmlnKSB7CiAgICBsZXQgaW5pdEZvck5hbWVzfQp9CgpjbGFzcyBDYWxBcGkgewogIGNhbDogQ2FsOwogIHN0YXRpYyBpbml0aW9ucyB9OwogIH0KCiAgc2V0TW9kYWxSZW5kZXJTdGFydFZhcmlhYmxlcyh7CiAgcm91bmRTbG90c0ZldGNoOwogICAgY29uc3QgZW5yaWNoZWRQcmVyZW5kZXJPcHRpbyAvLyBJZiB3ZSBhcmUgcmUtcHJlcmVuZGVyaW5nLCB3ZSBkZXN0cm95IHRoZSBwcmV2aWYgKHRpbWVEaWZmID49IEVNQkVEX01PREFMX1BSRVJFTkRFUl9QUkVWRU5UX1RIUkUgIGxvZygiVGhyZXNob2xkIGNyb3NzZWQsIGFsbG93aW5nIHJlcGVhdCBwcmVybnN0IFtrZXksIHZhbHVlXSBvZiBPYmplY3QuZW50cmllcyhwYXJhbXMpKSB7CnRvIGRldGVybWluZSBpZiBzb21ldGhpbmcgYWN0dWFsbHkgY2hhbmdlZCBzaW5jZSB0bmFtZX0ke3VybE9iamVjdC5zZWFyY2h9YCwgdXJsT2JqZWN0Lm9yaWdpbik7CiAgZmlnMVZhbHVlLmxlbmd0aCA9PT0gZW1iZWRDb25maWcyVmFsdWUubGVuZ3RoICYmCiBvbmZpZzFba2V5XSAhPT0gdHlwZW9mIGVtYmVkQ29uZmlnMltrZXldKSB7CiAgICAgYXJlU2xvdHNTdGFsZSwKICAgICAgICBjcm9zc2VkUmVsb2FkVGhyZXNob2xkLGlmICghaXNTYW1lQ29uZmlnIHx8ICFhcmVTYW1lUXVlcnlQYXJhbXMgfHwgIWlzQ29uICAvLyBOb3RlIHRoYXQgd2UgZG9uJ3Qgd29ycnkgYWJvdXQgY2hhbmdlIGluIGVtYmVuc3QgdGltZVNpbmNlTGFzdFJlbmRlciA9IHByZXZpb3VzRW1iZWRSZW5kZXJTdGFydG5zdCBpc0luRmFpbGVkU3RhdGUgPSBleGlzdGluZ01vZGFsRWwgJiYgZXhpc2N0b3IoYGNhbC1tb2RhbC1ib3hbdWlkPSIke21vZGFsLnVpZH0iXWApOwogIG1lID0gbGFzdExvYWRlZFVybEluSWZyYW1lT2JqZWN0Py5wYXRobmFtZSA/PyBudWxsY3Rpb25Gb3JNb2RhbCh7CiAgICBtb2RhbCwKICAgIHBhdGhXaXRoUXVlcnlUb0xvYWQgIC8vIFF1ZXJ5IFBhcmFtcyB2aWEgY29uZmlnIGhhdmUgaGlnaGVyIHByZWNlZGVuY29sbFRvKHsgdG9wOiBuZXdTY3JvbGxUb3AsIGJlaGF2aW9yOiAic21vb3RoIiB9KTsKLyBXZSBjb21wdXRlIHNjcm9sbGFibGUgYW5jZXN0b3Igb24gZGVtYW5kIGhlcmUgYW50aGlzLm1vZGFsQm94Py5zZXRBdHRyaWJ1dGUoImRhdGEtZXJyb3ItY29kZSIsIGUuZHJpbmcgb3RoZXJ3aXNlIHByZXJlbmRlcmVkIGVtYmVkIGNvdWxkIHNob3ctdXAgd2kgLy8gT3RoZXJ3aXNlIHdlIGFzc3VtZSB0aGF0IHVzZXIgbWlnaHQgaGF2ZSBwb3NpdGxpdHk6aGlkZGVuIHNldC4gSnVzdCByZXNldCB0aGUgdmlzaWJpbGl0eSB0byBkZWZhbExpbmsgYWxzbyBrZWVwcyBpdHNlbGYgaGlkZGVuIHRpbGwgaXQgcmVjZWl2ZXMgYHB2aXNpYmxlIGhlcmUuIFdlIGp1c3QgbmVlZGVkIHRvIHdhaXQgZm9yIHRoZSBIVE1MIG5zdCB1bml0ID0gInB4IjsKICAgICAgaWYgKGRhdGEuaWZyYW1lSGVpZ2h0KSB7CiBpdGlhbCBpZnJhbWUgd2lkdGggYW5kIGhlaWdodCB3b3VsZCBiZSBhY2NvcmRpbmcgdHF1ZXVlLCBhcyB3ZSB3YW50IHRvIGVuc3VyZSB0aGF0IG5ld2x5IGxvYWRlZCBpZnJhLmNvbSBidXQgaW4gY2FzZSBvZiBzZWxmIGhvc3RpbmcgaXQgY2FuIGJlIGFueXRoaW5jYWJsZSB0byBlbnRpcmUgQ2FsIG5hbWVzcGFjZS4KICAgKiBJbmRpdmlkdWFsIGVtYnRoZSB1cmwgaXMgc2FtZSAtIFRob3VnaCBicm93c2VyIG5vcm1hbGx5IGRvZXMgaXQscmUgaXMgbm8gZmxhc2ggb2Ygbm9uLXRyYW5zcGFyZW50KHdoaXRlL2JsYWNrKSBiYWN1ZyB8fCBwYWdlUGFyYW1zWyJjYWwuZW1iZWQubG9nZ2luZyJdID09PSAiMSIpIHsKIGEgbGlzdCBvZiBwYXR0ZXJucyB0aGF0IGFyZSBlbWJlZGRhYmxlLiBBbGwgZXhjZXB0ZnJhbWUiLCBjYWxMaW5rLCAid2l0aCBjb25maWciLCBKU09OLnN0cmluZ2lmeShjb25uYW1lc3BhY2V9YDsKICAgIGlmcmFtZS50aXRsZSA9IGBCb29rIGEgY2FsbGA7CgogIHRoZSBkZWZpbml0aW9uIG9mIHB1c2ggaGVyZS4KICAgIHF1ZXVlLnB1c2ggPSAoaW5zLy8gSW5zdGVhZCBvZiB0aHJvd2luZyBlcnJvciwgbG9nIGFuZCBtb3ZlIGZvcndhcnJheSwgcHJvY2VzcyB0aGVtIG9uZSBieSBvbmUKICAgIGlmICh0eXBlb2YgaW5zdCAvLyBndWVzdHMgaXMgYmV0dGVyIGZvciBBUEkgYnV0IEJvb2tpbmcgUGFnZSBhY2NlZCB0aGVuIHdlIGxvYWQgdGhhdCBVUkwgaW4gaWZyYW1lKQogIGNhbExpbms6IHN0cgogIGlmcmFtZURvUXVldWU6IERvSW5JZnJhbWVBcmdbXSA9IFtdOwoKICBhcGk6IENhKGtleSkpIHJldHVybiB0cnVlOwoKICByZXR1cm4gZmFsc2U7Cn07Cgp0eXBlIFByZWZ7CiAgW0sgaW4gRXhjbHVkZTxrZXlvZiBDYWxBcGksICJvbiIgfCAib2ZmIj5dOiBDYXJvdW5kJTIwYXBwcm9wcmlhdGUlMjB0byUyMGl0cyUyMGNvbG9yJTIwc2NoZW1lLiwta2VlcCBpdCBzYW1lIGFzIHRoZSB3ZWJwYWdlIHRoYXQgaGFzIHRoZSBpZnJhbWUKICBnZXRDb21wdXRlZFN0eWxlKGVsKS5jb2xvclNjaGVtZTsKICBpZiAocGFnZUNvbG9yU2hlY2sgPSB0eXBlQ2hlY2sgfHwgY2hlY2tUeXBlKGRhdGFbcHJvcF0sIHR5cGUpOwogcmluZywgdW5rbm93bj4sIHNjaGVtYTogVmFsaWRhdGlvblNjaGVtYSkgewogIGZ1cnRpZXMgbm90IHBhcnQgb2Ygc2NoZW1hLiBIZWxwcyBpbiBmaXhpbmcgd3JvbmcgZXhtZW50LmNyZWF0ZUVsZW1lbnQoInN0eWxlIikpLmlubmVySFRNTCA9IGNzczsKCi8vdHlwZSBNb2RhbFN0YXRlRGF0YSA9IHsKICBlbWJlZENvbmZpZzogUHJlZmlsbEFuZElpbmUpOwoKZGVjbGFyZSBtb2R1bGUgIiouY3NzIjsKdHlwZSBOYW1lc3BhY2UgPSBzdGluZWQ+ID0gVCBleHRlbmRzIFthbnksIC4uLmluZmVyIFVdID8gVSA6IG5ldmVyOwplZEZpZWxkcywKICBmcm9tRW50cmllc1dpdGhEdXBsaWNhdGVLZXlzLAogIGdlbmVnZXRTY3JvbGxCeURpc3RhbmNlSGFuZGxlciB9IGZyb20gIi4vbGliL2V2ZW50SCB7CiAgRU1CRURfTU9EQUxfSUZSQU1FX0ZPUkNFX1JFTE9BRF9USFJFU0hPTERfTVMsYXJhbSBjaGFpbiBUaGUgYmxvY2tjaGFpbiBjaGFpbgogICAqIEBwYXJhbSBpbmNsdGhpcy5mZXRjaGVyLmdldDxHZXRMaXN0aW5nc1Jlc3BvbnNlPigKICAgICAgZ2V0QmV9CgogIC8qKgogICAqIEdldHMgdGhlIGJlc3QgbGlzdGluZ3MgZm9yIGEgZ2l2ZW4gY2dldEJlc3RMaXN0aW5nQVBJUGF0aChjb2xsZWN0aW9uU2x1ZywgdG9rZW5JZCksCiAgY2x1ZGVQcml2YXRlTGlzdGluZ3M/OiBib29sZWFuLAogICk6IFByb21pc2U8R2V0TGl0byByZXR1cm4KICAgKiBAcGFyYW0gbmV4dCBUaGUgY3Vyc29yIGZvciBwYWdpbmF0aW0gIi4vZmV0Y2hlciI7CgovKioKICogTGlzdGluZy1yZWxhdGVkIEFQSSBvcGNvdW50Py5lbnRyeVBvaW50Py5hZGRyZXNzKSEsCiAgICBdIGFzIGNvbnN0CgogICBhdGlvbicsCiAgICAgICAgICAnZmFjdG9yeScsCiAgICAgICAgICAnbm9uY2UnLAogdGVycwoKICBpZiAoIWFjY291bnRfICYmICFwYXJhbWV0ZXJzLnNlbmRlcikgdGhsbHM6IFt7IHRvOiAnMHguLi4nLCB2YWx1ZTogcGFyc2VFdGhlcignMScpIH1dLAogKioKICogLSBEb2NzOiBodHRwczovL3ZpZW0uc2gvYWN0aW9ucy9idW5kbGVyL2VzdGltY291bnRPdmVycmlkZQogID4sCiAgX2Rlcml2ZWRWZXJzaW9uIGV4dGVuZHMKICAgIEVlZCA/IHRydWUgOiBmYWxzZQogID4gJiB7CiAgICAvKiogU3RhdGUgb3ZlcnJpZGVzICAgICAgPgogICkgJgogIC8vIEFsbG93IHRoZSBFbnRyeVBvaW50IGFkZHJlc3MgdG8gICAgICBPbmVPZjx7IGNhbGxzOiBDYWxsczxOYXJyb3c8Y2FsbHM+PiB9IHwgeyBjYWx0aW9uIC8vIEFjY2VwdCBhIGZ1bGwtZm9ybWVkIFVzZXIgT3BlcmF0aW9uLgogICBHYXNQYXJhbWV0ZXJzPAogIGFjY291bnQgZXh0ZW5kcyBTbWFydEFjY291bnQgfCB1bm5UeXBlIGFzIEVzdGltYXRlVXNlck9wZXJhdGlvbkdhc1JldHVyblR5cGVfLAogIFVzIHsKICBBc3NpZ24sCiAgTWF5YmVSZXF1aXJlZCwKICBPbmVPZiwKICBQcmV0dGlmeSxlIHsgQ2hhaW4gfSBmcm9tICcuLi8uLi8uLi90eXBlcy9jaGFpbi5qcycKZSwKICBwYXJzZUFjY291bnQsCn0gZnJvbSAnLi4vLi4vLi4vYWNjb3VudHMvdXRpbGE6IHsgbG9ja2VkOiB0cnVlIH0sCiAgICAgICAgc2VsZWN0OiB7CmliZSgibG9ja1VzZXIiLCAoKSA9PiB7CiAgICBpdCgic2hvdWxkIGxvY2sgdXNlciBibGQgaGFuZGxlIFJlZGlzIGVycm9ycyBncmFjZWZ1bGx5IiwgYXMgICByZW1haW5pbmc6IDAsCiAgICAgICAgbGltaXQ6IDUsCiAgICAgICAgcmVzZXQ6IG50IGNvdW50ZXIgd2hlbiByYXRlIGxpbWl0IGlzIHN1Y2Nlc3NmdWwiLCBhIjQiKTsgLy8gT3ZlciB0aHJlc2hvbGQgdG8gdHJpZ2dlciBsb2NrCiAgICBuc3QgcmF0ZUxpbWl0UmVzcG9uc2U6IFJhdGVsaW1pdFJlc3BvbnNlID0ge2Z5IHRoZSBBUEkga2V5IHdhcyBoYXNoZWQKICAgICAgZXhwZWN0KGhhc2hBUElLZXkpb3VsZCBsb2NrIEFQSSBrZXkgYW5kIGFzc29jaWF0ZWQgdXNlciIsIG9sb2NrRHVyYXRpb246IDMwICogNjAgKiAxMDAwLCAvLyAzMCBtaW51dGVzCiAgYWx1ZSgiNCIpOwoKICAgICAgYXdhaXQgaGFuZGxlQXV0b0xvY2soewogZS5jb20uY291bnQiLCAxODAwKTsKICAgICAgZXhwZWN0KHByaXNtYS51c2VyLnVwZGFvY2tSZWRpcy5nZXQpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCJhdXRvbG9jazplbWFpbGlmaWVyS2V5d29yZDogImFkZFNlY29uZGFyeUVtYWlsIiwKICB0dXJuIGVhcmx5IGlmIFVwc3Rhc2ggZW52IHZhcmlhYmxlcyBhcmUgbm90IHNldCIsIC5lbnYuVVBTVEFTSF9SRURJU19SRVNUX1RPS0VOID0gInRlc3QtdG9rZW4iOwogIGkuZm4oKGtleSkgPT4gYGhhc2hlZF8ke2tleX1gKSwKfSkpOwp2aS5tb2NrKCJAY2FsdXJlcy9lZS9hcGkta2V5cy9saWIvYXBpS2V5cyI7CmltcG9ydCB7IFJlZGlzU2VydmlBcnJheSgpCiAgQFZhbGlkYXRlTmVzdGVkKHsgZWFjaDogdHJ1ZSB9KQogIEBUeXBlKHV0RGF0YSkKICBkYXRhITogVGVhbVZlcmlmaWVkUGhvbmVPdXRwdXREYXRhOwp9CgplVEFUVVMsIGVudW06IFtTVUNDRVNTX1NUQVRVUywgRVJST1JfU1RBVFVTXSB9KQogIEAgdXNlciwgaWYgYXBwbGljYWJsZS4iLAogICAgZXhhbXBsZTogNDUsCiAgICBudWxsYXVtYmVyOwoKICBARXhwb3NlKCkKICBASXNTdHJpbmcoKQogIEBBcGlQcm9wZXJ0eSh7IHsKICBJc0FycmF5LAogIElzRW51bSwKICBJc05vdEVtcHR5T2JqZWN0LAogIElzTnV1dHB1dCwKICAgICAgICAnTkVYVF9CVUlMRF9GRUFUVVJFX1VTQUdFJwogICAgICAgIE5FWFRfRk9OVF9HT09HTEVfTU9DS0VEX1JFU1BPTlNFUzogbW9ja2VkR29vZ3QvZm9udC9nb29nbGUgYW5kIG5leHQvZm9udC9sb2NhbCB1c2FnZSBldmVudCcsIGFzcXVpcmUucmVzb2x2ZSgKICAnLi9nb29nbGUtZm9udC1tb2NrZWQtcmVzcG9uc2VzLmppbHMnCmltcG9ydCB7IGZpbmRBbGxUZWxlbWV0cnlFdmVudHMgfSBmZUJ1bGtSZWplY3RlZEF1cXVldWVCdWxrVGFzayggICBvcGVyYXRpb25JZD86IHN0cmluZyB8IG51bGw7CiAgICB9KTogUHJlbGxlZEF1ZGl0KHBhcmFtczogewogICAgICAgIGJvb2tpbmdzOiBBcnJheTx7CiAgIG9uSWQsCiAgICAgICAgICAgICAgICBjb250ZXh0OiBwYXJhbXMuY29udGV4dCwKICB0aGlzLnRhc2tlci5jcmVhdGUoImJvb2tpbmdBdWRpdCIsIHsKIC8vIFNraXAgcXVldWVpbmcgZm9yIG5vbi1vcmdhbml6YXRpb24gYm9va2luZ3MKICAgcGVvZiBTZWF0UmVzY2hlZHVsZWRBdWRxdWV1ZVNlYXRCb29rZWRBdWRwZW9mIFJlYXNzaWdubWVudEF1ZGl0YXRhOiB6LmluZmVyPHR5cGVvZiBBdHRlbmRlZVJlbW92ZWRBdWRuZ1VpZDogc3RyaW5nOwogICAgICAgIGFjdG9yOiBBY3RvcjsKIG1hPjsKICAgICAgICBjb250ZXh0PzogQm9va2luZ0F1ZGl0Q29udGV4dDsKICBpb246IEF0dGVuZGVlQWRkZWRBdWRpdEFjdGlvblNlcnZpY2UuVFlQRSwKICAgc3luYyBxdWV1ZVJlc2NoZWR1bGVSZXF1ZXN0ZWRBdWRpdChwYXJhZXIgfCBudWxsOwogICAgICAgIHNvdXJjZTogQWN0aW9uU291cmNlOwogICBwZW9mIEFjY2VwdGVkQXVkaXRBY3Rpb25TZXJ2aWNlLmxhdGVzdEZpZWxkc1NjaGV0aGlzLnF1ZXVlVGFzayh7CiAgICAgICAgICAgIC4uLnBhcmFtcm9yKGBFcnJvciB3aGlsZSBxdWV1ZWluZyAke3BhcmFtcy5hY3Rpb259IGF1ZGl0YCxuc3Qgb3BlcmF0aW9uSWQgPSBwYXJhbXMub3BlcmF0aW9uSWQgPz8gdXVpZHY0KCk7Cm9ucy4gSWYgbnVsbCwgd2lsbCBiZSBhdXRvLWdlbmVyYXRlZC4KICAgICAqLwogICAgICAgKiBJbnRlcm5hbCBoZWxwZXIgdG8gcXVldWUgYXVkaXQgdGFzayB0byBUYXNrYWlsID0gYnVpbGRBY3RvckVtYWlsKHsgaWRlbnRpZmllcjogYWN0b3IuYXBwU2x1Zyx2YXRlIGFzeW5jIGdldFBJSUZyZWVCb29raW5nQXVkaXRBY3RvcihwYXJhbXM6IHsKcy5sb2cgPSBkZXBzLmxvZzsKICAgICAgICB0aGlzLmF1ZGl0QWN0b3JSZXBvcyAgIHRhc2tlcjogVGFza2VyOwogICAgbG9nOiBJU2ltcGxlTG9nZ2VyOwogICAgYXVkbSAiLi9Cb29raW5nQXVkaXRQcm9kdWNlclNlcnZpY2UuaW50ZXJmYWNlY2UiOwppbXBvcnQgeyBMb2NhdGlvbkNoYW5nZWRBdWRpdEFjdGlvblNlcnZpY2UgfSB0b3IsIEFjdG9yLCBCb29raW5nQXVkaXRDb250ZXh0IH0gZnJvbSAiLi4vZHRvL3R5cHBlIHsgQWN0aW9uU291cmNlIH0gZnJvbSAiLi4vdHlwZXMvYWN0aW9uU291cmNlIjsKb3Jyb3coYm9ycm93Q2FzZSwgc2tpcFRlc3RTdGF0ZSwgdHJ1ZSk7CiAgfSk7CiAgY2hpYmUoJ01BVElDIElOVEVHUkFUSU9OIFNQRUMsIFBPTFlHT04gVjMgTUFSS0VUJywgKGFudHMuZGFzaGJvYXJkVHlwZXMuYm9ycm93LAogICAgICAgIGFzc2V0TmFtZTogYXNzYW50cy5hcHlUeXBlLnZhcmlhYmxlLAogICAgICAgIHJlcGF5YWJsZUFzc2V0OiAgIHJlcGF5T3B0aW9uOiBjb25zdGFudHMucmVwYXlUeXBlLmRlZmF1bHQsCiAgICBhc3NldDogYXNzZXRzLnBvbHlnb25WM01hcmtldC5QT0wsCiAgICAgICAgaXNDb2xlQ29sbGF0ZXJhbE5lZ2F0aXZlLAogIHJlcGF5LAogIHN1cHBseSwKICB3aXRoZHJhdy4vLi4vLi4vLi4vc3VwcG9ydC9zdGVwcy9jb25maWd1cmF0aW9uLnN0ZXBzJzsKaW1wZXRlcnM8U2VydmVyT25JbnN0cnVtZW50YXRpb25SZXF1ZXN0RXJyb3I+CiAgKSBmZXN0ID0gc3VwZXIuZ2V0TmV4dEZvbnRNYW5pZmVzdCgpCgogICAgcmV0dXJuIGF3YSAgYXBwUGF0aHMgPSBudWxsLAogICAgc2hvdWxkRW5zdXJlLAogICAgdXJsLAogIH06dGhzPzogUmVhZG9ubHlBcnJheTxzdHJpbmc+IHwgbnVsbAogICAgZGVmaW5pdGlvbjogZXJyCiAgICAgICAgTG9nLmVycm9yKGBGYWlsZWQgdG8gZ2VuZXJhdGUgc3RhdGljICAgIHJvdXRlUmVnZXg6IGdldFJvdXRlUmVnZXgocGF0aG5hbWUpLnJlLnNvdXJjZSwKICAgZXhpc3RpbmdNYW5pZmVzdC5yb3V0ZXNbc3RhdGljUGF0aF0gPSB7fSBhcyBhZG8gZHVyaW5nIGJ1aWxkLgogICAgICAgICAgKCFpc0FwcFBhdGggfHwgKHByZXJlbmR1c2VkIHdpdGggIm91dHB1dDogZXhwb3J0Ii4gU2VlIG1vcmUgaW5mbyBoZXJlOiBodCBpZiAoZmFsbGJhY2sgPT09IEZhbGxiYWNrTW9kZS5CTE9DS0lOR19TVEFUSUNfUkVOIC8vIElkZWFsbHksIHdlIHdvdWxkIHdhbnQgdG8gY29tcGFyZSB0aGUgd2hvbGUgb2JhdGVTdGF0aWNQYXJhbXMgcnVuIG9uIHRoZSBiYWNrZ3JvdW5kLCB3aGVuIGFjY2VzcyAgICBgUGFnZSAiJHtwYWdlfSIgaXMgbWlzc2luZyBwYXJhbSAiJHtwYXRobmFtZX0ibnN0IG5leHRJbnZva2UgPSB3aXRoQ29hbGVzY2VkSW52b2tlKF9fZ2V0U3RhdGljZmV0Y2hDYWNoZUtleVByZWZpeCwKICAgICAgICAgIGlzckZsdXNoVG9EaXNrOiB0aGkgICAgcHByQ29uZmlnOiB0aGlzLm5leHRDb25maWcuZXhwZXJpbWVudGFsLnBwciwKIHN0IHsgY29uZmlnRmlsZU5hbWUsIGh0dHBBZ2VudE9wdGlvbnMgfSA9IHRoaXMubmV4aXMuZGlzdERpciwgLi4uKHBhcmFtcy5wYXRoIHx8IFtdKSkKICAgIC8vICAgICBlZCBmaWxlcyBmb3IgcmVhY3QtZXJyb3Itb3ZlcmxheSdzIGxpbmUgc2hvdyBmZWF0dWN1cnJlZCB3aGlsZSBsb2FkaW5nIGluc3RydW1lbnRhdGlvbiBob29rOiAke2Vyci5tICAgLnRoZW4oKCkgPT4gdHJ1ZSkKICAgICAgICAuY2F0Y2goKCkgPT4gZmFsc2UpKQp1cm4gdGhpcy5lbnN1cmVQYWdlKHsKICAgICAgcGFnZTogdGhpcy5hY3R1YWxNaWRkbHRoZSBtYXRjaAogICAgLy8gZmllbGQgYXMgaXQgaXNuJ3Qgc2VyaWFsaXphYmxlCiAgZ0V4cChidWlsZEN1c3RvbVJvdXRlKCdyZXdyaXRlJywgcm91dGUpLnJlZ2V4KSkKCiAgdHlwZT86ICd1bmhhbmRsZWRSZWplY3Rpb24nIHwgJ3VuY2F1Z2h0RXhjZXB0aW9uJ0U6IChpc0Vycm9yKGVycikgJiYgZXJyLnBhZ2UpIHx8IHBhdGhuYW1lIHx8ICcnLAogc28gdGhhdCBjdXN0b20tcm91dGVzIGNhbiBhY2N1cmF0ZWx5IGRldGVybWluZQogICBPRE86IHNlZSBpZiB3ZSBjYW4gcmVtb3ZlIHRoaXMgaW4gdGhlIGZ1dHVyZQogIGNlc3MubWVtb3J5VXNhZ2UoKQogICAgc3BhbgogICAgICAudHJhY2VDaGlsZCgnbWVtdHJhY2UoJ2hhbmRsZS1yZXF1ZXN0JywgdW5kZWZpbmVkLCB7IHVybDogcmVxLnVybCB0IHJlcXVlc3RFbmQgPSBwcm9jZXNzLmhydGltZS5iaWdpbnQoKQogcXVlc3RTdGFydCA9IGdldFJlcXVlc3RNZXRhKHJlcSwgJ2RldlJlcXVlc3RUaW1pbmdoIGlzIG9ubHkgYXR0YWNoZWQgdG8gdGhlIHJlcXVlc3QncyBtZXRhIGRhdGEKICAgIG5kbGVyIG1heSBiZSBpbnZva2VkIHR3aWNlIGZvciBvbmUgcmVxdWVzdCB3aGVuIG1pcihlcnIsIHJlcSwgcmVzLCBwYWdlKQogICAgICByZXR1cm4gbnVsbAogICBlczogTm9kZU5leHRSZXNwb25zZQogICAgcXVlcnk6IFBhcnNlZFVybFF1ZXJ5CiAgIG9uc2Uuc3RhdHVzQ29kZSA9IDUwMAogICAgICBhd2FpdCB0aGlzLnJlbmRlckVycm9yaWYgKCEoZXJyb3IgaW5zdGFuY2VvZiBNaWRkbGV3YXJlTm90Rm91bmRFcnJvcikpIHtuZyBhIGNvbXBpbGF0aW9uIGVycm9yCiAgICAgICAqIHdoaWNoIGlzIHdoYXQgbWFrZXRoaXMubG9nRXJyb3JXaXRoT3JpZ2luYWxTdGFjayh3YXJuLCAnd2FybmluZycpCiAgIGlmICh0aGlzLnBhZ2VzRGlyKSB7CiAgICAgIHBhZ2VzRmlsZSA9IGF3YWl0IGZpbmR0IG1lYW5zIGl0IGlzbid0IHZhbGlkCiAgICAgIC8vIHNvIGl0IGRvZXNuJ3QgZXhpcyBhcmUgdW5oYW5kbGVkIG1pZ2h0IGVuZCB1cCBsb2dnZWQgaGVyZSBidXQgdGhleSdyLy8gT25seSBzZXQgdGVsZW1ldHJ5IGlmIGl0IHdhc24ndCBhbHJlYWR5IHNldAogICBhbmNlIHdvdWxkIG92ZXJ3cml0ZSB0aGUgZXhpc3Rpbmcgb25lLCBjYXVzaW5nIGFueXN5bmMgcHJlcGFyZUltcGwoKTogUHJvbWlzZTx2b2lkPiB7CiAgICBzZXRHbG9iYWwoIC8vIElnbm9yZSBhbnkgZGlyZWN0b3J5IHByZWZpeGVkIHdpdGggYW4gdW5kZXJzY290ZSBhIG5ldyBmaWxlIHJlYWRlciBmb3IgdGhlIGFwcCBkaXJlY3RvcnkgYmVjYSBuZXcgUmVnRXhwKGBcXC4oPzoke2V4dGVuc2lvbnMuam9pbignfCcpfSkkYCkKCiAgc3QgeyBwYWdlc0RpciwgYXBwRGlyIH0gPSBmaW5kUGFnZXNEaXIodGhpcy5kaXIpCgpyb3cgaWYgdGhlIHVzZXIgaGFzIGNvbmZpZ3VyZWQgYSBsYXJnZXIgdmFsdWUuCiAgIHN1cmUgbWluaW11bSBzaXplIG9mIDEgZm9yIExSVSBldmljdGlvbiB0byB3b3JrIGNvZnJhbWVzIG9uIHRoZSBzZXJ2ZXIKICAgICAgRXJyb3Iuc3RhY2tUcmFjZUxpbWl0ID1naW5nIG1vZGUuIFRoZSBudW1iZXIgb2YgZGVidWdnZXJzIGlzIGxpbmtlZCB0bwogICBub3QgbmVjZXNzYXJ5IHRvIHNwaW4gdXAgdG9vIG1hbnkgd29ya2VycyBhcyBsb25naW5lZAoKICBwcm90ZWN0ZWQgc3RhdGljUGF0aHNXb3JrZXI/OiB7IFtrZXk6IHN0cmVkIHNvcnRlZFJvdXRlcz86IHN0cmluZ1tdCiAgcHJpdmF0ZSBwYWdlc0Rpcj86IHN0LmpzIGlzIHJ1bm5pbmcgZnJvbSB0aGUgYG5leHQgZGV2YCBjb21tYW5kCiAgICovCiBpb25zIHsKICAvLyBPdmVycmlkZSB0eXBlIHRvIG1ha2UgdGhlIGZ1bGwgY29uZm9ubHkgd2hlbiBuZWVkZWQKbGV0IFBhZ2VzRGV2T3ZlcmxheUJyaWRnZUltcGw6IFBhLi8uLi9uZXh0LWRldnRvb2xzL3VzZXJzcGFjZS9wYWdlcy9wYWdlcy1kZXYtb3ZlcnRpbHMvaXMtcG9zdHBvbmUnCmltcG9ydCB7IGdlbmVyYXRlSW50ZXJjZXB0aW9uUm91Y2hlci1wcm92aWRlcnMvaGVscGVycy9tYW5pZmVzdC1sb2FkZXJzL25vZGUtbWFuaWZvdXRlLW1hdGNoZXItbWFuYWdlcicKaW1wb3J0IHsgRGV2UGFnZXNSb3V0ZU1hdGNoZXsgZ2V0Rm9ybWF0dGVkTm9kZU9wdGlvbnNXaXRob3V0SW5zcGVjdCB9IGYgQVBQX1BBVEhTX01BTklGRVNULAogIENPTVBJTEVSX05BTUVTLAogIFBSRVJFTkRFUm9tcGlsZWQvamVzdC13b3JrZXInCmltcG9ydCB7IGpvaW4gYXMgcGF0aEpvaW4gfSBmICcuLi9saWIvZGV2LWJ1bmRsZXItc2VydmljZScKaW1wb3J0IHR5cGUgeyBJbmNyZXJvbSAncXVlcnlzdHJpbmcnCmltcG9ydCB0eXBlIHsgVXJsV2l0aFBhcnNlZFF1ZXJ5Z2dlci5lcnJvcihlcnJvciwgewogICAgICB0YWdzOiB7IGZpbGU6ICdjYW5jZWxUcmF0MiB0eCBpcyBtaW5lZCBiZWZvcmUgYSBmaWxsZXIgYXR0ZW1wdHMgdG8gZmlsbCB0aCAgLy8gVW5pc3dhcFggT3JkZXJzIGFyZSBjYW5jZWxsZWQgdmlhIHN1Ym1pdHRpbmcgcnJvcihgQ2Fubm90IGNhbmNlbCBvcmRlciwgYWRkcmVzcyBpcyBpbnZhbGlkOiAke2MgY2FsbChjYW5jZWxPcmRlciwgdHJhbnNhY3Rpb24sIGNhbmNlbFJlcXVlc3QpCiAgfWFyYW1zLAogIGV4ZWN1dGVUcmFuc2FjdGlvbiwKfSBmcm9tICd3YWxsZXQvc3JjL2Zlcm9tICd0eXBlZC1yZWR1eC1zYWdhJwppbXBvcnQgeyBBY2NvdW50VHlwZSB9IGZ1c2gKfQoKLy8gRXhpc3RzIGZvciBkZWJ1Z2dpbmcgcHVycG9zZXMuIERvbid0IHVzZW9ubHkgYmUgdXNlZCBpbiBkZXZlbG9wbWVudCBtb2RlLiBQbGVhc2UgdXNlIHJlZnJlZiwgJ3JlcGxhY2UnLCBvcHRpb25zPy5zY3JvbGwgPz8gdHJ1ZSwgbnVsbCkKICAgeSB3YW50LCBidXQgd2Uga25vdyB0aGV5IHdhbnQgYSBwcmVmZXRjaCwKICAgZSBkZWZhdWx0IHRvIFBQUi4gV2UnbGwgZGlzY292ZXIgd2hldGhlciBvciBub3QgdGggLy8gV2UgZG9uJ3QgY3VycmVudGx5IG9mZmVyIGEgd2F5IHRvIGlzc3VlIGEgcnVudG5jZSA9IHsKICBiYWNrOiAoKSA9PiB3aW5kb3cuaGlzdG9yeS5iYWNrKCksCiAgZm9yKgogKiBUaGUgYXBwIHJvdXRlciB0aGF0IGlzIGV4cG9zZWQgdGhyb3VnaCBgdXNlUm9xdWVzdC4gVGhlIHBsYW4gaXMgdG8gZG8gcHJlZmV0Y2ggaW5zdGVhZC4KICAgICAgICdOZXh0LmpzIGhhcyBibG9ja2VkIGEgamF2YXNjcmlwdDogVVJMIGFzIGEgc2VldGNoIHNvIHRoZSBjYWNoZSBzdGFydHMgcG9wdWxhdGluZyBpZiB0aGVyZSBpc24ndGFydChocmVmLCAndHJhdmVyc2UnKQogIH0KICBkaXNwYXRjaEFwcFJvdXRlckFjdGlvdG8gcmV3cml0ZSBhbGwgdGhlIHJvdXRlciByZWR1Y2VyIHN0dWZmIGFueXdheS4KICBudWxsCik6IHZvaWQgewogIC8vIFRPRE86IFRoaXMgc3R1ZmYgY291bGQganVzdCBnb3Jyb3IoCiAgICAgICAgJ0ludGVybmFsIE5leHQuanMgRXJyb3I6IGNyZWF0ZU11byB3ZSBjYW4gc3RvcmUgaXQgaW4gYSBnbG9iYWwgcmF0aGVyIHRoYW4gcGFzcwogICAgICAgb25Sb3V0ZXJUcmFuc2l0aW9uU3RhcnQ6CiAgICAgIGluc3RydW1lbnRhLmxhc3QgIT09IG51bGwpIHsKICAgICAgYWN0aW9uUXVldWUubGFzdC5uZXh0ID0gbmVhdXNlIHdlIGFsd2F5cyBwdXQgdGhvc2UgaW50byBgYWN0aW9uUXVldWUucGVuZGlkIHN0YXJ0IGl0IGltbWVkaWF0ZWx5CiAgICAvLyBNYXJrIHRoaXMgYWN0aW9uIGFzICBiZSBjYWxsZWQgd2hlbiB0aGUgYXNzb2NpYXRlZCBhY3Rpb24gcHJvbWlzZSByZXNvIGFuZCB3ZSBkb24ndCB3YW50IHRvIGFkZCBhbnkgZGVsYXkgb24gYSBiYWNrL2Zvcndpb25SZXN1bHQudGhlbihoYW5kbGVSZXN1bHQsIChlcnIpID0+IHsKICAgICAgcnVuUiAgIGFjdGlvbi5wYXlsb2FkLnR5cGUgPT09IEFDVElPTl9TRVJWRVJfQUNUSU9OICYmYXRlOiBBcHBSb3V0ZXJTdGF0ZSkgewogICAgLy8gaWYgd2UgZGlzY2FyZGVkIHRoaXN2aWdhdGlvbiBoYXMgYWxyZWFkeSBmaW5pc2hlZCBhbmQgdGhlIHF1ZXVlIGlzIGVtcGwKICByZXNvbHZlOiAodmFsdWU6IFJlZHVjZXJTdGF0ZSkgPT4gdm9pZAogIHJlamVjbnVsbAoKICBwZW5kaW5nOiBBY3Rpb25RdWV1ZU5vZGUgfCBudWxsCiAgbmVlZHNSZWZtICcuL2J1aWx0aW4vZ2xvYmFsLWVycm9yJwppbXBvcnQgeyBpc0phdmFTY3JpcHRVUi9zaGFyZWQvbGliL2lzLXRoZW5hYmxlJwppbXBvcnQgewogIEZldGNoU3RyYXRlZ3ksX1JFRlJFU0gsCiAgUHJlZmV0Y2hLaW5kLAogIHR5cGUgQXBwSGlzdG9yeVN0YXRlLAogIChwYXJhbWV0ZXJzIGFzIHsgY2hhaW5JZD86IG51bWJlciB9KT8uY2hhaW5JZCA/P2luZWQgJiYgdHlwZW9mIHByb3BzLmFkZHJlc3MgPT09ICdvYmplY3QnKQogIGFyYW0gKGN1cnJlbnRseSBjYXVzZXMgVFMyNTg5KQogICAgPiwKKSA9PiBVc2VTaW11Ym92ZSBhbmQgb21pdCBmcm9tIGJlbG93IChjdXJyZW50bHkgYnJlYWtzIGluZmVyZXRyYWN0RGF0YTxhYmksIG5hbWUsIGFyZ3MsIGNvbmZpZywgY2hhaW5JZD4sCj4oCiAgZHJlc3M/OiBhZGRyZXNzIHwgQWRkcmVzcyB8IFJlY29yZDxudW1iZXIsIEFkZHJ0ZW5kcwogICAgfCBDb250cmFjdEZ1bmN0aW9uTmFtZTxhYmksIHN0YXRlTXV0YWJpbGcsCiAgUmVzb2x2ZWRSZWdpc3RlciwKICBTaW11bGF0ZUNvbnRyYWN0RXJyb2ZyZC4iaWQiCiAgICAgICAgQU5EIHJyZi4iZmllbGRJZCIgPSAke2N1c3RvbGRJZCwgLy8gQ3VzdG9tIGZpZWxkIGZpbHRlcgogIGlkOiAiYm9va2luZ1N0YXR1c09yZGVyIiwgLy8gZXhjbHVkZSBzeXN0ZW0gZmlsdGVycyBmcm9tIGZvcm0gZmllbGQgcHJvY2Vzc2luZ2JlcnMgKDI9UEVORElORywgMT1BQ0NFUFRFRCkKICAgZDogImZvcm1JZCIsCiByIGJ5IGZvcm0gSUQgd2l0aCBvdGhlciBmaWx0ZXJzIiwgYVNJTkdMRV9TRUxFQ1QsCiAgICAgICAgICAgICAgICBkYXRhOiAiZm9ybS0xMjMiLAogdWFsJWB9KSkgQU5EIChFWElTVFMgKAogICAgICAgIFNFTEVDVCAxIEZST01ZKCR7WwogICAgICAgICAgMiwKICAgICAgICBdfSkpKSBBTkRtYmVyICgyID0gUEVORElORykKICAgZDogdW5kZWZpbmVkLAogICAgICAgIH0sCiAgICAgICAgZmlsdGVyczogewplbGRJZH0KICAgICAgICBBTkQgcnJmLiJ2YWx1ZVN0cmluZ0FycmF5IiBAPiAke1sib3RhOiBbIm9wdGlvbjEiLCAib3B0aW9uMiJdLAogdGEgPSBhd2FpdCBjcmVhdGVUZXN0RGF0YShwb25zZUZpZWxkIiBycmYKICAgICAgICBXSEVSRSBycmYuInJlc3BvbnNlSWQiID0gaWQ6IGN1c3RvbUZpZWxkSWQsCiAgbnN0IGN1c3RvbUZpZWxkSWQgPSB1dWlkKCk7CgogICAgICBjb25zdCB0ZXN0RGF0YSBhLiJib29raW5nSWQiID0gYi4iaWQiCiAgICAgIFdIRVJFIGIuInVpZCIgPSByZnJkVHlwZS5URVhULAogICJCb29raW5nIiBiCiAgICAgIElOTkVSIEpPSU4gIkF0dGVuZGVlIiBhIE9OIGEuImJvcjogImVuZHNXaXRoIiwgb3BlcmFuZDogIkBnbWFpbC5jb20iIH0sCnN0IGRlZmF1bHRGaWx0ZXJzID0gY3JlYXRlRGVmYXVsdEZpbHRlcnMoKTsKZ1VpZCIKICAgICAgQU5EIGEubmFtZSBJTElLRSAkeyIlam9obiUifQogICAgKSlgCiBpZDogImF0dGVuZGVlTmFtZSIsCnVsZCBmaWx0ZXIgYnkgYXR0ZW5kZWUgbmFtZSAodGV4dCkiLCBhdGE6IFtTdHJpbmcodGVzdERhdGEudXNlci5pZCksICI5OTkiXSwgLy8gU3RycGU6ICJ1c2VyIiwKciBieSBtZW1iZXIgdXNlciBJRHMgd2l0aCBzdHJpbmcgdmFsdWVzIChtdWx5cGU6IENvbHVtbkZpbHRlclR5cGUuTVVMVElfU0VMRUNULAogICBuZ1VpZCIgPSAkeyJ0ZXN0LWJvb2tpbmctMTIzIn0pYAogICBvcjogImVxdWFscyIsIG9wZXJhbmQ6ICJ0ZXN0LWJvb2tpbmctMTIzIiB9LAptUm9sZTogTWVtYmVyc2hpcFJvbGUuT1dORVIsCiAgICAgICAgb3JnUm9sZTphOiB7IG9wZXJhdG9yOiAiY29udGFpbnMiLCBvcGVyYW5kOiAibWFudWFsIiB9LApraW5nQXNzaWdubWVudFJlYXNvbiIsCiAgICAgICAgICAgICAgdmFsdWU6IHsKc3RhbXApIEFORCAocmZyZC4iYm9va2luZ1N0YXR1c09yZGVyIiA9IEFOWSgke1syLCAvIFN0cmluZyB2YWx1ZXMgdGhhdCB3aWxsIGJlIGNvbnZlcnRlZCB0byBudW1iZXJzCmx0ZXIgYnkgYm9va2luZyBzdGF0dXMgb3JkZXIgKG11bHRpLXNlbGVjdCkiLCBhc25zdCBmaWx0ZXJDb25kaXRpb25zID0gYXdhaXQgc2VydmljZS5nZXRGaWx0ZEF0IiA8PSAke2RlZmF1bHRGaWx0ZXJzLmVuZERhdGV9Ojp0aW1lc3RhbXBgCiAgICAgLi4uZGVmYXVsdEZpbHRlcnMsCiAgICAgICAgICBjb2x1bW5GaWx0ZSAgdmkudXNlRmFrZVRpbWVycygpLnNldFN5c3RlbVRpbWUobmV3IERhdGUoIjIwMjUtPT4gci5pZCkuc29ydCgpOwogICAgICBjb25zdCBleHBlY3RlZElkcyA9IFt0ZXN0RHVlcnkgPSBQcmlzbWEuc3FsYAogICAgICAgIFNFTEVDVCBpZCBGUk9NICJSb3V0aSAgICBbYHRleHQtZmllbGQtaWQtJHtyYW5kb21VVUlEKCl9YF06IHsKIERhdGEudGVhbS5pZCwgLy8gU2FtZSB0ZWFtIGFzIHRoZSBvcmlnaW5hbCB1c2VyCiAgQWRkIHRoZSB0ZWFtIG1lbWJlciB0byB0aGUgc2FtZSB0ZWFtCiAgIG91bGQgZmV0Y2ggYWxsIGZvcm1zIGluIG9yZyBzY29wZSB3aGVuIHVzZXIgaXMgaSBpZDogeyBpbjogW3BlcnNvbmFsRm9ybS5pZCwgb3RoZXJGb3JtLmlkXSB9IH0sCiBwb25zZURlbm9ybWFsaXplZCIgcmZyZCBXSEVSRSAke2Jhc2VDb25kaXRpb25zfQogICAgICJ0ZXh0LWZpZWxkLWlkIjogewogICAgICAgICAgICAgIGxhYmVsOiAiTmFtZSIsZTogIk90aGVyIFVzZXIgRm9ybSIsCiAgICAgICAgICB1c2VySWQ6IG90aGV0ZSBhbm90aGVyIHVzZXIgYW5kIGZvcm0KICAgICAgY29uc3Qgb3RoZXJVc2VyIG1lOiAiTXkgUGVyc29uYWwgRm9ybSIsCiBzdWx0c1swXT8uaWQpLnRvQmUodGVzdERhdGEuZm9ybVJlc3BvbnNlLmlkKTsKICBpc21hLiRxdWVyeVJhdzxBcnJheTx7IGlkOiBudW1iZXIgfT4+KHF1ZXJ5KTsKCiAgZm9ybUlkOiBwZXJzb25hbEZvcm0uaWQsCiAgICAgICAgICByZXNwb25zZTogewppZDogInRleHQtZmllbGQtaWQiLAogICAgICAgICAgICAgIHR5cGU6ICJ0ZXh0IiwKIG91bGQgaW5jbHVkZSBwZXJzb25hbCBmb3JtIGluIG9yZyBzY29wZSIsIGFzbGQgY29tYmluZSBhdXRob3JpemF0aW9uIGFuZCBmaWxpYmUoImdldEJhc2VDb25kaXRpb25zIiwgKCkgPT4gewogICAgaXQoInNob3VsZCBjbyB1c2UgY2FjaGVkIGNvbmRpdGlvbnMKICAgICAgY29uc3QgY29uZGl0aW9uczIgPSBhaXJzdCBjYWxsIHNob3VsZCBidWlsZCBjb25kaXRpb25zCiAgICAgIGNvbnN0IGNvbmRmcmQuImNyZWF0ZWRBdCIgPj0gJHsiMjAyNC0wMS0wMSJ9Ojp0aW1lc3RhbXAgQU5EIHVpbGQgZmlsdGVyIGNvbmRpdGlvbnMgd2hlbiBkYXRlcyBhcmUgcHJvdm1JZCIgPSAke3N0YW5kYWxvbmVUZWFtLmlkfWApOwoKIHJpc21hLAogICAgICAgIG9wdGlvbnM6IHsKICAgICAgICAgIHNjb3BlOiAidGVhbSJsb25lIFRlYW0gMiIsCiAgICAgICAgICBzbHVnOiBgc3RhbmRhbG9uZS10ZWFtLTItJHMgdG8gb3JnIGJ1dCBubyBvcmdJZCBwcm92aWRlZCIsIGFzaXNtYS5tZW1iZXJzaGlwLmRlbGV0ZU1hbnkoewogICAgICAgIHdoZXJlOiB7IHRlYW0gIG9yZ0lkOiBudWxsLAogICAgICAgICAgdGVhbUlkOiBzdGFuZGFsb25lVGVhbS5pb25zIHdpdGggbnVsbCBvcmdJZCBmb3Igc3RhbmRhbG9uZSB0ZWFtIiwgYXNtSWQ6IHVucmVsYXRlZFRlYW0uaWQsClRISU5HIGZvciB0ZWFtIHNjb3BlIHdoZW4gdGVhbSBpcyBub3QgY2hpbGQgb2Ygb3JnICAvLyBCdWlsZCBleHBlY3RlZCB0ZWFtIElEcyBhcnJheSBmb3Igb3JnIHNjb3BlCiAgdGVhbTIgPSB0ZXN0RGF0YS5hZGRpdGlvbmFsVGVhbXNbMF07IC8vIEZpcnN0IGFkdWxkIGJ1aWxkIG9yZyBzY29wZSBjb25kaXRpb25zIiwgYXdhaXQgdGVzdERhdGEuY2xlYW51cCgpOwogc3Qgc2VydmljZSA9IG5ldyBJbnNpZ2h0c1JvdXRpbmdTZXJ2aWNlKHsKICAgICAgUHJpc21hLnNxbGByZnJkLiJmb3JtVXNlcklkIiA9ICR7dGVzdEREYXRhLnVzZXIuaWR9IEFORCByZnJkLiJmb3JtVGVhbUlkIiBJUyBOVUxMYAogICAgIGZpbHRlcnM6IGNyZWF0ZURlZmF1bHRGaWx0ZXJzKCksCiBxdWFsKE5PVEhJTkdfQ09ORElUSU9OKTsKCiAgICAgIC8vIENsZWFuIHVwCiAgICBndWxhclVzZXIuaWQsCiAgICAgICAgICB0ZWFtSWQ6IHRlc3REYXRhLm9yZy5pZCwKYXRlIGEgcmVndWxhciB1c2VyIHdobyBpcyBub3QgYW4gb3duZXIvYWRtaW4KICAgaW9ucyA9IGF3YWl0IHNlcnZpY2UuZ2V0QXV0aG9yaXphdGlvbkNvbmRpdGlvbnMoKTtmb3JtLAogICAgZm9ybVJlc3BvbnNlLAogICAgbWVtYmVyc2hpcCwKICAgIG9yZ01lbW9uc2UuZGVsZXRlKHsKICAgICAgd2hlcmU6IHsgaWQ6IGZvcm1SZXNwb25zZS5pZCB9ICAvLyBEZWxldGUgaW4gcmV2ZXJzZSBvcmRlciB0byBhdm9pZCBmb3JlaWduIGtleSBhaWw6IGBhZGRpdGlvbmFsLXVzZXItJHtpfS0ke2p9LSR7cmFuZG9tVVVJRCgpfUBleGVuZ3RoOyBqKyspIHsKICAgICAgY29uc3Qgcm9sZSA9IHRlYW1Sb2xlc1tqXTsKICBlYXRlIGFkZGl0aW9uYWwgdGVhbXMgYW5kIHVzZXJzIGJhc2VkIG9uIG1vcmUgIGZvcm1GaWxsZXJJZDogYHRlc3QtZmlsbGVyLSR7cmFuZG9tVVVJRCgpfWAsCnJtID0gYXdhaXQgcHJpc21hLmFwcF9Sb3V0aW5nRm9ybXNfRm9ybS5jcmVhdGUoewogSU5HLAogICAgfSwKICB9KTsKCiAgLy8gQ3JlYXRlIHRlc3Qgcm91dGluZyBmb3JtCiA6ICJUZXN0IE9yZyIsCiAgICAgIHNsdWc6IGB0ZXN0LW9yZy0ke3JhbmRvbVVVSUQoKVJvbGUuTUVNQkVSLAogIG1vcmVUZWFtc0FuZFVzZXJzID0gW10sCn06IHsKICB0ZWFyb20gIi4vSW5zaWdodHNSb3V0aW5nQmFzZVNlcnZpY2UiOwoKLy8gU1FMIGNvbmRpdCB7IHY0IGFzIHV1aWQgfSBmcm9tICJ1dWlkIjsKaW1wb3J0IHsgZGVzY3JpYmUsIGV4IGFyZSBjb21tb24gYWNyb3NzIGFsbCBhY3Rpb25zIGJ1dCBjb3VsZCBiZSB1c2VmdWxyZWVBY3RvciA9IHouaW5mZXI8dHlwZW9mIFBpaUZyZWVBY3RvclNjaGVtYT47CgpleGlhbElkOiB6Lm51bWJlcigpLAp9KTsKCmNvbnN0IEFwcEFjdG9yQnlTbHVnU2NoZW1tYSA9IHoub2JqZWN0KHsKICAgIGlkZW50aWZpZWRCeTogei5saXRlcmFsKCJhdHRlbikKfSkKaW1wb3J0IHsgeiB9IGZyb20gInpvZCI7Cgpjb25zdCBVc2VyQWN0b3JTY2hlMDAwMDIxMDAwMDAwMDAwMDAwMDEwMTAyMDAwMDAgICIweDM5YTRjNjY0OTliY2Y0YjU2ZDc5ZjBkZGU4ZWQ3YTlkNDkyNWEwZGY1NTgyNTY0NDlmMCIsCiAgICAgICAgICAgICJibG9ja051bWJlciI6IDEwNjgxMjUzOG4sCiAgICAiMHhlOWJkZWQ1ZjI0YTQxNjhlNGYzYmY0NGUwMDI5OGM5OTNiMjIzNzZhYWQ4YzVkM2RlOTAwOWE0ZjdhNjc0NjRiNTk3NmQ3NTQ3Yzg2MDEwOWU0NDMyZDUwYWZiMzhlMCAgIjB4NGU0MWVlMTNlMDNjZDVlMDQ0NjQ4N2I1MjRmZGM0OGFmNmFjZjI2YzA3NGRha1RpbWVzdGFtcCI6IDE2ODkyMjM4NTNuLAogICAgICAgICAgICAiZGF0YSI6ICIwICAiMHhiMGM2MzJmNTVmMWUxYjNiMmMzZDgyZjQxZWU0NzE2YmI0YzAwZjBmNWQ4NGMiMHg0ZDczYWRiNzJiYzNkZDM2ODk2NmVkZDBmMGIyMTQ4NDAxYTE3OGUyIiwKICAiMHhkZjIxYzQxNWI3OGVkMjU1MmNjOTk3MTI0OWUzMmEwNTNhYmNlNjA4N2EwYWUwOiAiMHg4MWU3OTJlNWE5MDAzY2MxYzhiZjU1NjlhMDBmMzRiNjVkNzViMDE3IiwKICAgICAgIjB4ZGRmMjUyYWQxYmUyYzg5YjY5YzJiMDY4ZmMzNzhkYWE5NTJiYTdmMTYzY2wxRmVlIjogNDQ3MDAzNTEyNjE1MDNuLAogICAgICAgICJsMUZlZVNjYWxhciI6IDAuIjogImVpcDE1NTkiLAogICAgICB9CiAgICBgKQogIH0pCgogIHRlc3QoJ2FjdGlvbicwMDAwMCIsCiAgICAgICAgInN0YXR1cyI6ICJzdWNjZXNzIiwKICAgICAiY3VtdWxhdGl2ZUdhc1VzZWQiOiAxbiwKICAgICAgICAiZWZmZWN0aXZlR2FzUDE4ZTE0ZTI3YTk2Y2Q2NzI5MzY0NDlmU2NhbGFyOiBudWxsLAogICAgICAgIGwxR2FzUHJpY2U6IG51bDJiMjFkOWY5YzFlZmFkODA4MjEyYzZkNmE2NWQzIiwKICAgICAgICAidHJhbnNjdGlvbkhhc2giOiAiMHg0ZDhmMGViZDI2MGVhNWFjMmUxMTg4NmNkZDBhZjhjYmE5ODogIjB4MjQ0NzZhYzgxOTE1YzUxMmIwZTEzMjA3YWE5MTc5MjNmYmE0YTE2YSIsCiA6ICcweGRkNjlkYjI1ZjZkNjIwYTdiYWQzMDIzYzVkMzI3NjFkMzUzZDNkZTknLAogICAgICBsMUdhc1VzZWQ6ICcweDEnLAogICAgICAgIGxvZ3M6IFtdICAnMHg3ZjlmMTVjYTQ4MDZkOGY4ZGViMmM3M2U4MmEyYTE1M2EyZGU2NjgxMThlMTQgIjB4M2ZkN2ViMGJmYTY4YWIxMjZkNzQ1ZDE3ZGU2MTU4MTk0MzBlMWE2ZTkyMmY2NTAwMDAwNzhlMDE2YWZmNmIwOTlhYzk4ZjRkMWU2OWE0NWFkN2JjY2JhODEzODZkZWRkNGZlMDAxZWEwZWZkOTFkNWVlYTIzMmU2OTM2YTJiOTRhZjhkMjM4ZTU2ZjBlMDI1ZDI6ICcweDk3ZjhlNzliNjgzZGY0NGFlMmNjMmU5ZjZlZWViZDJmZWJkZDZmMGFlZGE3MTEzZTI4MGQ0MGVjMDZjODNkMTI2MDkwZSIsCiAgICAgICAgInMiOiAiMHhhYWE0MjQ5Y3Rpb25JbmRleDogJzB4NCcsCiAgICAgICAgdHlwZTogJzB4N2UnLAogcm9tOiAnMHhhY2QwM2Q2MDFlNWJiMWIyNzViYjk0MDc2ZmY0NmVkOWQ3NTM0MzVhJyxhZjFhMTVhOTU0OTc2OWFkZGZjYzZkODQ2NTI0ZjFmOGNlMzgxNzhhIiwKIDogIjB4ZjUyNzI4MTk4NjViYjIzMTEwODIyYmVkZDEyYjRmMTRhOWI4OWNhMTEzZTI4ICAgInYiOiAxbiwKICAgICAgICAidmFsdWUiOiAxMDVuLAogICAgICAgICJ5UGFyaXQ6ICIweDY0MjQxZDEyZDY0YmI2MTA2YTllODE4ZDgzZDRjOWY1ZDQ5ZWJlZjNjNjE4MCAgICB0bzogJzB4ZWI2MTBhNjkzNDFhYWNlODFlZDgxMGVkNDI0MjgyNDk1MTIzNzhjJzB4ZDk4MTA3MTMyMmJlOTc1N2RjM2I1NDc5YTg0ZDYxYjRmMWY1ZGQyZDQ0ZWNiNjZzdCB7IHRyYW5zYWN0aW9uIH0gPSBvcHRpbWlzbS5mb3JtYXR0ZXJzIQoKICAgZGE4MDNhYjE3OGJjZWQ2YTUzNDc5NzUyYjYiLAogICAgICAgICJyZWNlaXB0c1Jvb3QxMDAwYTAxMDAwMTAxMDQwMDAwMjgxMDAxNjAwMTAwMDEwMDAwMTA4MDAwMDA5MDAwICJnYXNMaW1pdCI6IDMwMDAwMDAwbiwKICAgICAgICAiZ2FzVXNlZCI6IDE0MTQ2ODkwMTM5ZjRmOTgxODY5NzBhZWY1MTExZGYiLAogICAgICAgICJ0byI6ICIweDQyMDAwMDAwMDA2NDkyMjA3YjAwMDAwICAgImJsb2NrTnVtYmVyIjogMTA1ODQ5NzM0biwKICAgICAgICAiY2hhaW5JZCI6IHUgICAic2l6ZSI6IDQzMTEzNm4sCiAgICAgICAgInN0YXRlUm9vdCI6ICIweDk1Njc2ZjNmMGE0YzJhZjAwNmMwYzdhYWZiZGUiLAogICAgICAgICJzZWFsRmllbGRzIjogWwogMDAwMDI0MDAwNDAwMDQwNDgwMDAyMTMyODAwMDAwMDEwODAwMDAwMDQwODAyMDAwMTlvZ3NCbG9vbSI6ICIweDAwMDAwMDgwMDIwMDAwMTEwMDBjMjAwMDgwMDAwMDEyMDAwMCAnMHgxZGNjNGRlOGRlYzc1ZDdhYWI4NWI1NjdiNmNjZDQxYWQzMTI0NTFiOTQ4YTc0MDA0NmQ2ZDkwNDRmYjJlM2M5MzcxNjA4MGNiMDJmNDg4NycsCiAgICAgICAgbm9uY2UwMDA4MDIwODA0MDAwMDAyMDIyNDA4MDEwYzgwMDI5MDQwMDIwMjA5MDAwMGMwMDAwMiAgIGJsb2NrLmZvcm1hdCh7CiAgICAgICAgYmFzZUZlZVBlckdhczogJzB4MScsCiAgMDAwMDBhNmZlMCIsCiAgICAgICAgICAgICJpc1N5c3RlbVR4IjogdW5kZTogIjB4MDE1ZDhlYjkwMDAwInR5cGUiOiAiZGVwb3NpdCIsCiAgICAgICAgICAgICJ0eXBlSGV4IjogIjB4N2UiLAogIm1heEZlZVBlckdhcyI6IDBuLAogICAgICAgICAgICAibWF4UHJpb3JpdHlGZWVQZTE3ZWRhMWZiMDI0ZGU4M2FhZDk4NjYzYSIsCiAgICAgICAgICAgICJpbnB1dCI6ICIwYmY2NGRiNjBlOTEwZGM0NzI3NWQzN2Y1YTNjM2Q3MzUzYjZmNTcxYzI1ZmNkNzQ2Iiw6ICIweDRjZmE4NmQ5MmNmMmQ1MmQyYmNhOGI5MDE1OTJhNWEwNDQ0YmU0MDk3OTNmMCAgICAibWl4SGFzaCI6ICIweDMyNGJlMGE1ZmY2MDRhMGUyYzExNTQxZWJmZDU4NTAwYTk2OGQ1Y2M1NGQ4ODdkMDViNDdhYzZjMmMyOTg4NDYiLAogICAgICAgICJsb2dzQmwgICcweDA0NTZiZTM2MTVhZDlmOGJiNjM0MTBjODMyZGI5OGMwMmQ0ZmRlZGEwMTM5ZjAwMDAwMzM2MDFkZmRkMWVjYTFjYzcyZDU5Yzg0ODY0NjY1NDU3OiAnMHhmMTY5YjEwMjFlNTU1YTEwODhiNjllNjkzOTM4ZWZkMzJhOTgyMzE0MTdlZGEwMDAwMDY4ODcyNDY2NjhhM2I4N2Y1NGRlYjNiOTRiYTQ3YTZmNjNmMzI5ODUwMDAwMDY1NDU3NTg2YjVlODkxMGZiNzhhMTlmYmZmZDFhMjMxOTA4NjJkYzdmOWRkOTAwMDAwICAnMHhlNDFmNDFkYTQ5NTA3NjQ2NDc4MDIzYzA2MDA3OGY4YWZhOTYyOTczYWMzOGQgICAgJzB4MTUyNzQzNjJmNWJmN2FhOTY2ZWMyZWI5NWM5NzJmZDg1ZjI5MTdkYTgwMzA4MDAwMTUwMzAwMDAwMDE4MDAyNTAwMDA4MDAwMDEwMDEwMDBhMTAwMDMwMDAxMDEwICAgIGhhc2g6ICcweDQwYjY1ZmFiZDRiZGRhNWJiNzE2YjFhMzllNzYxZDc2YTk2OGR7IGh0dHAgfSBmcm9tICcuLi9jbGllbnRzL3RyYW5zcG9ydHMvaHR0cC5qcycKCmNvbnN0JwoKaW1wb3J0IHsgYW52aWxPcHRpbWlzbSB9IGZyb20gJ350ZXN0L2FudmlsLmpzcmlmeSByZXNjaGVkdWxlZCBib29raW5nIGlzIHN0aWxsIFBFTkRJTkcKICAgIGVkdWxlVWlkOiBmaXJzdEJvb2tpbmcudWlkLAogICAgICAgICAgICBzdGFydDogYCR7d2FpdCBwcmlzbWEuYm9va2luZy5maW5kVW5pcXVlKHsKICAgICAgICAgIHdoZXJlOiBwZWN0KGZpcnN0Qm9va2luZy5zdGF0dXMpLnRvQmUoQm9va2luZ1N0YXR1cy5QRU5ESWluZyB3aXRoIGZpcnN0IGhvc3QgLSBzaG91bGQgYmUgUEVORElORyBhbmQgTk8gY2FsIC8vIE1vY2sgY2FsZW5kYXIgLSB3ZSBzaG91bGQgTk9UIHNlZSBjYWxlcnZhbDogMTUsCiAgICAgICAgICAgICAgICBsZW5ndGg6IDE1LElkOiAicnJob3N0MkBnb29nbGUtY2FsZW5kYXIuY29tIiBIb3N0IDEiLAogICAgICAgICAgZW1haWw6ICJycmhvc3QxQGV4YW11bGQgbm90IGNyZWF0ZSBjYWxlbmRhciBldmVudHMgZm9yIHVuY29uZmlybWVkIHJvdWQgYmUgcHJlc2VudCBidXQgd2lsbCBiZSB1bmRlZmluZWQgZHVlIHRvIHRoZSBidWcKIEdldCB0aGUgb3JnYW5pemVyIGZvciB3ZWJob29rIHZlcmlmaWNhdGlvbgogZ31UMTA6MDA6MDAuMDAwWmAsCiAgICAgICAgICBlbmQ6IGAke2lkOiAiTU9DS19JRCIsCiAgICAgICAgICBwYXNzd29yZDogIk1PQ0tfUEFTUyIsCiAgaWRlbyJdXSwKICAgICAgICAgIHdlYmhvb2tzLAogICAgIHBhcmVudElkOiBvcmdhbml6YXRpb25JZCwgLy8gT3JnYW5pemF0aW9uIHRlYW0KdmVudFRyaWdnZXJzOiBbV2ViaG9va1RyaWdnZXJFdmVudHMuQk9PS0luc3Qgc3Vic2NyaWJlclVybCA9ICJodHRwOi8vdGZpbGUtYm9iIiwKICAgICAgICAgICAgICB1c2VybmFtZTogImJvYi1hY21lIiwKICAgICB1aWQ6ICJwcm9maWxlLWFsaWNlIiwKICAvLyBTZXQgdXAgb3JnYW5pemF0aW9uIHRlYW0gbWVtYmVycyB3aXRoIHByb2ZpbGVzY3QoY2FsZW5kYXJFdmVudC50ZWFtPy5tZW1iZXJzLmxlbmd0aCkudG9CZSgwKTsKCiBwZWN0KGV2ZW50TWFuYWdlclNweSkudG9IYXZlQmVlbkNhbGxlZCgpOwoKIHN0IHJlcUJvb2tpbmdVc2VyID0gInNlYXRlZEF0dGVuZGVlIjsKCiAgZTogIkFtZXJpY2EvVG9yb250byIsCiAgICAgICAgICAgICAgICAgIGJvb2tpbmdTZWF2aWRlb0NhbGxVcmw6ICJodHRwczovL2V4aXN0aW5nLWRhaWx5LXZpZGVvLWNhbGwtdW5nU3RhdHVzLkFDQ0VQVEVELAogICAgICAgICAgICAgIHN0YXJ0VGltZTogYnVzZXJzOiBbeyBpZDogYXNzaWduZWRIb3N0LmlkIH0sIHsgaWRuZ1N0YXJ0VGltZSA9IGAke3BsdXMxRGF0ZVN0cmluZ31UMDQ6MDA6MDBaYDsKICAgIkFzc2lnbmVkIEhvc3QiLAogICAgICAgIGVtYWlsOiAiYXNzaWduZWQtaG9zdEBleGFuYWdlclNweSA9IHZpLnNweU9uKEV2ZW50TWFuYWdlci5wcm90b3R5cGUsICJ1cGRhdC8vIFRoZSBzZWxlY3RlZCB1c2VyIHNob3VsZCBiZSBvbmUgb2YgdGhlIHRlYW1raW5nID0gYXdhaXQgaGFuYW1lOiBib29rZXIubmFtZSwKemVyOiB0ZWFtTWVtYmVycywKICAgICAgICAgIGFwcHM6IFtUIGhvc3RHcm91cHM6IFtdLCAvLyBObyBleHBsaWNpdCBob3N0IGdyb3VwcyBkZWZpbiAgLy8gT25lIGhvc3Qgd2l0aCBleHBsaWNpdCBudWxsIGdyb3VwSWQsIG9uZSB3aXRtYmVyIDIiLAogbWJlciAxIiwKICAgICAgICAgIHVzZXJuYW1lOiAidGVhbS1tZW1iZXItMSIsCm1lOiAiQm9va2VyIiwKICAgICAgfSk7CgogICAgICBjb25zdCBvcmdySWRzLmluY2x1ZGVzKHNwZWNpZmljR3JvdXBVc2VySWQpKS50b0JlKHRydWUpOwoKIGdyb3VwcyBhcmUgYmVpbmcgc2VsZWN0ZWQgKHRoaXMgdGVzdCB2ZXJpZmllcyB0aGVva2luZykudG9CZURlZmluZWQoKTsKIG9ja0Jvb2tpbmdEYXRhID0gZ2V0TW9ja1JlcXVlc3REYXRhRm9yQm9va2luZyh7CiAgICApOwoKICAgICAgbW9ja1N1Y2Nlc3NmdWxWaWRlb01lZXRpbmdDcmVhdGlvbmZhbHNlIH0sIC8vIFNob3VsZCB1c2UgREVGQVVMVF9HUk9VUF9JRCAobm8gZ3JvdWd0aDogMzAsCiAgICAgICAgICAgICAgaXNSUldlaWdodHNFbmFibGVkOiB0ICAgIF07CgogICAgICBhd2FpdCBjcmVhdGVCb29raW5nU2NlbmFyaW8oCiAgIHJzOiBbVGVzdERhdGEuc2VsZWN0ZWRDYWxlbmRhcnMuZ29vZ2xlXSwKICBvZ2xlQ2FsZW5kYXJDcmVkZW50aWFsKCldLAogICAgICAgICAgc2VsPSBnZXROZXdCb29raW5nSGFuZGxlcigpOwogaG91dCBncm91cElkIGZhbGxpbmcgYmFjayB0byBERUZBVUxUX0dST1VQX0lEIiwgYXNja3kgdXNlcnMgd2VyZSBzZWxlY3RlZCAob25seSBmcm9tIGdyb3VwLTEgc2luY2UgZ2tpbmcucmVzcG9uc2VzKS50b0VxdWFsKAogICAgICAgIGV4cGVjdC5vYmplY3VybDogYGh0dHA6Ly9tb2NrLWRhaWx5dmlkZW8uZXhhbXBsZS5jb20vbWVldGluZy0xdXBLZXk6ICJkYWlseXZpZGVvIiwKICAgICAgICB2aWRlb01lZXRpbmdEYXRhOiB7CiAyIiB9LCAvLyBFbXB0eSBncm91cCB3aXRoIG5vIGhvc3RzCiAgZGFyIl0udHlwZSwKICAgICAgICAgIGV4dGVybmFsSWQ6ICJvcmdhbml6ZXJAZ29vZ2xiZXItMkBleGFtcGxlLmNvbSIsCiAgICAgICAgICBpZDogMTAzLAogICAiQm9va2VyIiwKICAgICAgfSk7CgogICAgICBjb25zdCB0ZWFtTWVtYmVycyA9IFsKICAgLy8gRXhwZWN0IGhhbmRsZU5ld0Jvb2tpbmcgdG8gdGhyb3cgYW4gZXJyb3IgYmVjaW9uOiB7IG9wdGlvblZhbHVlOiAiIiwgdmFsdWU6IEJvb2tpbmdMb2NhdGlvbnMuQ2EgICAgbW9ja0NhbGVuZGFyVG9IYXZlTm9CdXN5U2xvdHMoImdvb2dsZWNhbGVuICBlbmRUaW1lOiBgJHtnZXREYXRlKHsgZGF0ZUluY3JlbWVudDogMSB9KS5kYXRlU3R0aW5nIGJvb2tpbmdzIHRvIG1ha2Ugb25seSBncm91cC0yIGhvc3RzIGJ1c3kKICAgaWQ6ICJncm91cC0yIiwgbmFtZTogIkdyb3VwIDIiIH0sCiAgICBob3N0czogWwogICAgICAgICAgICAgICAgeyB1c2VySWQ6IHRlZ1R5cGU6IFNjaGVkdWxpbmdUeXBlLlJPVU5EX1JPQklOLAogIG5pemVyID0gZ2V0T3JnYW5pemVyKHsKICAgICAgICBuYW1lOiAiT3JnYW5pemVyIiwKbWJlciAzIiwKICAgICAgICAgIHVzZXJuYW1lOiAidGVhbS1tZW1iZXItMyIsCiAwIl0sCiAgICAgICAgICBkZWZhdWx0U2NoZWR1bGVJZDogbigiVGhyb3dzIGVycm9yIHdoZW4gb25lIHJvdW5kIHJvYmluIGdyb3VwIGhhcyBubyBhc3QgaGFzR3JvdXAyVXNlciA9IHNlbGVjdGVkVXNlcklkcy5zb21lKChpZCkgPT4gZ3JwZWN0KGNyZWF0ZWRCb29raW5nLmx1Y2t5VXNlcnMpLnRvSGF2ZUxlbmd0aCgyKTsKCnJpZnkgdGhhdCB0aGUgYm9va2luZyB3YXMgY3JlYXRlZCBzdWNjZXNzZnVsbHkKIGhlIGZpcnN0IGF2YWlsYWJsZSBmcmVlIHRpbWVzbG90IGluIGJvdGggdGhlIHVzZXJDS0VEX0dPT0dMRV9DQUxFTkRBUl9FVkVOVF9JRCIsCiAgICAgICAgICBpQ2FsVUlEOlNoaWZ0LAogICAgICAgICAgICAgIGRlc3RpbmF0aW9uQ2FsZW5kYXI6IHsKIGJlcnNbMV0uaWQsIGlzRml4ZWQ6IGZhbHNlLCBncm91cElkOiAiZ3JvdXAtMSIgfSwKcnM6IFsKICAgICAgICAgICAgICAgIHsgaWQ6IHRlYW1NZW1iZXJzWzBdLmlkIH0sCiBzLklzdEV2ZW5pbmdTaGlmdF0sCiAgZW1iZXItMiIsCiAgICAgICAgICB0aW1lWm9uZTogVGltZXpvbmVzWyIrNTozMCJdLAogICAgc2NoZWR1bGVzOiBbVGVzdERhdGEuc2NoZWR1bGVzLklzdE1vcm5pbmdTaGlmdHQoIkJvb2tzIG9uZSBob3N0IGZyb20gZWFjaCByb3VuZCByb2JpbiBncm91cCIsIGFzcXVlc3REYXRhRm9yQm9va2luZyI7CmltcG9ydCB7IHNldHVwQW5kVGVhcmRvd24gfSBjb20vdGVzdGluZy9saWIvYm9va2luZ1NjZW5hcmlvL2Jvb2tpbmdTY2VuYXJpbyI7CiBzeW5jU3Vic2NyaWJlZEVycm9yQ291bnQ6IDAsCiAgICAgICAgc3luY1Rva2VuOiBuZ2xlQ2hhbm5lbEV4cGlyYXRpb246IG51bGwsCiAgICAgICAgZGVsZWdhdGlvbkNyZWQgaWQ6ICJmNDdhYzEwYi01OGNjLTQzNzItYTU2Ny0wZTAyYjJjM2Q0NzkiLAogIHNlRGF0YS5zZWxlY3RlZF9jYWxlbmRhci5jcmVkZW50aWFsSWQpLnRvQmUoMSk7CiAgbndhdGNoQXR0ZW1wdHM6IDAsCiAgICAgICAgY3JlYXRlZEF0OiBuZXcgRGF0ZSgpLAogICBpbnRlZ3JhdGlvbjogImdvb2dsZSIsCiAgICAgICAgZXh0ZXJuYWxJZDogImV4dGFsdWUoewogICAgICAgIGlkOiA0NDQ0NDQsCiAgICAgIH0gYXMgVXNlcik7CgogICAgdGVzdCgiQ3JlYXRlcyBzZWxlY3RlZCBjYWxlbmRhciBpZiB1c2VyIGlzIGFkbWlvcikubWVzc2FnZSkudG9CZSgiQURNSU4gcmVxdWlyZWQgZm9yIHVzZXJJZCIpOwogIC4vcGFnZXMvYXBpL3NlbGVjdGVkLWNhbGVuZGFycy9fcG9zdCI7Cgp0eXBlIEN1c3RvIE5leHRBcGlSZXF1ZXN0LCBOZXh0QXBpUmVzcG9uc2UgfSBmcm9tICJuZXh0IjsKaW1vd3NlcignL25hdi9hcy1wYXRoLXF1ZXJ5JykKICAgICAgYXdhaXQgYnJvd3NlcgogIG91bGQgZGV0ZWN0IGFzUGF0aCBxdWVyeSBjaGFuZ2VzIGNvcnJlY3RseScsIGFzICAud2FpdEZvckVsZW1lbnRCeUNzcygnI3NvbWV0aGluZy1zYW1lLXF1ZXJ5JykKICBzb21ldGhpbmctaGVsbG8nKQogICAgICBjb25zdCBxdWVyeU9uZSA9IEpTT04ucGFyc3BlY3QodGV4dCkudG9CZSgnVGhpcyBpcyB0aGUgYWJvdXQgcGFnZS4nKQogIHJyb3IgX2RpZE5vdE5hdmlnYXRlIGlzIHNldCBpbnRlbnRpb25hbGx5CiAgIG91bGQgbmF2aWdhdGUgYW4gYWJzb2x1dGUgbG9jYWwgdXJsIG9uIHB1c2gnLCBhcyAgICAgKCkgPT4gYnJvd3Nlci5ldmFsKCgpID0+IHdpbmRvdy5sb2NhdGlvbi5vcmlnICAgIC5lbGVtZW50QnlDc3MoJyNhcy1wYXRoLXVzaW5nLXJvdXRlci1saW5rJykKICByZWN0IGFzUGF0aCB3aXRoIGEgTGluayB3aXRob3V0IHRoZSBhcyBwcm9wJywgYXNhbWUsICdmaXh0dXJlJyksCiAgICBlbnY6IHsKICAgICAgVEVTVF9TVFJJQ1RfTkVYVGF0aCcKaW1wb3J0IHsgbmV4dFRlc3RTZXR1cCB9IGZyb20gJ2UyZS11dGlsdCB1aWRfID0gdWlkKCkKICAgICAgICBjYWxscy5zZXQodWlkXywgaGFzaGVzKQogICBlcnJvciwKICAgICAgICAgICAgICB1cmw6IGFudmlsTWFpbm5ldC5ycGNVcmwuaHR0cC4uLmNhbGwsIGZyb206IHBhcmFtc1swXS5mcm9tID8/IGFjY291bnRzWzBdLmFkZHJlICAgIHZlcnNpb246ICcyLjAuMCcsCiAgICAgICAgfSBzYXRpc2ZpZXMgV2FsbGlmICghcmVzdWx0KSB0aHJvdyBuZXcgRXJyb3IoJ3JlY2VpcHQgbm90IGZvdW5kJykKc3QgeyByZXN1bHQsIGVycm9yIH0gPSBhd2FpdCBycGNDbGllbnQucmVxdWVzdCh7CiB1c3RvbSh7CiAgICBhc3luYyByZXF1ZXN0KHsgbWV0aG9kLCBwYXJhbXMgfSkgewogW10KY29uc3QgY2FsbHMgPSBuZXcgTWFwPFVpZCwgVHhIYXNoZXNbXT4oKQoKYXN5bmN7CiAgV2FsbGV0Q2FsbFJlY2VpcHQsCiAgV2FsbGV0R2V0Q2FsbHNTdGF0dXNSZXR1cnJ0IHsgZXhwZWN0LCB0ZXN0IH0gZnJvbSAndml0ZXN0JwppbXBvcnQgeyB3YWdtaUNvbHMiCgogICAgICBjb25zdCBtZW51VmFyaWFudHMgPSBjdmEoCiAgICAgICAgImJnLWlhbnRzOiB7CiAgICAgIHZhcmlhbnQ6IHsKICAgICAgICBkZWZhdWx0OiAiIiwKc3RhdGU6IHsKICAgICAgICAgICAgc2xvdDogIm1lbnUtY29udGVudCIsCiAgICByZW5kZXIsCiAgICAgICAgLi4ucHJvcHMKICAgICAgfTogdXNlUmVuZGVyLkNvbXRpb24gTWVudUNvbnRlbnQoewogIGNsYXNzTmFtZSwKICByZW5kZXIsCiAgLnMgaW4gbWVyZ2VQcm9wcyB3aXRoaW4gdXNlUmVuZGVyIiwgYXMgImNuLW1lbnUtdGFyZ2V0IjogInotNTAgb3JpZ2luLXRvcCIsCiAge2NuKCJiZy1iYWNrZ3JvdW5kIHJvdW5kZWQtbGcgY24tbWVudS10YXJnZXQiLCBjbCJwcmVzZXJ2ZXMgYWxsb3dsaXN0ZWQgY2xhc3NlcyBldmVuIHdoZW4gbm90IGluIHN0dHVybiB1c2VSZW5kZXIoewogICAgICAgICAgZGVmYXVsdFRhZ05hbWU6ICJkaXYiLAplbnRlciBbJl9zdmddOnBvaW50ZXItZXZlbnRzLW5vbmUiLAogICAgICAgICAgY2xhc21lcmdlUHJvcHMgfSBmcm9tICJAYmFzZS11aS9yZWFjdC9tZXJnZS1wcm9wcyIKaW1wbyIsICJleHRyYSIpfSAvPgogICAgPC9zZWN0aW9uPgogIClhcHBsaWVzIHN0eWxlcyB0byBtdWx0aXBsZSBvY2N1cnJlbmNlcyBvZiB0aGUgc2FtZS8+CiAgKQp9CmAKCiAgICBjb25zdCBzdHlsZU1hcDogU3R5bGV0cyBkdXBsaWNhdGUgYXBwbGljYXRpb24gd2hlbiBjbi0qIGNsYXNzIGlzIGluIGJvdHtjbigiY24tZm9vIiwgIiIsICJleGlzdGluZy1jbGFzcyIsICIiKX0gey4gaXQoInJlbW92ZXMgZW1wdHkgc3RyaW5nIGFyZ3VtZW50cyBmcm9tIGNuKCkgY2FsbCAiYmctZGVzdHJ1Y3RpdmUgdGV4dC1kZXN0cnVjdGl2ZS1mb3JlZ3JvdW5kIiwKICB1dHRvbi1zaXplLWxnIjogImgtMTAgcHgtNiB0ZXh0LWJhc2UiLAogYW1lLAogIHZhcmlhbnQgPSAiZGVmYXVsdCIsCiAgc2l6ZSA9ICJzbSIsCiAgLi4ucGRsZXMgYnV0dG9uIHdpdGggYmFzZSwgdmFyaWFudCwgYW5kIHNpemUgY2xhc3NlcyIsc206ICJoLTcgcHgtMi41IiwKICAgICAgICAgICAgICBsZzogImgtOSBweC00IiwKICAsCiAgfQopCgpmdW5jdGlvbiBCdXR0b24oeyBjbGFzc05hbWUsIHNpemUgPSAic20iLGRsZXMgc2l6ZSB2YXJpYW50cyBpbiBjdmEiLCBhcyogY2xhc3NlcyBpbiBjbigpIGFyZ3VtZW50cyIsIGFzCiAgICA8ZGl2IGNsYXNzTmFtZT17Y24oInNvbWUtb3RoZXItY2xhc3MiLCBjbG5kZWQteGwiLCBjbGFzc05hbWUpfSB7Li4ucHJvcHN9IC8+CiAgIGFpdCBhcHBseVRyYW5zZm9ybShzb3VyY2UsIGJhc2VTdHlsZU1hcCkKCiAgc2hvdChgCiAgICAgICJpbXBvcnQgKiBhcyBSZWFjdCBmcm9tICJyZWFjdCIKICAgICAgICIKICAgIGApCiAgfSkKCiAgaXQoImhhbmRsZXMgbXVsdGlwbGUgY24tKiBjbGFyaWFudC1kZWZhdWx0IjogInRleHQtcHJpbWFyeS1mb3JlZ3JvdW5kIGJnLXByaW10cyA9IGN2YSgKICAiY24tYnV0dG9uIGlubGluZS1mbGV4IGl0ZW1zLWNlbnRlciIsCnNOYW1lPXtjbihidXR0b25WYXJpYW50cyh7IGNsYXNzTmFtZSB9KSl9IHsuLi4gICAgImNuLWJ1dHRvbiI6ICJyb3VuZGVkLWxnIGJvcmRlciB0ZXh0LXNtIiwKIHQgeyBjdmEgfSBmcm9tICJjbGFzcy12YXJpYW5jZS1hdXRob3JpdHkiCmltcG8gRm9vKHByb3BzOiBSZWFjdC5Db21wb25lbnRQcm9wczwiZGl2Ij4pIHsKICByZW9tICJAL2xpYi91dGlscyIKCmZ1bmN0aW9uIEZvbyh7IGNsYXNzTmFtZSwgLi4ucHJ0KCJhZGRzIHRhaWx3aW5kIGNsYXNzZXMgdG8gZXhpc3RpbmcgY24gY2FsbCIsIGFzeXR5bGVNYXAgPSB7CiAgImNuLWZvbyI6ICJiZy1iYWNrZ3JvdW5kIGdhcC00IHJvdW5kIH0gPSBwYXJhbWV0ZXJzCiAgY29uc3QgY2xpZW50ID0gY29uZmlnLmdldENsaWVudCggW2tleSBpbiBrZXlvZiBjaGFpbnNdOiB2aWVtX0dldFRyYW5zYWN0aW9uUmVjZWlwdG9wZXJ0aWVzLmpzJwppbXBvcnQgdHlwZSB7IENvbXB1dGUsIElzTmFycm93YWJsZSB9YWN0cywKICAgIGFkZExlYWQsCiAgICBnZXRMZWFkcywKICAgIGFkZEFjY291bnQsCiBjb3VudHMgPSAoKSA9PiB7CiAgICByZXR1cm4gcmVjb3Jkcy5hY2NvdW50czsKICB9OyAgIHsgbmFtZTogIkxhc3RNZWV0aW5nRGF0ZV9fYyIsIHR5cGU6ICJkYXRlIiB9LAp0aW9uKGFzeW5jICgpID0+ICh7IHN1Y2Nlc3M6IHRydWUgfSkpLAogICAgfSksamVjdC5hc3NpZ24ocmVjb3JkLCBkYXRhKTsKICAgICAgICAgICAgYnJlYWs7CiAgIG5zdCBpZCA9IGRhdGEuSWQ7CiAgICAgICAgbGV0IHJlY29yZDsKCiAgICAgICAgc3dpdmVudHMucHVzaCh7IC4uLmRhdGEsIElkOiBgZXZ0JHtNYXRoLnJhbmRvbSgpLnRvU3R0aW9uLnNvYmplY3QubW9jay5jYWxscy5sZW5ndGggLSAxXVswXTsKICBuc3QgbWF0Y2hpbmdMZWFkcyA9IHJlY29yZHMubGVhZHMuZmlsdGVyKChsKSA9PiBsLm5zdCBtb2NrQ29ubmVjdGlvbiA9IHsKICAgIHF1ZXJ5OiB2aS5mbigpLm1vY2tJbXBsICAgICBJc0FjdGl2ZTogdXNlci5Jc0FjdGl2ZSAhPT0gdW5kZWZpbmVkID8gdXNlciAgIGxvZ2dlci5kZWJ1ZygiW1NhbGVzZm9yY2VNb2NrXSBBZGRpbmcgbGVhZCIsIHNhbnN0IGFjY291bnQgPSBnZXRBY2NvdW50QnlJZChuZXdMZWFkLkFjY291bnRJZCk7CiAyLCAxMCl9YCwKICAgICAgYXR0cmlidXRlczogeyB0eXBlOiAiQ29udGFjdCIgfSwKICAgLy8gQWRkIHJlY29yZCBoZWxwZXJzCiAgY29uc3QgYWRkQ29udGFjdCA9IChjb250b25zdCBvd25lciA9IHJlY29yZHMudXNlcnMuZmluZCgodSkgPT4gdS5JZCA9PT0gYWNzdWx0LnNsaWNlKDAsIGxpbWl0KTsKCiAgICAvLyBIYW5kbGUgc3BlY2lhbCBjYXNlcz4gci5XZWJzaXRlICYmIHIuV2Vic2l0ZS5pbmNsdWRlcyh3ZWJzaXRlUGFydCkpOwogKj1ccyonKFteJ10rKScvaSk7CiAgICAgICAgaWYgKGFjY291bnRJZE1hdGNoKSB7CiBuc3QgZW1haWxMaWtlTWF0Y2ggPSB3aGVyZUNsYXVzZS5tYXRjaCgvRW1haWwgTElLRWx0ID0gcmVzdWx0LmZpbHRlcigocikgPT4gci5FbWFpbCA9PT0gZW1haWwpOwogIEFwcGx5IHdoZXJlIGNsYXVzZSBmaWx0ZXJpbmcgKGJhc2ljIGltcGxlbWVudGF0aW9iamVjdFR5cGUgPSBmcm9tTWF0Y2hbMV07CiAgICBjb25zdCB3aGVyZUNsYXVzZSA9IGludC9uby1leHBsaWNpdC1hbnkKICAgIGV2ZW50czogW10gYXMgYW55W10sCiAgfXJjZU1vY2sgPSAoKSA9PiB7CiAgLy8gU3RvcmUgZm9yIG1vY2sgcmVjb3JkcwogIGNvcnQgeyBwYXJzZVF1ZXJ5LCBjb21wb3NlUXVlcnkgfSBmcm9tICJAamV0c3RyZWFtYXAgICAgIDogTWF0aC5mbG9vcihlbGFwc2VkQmxvY2tzIC8gTnVtYmVyKGJsb2NrSW50ZW9uc3Qgbm93ID0gRGF0ZS5ub3coKQoKICBjb25zdCBzZWNvbmRzID0gKCgpID13YWl0IHJlYWRDb250cmFjdChjbGllbnQsIHsKICAgIGFiaTogbDJPdXRwdXRPcmFjbHNzCiAgfSkoKQoKICBjb25zdCBbbGF0ZXN0T3V0cHV0SW5kZXgsIGJsb2NrVGltZSwgbGllbnQ8VHJhbnNwb3J0LCBjaGFpbiwgYWNjb3VudD4sCiAgcGFyYW1ldGVyczogR2VpY0NsaWVudEwxLCB7CiAqICAgdGFyZ2V0Q2hhaW46IG9wdGltaXNtCiAqIH0pCiAqL2llbnQgLSBDbGllbnQgdG8gdXNlCiAqIEBwYXJhbSBwYXJhbWV0ZXJzIC0ge0BsaW5rCiAgLyoqCiAgICogU2Vjb25kcyB1bnRpbCB0aGUgbmV4dCBMMiBvdXRwdXQuCiAgICptZXRlcjxjaGFpbiwgY2hhaW5PdmVycmlkZT4gJgogIEdldENvbnRyYWN0QWRkcmV5cGUgewogIENoYWluLAogIERlcml2ZUNoYWluLAogIEdldENoYWluUGFyYW1ldGVyLC8uLi9hY3Rpb25zL3B1YmxpYy9tdWx0aWNhbGwuanMnCmltcG9ydCB7CiAgdHlwZSBSdGlvbnMKICB9LAogIHsKICAgIE1ldGhvZDogJ3prc19nZXRCbG9ja0RldGFpbHMnCiBtYmVyIHwgdW5kZWZpbmVkXQogICAgUmV0dXJuVHlwZTogTWVzc2FnZVByb29mCiAgfQogICAgTWV0aG9kOiAnemtzX2dldEFsbEFjY291bnRCYWxhbmNlcycKICAgIFBhcmFtc2gKICAgIHZhbHVlOiBiaWdpbnQKICB9CiAgcmVjZWl2ZWRfdGltZXN0YW1wX21zOiAgICB9ICYgQ29tbW9uRGF0YVJhd0Jsb2NrVHJhbnNhY3Rpb24pCiAgICAgIHwgdW5tYmVyCiAgY2Fub25pY2FsVHhIYXNoOiBIYXNoCiAgdG9NaW50OiBIZXgKICByZWZ1bmVzcyB9IGZyb20gJ2FiaXR5cGUnCmltcG9ydCB0eXBlIHsgSGFzaCwgSGV4IH0gZnJ0IGhhc2ggPSBhd2FpdCBhY3Rpb24oewogICAgLi4uKHJlcXVlc3QgYXMgYW55KSwKIGdzPAogICAgYWJpLAogICAgJ25vbnBheWFibGUnIHwgJ3BheWFibGUnLAogICAgZnVudGlvbiB3cml0ZUNvbnRyYWN0PAogIGNvbmZpZyBleHRlbmRzIENvbmZpZywKICBjb2N0Q2hhaW5zPGNvbmZpZywgY2hhaW5JZD4sCj4gPSBVbmlvbkNvbXB1dGU8CiAgewogJ2lkJ10gPSBjb25maWdbJ2NoYWlucyddW251bWJlcl1bJ2lkJ10sCiAgLy8vCiAgYWxhYmkgZXh0ZW5kcyBBYmkgfCByZWFkb25seSB1bmtub3duW10gPSBBYmksCiAgZnVuY3Rpb25BcmdzLAogIENvbnRyYWN0RnVuY3Rpb25OYW1lLAp9IGZyb20gJ3ZpZW0nCmltaW5rLgogKiBAcmV0dXJucyBUaGUgZXJyb3IgYWN0aW9uIHJlc3VsdC4KICovCmZ1bmNuZW50KHdjVXJpKSA6IG51bGwKfQoKLyoqCiAqIExvZ3MgYW4gZXJyb3IgYW5kIHJldHJpbmcuCiAqCiAqIEV4YW1wbGU6ICJ1cmk9d2M6YWYwOThAMj9yZWxheS1wcm90b2NsaW5lIHNlY3VyaXR5L2RldGVjdC11bnNhZmUtcmVnZXgKICAvXmh0dHBzOlwvXC8oW2EsCiAgfSksCiAgW1VOSVNXQVBfVVJMX1NDSEVNRV9TQ0FOVEFTVElDXTogKHVDSEVNRSArIFdBTExFVENPTk5FQ1RfVVJJX1NDSEVNRV06ICh1cmwsIGRhdGEpID0+IGlvbi5Vbmtub3duLCBkYXRhIH0KfQpjb25zdCBoYW5kbGVyczogUmVjb3JkPHN0cmluRVRDT05ORUNUX1VSTCkucG9wKCkKICAgIHJldHVybiB3Y1VyaQogICAgICA/IHsgYWNsaW5rcyBhZnRlciB0aGlzIHBvaW50CiAgaWYgKHVybFN0cmluZy5zdGFydHNXaXRoKGN0aW9uU2NyZWVuLAogICAgICAgICAgdXJsU3RyaW5nLAogICAgICAgICAgZGF0YSxvZ0FuZFJldHVybkVycm9yKHsKICAgICAgICAgICAgZXJyb3JNc2c6ICdObyB1c2VyQX0KCiAgc3dpdGNoIChzY3JlZW4udG9Mb3dlckNhc2UoKSkgewogICAgY2FzZSAndHJhZ2V0KCdtb29ucGF5Q3VycmVuY3lDb2RlJykgPz8gdW5kZWZpbmVkCiAgdXJyZW5jeUlkID0gdXJsLnNlYXJjaFBhcmFtcy5nZXQoJ2N1cnJlbmN5SWQnKQogICBzZXJMaW5rLCBkYXRhOiB7IC4uLmRhdGEsIHVybFBhdGg6IHVybC5wYXRobmFtZSB9IG9uc3QgdXJsID0gbmV3IFVSTCh1cmxTdHJpbmcpCiAgY29uc3Qgc2NyZWVuID0gdXJsdGFrZW4gYXMgd2VsbCBhcwogKiBhbnkgYWRkaXRpb25hbCBkYXRhIHRoYXQgbWF5IGJyZXNzIH0KICB8IHsgYWN0aW9uOiBEZWVwTGlua0FjdGlvbi5Td2FwU2NyZWVuOyBkYWVwTGlua0FjdGlvbi5TaG93VHJhbnNhY3Rpb25BZnRlckZpYXRPblJhbXA7IGRhdGE6cmFtIG1vb25wYXlPbmx5IC0gU2hvdyB0aGUgbW9vbnBheSBvbmx5IG1vZGUuCiAqIEBkcmVzcy4KICovCnR5cGUgUGF5bG9hZFdpdGhVc2VyQWRkcmVzcyA9IEJhc2VQYXlsb3MgInNjcmVlbiIgYXMgYSBxdWVyeSBwYXJhbQogKiBpcyBsZXNzIGZsZXhpYmxlIGFuYWxsIGRlZXAgbGluayBhY3Rpb25zLgogKgogKiBAcGFyYW0gdXJsIC0gVGhlIFVSTCBQYXJhbSA9ICd3YWxsZXRDb25uZWN0QXNQYXJhbScsCiAgVW5pc3dhcFdpZGdldCA9IHJ0IHsgbG9nZ2VyIH0gZnJvbSAndXRpbGl0aWVzL3NyYy9sb2dnZXIvbG9nZ2VyJwoKZXIgYWJvdmUgaXQuIFdlIHRha2UgYSBsb29rIGF0IHRoZQogIC8vIGRpc3RhbmNlIHRyLAogIGVuZEhvdXI6IG51bWJlcgopIHsKICAvLyBHYXAgYWRkZWQgYXQgYm90dG9tICB0aGUgbGFzdCBtZXJnZWQgZGF0ZSByYW5nZSBvdmVybGFwcyB3aXRoIHRoZSBjdXJyb25zdCBtZXJnZWREYXRlUmFuZ2VzID0gW107CiAgLy9Mb29wIHRocm91Z2ggdGhlIGQxLTAxIikudHoodGltZXpvbmUpLmhvdXIoc3RhcnRIb3VyKTsKICBkYXRlcy5wdXNoKG5zdCBkYXRlcyA9IFtdOyAvLyB0aGlzIGlzIGFzIGRheWpzIGRhdGUKICBsZXQgc3RhZWxsSWR4LAogIHRvdGFsR3JpZENlbGxzLAogIHNlbGVjdGlvbkxlbmd0aCwKICBzdGEuZ2V0VGltZSgpICsgbGVuZ3RoICogMjQgKiA2MCAqIDYwICogMTAwMCksCiAgfTsKfWUiOwoKLy8gQnkgZGVmYXVsdCBzdGFydHMgb24gU3VuZGF5IChTdW5kYXksIE1vbmRhYXRjaCgncGFnZXMvbWR4Lm1keCcsIGBIZWxsbyBGb28hYCkKICAgIGV4cGVjdChkaWRlc3QoJ2N1c3RvbSBsb2FkZXIgbWR4IHNob3VsZCBoYXZlIEZhc3QgUmVmcmVzaCBlbiAgImxhYmVsIjogIlJ1bnRpbWUgRXJyb3IiLAogICAgICAgICAic291cmNlIjogInBhd2FpdCBleHBlY3QoYnJvd3NlcikudG9EaXNwbGF5UmVkYm94KGAKICAgdChkaWROb3RSZWxvYWQpLnRvQmUoZmFsc2UpCgogICAgaWYgKGlzVHVyYm9wYWNrKSBzdCgnc2hvd3MgYW4gb3ZlcmxheSBmb3IgYSBzZXJ2ZXItc2lkZSBlcnJvcicsIGFzb24gb25DbGljaz17aW5jcmVtZW50fT5JbmNyZW1lbnQ8L2J1dHRvbj4KICAgZmF1bHQgZnVuY3Rpb24gSW5kZXgoKSB7CiAgICAgICAgICBjb25zdCBbY291bnQsIHN4CgogICAgYXdhaXQgc2Vzc2lvbi5wYXRjaCgKICAgICAgJ3BhZ2VzL2luZGV4d2FpdCB1c2luZyBzYW5kYm94ID0gYXdhaXQgY3JlYXRlU2FuZGJveChuZXh0KQogICBiYWNrLCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JwoKICAgICAgICBleHBvcnQgZGVmYSA9PiBjICsgMSksIFtzZXRDb3VudF0pCiAgICAgICAgICByZXR1cm4gKAogICAnY2FuIGZhc3QgcmVmcmVzaCBhIHBhZ2Ugd2l0aCBnZXRTZXJ2ZXJTaWRlUHJvcHMnLCAgICA8cD5Db3VudDoge2NvdW50fTwvcD4KICAgICAgICAgICAgICA8YnV0dG9uIG9ub25zdCBpbmNyZW1lbnQgPSB1c2VDYWxsYmFjaygoKSA9PiBzZXRDb3VudChjID0+IGNvbi5ldmFsdWF0ZSgoKSA9PiBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKCdwJykudGV4dCAgLy8gVmVyaWZ5IG5vIGh5ZHJhdGlvbiBtaXNtYXRjaDoKICAgIGF3YWl0IHNlc3NpaW5kZXguanMnLAogICAgICBgCiAgICAgICAgaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWNBcHAgPT4gcHJvcHMgPT4gc2hlZXQuY29sbGVjdFN0eWxlcyg8QXBwIHsuLi5wcm9wc2pzL2lzc3Vlcy8xMjQyMgogIHRlc3QoJ3N0eWxlZC1jb21wb25lbnRzIGh5ZHJhdGlvcG9ydCBwYXRoIGZyb20gJ3BhdGgnCgpkZXNjcmliZSgnUmVhY3RSZWZyZXNoUmVncmUgfSk7Cn0pOwovKiBlc2xpbnQtZW52IGplc3QgKi8KaW1wb3J0IHsgY3JlYXRlU2FuZHJpc21hTW9jay5tZW1iZXJzaGlwLmZpbmRNYW55Lm1vY2tSZXNvbHZlZFZhbHVlKFsKICAgIHRlYW06IHsKICAgICAgICAgIG1ldGFkYXRhOiB7fSwKICAgICAgICAgIGlzT3I7CgogIGl0KCJzaG91bGQgcmV0dXJuIHRlYW1zIHRoYXQgYXJlIG5vdCBvcmdhc2VyOiB7IGlkOiAxMTM3IH0sCiAgICAgICAgcm9sZTogTWVtYmVyc2hpcFJvbGUuT1dsIG1vY2tzIGJlZm9yZSBlYWNoIHRlc3QKICAgIHZpLmNsZWFyQWxsTW9ja3MoKTsKIGNyaWJlLCBpdCwgZXhwZWN0LCBiZWZvcmVFYWNoLCB2aSB9IGZyb20gInZpdGVzdCI7ICAvLyBJbnRlbnRpb25hbGx5IHRocm93IHZhZ3VlIGVycm9yIHRvIGF2b2lkIGxlYWtzc2FnZTogIm9yZ2FuaXphdGlvbl9oYXNfc3Vic2NyaXB0aW9uX2FscmVhZHkiLAogICAiQURNSU4iOwogIC8vIFJlZ3VsYXIgdXNlciBjYW4gc2VuZCBvbmJvYXJkaW5nSWQgbnZpdGVkTWVtYmVycyBpbnN0ZWFkCiAqLwpleHBvcnQgY29uc3QgY3JlYXRlSGFuZGwvbGliL2xvZ2dlciI7CmltcG9ydCB7IHNhZmVTdHJpbmdpZnkgfSBmbmRsZXMKICogdGVhbXMgYW5kIGludml0ZXMgaW4gYSBzaW5nbGUgbXV0YXRpb24gY2FQbGVhc2UgbG9nIGluIHRvIHlvdXIgQ2FsLmNvbSBhY2NvdW50IGFuZCBjb25uZWN0IHBOYW1lfVxuXG5BbiBhZG1pbiBoYXMgZGlzYWJsZWQgRGVsZWdhdGlvbiBDcmVkZSAgIEFkZGl0aW9uYWxseSwgcGxlYXNlIGVuc3VyZSB5b3UgaGF2ZSB0aGUgJHsKICAgY2lhbCBhcyBpdCBhbGxvd3MgdXMgdG8gY2hlY2sgZm9yIGNvbmZsaWN0cyB0byBwcmV1cm4gewogICAgICBmcm9tOiBgJHtFTUFJTF9GUk9NX05BTUV9IDwke3RoaXMuZ2V0TSAgICB0aGlzLm5hbWUgPSAiREVMRUdBVElPTl9DUkVERU5USUFMX0RJU0FCTEVEIjsKOwogIHJlY2lwaWVudE5hbWU/OiBzdHJpbmc7CiAgY2FsZW5kYXJBcHBOYW1lOiBzdHJyaW5nIHwgbnVtYmVyID0gSGV4LAo+ID0gewogIFtjaGFpbklkIGluIGlkXTogY2FwYX0KICB9CiAgc2VuZENhbGxzOiB7CiAgICBSZXF1ZXN0OiB7CiAgICAgIHBheW1hc3RlblR5cGU6IHsKICAgICAgdW5zdGFibGVfc2lnbkluV2l0aEV0aGVyZXVtPzoKICAgIG0gJy4vdXRpbHMuanMnCgpleHBvcnQgdHlwZSBDYXBhYmlsaXRpZXNTY2hlbWEgPSBSY2NvdW50UGFyYW1ldGVycywKICBBZGRTdWJBY2NvdW50UmV0dXJuVHlwZSwKfSBmcm8gICAgIEJ1ZmZlci5mcm9tKGF3YWl0IG9wZW5ncmFwaEltYWdlUmVzLmFycmF5QnVmZiAgICBdKQoKICAgIC8vIENvbXBhcmUgcmVzcG9uc2UgY29udGVudCB3aXRoIGFjdHVhc2l0ZW1hcFJlcywKICAgIF0gPSBhd2FpdCBQcm9taXNlLmFsbChbCiAgICAgIG5leHQgICAgIm5hbWUiOiAidHdpdHRlcjppbWFnZTpoZWlnaHQiLAogIi9tYW5pZmVzdC5qc29uIiwKICAgICAgICAgICAicmVsIjogIm1hbmlmZXN0IiwKICBoYXZlIGNvcnJlY3QgbGluayB0YWdzIGZvciBwYXJhbGxlbCBzbG90IHBhZ2UnLCBhc2ZpbGVzIGFyZSBzdXBwb3J0ZWQgaW4gZHluYW1pYyByb3V0ZXMgZm9yIENhY2hlIENvIHsKICBpZiAocHJvY2Vzcy5lbnYuX19ORVhUX0NBQ0hFX0NPTVBPTkVOVFMpIHsKIHQ8Y2hhaW4gZXh0ZW5kcyBDaGFpbiB8IHVuZGVmaW5lZD4oCiAgY2xpZW50OiBDbGllICogICBjaGFpbjogbWFpbm5ldCwKICogICB0cmFuc3BvcnQ6IGh0dHAoKSwKICogfSlFcnJvclR5cGUKCi8qKgogKiBSZXR1cm5zIHRoZSB2YWx1ZSBmcm9tIGEgc3RvcmFnZWV0ZXJzID0gewogIGFkZHJlc3M6IEFkZHJlc3MKICBzbG90OiBIZXgKfSAmICgKICB8ZSB7IENsaWVudCB9IGZyb20gJy4uLy4uL2NsaWVudHMvY3JlYXRlQ2xpZW50LmpzJwouQ2FsbEV4cHJlc3Npb24KICAgICAgfCB0c01vZHVsZS5JZGVudGlmaWVyCiAgKSB7CiAgIG1lc3NhZ2VUZXh0OiBgVGhlICJ1c2Ugc2VydmVyIiBmaWxlIGNhbiBvbmx5IGV4ICAgIHRzLmlzRnVuY3Rpb25FeHByZXNzaW9uKGluaXRpYWxpemVyKSB8fAogICAgdWxlLlNvdXJjZUZpbGUsCiAgICBub2RlOiB0c01vZHVsZS5WYXJpYWJsZVN0YXRlbWUgICBjb2RlOiBORVhUX1RTX0VSUk9SUy5JTlZBTElEX1NFUlZFUl9FTlRSWV9SRVRVUmFudGljRGlhZ25vc3RpY3NGb3JFeHBvcnREZWNsYXJhdGlvbigKICAgIHNvdXJjZTogCiAgKQoKICBsZXQgaXNQcm9taXNlID0gdHJ1ZQogIGlmIChzaWduYXR1cmVzLmxlbmdjdGlvblJldHVybmluZ1Byb21pc2UoCiAgbm9kZTogdHNNb2R1bGUuTm9kZSwKICB0eWlkZXMgaW50ZWxsaXNlbnNlIGZvciBhbGwgZXhwb3J0cyBmcm9tIGAidXNlIHNlcnZlb25zdCBhZnRlckZlZXNVU0QgPSBCaWdOdW1iZXIoZGVzdFRva2VuUHJpY2VVc2QpCiBtb3VudCkuZGl2aWRlZEJ5KDEwICoqIGRlc3REZWNpbWFscykpCiAgICAgIC50b1N0bHRzLm9yZGVyVG9TaWduLmtpbmQgPT09IE9yZGVyS2luZC5TRUxMCiAgICAgICAgPyBkZXI6IFN3YXBQcm92aWRlci5DT1dfUFJPVE9DT0wsCiAgICAgIG9yZGVyOiBvcmRlZXN1bHRzLmFtb3VudHNBbmRDb3N0cy5hZnRlclBhcnRuZXJGZWVzLnNlbGxBbW91bmluZygpOwogICAgY29uc3QgZGVzdFNwb3RBbW91bnQgPQogICAgICBzaWRlID09PSAnZWQgYnkgQ29XIGZvciBwb3RlbnRpYWwgcmVpbWJ1cnNtZW50cwogICAgaWYgKGNoYWl1eSBhbW91bnQgZm91bmQnKSwKICAgICAgVHhBY3Rpb24uTUFJTl9BQ1RJT04sCiAgIGhyb3cgZXJyb3I7CiAgfQoKICBpZiAoIW9yZGVyQm9va1F1b3RlLnF1b3RlUmVzdWx0IH0KICB9IGNhdGNoIChlcnJvcikgewogICAgY29uc29sZS5lcnJvcignZ2VuZXJhdGVhaW5JZCwgc3JjVG9rZW5XcmFwcGVkLCBpc0lucHV0VG9rZW5DdXN0b20gPz8gZmFscy8vIFByaWNlIFF1YWxpdHkgaXMgc2V0IHRvIE9QVElNQUwgYnkgZGVmYXVsdAogICBnKGNoYWluSWQgYXMgdW5rbm93biBhcyBDaGFpbklkKS5pc1Rlc3RuZXQgJiYKICAgIHMgbmF0aXZlLCB3ZSBuZWVkIHRvIHVzZSB0aGUgd3JhcHBlZCB0b2tlbiBmb3IgdGhldmlkZXJSYXRlc1BhcmFtcyk6IFByb21pc2U8Q293UHJvdG9jb2xSYXRlc1R5cGU+IHtmaW5lZDsKICB9Cn07CgpleHBvcnQgYXN5bmMgZnVuY3Rpb24gZ2V0Q293UHJvdG9jbyAoCiAgY2hhaW5JZDogbnVtYmVyLAogIHRva2VuQWRkcmVzczogc3RyaW5nLAogIGlzbmZpZyB9IGZyb20gJ3NyYy91dGlscy9tYXJrZXRzQW5kTmV0d29ya3NDb25maWcnOwp7IGRyYXcgfQp9CmltcG9ydCB7IENoYWluSWQgfSBmcm9tICdAYWF2ZS9jb250cmFjdCkgPT4gdGlja1NjYWxlKGQudGljaz8udG9TdHJpbmcoKSA/PyAnJykgfHwgMCkKICAgZGF0YShsaXF1aWRpdHlEYXRhLCAoZCkgPT4gZC5wcmljZTApCgogICAgYmFycwogICBudGFpbiBjb25zaXN0ZW50IGJhciBzY2FsaW5nCiAgICAvLyBUaGlzIHByZXZlbnRzIGlvbnMgfSA9IGdldFN0YXRlKCkgLy8gR2V0IGRpbWVuc2lvbnMgZnJvbSBzdGF0ZQoKaGFydC9zdG9yZS90eXBlcycKaW1wb3J0IHsKICBnZXRDb2xvckZvclByaWNlLAogIGd0ZUNoYW5nZV0pOwoKICByZXR1cm4geyBmb3JtLCBoYW5kbGVTdWJtaXQgfTsKfTsKaXRzLWV4cGVjdC1lcnJvciBFbGVtZW50IGltcGxpY2l0bHkgaGFzIGFueSB0eXBlCiAgeXBlLmlkLAogICAgICBiZWZvcmVFdmVudEJ1ZmZlciwKICAgICAgYWZ0ZXJFdmVudHVsaW5nLCAuLi5yZXN0IH0gPSBpbnB1dDsKICAgIGNvbnN0IHBheWxvYWQgPSB7CiAgLy8gUHJldmVudCB0d28gcGF5bWVudCBhcHBzIHRvIGJlIGVuYWJsZWQKICAgIC8/LmJvb2tlckxheW91dHMgfHwgbnVsbCk7CiAgICBpZiAobGF5b3V0RXJyb3IpIHRocl9zZWF0c19lcnJvciIpKTsKICAgIH0KCiAgICBpZiAoYm9va2luZ0xpbWl0cykgewogbmd0aCAmJiAhTnVtYmVyKGxlbmd0aCkpIHRocm93IG5ldyBFcnJvcih0KCJldmVudF8gbG9jYXRpb25zLAogICAgICBtZXRhZGF0YSwKICAgICAgY3VzdG9tSW5wdXRzLAogIEV4aXN0cyA9IE9iamVjdC5rZXlzKGRpcnR5VmFsdWVzKS5sZW5ndGggIT09IDA7CiAgbi10cy1jb21tZW50CiAgICAgIC8vIEB0cy1pZ25vcmUKICAgICAgdXBkYXRlZEZpZWwgICB9IGVsc2UgaWYgKGVsZW1lbnQgPT09IHRydWUpIHsKICAgICAgICAgICAgcmV0dWUpKSB7CiAgICAgICAgZm9yIChjb25zdCBlbGVtZW50IG9mIGZpZWxkVmFsdWUpIHsKICAvLyBDaGVjayBpZiB0aGUgZmllbGQgaXMgYW4gb2JqZWN0IG9yIGFuIGFycmF5CiBLZXkgY291bGQgYmUgYW55IGRlZXBseSBuZXN0ZWQgZmllbGRzIHRoYW5rcyB0byByZSAgIGxldCBjdXJyZW50ID0gb2JqOwoKICAgIGZvciAobGV0IGkgPSAwOyBpIDwga2V5LAogIH0gPSBmb3JtOwoKICAvLyBXYXRjaCBhbGwgZm9ybSB2YWx1ZXMgdG8gdHJpZ2dhYmxlUmVjb3JkaW5nRm9yR3Vlc3RzOiB6LmJvb2xlYW4oKS5udWxsYWJsZSgpLAogICAgICBsZW5ndGg6IHoudW5pb24oW3ouc3RyaW5nKCkudHJhbnNmb3JtKCh2YWwpID0+ICAvLyBNYWtlIGl0IG9wdGlvbmFsIGJlY2F1c2UgaXQncyBub3Qgc3VibWl0dGVkIGZvbnN0IGZvcm0gPSB1c2VGb3JtPEZvcm1WYWx1ZXM+KHsKICAgIGRlZmF1bHRWYWx1ZVR5cGUuaW5jbHVkZU5vU2hvd0luUlJDYWxjdWxhdGlvbiwKICAgICAgdXNlRXZlbnRMZUNhbGxDb25maWc/LmJlZ2luTWVzc2FnZSA/PyBERUZBVUxUX0JFR0lOX01FU1NBR0V1bGVXaXRoU2FtZVJvdW5kUm9iaW5Ib3N0LAogICAgICBhc3NpZ25BbGxUZWFtTWVtYiAgIC5maW5kKChtZW0pID0+IG1lbS51c2VyLmlkID09PSBjaC5vd25lci5pZCkKICAgeXBlLnN1Y2Nlc3NSZWRpcmVjdFVybCB8fCAiIiwKICAgICAgZm9yd2FyZFBhcmFtc1N1bGluZ1Bhc3RCb29raW5ncywKICAgICAgaGlkZU9yZ2FuaXplckVtYWlsOiBldmV5cGUuc2NoZWR1bGluZ1R5cGUsCiAgICAgIHJlcXVpcmVzQ29uZmlybWF0aW9uOiBldmF0ZXMuc3RhcnREYXRlLAogICAgICAgIGVuZERhdGU6IHBlcmlvZERhdGVzLmVuZERheVNob3dGaXJzdEF2YWlsYWJsZVNsb3QgfHwgdW5kZWZpbmVkLAogICAgICBkdXJhdGllLmlzSW5zdGFudEV2ZW50LAogICAgICBpbnN0YW50TWVldGluZ1BhcmFtZXRlcnM6IHRUeXBlLnNlYXRzUGVyVGltZVNsb3QsCiAgICAgIHNlYXRzU2hvd0F0dGVuZGVlczogICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25ybVN0YXRlOiB7CiAgICBpc0RpcnR5OiBib29sZWFuOwogICAgZGlydHlGaWVsZHM6IHJlcy9ldmVudHR5cGVzL2xpYi90eXBlcyI7CmltcG9ydCB7IHVzZUxvY2FsZSB9IGZyb20vYXBwLXN0b3JlL191dGlscy9wYXltZW50cy9jaGVja0Zvck11bHRpcGxlUGF5bWVwczovL25leHRqcy5vcmcvZG9jcy9tZXNzYWdlcy9ibG9ja2luZy1yb3V0ZScKICAgLAogIC8vIGFuZCBwYWNrYWdlcyBtYXJrZWQgYXMgZXh0ZXJuYWwgYXJlbid0IGJ1bmQgdGVzdHMgdGhlIGJlaGF2aW9yIG9mIG1pZGRsZXdhcmUgYnkgcmVuZGVyaW5nIGEgcHRoZW4oKHJlcykgPT4gcmVzLnRleHQoKSkKICAgICAgZXhwZWN0KHJlc3VsdCkudG9Cb25zdCByZXN1bHQgPSBhd2FpdCBuZXh0CiAgICAgICAgLmZldGNoKCcvaW5zaXZlbC1hd2FpdCwgc28gd2UncmUgb25seSB0ZXN0aW5nIHN5bmMgbW9kdWxlcwogICAgICAgZGVzY3JpYmUoJ2R5bmFtaWMgaW1wb3J0IGluIG5vZGVfbW9kdWxlcycsICgpID0vIHdlIHNob3VsZG4ndCBnZXQgYW55IGVycm9ycyBmcm9tIGBzcGF3bkR5bmFtaWNWYX0pCiAgfQoKICBjb25zdCB0ZXN0UGFnZSA9IGFzeW5jIChocmVmOiBzdHJpbmcpID0+ICAgIi9pbnNpZGUtcmVuZGVyL3JvdXRlLWhhbmRsZXIvYXN5bmMtbW9kdWxlIiwKICBucyBpdCBtdXN0IGJlIGEgR0VUIHJvdXRlIGhhbmRsZXIsIG5vdCBhIHBhZ2UKICAgIHNOZXh0RGV2IH0gPSBuZXh0VGVzdFNldHVwKHsKICAgIGZpbGVzOiBwYXRoLmpvaW4oaXRGb3JOb1JlZGJveCwgcmV0cnkgfSBmcm9tICduZXh0LXRlc3QtdXRpbHMnCgpkZXNJbnB1dFNjaGVtYTsKICB1c2VyOiBQYXJ0aWFsPE9taXQ8Tm9uTnVsbGFibGU8VHJwYyAgICApLnJlamVjdHMudG9UaHJvdygiVXNlciBkb2VzIG5vdCBoYXZlIHBlcm1kOiAxMDMsIC8vIFRlYW0gbWVtYmVyIElECiAgICBhaWw6IGJvb2tlci5lbWFpbCwKICAgICAgICAgICAgICAgICAgbG9jYWxlOiAiaGkiLCAgIHNsdWc6IGV2ZW50VHlwZVNsdWcsCiAgICAgICAgICAgICAgc2xvdEludGVydmFsVWlkID0gIk1PQ0tFRF9CT09LSU5HX1VJRF9NRU1CRVIiOwogICAgICBjb25zdCBldmVtZTogIlRlYW0gTWVtYmVyIiwKICAgICAgICBlbWFpbDogInRlYW0tbWVtYmVyQGV4ICAgIGFjY2VwdGVkOiB0cnVlLAogICAgICAgICAgICAgIHJvbGU6ICJNRU1CRVIiLAplZHVsZSBmcm9tIHRlYW0gbWVtYmVyIHdpdGhvdXQgcHJvcGVyIHBlcm1pc3Npb25zYCBib29rTmV3VGltZVBhdGg6ICIvdGVhbS90ZWFtLTEvZXZlbnQtdHlwZS0xIiwKICAgdXNlcnNBcGFydEZyb21Pcmdhbml6ZXI6IFt0ZWFtQWRtaW5dLAogICAgICAgbWVldGluZ1Bhc3N3b3JkOiAiTU9DS19QQVNTV09SRCIsCiAgfVQwNToxNTowMC4wMDBaYCwKICAgICAgICAgICAgICByZWZlcmVuY2VzOiBbClRyaWdnZXJzOiBbIkJPT0tJTkdfQ1JFQVRFRCJdLAogICAgICAgICAgICAgIHN1YnNjIHNlbGVjdGVkQ2FsZW5kYXJzOiBbXSwKICAgICAgfTsKCiAgICAgIGNvbnN0IHsgZGEgICAgaWQ6IDEwMiwKICAgICAgICB1c2VybmFtZTogInRlYW0tYWRtaW4iLAogZXMuSXN0V29ya0hvdXJzXSwKICAgICAgICBjcmVkZW50aWFsczogW2dldEdvb2dsZUN3YWl0IGltcG9ydCgKICAgICAgICAiQGNhbGNvbS90cnBjL3NlcnZlci9yb3V0ZXJzLyAgICAgYm9va2luZ1VpZCwKICAgICAgICAgICAgcmVzY2hlZHVsZVJlYXNvbjogIiIscHBzWyJnb29nbGUtY2FsZW5kYXIiXSwgVGVzdERhdGEuYXBwc1siZGFpbHktdmlkZW8gICAgIHRpbWVab25lOiAiQXNpYS9Lb2xrYXRhIiwKICAgICAgIHVzZXJJZDogMTAxLAogICAgICAgICAgICAgIHN0YXR1czogQm9va2luZ1N0YSAgICAgZ2V0U2NlbmFyaW9EYXRhKHsKICAgICAgICAgIHdlYmhvb2tzOiBbCiAgICByaW5nOiBwbHVzMURhdGVTdHJpbmcgfSA9IGdldERhdGUoeyBkYXRlSW5jcmVtZW50OmVkdWxlLmhhbmRsZXIiCiAgICAgICk7CiAgICAgIGNvbnN0IGJvb2tlciA9IGdldEJvKTsKICAgIH0pOwogIH0pOwoKICBkZXNjcmliZSgiVGVhbSBFdmVudCBCb29raW5nIixvbnN0IGxvZ2dlZEluVXNlciA9IHsKICAgICAgICBvcmdhbml6YXRpb25JZDogbm9jYWxlIHdoZW4gdGhlIGZyZXNoIGJvb2tpbmcgaGFwcGVuZWQgZWFybGllcgogICAgICAgIHN0YXJ0VGltZTogYCR7cGx1czFEYXRlU3RyaW5nfVQwNTowMDowMC4wMDBaYCwgICAgZXZlbnRUeXBlSWQ6IDEsCiAgICAgICAgICAgICAgYXBwSWQ6IG51bGwsCiAgIGV0Qm9va2VyKHsKICAgICAgICBlbWFpbDogImJvb2tlckBleGFtcGxlLmNvbSIsCiAgdG8gYm90aCBhdHRlbmRlZSBhbmQgdGhlIHBlcnNvbiByZXF1ZXN0aW5nIHRoZSByZXNvbS9wcmlzbWEvZW51bXMiOwppbXBvcnQgdHlwZSB7IFRSZXF1ZXN0UmVzY2hlZHVsZWdsZUNhbGVuZGFyQ3JlZGVudGlhbCwKICBUZXN0RGF0YSwKICBnZXRPcmdhbml6ZXIsfSwKICB9KSwKKQppbXBvcnQgeyBnZXRTYW1wbGVVc2VySW5TZXNzaW9uIH0gZnIgICAgIHByb3ZpZGVyOiAnbG9jYWwnLAogICAgICAgIG9wdGlvbnM6IHsKICAgICAgXSwKICAgICAgb3V0bGluZTogWzIsIDNdLAogICAgICBzZWFyY2g6IHsKICAgICAgIHsgdGV4dDogJ0NvcmUnLCBsaW5rOiAnL2NvcmUvZ2V0dGluZy1zdGFydGVkJyB1bmRlciB0aGUgPGEgaHJlZj0iaHR0cHM6Ly9naXRodWIuY29tL3dldm0vd2FnbWkvCiAgICBdLAogICAgaWdub3JlRGVhZExpbmtzOiBmYWxzZSwKICAgIGxhbmc6ICdlbi1wczovL3dhZ21pLnNoL29nLnBuZycgfV0sCiAgICAgIFsnbWV0YScsIHsgcHJvcGVydGUgPSBjcmVhdGVUd29zbGFzaFdpdGhJbmxpbmVDYWNoZSgpCgovLyBodHRwczovL3ZpYXBlZExpbmVzID0gbGluZXMubWFwKChsaW5lKSA9PgogICAgbGluZS5yZXBsYWNlKC8gICB9CiAgICApCiAgfSkKfSkKCmZ1bmN0aW9uIGV4cGVjdExpbmVzVG9BcHBlYXJUbyAgLy8gdGhlIHN0YWNrIHRyYWNlIGlzIGRpZmZlcmVudCBiZXR3ZWVuIHR1cmJvcGFjICAgIGAiICB4IFJvdXRlIHNlZ21lbnQgY29uZmlnICJydW50aW1lIiBpcyBuICAgICAvLyB3ZSBleHBlY3QgdGhlIGJ1aWxkIHRvIGZhaWwKICAgICAgICB9CgogICBwZWN0KG5leHQuY2xpT3V0cHV0KS50b0NvbnRhaW4oJy4vYXBwL3JldmFsaWRhdGUvcCBpcyBub3QgY29tcGF0aWJsZSB3aXRoIGBuZXh0Q29uZmlnLmNhY2hlQ29tcG9uZW50cGVjdChyZWRib3guZGVzY3JpcHRpb24pLnRvTWF0Y2hJbmxpbmVTbmFwc2hvdCgKICAKICAgIHRyeSB7CiAgICAgIGF3YWl0IG5leHQuc3RhcnQoKQogICAgfSBjYXRjaCB7CiAgICBza2lwRGVwbG95bWVudDogdHJ1ZSwKICB9KQoKICBpZiAoc2tpcHBlZCkgewogaXRvcnk6IGJvb2tpbmdSZXBvc2l0b3J5TW9kdWxlTG9hZGVyLAogICAgbHVja3lVc2VlIHJlcG9zaXRvcmllcyBhcyBkZXBlbmRlbmNpZXMuCiAgICBwcmlzbWFDbGllbnQ6IHVyZXMvaGFzaGVkTGluay9kaS9IYXNoZWRMaW5rU2VydmljZS5tb2R1bGUiOwoKaW1wcnQgeyBtb2R1bGVMb2FkZXIgYXMgY2hlY2tCb29raW5nQW5kRHVyYXRpb25MaW1pdHNvbS9mZWF0dXJlcy9ib29raW5ncy9kaS9Cb29raW5nRXZlbnRIYW5kbGVyU2VydmljZWVVUkwsICJjb25mZXJlbmNpbmciLCB1c2VRdWVyeVBhcmFtKSwKICAgICAgaWNvbjogdG9tYXRpb24iLAogICAgfSwKICAgIHsKICAgICAgbmFtZTogImNhbGVuZGFyIiwKICBlc3RpZCI6IHN0cmluZzsKfTsKCmNvbnN0IGdldEFwcENhdGVnb3JpZXMgPSAoYmFzZSB7IFdFQkFQUF9VUkwgfSBmcm9tICJAY2FsY29tL2xpYi9jb25zdGFudHMiOwppbXBvICAgICdhcHBsaWNhdGlvbi9wZGYnCiAgIG1nT3B0U2tpcE1ldGFkYXRhKSkudG9CZSgKICAgICAgICAnaW1hZ2UvanAyJwogICBtYWdlL3gtaWNucycKICAgICAgKQogICAgfSkgICAgJ1x0PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZWlwTWV0YWRhdGEpKS50b0JlKAogICAgICAgICdpbWFnZS9zdmcreG1sJwogICAgICApICAgICBjb25zdCBidWZmZXIgPSBhd2FpdCBnZXRJbWFnZSgnLi9pbWFnZXMvdGVzdC4gICAgIGV4cGVjdChhd2FpdCBkZXRlY3RDb250ZW50VHlwZShidWZmZXIsIGltZ09wdCAgIH0pCiAgICBpdCgnc2hvdWxkIHJldHVybiBqcGcnLCBhc3luYyAoKSA9PiB7CiAgKSA9PiByZWFkRmlsZShqb2luKF9fZGlybmFtZSwgZmlsZXBhdGgpKQoKZGVzY3JpYmVvciAmIHsKICBuYW1lOiAnU2l6ZU92ZXJmbG93RXJyb3InCn0KZXhwb3J0IGNsYXNzIHJvciB7CiAgY29uc3RydWN0b3IoaGV4OiBIZXgpIHsKICAgIHN1cGVyKAogICAgICBgcicgfSwKICAgICkKICB9Cn0KCmV4cG9ydCB0eXBlIEludmFsaWRCeXRlc0Jvb2xlYW4gJy4uL3R5cGVzL21pc2MuanMnCgppbXBvcnQgeyBCYXNlRXJyb3IgfSBmcm9tICcuLw==';

let cachedDictionary: Buffer | null = null;

export function getTypescriptDictionary(): Buffer {
  if (!cachedDictionary) {
    cachedDictionary = Buffer.from(DICTIONARY_BASE64, 'base64');
  }
  return cachedDictionary;
}

export const TYPESCRIPT_DICTIONARY_META: DictionaryMeta = {
  name: 'TypeScript Dictionary',
  version: '2.0.0',
  description: 'Trained ZSTD dictionary optimized for TypeScript code compression',
  frameworks: ["typescript"],
  sizeBytes: 200920,
  patternCount: 0, // Trained dictionary - patterns are internal
  trainedOn: ['sample typescript files'],
};
