/**
 * PAKK Trained ZSTD Dictionary for Vue/Nuxt
 *
 * This is a REAL trained ZSTD dictionary (not just text patterns).
 * Trained using: zstd --train on sample Vue/Nuxt files.
 *
 * Size: 52464 bytes
 * Generated: 2026-01-31T16:08:29.418Z
 */

import type { DictionaryMeta } from '../core/types.js';

// Base64-encoded trained ZSTD dictionary
const DICTIONARY_BASE64 = 'N6Qw7O1fBQRCEBh12xwAAAAAAAAAADA8MzMzMzMzM/O7ub8/kSJ6p/Qild2bS0zo17UjbADVV9UKr9+b9ZCew9ZWd5ftx7fMyKhwcwAACA4UjMcCorh8RGMPBADAEhwMKxgTDIaBSCCIcRQEQRAEMQyFMAxjkDGEKGQAQsYoBQD0lLXpVEwxphAyMiAiIAAAAAAAAAEAAAAEAAAACAAAACBlZmZlY3QgaW5zdGFuY2UKICAgKi8KICBlZmZlY3Q6IFJlYWN0aXZlRWZmZWN0CiAgLyoqCiAgICogRm9yY2UgdXBkYXRlIHJlbmRlciBlZmZlY3QKICAgKi8KICB1cGRhdGU6ICgpID0+IHZvaWQKICAvKioKICAgKiBSZW5kZXIgZWZmZWN0IGpvYiB0byBiZSBwYXNzZWQgdG8gc2NoZWR1bGVyIChjaGVja3MgaWYgZGlydHkpCiAgICovCiAgam9iOiBTY2hlZHVsZXJKb2IKICAvKioKICAgKiBUaGUgcmVuZGVyIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB2ZG9tIHRyZWUuCiAgICogQGludGVybmFsCiAgICovCiAgcmVuZGVyOiBJbnRlcm5hbFJlbmRlckZ1bmN0aW9uIHwgbnVsbAogIC8qKgogICAqIFNTUiByZW5kZXIgZnVuY3Rpb24KICAgKiBAaW50ZXJuYWwKICAgKi8KICBzc3JSZW5kZXI/OiBGdW5jdGlvbiB8IG51bGwKICAvKioKICAgKiBPYmplY3QgY29udGFpbmluZyB2YWx1ZXMgdGhpcyBjb21wb25lbnQgcHJvdmlkZXMgZm9yIGl0cyBkZXNjZW5kYW50cwogICAqIEBpbnRlcm5hbAogICAqLwogIHByb3ZpZGVzOiBEYXRhCiAgLyoqCiAgICogZm9yIHRyYWNraW5nIHVzZUlkKCkKICAgKiBmaXJzdCBlbGVtZW50IGlzIHRoZSBjdXJyZW50IGJvdW5kYXJ5IHByZWZpeAogICAqIHNlY29uZCBudW1iZXIgaXMgdGhlIGluZGV4IG9mIHRoZSB1c2VJZCBjYWxsIHdpdGhpbiB0aGF0IGJvdW5kYXJ5CiAgICogQGludGVybmFsCiAgICovCiAgaWRzOiBbc3RyaW5nLCBudW1iZXIsIG51bWJlcl0KICAvKioKICAgKiBUcmFja2luZyByZWFjdGl2ZSBlZmZlY3RzIChlLmcuIHdhdGNoZXJzKSBhc3NvY2lhdGVkIHdpdGggdGhpcyBjb21wb25lbnQKICAgKiBzbyB0aGF0IHRoZXkgY2FuIGJlIGF1dG9tYXRpY2FsbHkgc3RvcHBlZCBvbiBjb21wb25lbnQgdW5tb3VudAogICAqIEBpbnRlcm5hbAogICAqLwogIHNjb3BlOiBFZmZlY3RTY29wZQogIC8qKgogICAqIGNhY2hlIGZvciBwcm94eSBhY2Nlc3MgdHlwZSB0byBhdm9pZCBoYXNPd25Qcm9wZXJ0eSBjYWxscwogICAqIEBpbnRlcm5hbAogICAqLwogIGFjY2Vzc0NhY2hlOiBEYXRhIHwgbnVsbAogIC8qKgogICAqIGNhY2hlIGZvciByZW5kZXIgZnVuY3Rpb24gdmFsdWVzIHRoYXQgcmVseSBvbiBfY3R4IGJ1dCB3b24ndCBuZWVkIHVwZGF0ZXMKICAgKiBhZnRlciBpbml0aWFsaXplZCAoZS5nLiBpbmxpbmUgaGFuZGxlcnMpCiAgICogQGludGVybmFsCiAgICovCiAgcmVuZGVyQ2FjaGU6IChGdW5jdGlvbiB8IFZOb2RlIHwgdW5kZWZpbmVkKVtdCgogIC8qKgogICAqIFJlc29sdmVkIGNvbXBvbmVudCByZWdpc3RyeSwgb25seSBmb3IgY29tcG9uZW50cyB3aXRoIG1peGlucyBvciBleHRlbmRzCiAgICogQGludGVybmFsCiAgICovCiAgY29tcG9uZW50czogUmVjb3JkPHN0cmluZywgQ29uY3JldGVDb21wb25lbnQ+IHwgbnVsbAogIC8qKgogICAqIFJlc29sdmVkIGRpcmVjdGl2ZSByZWdpc3RyeSwgb25seSBmb3IgY29tcG9uZW50cyB3aXRoIG1peGlucyBvciBleHRlbmRzCiAgICogQGludGVybmFsCiAgICovCiAgZGlyZWN0aXZlczogUmVjb3JkPHN0cmluZywgRGlyZWN0aXZlPiB8IG51bGwKICAvKioKICAgKiBSZXNvbHZlZCBmaWx0ZXJzIHJlZ2lzdHJ5LCB2MiBjb21wYXQgb25seQogICAqIEBpbnRlcm5hbAogICAqLwogIGZpbHRlcnM/OiBSZWNvcmQ8c3RyaW5nLCBGdW5jdGlvbj4KICAvKioKICAgKiByZXNvbHZlZCBwcm9wcyBvcHRpb25zCiAgICogQGludGVybmFsCiAgICovCiAgcHJvcHNPcHRpb25zOiBOb3JtYWxpemVkUHJvcHNPcHRpb25zCiAgLyoqCiAgICogcmVzb2x2ZWQgZW1pdHMgb3B0aW9ucwogICAqIEBpbnRlcm5hbAogICAqLwogIGVtaXRzT3B0aW9uczogT2JqZWN0RW1pdHNPcHRpb25zIHwgbnVsbAogIC8qKgogICAqIHJlc29sdmVkIGluaGVyaXRBdHRycyBvcHRpb25zCiAgICogQGludGVybmFsCiAgICovCiAgaW5oZXJpdEF0dHJzPzogYm9vbGVhbgogIC8qKgogICAqIEN1c3RvbSBFbGVtZW50IGluc3RhbmNlIChpZiBjb21wb25lbnQgaXMgYyB7IFJhd1N5bWJvbCwgUmVmLCBVbndyYXBSZWZTaW1wbGUgfSBmcm9tICcuL3JlZicKaW1wb3J0IHsgUmVhY3RpdmVGbGFncyB9IGZyb20gJy4vY29uc3RhbnRzJwppbXBvcnQgeyB3YXJuIH0gZnJvbSAnLi93YXJuaW5nJwoKZXhwb3J0IGludGVyZmFjZSBUYXJnZXQgewogIFtSZWFjdGl2ZUZsYWdzLlNLSVBdPzogYm9vbGVhbgogIFtSZWFjdGl2ZUZsYWdzLklTX1JFQUNUSVZFXT86IGJvb2xlYW4KICBbUmVhY3RpdmVGbGFncy5JU19SRUFET05MWV0/OiBib29sZWFuCiAgW1JlYWN0aXZlRmxhZ3MuSVNfU0hBTExPV10/OiBib29sZWFuCiAgW1JlYWN0aXZlRmxhZ3MuUkFXXT86IGFueQp9CgpleHBvcnQgY29uc3QgcmVhY3RpdmVNYXA6IFdlYWtNYXA8VGFyZ2V0LCBhbnk+ID0gbmV3IFdlYWtNYXA8VGFyZ2V0LCBhbnk+KCkKZXhwb3J0IGNvbnN0IHNoYWxsb3dSZWFjdGl2ZU1hcDogV2Vha01hcDxUYXJnZXQsIGFueT4gPSBuZXcgV2Vha01hcDwKICBUYXJnZXQsCiAgYW55Cj4oKQpleHBvcnQgY29uc3QgcmVhZG9ubHlNYXA6IFdlYWtNYXA8VGFyZ2V0LCBhbnk+ID0gbmV3IFdlYWtNYXA8VGFyZ2V0LCBhbnk+KCkKZXhwb3J0IGNvbnN0IHNoYWxsb3dSZWFkb25seU1hcDogV2Vha01hcDxUYXJnZXQsIGFueT4gPSBuZXcgV2Vha01hcDwKICBUYXJnZXQsCiAgYW55Cj4oKQoKZW51bSBUYXJnZXRUeXBlIHsKICBJTlZBTElEID0gMCwKICBDT01NT04gPSAxLAogIENPTExFQ1RJT04gPSAyLAp9CgpmdW5jdGlvbiB0YXJnZXRUeXBlTWFwKHJhd1R5cGU6IHN0cmluZykgewogIHN3aXRjaCAocmF3VHlwZSkgewogICAgY2FzZSAnT2JqZWN0JzoKICAgIGNhc2UgJ0FycmF5JzoKICAgICAgcmV0dXJuIFRhcmdldFR5cGUuQ09NTU9OCiAgICBjYXNlICdNYXAnOgogICAgY2FzZSAnU2V0JzoKICAgIGNhc2UgJ1dlYWtNYXAnOgogICAgY2FzZSAnV2Vha1NldCc6CiAgICAgIHJldHVybiBUYXJnZXRUeXBlLkNPTExFQ1RJT04KICAgIGRlZmF1bHQ6CiAgICAgIHJldHVybiBUYXJnZXRUeXBlLklOVkFMSUQKICB9Cn0KCmZ1bmN0aW9uIGdldFRhcmdldFR5cGUodmFsdWU6IFRhcmdldCkgewogIHJldHVybiB2YWx1ZVtSZWFjdGl2ZUZsYWdzLlNLSVBdIHx8ICFPYmplY3QuaXNFeHRlbnNpYmxlKHZhbHVlKQogICAgPyBUYXJnZXRUeXBlLklOVkFMSUQKICAgIDogdGFyZ2V0VHlwZU1hcCh0b1Jhd1R5cGUodmFsdWUpKQp9CgovLyBvbmx5IHVud3JhcCBuZXN0ZWQgcmVmCmV4cG9ydCB0eXBlIFVud3JhcE5lc3RlZFJlZnM8VD4gPSBUIGV4dGVuZHMgUmVmID8gVCA6IFVud3JhcFJlZlNpbXBsZTxUPgoKZGVjbGFyZSBjb25zdCBSZWFjdGl2ZU1hcmtlclN5bWJvbDogdW5pcXVlIHN5bWJvbAoKZXhwb3J0IGludGVyZmFjZSBSZWFjdGl2ZU1hcmtlciB7CiAgW1JlYWN0aXZlTWFya2VyU3ltYm9sXT86IHZvaWQKfQoKZXhwb3J0IHR5cGUgUmVhY3RpdmU8VD4gPSBVbndyYXBOZXN0ZWRSZWZzPFQ+ICYKICAoVCBleHRlbmRzIHJlYWRvbmx5IGFueVtdID8gUmVhY3RpdmVNYXJrZXIgOiB7fSkKCi8qKgogKiBSZXR1cm5zIGEgcmVhY3RpdmUgcHJveHkgb2YgdGhlIG9iamVjdC4KICoKICogVGhlIHJlYWN0aXZlIGNvbnZlcnNpb24gaXMgImRlZXAiOiBpdCBhZmZlY3RzIGFsbCBuZXN0ZWQgcHJvcGVydGllcy4gQQogKiByZWFjdGl2ZSBvYmplY3QgYWxzbyBkZWVwbHkgdW53cmFwcyBhbnkgcHJvcGVydGllcyB0aGF0IGFyZSByZWZzIHdoaWxlCiAqIG1haW50YWluaW5nIHJlYWN0aXZpdHkuCiAqCiAqIEBleGFtcGxlCiAqIGBgYGpzCiAqIGNvbnN0IG9iaiA9IHJlYWN0aXZlKHsgY291bnQ6IDAgfSkKICogYGBgCiAqCiAqIEBwYXJhbSB0YXJnZXQgLSBUaGUgc291cmNlIG9iamVjdC4KICogQHNlZSB7QGxpbmsgaHR0cHM6Ly92dWVqcy5vcmcvYXBpL3JlYWN0aXZpdHktY29yZS5odG1sI3JlYWN0aXZlfQogKi8KZXhwb3J0IGZ1bmN0aW9uIHJlYWN0aXZlPFQgZXh0ZW5kcyBvYmplY3Q+KHRhcmdldDogVCk6IFJlYWN0aXZlPFQ+Ci8qQF9fTnJvcGVydGllcyAodmlhIGB0aGlzLnggPSAuLi5gKQogICAqIEBpbnRlcm5hbAogICAqLwogIGN0eDogRGF0YQoKICAvLyBzdGF0ZQogIGRhdGE6IERhdGEKICBwcm9wczogRGF0YQogIGF0dHJzOiBEYXRhCiAgc2xvdHM6IEludGVybmFsU2xvdHMKICByZWZzOiBEYXRhCiAgZW1pdDogRW1pdEZuCgogIC8qKgogICAqIHVzZWQgZm9yIGtlZXBpbmcgdHJhY2sgb2YgLm9uY2UgZXZlbnQgaGFuZGxlcnMgb24gY29tcG9uZW50cwogICAqIEBpbnRlcm5hbAogICAqLwogIGVtaXR0ZWQ6IFJlY29yZDxzdHJpbmcsIGJvb2xlYW4+IHwgbnVsbAogIC8qKgogICAqIHVzZWQgZm9yIGNhY2hpbmcgdGhlIHZhbHVlIHJldHVybmVkIGZyb20gcHJvcHMgZGVmYXVsdCBmYWN0b3J5IGZ1bmN0aW9ucyB0bwogICAqIGF2b2lkIHVubmVjZXNzYXJ5IHdhdGNoZXIgdHJpZ2dlcgogICAqIEBpbnRlcm5hbAogICAqLwogIHByb3BzRGVmYXVsdHM6IERhdGEKICAvKioKICAgKiBzZXR1cCByZWxhdGVkCiAgICogQGludGVybmFsCiAgICovCiAgc2V0dXBTdGF0ZTogRGF0YQogIC8qKgogICAqIGRldnRvb2xzIGFjY2VzcyB0byBhZGRpdGlvbmFsIGluZm8KICAgKiBAaW50ZXJuYWwKICAgKi8KICBkZXZ0b29sc1Jhd1NldHVwU3RhdGU/OiBhbnkKICAvKioKICAgKiBAaW50ZXJuYWwKICAgKi8KICBzZXR1cENvbnRleHQ6IFNldHVwQ29udGV4dCB8IG51bGwKCiAgLyoqCiAgICogc3VzcGVuc2UgcmVsYXRlZAogICAqIEBpbnRlcm5hbAogICAqLwogIHN1c3BlbnNlOiBTdXNwZW5zZUJvdW5kYXJ5IHwgbnVsbAogIC8qKgogICAqIHN1c3BlbnNlIHBlbmRpbmcgYmF0Y2ggaWQKICAgKiBAaW50ZXJuYWwKICAgKi8KICBzdXNwZW5zZUlkOiBudW1iZXIKICAvKioKICAgKiBAaW50ZXJuYWwKICAgKi8KICBhc3luY0RlcDogUHJvbWlzZTxhbnk+IHwgbnVsbAogIC8qKgogICAqIEBpbnRlcm5hbAogICAqLwogIGFzeW5jUmVzb2x2ZWQ6IGJvb2xlYW4KCiAgLy8gbGlmZWN5Y2xlCiAgaXNNb3VudGVkOiBib29sZWFuCiAgaXNVbm1vdW50ZWQ6IGJvb2xlYW4KICBpc0RlYWN0aXZhdGVkOiBib29sZWFuCiAgLyoqCiAgICogQGludGVybmFsCiAgICovCiAgW0xpZmVjeWNsZUhvb2tzLkJFRk9SRV9DUkVBVEVdOiBMaWZlY3ljbGVIb29rCiAgLyoqCiAgICogQGludGVybmFsCiAgICovCiAgW0xpZmVjeWNsZUhvb2tzLkNSRUFURURdOiBMaWZlY3ljbGVIb29rCiAgLyoqCiAgICogQGludGVybmFsCiAgICovCiAgW0xpZmVjeWNsZUhvb2tzLkJFRk9SRV9NT1VOVF06IExpZmVjeWNsZUhvb2sKICAvKioKICAgKiBAaW50ZXJuYWwKICAgKi8KICBbTGlmZWN5Y2xlSG9va3MuTU9VTlRFRF06IExpZmVjeWNsZUhvb2sKICAvKioKICAgKiBAaW50ZXJuYWwKICAgKi8KICBbTGlmZWN5Y2xlSG9va3MuQkVGT1JFX1VQREFURV06IExpZmVjeWNsZUhvb2sKICAvKioKICAgKiBAaW50ZXJuYWwKICAgKi8KICBbTGlmZWN5Y2xlSG9va3MuVVBEQVRFRF06IExpZmVjeWNsZUhvb2sKICAvKioKICAgKiBAaW50ZXJuYWwKICAgKi8KICBbTGlmZWN5Y2xlSG9va3MuQkVGT1JFX1VOTU9VTlRdOiBMaWZlY3ljbGVIb29rCiAgLyoqCiAgICogQGludGVybmFsCiAgICovCiAgW0xpZmVjeWNsZUhvb2tzLlVOTU9VTlRFRF06IExpZmVjeWNsZUhvb2sKICAvKioKICAgKiBAaW50ZXJuYWwKICAgKi8KICBbTGlmZWN5Y2xlSG9va3MuUkVOREVSX1RSQUNLRURdOiBMaWZlY3ljbGVIb29rCiAgLyoqCiAgICogQGludGVybmFsCiAgICovCiAgW0xpZmVjeWNsZUhvb2tzLlJFTkRFUl9UUklHR0VSRURdOiBMaWZlY3ljbGVIb29rCiAgLyoqCiAgICogQGludGVybmFsCiAgICovCiAgW0xpZmVjeWNsZUhvb2tzLkFDVElWQVRFRF06IExpZmVjeWNsZUhvb2sKICAvKioKICAgKiBAaW50ZXJuYWwKICAgKi8KICBbTGlmZWN5Y2xlSG9va3MuREVBQ1RJVkFURURdOiBMaWZlY3ljbGVIb29rCiAgLyoqCiAgICogQGludGVybmFsCiAgICovCiAgW0xpZmVjeWNsZUhvb2tzLkVSUk9SX0NBUFRVUkVEXTogTCAgIG5lc3RlZDogewogKiAgICAgYmFyOiAyCiAqICAgfQogKiB9KQogKgogKiAvLyBtdXRhdGluZyBzdGF0ZSdzIG93biBwcm9wZXJ0aWVzIGlzIHJlYWN0aXZlCiAqIHN0YXRlLmZvbysrCiAqCiAqIC8vIC4uLmJ1dCBkb2VzIG5vdCBjb252ZXJ0IG5lc3RlZCBvYmplY3RzCiAqIGlzUmVhY3RpdmUoc3RhdGUubmVzdGVkKSAvLyBmYWxzZQogKgogKiAvLyBOT1QgcmVhY3RpdmUKICogc3RhdGUubmVzdGVkLmJhcisrCiAqIGBgYAogKgogKiBAcGFyYW0gdGFyZ2V0IC0gVGhlIHNvdXJjZSBvYmplY3QuCiAqIEBzZWUge0BsaW5rIGh0dHBzOi8vdnVlanMub3JnL2FwaS9yZWFjdGl2aXR5LWFkdmFuY2VkLmh0bWwjc2hhbGxvd3JlYWN0aXZlfQogKi8KLypAX19OT19TSURFX0VGRkVDVFNfXyovCmV4cG9ydCBmdW5jdGlvbiBzaGFsbG93UmVhY3RpdmU8VCBleHRlbmRzIG9iamVjdD4oCiAgdGFyZ2V0OiBULAopOiBTaGFsbG93UmVhY3RpdmU8VD4gewogIHJldHVybiBjcmVhdGVSZWFjdGl2ZU9iamVjdCgKICAgIHRhcmdldCwKICAgIGZhbHNlLAogICAgc2hhbGxvd1JlYWN0aXZlSGFuZGxlcnMsCiAgICBzaGFsbG93Q29sbGVjdGlvbkhhbmRsZXJzLAogICAgc2hhbGxvd1JlYWN0aXZlTWFwLAogICkKfQoKdHlwZSBQcmltaXRpdmUgPSBzdHJpbmcgfCBudW1iZXIgfCBib29sZWFuIHwgYmlnaW50IHwgc3ltYm9sIHwgdW5kZWZpbmVkIHwgbnVsbApleHBvcnQgdHlwZSBCdWlsdGluID0gUHJpbWl0aXZlIHwgRnVuY3Rpb24gfCBEYXRlIHwgRXJyb3IgfCBSZWdFeHAKZXhwb3J0IHR5cGUgRGVlcFJlYWRvbmx5PFQ+ID0gVCBleHRlbmRzIEJ1aWx0aW4KICA/IFQKICA6IFQgZXh0ZW5kcyBNYXA8aW5mZXIgSywgaW5mZXIgVj4KICAgID8gUmVhZG9ubHlNYXA8RGVlcFJlYWRvbmx5PEs+LCBEZWVwUmVhZG9ubHk8Vj4+CiAgICA6IFQgZXh0ZW5kcyBSZWFkb25seU1hcDxpbmZlciBLLCBpbmZlciBWPgogICAgICA/IFJlYWRvbmx5TWFwPERlZXBSZWFkb25seTxLPiwgRGVlcFJlYWRvbmx5PFY+PgogICAgICA6IFQgZXh0ZW5kcyBXZWFrTWFwPGluZmVyIEssIGluZmVyIFY+CiAgICAgICAgPyBXZWFrTWFwPERlZXBSZWFkb25seTxLPiwgRGVlcFJlYWRvbmx5PFY+PgogICAgICAgIDogVCBleHRlbmRzIFNldDxpbmZlciBVPgogICAgICAgICAgPyBSZWFkb25seVNldDxEZWVwUmVhZG9ubHk8VT4+CiAgICAgICAgICA6IFQgZXh0ZW5kcyBSZWFkb25seVNldDxpbmZlciBVPgogICAgICAgICAgICA/IFJlYWRvbmx5U2V0PERlZXBSZWFkb25seTxVPj4KICAgICAgICAgICAgOiBUIGV4dGVuZHMgV2Vha1NldDxpbmZlciBVPgogICAgICAgICAgICAgID8gV2Vha1NldDxEZWVwUmVhZG9ubHk8VT4+CiAgICAgICAgICAgICAgOiBUIGV4dGVuZHMgUHJvbWlzZTxpbmZlciBVPgogICAgICAgICAgICAgICAgPyBQcm9taXNlPERlZXBSZWFkb25seTxVPj4KICAgICAgICAgICAgICAgIDogVCBleHRlbmRzIFJlZjxpbmZlciBVLCB1bmtub3duPgogICAgICAgICAgICAgICAgICA/IFJlYWRvbmx5PFJlZjxEZWVwUmVhZG9ubHk8VT4+PgogICAgICAgICAgICAgICAgICA6IFQgZXh0ZW5kcyB7fQogICAgICAgICAgICAgICAgICAgID8geyByZWFkb25seSBbSyBpbiBrZXlvZiBUXTogRGVlcFJlYWRvbmx5PFRbS10+IH0KICAgICAgICAgICAgICAgICAgICA6IFJlYWRvbmx5PFQ+CgovKioKICogVGFrZXMgYW4gb2JqZWN0IChyZWFjdGl2ZSBvciBwbGFpbikgb3IgYSByZWYgYW5kIHJldHVybnMgYSByZWFkb25seSBwcm94eSB0bwogKiB0aGUgb3JpZ2luYWwuCiAqCiAqIEEgcmVhZG9ubHkgcHJveHkgaXMgZGVlcDogYW55IG5lc3RlZCBwcm9wZXJ0eSBhY2Nlc3NlZCB3aWxsIGJlIHJlYWRvbmx5IGFzCiAqIHdlbGwuIEl0IGFsc28gaGFzIHRoZSBzYW1lIHJlZi11bndyYXBwaW5nIGJlaGF2aW9yIGFzIHtAbGluayByZWFjdGl2ZX0sCiAqIGV4Y2VwdCB0aGUgdW53cmFwcGVkIHZhbHVlcyB3aWxsIGFsc28gYmUgbWFkZSByZWFkb25seS4KICoKIGltcG9ydCB7IHR5cGUgVk5vZGUsIHR5cGUgVk5vZGVDaGlsZCwgaXNWTm9kZSB9IGZyb20gJy4vdm5vZGUnCmltcG9ydCB7CiAgRWZmZWN0U2NvcGUsCiAgdHlwZSBSZWFjdGl2ZUVmZmVjdCwKICBUcmFja09wVHlwZXMsCiAgaXNSZWYsCiAgbWFya1JhdywKICBwYXVzZVRyYWNraW5nLAogIHByb3h5UmVmcywKICByZXNldFRyYWNraW5nLAogIHNoYWxsb3dSZWFkb25seSwKICB0cmFjaywKfSBmcm9tICdAdnVlL3JlYWN0aXZpdHknCmltcG9ydCB7CiAgdHlwZSBDb21wb25lbnRQdWJsaWNJbnN0YW5jZSwKICB0eXBlIENvbXBvbmVudFB1YmxpY0luc3RhbmNlQ29uc3RydWN0b3IsCiAgUHVibGljSW5zdGFuY2VQcm94eUhhbmRsZXJzLAogIFJ1bnRpbWVDb21waWxlZFB1YmxpY0luc3RhbmNlUHJveHlIYW5kbGVycywKICBjcmVhdGVEZXZSZW5kZXJDb250ZXh0LAogIGV4cG9zZVByb3BzT25SZW5kZXJDb250ZXh0LAogIGV4cG9zZVNldHVwU3RhdGVPblJlbmRlckNvbnRleHQsCiAgcHVibGljUHJvcGVydGllc01hcCwKfSBmcm9tICcuL2NvbXBvbmVudFB1YmxpY0luc3RhbmNlJwppbXBvcnQgewogIHR5cGUgQ29tcG9uZW50UHJvcHNPcHRpb25zLAogIHR5cGUgTm9ybWFsaXplZFByb3BzT3B0aW9ucywKICBpbml0UHJvcHMsCiAgbm9ybWFsaXplUHJvcHNPcHRpb25zLAp9IGZyb20gJy4vY29tcG9uZW50UHJvcHMnCmltcG9ydCB7CiAgdHlwZSBJbnRlcm5hbFNsb3RzLAogIHR5cGUgU2xvdHMsCiAgdHlwZSBTbG90c1R5cGUsCiAgdHlwZSBVbndyYXBTbG90c1R5cGUsCiAgaW5pdFNsb3RzLAp9IGZyb20gJy4vY29tcG9uZW50U2xvdHMnCmltcG9ydCB7IHdhcm4gfSBmcm9tICcuL3dhcm5pbmcnCmltcG9ydCB7IEVycm9yQ29kZXMsIGNhbGxXaXRoRXJyb3JIYW5kbGluZywgaGFuZGxlRXJyb3IgfSBmcm9tICcuL2Vycm9ySGFuZGxpbmcnCmltcG9ydCB7CiAgdHlwZSBBcHBDb25maWcsCiAgdHlwZmVycmVkICYmIENvbXBvbmVudC5fX25hbWUpCn0KCmV4cG9ydCBmdW5jdGlvbiBmb3JtYXRDb21wb25lbnROYW1lKAogIGluc3RhbmNlOiBDb21wb25lbnRJbnRlcm5hbEluc3RhbmNlIHwgbnVsbCwKICBDb21wb25lbnQ6IENvbmNyZXRlQ29tcG9uZW50LAogIGlzUm9vdCA9IGZhbHNlLAopOiBzdHJpbmcgewogIGxldCBuYW1lID0gZ2V0Q29tcG9uZW50TmFtZShDb21wb25lbnQpCiAgaWYgKCFuYW1lICYmIENvbXBvbmVudC5fX2ZpbGUpIHsKICAgIGNvbnN0IG1hdGNoID0gQ29tcG9uZW50Ll9fZmlsZS5tYXRjaCgvKFteL1xcXSspXC5cdyskLykKICAgIGlmIChtYXRjaCkgewogICAgICBuYW1lID0gbWF0Y2hbMV0KICAgIH0KICB9CgogIGlmICghbmFtZSAmJiBpbnN0YW5jZSkgewogICAgLy8gdHJ5IHRvIGluZmVyIHRoZSBuYW1lIGJhc2VkIG9uIHJldmVyc2UgcmVzb2x1dGlvbgogICAgY29uc3QgaW5mZXJGcm9tUmVnaXN0cnkgPSAoCiAgICAgIHJlZ2lzdHJ5OiBSZWNvcmQ8c3RyaW5nLCBhbnk+IHwgdW5kZWZpbmVkIHwgbnVsbCwKICAgICkgPT4gewogICAgICBmb3IgKGNvbnN0IGtleSBpbiByZWdpc3RyeSkgewogICAgICAgIGlmIChyZWdpc3RyeVtrZXldID09PSBDb21wb25lbnQpIHsKICAgICAgICAgIHJldHVybiBrZXkKICAgICAgICB9CiAgICAgIH0KICAgIH0KICAgIG5hbWUgPQogICAgICBpbmZlckZyb21SZWdpc3RyeShpbnN0YW5jZS5jb21wb25lbnRzKSB8fAogICAgICAoaW5zdGFuY2UucGFyZW50ICYmCiAgICAgICAgaW5mZXJGcm9tUmVnaXN0cnkoCiAgICAgICAgICAoaW5zdGFuY2UucGFyZW50LnR5cGUgYXMgQ29tcG9uZW50T3B0aW9ucykuY29tcG9uZW50cywKICAgICAgICApKSB8fAogICAgICBpbmZlckZyb21SZWdpc3RyeShpbnN0YW5jZS5hcHBDb250ZXh0LmNvbXBvbmVudHMpCiAgfQoKICByZXR1cm4gbmFtZSA/IGNsYXNzaWZ5KG5hbWUpIDogaXNSb290ID8gYEFwcGAgOiBgQW5vbnltb3VzYAp9CgpleHBvcnQgZnVuY3Rpb24gaXNDbGFzc0NvbXBvbmVudCh2YWx1ZTogdW5rbm93bik6IHZhbHVlIGlzIENsYXNzQ29tcG9uZW50IHsKICByZXR1cm4gaXNGdW5jdGlvbih2YWx1ZSkgJiYgJ19fdmNjT3B0cycgaW4gdmFsdWUKfQoKZXhwb3J0IGludGVyZmFjZSBDb21wb25lbnRDdXN0b21FbGVtZW50SW50ZXJmYWNlIHsKICAvKioKICAgKiBAaW50ZXJuYWwKICAgKi8KICBfaXNWdWVDRTogYm9vbGVhbgogIC8qKgogICAqIEBpbnRlcm5hbAogICAqLwogIF9pbmplY3RDaGlsZFN0eWxlKHR5cGU6IENvbmNyZXRlQ29tcG9uZW50KTogdm9pZAogIC8qKgogICAqIEBpbnRlcm5hbAogICAqLwogIF9yZW1vdmVDaGlsZFN0eWxlKHR5cGU6IENvbmNyZXRlQ29tcG9uZW50KTogdm9pZAogIC8qKgogICAqIEBpbnRlcm5hbAogICAqLwogIF9zZXRQcm9wKAogICAga2V5OiBzdHJpbmcsCiAgICB2YWw6IGFueSwKICAgIHNob3VsZFJlZmxlY3Q/OiBib29sZWFuLAogICAgc2hvdWxkVXBkYXRlPzogYm9vbGVhbiwKICApOiB2b2lkCiAgLyoqCiAgICogQGludGVybmFsCiAgICovCiAgX2JlZ2luUGF0Y2goKTogdm9pZAogIC8qKgogICAqIEBpbnRlcm5hbAogICAqLwogIF9lbmRQYXRjaCgpOiB2b2lkCiAgLyoqCiAgICogQGludGVybmFsIGF0dGFjaGVkIGJ5IHRoZSBuZXN0ZWQgVGVsZXBvcnQgd2hlbiBzaGFkb3dSb290IGlzIGZhbHNlLgogICAqLwogIF90ZWxlcG9ydFRhcmdldHM/OiBTZXQ8UmVuZGVyZXJFbGVtZW50PgogIC8qKgogICAqIEBpbnRlcm5hbCBjaGVjayBpZiBzaGFkb3cgcm9vdCBpcyBlbmFibGVkCiAgICovCiAgX2hhc1NoYWRvd1Jvb3QoKTogYm9vbGVhbgp9CmltcG9ydCB7IGRlZiwgaGFzT3duLCBpc09iamVjdCwgdG9SYXdUeXBlIH0gZnJvbSAnQHZ1ZS9zaGFyZWQnCmltcG9ydCB7CiAgbXV0YWJsZUhhbmRsZXJzLAogIHJlYWRvbmx5SGFuZGxlcnMsCiAgc2hhbGxvd1JlYWN0aXZlSGFuZGxlcnMsCiAgc2hhbGxvd1JlYWRvbmx5SGFuZGxlcnMsCn0gZnJvbSAnLi9iYXNlIGJlY2F1c2Ugc29tZSBwdWJsaWMgaW50ZXJmYWNlcwovLyBleHRlbmQgaXQuCmV4cG9ydCBpbnRlcmZhY2UgQ29tcG9uZW50SW50ZXJuYWxPcHRpb25zIHsKICAvKioKICAgKiBAaW50ZXJuYWwKICAgKi8KICBfX3Njb3BlSWQ/OiBzdHJpbmcKICAvKioKICAgKiBAaW50ZXJuYWwKICAgKi8KICBfX2Nzc01vZHVsZXM/OiBEYXRhCiAgLyoqCiAgICogQGludGVybmFsCiAgICovCiAgX19obXJJZD86IHN0cmluZwogIC8qKgogICAqIENvbXBhdCBidWlsZCBvbmx5LCBmb3IgYmFpbGluZyBvdXQgb2YgY2VydGFpbiBjb21wYXRpYmlsaXR5IGJlaGF2aW9yCiAgICovCiAgX19pc0J1aWx0SW4/OiBib29sZWFuCiAgLyoqCiAgICogVGhpcyBvbmUgc2hvdWxkIGJlIGV4cG9zZWQgc28gdGhhdCBkZXZ0b29scyBjYW4gbWFrZSB1c2Ugb2YgaXQKICAgKi8KICBfX2ZpbGU/OiBzdHJpbmcKICAvKioKICAgKiBuYW1lIGluZmVycmVkIGZyb20gZmlsZW5hbWUKICAgKi8KICBfX25hbWU/OiBzdHJpbmcKfQoKZXhwb3J0IGludGVyZmFjZSBGdW5jdGlvbmFsQ29tcG9uZW50PAogIFAgPSB7fSwKICBFIGV4dGVuZHMgRW1pdHNPcHRpb25zIHwgUmVjb3JkPHN0cmluZywgYW55W10+ID0ge30sCiAgUyBleHRlbmRzIFJlY29yZDxzdHJpbmcsIGFueT4gPSBhbnksCiAgRUUgZXh0ZW5kcyBFbWl0c09wdGlvbnMgPSBTaG9ydEVtaXRzVG9PYmplY3Q8RT4sCj4gZXh0ZW5kcyBDb21wb25lbnRJbnRlcm5hbE9wdGlvbnMgewogIC8vIHVzZSBvZiBhbnkgaGVyZSBpcyBpbnRlbnRpb25hbCBzbyBpdCBjYW4gYmUgYSB2YWxpZCBKU1ggRWxlbWVudCBjb25zdHJ1Y3RvcgogICgKICAgIHByb3BzOiBQICYgRW1pdHNUb1Byb3BzPEVFPiwKICAgIGN0eDogT21pdDxTZXR1cENvbnRleHQ8RUUsIElmQW55PFMsIHt9LCBTbG90c1R5cGU8Uz4+PiwgJ2V4cG9zZSc+LAogICk6IGFueQogIHByb3BzPzogQ29tcG9uZW50UHJvcHNPcHRpb25zPFA+CiAgZW1pdHM/OiBFRSB8IChrZXlvZiBFRSlbXQogIHNsb3RzPzogSWZBbnk8UywgU2xvdHMsIFNsb3RzVHlwZTxTPj4KICBpbmhlcml0QXR0cnM/OiBib29sZWFuCiAgZGlzcGxheU5hbWU/OiBzdHJpbmcKICBjb21wYXRDb25maWc/OiBDb21wYXRDb25maWcKfQoKZXhwb3J0IGludGVyZmFjZSBDbGFzc0NvbXBvbmVudCB7CiAgbmV3ICguLi5hcmdzOiBhbnlbXSk6IENvbXBvbmVudFB1YmxpY0luc3RhbmNlPGFueSwgYW55LCBhbnksIGFueSwgYW55PgogIF9fdmNjT3B0czogQ29tcG9uZW50T3B0aW9ucwp9CgovKioKICogQ29uY3JldGUgY29tcG9uZW50IHR5cGUgbWF0Y2hlcyBpdHMgYWN0dWFsIHZhbHVlOiBpdCdzIGVpdGhlciBhbiBvcHRpb25zCiAqIG9iamVjdCwgb3IgYSBmdW5jdGlvbi4gVXNlIHRoaXMgd2hlcmUgdGhlIGNvZGUgZXhwZWN0cyB0byB3b3JrIHdpdGggYWN0dWFsCiAqIHZhbHVlcywgZS5nLiBjaGVja2luZyBpZiBpdHMgYSBmdW5jdGlvbiBvciBub3QuIFRoaXMgaXMgbW9zdGx5IGZvciBpbnRlcm5hbAogKiBpbXBsZW1lbnRhdGlvbiBjb2RlLgogKi8KZXhwb3J0IHR5cGUgQ29uY3JldGVDb21wb25lbnQ8CiAgUHJvcHMgPSB7fSwKICBSYXdCaW5kaW5ncyA9IGFueSwKICBEID0gYW55LAogIEMgZXh0ZW5kcyBDb21wdXRlZE9wdGlvbnMgPSBDb21wdXRlZE9wdGlvbnMsCiAgTSBleHRlbmRzIE1ldGhvZE9wdGlvbnMgPSBNZXRob2RPcHRpb25zLAogIEUgZXh0ZW5kcyBFbWl0c09wdGlvbnMgfCBSZWNvcmQ8c3RyaW5nLCBhbnlbXT4gPSB7fSwKICBTIGV4dGVuZHMgUmVjb3JkPHN0cmluZywgYW55PiA9IGFueSwKPiA9CiAgfCBDb21wb25lbnRPcHRpb25zPFByb3BzLCBSYXdCaW5kaW5ncywgRCwgQywgTT4KICB8IEZ1bmN0aW9uYWxDb21wb25lbnQ8UHJvcHMsIEUsIFM+CgovKioKICogQSB0eXBlIHVzZWQgaW4gcHVibGljIEFQSXMgd2hlcmUgYSBjb21wb25lbnQgdHlwZSBpcyBleHBlY3RlZC4KICogVGhlIGNvbnN0cnVjdG9yIHR5cGUgaXMgYW4gYXJ0aWZpY2lhbCB0eXBlIHJldHVyaW5zdGFuY2U6IENvbXBvbmVudEludGVybmFsSW5zdGFuY2UpOiBTbG90cyB7CiAgcmV0dXJuIG5ldyBQcm94eShpbnN0YW5jZS5zbG90cywgewogICAgZ2V0KHRhcmdldCwga2V5OiBzdHJpbmcpIHsKICAgICAgdHJhY2soaW5zdGFuY2UsIFRyYWNrT3BUeXBlcy5HRVQsICckc2xvdHMnKQogICAgICByZXR1cm4gdGFyZ2V0W2tleV0KICAgIH0sCiAgfSkKfQoKZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVNldHVwQ29udGV4dCgKICBpbnN0YW5jZTogQ29tcG9uZW50SW50ZXJuYWxJbnN0YW5jZSwKKTogU2V0dXBDb250ZXh0IHsKICBjb25zdCBleHBvc2U6IFNldHVwQ29udGV4dFsnZXhwb3NlJ10gPSBleHBvc2VkID0+IHsKICAgIGlmIChfX0RFVl9fKSB7CiAgICAgIGlmIChpbnN0YW5jZS5leHBvc2VkKSB7CiAgICAgICAgd2FybihgZXhwb3NlKCkgc2hvdWxkIGJlIGNhbGxlZCBvbmx5IG9uY2UgcGVyIHNldHVwKCkuYCkKICAgICAgfQogICAgICBpZiAoZXhwb3NlZCAhPSBudWxsKSB7CiAgICAgICAgbGV0IGV4cG9zZWRUeXBlOiBzdHJpbmcgPSB0eXBlb2YgZXhwb3NlZAogICAgICAgIGlmIChleHBvc2VkVHlwZSA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgIGlmIChpc0FycmF5KGV4cG9zZWQpKSB7CiAgICAgICAgICAgIGV4cG9zZWRUeXBlID0gJ2FycmF5JwogICAgICAgICAgfSBlbHNlIGlmIChpc1JlZihleHBvc2VkKSkgewogICAgICAgICAgICBleHBvc2VkVHlwZSA9ICdyZWYnCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIGlmIChleHBvc2VkVHlwZSAhPT0gJ29iamVjdCcpIHsKICAgICAgICAgIHdhcm4oCiAgICAgICAgICAgIGBleHBvc2UoKSBzaG91bGQgYmUgcGFzc2VkIGEgcGxhaW4gb2JqZWN0LCByZWNlaXZlZCAke2V4cG9zZWRUeXBlfS5gLAogICAgICAgICAgKQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgaW5zdGFuY2UuZXhwb3NlZCA9IGV4cG9zZWQgfHwge30KICB9CgogIGlmIChfX0RFVl9fKSB7CiAgICAvLyBXZSB1c2UgZ2V0dGVycyBpbiBkZXYgaW4gY2FzZSBsaWJzIGxpa2UgdGVzdC11dGlscyBvdmVyd3JpdGUgaW5zdGFuY2UKICAgIC8vIHByb3BlcnRpZXMgKG92ZXJ3cml0ZXMgc2hvdWxkIG5vdCBiZSBkb25lIGluIHByb2QpCiAgICBsZXQgYXR0cnNQcm94eTogRGF0YQogICAgbGV0IHNsb3RzUHJveHk6IFNsb3RzCiAgICByZXR1cm4gT2JqZWN0LmZyZWV6ZSh7CiAgICAgIGdldCBhdHRycygpIHsKICAgICAgICByZXR1cm4gKAogICAgICAgICAgYXR0cnNQcm94eSB8fAogICAgICAgICAgKGF0dHJzUHJveHkgPSBuZXcgUHJveHkoaW5zdGFuY2UuYXR0cnMsIGF0dHJzUHJveHlIYW5kbGVycykpCiAgICAgICAgKQogICAgICB9LAogICAgICBnZXQgc2xvdHMoKSB7CiAgICAgICAgcmV0dXJuIHNsb3RzUHJveHkgfHwgKHNsb3RzUHJveHkgPSBnZXRTbG90c1Byb3h5KGluc3RhbmNlKSkKICAgICAgfSwKICAgICAgZ2V0IGVtaXQoKSB7CiAgICAgICAgcmV0dXJuIChldmVudDogc3RyaW5nLCAuLi5hcmdzOiBhbnlbXSkgPT4gaW5zdGFuY2UuZW1pdChldmVudCwgLi4uYXJncykKICAgICAgfSwKICAgICAgZXhwb3NlLAogICAgfSkKICB9IGVsc2UgewogICAgcmV0dXJuIHsKICAgICAgYXR0cnM6IG5ldyBQcm94eShpbnN0YW5jZS5hdHRycywgYXR0cnNQcm94eUhhbmRsZXJzKSwKICAgICAgc2xvdHM6IGluc3RhbmNlLnNsb3RzLAogICAgICBlbWl0OiBpbnN0YW5jZS5lbWl0LAogICAgICBleHBvc2UsCiAgICB9CiAgfQp9CgpleHBvcnQgZnVuY3Rpb24gZ2V0Q29tcG9uZW50UHVibGljSW5zdGFuY2UoCiAgaW5zdGFuY2U6IENvbXBvbmVudEludGVybmFsSW5zdGFuY2UsCik6IENvbXBvbmVudFB1YmxpY0luc3RhbmNlIHwgQ29tcG9uZW50SW50ZXJuYWxJbnN0YW5jZVsnZXhwb3NlZCddIHwgbnVsbCB7CiAgaWYgKGluc3RhbmNlLmV4cG9zZWQpIHsKICAgIHJldHVybiAoCiAgICAgIGluc3RhbmNlLmV4cG9zZVByb3h5IHx8CiAgICAgIChpbnN0YW5jZS5leHBvc2VQcm94eSA9LCBidXQgaW4gcHJhY3RpY2UgdGhlcmUgYXJlIG9mdGVuIGNhc2VzCiAqIHdoZXJlIHRoZSB1c2VyIGlzIHVuYWJsZSB0byByZXNvbHZlIG9uIHRoZWlyIG93biwgZXNwZWNpYWxseSBpbiBjb21wbGljYXRlZAogKiBTU1Igc2V0dXBzLgogKgogKiBOb3RlIHRoaXMgZml4IGlzIHRlY2huaWNhbGx5IGluY29tcGxldGUsIGFzIHdlIHN0aWxsIHJlbHkgb24gb3RoZXIgc2luZ2xldG9ucwogKiBmb3IgZWZmZWN0U2NvcGUgYW5kIGdsb2JhbCByZWFjdGl2ZSBkZXBlbmRlbmN5IG1hcHMuIEhvd2V2ZXIsIGl0IGRvZXMgbWFrZQogKiBzb21lIG9mIHRoZSBtb3N0IGNvbW1vbiBjYXNlcyB3b3JrLiBJdCBhbHNvIHdhcm5zIGlmIHRoZSBkdXBsaWNhdGlvbiBpcwogKiBmb3VuZCBkdXJpbmcgYnJvd3NlciBleGVjdXRpb24uCiAqLwppZiAoX19TU1JfXykgewogIHR5cGUgU2V0dGVyID0gKHY6IGFueSkgPT4gdm9pZAogIGNvbnN0IGcgPSBnZXRHbG9iYWxUaGlzKCkKICBjb25zdCByZWdpc3Rlckdsb2JhbFNldHRlciA9IChrZXk6IHN0cmluZywgc2V0dGVyOiBTZXR0ZXIpID0+IHsKICAgIGxldCBzZXR0ZXJzOiBTZXR0ZXJbXQogICAgaWYgKCEoc2V0dGVycyA9IGdba2V5XSkpIHNldHRlcnMgPSBnW2tleV0gPSBbXQogICAgc2V0dGVycy5wdXNoKHNldHRlcikKICAgIHJldHVybiAodjogYW55KSA9PiB7CiAgICAgIGlmIChzZXR0ZXJzLmxlbmd0aCA+IDEpIHNldHRlcnMuZm9yRWFjaChzZXQgPT4gc2V0KHYpKQogICAgICBlbHNlIHNldHRlcnNbMF0odikKICAgIH0KICB9CiAgaW50ZXJuYWxTZXRDdXJyZW50SW5zdGFuY2UgPSByZWdpc3Rlckdsb2JhbFNldHRlcigKICAgIGBfX1ZVRV9JTlNUQU5DRV9TRVRURVJTX19gLAogICAgdiA9PiAoY3VycmVudEluc3RhbmNlID0gdiksCiAgKQogIC8vIGFsc28gbWFrZSBgaXNJblNTUkNvbXBvbmVudFNldHVwYCBzaGFyYWJsZSBhY3Jvc3MgY29waWVzIG9mIFZ1ZS4KICAvLyB0aGlzIGlzIG5lZWRlZCBpbiB0aGUgU0ZDIHBsYXlncm91bmQgd2hlbiBTU1JpbmcgYXN5bmMgY29tcG9uZW50cywgc2luY2UKICAvLyB3ZSBoYXZlIHRvIGxvYWQgYm90aCB0aGUgcnVudGltZSBhbmQgdGhlIHNlcnZlci1yZW5kZXJlciBmcm9tIENETnMsIHRoZXkKICAvLyBjb250YWluIGR1cGxpY2F0ZWQgY29waWVzIG9mIFZ1ZSBydW50aW1lIGNvZGUuCiAgc2V0SW5TU1JTZXR1cFN0YXRlID0gcmVnaXN0ZXJHbG9iYWxTZXR0ZXIoCiAgICBgX19WVUVfU1NSX1NFVFRFUlNfX2AsCiAgICB2ID0+IChpc0luU1NSQ29tcG9uZW50U2V0dXAgPSB2KSwKICApCn0gZWxzZSB7CiAgaW50ZXJuYWxTZXRDdXJyZW50SW5zdGFuY2UgPSBpID0+IHsKICAgIGN1cnJlbnRJbnN0YW5jZSA9IGkKICB9CiAgc2V0SW5TU1JTZXR1cFN0YXRlID0gdiA9PiB7CiAgICBpc0luU1NSQ29tcG9uZW50U2V0dXAgPSB2CiAgfQp9CgpleHBvcnQgY29uc3Qgc2V0Q3VycmVudEluc3RhbmNlID0gKGluc3RhbmNlOiBDb21wb25lbnRJbnRlcm5hbEluc3RhbmNlKSA9PiB7CiAgY29uc3QgcHJldiA9IGN1cnJlbnRJbnN0YW5jZQogIGludGVybmFsU2V0Q3VycmVudEluc3RhbmNlKGluc3RhbmNlKQogIGluc3RhbmNlLnNjb3BlLm9uKCkKICByZXR1cm4gKCk6IHZvaWQgPT4gewogICAgaW5zdGFuY2Uuc2NvcGUub2ZmKCkKICAgIGludGVybmFsU2V0Q3VycmVudEluc3RhbmNlKHByZXYpCiAgfQp9CgpleHBvcnQgY29uc3QgdW5zZXRDdXJyZW50SW5zdGFuY2UgPSAoKTogdm9pZCA9PiB7CiAgY3VycmVudEluc3RhbmNlICYmIGN1cnJlbnRJbnN0YW5jZS5zY29wZS5vZmYoKQogIGludGVybmFsU2V0Q3VycmVudEluc3RhbmNlKG51bGwpCn0KCmNvbnN0IGlzQnVpbHRJblRhZyA9IC8qQF9fUFVSRV9fKi8gbWFrZU1hcCgnc2xvdCxjb21wb25lbnQnKQoKZXhwb3J0IGZ1bmN0aW9uIHZhbGlkYXRlQ29tcG9uZW50TmFtZSgKICBuYW1lOiBzdHJpbmcsCiAgeyBpc05hdGl2ZVRhZyB9OiBBcHBDb25maWcsCik6IHZvaWQgewogIGlmIChpc0J1aWx0aWx0SW5UYWcobmFtZSkgfHwgaXNOYXRpdmVUYWcobmFtZSkpIHsKICAgIHdhcm4oCiAgICAgICdEbyBub3QgdXNlIGJ1aWx0LWluIG9yIHJlc2VydmVkIEhUTUwgZWxlbWVudHMgYXMgY29tcG9uZW50IGlkOiAnICsgbmFtZSwKICAgICkKICB9Cn0KCmV4cG9ydCBmdW5jdGlvbiBpc1N0YXRlZnVsQ29tcG9uZW50KAogIGluc3RhbmNlOiBDb21wb25lbnRJbnRlcm5hbEluc3RhbmNlLAopOiBudW1iZXIgewogIHJldHVybiBpbnN0YW5jZS52bm9kZS5zaGFwZUZsYWcgJiBTaGFwZUZsYWdzLlNUQVRFRlVMX0NPTVBPTkVOVAp9CgpleHBvcnQgbGV0IGlzSW5TU1JDb21wb25lbnRTZXR1cCA9IGZhbHNlCgpleHBvcnQgZnVuY3Rpb24gc2V0dXBDb21wb25lbnQoCiAgaW5zdGFuY2U6IENvbXBvbmVudEludGVybmFsSW5zdGFuY2UsCiAgaXNTU1IgPSBmYWxzZSwKICBvcHRpbWl6ZWQgPSBmYWxzZSwKKTogUHJvbWlzZTx2b2lkPiB8IHVuZGVmaW5lZCB7CiAgaXNTU1IgJiYgc2V0SW5TU1JTZXR1cFN0YXRlKGlzU1NSKQoKICBjb25zdCB7IHByb3BzLCBjaGlsZHJlbiB9ID0gaW5zdGFuY2Uudm5vZGUKICBjb25zdCBpc1N0YXRlZnVsID0gaXNTdGF0ZWZ1bENvbXBvbmVudChpbnN0YW5jZSkKICBpbml0UHJvcHMoaW5zdGFuY2UsIHByb3BzLCBpc1N0YXRlZnVsLCBpc1NTUikKICBpbml0U2xvdHMoaW5zdGFuY2UsIGNoaWxkcmVuLCBvcHRpbWl6ZWQgfHwgaXNTU1IpCgogIGNvbnN0IHNldHVwUmVzdWx0ID0gaXNTdGF0ZWZ1bAogICAgPyBzZXR1cFN0YXRlZnVsQ29tcG9uZW50KGluc3RhbmNlLCBpc1NTUikKICAgIDogdW5kZWZpbmVkCgogIGlzU1NSICYmIHNldEluU1NSU2V0dXBTdGF0ZShmYWxzZSkKICByZXR1cm4gc2V0dXBSZXN1bHQKfQoKZnVuY3Rpb24gc2V0dXBTdGF0ZWZ1bENvbXBvbmVudCgKICBpbnN0YW5jZTogQ29tcG9uZW50SW50ZXJuYWxJbnN0YW5jZSwKICBpc1NTUjogYm9vbGVhbiwKKSB7CiAgY29uc3QgQ29tcG9uZW50ID0gaW5zdGFuY2UudHlwZSBhcyBDb21wb25lbnRPcHRpb25zCgogIGlmIChfX0RFVl9fKSB7CiAgICBpZiAoQ29tcG9uZW50Lm5hbWUpIHsKICAgICAgdmFsaWRhdGVDb21wb25lbnROYW1lKENvbXBvbmVudC5uYW1lLCBpbnN0YW5jZS5hcHBDb250ZXh0LmNvbmZpZykKICAgIH0KICAgIGlmIChDb21wb25lbnQuY29tcG9uZW50cykgewogICAgICBjb25zdCBuYW1lcyA9IE9iamVjdC5rZXlzKENvbXBvbmVudC5jb21wb25lbnRzKQogICAgICBmb3IgKGxldCBpID0gMDsgaSA8IG5hbWVzLmxlbmd0aDsgaSsrKSB7CiAgICAgICAgdmFsaWRhdGVDb21wb25lbnROYW1lKG5hbWVzW2ldLCBpbnN0YW5jZS5hcHBDb250ZXh0LmNvbmZpZykKICAgICAgfQogICAgfQogICAgaWYgKENvbXBvbmVudC5kaXJlY3RpdmVzKSB7CiAgbnVsbCwKKTogQ29tcG9uZW50SW50ZXJuYWxJbnN0YW5jZSB7CiAgY29uc3QgdHlwZSA9IHZub2RlLnR5cGUgYXMgQ29uY3JldGVDb21wb25lbnQKICAvLyBpbmhlcml0IHBhcmVudCBhcHAgY29udGV4dCAtIG9yIC0gaWYgcm9vdCwgYWRvcHQgZnJvbSByb290IHZub2RlCiAgY29uc3QgYXBwQ29udGV4dCA9CiAgICAocGFyZW50ID8gcGFyZW50LmFwcENvbnRleHQgOiB2bm9kZS5hcHBDb250ZXh0KSB8fCBlbXB0eUFwcENvbnRleHQKCiAgY29uc3QgaW5zdGFuY2U6IENvbXBvbmVudEludGVybmFsSW5zdGFuY2UgPSB7CiAgICB1aWQ6IHVpZCsrLAogICAgdm5vZGUsCiAgICB0eXBlLAogICAgcGFyZW50LAogICAgYXBwQ29udGV4dCwKICAgIHJvb3Q6IG51bGwhLCAvLyB0byBiZSBpbW1lZGlhdGVseSBzZXQKICAgIG5leHQ6IG51bGwsCiAgICBzdWJUcmVlOiBudWxsISwgLy8gd2lsbCBiZSBzZXQgc3luY2hyb25vdXNseSByaWdodCBhZnRlciBjcmVhdGlvbgogICAgZWZmZWN0OiBudWxsISwKICAgIHVwZGF0ZTogbnVsbCEsIC8vIHdpbGwgYmUgc2V0IHN5bmNocm9ub3VzbHkgcmlnaHQgYWZ0ZXIgY3JlYXRpb24KICAgIGpvYjogbnVsbCEsCiAgICBzY29wZTogbmV3IEVmZmVjdFNjb3BlKHRydWUgLyogZGV0YWNoZWQgKi8pLAogICAgcmVuZGVyOiBudWxsLAogICAgcHJveHk6IG51bGwsCiAgICBleHBvc2VkOiBudWxsLAogICAgZXhwb3NlUHJveHk6IG51bGwsCiAgICB3aXRoUHJveHk6IG51bGwsCgogICAgcHJvdmlkZXM6IHBhcmVudCA/IHBhcmVudC5wcm92aWRlcyA6IE9iamVjdC5jcmVhdGUoYXBwQ29udGV4dC5wcm92aWRlcyksCiAgICBpZHM6IHBhcmVudCA/IHBhcmVudC5pZHMgOiBbJycsIDAsIDBdLAogICAgYWNjZXNzQ2FjaGU6IG51bGwhLAogICAgcmVuZGVyQ2FjaGU6IFtdLAoKICAgIC8vIGxvY2FsIHJlc29sdmVkIGFzc2V0cwogICAgY29tcG9uZW50czogbnVsbCwKICAgIGRpcmVjdGl2ZXM6IG51bGwsCgogICAgLy8gcmVzb2x2ZWQgcHJvcHMgYW5kIGVtaXRzIG9wdGlvbnMKICAgIHByb3BzT3B0aW9uczogbm9ybWFsaXplUHJvcHNPcHRpb25zKHR5cGUsIGFwcENvbnRleHQpLAogICAgZW1pdHNPcHRpb25zOiBub3JtYWxpemVFbWl0c09wdGlvbnModHlwZSwgYXBwQ29udGV4dCksCgogICAgLy8gZW1pdAogICAgZW1pdDogbnVsbCEsIC8vIHRvIGJlIHNldCBpbW1lZGlhdGVseQogICAgZW1pdHRlZDogbnVsbCwKCiAgICAvLyBwcm9wcyBkZWZhdWx0IHZhbHVlCiAgICBwcm9wc0RlZmF1bHRzOiBFTVBUWV9PQkosCgogICAgLy8gaW5oZXJpdEF0dHJzCiAgICBpbmhlcml0QXR0cnM6IHR5cGUuaW5oZXJpdEF0dHJzLAoKICAgIC8vIHN0YXRlCiAgICBjdHg6IEVNUFRZX09CSiwKICAgIGRhdGE6IEVNUFRZX09CSiwKICAgIHByb3BzOiBFTVBUWV9PQkosCiAgICBhdHRyczogRU1QVFlfT0JKLAogICAgc2xvdHM6IEVNUFRZX09CSiwKICAgIHJlZnM6IEVNUFRZX09CSiwKICAgIHNldHVwU3RhdGU6IEVNUFRZX09CSiwKICAgIHNldHVwQ29udGV4dDogbnVsbCwKCiAgICAvLyBzdXNwZW5zZSByZWxhdGVkCiAgICBzdXNwZW5zZSwKICAgIHN1c3BlbnNlSWQ6IHN1c3BlbnNlID8gc3VzcGVuc2UucGVuZGluZ0lkIDogMCwKICAgIGFzeW5jRGVwOiBudWxsLAogICAgYXN5bmNSZXNvbHZlZDogZmFsc2UsCgogICAgLy8gbGlmZWN5Y2xlIGhvb2tzCiAgICAvLyBub3QgdXNpbmcgZW51bXMgaGVyZSBiZWNhdXNlIGl0IHJlc3VsdHMgaW4gY29tcHV0ZWQgcHJvcGVydGllcwogICAgaXNNb3VudGVkOiBmYWxzZSwKICAgIGlzVW5tb3VudGVkOiBmYWxzZSwKICAgIGlzRGVhY3RpdmF0ZWQ6IGZhbHNlLAogICAgYmM6IG51bGwsCiAgICBjOiBudWxsLAogICAgYm06IG51bGwsCiAgICBtOiBudWxsLAogICAgYnU6IG51bGwsCiAgICB1OiBudWxsLAogICAgdW06IG51bGwsCiAgICBidW06IG51bGwsCiAgICBkYTogbnVsbCwKICAgIGE6IG51bGwsCiAgICBydGc6IG51bGwsCiAgICBydGM6IG51bGwsCiAgICBlYzogUiAmJiBjb21waWxlICYmICFDb21wb25lbnQucmVuZGVyKSB7CiAgICAgIGNvbnN0IHRlbXBsYXRlID0KICAgICAgICAoX19DT01QQVRfXyAmJgogICAgICAgICAgaW5zdGFuY2Uudm5vZGUucHJvcHMgJiYKICAgICAgICAgIGluc3RhbmNlLnZub2RlLnByb3BzWydpbmxpbmUtdGVtcGxhdGUnXSkgfHwKICAgICAgICBDb21wb25lbnQudGVtcGxhdGUgfHwKICAgICAgICAoX19GRUFUVVJFX09QVElPTlNfQVBJX18gJiYgcmVzb2x2ZU1lcmdlZE9wdGlvbnMoaW5zdGFuY2UpLnRlbXBsYXRlKQogICAgICBpZiAodGVtcGxhdGUpIHsKICAgICAgICBpZiAoX19ERVZfXykgewogICAgICAgICAgc3RhcnRNZWFzdXJlKGluc3RhbmNlLCBgY29tcGlsZWApCiAgICAgICAgfQogICAgICAgIGNvbnN0IHsgaXNDdXN0b21FbGVtZW50LCBjb21waWxlck9wdGlvbnMgfSA9IGluc3RhbmNlLmFwcENvbnRleHQuY29uZmlnCiAgICAgICAgY29uc3QgeyBkZWxpbWl0ZXJzLCBjb21waWxlck9wdGlvbnM6IGNvbXBvbmVudENvbXBpbGVyT3B0aW9ucyB9ID0KICAgICAgICAgIENvbXBvbmVudAogICAgICAgIGNvbnN0IGZpbmFsQ29tcGlsZXJPcHRpb25zOiBDb21waWxlck9wdGlvbnMgPSBleHRlbmQoCiAgICAgICAgICBleHRlbmQoCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICBpc0N1c3RvbUVsZW1lbnQsCiAgICAgICAgICAgICAgZGVsaW1pdGVycywKICAgICAgICAgICAgfSwKICAgICAgICAgICAgY29tcGlsZXJPcHRpb25zLAogICAgICAgICAgKSwKICAgICAgICAgIGNvbXBvbmVudENvbXBpbGVyT3B0aW9ucywKICAgICAgICApCiAgICAgICAgaWYgKF9fQ09NUEFUX18pIHsKICAgICAgICAgIC8vIHBhc3MgcnVudGltZSBjb21wYXQgY29uZmlnIGludG8gdGhlIGNvbXBpbGVyCiAgICAgICAgICBmaW5hbENvbXBpbGVyT3B0aW9ucy5jb21wYXRDb25maWcgPSBPYmplY3QuY3JlYXRlKGdsb2JhbENvbXBhdENvbmZpZykKICAgICAgICAgIGlmIChDb21wb25lbnQuY29tcGF0Q29uZmlnKSB7CiAgICAgICAgICAgIC8vIEB0cy1leHBlY3QtZXJyb3IgdHlwZXMgYXJlIG5vdCBjb21wYXRpYmxlCiAgICAgICAgICAgIGV4dGVuZChmaW5hbENvbXBpbGVyT3B0aW9ucy5jb21wYXRDb25maWcsIENvbXBvbmVudC5jb21wYXRDb25maWcpCiAgICAgICAgICB9CiAgICAgICAgfQogICAgICAgIENvbXBvbmVudC5yZW5kZXIgPSBjb21waWxlKHRlbXBsYXRlLCBmaW5hbENvbXBpbGVyT3B0aW9ucykKICAgICAgICBpZiAoX19ERVZfXykgewogICAgICAgICAgZW5kTWVhc3VyZShpbnN0YW5jZSwgYGNvbXBpbGVgKQogICAgICAgIH0KICAgICAgfQogICAgfQoKICAgIGluc3RhbmNlLnJlbmRlciA9IChDb21wb25lbnQucmVuZGVyIHx8IE5PT1ApIGFzIEludGVybmFsUmVuZGVyRnVuY3Rpb24KCiAgICAvLyBmb3IgcnVudGltZS1jb21waWxlZCByZW5kZXIgZnVuY3Rpb25zIHVzaW5nIGB3aXRoYCBibG9ja3MsIHRoZSByZW5kZXIKICAgIC8vIHByb3h5IHVzZWQgbmVlZHMgYSBkaWZmZXJlbnQgYGhhc2AgaGFuZGxlciB3aGljaCBpcyBtb3JlIHBlcmZvcm1hbnQgYW5kCiAgICAvLyBhbHNvIG9ubHkgYWxsb3dzIGEgd2hpdGVsaXN0IG9mIGdsb2JhbHMgdG8gZmFsbHRocm91Z2guCiAgICBpZiAoaW5zdGFsbFdpdGhQcm94eSkgewogICAgICBpbnN0YWxsV2l0aFByb3h5KGluc3RhbmNlKQogICAgfQogIH0KCiAgLy8gc3VwcG9ydCBmb3IgMi54IG9wdGlvbnMKICBpZiAoX19GRUFUVVJFX09QVElPTlNfQVBJX18gJiYgIShfX0NPTVBBVF9fICYmIHNraXBPcHRpb25zKSkgewogICAgY29uc3QgcmVzZXQgPSBzZXRDdXJyZW50SW5zdGFuY2UoaW5zdGFuY2UpCiAgICBwYXVzZVRyYWNraW5nKCkKICAgIHRyeSB7CiAgICAgIGFwcGx5T3B0aW9ucyhpbnN0YW5jZSkKICAgIH0gZmluYWxseSB7CiAgICAgIHJlc2V0VHJhY2tpbmcoKQogICAgICByZXNldCgpCiAgICB9CiAgfQoKICAvLyB3YXJuIG1pc3NpbmcgdGVtcGxhdGUvcmVuZGVyCiAgLy8gdGhlIHJ1CmltcG9ydCB0eXBlIHsgQmFzZVRyYW5zaXRpb25Qcm9wcyB9IGZyb20gJy4vY29tcG9uZW50cy9CYXNlVHJhbnNpdGlvbicKaW1wb3J0IHR5cGUgeyBEZWZpbmVDb21wb25lbnQgfSBmcm9tICcuL2FwaURlZmluZUNvbXBvbmVudCcKaW1wb3J0IHsgbWFya0FzeW5jQm91bmRhcnkgfSBmcm9tICcuL2hlbHBlcnMvdXNlSWQnCmltcG9ydCB7IGlzQXN5bmNXcmFwcGVyIH0gZnJvbSAnLi9hcGlBc3luY0NvbXBvbmVudCcKaW1wb3J0IHR5cGUgeyBSZW5kZXJlckVsZW1lbnQgfSBmcm9tICcuL3JlbmRlcmVyJwoKZXhwb3J0IHR5cGUgRGF0YSA9IFJlY29yZDxzdHJpbmcsIHVua25vd24+CgovKioKICogUHVibGljIHV0aWxpdHkgdHlwZSBmb3IgZXh0cmFjdGluZyB0aGUgaW5zdGFuY2UgdHlwZSBvZiBhIGNvbXBvbmVudC4KICogV29ya3Mgd2l0aCBhbGwgdmFsaWQgY29tcG9uZW50IGRlZmluaXRpb24gdHlwZXMuIFRoaXMgaXMgaW50ZW5kZWQgdG8gcmVwbGFjZQogKiB0aGUgdXNhZ2Ugb2YgYEluc3RhbmNlVHlwZTx0eXBlb2YgQ29tcD5gIHdoaWNoIG9ubHkgd29ya3MgZm9yCiAqIGNvbnN0cnVjdG9yLWJhc2VkIGNvbXBvbmVudCBkZWZpbml0aW9uIHR5cGVzLgogKgogKiBAZXhhbXBsZQogKiBgYGB0cwogKiBjb25zdCBNeUNvbXAgPSB7IC4uLiB9CiAqIGRlY2xhcmUgY29uc3QgaW5zdGFuY2U6IENvbXBvbmVudEluc3RhbmNlPHR5cGVvZiBNeUNvbXA+CiAqIGBgYAogKi8KZXhwb3J0IHR5cGUgQ29tcG9uZW50SW5zdGFuY2U8VD4gPSBUIGV4dGVuZHMgeyBuZXcgKCk6IENvbXBvbmVudFB1YmxpY0luc3RhbmNlIH0KICA/IEluc3RhbmNlVHlwZTxUPgogIDogVCBleHRlbmRzIEZ1bmN0aW9uYWxDb21wb25lbnQ8aW5mZXIgUHJvcHMsIGluZmVyIEVtaXRzPgogICAgPyBDb21wb25lbnRQdWJsaWNJbnN0YW5jZTxQcm9wcywge30sIHt9LCB7fSwge30sIFNob3J0RW1pdHNUb09iamVjdDxFbWl0cz4+CiAgICA6IFQgZXh0ZW5kcyBDb21wb25lbnQ8CiAgICAgICAgICBpbmZlciBQcm9wc09ySW5zdGFuY2UsCiAgICAgICAgICBpbmZlciBSYXdCaW5kaW5ncywKICAgICAgICAgIGluZmVyIEQsCiAgICAgICAgICBpbmZlciBDLAogICAgICAgICAgaW5mZXIgTQogICAgICAgID4KICAgICAgPyBQcm9wc09ySW5zdGFuY2UgZXh0ZW5kcyB7ICRwcm9wczogdW5rbm93biB9CiAgICAgICAgPyAvLyBUIGlzIHJldHVybmVkIGJ5IGBkZWZpbmVDb21wb25lbnQoKWAKICAgICAgICAgIFByb3BzT3JJbnN0YW5jZQogICAgICAgIDogLy8gTk9URSB3ZSBvdmVycmlkZSBQcm9wcy9SYXdCaW5kaW5ncy9EIHRvIG1ha2Ugc3VyZSBpcyBub3QgYHVua25vd25gCiAgICAgICAgICBDb21wb25lbnRQdWJsaWNJbnN0YW5jZTwKICAgICAgICAgICAgdW5rbm93biBleHRlbmRzIFByb3BzT3JJbnN0YW5jZSA/IHt9IDogUHJvcHNPckluc3RhbmNlLAogICAgICAgICAgICB1bmtub3duIGV4dGVuZHMgUmF3QmluZGluZ3MgPyB7fSA6IFJhd0JpbmRpbmdzLAogICAgICAgICAgICB1bmtub3duIGV4dGVuZHMgRCA/IHt9IDogRCwKICAgICAgICAgICAgQywKICAgICAgICAgICAgTQogICAgICAgICAgPgogICAgICA6IG5ldmVyIC8vIG5vdCBhIHZ1ZSBDb21wb25lbnQKCi8qKgogKiBGb3IgZXh0ZW5kaW5nIGFsbG93ZWQgbm9uLWRlY2xhcmVkIHByb3BzIG9uIGNvbXBvbmVudHMgaW4gVFNYCiAqLwpleHBvcnQgaW50ZXJmYWNlIENvbXBvbmVudEN1c3RvbVByb3BzIHt9CgovKioKICogRm9yIGdsb2JhbGx5IGRlZmluZWQgRGlyZWN0aXZlcwogKiBIZXJlIGlzIGFuIGV4YW1wbGUgb2YgYWRkaW5nIGEgZGlyZWN0aXZlIGBWVG9vbHRpcGAgYXMgZ2xvYmFsIGRpcmVjdGl2ZToKICoKICogQGV4YW1wbGUKICogYGBgdHMKICogaW1wb3J0IFZUb29sdGlwIGZyb20gJ3YtdG9vbHRpcCcKICoKICogZGVjbGFyZSBtb2R1bGUgJ0B2dWUvcnVudGltZS1jb3JlJyB7CiAqICAgaW50ZXJmYWNlIEdsb2JhbERpcmVjdGl2ZXMgewogKiAgICAgVlRvb2x0aXAKICogICB9ICAgICAgIC5jYXRjaChlID0+IHsKICAgICAgICAgICAgaGFuZGxlRXJyb3IoZSwgaW5zdGFuY2UsIEVycm9yQ29kZXMuU0VUVVBfRlVOQ1RJT04pCiAgICAgICAgICB9KQogICAgICB9IGVsc2UgaWYgKF9fRkVBVFVSRV9TVVNQRU5TRV9fKSB7CiAgICAgICAgLy8gYXN5bmMgc2V0dXAgcmV0dXJuZWQgUHJvbWlzZS4KICAgICAgICAvLyBiYWlsIGhlcmUgYW5kIHdhaXQgZm9yIHJlLWVudHJ5LgogICAgICAgIGluc3RhbmNlLmFzeW5jRGVwID0gc2V0dXBSZXN1bHQKICAgICAgICBpZiAoX19ERVZfXyAmJiAhaW5zdGFuY2Uuc3VzcGVuc2UpIHsKICAgICAgICAgIGNvbnN0IG5hbWUgPSBmb3JtYXRDb21wb25lbnROYW1lKGluc3RhbmNlLCBDb21wb25lbnQpCiAgICAgICAgICB3YXJuKAogICAgICAgICAgICBgQ29tcG9uZW50IDwke25hbWV9Pjogc2V0dXAgZnVuY3Rpb24gcmV0dXJuZWQgYSBwcm9taXNlLCBidXQgbm8gYCArCiAgICAgICAgICAgICAgYDxTdXNwZW5zZT4gYm91bmRhcnkgd2FzIGZvdW5kIGluIHRoZSBwYXJlbnQgY29tcG9uZW50IHRyZWUuIGAgKwogICAgICAgICAgICAgIGBBIGNvbXBvbmVudCB3aXRoIGFzeW5jIHNldHVwKCkgbXVzdCBiZSBuZXN0ZWQgaW4gYSA8U3VzcGVuc2U+IGAgKwogICAgICAgICAgICAgIGBpbiBvcmRlciB0byBiZSByZW5kZXJlZC5gLAogICAgICAgICAgKQogICAgICAgIH0KICAgICAgfSBlbHNlIGlmIChfX0RFVl9fKSB7CiAgICAgICAgd2FybigKICAgICAgICAgIGBzZXR1cCgpIHJldHVybmVkIGEgUHJvbWlzZSwgYnV0IHRoZSB2ZXJzaW9uIG9mIFZ1ZSB5b3UgYXJlIHVzaW5nIGAgKwogICAgICAgICAgICBgZG9lcyBub3Qgc3VwcG9ydCBpdCB5ZXQuYCwKICAgICAgICApCiAgICAgIH0KICAgIH0gZWxzZSB7CiAgICAgIGhhbmRsZVNldHVwUmVzdWx0KGluc3RhbmNlLCBzZXR1cFJlc3VsdCwgaXNTU1IpCiAgICB9CiAgfSBlbHNlIHsKICAgIGZpbmlzaENvbXBvbmVudFNldHVwKGluc3RhbmNlLCBpc1NTUikKICB9Cn0KCmV4cG9ydCBmdW5jdGlvbiBoYW5kbGVTZXR1cFJlc3VsdCgKICBpbnN0YW5jZTogQ29tcG9uZW50SW50ZXJuYWxJbnN0YW5jZSwKICBzZXR1cFJlc3VsdDogdW5rbm93biwKICBpc1NTUjogYm9vbGVhbiwKKTogdm9pZCB7CiAgaWYgKGlzRnVuY3Rpb24oc2V0dXBSZXN1bHQpKSB7CiAgICAvLyBzZXR1cCByZXR1cm5lZCBhbiBpbmxpbmUgcmVuZGVyIGZ1bmN0aW9uCiAgICBpZiAoX19TU1JfXyAmJiAoaW5zdGFuY2UudHlwZSBhcyBDb21wb25lbnRPcHRpb25zKS5fX3NzcklubGluZVJlbmRlcikgewogICAgICAvLyB3aGVuIHRoZSBmdW5jdGlvbidzIG5hbWUgaXMgYHNzclJlbmRlcmAgKGNvbXBpbGVkIGJ5IFNGQyBpbmxpbmUgbW9kZSksCiAgICAgIC8vIHNldCBpdCBhcyBzc3JSZW5kZXIgaW5zdGVhZC4KICAgICAgaW5zdGFuY2Uuc3NyUmVuZGVyID0gc2V0dXBSZXN1bHQKICAgIH0gZWxzZSB7CiAgICAgIGluc3RhbmNlLnJlbmRlciA9IHNldHVwUmVzdWx0IGFzIEludGVybmFsUmVuZGVyRnVuY3Rpb24KICAgIH0KICB9IGVsc2UgaWYgKGlzT2JqZWN0KHNldHVwUmVzdWx0KSkgewogICAgaWYgKF9fREVWX18gJiYgaXNWTm9kZShzZXR1cFJlc3VsdCkpIHsKICAgICAgd2FybigKICAgICAgICBgc2V0dXAoKSBzaG91bGQgbm90IHJldHVybiBWTm9kZXMgZGlyZWN0bHkgLSBgICsKICAgICAgICAgIGByZXR1cm4gYSByZW5kZXIgZnVuY3Rpb24gaW5zdGVhZC5gLAogICAgICApCiAgICB9CiAgICAvLyBzZXR1cCByZXR1cm5lZCBiaW5kaW5ncy4KICAgIC8vIGFzc3VtaW5nIGEgcmVuZGVyIGZ1bmN0aW9uIGNvbXBpbGVkIGZyb20gdGVtcGxhdGUgaXMgcHJlc2VudC4KICAgIGlmIChfX0RFVl9fIHx8IF9fRkVBVFVSRV9QUk9EX0RFVlRPT0xTX18pIHsKICAgICAgaW5zdGFuY2UuZGV2dG9vbHNSYXdTZXR1cFN0YXRlID0gc2V0dXBSZXN1bHQKICAgIH0KICAgIGluc3RhbmNlLnNldHVwU3RhdGUgPSBwcm94eVJlZnMoc2V0dXBSZXN1bHQpCiAgICBpIG51bGwKICAvKioKICAgKiBSb290IHZub2RlIG9mIHRoaXMgY29tcG9uZW50J3Mgb3duIHZkb20gdHJlZQogICAqLwogIHN1YlRyZWU6IFZOb2RlCiAgLyoqCiAgICogUmVuZGVyIGVmZmVjdCBpbnN0YW5jZQogICAqLwogIGVmZmVjdDogUmVhY3RpdmVFZmZlY3QKICAvKioKICAgKiBGb3JjZSB1cGRhdGUgcmVuZGVyIGVmZmVjdAogICAqLwogIHVwZGF0ZTogKCkgPT4gdm9pZAogIC8qKgogICAqIFJlbmRlciBlZmZlY3Qgam9iIHRvIGJlIHBhc3NlZCB0byBzY2hlZHVsZXIgKGNoZWNrcyBpZiBkaXJ0eSkKICAgKi8KICBqb2I6IFNjaGVkdWxlckpvYgogIC8qKgogICAqIFRoZSByZW5kZXIgZnVuY3Rpb24gdGhhdCByZXR1cm5zIHZkb20gdHJlZS4KICAgKiBAaW50ZXJuYWwKICAgKi8KICByZW5kZXI6IEludGVybmFsUmVuZGVyRnVuY3Rpb24gfCBudWxsCiAgLyoqCiAgICogU1NSIHJlbmRlciBmdW5jdGlvbgogICAqIEBpbnRlcm5hbAogICAqLwogIHNzclJlbmRlcj86IEZ1bmN0aW9uIHwgbnVsbAogIC8qKgogICAqIE9iamVjdCBjb250YWluaW5nIHZhbHVlcyB0aGlzIGNvbXBvbmVudCBwcm92aWRlcyBmb3IgaXRzIGRlc2NlbmRhbnRzCiAgICogQGludGVybmFsCiAgICovCiAgcHJvdmlkZXM6IERhdGEKICAvKioKICAgKiBmb3IgdHJhY2tpbmcgdXNlSWQoKQogICAqIGZpcnN0IGVsZW1lbnQgaXMgdGhlIGN1cnJlbnQgYm91bmRhcnkgcHJlZml4CiAgICogc2Vjb25kIG51bWJlciBpcyB0aGUgaW5kZXggb2YgdGhlIHVzZUlkIGNhbGwgd2l0aGluIHRoYXQgYm91bmRhcnkKICAgKiBAaW50ZXJuYWwKICAgKi8KICBpZHM6IFtzdHJpbmcsIG51bWJlciwgbnVtYmVyXQogIC8qKgogICAqIFRyYWNraW5nIHJlYWN0aXZlIGVmZmVjdHMgKGUuZy4gd2F0Y2hlcnMpIGFzc29jaWF0ZWQgd2l0aCB0aGlzIGNvbXBvbmVudAogICAqIHNvIHRoYXQgdGhleSBjYW4gYmUgYXV0b21hdGljYWxseSBzdG9wcGVkIG9uIGNvbXBvbmVudCB1bm1vdW50CiAgICogQGludGVybmFsCiAgICovCiAgc2NvcGU6IEVmZmVjdFNjb3BlCiAgLyoqCiAgICogY2FjaGUgZm9yIHByb3h5IGFjY2VzcyB0eXBlIHRvIGF2b2lkIGhhc093blByb3BlcnR5IGNhbGxzCiAgICogQGludGVybmFsCiAgICovCiAgYWNjZXNzQ2FjaGU6IERhdGEgfCBudWxsCiAgLyoqCiAgICogY2FjaGUgZm9yIHJlbmRlciBmdW5jdGlvbiB2YWx1ZXMgdGhhdCByZWx5IG9uIF9jdHggYnV0IHdvbid0IG5lZWQgdXBkYXRlcwogICAqIGFmdGVyIGluaXRpYWxpemVkIChlLmcuIGlubGluZSBoYW5kbGVycykKICAgKiBAaW50ZXJuYWwKICAgKi8KICByZW5kZXJDYWNoZTogKEZ1bmN0aW9uIHwgVk5vZGUgfCB1bmRlZmluZWQpW10KCiAgLyoqCiAgICogUmVzb2x2ZWQgY29tcG9uZW50IHJlZ2lzdHJ5LCBvbmx5IGZvciBjb21wb25lbnRzIHdpdGggbWl4aW5zIG9yIGV4dGVuZHMKICAgKiBAaW50ZXJuYWwKICAgKi8KICBjb21wb25lbnRzOiBSZWNvcmQ8c3RyaW5nLCBDb25jcmV0ZUNvbXBvbmVudD4gfCBudWxsCiAgLyoqCiAgICogUmVzb2x2ZWQgZGlyZWN0aXZlIHJlZ2lzdHJ5LCBvbmx5IGZvciBjb21wb25lbnRzIHdpdGggbWl4aW5zIG9yIGV4dGVuZHMKICAgKiBAaW50ZXJuYWwKICAgKi8KICBkaXJlY3RpdmVzOiBSZWNvcmQ8c3RyaW5nLCBEaXJlY3RpdmU+IHwgbnVsbAogIC8qKgogICAqIFJlc29sdmVkIGZpbHRlcnMgcmVnaXN0cnksIHYyIGNvbXBhdCBvbmx5CiAgICogQGludGVybmFsCiAgICovCiAgZmlsdGVycz86IFJlY29yZDxzdHJpbmcsIEZ1bmN0aW9uPgogIC8qKgogICAqIHJlc29sdmVkIHByb3BzIG9wdGlvbnMKICAgKiBAaW50ZXJuYWwKICAgKi8KICBwcm9wc09wdGlvbnM6IE5vcm1hbGl6ZWRQcm9wc09wdGlvbnMKICAvKioKICAgKiByZXNvbHZlZCBlbWl0cyBvcHRpb25zCiAgICogQGludGVybmFsCiAgICovCiAgZW1pdHNPcHRpb25zOiBPYmplY3RFbWl0c09wdGlvbnMgfCBudWxsCiAgLyoqCiAgICogcmVzb2x2ZWQgaW5oZXJpdEF0dHJzIG9wdGlvcnVudGltZSBjb21waWxhdGlvbiBvZiB0ZW1wbGF0ZSBpbiBTU1IgaXMgZG9uZSBieSBzZXJ2ZXItcmVuZGVyCiAgaWYgKF9fREVWX18gJiYgIUNvbXBvbmVudC5yZW5kZXIgJiYgaW5zdGFuY2UucmVuZGVyID09PSBOT09QICYmICFpc1NTUikgewogICAgaWYgKCFjb21waWxlICYmIENvbXBvbmVudC50ZW1wbGF0ZSkgewogICAgICAvKiB2OCBpZ25vcmUgc3RhcnQgKi8KICAgICAgd2FybigKICAgICAgICBgQ29tcG9uZW50IHByb3ZpZGVkIHRlbXBsYXRlIG9wdGlvbiBidXQgYCArCiAgICAgICAgICBgcnVudGltZSBjb21waWxhdGlvbiBpcyBub3Qgc3VwcG9ydGVkIGluIHRoaXMgYnVpbGQgb2YgVnVlLmAgKwogICAgICAgICAgKF9fRVNNX0JVTkRMRVJfXwogICAgICAgICAgICA/IGAgQ29uZmlndXJlIHlvdXIgYnVuZGxlciB0byBhbGlhcyAidnVlIiB0byAidnVlL2Rpc3QvdnVlLmVzbS1idW5kbGVyLmpzIi5gCiAgICAgICAgICAgIDogX19FU01fQlJPV1NFUl9fCiAgICAgICAgICAgICAgPyBgIFVzZSAidnVlLmVzbS1icm93c2VyLmpzIiBpbnN0ZWFkLmAKICAgICAgICAgICAgICA6IF9fR0xPQkFMX18KICAgICAgICAgICAgICAgID8gYCBVc2UgInZ1ZS5nbG9iYWwuanMiIGluc3RlYWQuYAogICAgICAgICAgICAgICAgOiBgYCkgLyogc2hvdWxkIG5vdCBoYXBwZW4gKi8sCiAgICAgICkKICAgICAgLyogdjggaWdub3JlIHN0b3AgKi8KICAgIH0gZWxzZSB7CiAgICAgIHdhcm4oYENvbXBvbmVudCBpcyBtaXNzaW5nIHRlbXBsYXRlIG9yIHJlbmRlciBmdW5jdGlvbjogYCwgQ29tcG9uZW50KQogICAgfQogIH0KfQoKY29uc3QgYXR0cnNQcm94eUhhbmRsZXJzID0gX19ERVZfXwogID8gewogICAgICBnZXQodGFyZ2V0OiBEYXRhLCBrZXk6IHN0cmluZykgewogICAgICAgIG1hcmtBdHRyc0FjY2Vzc2VkKCkKICAgICAgICB0cmFjayh0YXJnZXQsIFRyYWNrT3BUeXBlcy5HRVQsICcnKQogICAgICAgIHJldHVybiB0YXJnZXRba2V5XQogICAgICB9LAogICAgICBzZXQoKSB7CiAgICAgICAgd2Fybihgc2V0dXBDb250ZXh0LmF0dHJzIGlzIHJlYWRvbmx5LmApCiAgICAgICAgcmV0dXJuIGZhbHNlCiAgICAgIH0sCiAgICAgIGRlbGV0ZVByb3BlcnR5KCkgewogICAgICAgIHdhcm4oYHNldHVwQ29udGV4dC5hdHRycyBpcyByZWFkb25seS5gKQogICAgICAgIHJldHVybiBmYWxzZQogICAgICB9LAogICAgfQogIDogewogICAgICBnZXQodGFyZ2V0OiBEYXRhLCBrZXk6IHN0cmluZykgewogICAgICAgIHRyYWNrKHRhcmdldCwgVHJhY2tPcFR5cGVzLkdFVCwgJycpCiAgICAgICAgcmV0dXJuIHRhcmdldFtrZXldCiAgICAgIH0sCiAgICB9CgovKioKICogRGV2LW9ubHkKICovCmZ1bmN0aW9uIGdldFNsb3RzUHJveHkoaW5zdGFuY2U6IENvbXBvbmVudEludGVybmFsSW5zdGFuY2UpOiBTbG90cyB7CiAgcmV0dXJuIG5ldyBQcm94eShpbnN0YW5jZS5zbG90cywgewogICAgZ2V0KHRhcmdldCwga2V5OiBzdHJpbmcpIHsKICAgICAgdHJhY2soaW5zdGFuY2UsIFRyYWNrT3BUeXBlcy5HRVQsICckc2xvdHMnKQogICAgICByZXR1cm4gdGFyZ2V0W2tleV0KICAgIH0sCiAgfSkKfQoKZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZVNldHVwQ29udGV4dCgKICBpbnN0YW5jZTogQ29tcG9uZW50SW50ZXJuYWxJbnN0YW5jZSwKKTogU2V0dXBDb250ZXh0IHsKICBjb25zdCBleHBvc2U6IFNldHVwQ29udGV4dFsnZXhwb3NlJ10gPSBleHBvc2VkID0+IHsKICAgIGlmIChfX0RFVl9fKSB7CiAgICAgIGlmIChpbnN0YW5jZS5leHBvc2VkKSB7CiAgICAgICAgd2FybihgZXhwb3NlKCkgc2hvdWxkIGJlIGNhbGxlZCBvbmx5IG9uY2UgcGVyIHNldHVwKCkuYCkKICAgICAgfQogICAgICBpZiAoZXhwb3NlZCAhPSBudWxsKSB7CiAgICAgICAgbGV0IGV4cG9zZWRUeXBlOiBzdHJpbmcgPSB0eXBlb2YgZXhwb3NlZAogICAgICAgIGlmIChleHBvc2VkVHlwZSA9PT0gJ29iamVjdCcpIHsKICAgICAgICAgIGlmIChpc0FycmF5KGV4cG9zZWQpKSB7CiAgbnQgaXMgY3JlYXRlZCBieSBkZWZpbmVDdXN0b21FbGVtZW50KQogICAqIEBpbnRlcm5hbAogICAqLwogIGNlPzogQ29tcG9uZW50Q3VzdG9tRWxlbWVudEludGVyZmFjZQogIC8qKgogICAqIGlzIGN1c3RvbSBlbGVtZW50PyAoa2VwdCBvbmx5IGZvciBjb21wYXRpYmlsaXR5KQogICAqIEBpbnRlcm5hbAogICAqLwogIGlzQ0U/OiBib29sZWFuCiAgLyoqCiAgICogY3VzdG9tIGVsZW1lbnQgc3BlY2lmaWMgSE1SIG1ldGhvZAogICAqIEBpbnRlcm5hbAogICAqLwogIGNlUmVsb2FkPzogKG5ld1N0eWxlcz86IHN0cmluZ1tdKSA9PiB2b2lkCgogIC8vIHRoZSByZXN0IGFyZSBvbmx5IGZvciBzdGF0ZWZ1bCBjb21wb25lbnRzIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQoKICAvLyBtYWluIHByb3h5IHRoYXQgc2VydmVzIGFzIHRoZSBwdWJsaWMgaW5zdGFuY2UgKGB0aGlzYCkKICBwcm94eTogQ29tcG9uZW50UHVibGljSW5zdGFuY2UgfCBudWxsCgogIC8vIGV4cG9zZWQgcHJvcGVydGllcyB2aWEgZXhwb3NlKCkKICBleHBvc2VkOiBSZWNvcmQ8c3RyaW5nLCBhbnk+IHwgbnVsbAogIGV4cG9zZVByb3h5OiBSZWNvcmQ8c3RyaW5nLCBhbnk+IHwgbnVsbAoKICAvKioKICAgKiBhbHRlcm5hdGl2ZSBwcm94eSB1c2VkIG9ubHkgZm9yIHJ1bnRpbWUtY29tcGlsZWQgcmVuZGVyIGZ1bmN0aW9ucyB1c2luZwogICAqIGB3aXRoYCBibG9jawogICAqIEBpbnRlcm5hbAogICAqLwogIHdpdGhQcm94eTogQ29tcG9uZW50UHVibGljSW5zdGFuY2UgfCBudWxsCiAgLyoqCiAgICogVGhpcyBpcyB0aGUgdGFyZ2V0IGZvciB0aGUgcHVibGljIGluc3RhbmNlIHByb3h5LiBJdCBhbHNvIGhvbGRzIHByb3BlcnRpZXMKICAgKiBpbmplY3RlZCBieSB1c2VyIG9wdGlvbnMgKGNvbXB1dGVkLCBtZXRob2RzIGV0Yy4pIGFuZCB1c2VyLWF0dGFjaGVkCiAgICogY3VzdG9tIHByb3BlcnRpZXMgKHZpYSBgdGhpcy54ID0gLi4uYCkKICAgKiBAaW50ZXJuYWwKICAgKi8KICBjdHg6IERhdGEKCiAgLy8gc3RhdGUKICBkYXRhOiBEYXRhCiAgcHJvcHM6IERhdGEKICBhdHRyczogRGF0YQogIHNsb3RzOiBJbnRlcm5hbFNsb3RzCiAgcmVmczogRGF0YQogIGVtaXQ6IEVtaXRGbgoKICAvKioKICAgKiB1c2VkIGZvciBrZWVwaW5nIHRyYWNrIG9mIC5vbmNlIGV2ZW50IGhhbmRsZXJzIG9uIGNvbXBvbmVudHMKICAgKiBAaW50ZXJuYWwKICAgKi8KICBlbWl0dGVkOiBSZWNvcmQ8c3RyaW5nLCBib29sZWFuPiB8IG51bGwKICAvKioKICAgKiB1c2VkIGZvciBjYWNoaW5nIHRoZSB2YWx1ZSByZXR1cm5lZCBmcm9tIHByb3BzIGRlZmF1bHQgZmFjdG9yeSBmdW5jdGlvbnMgdG8KICAgKiBhdm9pZCB1bm5lY2Vzc2FyeSB3YXRjaGVyIHRyaWdnZXIKICAgKiBAaW50ZXJuYWwKICAgKi8KICBwcm9wc0RlZmF1bHRzOiBEYXRhCiAgLyoqCiAgICogc2V0dXAgcmVsYXRlZAogICAqIEBpbnRlcm5hbAogICAqLwogIHNldHVwU3RhdGU6IERhdGEKICAvKioKICAgKiBkZXZ0b29scyBhY2Nlc3MgdG8gYWRkaXRpb25hbCBpbmZvCiAgICogQGludGVybmFsCiAgICovCiAgZGV2dG9vbHNSYXdTZXR1cFN0YXRlPzogYW55CiAgLyoqCiAgICogQGludGVybmFsCiAgICovCiAgc2V0dXBDb250ZXh0OiBTZXR1cENvbnRleHQgfCBudWxsCgogIC8qKgogICAqIHN1c3BlbnNlIHJlbGF0ZWQKICAgKiBAaW50ZXJuYWwKICAgKi8KICBzdXNwZW5zZTogU3VzcGVuc2VCb3VuZGFyeSB8IG51bGwKICAvKioKICAgKiBzdXNwZW5zZSBwZW5kaW5nIGJhdGNoIGlkCiAgICogQGludGVybmFsCiAgICovCiAgc3VzcGVuc2VJZDogbnVtYmVyCiAgLyoqCiAgICogQGludGVybmFsCiAgICovCiAgYXN5bmNEZXA6IFByb21pc2U8YW55PiB8IG51bGwKICAvKioKICAgKiBAaW50ZXJuYWwKICAgKi8KICBhc3luY1Jlc29sdmVkOiBib29sZWFuCgogIC8vIGxpZmVjeWNsZQogIGlzTW91bnRlZDogYm9vbGVhbgogIGlzVW5tb3VudGVkOiBib29sZWFuCiAgaXNEZWFjdGl2YXRlZDogID0gbmV3IFByb3h5KHByb3h5UmVmcyhtYXJrUmF3KGluc3RhbmNlLmV4cG9zZWQpKSwgewogICAgICAgIGdldCh0YXJnZXQsIGtleTogc3RyaW5nKSB7CiAgICAgICAgICBpZiAoa2V5IGluIHRhcmdldCkgewogICAgICAgICAgICByZXR1cm4gdGFyZ2V0W2tleV0KICAgICAgICAgIH0gZWxzZSBpZiAoa2V5IGluIHB1YmxpY1Byb3BlcnRpZXNNYXApIHsKICAgICAgICAgICAgcmV0dXJuIHB1YmxpY1Byb3BlcnRpZXNNYXBba2V5XShpbnN0YW5jZSkKICAgICAgICAgIH0KICAgICAgICB9LAogICAgICAgIGhhcyh0YXJnZXQsIGtleTogc3RyaW5nKSB7CiAgICAgICAgICByZXR1cm4ga2V5IGluIHRhcmdldCB8fCBrZXkgaW4gcHVibGljUHJvcGVydGllc01hcAogICAgICAgIH0sCiAgICAgIH0pKQogICAgKQogIH0gZWxzZSB7CiAgICByZXR1cm4gaW5zdGFuY2UucHJveHkKICB9Cn0KCmNvbnN0IGNsYXNzaWZ5UkUgPSAvKD86XnxbLV9dKVx3L2cKY29uc3QgY2xhc3NpZnkgPSAoc3RyOiBzdHJpbmcpOiBzdHJpbmcgPT4KICBzdHIucmVwbGFjZShjbGFzc2lmeVJFLCBjID0+IGMudG9VcHBlckNhc2UoKSkucmVwbGFjZSgvWy1fXS9nLCAnJykKCmV4cG9ydCBmdW5jdGlvbiBnZXRDb21wb25lbnROYW1lKAogIENvbXBvbmVudDogQ29uY3JldGVDb21wb25lbnQsCiAgaW5jbHVkZUluZmVycmVkID0gdHJ1ZSwKKTogc3RyaW5nIHwgZmFsc2UgfCB1bmRlZmluZWQgewogIHJldHVybiBpc0Z1bmN0aW9uKENvbXBvbmVudCkKICAgID8gQ29tcG9uZW50LmRpc3BsYXlOYW1lIHx8IENvbXBvbmVudC5uYW1lCiAgICA6IENvbXBvbmVudC5uYW1lIHx8IChpbmNsdWRlSW5mZXJyZWQgJiYgQ29tcG9uZW50Ll9fbmFtZSkKfQoKZXhwb3J0IGZ1bmN0aW9uIGZvcm1hdENvbXBvbmVudE5hbWUoCiAgaW5zdGFuY2U6IENvbXBvbmVudEludGVybmFsSW5zdGFuY2UgfCBudWxsLAogIENvbXBvbmVudDogQ29uY3JldGVDb21wb25lbnQsCiAgaXNSb290ID0gZmFsc2UsCik6IHN0cmluZyB7CiAgbGV0IG5hbWUgPSBnZXRDb21wb25lbnROYW1lKENvbXBvbmVudCkKICBpZiAoIW5hbWUgJiYgQ29tcG9uZW50Ll9fZmlsZSkgewogICAgY29uc3QgbWF0Y2ggPSBDb21wb25lbnQuX19maWxlLm1hdGNoKC8oW14vXFxdKylcLlx3KyQvKQogICAgaWYgKG1hdGNoKSB7CiAgICAgIG5hbWUgPSBtYXRjaFsxXQogICAgfQogIH0KCiAgaWYgKCFuYW1lICYmIGluc3RhbmNlKSB7CiAgICAvLyB0cnkgdG8gaW5mZXIgdGhlIG5hbWUgYmFzZWQgb24gcmV2ZXJzZSByZXNvbHV0aW9uCiAgICBjb25zdCBpbmZlckZyb21SZWdpc3RyeSA9ICgKICAgICAgcmVnaXN0cnk6IFJlY29yZDxzdHJpbmcsIGFueT4gfCB1bmRlZmluZWQgfCBudWxsLAogICAgKSA9PiB7CiAgICAgIGZvciAoY29uc3Qga2V5IGluIHJlZ2lzdHJ5KSB7CiAgICAgICAgaWYgKHJlZ2lzdHJ5W2tleV0gPT09IENvbXBvbmVudCkgewogICAgICAgICAgcmV0dXJuIGtleQogICAgICAgIH0KICAgICAgfQogICAgfQogICAgbmFtZSA9CiAgICAgIGluZmVyRnJvbVJlZ2lzdHJ5KGluc3RhbmNlLmNvbXBvbmVudHMpIHx8CiAgICAgIChpbnN0YW5jZS5wYXJlbnQgJiYKICAgICAgICBpbmZlckZyb21SZWdpc3RyeSgKICAgICAgICAgIChpbnN0YW5jZS5wYXJlbnQudHlwZSBhcyBDb21wb25lbnRPcHRpb25zKS5jb21wb25lbnRzLAogICAgICAgICkpIHx8CiAgICAgIGluZmVyRnJvbVJlZ2lzdHJ5KGluc3RhbmNlLmFwcENvbnRleHQuY29tcG9uZW50cykKICB9CgogIHJldHVybiBuYW1lID8gY2xhc3NpZnkobmFtZSkgOiBpc1Jvb3QgPyBgQXBwYCA6IGBBbm9ueW1vdXNgCn0KCmV4cG9ydCBmdW5jdGlvbiBpc0NsYXNzQ29tcG9uZW50KHZhbHVlOiB1bmtub3duKTogdmFsdWUgaXMgQ2xhc3NDb21wb25lbnQgewogIHJldHVybiBpc0Z1bmN0aW9uKHZhbHVlKSAmJiAnX192Y2NPcHRzJyBpbiB2YWx1ZQp9CgpleHBvcnQgaW50ZXJmYWNlIENvbXBvbmVudEN1c3RvbUVsZW1lbnRJbnRlcmZhY2UgewogIC8qdCBpbnRlcmZhY2UgR2xvYmFsRGlyZWN0aXZlcyB7fQoKLyoqCiAqIEZvciBnbG9iYWxseSBkZWZpbmVkIENvbXBvbmVudHMKICogSGVyZSBpcyBhbiBleGFtcGxlIG9mIGFkZGluZyBhIGNvbXBvbmVudCBgUm91dGVyVmlld2AgYXMgZ2xvYmFsIGNvbXBvbmVudDoKICoKICogQGV4YW1wbGUKICogYGBgdHMKICogaW1wb3J0IHsgUm91dGVyVmlldyB9IGZyb20gJ3Z1ZS1yb3V0ZXInCiAqCiAqIGRlY2xhcmUgbW9kdWxlICdAdnVlL3J1bnRpbWUtY29yZScgewogKiAgIGludGVyZmFjZSBHbG9iYWxDb21wb25lbnRzIHsKICogICAgIFJvdXRlclZpZXcKICogICB9CiAqIH0KICogYGBgCiAqLwpleHBvcnQgaW50ZXJmYWNlIEdsb2JhbENvbXBvbmVudHMgewogIFRlbGVwb3J0OiBEZWZpbmVDb21wb25lbnQ8VGVsZXBvcnRQcm9wcz4KICBTdXNwZW5zZTogRGVmaW5lQ29tcG9uZW50PFN1c3BlbnNlUHJvcHM+CiAgS2VlcEFsaXZlOiBEZWZpbmVDb21wb25lbnQ8S2VlcEFsaXZlUHJvcHM+CiAgQmFzZVRyYW5zaXRpb246IERlZmluZUNvbXBvbmVudDxCYXNlVHJhbnNpdGlvblByb3BzPgp9CgovKioKICogRGVmYXVsdCBhbGxvd2VkIG5vbi1kZWNsYXJlZCBwcm9wcyBvbiBjb21wb25lbnQgaW4gVFNYCiAqLwpleHBvcnQgaW50ZXJmYWNlIEFsbG93ZWRDb21wb25lbnRQcm9wcyB7CiAgY2xhc3M/OiB1bmtub3duCiAgc3R5bGU/OiB1bmtub3duCn0KCi8vIE5vdGU6IGNhbid0IG1hcmsgdGhpcyB3aG9sZSBpbnRlcmZhY2UgaW50ZXJuYWwgYmVjYXVzZSBzb21lIHB1YmxpYyBpbnRlcmZhY2VzCi8vIGV4dGVuZCBpdC4KZXhwb3J0IGludGVyZmFjZSBDb21wb25lbnRJbnRlcm5hbE9wdGlvbnMgewogIC8qKgogICAqIEBpbnRlcm5hbAogICAqLwogIF9fc2NvcGVJZD86IHN0cmluZwogIC8qKgogICAqIEBpbnRlcm5hbAogICAqLwogIF9fY3NzTW9kdWxlcz86IERhdGEKICAvKioKICAgKiBAaW50ZXJuYWwKICAgKi8KICBfX2htcklkPzogc3RyaW5nCiAgLyoqCiAgICogQ29tcGF0IGJ1aWxkIG9ubHksIGZvciBiYWlsaW5nIG91dCBvZiBjZXJ0YWluIGNvbXBhdGliaWxpdHkgYmVoYXZpb3IKICAgKi8KICBfX2lzQnVpbHRJbj86IGJvb2xlYW4KICAvKioKICAgKiBUaGlzIG9uZSBzaG91bGQgYmUgZXhwb3NlZCBzbyB0aGF0IGRldnRvb2xzIGNhbiBtYWtlIHVzZSBvZiBpdAogICAqLwogIF9fZmlsZT86IHN0cmluZwogIC8qKgogICAqIG5hbWUgaW5mZXJyZWQgZnJvbSBmaWxlbmFtZQogICAqLwogIF9fbmFtZT86IHN0cmluZwp9CgpleHBvcnQgaW50ZXJmYWNlIEZ1bmN0aW9uYWxDb21wb25lbnQ8CiAgUCA9IHt9LAogIEUgZXh0ZW5kcyBFbWl0c09wdGlvbnMgfCBSZWNvcmQ8c3RyaW5nLCBhbnlbXT4gPSB7fSwKICBTIGV4dGVuZHMgUmVjb3JkPHN0cmluZywgYW55PiA9IGFueSwKICBFRSBleHRlbmRzIEVtaXRzT3B0aW9ucyA9IFNob3J0RW1pdHNUb09iamVjdDxFPiwKPiBleHRlbmRzIENvbXBvbmVudEludGVybmFsT3B0aW9ucyB7CiAgLy8gdXNlIG9mIGFueSBoZXJlIGlzIGludGVudGlvbmFsIHNvIGl0IGNhbiBiZSBhIHZhbGlkIEpTWCBFbGVtZW50IGNvbnN0cnVjdG9yCiAgKAogICAgcHJvcHM6IFAgJiBFbWl0c1RvUHJvcHM8RUU+LAogICAgY3R4OiBPbWl0PFNldHVwQ29udGV4dDxFRSwgSWZBbnk8Uywge30sIFNsb3RzVHlwZTxTPj4+LCAnZXhwb3NlJz4sCiAgKTogYW55CiAgcHJvcHM/OiBDb21wb25lbnRQcm9wc09wdGlvbnM8UD4KICBlbWl0cz86IEVFIHwgKGtleW9mIEVFKVtdCiAgc2xvdHM/OiBJZkFueTxTLCBTbG90cywgU2xvdHNUeXBlPFM+PgogIGluaGVyaXRBdHRycz86IGJvb2xlYW4KICBkaXNwbGF5TmFtZT86IHN0cmluZwogIGNvbXBhdENvbmZpZz86IENvbXBhdENvbmZpZwp9CgpleHBvcnQgaW50ZXJmYWNlIENsYXNzQ29tcG9uZW50IHsKICBuZXcgKC4uLmFyZ3M6IGFueVtdKTogQ29tcG9uZW50UHVibGljSW5zdGFuY2U8YW55LCBhbnksIGFueSwgYW55LCBhbnk+CiAgX192Y2NPcHRzOiBDb21wJy4vYmFzZUhhbmRsZXJzJwppbXBvcnQgewogIG11dGFibGVDb2xsZWN0aW9uSGFuZGxlcnMsCiAgcmVhZG9ubHlDb2xsZWN0aW9uSGFuZGxlcnMsCiAgc2hhbGxvd0NvbGxlY3Rpb25IYW5kbGVycywKICBzaGFsbG93UmVhZG9ubHlDb2xsZWN0aW9uSGFuZGxlcnMsCn0gZnJvbSAnLi9jb2xsZWN0aW9uSGFuZGxlcnMnCmltcG9ydCB0eXBlIHsgUmF3U3ltYm9sLCBSZWYsIFVud3JhcFJlZlNpbXBsZSB9IGZyb20gJy4vcmVmJwppbXBvcnQgeyBSZWFjdGl2ZUZsYWdzIH0gZnJvbSAnLi9jb25zdGFudHMnCmltcG9ydCB7IHdhcm4gfSBmcm9tICcuL3dhcm5pbmcnCgpleHBvcnQgaW50ZXJmYWNlIFRhcmdldCB7CiAgW1JlYWN0aXZlRmxhZ3MuU0tJUF0/OiBib29sZWFuCiAgW1JlYWN0aXZlRmxhZ3MuSVNfUkVBQ1RJVkVdPzogYm9vbGVhbgogIFtSZWFjdGl2ZUZsYWdzLklTX1JFQURPTkxZXT86IGJvb2xlYW4KICBbUmVhY3RpdmVGbGFncy5JU19TSEFMTE9XXT86IGJvb2xlYW4KICBbUmVhY3RpdmVGbGFncy5SQVddPzogYW55Cn0KCmV4cG9ydCBjb25zdCByZWFjdGl2ZU1hcDogV2Vha01hcDxUYXJnZXQsIGFueT4gPSBuZXcgV2Vha01hcDxUYXJnZXQsIGFueT4oKQpleHBvcnQgY29uc3Qgc2hhbGxvd1JlYWN0aXZlTWFwOiBXZWFrTWFwPFRhcmdldCwgYW55PiA9IG5ldyBXZWFrTWFwPAogIFRhcmdldCwKICBhbnkKPigpCmV4cG9ydCBjb25zdCByZWFkb25seU1hcDogV2Vha01hcDxUYXJnZXQsIGFueT4gPSBuZXcgV2Vha01hcDxUYXJnZXQsIGFueT4oKQpleHBvcnQgY29uc3Qgc2hhbGxvd1JlYWRvbmx5TWFwOiBXZWFrTWFwPFRhcmdldCwgYW55PiA9IG5ldyBXZWFrTWFwPAogIFRhcmdldCwKICBhbnkKPigpCgplbnVtIFRhcmdldFR5cGUgewogIElOVkFMSUQgPSAwLAogIENPTU1PTiA9IDEsCiAgQ09MTEVDVElPTiA9IDIsCn0KCmZ1bmN0aW9uIHRhcmdldFR5cGVNYXAocmF3VHlwZTogc3RyaW5nKSB7CiAgc3dpdGNoIChyYXdUeXBlKSB7CiAgICBjYXNlICdPYmplY3QnOgogICAgY2FzZSAnQXJyYXknOgogICAgICByZXR1cm4gVGFyZ2V0VHlwZS5DT01NT04KICAgIGNhc2UgJ01hcCc6CiAgICBjYXNlICdTZXQnOgogICAgY2FzZSAnV2Vha01hcCc6CiAgICBjYXNlICdXZWFrU2V0JzoKICAgICAgcmV0dXJuIFRhcmdldFR5cGUuQ09MTEVDVElPTgogICAgZGVmYXVsdDoKICAgICAgcmV0dXJuIFRhcmdldFR5cGUuSU5WQUxJRAogIH0KfQoKZnVuY3Rpb24gZ2V0VGFyZ2V0VHlwZSh2YWx1ZTogVGFyZ2V0KSB7CiAgcmV0dXJuIHZhbHVlW1JlYWN0aXZlRmxhZ3MuU0tJUF0gfHwgIU9iamVjdC5pc0V4dGVuc2libGUodmFsdWUpCiAgICA/IFRhcmdldFR5cGUuSU5WQUxJRAogICAgOiB0YXJnZXRUeXBlTWFwKHRvUmF3VHlwZSh2YWx1ZSkpCn0KCi8vIG9ubHkgdW53cmFwIG5lc3RlZCByZWYKZXhwb3J0IHR5cGUgVW53cmFwTmVzdGVkUmVmczxUPiA9IFQgZXh0ZW5kcyBSZWYgPyBUIDogVW53cmFwUmVmU2ltcGxlPFQ+CgpkZWNsYXJlIGNvbnN0IFJlYWN0aXZlTWFya2VyU3ltYm9sOiB1bmlxdWUgc3ltYm9sCgpleHBvcnQgaW50ZXJmYWNlIFJlYWN0aXZlTWFya2VyIHsKICBbUmVhY3RpdmVNYXJrZXJTeW1ib2xdPzogdm9pZAp9CgpleHBvcnQgdHlwZSBSZWFjdGl2ZTxUPiA9IFVud3JhcE5lc3RlZFJlZnM8VD4gJgogIChUIGV4dGVuZHMgcmVhZG9ubHkgYW55W10gPyBSZWFjdGl2ZU1hcmtlciA6IHt9KQoKLyoqCiAqIFJldHVybnMgYSByZWFjdGl2ZSBwcm94eSBvZiB0aGUgb2JqZWN0LgogKgogKiBUaGUgcmVhY3RpdmUgY29udmVyc2lvbiBpcyAiZGVlcCI6IGl0IGFmZmVjdHMgYWxsIG5lc3RlZCBwcm9wZXJ0aWVzLiBBCiAqIHJlYWN0aXZlIG9iamVjdCBhbHNvIGRlZXBseSB1bndyYXBzIGFueSBwcm9wZXJ0aWVzIHRoYXQgYXJlIHJlZnMgd2hpbGUKICogbWFpbnRhaW5pbmcgcmVhY3Rpdml0eS4KICoKICogQGV4YW1wbGUKICogYGBganMKICogY29uc3Qgb2JqID0gcmVhY3RpdmUoeyBjb3VudDogMCB9KQogUkVEXTogTGlmZWN5Y2xlSG9vawogIC8qKgogICAqIEBpbnRlcm5hbAogICAqLwogIFtMaWZlY3ljbGVIb29rcy5TRVJWRVJfUFJFRkVUQ0hdOiBMaWZlY3ljbGVIb29rPCgpID0+IFByb21pc2U8dW5rbm93bj4+CgogIC8qKgogICAqIEZvciBjYWNoaW5nIGJvdW5kICRmb3JjZVVwZGF0ZSBvbiBwdWJsaWMgcHJveHkgYWNjZXNzCiAgICogQGludGVybmFsCiAgICovCiAgZj86ICgpID0+IHZvaWQKICAvKioKICAgKiBGb3IgY2FjaGluZyBib3VuZCAkbmV4dFRpY2sgb24gcHVibGljIHByb3h5IGFjY2VzcwogICAqIEBpbnRlcm5hbAogICAqLwogIG4/OiAoKSA9PiBQcm9taXNlPHZvaWQ+CiAgLyoqCiAgICogYHVwZGF0ZVRlbGVwb3J0Q3NzVmFyc2AKICAgKiBGb3IgdXBkYXRpbmcgY3NzIHZhcnMgb24gY29udGFpbmVkIHRlbGVwb3J0cwogICAqIEBpbnRlcm5hbAogICAqLwogIHV0PzogKHZhcnM/OiBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikgPT4gdm9pZAoKICAvKioKICAgKiBkZXYgb25seS4gRm9yIHN0eWxlIHYtYmluZCBoeWRyYXRpb24gbWlzbWF0Y2ggY2hlY2tzCiAgICogQGludGVybmFsCiAgICovCiAgZ2V0Q3NzVmFycz86ICgpID0+IFJlY29yZDxzdHJpbmcsIHVua25vd24+CgogIC8qKgogICAqIHYyIGNvbXBhdCBvbmx5LCBmb3IgY2FjaGluZyBtdXRhdGVkICRvcHRpb25zCiAgICogQGludGVybmFsCiAgICovCiAgcmVzb2x2ZWRPcHRpb25zPzogTWVyZ2VkQ29tcG9uZW50T3B0aW9ucwp9Cgpjb25zdCBlbXB0eUFwcENvbnRleHQgPSBjcmVhdGVBcHBDb250ZXh0KCkKCmxldCB1aWQgPSAwCgpleHBvcnQgZnVuY3Rpb24gY3JlYXRlQ29tcG9uZW50SW5zdGFuY2UoCiAgdm5vZGU6IFZOb2RlLAogIHBhcmVudDogQ29tcG9uZW50SW50ZXJuYWxJbnN0YW5jZSB8IG51bGwsCiAgc3VzcGVuc2U6IFN1c3BlbnNlQm91bmRhcnkgfCBudWxsLAopOiBDb21wb25lbnRJbnRlcm5hbEluc3RhbmNlIHsKICBjb25zdCB0eXBlID0gdm5vZGUudHlwZSBhcyBDb25jcmV0ZUNvbXBvbmVudAogIC8vIGluaGVyaXQgcGFyZW50IGFwcCBjb250ZXh0IC0gb3IgLSBpZiByb290LCBhZG9wdCBmcm9tIHJvb3Qgdm5vZGUKICBjb25zdCBhcHBDb250ZXh0ID0KICAgIChwYXJlbnQgPyBwYXJlbnQuYXBwQ29udGV4dCA6IHZub2RlLmFwcENvbnRleHQpIHx8IGVtcHR5QXBwQ29udGV4dAoKICBjb25zdCBpbnN0YW5jZTogQ29tcG9uZW50SW50ZXJuYWxJbnN0YW5jZSA9IHsKICAgIHVpZDogdWlkKyssCiAgICB2bm9kZSwKICAgIHR5cGUsCiAgICBwYXJlbnQsCiAgICBhcHBDb250ZXh0LAogICAgcm9vdDogbnVsbCEsIC8vIHRvIGJlIGltbWVkaWF0ZWx5IHNldAogICAgbmV4dDogbnVsbCwKICAgIHN1YlRyZWU6IG51bGwhLCAvLyB3aWxsIGJlIHNldCBzeW5jaHJvbm91c2x5IHJpZ2h0IGFmdGVyIGNyZWF0aW9uCiAgICBlZmZlY3Q6IG51bGwhLAogICAgdXBkYXRlOiBudWxsISwgLy8gd2lsbCBiZSBzZXQgc3luY2hyb25vdXNseSByaWdodCBhZnRlciBjcmVhdGlvbgogICAgam9iOiBudWxsISwKICAgIHNjb3BlOiBuZXcgRWZmZWN0U2NvcGUodHJ1ZSAvKiBkZXRhY2hlZCAqLyksCiAgICByZW5kZXI6IG51bGwsCiAgICBwcm94eTogbnVsbCwKICAgIGV4cG9zZWQ6IG51bGwsCiAgICBleHBvc2VQcm94eTogbnVsbCwKICAgIHdpdGhQcm94eTogbnVsbCwKCiAgICBwcm92aWRlczogcGFyZW50ID8gcGFyZW50LnByb3ZpZGVzIDogT2JqZWN0LmNyZWF0ZShhcHBDb250ZXh0LnByb3ZpZGVzKSwKICAgIGlkczogcGFyZW50ID8gcGFyZW50LmlkcyA6IFsnJywgMCwgMF0sCiAgICBhY2Nlc3NDYWNoZTogbnVsbCEsCiAgICByZW5kZXJDYWNoZTogW10sCgogICAgLy8gbG9jYWwgcmVzb2x2ZWQgYXNzZXRzCiAgICBjb21wb25lbnRzOiBudWxsLAogICAgZGlyZWN0aXZlczogbnVsbCwKCiAgICAvLyByZXNvbHZlZCBwcm9wcyBhbmQgZW1pdHMgb3B0aW9ucwogICAgcHJvcHNPcHRpb25zOiBub3JtYWxpemVQcm9wc09wdGlvbnModHlwZSwgIGNvbnN0IG5hbWVzID0gT2JqZWN0LmtleXMoQ29tcG9uZW50LmRpcmVjdGl2ZXMpCiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbmFtZXMubGVuZ3RoOyBpKyspIHsKICAgICAgICB2YWxpZGF0ZURpcmVjdGl2ZU5hbWUobmFtZXNbaV0pCiAgICAgIH0KICAgIH0KICAgIGlmIChDb21wb25lbnQuY29tcGlsZXJPcHRpb25zICYmIGlzUnVudGltZU9ubHkoKSkgewogICAgICB3YXJuKAogICAgICAgIGAiY29tcGlsZXJPcHRpb25zIiBpcyBvbmx5IHN1cHBvcnRlZCB3aGVuIHVzaW5nIGEgYnVpbGQgb2YgVnVlIHRoYXQgYCArCiAgICAgICAgICBgaW5jbHVkZXMgdGhlIHJ1bnRpbWUgY29tcGlsZXIuIFNpbmNlIHlvdSBhcmUgdXNpbmcgYSBydW50aW1lLW9ubHkgYCArCiAgICAgICAgICBgYnVpbGQsIHRoZSBvcHRpb25zIHNob3VsZCBiZSBwYXNzZWQgdmlhIHlvdXIgYnVpbGQgdG9vbCBjb25maWcgaW5zdGVhZC5gLAogICAgICApCiAgICB9CiAgfQogIC8vIDAuIGNyZWF0ZSByZW5kZXIgcHJveHkgcHJvcGVydHkgYWNjZXNzIGNhY2hlCiAgaW5zdGFuY2UuYWNjZXNzQ2FjaGUgPSBPYmplY3QuY3JlYXRlKG51bGwpCiAgLy8gMS4gY3JlYXRlIHB1YmxpYyBpbnN0YW5jZSAvIHJlbmRlciBwcm94eQogIGluc3RhbmNlLnByb3h5ID0gbmV3IFByb3h5KGluc3RhbmNlLmN0eCwgUHVibGljSW5zdGFuY2VQcm94eUhhbmRsZXJzKQogIGlmIChfX0RFVl9fKSB7CiAgICBleHBvc2VQcm9wc09uUmVuZGVyQ29udGV4dChpbnN0YW5jZSkKICB9CiAgLy8gMi4gY2FsbCBzZXR1cCgpCiAgY29uc3QgeyBzZXR1cCB9ID0gQ29tcG9uZW50CiAgaWYgKHNldHVwKSB7CiAgICBwYXVzZVRyYWNraW5nKCkKICAgIGNvbnN0IHNldHVwQ29udGV4dCA9IChpbnN0YW5jZS5zZXR1cENvbnRleHQgPQogICAgICBzZXR1cC5sZW5ndGggPiAxID8gY3JlYXRlU2V0dXBDb250ZXh0KGluc3RhbmNlKSA6IG51bGwpCiAgICBjb25zdCByZXNldCA9IHNldEN1cnJlbnRJbnN0YW5jZShpbnN0YW5jZSkKICAgIGNvbnN0IHNldHVwUmVzdWx0ID0gY2FsbFdpdGhFcnJvckhhbmRsaW5nKAogICAgICBzZXR1cCwKICAgICAgaW5zdGFuY2UsCiAgICAgIEVycm9yQ29kZXMuU0VUVVBfRlVOQ1RJT04sCiAgICAgIFsKICAgICAgICBfX0RFVl9fID8gc2hhbGxvd1JlYWRvbmx5KGluc3RhbmNlLnByb3BzKSA6IGluc3RhbmNlLnByb3BzLAogICAgICAgIHNldHVwQ29udGV4dCwKICAgICAgXSwKICAgICkKICAgIGNvbnN0IGlzQXN5bmNTZXR1cCA9IGlzUHJvbWlzZShzZXR1cFJlc3VsdCkKICAgIHJlc2V0VHJhY2tpbmcoKQogICAgcmVzZXQoKQoKICAgIGlmICgoaXNBc3luY1NldHVwIHx8IGluc3RhbmNlLnNwKSAmJiAhaXNBc3luY1dyYXBwZXIoaW5zdGFuY2UpKSB7CiAgICAgIC8vIGFzeW5jIHNldHVwIC8gc2VydmVyUHJlZmV0Y2gsIG1hcmsgYXMgYXN5bmMgYm91bmRhcnkgZm9yIHVzZUlkKCkKICAgICAgbWFya0FzeW5jQm91bmRhcnkoaW5zdGFuY2UpCiAgICB9CgogICAgaWYgKGlzQXN5bmNTZXR1cCkgewogICAgICBzZXR1cFJlc3VsdC50aGVuKHVuc2V0Q3VycmVudEluc3RhbmNlLCB1bnNldEN1cnJlbnRJbnN0YW5jZSkKICAgICAgaWYgKGlzU1NSKSB7CiAgICAgICAgLy8gcmV0dXJuIHRoZSBwcm9taXNlIHNvIHNlcnZlci1yZW5kZXJlciBjYW4gd2FpdCBvbiBpdAogICAgICAgIHJldHVybiBzZXR1cFJlc3VsdAogICAgICAgICAgLnRoZW4oKHJlc29sdmVkUmVzdWx0OiB1bmtub3duKSA9PiB7CiAgICAgICAgICAgIGhhbmRsZVNldHVwUmVzdWx0KGluc3RhbmNlLCByZXNvbHZlZFJlc3VsdCwgaXNTU1IpCiAgICAgICAgICB9KQogICAgICAgICAgLmNhdGNoKGUgPT4gewogICAgICAgICAgICBoYW5kbGVFcnJvcihlLCBpbnN0YW5jZSwgRXJyb3JDb2Rlcy5TRVRVUF9GVU5DVElPTikKICAgICAgICAgIH0pCiAgICAgIH0gZWxzZSBpZiAoX19GRUFUVVJFX1NVU1BFTlNFX18pIHsKICAgICAgICAvLyBhc3luYyBzZXR1cCByZXR1cm5lZCBQcm9taXNlLgogICB0eXBlIEFwcENvbnRleHQsCiAgY3JlYXRlQXBwQ29udGV4dCwKfSBmcm9tICcuL2FwaUNyZWF0ZUFwcCcKaW1wb3J0IHsgdHlwZSBEaXJlY3RpdmUsIHZhbGlkYXRlRGlyZWN0aXZlTmFtZSB9IGZyb20gJy4vZGlyZWN0aXZlcycKaW1wb3J0IHsKICB0eXBlIENvbXBvbmVudE9wdGlvbnMsCiAgdHlwZSBDb21wdXRlZE9wdGlvbnMsCiAgdHlwZSBNZXJnZWRDb21wb25lbnRPcHRpb25zLAogIHR5cGUgTWV0aG9kT3B0aW9ucywKICBhcHBseU9wdGlvbnMsCiAgcmVzb2x2ZU1lcmdlZE9wdGlvbnMsCn0gZnJvbSAnLi9jb21wb25lbnRPcHRpb25zJwppbXBvcnQgewogIHR5cGUgRW1pdEZuLAogIHR5cGUgRW1pdHNPcHRpb25zLAogIHR5cGUgRW1pdHNUb1Byb3BzLAogIHR5cGUgT2JqZWN0RW1pdHNPcHRpb25zLAogIHR5cGUgU2hvcnRFbWl0c1RvT2JqZWN0LAogIGVtaXQsCiAgbm9ybWFsaXplRW1pdHNPcHRpb25zLAp9IGZyb20gJy4vY29tcG9uZW50RW1pdHMnCmltcG9ydCB7CiAgRU1QVFlfT0JKLAogIHR5cGUgSWZBbnksCiAgTk9PUCwKICBTaGFwZUZsYWdzLAogIGV4dGVuZCwKICBnZXRHbG9iYWxUaGlzLAogIGlzQXJyYXksCiAgaXNGdW5jdGlvbiwKICBpc09iamVjdCwKICBpc1Byb21pc2UsCiAgbWFrZU1hcCwKfSBmcm9tICdAdnVlL3NoYXJlZCcKaW1wb3J0IHR5cGUgeyBTdXNwZW5zZUJvdW5kYXJ5IH0gZnJvbSAnLi9jb21wb25lbnRzL1N1c3BlbnNlJwppbXBvcnQgdHlwZSB7IENvbXBpbGVyT3B0aW9ucyB9IGZyb20gJ0B2dWUvY29tcGlsZXItY29yZScKaW1wb3J0IHsgbWFya0F0dHJzQWNjZXNzZWQgfSBmcm9tICcuL2NvbXBvbmVudFJlbmRlclV0aWxzJwppbXBvcnQgeyBjdXJyZW50UmVuZGVyaW5nSW5zdGFuY2UgfSBmcm9tICcuL2NvbXBvbmVudFJlbmRlckNvbnRleHQnCmltcG9ydCB7IGVuZE1lYXN1cmUsIHN0YXJ0TWVhc3VyZSB9IGZyb20gJy4vcHJvZmlsaW5nJwppbXBvcnQgeyBjb252ZXJ0TGVnYWN5UmVuZGVyRm4gfSBmcm9tICcuL2NvbXBhdC9yZW5kZXJGbicKaW1wb3J0IHsKICB0eXBlIENvbXBhdENvbmZpZywKICBnbG9iYWxDb21wYXRDb25maWcsCiAgdmFsaWRhdGVDb21wYXRDb25maWcsCn0gZnJvbSAnLi9jb21wYXQvY29tcGF0Q29uZmlnJwppbXBvcnQgdHlwZSB7IFNjaGVkdWxlckpvYiB9IGZyb20gJy4vc2NoZWR1bGVyJwppbXBvcnQgdHlwZSB7IExpZmVjeWNsZUhvb2tzIH0gZnJvbSAnLi9lbnVtcycKCi8vIEF1Z21lbnQgR2xvYmFsQ29tcG9uZW50cwppbXBvcnQgdHlwZSB7IFRlbGVwb3J0UHJvcHMgfSBmcm9tICcuL2NvbXBvbmVudHMvVGVsZXBvcnQnCmltcG9ydCB0eXBlIHsgU3VzcGVuc2VQcm9wcyB9IGZyb20gJy4vY29tcG9uZW50cy9TdXNwZW5zZScKaW1wb3J0IHR5cGUgeyBLZWVwQWxpdmVQcm9wcyB9IGZyb20gJy4vY29tcG9uZW50cy9LZWVwQWxpdmUnCmltcG9ydCB0eXBlIHsgQmFzZVRyYW5zaXRpb25Qcm9wcyB9IGZyb20gJy4vY29tcG9uZW50cy9CYXNlVHJhbnNpdGlvbicKaW1wb3J0IHR5cGUgeyBEZWZpbmVDb21wb25lbnQgfSBmcm9tICcuL2FwaURlZmluZUNvbXBvbmVudCcKaW1wb3J0IHsgbWFya0FzeW5jQm91bmRhcnkgfSBmcm9tICcuL2hlbHBlcnMvdXNlSWQnCmltcG9ydCB7IGlzQXN5bmNXcmFwcGVyIH0gZnJvbSAnLi9hcGlBc3luY0NvbXBvbmVudCcKaW1wb3J0IHR5cGUgeyBSZW5kZXJlckVsZW1lbnQgfSBmcm9tICcuL3JlbmRlcmVyJwoKZXhwb3J0IHR5cGUgRGF0YSA9IFJlY29yZDxzdHJpbmcsIHVua25vd24+CgovKioKICogUHVibGljIHV0aWxpdHkgdHlwZSBmb3IgZXh0cmFjdGluZyB0aGUgaW5zdGFuY2UgdHlwZSBvZiBhIGNvbXBvbmVudC4KICogV29ya3Mgd2l0aCBhbGwgdmFsaWQgY29tcG9uZW50IGRlZmluaXRpb24gdHlwZXMuIFRoaXMgaXMgaW50ZW5kZWQgdG8gcmVwbGFjZQogKiB0aGUgdXNhZ2Ugb2YgYEluc3RhbmNlVHlwZTx0eXBlb2YgQ29tcD5gIHdoaWNoIG9ubHkgd29ya3MgZm9yCiAqIGNvbnN0cnVjdG9yLWJhc2VkICAgIGV4cG9zZVNldHVwU3RhdGVPblJlbmRlckNvbnRleHQoaW5zdGFuY2UpCiAgICB9CiAgfSBlbHNlIGlmIChfX0RFVl9fICYmIHNldHVwUmVzdWx0ICE9PSB1bmRlZmluZWQpIHsKICAgIHdhcm4oCiAgICAgIGBzZXR1cCgpIHNob3VsZCByZXR1cm4gYW4gb2JqZWN0LiBSZWNlaXZlZDogJHsKICAgICAgICBzZXR1cFJlc3VsdCA9PT0gbnVsbCA/ICdudWxsJyA6IHR5cGVvZiBzZXR1cFJlc3VsdAogICAgICB9YCwKICAgICkKICB9CiAgZmluaXNoQ29tcG9uZW50U2V0dXAoaW5zdGFuY2UsIGlzU1NSKQp9Cgp0eXBlIENvbXBpbGVGdW5jdGlvbiA9ICgKICB0ZW1wbGF0ZTogc3RyaW5nIHwgb2JqZWN0LAogIG9wdGlvbnM/OiBDb21waWxlck9wdGlvbnMsCikgPT4gSW50ZXJuYWxSZW5kZXJGdW5jdGlvbgoKbGV0IGNvbXBpbGU6IENvbXBpbGVGdW5jdGlvbiB8IHVuZGVmaW5lZApsZXQgaW5zdGFsbFdpdGhQcm94eTogKGk6IENvbXBvbmVudEludGVybmFsSW5zdGFuY2UpID0+IHZvaWQKCi8qKgogKiBGb3IgcnVudGltZS1kb20gdG8gcmVnaXN0ZXIgdGhlIGNvbXBpbGVyLgogKiBOb3RlIHRoZSBleHBvcnRlZCBtZXRob2QgdXNlcyBhbnkgdG8gYXZvaWQgZC50cyByZWx5aW5nIG9uIHRoZSBjb21waWxlciB0eXBlcy4KICovCmV4cG9ydCBmdW5jdGlvbiByZWdpc3RlclJ1bnRpbWVDb21waWxlcihfY29tcGlsZTogYW55KTogdm9pZCB7CiAgY29tcGlsZSA9IF9jb21waWxlCiAgaW5zdGFsbFdpdGhQcm94eSA9IGkgPT4gewogICAgaWYgKGkucmVuZGVyIS5fcmMpIHsKICAgICAgaS53aXRoUHJveHkgPSBuZXcgUHJveHkoaS5jdHgsIFJ1bnRpbWVDb21waWxlZFB1YmxpY0luc3RhbmNlUHJveHlIYW5kbGVycykKICAgIH0KICB9Cn0KCi8vIGRldiBvbmx5CmV4cG9ydCBjb25zdCBpc1J1bnRpbWVPbmx5ID0gKCk6IGJvb2xlYW4gPT4gIWNvbXBpbGUKCmV4cG9ydCBmdW5jdGlvbiBmaW5pc2hDb21wb25lbnRTZXR1cCgKICBpbnN0YW5jZTogQ29tcG9uZW50SW50ZXJuYWxJbnN0YW5jZSwKICBpc1NTUjogYm9vbGVhbiwKICBza2lwT3B0aW9ucz86IGJvb2xlYW4sCik6IHZvaWQgewogIGNvbnN0IENvbXBvbmVudCA9IGluc3RhbmNlLnR5cGUgYXMgQ29tcG9uZW50T3B0aW9ucwoKICBpZiAoX19DT01QQVRfXykgewogICAgY29udmVydExlZ2FjeVJlbmRlckZuKGluc3RhbmNlKQoKICAgIGlmIChfX0RFVl9fICYmIENvbXBvbmVudC5jb21wYXRDb25maWcpIHsKICAgICAgdmFsaWRhdGVDb21wYXRDb25maWcoQ29tcG9uZW50LmNvbXBhdENvbmZpZykKICAgIH0KICB9CgogIC8vIHRlbXBsYXRlIC8gcmVuZGVyIGZ1bmN0aW9uIG5vcm1hbGl6YXRpb24KICAvLyBjb3VsZCBiZSBhbHJlYWR5IHNldCB3aGVuIHJldHVybmVkIGZyb20gc2V0dXAoKQogIGlmICghaW5zdGFuY2UucmVuZGVyKSB7CiAgICAvLyBvbmx5IGRvIG9uLXRoZS1mbHkgY29tcGlsZSBpZiBub3QgaW4gU1NSIC0gU1NSIG9uLXRoZS1mbHkgY29tcGlsYXRpb24KICAgIC8vIGlzIGRvbmUgYnkgc2VydmVyLXJlbmRlcmVyCiAgICBpZiAoIWlzU1NSICYmIGNvbXBpbGUgJiYgIUNvbXBvbmVudC5yZW5kZXIpIHsKICAgICAgY29uc3QgdGVtcGxhdGUgPQogICAgICAgIChfX0NPTVBBVF9fICYmCiAgICAgICAgICBpbnN0YW5jZS52bm9kZS5wcm9wcyAmJgogICAgICAgICAgaW5zdGFuY2Uudm5vZGUucHJvcHNbJ2lubGluZS10ZW1wbGF0ZSddKSB8fAogICAgICAgIENvbXBvbmVudC50ZW1wbGF0ZSB8fAogICAgICAgIChfX0ZFQVRVUkVfT1BUSU9OU19BUElfXyAmJiByZXNvbHZlTWVyZ2VkT3B0aW9ucyhpbnN0YW5jZSkudGVtcGxhdGUpCiAgICAgIGlmICh0ZW1wbGF0ZSkgewogICAgICAgIGlmIChfX0RFVl9fKSB7CiAgICAgICAgICBzdGFydE1lYXN1cmUoaW5zdGFuY2UsIGBjb21waWxlYCkKICAgICAgICB9CiAgICAgICAgY29uc3QgeyBpc0N1c3RvbUVsZW1lbnQsIGNvbXBpbGVyT3B0aW9ucyB9ID0gaW5zdGFuY2UuYXBwQ29udGV4dC5jb25maWcKICAgICAgICAgZWM6IG51bGwsCiAgICBzcDogbnVsbCwKICB9CiAgaWYgKF9fREVWX18pIHsKICAgIGluc3RhbmNlLmN0eCA9IGNyZWF0ZURldlJlbmRlckNvbnRleHQoaW5zdGFuY2UpCiAgfSBlbHNlIHsKICAgIGluc3RhbmNlLmN0eCA9IHsgXzogaW5zdGFuY2UgfQogIH0KICBpbnN0YW5jZS5yb290ID0gcGFyZW50ID8gcGFyZW50LnJvb3QgOiBpbnN0YW5jZQogIGluc3RhbmNlLmVtaXQgPSBlbWl0LmJpbmQobnVsbCwgaW5zdGFuY2UpCgogIC8vIGFwcGx5IGN1c3RvbSBlbGVtZW50IHNwZWNpYWwgaGFuZGxpbmcKICBpZiAodm5vZGUuY2UpIHsKICAgIHZub2RlLmNlKGluc3RhbmNlKQogIH0KCiAgcmV0dXJuIGluc3RhbmNlCn0KCmV4cG9ydCBsZXQgY3VycmVudEluc3RhbmNlOiBDb21wb25lbnRJbnRlcm5hbEluc3RhbmNlIHwgbnVsbCA9IG51bGwKCmV4cG9ydCBjb25zdCBnZXRDdXJyZW50SW5zdGFuY2U6ICgpID0+IENvbXBvbmVudEludGVybmFsSW5zdGFuY2UgfCBudWxsID0gKCkgPT4KICBjdXJyZW50SW5zdGFuY2UgfHwgY3VycmVudFJlbmRlcmluZ0luc3RhbmNlCgpsZXQgaW50ZXJuYWxTZXRDdXJyZW50SW5zdGFuY2U6ICgKICBpbnN0YW5jZTogQ29tcG9uZW50SW50ZXJuYWxJbnN0YW5jZSB8IG51bGwsCikgPT4gdm9pZApsZXQgc2V0SW5TU1JTZXR1cFN0YXRlOiAoc3RhdGU6IGJvb2xlYW4pID0+IHZvaWQKCi8qKgogKiBUaGUgZm9sbG93aW5nIG1ha2VzIGdldEN1cnJlbnRJbnN0YW5jZSgpIHVzYWdlIGFjcm9zcyBtdWx0aXBsZSBjb3BpZXMgb2YgVnVlCiAqIHdvcmsuIFNvbWUgY2FzZXMgb2YgaG93IHRoaXMgY2FuIGhhcHBlbiBhcmUgc3VtbWFyaXplZCBpbiAjNzU5MC4gSW4gcHJpbmNpcGxlCiAqIHRoZSBkdXBsaWNhdGlvbiBzaG91bGQgYmUgYXZvaWRlZCwgYnV0IGluIHByYWN0aWNlIHRoZXJlIGFyZSBvZnRlbiBjYXNlcwogKiB3aGVyZSB0aGUgdXNlciBpcyB1bmFibGUgdG8gcmVzb2x2ZSBvbiB0aGVpciBvd24sIGVzcGVjaWFsbHkgaW4gY29tcGxpY2F0ZWQKICogU1NSIHNldHVwcy4KICoKICogTm90ZSB0aGlzIGZpeCBpcyB0ZWNobmljYWxseSBpbmNvbXBsZXRlLCBhcyB3ZSBzdGlsbCByZWx5IG9uIG90aGVyIHNpbmdsZXRvbnMKICogZm9yIGVmZmVjdFNjb3BlIGFuZCBnbG9iYWwgcmVhY3RpdmUgZGVwZW5kZW5jeSBtYXBzLiBIb3dldmVyLCBpdCBkb2VzIG1ha2UKICogc29tZSBvZiB0aGUgbW9zdCBjb21tb24gY2FzZXMgd29yay4gSXQgYWxzbyB3YXJucyBpZiB0aGUgZHVwbGljYXRpb24gaXMKICogZm91bmQgZHVyaW5nIGJyb3dzZXIgZXhlY3V0aW9uLgogKi8KaWYgKF9fU1NSX18pIHsKICB0eXBlIFNldHRlciA9ICh2OiBhbnkpID0+IHZvaWQKICBjb25zdCBnID0gZ2V0R2xvYmFsVGhpcygpCiAgY29uc3QgcmVnaXN0ZXJHbG9iYWxTZXR0ZXIgPSAoa2V5OiBzdHJpbmcsIHNldHRlcjogU2V0dGVyKSA9PiB7CiAgICBsZXQgc2V0dGVyczogU2V0dGVyW10KICAgIGlmICghKHNldHRlcnMgPSBnW2tleV0pKSBzZXR0ZXJzID0gZ1trZXldID0gW10KICAgIHNldHRlcnMucHVzaChzZXR0ZXIpCiAgICByZXR1cm4gKHY6IGFueSkgPT4gewogICAgICBpZiAoc2V0dGVycy5sZW5ndGggPiAxKSBzZXR0ZXJzLmZvckVhY2goc2V0ID0+IHNldCh2KSkKICAgICAgZWxzZSBzZXR0ZXJzWzBdKHYpCiAgICB9CiAgfQogIGludGVybmFsU2V0Q3VycmVudEluc3RhbmNlID0gcmVnaXN0ZXJHbG9iYWxTZXR0ZXIoCiAgICBgX19WVUVfSU5TVEFOQ0VfU0VUVEVSU19fYCwKICAgIHYgPT4gKGN1cnJlbnRJbnN0YW5jZSA9IHYpLAogICkKICAvLyBhbHNvIG1ha2UgYGlzSW5TU1JDb21wb25lbnRTZXR1cGAgc2hhcmFibGUgYWNyb3NzIGNvcGllcyBvZiBWdWUuCiAgLy8gdGhpcyBpcyBuZWVkZWQgaW4gdGhlIFNGQyBwbGF5Z3JvdW5kIHdoZW4gU1NSaW5nIGFzeW5jIGNvbXBvbmVudHMsIHNpbmNlCiAgLy8gd2UgaGF2ZSB0byBsb2FkIGJvdGggdGhlIHJ1bnRpbWUgYW5kIHRoZSBzZXJ2ZXItcmVuZGVyZXIgcnQgZnVuY3Rpb24gcmVhY3RpdmUodGFyZ2V0OiBvYmplY3QpIHsKICAvLyBpZiB0cnlpbmcgdG8gb2JzZXJ2ZSBhIHJlYWRvbmx5IHByb3h5LCByZXR1cm4gdGhlIHJlYWRvbmx5IHZlcnNpb24uCiAgaWYgKGlzUmVhZG9ubHkodGFyZ2V0KSkgewogICAgcmV0dXJuIHRhcmdldAogIH0KICByZXR1cm4gY3JlYXRlUmVhY3RpdmVPYmplY3QoCiAgICB0YXJnZXQsCiAgICBmYWxzZSwKICAgIG11dGFibGVIYW5kbGVycywKICAgIG11dGFibGVDb2xsZWN0aW9uSGFuZGxlcnMsCiAgICByZWFjdGl2ZU1hcCwKICApCn0KCmV4cG9ydCBkZWNsYXJlIGNvbnN0IFNoYWxsb3dSZWFjdGl2ZU1hcmtlcjogdW5pcXVlIHN5bWJvbAoKZXhwb3J0IHR5cGUgU2hhbGxvd1JlYWN0aXZlPFQ+ID0gVCAmIHsgW1NoYWxsb3dSZWFjdGl2ZU1hcmtlcl0/OiB0cnVlIH0KCi8qKgogKiBTaGFsbG93IHZlcnNpb24gb2Yge0BsaW5rIHJlYWN0aXZlfS4KICoKICogVW5saWtlIHtAbGluayByZWFjdGl2ZX0sIHRoZXJlIGlzIG5vIGRlZXAgY29udmVyc2lvbjogb25seSByb290LWxldmVsCiAqIHByb3BlcnRpZXMgYXJlIHJlYWN0aXZlIGZvciBhIHNoYWxsb3cgcmVhY3RpdmUgb2JqZWN0LiBQcm9wZXJ0eSB2YWx1ZXMgYXJlCiAqIHN0b3JlZCBhbmQgZXhwb3NlZCBhcy1pcyAtIHRoaXMgYWxzbyBtZWFucyBwcm9wZXJ0aWVzIHdpdGggcmVmIHZhbHVlcyB3aWxsCiAqIG5vdCBiZSBhdXRvbWF0aWNhbGx5IHVud3JhcHBlZC4KICoKICogQGV4YW1wbGUKICogYGBganMKICogY29uc3Qgc3RhdGUgPSBzaGFsbG93UmVhY3RpdmUoewogKiAgIGZvbzogMSwKICogICBuZXN0ZWQ6IHsKICogICAgIGJhcjogMgogKiAgIH0KICogfSkKICoKICogLy8gbXV0YXRpbmcgc3RhdGUncyBvd24gcHJvcGVydGllcyBpcyByZWFjdGl2ZQogKiBzdGF0ZS5mb28rKwogKgogKiAvLyAuLi5idXQgZG9lcyBub3QgY29udmVydCBuZXN0ZWQgb2JqZWN0cwogKiBpc1JlYWN0aXZlKHN0YXRlLm5lc3RlZCkgLy8gZmFsc2UKICoKICogLy8gTk9UIHJlYWN0aXZlCiAqIHN0YXRlLm5lc3RlZC5iYXIrKwogKiBgYGAKICoKICogQHBhcmFtIHRhcmdldCAtIFRoZSBzb3VyY2Ugb2JqZWN0LgogKiBAc2VlIHtAbGluayBodHRwczovL3Z1ZWpzLm9yZy9hcGkvcmVhY3Rpdml0eS1hZHZhbmNlZC5odG1sI3NoYWxsb3dyZWFjdGl2ZX0KICovCi8qQF9fTk9fU0lERV9FRkZFQ1RTX18qLwpleHBvcnQgZnVuY3Rpb24gc2hhbGxvd1JlYWN0aXZlPFQgZXh0ZW5kcyBvYmplY3Q+KAogIHRhcmdldDogVCwKKTogU2hhbGxvd1JlYWN0aXZlPFQ+IHsKICByZXR1cm4gY3JlYXRlUmVhY3RpdmVPYmplY3QoCiAgICB0YXJnZXQsCiAgICBmYWxzZSwKICAgIHNoYWxsb3dSZWFjdGl2ZUhhbmRsZXJzLAogICAgc2hhbGxvd0NvbGxlY3Rpb25IYW5kbGVycywKICAgIHNoYWxsb3dSZWFjdGl2ZU1hcCwKICApCn0KCnR5cGUgUHJpbWl0aXZlID0gc3RyaW5nIHwgbnVtYmVyIHwgYm9vbGVhbiB8IGJpZ2ludCB8IHN5bWJvbCB8IHVuZGVmaW5lZCB8IG51bGwKZXhwb3J0IHR5cGUgQnVpbHRpbiA9IFByaW1pdGl2ZSB8IEZ1bmN0aW9uIHwgRGF0ZSB8IEVycm9yIHwgUmVnRXhwCmV4cG9ydCB0eXBlIERlZXBSZWFkb25seTxUPiA9IFQgZXh0ZW5kcyBCdWlsdGluCiAgPyBUCiAgOiBUIGV4dGVuZHMgTWFwPGluZmVyIEssIGluZmVyIFY+CiAgICA/IFJlYWRvbmx5TWFwPERlZXBSZWFkb25seTxLPiwgRGVlcFJlYWRvbmx5PFY+PgogICAgOiBUIGV4dGVuZHMgUmVhZG9ubHlNYXA8aW5mZXIgSywgaW5mZXIgVj4KICAgICAgPyBSZWFkb25seU1hcDxEZWVwUmVhZG9ubHk8Sz4sIERlZXBSZWFkb25seTxWPj4KICAgICAgOiBUIGV4dGVuZHMgV2Vha01hcDxpbmZlciBLLCBpbmZlciBWPgogICAgICAgID8gV2Vha01hcDxEZWVwUmVhZG9ubHk8Sz4sIERlZXBSZWFkb25seTxWPj4KICAgICAgICA6IFQgZXh0ZW5kcyBTZXQ8aW5mZXIgVT4KICAgICAgICAgID8gUmVhZG9ubHlTZXQ8RGVlcFJlYWRvbmx5PFU+PgogICAgdXJuZWQgYnkgZGVmaW5lQ29tcG9uZW50KCkuCiAqLwpleHBvcnQgdHlwZSBDb21wb25lbnQ8CiAgUHJvcHNPckluc3RhbmNlID0gYW55LAogIFJhd0JpbmRpbmdzID0gYW55LAogIEQgPSBhbnksCiAgQyBleHRlbmRzIENvbXB1dGVkT3B0aW9ucyA9IENvbXB1dGVkT3B0aW9ucywKICBNIGV4dGVuZHMgTWV0aG9kT3B0aW9ucyA9IE1ldGhvZE9wdGlvbnMsCiAgRSBleHRlbmRzIEVtaXRzT3B0aW9ucyB8IFJlY29yZDxzdHJpbmcsIGFueVtdPiA9IHt9LAogIFMgZXh0ZW5kcyBSZWNvcmQ8c3RyaW5nLCBhbnk+ID0gYW55LAo+ID0KICB8IENvbmNyZXRlQ29tcG9uZW50PFByb3BzT3JJbnN0YW5jZSwgUmF3QmluZGluZ3MsIEQsIEMsIE0sIEUsIFM+CiAgfCBDb21wb25lbnRQdWJsaWNJbnN0YW5jZUNvbnN0cnVjdG9yPFByb3BzT3JJbnN0YW5jZT4KCmV4cG9ydCB0eXBlIHsgQ29tcG9uZW50T3B0aW9ucyB9CgpleHBvcnQgdHlwZSBMaWZlY3ljbGVIb29rPFRGbiA9IEZ1bmN0aW9uPiA9IChURm4gJiBTY2hlZHVsZXJKb2IpW10gfCBudWxsCgovLyB1c2UgYEUgZXh0ZW5kcyBhbnlgIHRvIGZvcmNlIGV2YWx1YXRpbmcgdHlwZSB0byBmaXggIzIzNjIKZXhwb3J0IHR5cGUgU2V0dXBDb250ZXh0PAogIEUgPSBFbWl0c09wdGlvbnMsCiAgUyBleHRlbmRzIFNsb3RzVHlwZSA9IHt9LAo+ID0gRSBleHRlbmRzIGFueQogID8gewogICAgICBhdHRyczogRGF0YQogICAgICBzbG90czogVW53cmFwU2xvdHNUeXBlPFM+CiAgICAgIGVtaXQ6IEVtaXRGbjxFPgogICAgICBleHBvc2U6IDxFeHBvc2VkIGV4dGVuZHMgUmVjb3JkPHN0cmluZywgYW55PiA9IFJlY29yZDxzdHJpbmcsIGFueT4+KAogICAgICAgIGV4cG9zZWQ/OiBFeHBvc2VkLAogICAgICApID0+IHZvaWQKICAgIH0KICA6IG5ldmVyCgovKioKICogQGludGVybmFsCiAqLwpleHBvcnQgdHlwZSBJbnRlcm5hbFJlbmRlckZ1bmN0aW9uID0gewogICgKICAgIGN0eDogQ29tcG9uZW50UHVibGljSW5zdGFuY2UsCiAgICBjYWNoZTogQ29tcG9uZW50SW50ZXJuYWxJbnN0YW5jZVsncmVuZGVyQ2FjaGUnXSwKICAgIC8vIGZvciBjb21waWxlci1vcHRpbWl6ZWQgYmluZGluZ3MKICAgICRwcm9wczogQ29tcG9uZW50SW50ZXJuYWxJbnN0YW5jZVsncHJvcHMnXSwKICAgICRzZXR1cDogQ29tcG9uZW50SW50ZXJuYWxJbnN0YW5jZVsnc2V0dXBTdGF0ZSddLAogICAgJGRhdGE6IENvbXBvbmVudEludGVybmFsSW5zdGFuY2VbJ2RhdGEnXSwKICAgICRvcHRpb25zOiBDb21wb25lbnRJbnRlcm5hbEluc3RhbmNlWydjdHgnXSwKICApOiBWTm9kZUNoaWxkCiAgX3JjPzogYm9vbGVhbiAvLyBpc1J1bnRpbWVDb21waWxlZAoKICAvLyBfX0NPTVBBVF9fIG9ubHkKICBfY29tcGF0Q2hlY2tlZD86IGJvb2xlYW4gLy8gdjMgYW5kIGFscmVhZHkgY2hlY2tlZCBmb3IgdjIgY29tcGF0CiAgX2NvbXBhdFdyYXBwZWQ/OiBib29sZWFuIC8vIGlzIHdyYXBwZWQgZm9yIHYyIGNvbXBhdAp9CgovKioKICogV2UgZXhwb3NlIGEgc3Vic2V0IG9mIHByb3BlcnRpZXMgb24gdGhlIGludGVybmFsIGluc3RhbmNlIGFzIHRoZXkgYXJlCiAqIHVzZWZ1bCBmb3IgYWR2YW5jZWQgZXh0ZXJuYWwgbGlicmFyaWVzIGFuZCB0b29scy4KICovCmV4cG9ydCBpbnRlcmZhY2UgQ29tcG9uZW50SW50ZXJuYWxJbnN0YW5jZSB7CiAgdWlkOiBudW1iZXIKICB0eXBlOiBDb25jcmV0ZUNvbXBvbmVudAogIHBhcmVudDogQ29tcG9uZW50SW50ZXJuYWxJbnN0YW5jZSB8IG51bGwKICByb290OiBDb21wb25lbnRJbnRlcm5hbEluc3RhbmNlCiAgYXBwQ29udGV4dDogQXBwQ29udGV4dAogIC8qKgogICAqIFZub2RlIHJlcHJlc2VudGluZyB0aGlzIGNvbXBvbmVudCBpbiBpdHMgcGFyZW50J3MgdmRvbSB0cmVlCiAgICovCiAgdm5vZGU6IFZOb2RlCiAgLyoqCiAgICogVGhlIHBlbmRpbmcgbmV3IHZub2RlIGZyb20gcGFyZW50IHVwZGF0ZXMKICAgKiBAaW50ZXJuYWwKICAgKi8KICBuZXh0OiBWTm9kZSB8IG51bGwKICAvKioK';

let cachedDictionary: Buffer | null = null;

export function getVueDictionary(): Buffer {
  if (!cachedDictionary) {
    cachedDictionary = Buffer.from(DICTIONARY_BASE64, 'base64');
  }
  return cachedDictionary;
}

export const VUE_DICTIONARY_META: DictionaryMeta = {
  name: 'Vue/Nuxt Dictionary',
  version: '2.0.0',
  description: 'Trained ZSTD dictionary optimized for Vue/Nuxt code compression',
  frameworks: ["vue","nuxt"],
  sizeBytes: 52464,
  patternCount: 0, // Trained dictionary - patterns are internal
  trainedOn: ['sample vue files'],
};
