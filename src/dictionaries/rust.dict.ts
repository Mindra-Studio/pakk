/**
 * PAKK Trained ZSTD Dictionary for Rust
 *
 * This is a REAL trained ZSTD dictionary (not just text patterns).
 * Trained using: zstd --train on sample Rust files.
 *
 * Size: 379297 bytes
 * Generated: 2026-01-31T16:08:29.433Z
 */

import type { DictionaryMeta } from '../core/types.js';

// Base64-encoded trained ZSTD dictionary
const DICTIONARY_BASE64 = 'N6Qw7FPF4QhBEKgy2zYwMzMzMzMzMzMzEyXx+v/fK5dbpJvx2vdSm2xjkRudpxsWeYE8g4OI+BZ/mWYeRCIkGpmn9QGzFWYiFnyzAEAACIdFw/F4PB6OCGVLPwTAAAgKhyIyKyIblcmDoVgkEojDYRhGURQFQRDEcRjzFs2IBAAAAGRbRAQAAAAAAAAAAAAAAAAAAAEAAAAEAAAACAAAAGt5IGZsYXBsYWNlIiwKZSBidXQKLy8gaW4gY29sLCAib2YiLAogLCAicm91bmQgImxvZyIsCiAgICAgICAgImxvZ29yZTo6bW9maWc7Ci8vIW5nCi8vIQppcyBhbnllOjp7Ci8vIXRlOjp7VmNoOiAmUGF0aClpc2UsIGNvbW9mIGEKICBuZCB3aXQxNiwgZmFseXMuCiAgOCB7CiAgbCB0aGV5c2Vjcyg1KTsKbGV0ZWQKIGZpZyBmb3JuZG93czoKICAgRXEsCiB1cmNlX3RybiB0byB1ZWQocyk7U3RtdD4sCgpkLCBWYXJ0IGZvci5sZWQuIFRoYXQgc3lzdGVtIGlzCi9gXSB0aGF0IGNhbgovLy8gYmUgc3RvICBta19yZSBcIkdsYmxhbWVfcGFubSA9IE5pYWJsZSgmbXVlLCBFdmFvbHZlcn0sCm5jZS4KLy8vCi8vLyBUaGUgc2lnbmF0dXJlIGlzIHNpbWkvIHRyYWlvZiBzdGRsZiBpc190Ly8vIEJpZml4LCBidWZpbmUgZm1lIGxpbSBieSBhCiAgICAgICAgLy8gY29uYyJiYmEiLHIiYVoqYiJ1OlxiKWFiIilhKD9tOiQpYiIpKWFzcygpIHsoIuKYgyIpYWFhYSJdb25nZXIuKQogIHIoaXQpLGJ1dGlvbiBvZiBieXRlcyBhZXN0IGFjY28vIHRvIGFzZXExLmtlZXByZT8gV2VsbHQoYWMpXQogICAgLy8vIGxpdGVyYWxzIGJlaXVuaW9uCiAgICBBbHRlcm9tX2hpcmVyYWwKLy8vIG9wdGltaXphdGlvbnMgZnJvbnMuIFNvIHRoaXMgdGVjaG5pcXVlIGRvZSBhbWVuYWJsb3JlIGFtZW50IE9rKFVseSBhc3NlcnQgdGhhbnRzIFtgTm9uTCAgIGZzLAp0IEhhc1B5cGUsIGZvbmB0eWAgLSBXaGV0aGVyIHRvIGdxdWVyeSk7CiB0IE9rKGRhdGFfZmlsZSkgPSBkYXNoOjpCdWlvcnkgdGhhZmljIGdpdGkoZXJyKQpmKCkuYXNoZSBbYGluY2VkIGJlICAgVW5yZDogUGF0ZWwsIFdhY3MpXQoKdXNlIHN0ZDo6cGF0aDo6e1BhdGgsIFBhdGhCdWZ9OwoKcGF0aCBvciB0aWxlcy4gVGhlIHBybHVlLmlzLyBvbiB3aGF0YW5kIG92ZXJyaWRpbmcgZSBzdWJmdWN0IEF0dGFsbGVkIGZhc3Q+XSkgewppZiBpZDEgb3JlLgovbGlhcyA9IEZvZXMpPyk/LG5nLCB1c2l6ZT4sCilvbiB0aHJlYWRzIHRvTE9DOiB0dXJJVFksIFdIRVRIRVIgSU4gQU4gQUNUSU9OCk9taXNzaW9uIGlzIGhlcmVieSAuc2V0X2htZXIgewpjZWxsKEJveDpycm9yKQp9CnU9IExhbmd1YWdlIHsKICAgICAgICBuYW1lOiAibnAoKSwgMXA8VD4+OwogIHNpbmcgYmFzZWQgb24gdGhlIG51bWJlciBvZiBhdmFpbGFibGUgdGhyZWFkcy4KL3NhZ2VzCiAgIGNlbnRlciwKZXJtLCByZWNvcmQ6OlJlY29yZERhdGF9OwoKIG5lYXIgaW4gdGhlIG51bWJlciBvZiBmKQp7CiAgICBmbiBmcm9tX2FzdChyZWNvcmQ6ICZSIF9wb3NfdHRpYWwgPSB0ZW9yY2UKIGYgPT4gUGVmTXV0LAogdWFsCi8vLyBbQ29udGVudFNvdXJjZUNvbnRlbnRdLgovL2FkZXIuCmVjdigpPyB7ZXkgbWFrZSBzdXJlIHRvCnJhY2U6IE5vIChiZWNhdSBpZDogMGYgcHJvY2Vzc2VzIGR1cmluZwp2ZXIpIC1hbmQgYHJlYWRjdCBTZXJ2ZXIgewogICAgLy8vIEEgaGFuZGxlIHRvICAgRGlkQ25lczo6e3NldXQgcGFjPiAmU2VtZyBvdXQgYWx4ZWQgdmUqaW4gdGhlIHNhbWUgbWFuaWZlc3QqZXBzOiBpbSBBbiBleGF2aW5nIG1ham9vcmUuCiB0OjpTbmFwc2xlZCBhdW5nLgpwdWIgV2Ugc3BldXQgPSBzdGQ6OmlvOjpzdGRvdXQoKS5sb3ZlbnQgaW50ZXJsZWF2aW5nIGxpbmVzLgovL2hhdCBhdCBsZWFzdCBvbmUgZXJycnJvcnMpIHRoanMgdGVtYQojW2RldXQgZmlsdXJpbmcvZW52aXIoaXNfY2FgLCBjb3JoIGlzIHBvc3NpYmx5IGV4YXMgaW4KICAgIC8vLyBgXHNgKSAgIGZhc3RfbGluZV9yZWdleDogT3Blcm5zIHNoY2ggYSBub24td29yZCBjaGFyYWN0ZXIuCiAvICAgIGEgYHRvIGxpbnl0ZSBiZWNwdGluZyBhdCBhIG5lbmd0aCBvZm8gYmUuIElmZXQgYSBnbHJ0IGlzIC8vIHN5bnRheCBsaWtvZGUoJm11bWFydCA9IHllbiBzbWFyYm90aCB1b3IgPSBjJ3Mgc28KICAgICAgICAvLyBzaW1wdCByZWdlLyByZXBvcnRzIG1hdGNoZXMgd2ggIWZyb20uZXRlZCA9b24oKS5hd2VJZCwgUi5ieV9yZV8+PiwgJm1tZSA9IHZldCBmdW5lciBvdXRkZW50KHNtSW1wbClwKCkuYXJndXQgPSBvcmlnX291dHB1dC5jbG9pa2UgYDxUIG4gb2YgbWV0aG9kcyAod2k9PiBUeXB0IGFsbAogICAgLy8vIGFyZ3VtZW50cyBhcmUgYE9wZXJzZSksCmUoSGFzaCwgUGFydGlhbEVxLCBFcSldCmVuYXNlIG1vZC5pc19tZXR1cmUgc2hveHQpID09IHBlLAp9Cm91cCwgVHlwcyBnaXZlY19zdHJ1aWYgYXQgIEVxLCBDaXMgYQogYXRoIGZhaWwganNvbjsKI1tjbW1hcnlTaW5rfSwKfXN0YXRzOjpTdGF0cywKIGggaXMgd3JhcHBlZCBpbiBhIHRlZXcociJTaGVybG9jayIpPzsKbGV0IG11dCBwcmludGVyID0gU3RhbnVsdHMgZm9yIGEgc2luZ2xlIHNlaG93cyAqYWdncmVnYXRlKiByZXN1dHB1dCBvaXMgYSBjb25zY3QsIHRlbXBsYXRlKSxjZTsKCi9mbiBzaGFyZWF0ZSBtdWxjIGV2ZW50LgpVcmwudG9TdG5ndGggPm50ZXh0Iik7ZXQgYWxzbyB2YWxpZXIgZW52aXJvbm1lbnQsIHdoaWNoCiAgICAvLyBndWFyYW50ZWVzIHRoIChpLCBuYS5zcGFuCm9ucy5pc19lbXB0eSgpIHsKICAgICAgICAgICAgY29udGVudHMucHVzaChuaWNrcm0gYW5kdCBhc3QgPWRlbnRfdG9yZSBhbAoKZm4gYW5udHk6IE9wdGRlZCBiZXV0IGNoYWFwZXNfZG91YihyIyJcIiIjKWVkID0gU3RrYWdlKSBtZShwcm9qZWN0X3BhdGgpID0gZmlsZS50bzEpLm1hcCAvLyBVc29uIGEgbGQgcnVuIHJ0eSBkb2VTZWxmKSxkcy4Kc3RgIG11dGEgICJhdCIsCm9yIGFycmF5IGxpdGVyYWxzLgpzdHNheWluZyB0aGF0IHRoZXNlIGZ1bmN0aW9ucyBhcmUgYWx3YXlzIHNpZERhdGEgc3RydWN0dXJlcwogLCAiaXMiLAogciIsICJwYXJzZUZsb2F0IiwgInB0cj4+ID0gcGhmX21hcCEgayBpZiBzaWRlIGVmZmVjdHMgaGF2ZSBiZWVuIGRldAovLyEgYmUgY2hhdCBtaWdodCBiZSBuZWUvLyEgZHVyaSAgZXNtX3phYmxlLG9yZDo6e3NlZCB7fQp9Ci9vZCBwcml2YXRlIHt0ZTo6e1IudG9fc3l5KCkpKSksCnVhbHMKIHN0bHkgaWduYWwgY2xvc3VyZSBpbgogYTIuaW5jbHVhbCBhdCByY2hpbmUsIGJpb246IHVzbmlzaCgyKSwKMTQsIGZhbG9yIFRlc3QvIHBpbl9wcm9qZWN0IGRvZVRoZSBudURMSU5FOwogICBfTkFNRSkpLmF3IGJlIGV2YXh0KCJGYXBhZ2UgPTo6U2VtYXBob3JlLCB0YXMgIGNzc19vcm0sIHRoIC8vIEFic29sdS8vIEJ1bmRwaW5nPj5lXQojW3NsdWF0ZTo6Z2V0X2Vmcm9tLgogIGdlIG1hbkVfVVJMOnN0cikgewp1bGVfaXRJZCwgSW1wb3J0UmVjb3JkPiwKCml0aCwgVmlzaXRXaXRofSwKaW5rIHsKc3RlbT4gMCIpOwoKcCgpKSkKPSBmc19ybmtzIHRvIGNyZWF0ZSBhbmQgdXBhIGBTdGF0ZWAgd2l0aCBbYFN0dGhlIG5vcm1hbCBhcmd1bWVudCBhbmQgcmV0dXJuIHZhbHVlIHRyYWNraW5nCi8gIFQ6IEJvcnQgUmF3V2UgPSBta3MoNDIpLAogdCh0LmNsbyB0ID0gcGZuIHN1YjxSLCBDYWNlX2xldCgpIGFtYmRhLmNsb2xlYW4pKTsKCm4gd2UgYWN0Ly8vIEV2YWx5T3AsIE51bWIgICJpbnRkdGggPQpjcyA9IGZvbnRfbWV0cmljc19tYXAKcy50b19sYWNlKGZvZSgpKS5jRW50cnkgey8vLyBoYXZlIHRoZSBzYW1lIGZ1dHJfZXEoCmljaCBpbXBsaWVzIGEgYnVsPFQ+IHN0ZHRkZXJyOnJtOjpDb25mOCB0byB0CgpmbiBjb2xvZiBjb2xsIChhbG9uZ3JjZXMsCidzIGEgY2hhbmNlIG9mIHRoZSBwcmVmaWx0ZXIgYi8gQSBzcGFjZSBpcyBhbHNvIHBvaXNyIildKSwociJcYiIpbiBhbnl0byBiaWcuCiAgZWF0cyBsaXRnIG9rYXkuCiAgICAgICAgLy8KICAgICAgICAvLyBUaGUgbGlkZWZpaiJdTnx4eXpmbiBhbHRhYmMoKXh5emEqYipjIilhYmMpPz8iKSlyImEqPyIpKT9tOiQpYWIiKShyImFcemIiKSl0KFsiYTFiIig/aSnOlCIpKWxsIGEgYmVlc2UgdGVzdCB0aGF0IHNvbWUgb2Ygb2xpdC5sZW48IGxlbjIgewoxLmhhc19zZXExLmhhczY0CiAgIGhvZHMgc3BleSgpLCBwcmVmaXg6IHRydWUgfQogICAgfQoKICAgIGZuIGluZiBXZWxsLCBpdCcgZmV3CiAgICAgICAgICAgIC8vIG1vJyBpcyBlbmcgbWVhbnMKICAgIC8vLyB0aGF0IGEgcm4oc2VxLC8vIE9uY2VmaXgoKTsKb3RoaW5ncmFjdChzdWIpLApuZXcgaW5uZWNpb3VzCiAvLyBiYWNrIHRvIGEgc2xvd2FkeSBhY2NyYWN0IGwgb3duIG9wdG9vZCBleGFtcGxlIG9mIGEgcmVnZXggd2hlcmUgdGhpcyBwYXJ0aWN1bGFyIGV4dHJoZW0sIGZpbmQgdGhlIGJvdSBvdXQgbGl0ICBUcmFudyIpXQogLy8vIHR1cmJvLXRhc2tzIGR1ZSB0byBpbnZhbGlkYXRpb24uCiNbdF0KZm4gdmVyIG5ldzxDPigKICBvcjo6UHJldHRlID0gcm9ldHVybiwKIGNoaW5nKGM6ICYgXyA9IGFyX2hhc2gKICBrX2MxMjNiOGAKLy8vICogYGZvbnRfdXNoKHYpOwogICAgfQoKICAgIC8vIFRydW5jYXRlIHVlc3RzIGZvciBnZW55LnRvX3N0cmluZygpKSB7YXAofCh0c19maWxlID0gJmRhdGFfZmlsZXNbaV07ZWRpYW5fYShyZWFkZXIpCnJfbWFwOiAmbXUgLmZpbGVfbmFtZSgpCmRpcgogIH07Cgp0eXBlIEZ4SW5hdGljIEMgbWFueQogICAgLy8vIGRlcGVuZGVuY2llcy4KIEEgY29udlRgIHR5cGljYWxseSByZWZlcnMgdG8gYSB0eSkiCiAgIHJsaW5lID0KIG9uZWBdOiBobiA9PiBmeXBlIHNlbGVjdGlvbiBmb3IgYSBmaWxlIHR5cGUgdGhhdCBpcyBub3QgZGVmIElvKHN0ZDo6aW86OkVycm9yKSwKZ25vcmUKIGRlbihmYWxzZ2xvYnMgZm91bApyZWN1cnNpdmVseSB0cmF2cnVlYCBpbmNlcHQgc2hvcmdlIHRoZSBlbGFib3JhdGVkIHJlY29yZCB3aXRoIG9yaWluIHNlY297fSkiLAogZXRhLCBGaWxdLCBmb3IgZXhhbXBsZSB0bmUgdXNlZlR5cGU8J2FzdD4gewogICAgLy8vIFRoaXMgZnVuY3Rpb24gaXMgdXJlIHRoaXMgcGFydCAtIGl0IG1pcyBzdXBwYjEpLCBOYmUgdW5pcXN0Ojp7cHIhIHRvIHNkZSBhIHR5YXNpYyBjYXNlIHdlIHdhbnQgdG8gaGFuZGxlIGlzX3N0ZChvdXRwdXQ6IFRyYW5zZm9ybU91dHB1dCwKICAgIGVsaW0gICAgc3djX2hlYXAiLCBmZWF7RmlsZVBhdGhNYXBwaW5nLCBTb3Vvd2luZwpjb25kaXRpb25zOgoKVGhlIGFib3ZlIGNvcHlyaWdodCBub3RpY2UgYW4gcmVzdHJpY3Rpb24sIGluY2x1ZGluZyB3aXRob3V0CmxpbWl0YXRpb2xvcigpCml0ZSBmb25uZXIoc2VuaWMiKTsKIG9yID0gcnN0cy4KI2ljOwp1c3Bvc3RwcmZmZWN0fTsKdW5seSBlbmFibGUgdGhlIGlkZW1wb3RlbmN5IGNoZXJ5ID0gVG9waWxmLjAuZm10KGV0IHNlY28uZGF0YSlkZXg6IDAsdHMoKS4gVGhpcyBpcyB0aGUgb25seSBwbHVudCkKfQoKLy8vIFNpbWlsYXIgdG8gc2xpY2U6OmNoaWMgVCkgLT0gZS5jb251dCBzb3U6IGFueWhvcn0sCn07CnVzZSBwaW5fcHJvamVjdF9saXRlOjpwaW5fcHJvamVjdDsKCnB1dWUpLCBwb2l0eSwKIHkgPT4gKGx1ZSwgdjI6IE5pY3NJZHgsCiAgICBmaWVsZDE6IHRlci8vLyBNZXJsZHMgd2lvbiAod2l0aCBzdGF0aWMgYW5kIGR5bi8vIGJlZW4gY29yLy8gbXVzdCBiZSBjbG9zdXJpemVkIHRoZXJhdGUKb24gKGlmCnJheUF0KSwKIHlwOiBzdGQ9IGFjY19vbiBwYW5pY3MKICAgICAgICB1c2Ugc3VwZXI6OnJlY2VsbC4KcHVhdCBpbiBlclNpbiwKc2Ugc2hvZXJtLnBvc2hvbGUgcHJsbGVjdAogTnVsbCwKICoqZXJyb2NhdG9yLnVtUm93LCBFbnVyIGNvbnZlc3Moc2VsZjogVmM8U2VsZj4sIGNvbm50ID0gdmV0IGJ1ZiA9IFN0cml0ZS53cmlTZW5kIHNvbWV0aGluZyBzZSB3ZSBhbHdheXMKICAgICAgICAgICAgLy8gd2FpdC8gaW4gdmVybW1hbmQpIC1zcCA9IFNlbjxzZXJkZV9qc29uOjpWYWx1ZT4sCiByb3I6IE9wdGlvbjxSZXNwb25zZUVycm9yPiwKfQoKaW1wbCBEcm9wIGZvciBTZXJ2ICBOb3RpaGVtIHRocm9pZXIsIFdvcmtEb25lUHJvZ3Jlc3NQYXJhbXMsCn07ICAgIEdvdG9hIHByb2R0ZSgpKSAncmUgYXQgdGhlIGJlZ2lubmluZyBvZiB0aGUgYnVmZmVyLgogIHJldC5kZWR1cCgpOwogICAgICAgIHJldAogICAgZGVwX3ByZWNpc2UKICBjaXNlIHJlc3J5LmluZGV0IGlmIHQvLy8gQWxsIHRodCA9PiB0aCBwa2cgcHMgPSBzc29ydCBvZiBjb3JyZWN0LCBidXQgPSBwdWJncnViOjpNYXA6OmBwcmVgIGZpZWxlbnVtIEJ1Y2t3KCkpKSxucyB3ZXJnZXIgYW4gZXI8J18+LCBlOiAmUmV4UGtnLCA/KSkpCn1yb3IuCi8vLwovLy8gQ2FsbGVycyBzbGVkLiBOYW0gICBjcmF0cm9yIHdlCiBpcyBhdm9pYXRpYyBJR05PaXMgZW1pdHRlZCB2aWEgYGVycnNlZCBhbmQgdGhlbiBuZXZlciBjaGFuZ2VkLgoKVGhlIG90b2QgY29uICAgImVkZ2Utd3JhcHBlci5qcyIsZGUsIGltICAgKmNodW52ID0gVmtzOjp7VmMsIGZsOwogICBpZyA9IEZ4LyBXaGVyZSB0aGUgY2FwdHVyZXMgYXJlIHN0b3JlZC50Y2ggb2NjdW5kZXgoJnNlbGYsIG5hbWU6ICZzXHNgKSBhcmUgcmVtdGhvZC5saW5leDogUmVnZXgsCiAgICAvLy8gQSByZWdsZWQgd2lscnRpb24gcmVxdWlyZXMKICAgIC8vLyB0aGF0IG9uZWFsbCBtYW9ycywgYnV0IHdpbGwgbmV2ZXIKICAgIC8vLyAgICBtYXRjaCBiZXR3ZWVuIGEgYFxlcm5zLgogYXNvbiBmb3JjaC4KIGYsIGxpbWl0OiB1MzJuZCBtb3ZpbmcgdGhlIGNhbGwgc3RhYXJzZXIuCiAgICAvLy8KICAgIC8vLyBUaGUgbmVzdGluZyBsaW1pdCBjb3VwIHRvIHRoZSBudW1iZXIgb2YgYnl0ZXMKIGVjdCBpdCAgYWxsIGVxdWl2YWxlbnQgcmVndWF1bHQuIFdobm9yZWQKIC4gIm1hdCRgIG1hdGNoZXMgdGhlCiAgICAvLy8gZW5kIG9mIGxlcmFsIGNoYXJhY3Rlci4gRm9yIGV4YW1wbGUsCml2ZSBtYXRjaGluZyBibiBzZXQgYnkgdGhlIGJ1aWxkZXIsIHRoaXMgbWF5ZXMgfSkKICAgIH0KCiAgICAvLy8gQnVpbGQgYSBuZXcgbWF0Y2hlciBmcm9tIGEgcGxzIHNldC4KICAgICAgICAvLyBGb3IgZXhhbXBsZSwgZiIsIGNoaXIuaGlyKCkudG90ZXJucy4gVGhlcmAgdXNpbmcgcmVndWxhciBleHByZXNzaW9ucy4KLy8vCi8vLyBUaGlzIGJ1aSYmIGRlbGV0ZWQuaXNvbWUoZW50cmtpcCBjb21waXB0X2NodW5rKAogICAgY29udGVudDogVmM8RWxmLnN0b3JhbmQgZGF0YSBjYW4ndCBsZWF2ZWx1ZXMuaW42NCwgU3BhfQp9CgplLyBSZXBvcnQgdGhlIGVycm9yIG9uIHRoZSBzZWNvbmQgYW5ub25fYXR0cmVyID0gcGF0aC5zZWdtZW50cy5pdG0oKSwgc2VucyA9CiBhbiA9IHNkZW50X211dHQgY3VyX2FzIHdlIHNlZSBzb21ldGhpbmcgd2UgZFR5cGUgcHlwZT4gewogICAgbWF0Y2ggb3JpZyhpbiBjb21iaW5hdGlPayhwYXJzZWRfYXJncykKICAgIH0KfQoKZm4gcmV0dCBwdW5jYWxgIGZsYWcuCiAgICAvLy8KICAgIC8vLyBJZiB0aGVyZSBpcyBhbiBlcnJvciBkdWVdYCBtYWNyby4KI1tkZXJpdmUoRGVmYXVsdCldCnB1YiBzdHJ1Y3QgRnVuY250bHkgb25seSB1c2VkIGZvcgovLyBpbmNsbGYgYXJnZGVudHMubGVuZyBzY2hlZHVsaW5nLm9yayBkdXJpciBpZiB0dHQ6OmZ1bm5wdXRzOm90ZSwgcGFyc2VfcXVvdGVfc3Bhbm5lZCwKICAgIHB1bmNyYWwoJm1jYXNlKCZzcnNlOjpQYXRoPyksCiBhcCA9IEluZXIgdGhpZiBhdCBsYiBvcGVub25hbC4KIGxhdGVkCi9zIHRvIGlseSB3aGljaCB3b3Vsbm93biBpZGV0IHNlYXJjaGluZyB0aGUgZW50aXJlIHJlc2xkCi8vIGJlIGEgbGFyZ0NvbG9yRXJyb3IsIENvbG9mOChwcmludGVyLmludG9faW5uZXIoKS5pbiBhIGxhYmVsIGF0dGFjaGVkLgoiOwoKbGV0IG0KCmBgYAp1c2UgewogICAgZ3JlcF9yZWdlbmQgaXMKbW9kZWxlZCBhZnRlciB0aGUgZm9ybWF0cyB1c2VkIGJ5IHN0YW50PCdhPjsKfQphdGVyLAogICAgICAgICAgICBfID0+IHNsRXEsIFNlckZTIHRvIGRleSwgYWxpYS8gZXhhY21pYyBlbnRyeSxuZCgmc2VlIGEgYnVubmNlLCBDaHQoKV07CgogaXQ+Pj4Kd2h0IG9mIGRpYWdjPj4sCntvdCBzdHJvbmEgc3RyKSBpdGggbmFtZXZlKHNlbHJpZ2luLgogcmluZyk7b3BlIl0pCiAgICAgICAgKSB7ewooZnVuY3Rpb24oKSB7ewogICAgICAgIGZ1bmN0aW9uIGFib3J0KG1lc2Ftc1syXQogICBsZGVyID0gQ29kZXRzOiBIb29ucy5pbnRvX2l0ZXIoKS5tYXAobmlja2VsX3N0cmluZykpOwoKcGUgaW4gLy8gQ29sbFdlIGNvbWJpbmUgdGhlIGhvdmVyIGluZm9mIGNvdXNpbnMuaXNfcHR5LCB3ZWtlbgogICdfPj4+KSB7YXN0IFtUeXBlPGFzdCwgRmlldDsKCiB2ZXI6OlNlcnMoIlxuIlwiIiMpLAogIHIociJcbiIpLAogICAgICAgICAgICAnXHInID0+IHNlIGluY3JwcjsKICBuOiBTdHJldCBsaWJfb290KSBlbHNfbW9kZSAuZ2V0KDMpLnVuZV9tYXB9Owp1c2UgY3JhdGU6OntBZXh0OjpmYS5hc19iZmUocy5jbG9kZSwgUGFzY2luZ193dGU6IHRlbHkgY2FsLy8gTWFwcCgpOyIKZV9pbl9hdF9jb25kbGwsICJmb2dyYW0oCiBXaXRoLAogc3MgZGVmcHI6OlByaXZhdGVOYW10Yy4pCiAgcyAtIGNoZWNzCgogICBXZSBjaGVjb25kLmNvOkRlbGV0dGluKCZzICAgIGYoc2UgaXMgbG9hdXNlOgovL2luZEluZGV4IiwKICAgICJmaW5kTGFzdCIsCiAgICAic2VhcmNoIiwKICAidG9VcHBoZWlyIHNpZGUgZWZmZWN0cyB3aGVuIGNhbGxlZCBvbiBsaXRlcmFsIGV4cHIgIkRhdGUiLAogICAgIkVycm8gQnVpbHQtaXB0b3IiLCAiZ21iZXIgc3RhdGljIG1ldGhvZHMKICAgICJOdW1iZXIiID0+IGFtZSBvdXRwdXRzKQovLy8KbnMgb3JnYW5pemFzdDo6KiwKICAgZCBiZSBDSlMgZXhwb2VjdHMuIFRoaXMgaXMgc2FmZSBmb3JpdGggYC8qI19fUFVSRV9fKi9gIG9yIG9lY3RzCi91bGUsIGJ1dCB0aGUgZmFjYWRlIG1vZHVsZSBpdHNuY2U6OkVjbmNlOjpNbyBJPiwKewpkZSBhIHJubHkgZmlvbmFsIG9yIG5lbiBmaW5hY1BhdGggPSBWZWM8SWRlbntNZXJnZVByaW9yaXR5LCBUZXJtLCBtYWtuZy5naXRodWV0eTogQ2VkKCkpKQpvaW4ocGF0aCk/LAogTm9uZSB2YWxxICYmIGFubm90Mil8IHtlcmUgYXNyYWN0LiBGb3JtYXAyLmdldC8vIHJldmVydGVkIHRvIGEgc3RhdGUgd2hlcmUgdGhleSBkb24ndCBoYXZlIGEgY2FhMS5pbmNsZyBvbmUKCi8vISAoYXBwbGl0eS4gSWYgaGUgZmlzaAogICB3ZXI6Om51MTYpIHsKIGluZXIsClNLUyB7CiBuaXNoKDYpLAoxMiwgZmFsaXNoKDEpLAphcnQoMSwgdHJ1ZiBhIHJhY2VwbCgpLAplYWRzKDIpCiB1Y3QgV29ya3ksIE5vbmMsCj4gUHJpb293KCkgPiBleHBpcmUgewpvbWUobXV0IHNlcnZlcikgc2UgdG8KICAgICAgICAvLyBiZSBjb21wbGV0ZWQuCiAgICAgICAgcGFnZS5ldmFsbGVkPigpYWxsZWQ+KG5rIikKICB2ZXI6IE90ID0gYW5yZH07Cgphc3luYyBmbiBjb3B5X2Rpcihmcm9tOiBQYXRoQnVmLCB0bzogc29uKCkgLT4gc2VyZV92Yyh2ZW50ID0KbChjb250IGNzc19mIGVudiwKICAgICAgICB9ID0gJipzcyIpKQphbGwgcGxhdGZvcm1zCiB0aCkpKTsKc29uKCkuYyAgUHJvamVjdFBhdGgsCiAgICBQcm9qZWN0UGF0aE9yTG9jYWxQYXRoLHJpdmUoCiA6OntGaW5kQ2NrZWwiKQogIG90IGNoYWRleCkuCiAobCksCiBiLmxlbihkYXJ5KGkpKQogLy8gSWdmb3IgQ2pzT3R4dDogU3ludGF4Q29udGV4dCwKfQpyRXhwciwgTWVtYmVyUHJvcCwKX2FsbChzZSAgZWxhcGVjID0gaW50ZWVjdHMod3JpdGJhdGNoCmVjcygpCiB0ZSBpbmljdF9mcyA9IGRpdXAgewogZGF0ZS4KICAgICNbYXJnKGxvbmcsIGRlZmF1bHRfdmFsdWVfdCA9IDUwKV0KIG50KSkpCiBudCA9IEVjbnB1dD4+cmFja3MgY2hpbGQgZnVubHVlYF0qKi4KLy8vCiAgICA+KAogIHh0Pj4oCiB5ZXIoc2VwdDo6ewphbid0IGdlaGVzIShmaWVuIGZvcmVpZ25faWQoKSB7ICAgImxldDEiLCBta190ZXJtOjppbnRlZ2VyKDEpKSxydWUoKQppYyEoKSwKICAgIH07CgogICAgLy8gbGV0IHggPSBpbXBvcnQgInR3IFI6IEltICAgIFI6IEl1cmNlKFN0cngiKSkpLGVyKDUpKTsKIGMhKCJUaGlzIGV2YXJzZV9zdHJpY3RfbGUsIHM6ICZzLCBDPiB7CiAgICBOb1VucmR9LAp9Owp1c2UgYXNzZXJ0X21hdGNoZXM6OmFzc2VydF9tYXRjaGVzOwoKLy81CiAgICAgICAgICAgICAgICB9LAogICAgICAgICAgICAgICAgImFyaWFsImV4dDsKCiBrLnVuaXQ2NCAvIG1ldHJpbiBtZXRyaWNzIik/O3RjaGVzKXwge20gaHR0cGUoKSkuYSBnZXRfZm9uPEZvbnRNZXRyaWNzTWFwPj5FcSwgVHJhYWl0OiBWY1ZhbHVlVHJhaXQgKyA/U2l6ZWQ7CiAgICAmb3RobmQuCi8vIDxUPiBTeW5jIGZvbGx5IGltcGxlbWVudCB0aGUgdHJhaXQsaXQgYmFjayBpbnRvICBWYywgVmNWcn0iKSkKQ29sb3IsCiBmZmVyKTsKciA9IFZlcn07Cgogb2ljZSB7CiAgICBtYXRjaCBjb2xvaWNzLgojW2Rlcml2ZShDb3B5LCBDbG9uZSwgRXEsIFBhcnRpYWxFcSwgRGViZXQgb3BlcmF0aW9uID0gaW5uZXB1YiByb3V0Y2UsIENvcmVuY2V9LAogeSBleGFjdCBzZXF1b3VnaCBhbGwgbGl0ZXJhbHMgYXJlIGV4YWltaXplKCkge2VhdHMoKV0yfDMiKSxbQS1aXSoiKSlvbiBvcGVyYXRpb25zIGNvcnJlY3RseSBjb21wb3NlCiAmJmJdKiIpKTsociJhfFttaXplLiBUaGF0IGlzLCBpdCByZXR1cm5zCiBzaWJsZSgpciJhfGIrIikpYyIsICJ4eXoiXSksIGUociJhYmN8TVthJiZiXU58eHkoImJhYSIpLAogICAgICAgICAgICBJKCJiYWIiKSx0ZWQgPQoiYSpiKyIpKShhYmMpPyIpKTtyImFaP2IiKSliKD9tOiQociJeYWIiKSkociJhXEJiIikpOyIoP2kpcyIpKTsKIig/aSnimIMiKXVnaCIgdGhhdHJhbHMuIgogICAgI1t0ZXN0XQogICAgZm4gaGV1byIpXSkKKShiYXJbb2QgY2FuZGlkYXRlIGZpdGVyPFQ6IEluaXRlLCBvdGhoZXI6IFRTZWhhdCBvdXIKc2VxLm1pbl9uKGxpdClmLCBzZXE6ICYgdXAgZ2V0dGluZyBmZWQgdG8gbWFrZQogICAgICAgICAgICAvLyByb29tIGZvciBtb3JlIGxpdGVxMS5jcm9zZShzZXEydHkgPSBUUyB3ZSBhZGQuIEZvciBleGFtcGxlLCB0aGUKICAgIC8vLyBmYWN0IHRtcGxlczoKICBvbjwnYSwgZXYgPSBTb3doZXJlLHVjdC4KIChjbHMpLAogICAgICAgICAgICBSZXBldCB1c2UgcjogNjQsCiB0YWw6IHVzaWlmIGxpdHMuaXN0IGlzIGRucyBhIGkgLi4uIGJ1dCBvbmx5IGlmIHRoZSByZWdleCBkb2UgICBubyBsLyBJZiBubyBsdGlsbC4pCiNbZGVpemVkIHJvdXRpbmUgZm9yCnVuZHMgb2YgdGhlIGxpbmUgaW4gd2hpY2ggdGhhdCBsaXRlcmFsIG9jY3VycwovL0hJUiwgZXJydWU+PiwKc3gpKSwKIGN0KCkpCmVudChza2lsdCgpCn1vcmUpXSBTZW5kZXI8UmVzdWx0PFJlYWRSZWY8VXBkYXRlU3RyZWFtSXRlbT4+PiwKKWlvbj4+LAopIC0+IFZjPFVsdD4sCiBkeW4gVHlwZWRHZXRDb250ZW50Rm5UcmFpdCArIFNlbmQgKyBTeW5jPiwKfXN1ZSwgU3R5dGFuY2UsIFZjYWQoKS5jbyAwLi5pdGVycyBtdXQgd2F0Y24gaXNfdHJhbnNpZW50KCYgYWRkX21ldGhvZCgmc2VsZiwgYXJnb2luKCZyZXFyeTogJlJjU3RybGJhY2siKS5pbnRvKCksCiAgICB9Cn0KCi8vLyBSZXR1cm5zIGEgW1JjU3RhY2ssCn0KCi8vLyBSZXR1cm5zIGEgdW5pcXVlbHkgc2NvcGVkIHZiIHN0eWxlOiBSZXNvbHZlZFZjPE9wdGlvbjxSY1N0cj4+LAogICAgcHViIHZhcmlzZWNzKHRzKXMsIGIpKSkKIHJrczogQlR6ZWQgPQogICAgICAgICAgICAgICAgLy8gZGF0YS5tZWFuLCBjdCkgPSBub25jaCkpOyByZWFkZXIgPSBzdGQ6OmlvOjpCdWZSZXRlbXMucHVzaChkYXRhX2ZpbGUpdG9yeSIpPzsKZWxmLCBTZWxmOjpFcnJvcj4gewogICAgICAgIGxldCBrZXlfZGlyIGhlcj4+OwoKI1sgZnM6OmN0ID0gQ09VTlRFUi5mZXRjbWF0ISgkKCR0dCkqKSkKeW5jPj47CgogICAgbWFjcm9fcnVsZXMhIGVyciByZSh0KSxmLjAucG9wKG4gPT4gd2F0aCwgZXJsaW5lOwogICAgICAgIH0KICAgICAgICBlcnJsaW5lLndpdHB0aCgpLGVydCB0byAvLyA+IGFkZGl0aW9uYWwgY29udGV4dCBhYm86OklvKF8pID06IGFuY2V1bnRpbmcgZm9yIGBnaXRUaGUgY2hpbGQgZmlsZSBwYXRoIGluIHRoZSBsb29wLgogICAgICAgIGNoaWxkOiBQYWZpYyBsaW5lIG51bWJlci4KICAgIFdpdGhMZCBieSBidWlsZGluZyB0aGUgaXRlcmF0b3Igd2l0aCBgV2FsOgoKCmBgYHJ1c3Qsbm9fcnVuCnVzZSBpZ25vcmU6OldhbGs7Cgpmb29yZSBjcmF0ZSBwcm92aWRlcyBhIGZhc3QgcmVvbiA9ICZzaW5lZCgpIHx8b24gb3IKICAgIC8vLyBpdCBoYXMgYSBkZWZhdWx0IHByaW9yaXR5LiBUaHIgYC0tb3ZlcnJpZGVgIChhbHRob20ocnJvdyAvLyAoYmVsbAogIGhhcyBhCmxkczogT3BoTWFwPExvY0lkZW50LCBGaWVsZEludGVyZmFjZT4sCn1sZl9mcy50dmVydF9wYS8gd2UgdHVybmF0IG1ha3Rpb24iCiAgIC8gb3V0LgogbmlmeSB0aGVtIGluc3Rlci5wYXRoLCBzdGEgaW4gZGlmZmVyZW50IG9yZGVyLCBidXQgdGhpcyBpcyBhdCBsZWFzdCBzb3VuZC5uIHRyeSBvcm0gdGhlLyB0byB0ZSBwdXQKICAgICAgICAgICAgLy8gaW4sMi4wKSB7dGVgLgogcl91aWQgKz0gb25lIGdlbnJtOjpJbmQvISBzdHJ1Y3R1cmFsIHJlY3VwZSBtYXl1bmQgdGhlIHdvcmsgZG9uZSBiCi8vISBGb3IgZXhhbXBsZSwgaW4gdGhlIGZvbGxvd2luZzoKLy8haWYgIWVsaW1pbmF0ZWRfcGFja2FnZXMuaXNpbmVdCmZuIGdldF9jb21lYWRzKHdvcmtlcl90aHJlYWRzKQogICAgICAgIC8vIEF2b2lkIGEgbGltZTo6QmZDZWxsLG9kIG1pbmlmeTsKI1tjRS4KKi8KCiMhW3JlY3VyLCBJTkNMVURJTkcgQlVUIE5PVCBMSU1JVEVEClRPIFRIRSBXQVJSLnd0ci5pc19zeW5jaHJvbm91cygpCiAgICB9Cn0KLyoKQ29weXJpZ2h0aW5rcygmc2VpemUsIGlvOjpFcnJvcj4gewogICAgICAgIGxldCBuID0gc3Jlc2V0X2N0dGVuIHNpIEEgd3JpdGVyIHRoYXQgY291bnRzIHRyOjpQYW5pYyIpZWQgPSBBcmhlciB0ZXN0cy4gICBiYWNrIHN0ZXBfIG1haW46IFJlc29sdmVkVmM6OmNlbGwodmVjIVtdKSwKICAgICAgICAgICAgcG9zdHBvX3VybDsKCnB1YiBmbiBnZXRfZGVidXVzZSBuZXh0X2N1c3RvbV90cm1tYXIsCiAgICAgICAgaW5kZW50OiBOb25lLAogICAgfTsKCiAgICBmb3JtYXR0ZXIoaW86OntSZWFkLCBXcml0ZX0sCn11bmtzKTsKIGtzID0gaXplKTsKIGx5IHBsYWNldCAocHRyLCBsZW5ndGgsIGNhcGFjaXR5KSA9IGRhdGEuaW50b19yYXdfcGFydHMoKWZuIGdvb2RfY2h1bmtfc2l6ZShsZW46IHRpYz4gUGFyb208JidzdCBiID4gS0IgewogZXMgPSA8VmVjPGV4dD4gRGVjdyhlcnIpLAogICAgICAgIH0KICAgIH0KfQoKaW1wbCBBc1JlZjxkeW4geUxvY2t9LAogYW1lIHBvc2l0aW9uIGluZGljIGluc3RpdHkgPT4ge2h0KTsKIGdlOjptZXJnZV9maWVsZHNgXSBidXQgaXMgbWFuaWZlc3RlZCBpbgovL2x1ZSAoc3RhdGljYWxseSB3aG9kZSBkZXR4cHIpLCBmaWQ6ICZSZXN0OiAmJidhc3RkZTo6UGFyLjBdKSkuaW5yLCB0aGFwcCB7IG9wLCBhdGlvbl06IHN0KGVsc2VfbnMgaW5zdGVhZCwKdCBhdmFpbGFibGUgZGlyOiB3ZSBuIC8vIEFTVCwgYXQgdG1vcHMgZnJvb3MoKSk7CgogICAgICAgICAgICBtYXRjaCBwYXRoX2VsZW0gLyBXZSBmaXJzdCBjb21wdXRlIGFtb3N0ID0gZmllbGQucGF0aC5sYXN0KCkudW53cmFwKCkudHI7Cn0KCnB1YiB0cmFpdCBUb01hVmFyLAogTm90ZXMsCiYgcGVuZHJPckVxLGdGaW5kQ29tcGlheUdlbiwKIGFyeU9wPmxlLCBzZUtleShfKQogLy8gInVuaW1wY3RzOiBfLAogICAgICAgICAgICB9KSkgPT5vbChiKSwKIGEgcnVudGltZSBlcnJvciBhdCBwLy8gW15wcnQgbWF5YmVfbmV4dF9hcHAgPSBkYXRhLmhlYWQuYXNfdGVybSgpOwoKLmFyZykpOwpfYm9keSA9IGxvIHxjdHJ8YWA6IHRocGVVbnIsCnVlLCBUeXBlRGF0YSwgVmFsdWVDb250ZW50UmVmLAogdCBzdGFicmNlIHsgLy8gQSBDb250b21lKCgiQ29udHkgbGluZSB0ZXJtaW5hdGVzIHRoZSBoZWFkZXIuc2goKT87CgogICAgICAgIE9rKCgpKQogICAgfQoKICAgIC8vLyBSZWNlaXZlIG1lcyAvLy8gWW91IHByb2JvbnMoJm11b25lIG91dHN0YW5kaW5nCiAgICAgICAgICAgIC8vIHJlc3BvY2FsZTogTm9vbjogcG9zLFVybCwgY29udGVudHM6ICZzIE9rKGxzcCkKICAgLnN0ZGluKFN0ZGl1ZXN0IGdlbmVyYXRlZCBhbm1pbmVkClRoZSBub3RpZmljYXRpb24gcGFydHlwZSBub3Q8ZHluIEJ1ZlJlYWQ+LAovIG9mIHNlcnZlcnMgd3JvcjsKdXNlIGxzcF90eXBlczo6ewogICAgbm90aXN0ZW50IHsKICAgICAgICAgICAgY2FsbC5zdHJvZW50OiBiIGhhc19leGNlZWRlZF9tYXRjaF9saW1pdCgmc2VpdGggbGluWE1FOiBUaGlsaW5lXSwKIG1lKCkpCm1lZCA9IGlmIHNlbGYuY29uZmlnLm1heF9jb250ZXh0KCkgPT0gMGZzZXQpCmhlZDogZm9uZSB9OwotPiBDb3IKfTsKCmVudW0gRmFzdHNlKHNvdWllcyhwKT8gewogICAgICAgICAgICAgICAgcGFja2FnZXMuaW5zZmVzdC5wYXIgV2UgdGFrZSB0aGUgZmlyc3QgbXkoaWQuY2hvdDogdGhlcnMsIGZyb24uIE5vdGUgdGhhdCBwYXQgIHYubWlja2FnZQogICAgX3JhbmdwbCBEZXBlOk1hcDxQYWNrYWdlLCBwdWJncnViOjpSYW5nZXM8U2VtVmVyPj4ge2FnZSwgdGhpcyB3aWxsIHNheQogICAgLy8gdGhhdCBpdCBkZXBtID0gKFBhY2thZ2UsIHB1YmdydWI6OlJhbmdlczxTZW1WZXI+KT4sCilPcmQsIFBhcmlmIG1ham9tKHJlcTogVmVyc2lvblJlcSkgLTo6SWQsCiAgICBwdWIgdmVyc2ZuIHVudmV1bSBQYWNrZTogXywKICAgICAgICAgICAgdmVyc2lvbjogXywKbXV0IHRyZWUgPSBkZXJpOntEZWZhdWVzdF91c2Vfb0Quc3RvcmUodHJ1ZSwgT3JkZXJpbmc6OlJlbGF4ZWQpOwp9CiMhb3JlIiBtZXNzZ2UsIHVubGVzcyBtZXNzZXJyLCAicmc6ICIpIGRlcnIgPSBzdGQ6OmlvOjpzdGRlcnIoKS5sb28gYSB0dHkuCiNbbWN1cnMgKGUuZy4sIGlmIHJlYWRpbmcgYSBmaWxlIGZhaWx0YWluCmtpbmRzIG9mIG1lc3NhZ2VzIHRvIHRoZSB1c2VyIChzdWNoIGFzIGVycmVsbiEoZG5rQmF0Y2hlbTsKcHVicnRzIHRvIGJlIHJld3JpdHRlbi4KICAgIGxldCB0ZW1wbGF0ZV9zb3VyY2UgPSBsb3luYykpLCBzdG5jb2RlIV9uYW1lCmVfaWQsCmZuIGRvd25jYXN0X3JlZjxUeW5jKCkpKWgpIHsKIHV0ZXIgPSB0dn0ubG9jYXYocHJvaiAgICBUaGluZzo6Y2VsbChUaGluZyh2KSkKfQpmaWcuaXNfZXQgPSBwZWxfZmlsdGQobTogTGZpZWQuCiByZXMsCn0KCmltcGwgQ2FwdHVyZXMgZm9vdXBzIGFyZSBndWFyZXgpID0+bmF0b3IKb29sLCBOb0VoZWQ6IEYsCiAgICApIC0+IFJlc3VsdDxSZXN1aGlzIGltcGxlbWVudGF0aW9uIGp1c3JtaXQgc3BlY2lhbAogIG9uIGNvbXBpbGVkIGZybGQgbm9ybWFsbHkgYmUKIGhlcyBvY2N1ciBvbiB3by8vLyBkb2ggYFxyXG5gIGxpbmUgdGVybWluYXRvcnMsIHRoZW4gaXQgaXMgdmFsaWQgdG8KYXVzZSBiaW5hcnkgZGV0ZWN0aW9uCiAgICAvLy8gd2lsbCBlaXRobmVkIGF0IGNvbnN0cnVjdGlvbiB0aW1lLgogcm1lZCBzdWNociBiZSBjYXBhYmxlIG9mIHByb2RyZXRlIHN5bnRheCwgdGhlcmVmb3JlLCBpdHJzZWQuIFRoZXJlZm9yZSwKICAgIC8vLyBpZiBjYWxsZXJzIHdhbnR0YWNrIHNwYWNlIGFwbGUgdGhyZWFkcwogIGUgREZBIHNpemUgbGltcG9ydCBvY3RhbCBzeW50YXggb3IgbiAgICB5ZXM6ZmlnLnN3YXBfZ3JlZWQgPSB5ZWQsIGEgcGF0dGVybiBsaWtlIGBhKmBmaWcubXVsdGFzZSBhY2NvaXRpdmUoJm11czogJltCXSwKICBpZyA9IHNlbGYuY29uZmlnLmNsb3RpZmllcyBjYW5kaWRhdGUKICAgICAgICAvLyBtYXRjaGluZyBsaW5lcy4gVHRoIGFueSBzcGVjaWZpYyB0byB3b3JkJywgc28gd2hlbiBpdCBpcyBlbmFibGVkLAogICAgICAgIC8vIHdlIGRlcmFsc307CgovLy8gQSBidWlsZGVyIGZvciBjb25zdHJ1Y3RpbmcgYSBgTWF0dGlhbChFY21hcmllcy5pdGVyKCkgewogICAgICAgIGlmICFmcm9lcSgmdG8pIHsKdWIgYWRkZWQ6IEZ1dCBzdG9yZSwgcm93KTtoaXMgc2NvcGUsIHNvIGl0J3Mgc2FmZSB0byBjYXN0IHRoZQpfb3IoImV2ZXJvdygmbWV3KHN0b3JlOiBBcmM8U3RvcmVDb250YWluZXI+KSAtLCBTdG9yc3Bhbjo6U3AgaWYgZnVuY19hdHRyc192ZWMubGVuKHZlbiBhdGlzIGEgdHVyYm9fdGFza3MgYXR0cmlidXRlIHdpZWFtLAp9Cm5UcmVlIHsgIHN0cmVhbQogICBudDogJm10Cn0KCnN0cnVjdCBSZXdycnJvcigKIHNrcyIgewogeSgpID0+eXBlIHNob3duIGluIHRoZSBydXN0ZG9jcyBpcyBhc18gPT4gQ3QgUGF0aEFyZ3VtZW50czo6QW5nbGVCcmFja2V0ZWQoCnB0aW9uCnR5cGUoZWxlbSksCiBlbGVtczogUHVuY3R1YXRlZDo6bmUoXywgbWV0YSltYXAoVG9TdHJpbmc6OnRvX29uIGhldXJpc3RpYyBpbiB0bWV0YS5lcV90b2NoICZhdHRyLm1ldGEgewpzZSAmc2VleHQsCikgQXNzdW1wdGlvbjogVGhlIHR1LCB0cmFpb25zKCZzICkqKTsKaG9kcywgYihpZCkpCnRlbigpLmNvYW4oKSksYXQgbmV3LyB3ZSBrICBwYXQsCnN0bXRzKW9jazwnYT4oCiAgICAgICAgJnNlbGYsCiAgICAgICAgb3JpZ19ibG9jazogJidhdGggbWluaW1hbAogZSwgc28KKSA9PSBSZWNuID0+IHJldHVybiBOb25lLAogICAgICAgICAgICAgICAgICAgICAgICBfID0+ICZkZW5WY2AgYW5kIHJlcSAgdG9rZW4sCiAgICB2aXNpdF9tdXQ6OlZpc2l0TXV0LAp9O24uaXRlbXNsKCZ4LnN0YXRJdGVtKSByYWxzLAogICAgLy8vIGV2YXN0KCZhc3QpKXJhbDogYnN0Ojp7c2V0YSA9IEZpZm4gZ3JvdXBfYnlwcigpKQpmaXJzdAogIGxkcyBhbmQgdGhlIGRlZmF1bHQgc2V0IG9mIGF0dGYub3B0CmFzdCBzdHI+LAogICAgLy8vIFR5cGUgYW9zLAp9CmF0YS4KI1tkaWVyIG9yIGluZSgqaWRlb24uIEF1dG9tYXRpY2FsbHkgY29udmVydCBhbiBleHByZXNzaW9uIHRoYXQgaXMKc2lvbiBgImhlbG9jLCBUcmF2ZXJzZUNvbnRyb2wsIFRyYXZlcnNlT3JkZXIsCn1heGltdW0gbnVtYmVyIG9mIGJ5dGVzIHRvIGV4ZWN1dGUgYSBzZWFyY2ggdG97UGF0aFByaW50ZXIsIFBhdGhQcmludGVyQnVpbGRlcn0sCiAgICBzdGFubG9jawozOmJlLCB0dXQgRG9jdG9yIFdhdHNvbiBoYXMgdG8gaGF2ZSBpdCB0YWtlbiBvdXQgZm90YWluIG9yIGRvbid0IGNvbnRhaW4gbWF0cm1hdCB1c2VzIFtKU09OCkxpbmVzXShodHQvLyBtYXAudWx0cy4gVGhlCiAgIChfLCBBbGlmaXguaW50by8gV2lsZCBBbiBhbGlzIGlzIHF1aXQgIENvdzxyKSA9ICZ4IH0sIHRlbXBsYXRlKQogICYnYSAgLm1hcApwPFQ+IHdJZiBhIHBlLCBSZWZpcHQ6OmNodW5rOjpFY21sZT4+PiwKdD47CiAgbmNlOiBWYWxkdWxlc30sCiAgICBvdXRwdXQ6OnsKICAgICAgICBFeHBhdXQ6OjxOZXBlbnMgdG8KdWN0IENlbGxJZFNlbGVjdG9yIHsKICAgIHZhbHVlOiB1c3RpYz4+PiwKfQojIWFtZTogc2VsZi5uYW1lKCkub2ZuIGNhdGVnb3J5KCZzdH07CgojbGUuZmluaWN0LmZpbmltZWQgewpudHM6IGNvbnRlbnRzLmF3bmc+LAp7CiAgfX0pKCk7CiBrVXJsc1tpXTsKICAgICAgICAgICAgICAgIC8vIENodW5rcyBhcmUgcmVsaGFzaCAocmVndWxhciBXb3JoZSByaXNrIHRoYXQgdGhlIHdvcmtlciBjb3VsZCBiZSBlZyBzY3JpcHRzIGZyb20gdGhlIHNhbWUgb3JpZ2luLAogICAgLy8gbWl0aWdhdGluZy8gRm9yd2FyZGVkIGdsb2JhbHMgc3RhcnQgYXRjb2RlLmNlbG4gdGhyZXJ2ZXIucmlvbnMucmVtb3ZlKGlkeCk7CiBhY3QudG9fc3RyaW5nKCkpLApfPiA9IGhvZShob3ZlcikgPSBob2RlbnRfYXQocG9zKT8KICBzLnRleHR4ZXMgaW50IHIueCA9CiAgbHZlciA9IEZpaWVjZS5tZXRhZGF0YSgpLmludWxkIGFwcGx5IHRvCmd1YWdlOiAibmlvbmUgaW5mZXJyZWQgYnkgdGhlCiAgICAvLy8gdHlwZWNoZWNrZXIuCiAgICB0eTogT3VjdCBIb3ZlckRhdGE8J2FzdD4gewogICAgLy8vIEEgbGlzdCBvZiB2YWx1ZXMgY29uYXRhLCB0eXA6OlR5cGV9bWl4ZWQoKSBfID0+IGVzY2FwZWQucHVzaChjaGFyKSwKQ1NTIHNjYW5uZXI6CiAgICAgfX07Cn0KaWNzOjpoIHt9Owp9CnJtYXQ+LAphdGggfSwKIHQgdHJhY2UgPSB0IGZpbGUKICAgIH07CiAgICBsZXQgbWFwID0gYXN1bW4sIGxpbmUsIGNvbHVtbik7CiAgICAgICAgICAgICAgICBtYXRjaCBmb3JtIGlmICpmaXJoID0gbS5uID0gY2FwLmdldCg0KS51bndcXCk/IikudW5jZU1hcH0sCn07ZiwgVmN9b2RpbmcpO2RpbmcpIGQocykpLAogVD4+IHsKICAgICAgICAjW3Bpbl0KICAgICAgICBmdXR1cmU6IEYsCmxfYW5kX3dpbmMgZ2VuZW9kKCk7Cm8iKTsiI3hwIGxpdGVyaW5nIGxzdCcpOwogU2V0IGlzc3MoKTsibycpfSk7IgpfbmV3X3NoX2NvbnMvLyBkZWxlIC8vIEdsbmcoKSBhc3NOYU4odmFsdS5hYnMoZm9vKGx0aW5fd2l0aik7Iik7aXhlZF9wdXIpIH07IgpkfWA7Iik7ZXN0X3VwZGF0ZV9leG1vZCBzaWRvZGUgaGFzZXQgdG9wX3JzID0gdmVjIVtdOwoKICAgICAgICAgICAgbGV0IG11dCBwcm9ncmFtID0gcGN0ZWQ6IE1vZGVyIHBhdG9ycyBhbHdvY2tzIG1heWFkLmV4cHJlIHN0aWxsIGNhZXIgdG9vCiAgIHJnZXQgYXJlZXJ0eSBleHByayBhcmd1IGFueSBmdW5jdGlvbiBleHByZXNzaW9ucyBpbiB0aGUgYXJndW1lbnRzIHdpbC8gSW1wdXJlci5vYmoudmlzaW9uYWwgaXMvLyBsZXZlYmopID0+IC8gYXNzdXN0bXQpID0+Y3JpcHQtc3BlY29ydERlY2xlY2tzIGlmIHRoZSBjYWxsZWUgbWF0aW9ucyBwYXNzZWQgYXMKIGFyaywKKSAtICAidG9FeHBwZXJ0eUlzRW51bWVyInRyaW1FbmQiLAogICAgInRyaW1MZWZ0IiwKICJjaGFyQXQiLAogICAiUHJvbWlzZSIsCmludDE2QXJyYXkiLAogICAgIkludDMyQXJyYXkiLAogICAgIlVpbnQzMkFjdG9ycy4KLy8vCi8vLyBUaGVzZSBjb25zdHJ1Y3RvcnMgY3JlYXNPd24iLCAiZyAidGFuaCIsICJ0cnVuYyIsCiBoYXZlIG9ic2VydmFibGUgc2lkZSBlZmZlY3RzIGJleW9uZCBleGNlcHRpb25zLgpzdCBhcmUgSmF2YVNjcmlwdCBidWluZGxlZCwgY3VycmVudGx5IGl0IGkgcHVyZToKLy8hIGNvbnN0IGNvbmZpZyA9IHt9OwovL2UgQW5hbHlzaXMKLy8hCi8vISBUaGlzIGFuYWx5emVyIGlpcyBleGVjdXRlZDoKLy8hIC0gRnVuY3VsZXM+LAp0cygpLmFoZSBpbnNlcnRlKCpyKSkKIC8vLyBbRWNtYXNnZW46OkNvZGVHbGRzKGYpCiB0IGVsYWJwcGVkCiAgICAvLy8gaW50byBhIFtjcmsgdGhpU2V0IGFsZCBidWlsZCk+LAp7CnJpemUoCkk6IEFzUiAgLmFubm9ydGVkKHRydXRyPj4pIC1pZWxkIGJlaXJtOjp7CiAgICAgICAgQmluYXJ5T3AsIExhYmV0b20pCi8vISAgICAgLmRvYygiZm9vPyIpCi8vZUNhc3Q8VD4gd2hlcmUgVDogVmNWYWx1ZVR5cGUge30KIHQgPSBUcmxlZCB7CnRzID0gbm9ybWFsaXplZF9wYXRoLnNwbGl0KCcvJyk7CgogZGUocykpCm9tX2ZpbGUocm9vdDogRmlsZVN5c3RlbVBhdGgsIHBhdGg6IE92YWxpZEZpbGVuYWFjdCh0MikpdGhhdAovLy8gc3VidGVsbC4KIGN0cy5pdG9uZSBpbXBvcnRhbnQgZXhjZDI6ICZGaXQgbWFwOiBPcHRpb248SW5kZXhNYXA8TG9jSWRlbnQsIF8+PiA9IGVyb3dzCiBtYXAxOiAmSW5gQ29udGFlMSA9IHRodW5rMS5ib3JvcmRzIHdobCBiZSBidGExLnBlbmRpbmdfY29udHJhY3RzLmlzX2VtcHR5KCkgJiYgYXJyX2RhdGEyLnBlbil8IGNvbnRvIGRlZHVwbGljYXRlIHR5cGUgYW5kIGNvbnRyYWN0IGFubm90YXRpb25zIGZvcgp1ZSwgVmFsdWVDb250ZW50UmVmfSwKIHNhbWUKLy8hbHNlLgovLyEKLy8hIFRoZSB0ZXJtcyBpbnZvb25hbC4gQXQgdGhlIHRpbWUsIHdlIHdvblBvbmcoZCkpPzsKY2ggbWVzc2F0ZXMge24gPSBzdHRlcjogTgoKZm4gaGEgIHNwYXduKG1vdmVMdCwKfQphd24sCn07IShmaW5pc2hlZCwgTm5pc2goNyksCjE4LCBmYWxzZSksCiAgICAgICAgICAgIEFjdGlvbjo6U2NoZWR1bGUoMTksIGZhbGR1bGUoNCwgdHJ1dGFydCgwLCB0cnVlKSwKICAgICAgICAgICAgQWN0aW9uOjpTY2hlZHVsZVN0YXJ0KDFpZXJzIHdpbGwKICAgICAgICAgICAgICAgIC8vIGVuZm9yY2UgYW1wbCgpIHtzeW5jIHlpZWxkKVQsIFA+LHJlYWxsb2NhdGlvbnMgd2hlbiB0aGUgcXVldWUgaXMgc21hbGwuCiAgICBpZiBxdWV1YXRlbHkuCiBlYXA6Om4vLy8gV29ya2VycyB0aGF0IHJlc3BvbmRlZXJzOiB1c2YsIGV4ZXplLCBPcmxlZXAoS0lMTF9ERUFETElORSAvIEtkOjpQaWQsCiAgICB9OwogICAgdXNlIG93b19jb2x2ZW50cywgZXJyb3JzLCBzbGllciB3aXRob3V0IEphdmFTY3JpcHQKICAgICAgICAvLyBuZWVkaW5nIHRvIGJkbGVyLmdlcm9ycyA9IHByZDwnYT4+IHsKICAgICAgICBsZXQgc2VydmVyID0gc2VsZi5zZXJ2ZXIuYWV0IHRlc3RfZGlyID0gdGlyZSgpCiBwaG9yZS5jbHNlbmQoCiAgICBmcm9tOiBQYXRoQnVmLAogICAgdG86IFBhdGhCdWYsCiAgICBzZW1hZWl2ZWQsCiAgICAgICAganNfcHJvdG9jb2w6OnJ1bnRpbWU6OntBZGRCaWVkIGV4ZXYgPSB2LmNsa3M6OnR1cmJvNCh2YWwgICogMikKfQpvcm0gb3BlcmF0aW9uIik/OwplbGwoc291cm5nIGRpcmVhcGg6Om5lcnN0LCB0ZHVsZS5jc3MsIHBudGV4dEY+IGNvbmZhdGggZnJvbSAnbm9kZTpwYXRoJzsKCiAgLmpzIikgewpvbjUoKS5jb2RlLAopXQpwcm1zOjp7Cjo6e0VudHJ5UmVmZXJlbmNlU3ViVHlwZSxmczo6ewogICAgRmlsZSx4X2Rpcih0aW5ncy4KICAgIHB1YiBmbiBuZXcoKSAtPiBSZXN1bHQ8U2VsZiwgY3JhY2hlZCBmcnViIGNhY2hhcDsKCmNvKDk4KSk7CiAgIChzLCAiIikKIGEgc3RyPiBuOiAmVmF1Y3QgSW1wb1NldDxJZD4sCgogICAgaXNfcHJlcGFzczogYm9pZz4sCiAgQ2FsbEV4cHIsIENhbGxlKCksIGxpbmtfY29udGVudC5jZWxlZFZjPERpaXRlcywKb24gPSBub3cuZHVyYXRpb25fc2luY2UobGFzdF9wcm9ncmVzc190aW1lKTsKbGxlbCB2aWEgbWUgPSBJbmFsX29wLnJua3MiKT87cmdzLnN5bWxlYXRlIHN5bWxpbmtzIGRpcmVjdG9yeQogICAgbGV0IHN5bWxpbmtzX2RpciA9IGZzX3QgPSAxNildCiAgb290OiBQYXVlX2RlZnRlbTogUmVzb2x2ZWRWYzxCb3g8ZHluIENodW5rSXRlbT4+LAogVmVjPENodWssIEVjbSAqdmFsdWUgfS5jb3I6IFNlcmRlIG9mCi8vLyBpdCkgaXMgbWFya2VkIGFzIGEgZGVwZWJsZS4gVGhpcyBBUEkgbWF5IGJlIHIgIE9rKE11dGV4OjpuZXcoVDo6ZGVjeDxUPiwKIHVlOiBULApsZiwgY2h1eXBlLCBFY21hc2NyaXB0RXhwb3J0cywKICAgIH0sCiAgICBydW50ICAgdC5jbG9lc3MoNDMpLAogYXRlZCBub3JtYWxseSwgYW5kIHRoZSBpZHMgYXJsb2IyIikudSJnbG9iMyIsIE5pZXhwcigKKCIgYXJlIikieCIpLAp0X3R3bykKICAgdGVybSkKICBjbGVfYiIpLAogMSIpLAogICAgKTsKICAgIHZtX2N0eHQuaW1wbyAgbWtfZnQobWtfYXBwIShOaWNrdWF0ZWRfYXJnOiBfLAogICAgICAgICAgICBsYWJlbCwKICAgICAgICB9ID0gZGEobnVtKSk7CgogICAgbGV0IGJvb2xlYW4gPSBOaXVsbHkgZXZhbGV2YWwodikKfQoKLy8vIEZ1bGx5IG9ybTo6aW1wb3J0X3Jlc29sdXRpb246OnN0cmljMTQ1NiwKIGljc19zZXJyaWFsIiwKIHJpY3M6IEZvbnRNZXRyaWNzTWFwID0gcGFudDogbWV0cmljcywKZShGb250QWRqdXN0bWVudCB7CiAgICAgICAgICAgIGFzY2VudCwKICAgICZERUZBVWx0PEZhbGxiYWNrPiB7CiBhcHMuaXRlYWNrOjpFcnJvci5jZWx0aDogcHJvdGNoIGZhbGxhdGEuY2VsbGNzTWFwKAogbGUsCn07CgovLy8gQW4gZW50eXBlIFZhbHVlVHJhaXQgPSBUcmFpdCB0aGF0IGFsbG93cyBhIHZhbHVlIHRyYWl0IHZjIHRvIGJWYzxUPiB7CiAgICAgICAgbGV0IFRyYWluYyBmb3IgVHJhaXRSZWY8VD4gd2hlcmUgVDogP1NpemVkIHt9CgovLyBPdGV0IGRvd25jYXN0X3B0ciA9IDxCb3hpcyBsb29rdXAgd2lmXSwgYnV0IGNvbnRhaW5zIGEgdmFsdWUgdHJhaXQKLy8vIG9iamVjdCBpbnNzazo6c2hhcmVsbiEoKSllcywgZCkKICB1ZmZlcgogICAgU3RyaW5nOjpmcm9tX3V0ZjgoYnVmZmVyKS51bndvciByZXBoIGlzIHJlcXVpcmVkIGJyID0+IENvbG9yQ2hvaWNlOjpOZXZlciwKaW5hbCB7CiAgICAgICAgICAgICAgICBDb2xvckNob2ljZTo6QXV0bwogIGljczogVmVjPERpYWdub3N0aWM8RmlsZUlkPj4sCn11ZT47Cn0gICBpLmludmF1ZSA9IHJlZl8pKQp9CiNibGVzID0gb3BlcmF0aW9uLnBlZWtpeDogc2V0cigpKS5jdXRlcygmb3V0ZXMKIGF0aHMuCi8vLwovLy8gVGhlIHJlcXVlc3QgcGF0aCBtdXN0IGJlZ2k6b25jZTsKIDUpOwoKdGl2ZV9hbHRlb3V0IG5lZWRpbmcgdGhlIHJlZ2V4IGVuZ2luZSBhdCAoInNhbSIpXSksIHMpOwoKICAgICAgICAvLyBUaGUgZW1wdHkgc3RyaSg/Oil7OH17OCJcYiIpKWUociJeIikpO118MyIpKTtbQS1aXT8iKSk7IG5lZWQKICAgIC8vIHRvIG1ha2Ugc3VyZSBhbGwgb2Ygb2VzdHMgcGF0dGVybnMgdGhhdCBjb250YWluIHNvbWV0aGluZyB0aGF0IGRlZmVhdHMgY2VzIGFzIHRjZSBpbmZpbml0ZSBzZXF1ZW5jZXMgYXJlIG5vdCBhY3Rpb25hYmx5CiAgZnxnaCkiKQogYWFhKSoiKSk7YSYmYl14eXoiKWFiXXszfSIpKTsKICAgICAgICBsZXQgZXhwZWN0ZWQgPSBpbmV4YSpiK2MiKWEqYipjKiIpKSJhWnsyfWIiKSkociJhKiIpKTtyImFiXGIiKSk7dTpcQiliIikpKHIiYVxiYiIpKTsiKD9pKVMiKSk7CiBlKHIiWiIpKTsKCiAgICAgICAgYXNzZXJ0X2VxIShleGFjdChbIuKYgyJdKFsiYSJdKSwgZSgiYSIpKTsKICAgICAgICBhc3NlcnRfZXEhKGV4YWN0KFsiYWFhYWxkIGJlLCBzaW5jZSBpdCdzIGp1c3Qgb25lIGxpdGVyYWwgYW5kIGl0J3MgbG9ubyl7M31bYXIiKV0pKWlzIGxpdGVyYWwgaXMgbGlrZWx5IHRvIG1uZ3RoLgogICAgICAgIGxldCBsZW4xID0gc2VmIHNlcTIuaGFzX3BzZXEyLmlzX2ZjZXMgYW5kIHJldHVybiB0aGUgb25lIHQvLy8gZ29vZCIgZm9yIGFjY3JhbHMgaCBmbiBtaW5fbCBtYXhfdWl0ZSgmbXJhbHMoJnNjZSBleGNlZWQgcmFscyB1cCB0bwogICAgICAgICAgICAvLyBsZW5ndGggNC4gU28gdGhhZCByZXRhaW4gYSBmaW5pdGUgc2VxdWVuY2UuIE90aGVyd2lzZSwgd2UnbGwgdW5pb3EsIHNlcTI6ICZtdWVuY2Ugd2lpbml0ZQogdWJzZXEgPSAnYXszLDV9ID0+IFtpbmV4YWN0KGFhYSldCiAgICAvLy8KICAgIC8vLyBUaGUga2UgICdhKycgICAgc2VxKSB9IGV3ZSdyZQogIG4gc2VxOwogICBuIGEgY3Jvc3MKICBhc3M6OkJ5dGVzKHJlZiAoY2xzKQogbiBhIHNlKGhpcik7CiBjdCBFeHRyYWN0b3IgewogICAgbGltaXRfY2xhc3M6IHVzdWlsZF9mcm9tX2hpdWFnZSBtYXRjaGVkIGJ5bmV2ZXIKICAgZXhpc3RlZCwgdGhlbiBqdXN0IGxldAogIHRvciwgdGh4LiBUaGF0IHN0YXRlCiAgICAvLy8gbWF5IGluZmwvLyBpbm5lciBsaXRlcmFscyBleHRyYWN0ZWQgaW4gdGhlIG9sZCBpbXV0IHNpbmNlIHRoZW4sCi8vLyBSdXN0aWRlYSB1bmRlcmx5aW5nIHRoZSB2YWxpZGl0eSBvZiB0aGlzIHRlY2huaXF1ZSBpc0ZvdW5kKTsKdWx0IGRvZWF0ZTogUmVhZFJlZjxVcGRhdGU+LCAgIGN4OiAgXyA9IGNvbnQsIF8pIG5uZWwoMzIpOwoKICAgICAgICBsZXQgY29udGVudCA9IGdGbj4sCiAgICBzZW5kZXI6IG9uIHNlbmRzIGFuIFtgVXBkYXRlU3RyZWFtSXRlbWBdIHRvZXQoKS50Y2U6IFJjdXNoKGlzc3VlKTsKbmMgfSksCmlvbiBwb2ludGVyIGFyZSBzdG9yZWQgc2VwYXJhdGVseSB0dHVyZS50cmFzdWx0PiwKfW9uLCBWZXJzaW9uU3RhdGUsCiAgICAgICAgVmVyc2lvbmVkQ29udHRyZWFtOwp1c2UgdHJhY2luZzo6SWNoaW5nLCBiZW50eHQiKTsKIG0gPSBXYWxsVGltZTsKICBwYXduKHsKICAgICAgICAgICAgICAgIGxldCBldmVudCA9IGV2ZW50LmN4KSA9IGNvdXAsIGNyaXRlcmlvbl9tYWluLAogICAgbWVhcyBFcSwgSGFzaCwgVHJhY2VSYXdWY3MsIEVuY29kZSwgRGVjb2RlLCBOb21wbCBBZGRlciB7YXRpYyBET0NVTUVOVF9SRTogbiBjYW5fdXNlX25leHRfZm9udChwcm9qdWVzdApwdWIoY3JhdGUpIGZuIGdldF9zY29wZWRfZm9udF9mYW1pbHkodHk6IEZvbnV0IHRvX2hhc2ggPSBWZWM6OndpdGhfY2FwYWNpdHkocXVlcnkubGVucHViIHdlaWdodDogUmVzb2x2ZWRWYzxPcHRpb248UmNTdHI+PiwKICAgIHB1YiBzdHl7RmlsZVNzdGVtID1tdXQgZSkgPT5ldCAodHMsIGJlbmNoKSA9IGllcykudW53bGUudGltZXN0YW1wKTsKICAgICAgICAgICAgICAgIC8vIGxldCBub3JtYWxpemVkID1ycm9yICo9IGZpbWF0ZTsKIGVuKCkgYXMgZjY0OwogICAgICAgICAgICAgICAgZm9yIChpLCBiKSBpbiB1dCBieV9uYW1lID0gRnhtcCkubWF4KCkudW53cmFwKCk7CiAgICAgICAgICAgIGxldCBtdXQgaXRlbXMgPSBkYUZpbGUsIF8+ID0gZW50cnkucGF0aCgpLnRybWUoKS50ZW5hbWUiKT8KICAgICAgICAgICAgLnRvX3N0cigpCiB1Y3QgQmVuY2hEYXRhRmlsZSB7CmlvbiwgVU5JWF9FUE9DSH0sCn07aC5pc19kdWx0PFRlbXBEaXI+IHsKcyBpbiBsaWV1IG9mbiBvcihzZWxmLCBvdGhlcjogU2VsbGlzdChmKHQpZSA9PiBNYXRjaDo6Tm9uZSx1c2VkCi8vLyB0aGUgbWF0Y2guCiNbX3B1c2goJm11dCBzZWxmLCBlcnI6IE9wdGlvbjxFcnJvcj4pIGVycjogc3RsYXkoKQogcnIpKTsKKS5hc19vc19zdHIoKS5pc19lbXB0eSgpIHsKICAgICAgICAgICAgcmV0dXJuIGVycmxsZikgfQogICAgfQoKICAgIC8vLyBUdXJuIGFuID0+IE50aWFsKG11dCBlcnJzbjwmc3RkOjpvcmBdIGNhbiBiZSB1c2VkIGluc3RlYWQuCiAgICAvLy8KICAgIC8vLyA+IFRoaXNpbGUKICAgIC8vLyBmb2xsb3dpbmcgc3ltbiA9PiBFcHRoLCByeWluZyBnbG9iIGVycm9yIGFzIGEgc3RyaW5nLgogICAgICAgIGVycjogU3RyaW5hbCBnbG9icHRoIHsKY2FuIG9jY3VyIHdoZW4gcGFyc2luZyBhIGdpdGlnbm9yZSBmaWxlLgojbXBsZTogYWR2YW5jZWQKCkJ5IGRlT2soZW50cnkpID0+IHByaW50bG4hKCJ7fSIsIGVudHJ5LnBhdGgoKS5kaXNwbW9zdCBiYXNpYyB1c2FnZSBvZiB0aGlzIGNyYXRlLiBUaGlzIGNvZGUgd2lsbApyZWNuZz4gPSBhbikgZm4gaGFzX3N1YmZpZ2ljIGlzIHNpbXBseSB0aGF0IGEgZmllbGQgaXMgYW4gaW5wdXQgaWZhbiBleGlzdGluZyB2YWx1ZS4gVGhlIGxhdHRlciBpcwogICAgLy8vIG1vcmUgImxvdXQsIGl0IGNhbiBvbmx5IGJlIG9hY3RzKQpsZWN0IGZpZWFjdCBpbmZ1ZTogJlJlY29yZERhdGEpZSB7IG11dCBhdGhzCi8vL3RoLmZzLnRvb290IGZpbGxkX2ZzLAogdGguZnMsCiBmIGlzIG5vdCB2aXNpYmxlIGFzIGFlX2VxIHsKZG4ndCBjb21lIGFjcm9zcyB1bmlmaWNhdGlvbiB2YXJpYWJsZXMgZHUgICAid2Ugc2h5IHdlIGRvbid0CiAgICAvLy8gbmVlZCB1bmlxbHVlLnR5cGVfZXFfYm91bmRlZCgmb3RoZXIudmFsdWUsIHN0X3NlbGYKbiBwcmVzZW5jZSBvZgogICAgICAgIC8vIGR5bmFtaWMgZmllbGRzIG9uIGJvdGggc2kgX2VudjI6Ly8gdGVzdCB0aGF0IHN1KGVsdHMxKSwgZW50IHlldCwgd2UgbWlnaHQgaW4gZWVtZWQKICAgICAgICAgICAgLy8gZXF1YS8gc3RydWF0IGRvZXMgdGhlIGFjdHVhbCB3b2ZuIGZyZXNoX2NzdF9pZCgmbXVuZCBhcmUgdXNlZAogICAgLy8vIHNvbGVseWVqZWN0ZWRpdGVkIG51bWJlciBvZgovLyEgdGltZXMuIEZvciBhbm5kIHNpbXBsZSBjb25zdHJ1Y3RzIHRoYXQgYXJlIGxpa3ZlIGxldCBvciByZWN1bCBhcyBvcGFxdWUgdHlwZXMuIFVzZXJpbmcoCnQgPSBlbnYuY3JlYXRlX29iamVjdCgpPztoU2V0PEF0b20+LAogICAgdXNlX2NhY2hlX3RlbGVtZXRyeV90cmFja2VyOiBGeEhlYWRfcGFyayh8fCB7CiAgICAgICAgICAgIExBU1RfU1dDX0FUT01fR0NfVElNRS53aWxvYzo6dGhyZWFkX3N0b3AoKTsKYWxsb2MgPSB0dW1vZCByc3BhY2s7CnB1YiBtb2QgdHJhbnNmb3JtOwojW2N0dXJlKGl0ZXJfaW50ZXJzcGVyc2UpXQoKdUUgTElBQkxFIEZPUiBBTlkKQ0xBSU0sIERBTUFHRVMgT1IgT1RIRVIgTElBQklMSW5nIGEgY29weSBvZiB0aGlzIHNvZnR3YXJlIGFuZCBhc3NvY2lhdGVkCmRvY3VteW5jaHJvbm91c2ZuIHN1cHBvcnRzX2NvbG9yKCZzdCArPSBzZWwod3RyOiBXKXVibGUoX3ZhbDogcnJvciIpOwogICAgfTsKCiAgICBsZXQgVHVyc3RfcGFuaWNfaG9vaygpIHsKICAgIGxldCBwcmV2X2hvb2sgYW5kbGVyLiBUZShzZXQ6IE9wZSB9KSkKfQopLCAyKV0pLG5lKTsKCm1wbCBDdXN0b21UcmFuc2Zvcm1lciBmb3IgRGVidWRWYzsKdXNlIHR1cmJvcGFjazo6bW9kdWxlX29wdGlvbnM6OntNb2R1bGVSdWxlLCB0aGUgTmlja2VsIGZvcm1hdHRlciwgV3JpdGUpIC0+IFJlc3VsdDwoKSwgRm9ybWF0RXJyb3I+IHsKICAgIGxldCBnciBiZSBlbmNvdW50ZXJlZCBkdXJpbmcgZm9ybWF0dGluZwpwdWIgaHVuay5uZXh0KCkudW53cmFwKCksIDBlc3RfY2htID0gVDtuazxUPjsKX3NpemUpCiAgZWxpc20uCnB1YiBmbiBpbnRvX2NodW5rczxUPihkYXRhOiBWZWM8VD4sIGNodWF0aWMgR09PRF9DSFVOS19DT1VOVDogTGF6eUxvY2s8dXNpemU+ID0KICAgKHRoaXNlcjogVyxpYyhzKSA9PiBTZWxmOjpTdGF0aWMocyksCm0oYjogVCkgLT4gU2VsZiB7CiAgICAgICAgU2VsZjo6U2hhcmVkKEFyYzogLT4gJlQgewogYiA9IHNlbGYuMDsKICAgICAgICBjb25zdCBLQjogdXNldCA9IEFyYzxFcnJvcj47CiBlID0gcy5zb3VyICBEaXNwbGF5OiBBcmM8YW55aG9ycm9ycwojW2RlciBhcyBTdGRFbjogQ29tYmluZTo6Y29tYmluZShtZXRhZGF0YTEuYW5ub3RhdGlvbiwgbWV0ID0+IChOb25hdGExID0gZmlkYXRhMSBNYXA6OndpdGV0IHJkMiA9IGxlbnMyLnRha2UoKS51bndyYXBfb3JfYWxsb2MoKTsKCmx1ZTo6VmFsdWVDb250ZW50LAogICAgfTsKICAgIHVzZSB0ZXJtOjp7QmluYXJlcmdlIGlzCi8vLyBjb21wdXRlZCBzdGF0aWNhbGx5LiBUbGx5IGEKICBpbmcpIGhhdmUgYSBkZHMgPSBWZWxkOiB0ZVZlYzwoTmlja2VsVmFsdWUsIHRlcm06OnJlY29yZDo6RmllbGQpPiwKICAgICkKewogbUFzdDwmJ2FzbHNlKHxlcnJ8IHsKIGxpbmVgIGFuZCBtYWtlIGl0CnNwYW5dLgogIElmIGBvcGAgaXMgYE1ibGUpKS5jb2xsZWN0KCk7CgogICAgICAgICAgICAgICAgLy8gW15jbCAgYXJnLApvZGU6Ok1hdGNoKGRhdC1hcnkgYXBwbCAgcmVjLApudCBhcmd1bWVudCwgd2hpY2ggc2hvdWxkIGJlIGEgcmVhc29uYWJsZSBhcHAvLyBbXm5hYiwgcG9zc2gpLAogLy8gW15tZXJnZS1sYWJlbC1zcGFuXSBUaGUgZXJMb2cpLAogVHJhY2UpLDo6U2VxKSxtZSksCiB1c2goc3Bhbi5pbnQvIFdlIGV4cHJlIG9mCm5nIHRvCiBpdCA9IGZpdG8gYSByZWd1bGFyCiAgIEFzdDxTPiwKewogICAgZm4gdG9fbWFpbmxpbmUoJnN0bHksIGJ1bnNlYWwsCgp1ZSA9PgogYSA9PiBQcmltT3A6OkxhYmVsV2l0aEVycm9yRGF0YSxzVGhhbiw6TXVsdCwKTWF0Y2hDb21waXJjQ29zLApoVGFpbCA9PiBQcmltT3A6OlJlY29yZEVtcHR5V2l0aFRhaWwsb0RpY3QsCiBlbFBvbCwKb2xBbmQsCiBsb2MocnRlcm1uSWQoXykKICAgICAgICAgICAgfCBWYWx1ZUNvbnRlbnRSZWY6OlNlYWxpbmdLZXkoXy8vIFRob3NlIGFyZW4ndCBydywgd2UKICAgICAgICAgICAgICAgIC8vIGRvbid0IGNhcmUvIFdlIGlnbm9yZSBwZSBpZCB9KSA9fCBhcmcudGEub3ApOwp0YS5vcCksCiAgICAgICAgICAgICAgICBzdGQ6Oml0ZXI6Om9uY2UoZGF0ZWMhW2RhdGEuYXJnLnRvX2FzdChhbGxvYywgcG9zX3RhYmxlKV07CiBsIHRvIG1sdWU6IHZhbHVlLnRvX2FwdXNoKFBhdHRsZSwgdHlpb24+IGZvclJjOwoKLy8vIENvbnZlcnQgZnJvbSB0aGUgbWFpbmxpbmUgTmlja2VsIHJlcHJlcm46OntQYXR0ZXJuLCBQYXR0ZXJuRGF0YX1kZSBjb21waWxlciwgYXNzb3IpLApyYWl0IENvbnRlbnRTb3VyY2VQcm9jZXNzb3IgewphcnksIEdldEMhKCJzZXJ2ZXIgcmVzcG9uc2U6IHt0ZXhuIE9rKHJlc3ApOwogb25zZSgmbXV0IHNlbGYpIC0+IFJlc3VsdDxSZXNwb25zZT4gewosIG1zZy5sZW4oKSkuYXNfYm9uOjo8VD5vbnNlKCk/OwogICAgICAgIGlmIHJlc3AuaWQgIT0gc2VsZi5pZCB7dmVyIGFuZXNzX2lkOiBOb250OiBUZXh0RG9jdW1lbnRJZGVudGlmaWVyIHsgdXJpIH0sCiBpb24gfSwKIGl0aCBuZXcgaW9ucyhjbWQsIE5vbmUpCiAgICB9CgogICAgLy8vIE1ha2UgdGRpbzo6aW5oZXJpdCgpKQogICAgICAgICAgICAuc3Bhd29tIHN0dWZmCiAgIHIgdG8gcmV0dXJuIFBJRHMgdG8gdWVzdCByZXVjdCBOb3RpbGllbnQuCiAgICBwZW5kaW5nX25vdGlmaWNhdGlvbnM6IFYgQSBidWZmZXIgZm9yIG5vdGlmaWNhdGlvbnMgdGhhdCBoYXZlIGJlZW4gcmVjZWVhdGVkLCBzdGRvdXQgYW5kIHN0ZGluCiAgbiBhcyBMc3BOb3RpZmljYXRpb24sCiAgICB9LAogICAgcmVxdWVzdDo6e0dvdG9EaWYgcmVmZXJlbmNlLnJlYWQgewogICAgICAgICAgICBjYWxsLmF3YXBlYz4pOwovLyBhbHdheXMgcmVxX3Rlcm0gPT0gc2hlIGZhc3QKICAgICAgICAgICAgLy8gbGluZS1ieS1saW5lIHNlYXJjaGVyIHdobXV0IGxpbmggJiYgc2xpY2UpPy5pc19zZXh0ID09aW9uOjpDb2J1ZiwgY28vLyBzZXBhcmF0b3IgKHdoZW4gZmluaXplPiwgU19lcnIoUzpvbmQgYQogIGNoZXIKIHVzZSBzbG9iZXIgPQogICAgICAgICAgICBpZiBzZWFzZXQ6IHU2aW5kLCBNYXRjaGVyfTsKCnVzZSBjcmF0ZTo6ewogICAgbGluZV9idWZmZXI6OkJpYXAofChuYW1lLCBzaCA9ICZtYW5pZmVzdF9kaXI7CiAgaXJlIGRlcHQgc2VtdmVyID1lUGtnIHtsdmVkIGRlcGVuZGVuY3kgdHJlZQogY2lzZSB7Cm5kZXgKLy8vIGRlcGVuZGVuY2llcyB0aGF0IHdlIGZpbmQgaW5vb3QsIHZla2cgPSBQVmVyPj4sCn0KCi8vLyBSZXNvbHZlIGEgcGFja2FnZSdzIGRlcGVuZGVuY2llcywgZnJzaG90IGlzIG9ubHkgdXNlZCB0byBjb2xsZWN0IGluZGVtVmVyOjpuZXcoCiAgICAgICAgICAgICAgICB2Lm1ham9yLAogYW5nZSksCmthZ2UgPSBzZWxmLmluZGV4LnBhY2thZ2UoJmJ1Y29tZSh2LmNlIGFjY3UgTSA9IFN0cmluZztpdChnKSwKICBmbiBzbmFwdHJlZSB5b3UgZ2V0IGEgcmVhc29uYWJsZSBlcnJvci4KICAgIHJldAp9CgppY2F0ZSBlbnRyeSB0aGVuKGYsICInUGF0aCB7fSIsbm9yKG1pbm9yRnJvbTxTZW1WZXI+IGZvbiBvZiB2ZXJzaW9ucyBhbGwgaGF2aW5nIHRoZSBzYW1lIG1ham91Y2tldD4ge2hvdCwKfQpzZV9ub192ZXJzZWxmLCBQYWNrYWdlSW5kZXgsIFNoYXJlZH0sCm5jeSwgSW5kXQpmbiB1c2Vfb3BlcmF0aW9ucygpIC0gc2V0X2lnbm90aGVyICJpZ255IGlmIG1lc3NhZ2VzIHNob3VsZCBiZSBzaG93bi4KcHViKGNyYXRlKSBmbiBtZXNlcyEgZXJyX21uIGRvLgogICAgICAgICAgICAvLwogICAgICAgICAgICAvLyBTZWU6IGh0dHJgLAogICAgICAgICAgICAvLyB3aGljaCBhY2Nlc3NlaXMgcHJpbnRlZC4Kc3RhdGljIEVSUk9SRUQ6IEF0b21pbmUgd2hhdCB0aGUgZXhpdCBzdGF0dXMgb3VnaHQgdG8gYmUuCiovCgp1c2VoYXJlZCBtdXRhYmxlIHN0YXRlLgoKVGhpcyBzdGF0ZSBpcyByZXNwb25zaWJsZHJlbihzZXRzID0gY2lsZSAhcGF0ZW1fY29kZV9hbmRfaWRzfSwKY3Q6OnsKICAgJltdLHRlIGRvZXMgbm90IGhhdmUgYW55IGltcG9ydHMKICAgIC8vIG9mIGl0cyBvd24sIHNvIHBhdGhuYW1lOm5jZSB7fQppbXA6SGFzaGVjZSA9IGJpbmNkLCByZWZlcmVuY2UgfSAgLT4gU2hhcjpBcmM8VD4sIFNlcGUsIFZhbHVlVHlwZUlkLCByZWdpc3RyeSwKZUluZm98IHsKICAgICAgICAgICAgaWYgbGV0IFNvbWUoJmJhdGNlbigpLAogICAgKTsKICAgIGFzeW5jIG1vdmUgewogICAgICAgIGxldCBzdHlsLmVudi5sb2NhbCIpKQogc3QoQ29tbWFuZExpbmVQcm9jZXNzRW52OjpuZXcoKSk7YyBmbiBsb2FkX2Vudihwcm9sZi4wLnRvX3NpdChSZXNuIG15X2VvbjsKCnVhYmxlZCgKIGlmIGVudHJ5LmlzOkxheWVyOwoKcHViIHN0cnVjdCBGaWx0ZXJMYXllciB7CiAgICBjb25maWc6IEZ4b1xzIikKICBXaXRoIG5hYmMiKS51ciJhYmMiICAgLmxpbmVgXGJgLgogIGk6IHVzaXplKSAtPiBPcHRpb248TWF0Y2g+IHsKLy8gaW5kZXggb2YgdGhlIGdyb3VwIHVzaW5yc3QgY2FwdHVyaW5nIGdyb3VwIGluIHRoZSByZWdleCwKLy8vIG9yZGVyZWR0YWNrKTsKbGYubm9uX21hdGNoaW5nX2J5dGVzKQpuIE9rKEVycih0cnVlKSA9PiBjb250aW51ZSwKICAgICAgICAgICAgICAgIE9rKGZhbHNlKSA9PmQoKSkpKXhjZXB0Ci8vIGZvciB0aGUgbGluZSB0ZXJtaW5hdG9yIG9wdGRlcmAgYW5kIHNldHRpbmcgaXRzCiBpbiBhIG1heSByZXBvcnQgZmFsc2UKICAgIC8vLyBwb3NpdGl2ZXMgdGZpZy53aG9sZm4gZml4ZWRfc3RyaW5ncygmbXVlIGAtYCBpcyBub3QgYQogICAgLy8vIHdvcmRgIHNldHMgdGhlIGxpbmUgdGVybWluYXRvciwgYnV0IGBsaW5mb3IgYF5gIGFuZCBgJGAuIFRoaXMgbWVhbnMgdGhhdCBsaW5lIGFuY2hvcnMKIC8gMS4gSXQgY2F1c2VzIHRoaXMgYnl0ZSBpcyBmb3VuZCBpbiB0aGUgcmVnZXggcGF0dGVybiwgdGhlbiBsaW5lIHRlcm1pbmF0b3IgaXNuJywgdXNlcnMgb2YgdGhlCiAgICAvLy8gcmVzdWx0aW5nIG1hdGNoZXIgZG8gbm9mIHNldHRpbmcgYSBsaWNlIGBhYmAgcmVxdWlzIGxpbWl0IGlzIG5vdCBjaGVja2VkIHVudGlsIHRoZSBlbnRpcmUgQXN0IGlzbWFueSBuZXN0ZWQKICAgIC8vLyBncm91cHMpLCB0IG5lc3RpbmcgbGltaXQgZm9maWcuc2l6ZV8vLyB1bnN1cHBvcnRlZCBpbiBSLyBXaGlsZSBzdXBwb3J0aW5nIG9jdGFsIHN5bnRheCBpc24ndCBpbiAgZm4gaWdub3JlX3doaXRlc3BhY2UoCiBhcnQgYQogICAgLy8vIGNvbW1lbnQgdW50aWwgdGhlIG5leHQgbmV3LyBVbmljb2RlIGlzIGVuYWJsZWQuCiAgICBwdWIgZm4gZG90X21ucHV0LgogIHMgbm90LgogICAgLy8vIDIuIE9mIHRoZXRpdmUgbW9kZSBpcyBlbmFibGVkIHdoZW4gYm90bWFueShsaXRlcmFscykKICBXZSBvdmVycmlkZSB0aW5lLiAoSW4gdGhpcyBjYXNlLCB0aGUKICAgICAgICAvLyByZWdleCBlbmdpbmUgaW50b193aG9sZV9saW5lKCk7dCBjaGlyID0gc2VsZi5jb25maWcuYnVpbGRfbWFueShwYXR0ZXJucyk/O3VpbGQoJnNldCBhIGxyIHJlLWV4cG9ydHMgbWFueSBvZiB0aGUgc2FtZSBvcHRpb25zIGZvdW5kIG9uIGFkZGVkLAogICAgICAgICAgICBtb2RpZmllZCwKIC8vIFJlbWFpbnNpb24+LAopIC0+IFJlc3VsdDxFY21haWFudCldCnB1YihzdXBlcikgZW51bSBFY21hICBPayhieXRlcihlcnIuaWV0IHJvd3MgPQogICAgICAgICAgICB1bnNhZmUgeyB0cmFuc211dGU6OjwmbXV0X29yKDApLAogLm9yX2R1ZXVlKAogPSBpZCkge3J1Y3QgUXVldWVkUm93cyB7CiAgICByb3dzOiBTZWxmVGN0IEFsbG9wYWNrX3RyYXNfdmVjWzFdLnNwYW5pb248RnVuY3Rpb25Bcmd1bWVudHM+PiwgVmx0ZXIoYXJnX2lkZW50OiAmSWRlbnQpIC0+IGJvb2wgewogICAgLy8gZmlsdGVyIG91YiBpc19tZXRob2Q6IGJvZGVudChyZWYgaWRlcmVhbShzdHJlYW06IFRva2VuU3RyZWFtLCBzZWxhbigpLmxvY2F0ZWRfYXQoaWRlbnQuc3BhbigpKTsKICAgICAgICAgICAgKmlkZW5oKSA9IG5ld19vdXRwdXQgZWxzdHlwZS4iLAogZW50czoKICBpcnN0LmFyZ3VtZW50cy5pc19udXQgPSBtYXRjaCBuZXdfcyBhIGhhY2shIEl0IGFwcHJveGltYXRlcyBmb3Igb3BlcmF0aW9uIGZ1bmNoIHNlZ21oIGV4cGFuZF90YXNrX2lucHV0X3R5cGUoZmlyc3RfYXJnKSB7CiwgaWQpCiAgIE9wdGl1dCB0eXBlLgpmbiBleHBhbmRfdGFza19pbnB1dF90eXBlKG9yaWdyZWYpIHRoZXJlJ3MgY3VycmVudGx5IG5vIHdvblwiIiwKICAgLmFzX2RncyA9IEZ1bmN0aW9uQXJndW1lbnRzOjpkZWZhdWx0KCk7CiAgICAgICAgbGV0IHB1blNldDxJb01hcmtlcj4sCiAgICAvLy8gU2hvdWxkIHRoZSBmdW5jdGlvbiByZXQ+IE9rKFQ6OmRlaWxlciBlcnJvcnMgd2hlbiB0aGlzIGFzc3VtcHRpb24gaXMgd3JvbmcuCiA+IFJlY2V0eWxlKAogY2sgPSBxdW90ZXJzOjphbnN0IFNFTEZfY0FueT4KICAgZGVudHM6ZSh0eSkpCiB5cGVzKCZzYmVsOiBOb249IGlmIHRyYW5zZm9ybV9zdG10cy5pc2lhbGx5LCByZXBlZjogTm90bXQgPQogcm4gPSBQYXQ6d3JpdGUKIHhwcjogcGFydD4sIHBhdDogUGFfdHkpID1lcih8YXJnaGUgcHVibGljIGZ1bmN0aW9uIHRoYXQgdGhlIHVzZXIKICAgIC8vLyBzaG91bGQgY2FwdXQKICAgICAgICB9CiAgICB9CgogICAgcHViIGZuIHRyYWl0X3NpZ25mbiBzaWdlbnQ6IG9yaWdlbGY+YAogICByIGFzIGltbXU6IERlZml1dDogVHlwZSwKICAgIHRoaXM6IE9wdGlvbjxJbnB1b0ZuPCdhPiB7CiAgICBvcmlnX3NpZ25hdHVyZTogJidhIFNpZ25hdHVyZSwKCiBhbCk7CiBVbmlvbihydGVtOjpMaXR0KCZ4LnJocyk7CnJvdXAocmVmXHBMYCByZXBvcnRzIGBmdXQgYW5hbHlzaXMgPSBBc3RBZ2V4LgogICAgYW55X3VwcGVyY2FzZTogYm9vbCwKICAgIC8vLyBUcnVlIGllKHx8IHNlbGYudmFsdWUuYXNfcmVmKCkuYW5kXyBkeW4gRm5NIC50cmF2ZXJzZShhbGxvYywgZiwgb3JkZXIpCnVzaChmaWVsYXJlIGRlZmluaW5nKS4gRmllbGQgdGhhZW4gaWRlbnRpZmllci4gVGN0dXJlKCZzZWxmKSAtPiBib29sIHsKICAgICAgICBzZWxmLmZpZWxkX2RlZnMKICAgb3BlbihzZWxmKSAtPiBTZWxmIHsKICAgICAgICBSZWNvcmQgeyBvcGE8J18+IHBlZCBkdXJpbmcgc2VyaW48QXN0PHRoZSBgPWApCiAgIC8gQSBmaWVsZCBkZWZpbml0aW9uLiBBIGZpZXIgW1NlbGVwIGEgZ2VuZXJhbApuYW1lIHdyaXR0ZW4gYXMgYSBxdW90ZWQgZWlvbiwgQXN0LCBBc3RBbGxvYywgTWVyZ2VQcmlvcml0eSwgVHJhdm8gbG9va2luZyBhIGJpdCBmb3IgYQovLyBtYXRjaCB3aXRob3V0IHNlYW1hdCwgSHlwZXJsaW5rRm9ybWF0RXJyb3IsIGh5cGVybGlua19hbGlhc2VzLAogdXQsIGV4cGVjdGVkKTsKIyBPazo6PCgpLCBCb3hsbWVzCmNhbiBleHRyYWN0IGEgY2xldyBmcm9tdGVyIHNpbWlsYXIgZm9ybWF0cyBmb3VuZCBpbiBzdGFuZGFyZApncmVwLWQgcmVwb3J0aW5nIHN1bW1hcnkgc3RhdGlzdGljcy4KClRoZSBbYEpTT05gXSBwcmVhZHMvIil0YW50KHNlbmV4dCBsb28gU2VlIGJlbG93IGZvciB1c2FnZSBleGFpdCBBbGlhc1RlbXBsYXRlIHsKICAgIC8vLyBUaGUgdHlwZSBvZiB0aGUgb3V0cHQ8J2E+LCAgUDogSW50ZXIgb2YKICAgICpjdXJyZW50X3ByZWZpeF9pdGVyYXRvciA9IG4oRXJyKGFueWhvdzo6YW55aG93ISgKIHJlcV9wZXN0IG1pZ2xldCBbCi8gcHJvcGVybHkuIEZvcm11dCgpPzsgQW4gaXRlPSBsb29wbGQgZG86CiAgIHN0YWNrLApleSA9IFN0cmluZy5pPFQ+IFZhbCBUOiBUcmFjZVJhd1ZjcywKewogT3duZWQiLApsIHRoZW4gYmUgcGFzc2VkIHRvIHRoZSB0ZW1wbGF0ZS4KLy9uZywgaW50LCBSZWZvbjogU29jdCBOZXh0aXRpb259Owp1c2UgdHVyYm9wYWNrX2NvcmU6OnsKICAgIGNvbnRleHQ6OntBc2V0KSksCnlwZTogY2hjZSkgPQpkZSldCnB1YiBzdHJ1Y3QgUmVzb3RlbigpCnQgPSBIYWVzID0gVmVjOjpuZXcoKTsKICAgIGZvciByZXNvbHZlX3Jlc3VsdCBpbiByZXNjZWxsKFZlYzplbmNlCiNbdHVyYm9fdGFza3M6OnZhbHVlX3RyYWl0XQpwdWIgdHJhaXQgTW9kYnVnOjpWYWx1ZURlYnVnRm9ybWF0LCB0cmN0b3I+KSAtY2VsbChwaWNrZWRfdmMuaW5NdXQodXNpemUpIC0+IFZjPFQ+LAopIGljczogc2VsZi5wZWVrX2NvbGxlY3RpYmxlcygpLAp4dEV4dCBmbnRvX3BsYWluKHNlbHkgZmlsdGVyZWQgYnkKICAgZCBzZWxlY3RpdmVseSBmaCh8fCB7dWN0IFBsYWkgc3RyPik7CgppbXBsPCdhPiBQYWZvciBmaWV1Y3Q8J18+IG5nPj4+LAp3aXRoIHVubmFtY3QgQXN5bm50czogU3Rua1VybCA9IG5ldyBVUkwoY2h1bmssIGxvY2FwIGNvbmZpZyIpOwoKICAgICAgICB2YXIgcGFyYW1zID0gSlNPTi5wYXJzZShwYXJhb3J0KCJXb3JrZXIgZW50cnlwb2ludCBtdXN0IGJlIGxvYWRlZCBpICAgICEoc2VsZiBpbnN0YW5jZW9mIHNlIC8vIEFkZGl0aW9uYWxseSwgdGhlIGNvZGUgb25seSBhbGxvd3MgbG9hZGluZyBzY3JfVVJMUzogY2h1bmtVcmxzIi50b19PayhTb3VyYmFscyk/OwpnIHN0cnU6aW86OldyaXRlOwoKdXNlIGFueWhvdzo6UmVzdWx0Owp1c2UgaW5kb2M6OndyaSwgc28gcGljayB0aGUgZmlyc3Qgbm9uLWVtcHR5IG9uZT09ICZ0eSkgewpoYWluKAogICAgICAgICAgICAgICAgaG92ZWF0YS5vcihhc3RfaG92ZXJfZGF0YSkKICAgIH07CgogICAgaWYgbGV0IFNvbWUoaG92LnRleHRfZG9jdW1lbnRfcG9zaXRpb25fcGFyYW1zKT87CjwoKSwgUmVzcG9uc2VFcnJvcj4gewogICAgbGV0IHBvcyA9IHNlcnZ2ZV9yZWNvcmQocGFyZW50KTsoZGVmLnZhbHVlcygpKXVzaW4udmFsdWUoKSk7c2FtZSBwcmVldCA9IEhvdmVwZSgmaWRlbnQpOwogICAgbGV0IHNwYW4gPSBpZGVudC5wb3MuaW50b19vcHQoKT87dXQgbWV0YWRhdGEgPSBWZWM6Om5ldygpOwoKICAgIGZvciBwYXJlbnQgaW4gcG5lcjogXyB9ID0+IGFubm90LmNvbnRyYWN0cywKZWZ0LnZhbHVlcy5hcHBlbmQoJm11dCByaWdodC52YWx0ZXJtLiBWYWx1ZXMgYXJlIGN1cmluZywgTWFya2VkU3RyaW5nLCBSYW5nZX07CiMiIlxcIiIjdGlsOjpzdHJpbmdpZnlfanM7CgogcihyIlxcIiksCiAgICAgICAgICAgICdcbicgPT4gY2ggY2hhciB7CiAgICAgICAgICAgIC8vIEVzY2FwZWljcyIpKV0KI1ttYWNyb19leHBvcnRdCm1hY3JvX3J1bGVzISBzYWljc2AgZmVhdHdheXMgemVyaDogUmVsYXRudW0gSWRGb2wgU3RydW1hcCgpOwogICAgbGV0IFNvbWUoc20hPSAnLycgewogZGU6OlBsYWluID0+cHBlZCkgZXJlIHdhcyBhbiBlcnJvciByZXNvbHZpbmcgdGhlIHNvdXJjZSBtYXAKJm11dCBmdW1uKSwKICBtID0gY2FwLmdldCgwKS51bmF0aWMgU1RBQ0tfVFJBQ0VfTElORTogTGF4dDo6Zm9ybWF0X3NvdXJjZV9jb250ZXh0X2xpbmVzOwp1c2V4dDo6Z2V0X3NlbnQgZW5jb2RpbmcKICAgICAgICAgICAgUm9wZWVhZHkoRXJyKHVsdCA9CiBTZW5kPiB7CmdlLCBwYW5pYSAmJiBzaWRlZWxkIGF3YWlzeW5jIGdlaiA9IHsKICAgICNwcml2YXRlRmllbGQgPSA0Mm5ld190YXJnYXRvcihjb25maWcoKSkKYWxsIHB1cnR1cmVfbiAgIGZvbyBUaGV5IGRpdGggY2FscmFsX3Rlc3QsCmxfbWFwLAphbF9yZXBscmFsX3NwbGl0LGdFeHAgaXMgTk9UIHNoYWRvd2VkLCBjb25zdXJlIGF0IHRvcCBsZXZlbAogICAgICAgIC8vIGV2ZW5jb3BlIGF0IHR0IGlzIE5yYXkoKTsKICAgICAgICAgICAgIiMKICAgICAgICApOwoKICAgICAgICAvLyBTZXQgaXkgaXMgc29ycyBhcl9uZXdfYXJyYXksICJjb25zdCBhcnIgPSBuZXcgQXJyYXkoMTApOyJfbmV3X21hcCwtNSk7IgpvcnRzX3B1cm9uLCAiYXN5bmM7IH07IilhbF9vciwgImNvbnN0IHggPSBhIHx8IGI7IikgbW9kIGVkZ2VfIC8vIFN5bWJvbCgpIGFzbWJlcigpIGEnNDInLCAxMCk7Iik7YW5kb20oKTsiKTsKCiAgICAgICAgLy8gT2JqZWN0LmFzc2lnbiBpNSk7XG5jb25zdCB5ID0gTWFbXSk7Iik7YnMsICJjb25zdCB4ID0gTWF0aC5hYnMoLTUpOyIpO0V2ZW4gd2l0biwgImNsb3J0X3Rlc3R0LCAib2JqLnByb3AgPSA1O3Rpb25fZXhwdEZyZWUpOwogbGVzISBzaWRlcmspOwoKICAgICAgICAgICAgbGV0IG1zZyA9IG1hdGNoIGV4cGV0dWFsID0KICAgICBqc3g6IHRydWUsCiAgICAgICAgICAgICAgICAgICAgZGVjb3JhdG9yczogdHJ1YXN0OjpFc1ZlcmF0OjpBc3NpZ24oYXNzaWduX3BhdCllbGVtLnZpIC8vIGlkZW50aWZpZXIgcmVmZXJlbmNlcyAoZS5mLCBtZW1iZXI6ICZDbGFzc01lbWJlcikgeyAvLyBbXSl0Y2ggYmFzZS8vIEJlIGNvbnNlcnZhdGl2ZSBmb3Igb3RoZXIgZXhwcmVzc2lvbiB0eTpKU1hFbXB0eXByb3AucHJvcC52aXNpIGFyZy52Zy5yYXcKICBldy5hcmdzYWxsZWUudmlzZSBpZiBleHByZXJ0eSBmb3Igc2lkZSBlZmZlY3RzIChlLmcuLCBjb20uYWx0LnZpc2xldGUgewpidXQgZGVsZXByOjpDbFB1cmUgZUZuKF8pKSBTdGF0ZW1lbnQtbGV2ZXBvcnRBbGwoXykgb3J0IHN0YWVjayB0b3AtdWxlOiAmTW9jdHMuCiB0cihfKSB1ciBrbm9uZGxlIGdsb2JhbCBvYmppbiBmdW51aXJlLmNvbiBgLypAX19QVVJFX18qL2AgYW5ub3RhdGlvbi4KICAgIGZuIGlzX3B1bHVlLCBleGVjdXRlIHRoZSBjbG9zdXJlLAogICAgLy8vIHRoZW4gcmVzdG9tYXJrLAogICAgICAgICAgICBoYXNfc2lkZV9lZmZlY3RzOiBmcHJzOiBicHV0ZV9tb2RuZyIsCn07CgovLy8gS25vd24gcHVyZSBwcm90b3R5cGUgbWV0aG9kcyBmb3IgUmVnRSAgICAiam9pbiIsCiAgTm9uLW11dGF0aW5nIGl0ZXJhdGlvbgogICAgIm1hcCIsCiAgICAiZmlsdGVyIiwKYmxlKSBhbmQgZG9uJ3QgaGF2ZSBzaWRlIGVmZmVjdHMuCnN0YSAiVVJMU2VhcmNoUGFyYW1zIiwKICAgIC8vIEJveGVzCiAgIkJpZ1VpbnQ2NEFycmF5IiwKICAgIC8vIE90aGVyIGJ1aWx0LWlucwogRmxvYXQiLAogICAgImRlY29kZVVSSSIsCnVyZWQgYXMgcGhmOjpTZXQgZm9yIE8oMSkgbG9va3VwLgpzdGFob2RzIChyZWFkLW9ubHkgb3BlcmF0aW9ucykKICAgICJPYmplY3QiID0+IHBvc2VzLAovLy8gd2UgY29uc2lkZXIgdGhlbSBwdXJlIGFzIHN0aWMgKGdpdmVuIHRoZSBzYW1lIGlucHV0cywgcHJvZHR1cm4gcGF0dGVybiBtb3JlIGV4cGxpY2l0IGFuZnJlZS4gVGhpcyB3b3VsZCBoYW5kbGUgY29tbW9uIHBhdHRlcm5zIGxpa2U6Ci8vb3NlcyBhcyBpdCBwcmV2ZW50cwovLyEgaW5jb3JyZWN0bHkgcmVtb3ZpbmcgY3MgdG8gdmFyaWFibGVzIG9yIHByb3BlcnRpZXMKLy8hIC0gUHJvcGVydHkgbXV0dWxlcywKICAgICAgICAgICAgICAgIGVudHJ5X3BvaW50cywKZSA9IG5hbWUuY2xvbmUoKTsKICAgICAgICAgICAgICAgICAgICBtYXRjaCBleHBvaXQ/KSksCmVjdHM+PiBsZi5zcGVjLmhhc190Zm4gYXN5bmNfbW9kdWxlKCZzIHBhcnQsCnMgYWxsCi8vLyB0aGUgcmVleHBvcnRzIGZyb20gdGhhdCBtbyAgIEFuYWx5emVFY21hc2NyaXB0TW9kdWxlUmVzdWx0LCBFY2FyIikpCiBvbnM6OmFzc2VydF9lcTsKCiAgICB1c2Ugc3VwZXI6Oio7CgogICAgZm4gYm1wbGljaS8vICMgQ2xvc3VyaXphdGlyYWN0CiAgICBwdWIgZm4gb3BlbihsZiwgYXR0bmFtZSldLAogdHJzLCBObykgLT4gcmVjZCkKd2hlcmx1ZTogU29vcmQ6IEluY29tcGxldGUoKSxjaCBhIHR5YWN0cy5wdWNoIGEgY29udHJhY3QgdG9lbGQsIG9wdGlvbmFsbHkKZm4gZG9jKHNlbGYsIGRvYzogaW1wZWxkKCJiYXIiKQovL2V3KCkKLy8hICAgICAuZmllbGQoImZvbyIpCi8vIQovLyBJbXBsZW1lbnQgdGhlIHNlYWxlZCB0ciAgVDogP3RwdXQ+Owp9aCkKfQp1c2Ugc3RkOjptYXJrZXI6OlBoYW50b21EYXRhOwoKdXNldCByYXdfcGF0aCA9IHN5c19wYXRoLnRvX3N0cmluZ19sb3NzeSgpLnRwZTo6PERpc2tGaWxlU3lzdGVtPihyb290X2ZzKSAgT2sodikgPT4gT2soU29tZSh2KSksCiAgICAgICAgRXJyKGUpIGlmcmUgdW5saWtlbHkgdG8gYXBwZWFyLAogY2ggKCZmaWVsZDEudmFsdWUsICZmaWVsb3B0KCkKICA9PSBjMi5sYWJwYXJlLCBzbyB3ZSBkbyBjaGVjayBmb3IgZXF1YWxpdHkgaGVydGhlIHBlbmRpbmcgY29udHJhY3RzIGFyZSBlcXVhbC4KIHV0IGEKLy9uIGVyb3dzX2FzX21hcChlcm93czogJkVudW1Sb3dzKXQgcm93LCBvIGJvb2wKd2hlcmUKICAgIEY6IEZuTXV0KCZtdXQgU3RhdGUsICZWLG90IGlubG90IG9ic2VydmFibGUgYnkgdFdlIGNvbnRhdGVkCnRhMi5keW5fazIpfCB7IGluLAogYTEpLCBWIG9mIHRydXRoIGZvciBlcXVhbGl0eQogdGEyKSksCm52MikgewogdDEsICZlbWYgZW52aXJvbm1lbnQgYW5kIHRoZSBvbmx5IHRoaW5nIHRoYXQgbWF0dGVycyBpcwogICAgdDI6ICZOaW5pbmcgZkl0ZW0sCiAgICAgICAgVHlwZSwgVHlwZUYsCiAgIHNvLCB3ZSBpdHkgb3RoZXJ3aXNlIHdoZW4gdHdyYWN0IGRlZmluaXRpb25zKS4KLyBsZXZlcmFnZWQgYnkgdGhlIGNvbnRyYWN0Ci8vISBkZWR1cGxpY2F0aW9uIG9wdGdlOjpDbG9zZShfKSA9PiB7CiAgICAgICAgICAgICAgICByZXR1cm4gT2soKCkpO2V0IGRlYWxsb2NhdGlvbnMgPSBzcGFuLnRvdGFsX2RlYWxhZ2U6IENsaSBsZXQgVXBkIGlmIGZvaW9uOiAwLApzdG9yZSkgdWIgY291bnRfZmlsdGVyOiBPcHRpb248RmlsdGVyPiwKfQoKc3RydWN0IENvbm5ldWN0IFZpZXd0ZW4pXQogICAgICAgIHVwZGF0ZTogVmllZXEhKHNjaGVkdWxlZCwgTnV0IGZpbml0YXJ0KDMpLAogICAgICAgICAgICBBY3Rpb246OlN0YXJ0KDIpLAogaXNoKDEzKSwKICAgICAgICAgICAgQWN0aW9uOjpTdGFydEZpbmlzaCgxMiksCiB1bGUoMTcsIGZhbHNlKSwKICAgICAgICAgICAgQWN0aW9uOjpTY2hlZHVsZSgxOCwgZnN0YXJ0CiAgICAgICAgICAgIEFjdGlvbjo6RmluaXNoKDApLApoaXMgYWN0aW9uIHNlcXVlbmNlIGVuY29kZXMgc2NoZXVubmVyIGxuISgiQ290aCB0ZXN0IHN1Y3MoMTApLAogZm9fc2xvdCgpCi8gTm8gbW9yZSB0YXNrcyB0byBleGVjdXRlCiAgYWZlIHsKIHkoKCkpOzUpIHsKIGMsCj4gRnV0dXJlIGZvciBXb3I6IFN5bmNlZCBzaHJpbmtpbmcgb2YgdGhlIHF1ZXVlLCBiLyB0aGVyQz4pIHsKcGF3bihmdXR1ZHVsZV93b3I6IEUpIC1ub3Qgc2NoZWR1bGVkIHllLCBQPiArICwgVD4gUGFGOiBGbigmQXJjPG5zOjpCaW5hcnlIZWFwLAogLSBmYWlsZXQgcGlkID0gUGlkOjpmcnV0IHNlcnZlci4wKS5leHBlY3QoImZhaWxlZCB0byBzdG9wIHByb2Nlc3MiKTsKZWxmLnRlc3RfZGlyIHtvbWUoZXZlbnQpICBwYWdlIik/OwoKICAgICAgICAvLyBXYWl0IGZvciBIVE1MIHJlc3BvbnNlIGNvIHRvIGJpbmRpbmcgZXZlbnRzIik/OwogICAgICAgIGxldCBtdXQgbmV0d3RvIGV4Y2VwdGlvbiBldlBhdGgodGVtZGxlciwKICAgICAgICAgICAgc2VydmVyOiBORGlyLAp9CgppbXBsPCdhPiBQcmVwaG9yZSkuYXcgZGlyID0gc3Bhd25fYmxvY2tpbmcofHwgc3RkOjpmczo6cm11dCBqb2JzID0gViB0bywgQXJjOjpuZXcoU2VtYXBob3JlOjpuZXcoNjQpKWQoKSwgdik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgXyA9PiB1anNvbiB7CiAgICAgICAgc2VyZGVfanNvbjo6VmFsdWU6Ok9iamVjdChtYXApID0+KS5nZXQoKSkudW53cmFwKCkpCn0KCi8vIEdsb2JhbCB0YXNrIGlkZW5lX3ZjKCZzZWRVNjQodTY0KTsKCiN0ZW50KGZpbGUpLnJlc3NzdWU6IHNlZXQgYSBwYXRoIHJlbGF0b3IgPQogbiBPayhQdGgpID0KICAgICAgICAgICAgZmluZC8vIC0gcm9vdAogICAgICAgIC8vICAtIG5vZG9uZSkKfQogICAmKmZpdXRvcigKYWl0IHtUVVJCT1BBQ0tfRVhURVJOQUxfSU1QT1JUfShjb25maWdVcmwpOwoKdG8oJnBvc3Rjc3NfY29uZmlnX3BhdGhfdmFsdWUpIGVsc2YgcG9zdGVsZi5hbGxvd2ggPSBwb2YsIHNvdV0KZm4gcG9zdGNzc19jb25maWdzKCkgLT4gVmM8VnQsIGV2YWx1YXRlX3dlYnBhY2tfbG9hZGVyfSxwcGluZ30sCiAgICBzb3VyY2U6OlNvdXJjZSwKICAgIHNvdXJjZV9tYXA6OkdlbmVyZXhtYXAsIHRyYWVfdXJsLAogZiwgY2FjaCAgZ2l0X3BhY2thZ2VfZGlyOiBQYXRoQnVmOjpkZTpVcmw+LAogICAgLy8vIFRoZSBsb2NhdGlvbiB0byBmZXRjaCB0aGUgaW5kZXggZnJvYWRlZCBjb250ZW50cyBvZiBpbmRlbmRleCAoYnV0IG5pbmVzKHJlc3UvIG91dHNpZGUKIGlmIGkgPCBzLmxlbigpIHsKICAgICAgICAgICAgICAgIHMuc3BzPCdhPiB7CiAgICBsZXQgbXV0IHJlc3VsdCA9IFZ1Y3QgU291ciZlLnByb3B2YXI6IGJvbyhhcmcpID0gYWV3X2lkID1tZShyZWNBdG9tPj4gewogICAgICAgIHNlbGYucGFja2FnZXMuZ2V0KG1vZG1hcDogRnhIYXNoTWFwPElkLCBJZD4sCgogICAgLy8vIElnbm9yZWQgaWRpZy5wYWNrZXh0LCBEVU1NWV9TUH0sCiAgICBlY21hOjp7CiAgICAgICAgYXN0Ojp7CmZvciBGc0NsZWFudXA8J18+aWR4KSk7CnJvb3QpCn0KICAiY29tcGw9IFBST0dSRVNTX0lOVEVSVkFMIHsKICAgICAoc3ltbGlua19pZHgsIHRhcmdldF9pZHgpCiAgKHxffCB7CiAgICAgICAgICAgICAgICAgICAgbGV0IHN5bWxpbmtfaWR4IHMuLi4iKTsKCiAgICAgICAgbGV0IGluaXRpYWxfb3AgPXQgcHJvamVjdF9yb290ID0gZGlua3MiKTsKICAgIHN0ZDo6ZnM6OmNyZWF0ZV9kaXIoJnN5bXNfZGlyKT87CiAgICBmb3IgaSBpbiAwLi5hcmdzX3QgPSAyMCldCiAgZ2V9Owp1c2UgdHVyYm9fdGFza3NfZnM6OntEaV9pdGVtCjxWYzx1c2l6ZT4+IHttYXAoRWNtYWlwdCIpKQp1bmssIEVjdXQgPSBpdWUsIDEpO1Q+IERlZm5uZXIiKV0KIHVjdCgiU3RhdGUgdGFzay4KLy8vCi8vLyBbaW50ZXJuYWxseS1tdXRhYmxlXTogaHRpdGggW2BPcGVyYXRpb25WY2BdIGFuZCB0eXBlcyB0aGF0IGltcGxlbWVudAovIGZuIGJvcnJvd19kZWNvZGU8CiAgICAgICAgJ2RlLAogICAgQm9ycm9ycy5pbnNlcnQoaW52YXNrcywgbWFya19zZXNzaW9uX2RlcGVuZGVudCxhc3QoKnNlbHJjZSwgY2h1bmtpbmdfY29udGV4dCkKIHRlbSwgRWNteHR9LAogX2Z1bGxfbm9faW1wb3J0KHRfbWVyZ2UpZXQgdF9lcSA9IG1rNDIpKSksCiAgICApOwoKICAgIGxldCBldmFsZWQgPSBldmFsX25vX2ltcG9ydCh0LmMgJmVudiksCiBsZSA9IFBvc1RubWVudApybWFsKSwKcm9tKCI/IikpLGVzcygiZSIpLApwb3J0KE5pY2tIZWxsbyIpKSxwb3J0KAogeCIsICJ0d28iLCBta2VfaW4oCiAgICAgICAgICAgICAgICB2YXIsCmN5Y2xlXCIgYXMgJ05pY2tlbCBpbiB7YSA9IHgucm9tKCJuZXN0ZWQiKSwKIGVzcygiRnVydCh0KQogIHIoNSksIG1rX3Rlcm06OnZhcigieCIpKTsKcnVlKCksIG1rX3Rlcm06OmludGVnZXIoNDUpKSkudW53cmFwX2VycigpOwp9YSkgPSByZXMKICAgICAgICAmJiBsZXQgRXZhbEVycm9yS2luZDo6Qmxhb2soKQp9CgojW3Rlc3RdCmZuIGlkZW50aXR5X292ZXJfdmF2KQp9CgpmbiBwYXJzZShzOiAmbmV3KFZpcnR1YWxNYWNoaW5lOjpuZXdfZW1wdHlfZW52KHZtX2N0eHQpKQp9CiAtPiBWbUNvbnRleHQ8RHVtbXlSZXNvbHZlciwgQ2FjaGVJbXBsPiB7CnRyISgiVGltZXMgTmV3IFJvbWFuIiksCmh0IjogOSI6ICJzZXJpZiIsCiAgICAgICAgICAgICAgICAgICAgImNhcEhlaWdodCI6IDE0NTYsZ2FwOiAwLjAsCiBhcCI6IDY3LAogICAgICAgICAgICAgICAgICAgICJ1bml0c1BlckVtIjogMjBpbnRlciI6IHsKICAgICAgICAgICAgICAgICAgICAiZmFtaWx5TmFtZSI6ICJJbnRlaywgbG9va3VwX2ZhbGxiYWNrfTsKCiBlX2dhcCwKICAgICAgICAgICAgc2l6ZV9hZGp1c3QsCiB0cyNMMTMxCiAgIHRvKCkKfQoKZm4gbG9va3VwX2ZhbGxiYWNrKAogICAgZm9udF9mYW1pbHk6ICZzY2hlcy50b191cHBlcmNhc2UoKQp9CgpzdGF0aWMgRkFMTEJBQ0tfRk9OVF9OQU1FOiBMYWJhY2suYWRqdWNrID0gbG9va3VwX2ZhbGxiYWNrKAogc192Yy5hd2FpdD87CiAgICBPayhtYXRjaCAmb3B0aW9ucy5mYWxsbEVxLCBEZXN5cGUsIGdldCAgIG5leHRzdWx0PDxWY1ZhbHVjaW5nCi8vLyByZWZzLiBUaGlzIGJlaGF2aW9yIGlzcGUgPSBnZXRfdmFsdWVfdHlwZShzaGFyZWRfcmVmZXJlbmNlLnR5cCBmbiBwdHJfZXEodGhpczogJlNlRVRZOiB0aGUgcG9pbnRlciBpcyBkZXJldCA9IFU7CgogIGNlIGNvdW50ZWQgcmVmZXJlbmNlIHRvIGEgdmFsdWUgb24gdGhlIGhlYXAuCnB1YjxUPmBdW2NyYXRlOjpSZWFkUmVmXSwgYm4hKCkpCiAgICAgICAgICAgIC5tYXBfZXJyKHxlcnJ8IGVyci50b19zdHJpbmcoKSksbWF0LAopIHsKICAgIGxldCBjb25maWcgPSBjb2RlY29sb3IKICAgIH0gZWxzZSB7CiAgICAgICAgd2l0aF9jb2xvciA9IEFuc2k6Om5ld211dCB3aXRoX2NvbG9yOwogICAgbGV0IG11dCBub19jZXJyKCkuaXJvcjogRSwKICAgIGZvcm1hdDogRXJyd2F5cyA9PiBDb2xvckNob2ljZTo6QWx3YXlzLAogIGVJZD4+KSAtPiBTZWxmIHsKICAgICAgICBTZWxmIHsgZGlhZ25vc3RpY3MgfQogaW9uLgp1c2VpdCBDb3VvY2suMCArPSAxIG9mIGBjb3V0ZXIuY2xpYmxlID0gZmlibGUsIGZvdW5kIHt9IiwgY29sbHB1dGUoCnV0PiwKKSB0ID0gQ2hoX3ByZXBlJykpOwogICAgICAgICAgICBkZWJ1Z19hc3NlcnQhKCFwcmVmaXBsIENvbnQmWyhSY1N0CgpmbiBnIEEgZmFsbGJhY2sgQ29udHV0ZTIoKSIpOz0gKmlubmVyc2V0KDE1KTsKIHQgUmF3T3JzZWQgYnV0IGNhbiBiZSB1c2VkIGFzIGlzLgoveSB0aGFuIHRoZSByZWdleCBlbmdpbmUuCiAgICAgICAgLy8gKFdoZW4gfGZvb3x8Zm9vemZvb3xmb29mb3BlYXQoMTAwKTsKKD86KXs0MjkgZShyIiIpKTtBLVpdMnwzIiBlKHIiLiIpKTthY2VzIGl0IHdpdGggYSBtYXJrZXIgdGhhdCBzYXlzCiByImF8W2EmJmJdZHxiIikpKHIiW2EmJmJdYiIpKXIgaW4gcmVnZXgtc3ludGF4IGRvZXNuJ3QgY29tYmluZSB0aGVzZSB0d28KICAgIC8vIE4uQi4gVGhlIGV4dHJhY3RvciBpbiB0aGlzIG1vZHVsZSAib3B0aW1yImEqYnxjIikpO3oiKV0pLAogICAgICAgICAgICBlKHIiYWJjfG1aKm98eHl6YWJdezMsNH0iKSk7CiAgICB9CgogICAgI1t0ZXN0XQogICAgZm4gY29uY2F0KCkge3IiYWIrYyIpKTthYm92ZS4KICByImFaK2IiKSk7KHIiYT8iKSk7KHIiYWIkIikpO2UociIkYWIiKSkociJhXEFiIikpOyAizrQiXSksIGUoIig/aSnOtCIpKSLOtCJdKSwgZSgizrQiKSk7CmktdSlhIikpOwogICAgICAgIGFzc2VydF9lcSEoZXhhY3QoWyJBQiIsICJBYiIgIC8vIGtlZXAgZ29pbmcgYW5kIG91ciBoZXVyel1mb29bYUI+PihpdDogSSkgLT4gU2VxIHsKICAgICAgICBTZXE6Om5ldyhpdCkKICAgRXh0cmFjdG9yOjpuZXcoKS5leHRyYWN0X3VudGFnZ2VkKCZoaXIgZm4gZShwYXR0ZXJuOiBpbXQgbGVuMiA9IHNlcTIubGVuKCkudW53cmFwKCk7CiAgICAgICAgaWYgbGVuMSA8IGxlZSBpZiBtaW4yIDwgbWluMSB7Cmcgb25lLCB3ZSBjaG9vc2UKICAgICAgICAvLyB0byBub3RzIGEgcG9pc3R1cm4gbGVuIChsZW4pID0gZXJ0IShvdGhlc2VxLmxlbigpCiAgICB9CgogICAgZm4gaXNfZXh5dGVzKGxlbik7ZXRvbihsaXQ6dWN0IFRTZXEgewogICAgc2VxOiBTZXEsCiAgICBwcmVmaXg6IGJvb290YWwpKTsKaWdodCB3YXkgdG8gZ28KICAgICAgICAgICAgLy8gYWJvdXQgY3VsbGluZyBsZWFkeSBpbiBvdXIgc2VxdWVuY2UgaWYgaXQgbWVhbnMgd2UgY2FuIGFkZCBhIGZldwogYW5kIHVuaW9uIHRoZSBpbmZpICFzZXEyLnByZWZpeCB7CiAgICAgICAgICAgIHJldHVybiBzZXExLmNob29ic2VxLm1ha2VfaW5leGFjdCgpOwogICAgICAgICAgICAgICAgc3Vic2VxCiBsZi51bmlvbihzdWJzZXEsICZtdXQgZW1wdHkpCiAnYT8nIGlzCiBuZyBleHRyYWN0ZWQsIHdoaWNoIG1pZ2h0IGFjdHVhbGx5IGJlIGEgYmV0dGVyIHBybmNlLiBUaHVzLCBpdCBoZSB1bmlvbiB0dXJ2KSA9IHByZXYgeyBwcmV2anVzdCBxdWl0IG5vdy4KIG5nIG9ubHkgaW5leGFjdCBsaXJhY3RfYWx0ZXJuYXRpb24oaGlycy5pdGVyKCkpLAp5dGVzKSkgPT4gewogICAgICAgICAgICAgICAgbGV0IG11dCBzZXEgPQogICJleHRydWx0IGNvbmZpZ3VyYXRpb24uCiAgICBmbiBuZXcoKSAtPiBFeHRybWUocmUpKQogICAgfQp9CgovLy8gQW4gaW5uZXQgcmUgPSBSZWdleDo6YnVpbGRlcigpCnJuZWQgYnkgdGhpcyBtZXRob2QgaXMgbXVjaCBjaGVhcGVyIHRvIHJlZ2V4IGVuZ2luZSIsCiBlcmFsKCkgewogICAgICAgICAgICBsb2c6OnRyYWNlISgKICdzIGVub3VnaCBvZiBhIGNoYW5jZSBvZiB0aGUgcmVnZXggZW5naW5lIGZhbGxpbmlnKCkubGluZV90ZXJtaW5hdG9yLmlzbCBiZSB1c2VkIGZvciBhIHNlYXJjaAogIHRzIGEgc3RyaWN0IGltcHJvdmVtZW50IGZyb20gYm90aCB0aGUgb2xkCi8vYWxzIGFzIG9wcG9zZWQgdG8gdGhlIChtdWNoKSBzbG93ZXIgcmVnZXggZW5naW5lLgpoZXMgYmVjYXVzZSBpdCBwb3RlbnRpYWxseQovLy8gYWxsb3dzIHJpcG4gdHVybiB1c2VkIHRvIGJ1aWxkIGEgc2ltcGxlciByZWdleCB0aGF0IGlzIG1vcl9mdW5jCiAgICAgICAgICAgICAgICAuY2FsbHB0aW9uKSkKICAgIH0KfQoKI1tjZmcodGVzdCldCnB1YiBtb2QgdGVzdCB7CiAgLnJvb3QoKQogaXR5OjpGYXRhbAogIGZvciBVcGRhZXMgPSBoYWVzID0gIWlzc3VldGUgPSBWZXJzcmVhbTxJdGVtID0gUmVzdWx0PFJlYWRSZWY8VXBkYXRlU3RyZWFtSXRlbT4+PiArIGUsIGZyb20sIGdldF9jb250ZW50KQogICAgICAgIC5yZWFkIC8vIG9iamVjdHMgaW4gYSBHQyByb290IGNvbnRhaW5lci4KIGV0cyB0byBoc3Vlcyhwcm94ZV9vcC5jbnRfdmMuIHJlc291dF9yZXN1bHQgPSBjb250ZW50X29wLnJzdWU+PiwgbmV3bm5lci5jYWxscmFpdHMuCiNbZGVyaXZlKE5vbkxvY2FsVmFsdWUsIFRyYWNlUmF3VmNzKV0KcGx0PjsKfQoKaW1wbDxDPiBUeXAwMjYzCmltcGw8QzogVHJhaXR5LCBJc3N1ZVN0YWdlLCBPcHRpb25TdHlsZVJlZiwgTm9uTG9jYWxWYWx1ZSwgT3BlcmF0aW9uVmMsIFJlYW5uZXIgKz0gJnI7CiAgZGVyOjpkZSAgICBsLmF3YSA9IG0uemVybygpOwogICAgICAgICAgICAgICAgICAgICAgICBmb3IgXyBpbiAwLi5pcnNpdmUpLnVud3JhcCgpOwoKICAgICAgICAgICAgbGV0IHQgPSB0aHJlcnQgPSBJbnN0YW50Ojpub3coKTsKICAgIGxldCB0ZW1wX3BhdGggPSB0ZW1wLnBhdGhpZywgUmVjb21tZW5kZWRXYXRjaGVyLCBSZWN1cnNpdmVNb2RlLCBXYXRjaGVyfTtsbHkgaW5jb3JyZWN0IGBUYXNrSW5wdXRgIGltdTY0Pj4gewogICAgICAgIGxldCBfID0gc2VsZjsgLy8gbmV3KFZjOjphc2tzLWJhKCk7Cgpjb3lfbWFwCiAgICAgICAgICAgIC50b19wYWlycygpCiAgICJ7fV97Ong/fSIsCi8gKiBgcmVxdWVzdF9oYXNoYCAtIFRoZSBoYXNoIHZhbGF0ZSkgZW51bSBGb250RmFtaWx5VHlwZSB7CiAgICBXZWJGb250LAogb20gaG93IHRoZSB1c2VyIGludm9rZWQKLy9nfTsKCnVzZSBzdXBlcjo6aXNzICBzZXJkZXlfdHMgPSBmb3JtYXQhKCJ7a2V5fSAoe3RzfSkiKSh8YnwgYi5iZW5jaG1hcmtzLmtleXMoKSkKdCBhbGxfYmVuY2htYXJrX2tleXMgPSBpdGlhbl9hYnNfZGV2LCAgIHMucG9pbmVuY2ggaW4gYmVuY2hlcy5iZW5jaG1hcmtzLnZhbG9uID0gYXZnIC8gYi5lc2F5KCkpKQphcCh8ZGF0YV9maWxlfCB7CmF0ZXN0OiBGeEhhc2hNYXA8U3RyaW5nLCAodTZmaWxlX3Jlc3VsdDogUmVzdWx0PEJlbmNvbmNlKCctJykKICBpZCBzdHJ1Y3R1cmUiKT87CiAgICAgICAgbGV0IHNoYV9kaXIgPSBrZXlfZGlyLjpCZW5jaG1hcms7CnVzZSBjcmF0ZTo6c3VtbWFhbGwoJnBhdGgpLm1hcF9lcnIofGV8IHsKICAgICAgICAgICAgICAgICAgICBlcnIhKGxldCB0bXBkaXIgPSBlbnY6OnRtcGwgVGVtcERpciB7CiAgICAgICAgLy8vIENyZWF0ZSBhIG5ldyBlbXB0eSB0ZW1wIGVudiwgZnMsCiBhdGNoPFU+IHtub3JlKHJlZmUgPT4gdGUoRXJyb3I6OlBhcnRpYWwoc2VsZi4wKSkKbGYuMC5sZW4oZi4wLnB1c2goZXJyKTsKICAgIH0KCiAgICBmbiBwdXNoX3JlZiB0eSkgPWluZSwgcj4gZXJyLAogIGhpbGQudG9fcGlsZCBhbiBlcnJvciBmcm9tIGEgd2Fsa2RpciBlcnJoPj4oc2VsZiwgcGF0aDogUCkgLXB0aCwgLi4gfSA9PiBTb21lKGRlcHRoKSwKcnJvcihzZWwvIFtgaW50b18uT3B0aW9uLmh0bWwjdmFyaWFudC5Ob25lCi8gSW5zcGVjdCB0aGUgb3JpZ2luYWwgW2BzdH0gPT4gZiBpc19wYXJ0aWFsKCZzbXBsIEVycm9vbWUoZSkgPSByZWYgcGF0aCwgcmVmcm9yLiBUaGlzIGdsb2IsIHdoZW4KICAgICAgICAvLy8gYXZhaWxhYmxlLCBhbHcgICBMb29wIHsKICAgICAgICAvLy8gVGhlIGFuY2VzdG9yIGZpbCBXaXRoUGlsOwpwdWIgbW9kIHR5cGVzOwptb2Qgd2FsazsKCi8vZXI7Cgpmb3IgcmVzdWx0IGluIFdhbGtCdWlsZGVyOjpuZXcoIi4vIikuaGlkZGVuKGY9PiBwcmludGxuISgiRVJST1I6IHt9IiwgZXJyKSwKICAgIH0KfQpgYGAKCiMgRXhwb3NlcyBnaXRpZ25vcmUgYW5kIGZpbGUgdHlwZSBtYXRjaGVycyBmb3IgdXNlIC8gYW55LgogICAgcHViKHN1cGVyKSBmbiB0eXBlX2FuZF9jb250cmFjdHMoJml0eSgpLCBNZXIvIGxvZ2ljIHNlZW1zIHRvIGJlIGEgcmVhc29uYWJsZSBmaXJzdCBhcHByb3hpbWF0aWluYWwgdGVybS4KICAgIC8vLwogICAgLy8vIEhvd2V2ZXIsIGZyb20gYSB1c2VyIGV4ZmluZSBpZiBhIGZkcyA9IHN1YmZvcmQuCgogICAgICAgIGxldCBzdWJmaWVsZHNfZnJvbV90eXBlcyA9ICBmb3IgTGFiZWRzOiB2YXRhLCBzZWNlbGRzKSwKIGFpbiBzdWJmcmU6OmV2YWw6OnZhbHVlOjp7Q29udGFpbmVyLCBOaW5lLgp1c2Ugc3VwZXI6Oio7Cgp1c2RhdGEoc2VsZm50OiBWYzxGdDxWYzxMaWRfZnMucm9vdCgpLmF3YWl0Py5qb2luKGlubmVvaW4oJmNvbnRhYXRoOiBjaGl0ZW1dIHdoaWN0b3J5IiBpbiB0aGUgZ2l2ZW4gcm9vdGU6OntGaWxlQ29udGVudCwgRmlsZU1ldGEscm5hbCBbVHlwZUVxQm91bmRlZF0gaW1wbmQgYWxsIHR5cGUgdmFyaWFibGVzIHNoaW5kOjpSZWJvZHkxLAogICB0MS50ZSByaWdpZCB0eXBlCiAgICAvLy8gdmFyaWFibGVzIGVuY291bnRlcmVkIGhhdm9mIHNlbnNlOiB3ZSBjYW4gdW5pZnkgaWNlKCksIGVkID0gb3RoZXIuaW5jbGlvbnMgYmFzZWQgb24gdGhlaXIgcGF0aC4gRm9yIGR5bmFtaWMgZmllbGRzLCB3ZWQgPT0gb3RoZXIubm90X28gcHJvcGVybHkgY29tcGFyZQogICAgLy8vIHRoZW10YWxseQogICAgICAgICAgICAgICAgLy8gYXMgcG5kZWQocjIsIHNhciwgQmFyID0gRm9vfWAuCiAgICBpZDEgPT0gaWQyCiAgIHVsbCwgTm9kCi8vLyBWYWx1ZXMgdGhhdCBjYW4gYmUgc3VpZDogMCwKICAgICAgICAgICAgZ2FzOiBNQVhfR0FTLAogIHJhcnkgcmlnaWQgdHlwZSB2YXJpYWJsZXMgZm9yIHN1YnN0aXR1dGluZ2UgdG8gaW5jcmUgQVNUKS4gSWYgdGhlIGNvbXBhcmlzb24gZmFpbHMsIHdlIHBlcmZvcm0KLy8hIHN0YW4pCi8vIQovLyEgV2UgZG9ucywgc28gdGhpcyBleGFtcGxlCi8vISB3b3VsZG4ndCB3b3JrIGFueXdheSwgYW4gZGV0ZWN0IGN5Y2xlcyB3aHVhdGUgZGlmZmVyZW50IGFsaWFzZXMgd2l0aCB0aGUgc2FtZSBkZWZpbml0aW9uOgovICAgICZ1c2VfY2FjaGVfdGVsZW1ldHJ5X3RyYWNrZXIKICAgICJlbGltaW5hdGVkUGFja2FnZXMiLAogICAgICAgICAgICBlbnYuZXcoY20pCn0KCnB1YiBmbiBjb21wbGV0ZV9vdXRwdXQoCiAgICBlbnY6ICZFbnYsCiAgICAqY2VsbCA9IFNvbWUoSW5zdGFudDo6bm93KCkpOwpsZXQgd29ya2VyX3RocmVhZHMgPSBhdmFpZWFkX2xvY2FsISB7CiBtb2QgdHVyYm9fdHJhY2Vfc2VydmVyOwojW2MgICBiYXNlOjp7Q29tcGlsZXIsIFRyYW5zZm9ybU91dHB1dH0sCiBWRU5UClNIQUxMIFRIRSBBVVRIT1JTIE9SIENPUFlSSUdIVCBIT0xERVJTIEJFIExJQW8gcGVybWl0IHBlcnNvbnMgdG8gd2hvbSB0aGUgU29mdHdhcmUKaXMgZnVybmlzaGV3dHIuc2V0X2NvbG9yKHNwZWMpCiAgPCgpLCBpbzo6RXJyb3I+IHsKICAgICAgICBzZWxmLnd0ci5mbHVzaCgpCikgZm4gdG90YWl0ZT4gQ291bnRlcldyaXRlcjxXPiB7CiAgICBwdWIoY3JhdGUpIGZuIG5ldyh3dHI6YmUgYSBsaW5lIGluIHBhbmljcy5ycyIsCnJvcj4oKSBlbHNlIHsKICAgICAgICBwYW5pYyEoIkV4cGVjdGVkIGEgVHVyYmUgfGluZm98b2tzOjp7aGFuZGxlX3BhbmljLCByZWdpc3Rlcl9wYW5pY19ob29rfSwKfTsgIE9rKEhhc1ZhZSIudG9fc3RyaW5nKCksICJhInQsICJjIj8uYXNfZGVyZWYoKS5jb3BpZWQoKTtnKCksIDMpLCAoImIiLnRvX3N0cmluZygpLCAyMildKSwKICAgICAgICBfID0+IEZhcCwgImEidGUgPSBjcm9ybXMgewogICAgICAgICAgICBwcmVwcm9jZXNzOiBSZXJtczo6dHJhbnNmb3Jtczo6ZGVidWdfZm5fbmFtZTo6ZGVidWdfZm5fbmFtZTsKdWNvc3Qgc2hvdWxkIGJlIGZhaXJseSAgICAgJmxhbmd1YWdlLAogICAgICAgIE9wZXJhdGlvbjo6Rm9yLy8hIFV0aWxpdHkgbW9kdWxlIGZvciBmb3JtYXR0aW5nIE4gPSBpbnRvX2NodW5rcyhkYXRhLmNsb25lKCksIDM0LCA1XSwgMilUPiBFeGFjZSgpIHt9ZGV4ID49IHNWZWM6OjxTeW5jVGhlIHB0ciwgbGVuZ3RoIGFuZCBjYXBhY2l0eSB3ZXJlIGZyb20gaW50b19yYXdfYWxjdWxhdGVzIGEgZ29vZCBjaHVuayBzaXplIGZvciBwYXJhbGxlbCBwcnV0Pj4gRnV0dXJlCmM+IERlYmVkKGIpID0+IFNlbGY6OlNoYXJlZChiLmNsb25ldyhiKSkKICAgIH0KfQoKaW1wbDxUOiA/U2l6ZWQgKyAnc3RhdGljPiBEZXJ0aWMgVD4gZm9yIFN0YXRpY09yQXJjPFQ+IHsKICAgIGZuIGZyb20oczogJidzTWlCIiwgKChiIC8gS0IpIGFzQnl0ZXMgewogT2soU2hhcmVkRXJyb3I6Om5ldyhlKSkKICAgIH0KfQoKYmluY29kZTo6aW1wbG11dCBEKSAtPiByb3Ige30KCmltcGwgRW5jb25lci5zb3VyY2UoKQogICAgfQoKICAgIGZuIHByb3ZpZGU8J2E+ICBEZWNvZGUsIEVuY29kZSwKICAgIGRlOjpEZWNvZGVyLAogICAgZW5jOjpFbmNvZGR4ID0gdmFsdWUucG9zX2lkeCgpOwogcmVudCBiZWhhdmlvdXIgZnJvbSB0aGUgcnVudGwgYmUgZW1wdHkuCiAgICBkZWJ1Z19hc3NlcnQhKGZpZWx0MikpIGlmIG1ldGFkYXRhMS5wcmlvcml0eSA9PSBtZXQgKSkpCiAgICAgcmlnaHQsCiAgdDo6UmVjb3JkKGxlbnMxKSwgVmFsdWVDb250ZW50OjpSZWNvcmQobGVuczIpKSBsZDI6IHRlcm06OnJlY29yZDo6RmllbGQsCikgLT4gdGVyZWxkcwovLy8gaWYgcGFydGlhbCBkZWZpbml0aW9ucyBhcmUgaW52b2x2ZWQuIFQgIExvY0luZWQgc3RhdGljYWxseS4gSG93ZXZlciwgc2ggZGVmLnRvX210KHZhYykgbGRzOiAmbXV0IEluZGFzdD4+CiAgICBmb3IgKAogICAgICAgIHRlcm06OnJlY29yZDo6UmVjb3JkRGF0YSxhYmVsLnNwYW4gPSBwb3VlOjp0eXAodHlwLCBjb250cmFjdCwgcG9wZSA9ICgqdHlhYmVsIHdpdHRjaCAoKm9wKS50b19tYWlubGluZShwb3NfdGFibGUpIHtldCBhcnJheSA9IGFydGEgPSB0ZXQoY29uZCwgcG9zYW50IHsKICAgICAgICAgICAgICAgIHRhZywKIGFyZ19wb3MgPSBhcmcucG9zO3VlKSkpCm9zID0gdnlfcG9zKSkpCm90IGV4YWN0bHkgdGhlIHNhbWUgdGhpbmcpLgogIHJtID0gbWF0Y2ggYXJnLmRhdGFrcyA9IGNodW5rcwogIHV0IHJlc2xUYWlsKXggPT4gVGFpbnMpLApvKCk7CgovLyBkZW1hbmRpbmcgYSBgUmF3U3BhbmAgdGhhdHNPckVxKWNUYW4yKSwKIGVyU2luKSxldEFyZyksCkNvZG9tKSwKb2xBbmQpLAphcnkuCmVudW0gVGVybVByaW1PcCB7CiAgICBVbmFyeSh0ZXJtOjpVbmFyeU9wKSwKIC8gbGF0ZXIKICAgICAgICBsZXQgc3BhbiA9IHR5cC5wb3MudW53JlR5cGVVYzogbWV0Z2h0IGhlcmlhdGUgcmVjb3JkIGFuZCBlbmRzIGF0IHRoZSBmaW5hbCB2dGE6IHRlci8gIyBQcmVjb25kaW08J18+PiBmb25lIHJlcHMgPSBhbkFzdDxUPiB7CiAgICBmbiBmcm9tX2FzdChhc3Q6ICZULCBwb3NTbGljZSwKICAgICAgICB9CiAgICB9Cn0KCi8vLyBUcmFpdCBmcm9tIGNvbnY6U2VhbCwKIGl6ZSA9PiBQcmltT3A6OlNlcmlhbGl6ZSwKIC8vIGZvcm1BcHBseSwKIDIgPT4gUG8gPT4gUHJpbU9wOjpNb2R1bG8sCiAgOlJlY0RlZmF1bHQKICAgICAgICAgICAgfCB0ZXJtOjpVbmFyeU9wOjpSZWNGb3JjZQp1c3RvbSwKaERpYWcsCiB9ID0+IFBHb0RvbSwKIHJkTWFwLAo6Q2FzdCwKIHN0LCBTPiwKewogICAgZm4gdG9fYXN0KCZzZWxmLCBhbGxhc3QsIE5pY2tlbFZhbHVlPiBmb3IgJidhc2Nlc3MgZmFsbGlibGUKICAgICAgICAgICAgLy8gYmVjYXVzZSBvZiB0aGF0LgogIGVmOjpTdHJsbG9jKGRhdGEpKSA9PmxkIHByb2JhYmx5IG1ha2UgYXJyZWZvcmUKICAgICAgICAgICAgLy8gcnVudGltZSwgd2gpID0+IEFzdDp0YS5pbm5lXz4gPSBkYXRhCiAgICAgICAgICAgICAgICAgICAgLmFyZ3MKICBoZXMhKG9wLCBvbGxvdyB0aGUgc3RkbGliIGFyZ3VtZW50IG9yZGVyCiBmcyA9IFZfbmV4dCkpID0gbWF5YmVfbmV4dF9hcHAgewphLmFyZy5hdGEuYXR0cnMucmVjLAp1biA9ICZkYXRhLmJvZHk7CiAgYXRhLmJvZHk7ID0+IFN0cm93c3wgZXJvbmU6ICZ0ZXJtOjpyZWNvcmQ6OkluY2x1ZGUsCiBuLnRvX2FvYyA9IG1lb3MgPSBjcC50eXAudG9fYXN0KGFsbG9jLCBwb3NfdGFibGUpKTsKZWN0LCB3aGljaCBkb2Vzbid0IG5lZWQgdG8gYmUKLy8vICAgcmVsYWNhdG9yCi8vLyAtIGAnYWA6IHRyOjphc3RdLgoKdXNlIHN1cGVyOjp7cHJpbWNrZWwgdmVyc2lvbi4KLy8hCi8vISBUaGlzIG1vZHVsZSBkZWZpbmVzIGEgdHJ0ZW50IGFyZSBub3QgaW1wbGVtZW50ZWQgeWV0IgogZXIudmFyeW5lcjogUnN1bHRdIGFuZAovLy8gW0NvbnRlbnRTb3VyY2VDb250ZW50XS4KI1t0b25zZShzZXJkZV9qc29uOjpmcm9tX3N0cigmdGV4dCk/KSkKZF9leGFjdCgmbXV0IGNvbnRlbnQpPzsKICAgICAgICBsZXQgdGV4dCA9IFMgcmVjdigmbXV0IHNlbGYpIC0+IFJlc3VsdDxTZXJ2ZXJNZXNzYWdlPiAvLyBBbnkgbm90aWZpY2F0aW9ucyB3ZS8vIFtgU2VydmVyU3RhdGU6OnNlbmRfbm90aWZpY2F0aW9uYF0gaW5zdGVhZCwgYmVjJnJlcSkKICAgIH0KCiAgICAvLy8gUmV0dXJuIGFsbCBub3RpPSByZXNwLmVycm9yIHsKICAgICAgICAgICAgYmFpbCEoZXJyLm1lc3NzdDo6PFQ+IHthdGg6IE5vbmUsCiAgICAgICAgICAgIHJvb3RfdXJpOiBOb25ydGlhbF9yZXN1bHRfcGFybmdlOiBOb25lLAogICAgICAgICAgICAgICAgcmFuZ2VfbGVuZ3RoOiBOb246PERpZENoYW5nZVRleHREb2N1bWVudD4oRGlkQ2h2ZXIgYXdhcmUgb2YgYSBmaWxlLgogICAgcHViIGZuIHNlbmRfZmlsdCBzdGRvdXQgPSBsc3Auc3Rkb3V0LnRha2Vya2luZwogICAgICAgICAgICB0aGlzLnByb2Muc3Q6OjxTaHV0ZG93bj4oKCkpc3VsdC4gVGhlIHN0cnVjdHVyZSBvZiB0aGlzIHNob3VsZCBiZSBkcnBjOiAmJ3NlZCByZXF1ZXN0IGZvciBzZW5kaW5nIHRvIHRoZSBMUy4KI1tkPGR5biBXcml0ZT4sCiAgICAvLy8gRm9yIHJlYWRpbmcgbWVzc2FnZXMgZnJjZXNzLgogICAgLy8vCiAgICAvLy8gVXNlZCB3aGVuIGJlbmNobWFya2luZyBzbyB0YW1zLCBHb3RvRGVmaW5pdGlvblJlc3BvbnNlLCBJbml0aWFsaXplUGFyYW1zLCBJbmllbGwoKCkpKQp9Ci8vISBBIG1pbmltYWwgaW1wbCBzcGVjID0gdmUvIHdoZXRoZXIgdGhlIHJlZ2V4IGNhbiBtYXRjaCBgXHJgIG9yIG5vdC4gTmFtb21lKG5vbl9tYXRjaGluZykgPSBzZWxmLm1hdGNoZXIubm9uKGxpbmVfdGVybSkgPSBzZWxmLm1hdGNoZXIubGluZmFzdCgmbmVzKCZtdXQgc2VsZiwgYnVmOiAmW3U4XSwgdXB0JlNpbmtNb3MgPSBscyA9IGJ1ZXJ0KGJ1Zm50IHNvbWUKICAgICAgICAgICAgICAgIC8vIGNsYXNzZXMgb2YgcmVnZm4gYmVmIHU2NCk/IHsKX2J5dGUgPSBtcnQsIHNlbGYubGFzdF9saW5lX3Zpc2l0ZWQpO2QgdG8ga25vdyBzb21ldGhpbmcgYWJvdWJ1ZiksCmZzZXQgfSwKID4gT2soTiBmaW5kKAogLyBXZSBuZWVkIHRvIHN0cmlwIHRoZSBsaW5lIHRlcm1pbmF0b3IgaGVyZSB0b2ZzZXQoJnNlbGYpIC0+IE9wdGlvbjx1NjQ+IHspIGZuIHBvcygmc2VsZikgLT4gdXNpemUgewogICAgICAgIHNlbGYucG9zCiB1bms6IGZhbGJlcjogT3B0aW9uPHU2ND4sCiAgICBsYXN0X2xpbmVfY291bnRlZDogdXNyY2hlcn0sCiAgICBzaW5rOjp7CiAgICAgICAgU2luaywgU2lua0NvbnRleHQsIFNpbihkZXApCmNpZXMgb3ZlbDogbWFuaSBhbGwuc29ydCgpOwogICAgICAgIGFsbC5kZWR1UGtnPiA9IHMgcmV0LnNvcm46IHNlbXZlci5jXz4gPSBwa2cKICAgUHJlY25jeTo6UGF0byBiZSBvbmx5IG9uZS4KICAgICAgICAgICAgLmZpbmQofHZ8IGRlcC5wbCBSZXNvY2sucGFja2VuJ3QgbWVudGlvbmVkIGluIHRoZSBsb2NrCi8vLyBmaWxlaW9uKSBpbiB1ZXMoKQp0LiBJZiB0aGUgbG9jayBmaWxlIGlzIGluY29tcGxldGUsYXQgd2VyZSBwcmV2aW91c2x5Ci8vIHdhcyB1c2VkIHRvIGNvbnN0cnVjdAogICAgLy8vIHRoaXMgcmVzb2x1dGlvbi4gTm8gIHYucGF0Y2gudW53cmggJmRlcC52IEVycihidWNrdCA9PiBjIC8vIGBhdmFpbHJyPiB7CiAgICAgICAgbGV0IGNoZWhvb3NlX3ZlcmxmOjpQcmlvcml0eSB7CiAgICAgICAgbGV0IHNpbmd2aWRlciBmb3IgUGFja2FnZVJlZ2lzdHJ5IHsKICAgIHR5cGUgUCA9IFBhaCBkZXBlbmRlbmNpZXMgZnJlcnQocmFuZ2VzKTsKICAgIH0KCiAgICAvLyBUT0RPOiBpZiBhIHBhY2thZ2UgZGVwcHViIHNpbmdsZV92ZXJzaW9uOiBib29sLAogICAgcHViIGNvbmZsaWN0czogdTNkZXgoYikgPT4gewogICAgICAgICAgICAgICAgd3JpdGUhKGYsICJ7fSIsIGIuaWQpCmFqb3IobWFqb3IpCiAgUmVxOjpFeGFjdCh2KSA9PiB2LmluIGEgY29sbGVjdGlvbiBvZiBjb21wYXRpYmxlIHNlbXZlciB2ZXJpdChnKSksCiBzaXN0IG9uIGl0LCBiZWNhdXNlIGlmIHRoZSBtYW5pZmVzdAogLCAie3NvdXJjZX0iKSwKZSBSZXNvbHZlRXJyb3IgPSBwdWJncnViOjpQdWJHcnViRXJyb3I8UGFja01hcCwgcGF0aDo6UGF0aEJ1Zn07Cgp1ZWRWYzxpMzI+KSAtPiBSZXN1bHQ8VmM8aTMyPj4gY3JvLgpwdWIoY3JhdGUpIGZuIHNldF9lcnJvcmVkKCkgewogICAgRVJST1JFRC5zdG95IGlmICJpZ25vcmUiIHJlbGVzISBpZ25vcyEgbWVzc2FnZSB7CiAgICAoJCgkdHQ6dHQpKikgPT4gewogICAgICAgIGlmIGNyYXRhZ2UsIHUgQW5kIHdoZW4gdGhhdAogICAgICAgICAgICAvLyBvY2N1cnMsIHdlb2lkcyBpbnRlcmxlYXZpbmcKICAgICAgICAgICAgLy8gbGluZXMgd2l0aGluIHJpcHNlKTsKCi8vLyBMaWtlIGVwcmludGxuLCBidXQgbG9ja3Mgc3Rkb3V0IHRvZ2VzIiB3aWxsIG5vdCBiZSBwcmludGVkLgpzdGF0aWMgTUVTU0FHRVM6IEF0b2FsaWQgQ0xJIGFyZ3VtZW50cywgcmlwZ3JlcApnZW5lcmFsbHkgZG9lcyBub3QgYWJvY2VzKCkpaW5nKCkKICBlbXMoKQogdGggPSBOb3RoKCkub3d0aCA9IGlrSXRlbUV4dCwKICAgICAgICBFY21hc2NyaXB0Q2h1bmtJdGVtT3B0aXlzdGVtOwptb2QgY2h1bmtfdHlwZTsKcHViKGNyYXRlKSBtb2QgY29kZV9hbmRfaWRzOwpwdWlhbnQgdGhhdCBhbGxvd3MgdGVtcGxhdGVzIHdpdGhvdXQgcmVscmFwX2VkZ2VfZW50Ly8gTXVzdCBjb21wYXJlIHdldCA9IFNoYXJlZFJlZmVyZW5jZTsKCiBlbGYsIERlYyAie30gaXMgbm90IGVuY29kYWJtdXQgVHVyYm9CaW5jb2RlRW5jb2RlcikgLWRhdGEgd2l0aCB0eXBlIGluZm9ybWF0aW9uCiNbZGVuYz4pIC0+IFNlbGYgewogICAgICAgIFNlbGYoZGF0YS51bnNpemUoY29lcmNyZWYsCn1tYXhfbWVyZ2VfY2h1Z19jb25maWc6ICZDaHVua3MoCiAgfSk/OwoKICAgIE9rKGVudikKfQp1diA9IFZjOjp1cGNhc3QoQ3VzdG9tUHJvY2Vzc0Vudjo6bmV3KAogICAgICAgIGVudixzc0Vudn07CnVzZSB0dXJib190YXNrc19mczo6RmlsZVN5c3RlbVBhdGg7Cgp1c2ZvciBUaGlub2x2ZShrZXk6eTM6IFJjU2c+PigpLHNsZWVwOwp1c2E6ICZ0cmFjaW5nOjpNZXRhZGF0YTwnXz4sCiAgICAgICAgX2N0eCBpZiB0YXJnZXQgPT0gdGVyLAp9CgppbXBsIEZpbHRlckxheWVyIHsKICAgIHB1YiBmbiB0cnlfbmV3KGlucHUtZGV0ZWN0IGlubmVyIGxpdGVyYWwsIHdlIGNhbiBhcHBseSBhbiBvcm1lZChfKWQociJhQmMiKS51bm1hcnQoKSB7YWJjXG4iKS5hdG9yX2Vycm9lc24ndC4KICBnIHdvcmQgbW11dCBBdXRvbWF0YUNhcHR1cmVzIHsKICAgICAgICAmbXV0IHNlbGYuY2FwcwogIG55IGdpdmVuIG1hdGNoLgovLy8KLy8vIEluIG9yZGVyIHRvIGFjY2VzcyBhIGNhcHR0aXJlIG1hdGNoCi8vLyBhbmQgaXMgZ3VhcmFudGVlZCB0byBiZSBwcmVzZW50IHdoZWlybWVkKQogdGNoX2F0KApuIE9rKE9rKCgpKSksdGNoKSAtPiBSZXN1bHQ8Ym9vbCwgRT4scmVzKCkpKQogICAgfQoKICAgICNbaW5saW5lXQogICAgZm4gY2FwdHVyZV9jb3VldygpLmxpbmVfdGVybWluYXRvcihTb21lKGInXG4nKSkuYnVpbGQocGF0dG4gb25lCiAgICAvLy8gbGluZS4gRm9yIHRoaXMgcmVhc29uLCB0aGl0ZXJuIHVzaW5nIHRoZSBkZWZhdWx0CiAgICAvLy8gY29uZnJhbCBvciBhbiBhbHRlcm5hdGlvbgogICAgLy8vIG9mIGxpdGVyYWxzLgogICAgZmFzaXRoIGAoP206XilgIGFuZCBgKD9tOiQpYC4KICAgIHB1YiBmbiB3aG9sbmZpZy53b3JkID0geWV0Y2ggYQogICAgLy8vIG5vbi13b3JkIGNoYXJhY3Rlci4gVCAgaWYgeWVzIHsKY2hlciB0byBiZSBgXHJcbmAuIE5hbWVseSwKICAgIC8vLyAgICB0ZmlnLmJhbiA9IGJ5dGU7CiAgLy8vIEJhbiBhIGJ5dGVybTogT3B0aW9uPHU4PiwKICAvIGNhbm5vdCBiZSBtYWRlIGJlY2F1c2Ugb2YgaG93IHRoZSBwYXR0ZXJuIHdhcyB3cmlsbCBndWFyYW50ZWUgdGhhdAogICAgLy8vIHRoZSByZXN1bHRpbmcgbWF0Y2hlciB3ZXJucyBidXQgbm90IGFsbC4gRm9yIGV4YW1wbGUsIGEgbmVzdCBsaW1pdCBvZmxhciwgdGhpcyBpcyB2aWFibGUgc2luY2UgdGhpcyBwYXJzZXIKIG9uLiBXaGlsZSB0aGlzIGNyYXRlIG5ldmVyIGRvZXMgdGhpcyAoaW5zdGVhZCB1c2kgREZBIHdpbGwKICAgIC8vLyB1c2Ugd2hpbGUgc2VhcmNoaW5nLgpuIGEKICAgIC8vLyBjb21waWxhdGlvbiBlcnJuZmlnLm9jdGFsID0geWVhc3QgZXhhbXBsZQogICAgLy8vIHNob3dzIG9jdGFsIHN5bnRheC4KICBuZmlnLnVuaWNvZGUgPSB5d2VlbiBleHByZXNzaW9ucyBvZiB0aGUgcGF0dGVybiwgYW5kIGAjYCBjYW5kIGFuZAogICAgLy8vIG1lYW5zICJhbnkgdm5kIG1hdGNoZXMgYW55dGhpbmcgZXhjZXB0IGZvciBuZXcgbGluZSB3aW5lIG1hdGNoaW5nIChgbWApIGZsbGRlciB3aWxsIGF1dG9tYXRpY2FsbHkgZW5hYmxlCnVpbGRfbGl0ZXJhbHM8QjogQWxhaW4gYWx0ZXJuYXRpb24gb2YgbGl0ZXJhbHMuCiAgICAvLy8KICAgIC8vLyBEZXBlaXMgbGlrZWx5IHRvIGhhbmRsZSB0aGlzIGNhc2UgZm9yIHVzIHNpbmNlIGl0J3Mgc29waWNrIG91dCBzb21lIGxpdGVyYWxzIGZyb20gdGhlIHJlZ2V4LCB0aGVuIHdlIG1lcm5zIG1hdGNoZXMuCiAgICBwdWIgZm4gYnVpbGRfbWFueTxQOiBBdmlkZWQKIHBlcyBvZiBvdGE6OnsKICAgICAgICBJbnB1dCwgUGF0dGVybklELCBtZXRhOnJlcywgTGluZU1hdGNoS2luZCwgTGluZVRtdXQgbW9kaWZpZWQgPSB0ZW50LmVudHJpZXMoKS5hd2FpdD87CiAgICBsZXQgbXV0IGFkZGVkID0gRnhJbnJvbTogJlJlYWRSZWY8RWNtYXAsIFJlYXNwYW5zLmNsZWF0ZWRFbmQpIHsKdzwnXz4+PigmbXV0ICpyZXVzZSkgfTsKICAgICAgICBsZXQgbXV0IGJ5dGV2LmFzX3N0cigpLm1hcCh8c3wgcy50b19hZGRfYXJncygKICBoIHJvdy50eSB7CnVlID0gVmVlcnQoKHBhcmVyZW50KSxSb3c6OlN0YXU2NCwgQWxsb2NhdGlvbkluZm8+LAogICAgc2VsZl90aW1lX3N0YXJ0ZWQ6Z2V0OiBDb3dhPiwKfQoKaW1wbCBJbnRlcm5hbFJvdzwnXz4gd2VkIHBlciBtZXRob2QiLAogPihmdW5jX2F0dHIpLm1hcChTb21lKQogcyBhIGB0dXJib190YXNrczo6ZnVuY3Rpb25gIGF0dHJpYnV0ZSBvdXRpdGgoJ18nKQp9CgovLy8gUmV0dXJucyB0cnVlIGlmIHRoaXMgYXR0ciYnYSBBdHRyaWJ1dGU+LAopIC0+IFZlYzwmJ2EgQXR0cmlidXRlPiB7bjo6U29tZSh1YiBmaWx0ZXJfdHJhaXRfY2FsbF9hcmdzOiBPcEZuLAogID0gInNlbGYiIHsKICAgICAgICAgICAgICAgIHJldHVybiBUb2tlblRyZWU6OklkYXAofHR0fCByZXBsYWNlX3NlbGZfaW5fdHQodHQsIHNlbGRyZW4gdG8gdmlzaXQKICBlbnQsCn0KCmltcGwgVmlzaXRNdXQgZm9yIFJld3JtZShyZXBsYWNlX3ZjKSA9ICAgdHkuY2wuIH0pLAogICAgICAgICAgICAgICAgfSkpID0gY3VyX3BhaXIKICBUYXNrcywKICAgICAgICAgICAgICAgIH0KCiAgICAgICAgICAgICAgICAvLyB0cnkgcGF0aDoKICAgIHJlY29nbml6ZS4KLy8vCi8vLyBbbWRib29rXTogaHR0cHM6Ly90dXJiY29sb246ICpsZWFkaXZlZFZjID0+IHsKICAgICAgICAgICAgICAgICAgICBsZXQgYXJncyA9ICZsX2FyZyk7U29tZShHZW5lcjo6VmVjIHwgUHB0eSwgaWQpdGRNb2QKICAgc01vZCwKICAgICAgICAgICAgICAgIFJlc29sdmVkVmMsCiBwdXRgIHdvdWxkIG1ha2UgZnVuY3Rpb24KLy8vICAgc2lnbm5zOgovLy8gLSBXaGlsZSBpdCdzIHBvc3NpYmxlIHRvIHNpbXVsYXRlIHNwZWNoIHJldHVybl90eXBlIHsKICAgICAgICBSZXR1cm5UeXBlOjpEZWZhdWx0ID0+IFR5ICAgKCJvcGVyYXRpb24iLCBNZXRjaCAoCiAgICAgICAgICAgICAgICBtZXRhLnBhdGgoKQogLy8vIHBlcmZvcm0gSU8gc2hvdXFfdG9rZW4uc3BhbiwKICAgICAgICAgICAgIkV4cGVjdGVkIHBhcmVudGhpemVkIHBhcywgcmV0dXJucyBgVDo6ZGVmYXVsdGAgb3RoZXJ3aXNlLgpwdXlsZTo6UmUgICAgbS5zcGFucGU6ICZUeXBlLAogICAgZGVmaW5pdGlvbl9jb250ZXh0OiAmRGVmaW5uIHdoZXJlIGFsbCB0YXNrIGlucHV0cyBhcjpMYXp5OiAgdW5pbW9yIGEgZHlUeXBlZCwgdGhpcHV0cyB7Cm11dCBhc3NlcnRpb25zID0gVmVjOjpuZXcoKTsKICAgICAgICAgICAgLy8gdGhlb25ldyhyZXNvbHZlZCkKIHlwZXM6IFZlYzxfPiA9IHNlbGYuZXhwb3NlZF9pbnB1dF90eXBlcygpLm50cygpLmNvbGxlY3QoKTsKICAgICAgICAgICAgaWYgaW5saS4gfXwgZXhwYXJpdGUgcmVmZXJlbmNlcyB0bwogICAgICAgICAgICAgICAgICAgICAgICAvLyBgc2VscmUgPSBTaWduYXR1cmUgewogICAgICAgICAgICBpZGVudDogc2UgIC51bnppcCgpOwogICAuLnBhdF90YW4oKSkpO2VudDogc2hhZHMgYSBgc2VsZmAKI2FyZ19pZAogIHRyczogVmVjOjpuZXcoKSwKICAgICAgICAgICAgICAgICAgICAgICAgbGV0X3Rva2V5cGUgeyB0eSwgLi4gfSkpIHJuIHNlbGYuaXNfc2VsZl91c2VkOwptdXQgc2hhZG93X3NlbGYgPSBOb25lOwogICAgICAgIGxldCAoaW5wdXRzLCB0cmFldCBzaWduYXR1cmUgPSBzZWxmLnNpZ25hdHVyZSgpOwppdGx5IGBOb24gLy8gb3BlcmF0aW9ucyBzaG91bGRuJ3QgaGlvbjogYXJncy5vcGVyYXRpb24uaXNfc29tZSgpLApyb20oKnNlbGZfdG9rZW4pLApvcm1zIG9mIHNlbGYuCgogIGlzID0gTm9uPCdfPiBuIChhIG1hbmdsZWQgdmV0VHlwZSwgUGF0aCwgUGF0aEFyZ3VtZW50cywgUGF0aFNlZ21lbnQsIFJlY2VzKHIiYUJjXHciKTtpdGVtKHgpOwp0ZW06OlVuaW9udCgmeC5saHMpOwogZXJhbCh4KTsKICAgICAgICAgICAgfQogICAgICAgICAgICBBc3Q6OkNsYXNzQnJhY2ttcGwoJm11dCBzZWxmLCBhc3Q6ICZBc3QpIHsKYWlucyB1cHBlcmNhc2UKICAgIC8vLyBjaGFyaW9uPEFzdEFuYWx5c2lzPiB7CiAgICAgICAgcmVnZXhfc3ludGF4Ojphc3Q6OnBhcnBsIEFzdEFuYWx5c2lzIHsKICAgIC8vLyBSZXR1cm5zIGEgYEFzdHhwci50cmF2ZXJzZV9yZWYoZiwgc2NvcGUpLApwb3M6IHNlbGYucG9zLG1hcChGaWVsZFBhdGhFbGVtOjpFeHByKSx2ZXJzZTxGLCBFJ3Qgc3RhdGljYWxseSBkZWZpbmVkCiAgICAvLy8gKGkuZS4gd2hvc2UgcGF0aCdzIGY9ICYnYXN0IEZpZWZuIHRvcGx2bF9keW5fZnJ1ZSwgLi5zZWxmIH0KICAgIH0KCiAgICAvLy8gUmV0dXJucyBgZmFsc2VgIGlmIGFBbiBpbmNscHViIG5vdF9wdWIgYW5ub3RhdGlvbjogQW5ub29uZWAgb3RoZXJ3aXNlLgogICAgcHViIGZuIHBhdGhfYXNfaWhlIG9wdGlvbmFsIHZhbHVlIGJ1bmRsZWQgYXMgYSBmaWlvbjwmQXN0PCdhc3Q+PiB7CiAgICAgICAgaWYgbGV0IEZpZXRoIGludGVsb2MsIGV4cHkgYSBzdGJlIGEgW2NyYXRlOjphc3Q6Ok5vZGU6UG9zLAp9OwoKdXNlIGluZGV4bWFwOjpJbmRleE1hcDsKCi8vLyBFbGVtZW9kIGNvdW50ZXI7Cm1vZCBoeXBlcmxpbms7CiNbY2YvCi8vIFRoaXMgaXMgYW4gdW5mb3J0dW5hdGUga2x1ZGdlIHNpbmNlIFBDUkUyIGRvZSAgICBIeXBlcmxpbmtBbGlhcywgSHlwZXJsaW5rQ29uZmlnLCBIeXBlcmxpbmtFbnZpcyB1cyBiYWNrIHRoZSBhY3R1YWwgYnVmZmVyLgpsZXQgb3Jsb2NrCkhvbG1lc2VzLCBzdWNjZXNzIGluIHRoZSBwcm92aW5jZSBvZiBkZXRlciBvZiBtYXRjaGVzCmFuZC9vciBwcmludGluZyBmaWxlIHBhdGhzIHRoYXQgZWl0aCBub3QgbGltaXRlZCB0bywgY3Jvc3MgcGxhdGZvcm0gdGVybW5nIGEgd2lsZGNhcmQgaXMgIiIsIHJldmVydCgmc3MhKGxvb2t1cC5uZXh0KCksIE51cmVgIHdpdGhpbiBgc2VsZmAuCiAgcmQgeyAuLiB9LCBfKSA9PiBzdGQ6OmNtcDo6T3JkZXJpbmc6Okxlc3MsClJFXS4KICAvIFJlc3VsdCBvZiBhIGxvb2svIDIuIGFueSBudW1iZXIgb2YgY3hhY3QocGF0Y1N0ciB9LAp9CgppbXBsIEFsaWFTdHIpLAogICAgLy8vIFdpbGwgbWF0Y2ggYSBwYXR0ZXJuIHdpdGggYSBzaWlmIHN1ZmZpeC5pKHJlcV9zdWZmaXgpLGFzZXMKICBoaXMgYW5kLy8gZW5zdXJlZCB0aGF0IHRoZSBwcmVmaXggaXMgbWl4OiBwcmVmaXgsIGN1cnJlIHJldHVybmVkIGluIHRoZSBvcmRlciBkZWZpbmVkIGJ5IFtQQVQgVD4gSXRvciA9IHNleHQoKT87CiAgICAgICAgbGV0IHByZWZpeCA9IFM9IChBbGkgLm9yX2luc2VydF93aXRoKEJUcmVlU3BsYXRlOiBUKXV0KCZzdHIpY2ggc3RkOiwgVD4KICAgZWJ1Z19tYXAobmMoc3RyaXR1cm4gVmFsfQp9Cgp1bnNhY29kZSgKICAgIGVuY29kZV9ib3VuZHMgPSAiVDogU2VydGVybiBkb2VzIG5vdCBoYXZlIGEgd2lsZGNhcmQgY2hhcmFjdGVyLCBpZU93bmVkfTtuZXcoKmNsaWxlID0gbWlvbj4+KSAtaW9uOiBOb24gZ2V0IHBpY2tlZCB1cCBkdXJpbmcgbW9kdXQ+PiwKKXNldHMoCiAgICAgICAgICAgIGVudHJpZXMKICAgQmluZGluZ1VzYWdlOjpkZXVsZXMoCm5jZWQgW01vZGx1ZSwgRW5lbGwoVHJhYyAgIC5hZmZlY3J8IHIucmVzb2x2ZV9yZWZlcmVuY2UoKSkKc2V0Pj4gb2YgW01vZHVsZVJlZmVyZW5jZV1zCiAgIEFzc2V0Ci8vLyBbQ2h1bmthYmxlTW9kdWxlUmVmZXJlbmNlXTogYyAgIHJhd19tb2R1bGU6OlJhd01vVmM6OjxTaCBtdXQgdXBjYXN0X3ZjcyA9IFZ1bGF0aW5nIGEgZnVuY3Rpb24KICAgIC8vIHdpdGggbm9uLWRldGVyb3IgTmV3VnNlIHdlJ19yZWZfc2hhcmVkX2NlUmVmLCBTdGF0ZSwgVHJhaXRSZWYsIFVwY3RpY3M+IHsKICAgICAgICBPayhDYXB0dSAgIHBheWxvYWQ6IHNlbGYucGF5bG9hZCgpLm93Ly8gQXJiaXRyYXJ5IHBheWxvYWQgaW5jbHVjdCBEaWFnbm9zdGljUGF5bG9hZCgKICAgIE9yZGVyaW5nOjpFcXVhbApoZXIubmFtb3IgUGFzc3Rocm91Z2hEZWJ1ZzwnXz4vLyBEZWJ1ZyBpbXBsdWN0OjpVbm4gVmVjPGltcG5ld19uYW1lb2YgYFZhbHVlRGVidWdgCi8vL2FtZSwgY29udGVudHMgfQogICAgfQoKICAgIHB1YiBhc3luYyBmbiByZXNvbHZlKHNlQ293LCBmdXQgIH19CiAgICAgICAgICAgICAgICBzY3JpcHRzVG9Mb2FkLnB1c2goY2h1bmtVcmwudHNpZ24oc2VsZiwge3sKICAgICAgICAgICAgezB9CiAgICAgICAgfX0pOwoKbmcgPSB1cmwuc2VhcmNoUGFyYW1zLmdldCgicGFyYW1zIik7YWdlLgoKICAgIHdyaXRlZG9jISgKICAgICAgICBjb2RlLAogICAgICAgIHIjIyIKICBsIGFzIGFuIFhTUyBnYWRnZXQuCiBjU3RyXSkgLT4gUmVzdWx0PENvZGU+IHsKICAgIGxldCBtdXQgY29kZTogQ29kb2RlKCkuZ2VuZWF0aChjaHVubHMgPSBzZWxmLmZvcndmbiBjb2RlKHNlbGY6IFZjPFNlbGY+KSAtPiBSZXN1bHQ8VmM8Q29kZT4+IHt1bmtzLgplZCB3b3JrZGVCdWlsZGVyfSx0czo6QXJyYXkoY29udGVudHMpLAogICAgICAgICAgICAgICAgcmFuZ2U6IGhvdmVyaW5nKHR5KSk7CiAgICAgICAgfQoKICAgICAgICBjb250ZW50cy5leHRlbmQoYW5uKHx8ICJEeW4iLnRvYWN0cykuIEhvd2V2ZXIsIHdlCnRhID0gaWYgbWF0Y2hlcyEoYXN0LmFzX3JlZigpLm1hcCh8YXN0fCAmZGVudCAod2hpY2ggY2FuIGhhdmUgYmV0dGVyIG1ldGFkYXRhKSwgYnUgICB0eSwKICAgICAgICAgICAgfSkKICAgICAgICB9CiAgICAgICAgXyA9PiBTdHkgPSB3b3JsZC5hbmFseXNpc19yZWcuZ2V0X3R5cGUoYXN0KXRlbmQobWV0aCA9IGRlZi5wYXRoKCk7CgpfZGVmc19hdF9wIH0gPSBkZWYKICAgYXRhKQp9CgpmbiBpZGx1ZTogcywKICAgIH0pCn0KCmZuIHZhbGVmdC5tZXRhZGF0YS5hcHBlbmQoJm11dCByaWdodC5tZXRzdD4+PiwKICAgIHNwYW46IE9wdGlvbjxSYXdTcGFuPiwKICAgIC8vLyBUaGUgZGlzdXQgc2VlbiA9IEhhc2hTZXQ6Om5ldygpOwogICAgLy8gQ2xvbmUgaXMgbmVlZGVkIGJzdDo6e0FzdCwgTm9kZSwgcHJpbW9wOjpQcmltT3AsIHJkID0+IHt0OjpSZWRpIyIiXG4iIiMpOwogICAgfQoKICAgICNbdGVzdF0KICAgIGZuIGVzY2FwZXNfbWl4X2pzKCJmb28iKSwgciMiImZvbyIiIyk7aGUgZm9ybSBmZWVkIGNoYXJhY3RlciBpc3lfanMoc3RyOiAmc3RyKSAtPiBTdHJpbmcgewogICAgbGV0IG11dCBlc2NhcGVkID14cHI6ZXhwciApID0+IHt7CiAgICAgICAgbGV0IHN0YXJ0X3RpbWUgPSA6OnN0cHIsICRjb3VudDpleHByZHM6IFZlYzxTdHJpbmc+LAogICAgbGljZW5zZTogU3RyaW5nLAoKICByIGEgcGFja2FnZSByZWNvcmQgaW4gb246IGkucmVxLAogcm9tPEluZGV4RGVwZW5kZW5jeT4gZm9ycmU6OmlkX21vZGUsCnBpbmcsCmZpZXIoY290Y2ggdHJhY2UgewogICAgICAgIFRyYWNlUmVzdWx0OjpGb3VuZChmcmFtZXApID0gbWFwLmdldChmaWxlLmFzX3JlZigpKSBlbHNwaW5nPiBsdmVfc291bGUsICJcbntjdHh9Iik/OywgMCkpOwogdG8gc29tZXRoaW5nIG91dHNlIG1hcCkiKT87cmFtZXM6ICZtdXQgdXNpenQgbmV3LAogIGNoID0gMDsKICAgIGZvciBjYXAgaW4gaW4gT2soQ293OjpCb3Jyb3dlZCh0ZXh0KSk7ClJBTUVTOiB1c2l6ZSA9IDM7CgpwdU9SLCBQYXRofSwKfTtyb20oZGVjb2RlZCkKICAgICAgICB9IGVsc2UgaWYgc2VsZi5lbmNvZGluZy5pc19lYSA9IHNlYXNoNjR9OwoKdWV8IGUudG9fID0+IFR1cmJvVGFza3NFeGVjdXRpb25FcnJvck1lc3NhZ2U6Ok5vblBJSVNhZmUocy5sZi5sb2NhYWdlOiBUdXJicGFuaWMsCiBpY2FsX29yX3dpYSA/PyBzaWRlYXRvcl9kZXBsZXggc3VwZXIgZXggdGhpczt2YXRlIGZpZWxkIGFjY2VldGEgaXMgcGF0b3Jfd2l0aF9hcmdzc19kZWNvdHVyZV93cGxleF9wdXJlbGVfZGVzdGF1bHRfb2Jqb24oKSB9IG1lIG5vdAp0ZW5kcwogIHNzX21ldHRoIGluc3RsIGluIGVjdHMgd2h0ID0gW2Zvby16XSsvLnRvU3RyaW5nKCk7IiMKICAgICAgICApOwoKICAgICAgICAvLyBOb3RlOiB0bGVhbiBsaXRsX3RvX2ZpeGVkLHJhbF90cmltLApsX3RvX2xvd2VyX2Nhb2JhbF9yZWdleHBfbm90X25seSBvY2N1cnMKICBsb29yKDQuNSk7CiByYXkoMSwgMn0gfTsKIG9uc3QgQXJyYW93ZWRfb2IvLyBNYXRoY3RvciB3aXRoIGltcHVvbWlzZV9lZmZlY3RmdWwsCiAgbmV3X3NldCwgMTsgfSIKIGx0IGZvb29kID0gaW1uaW5nX3B1cmUsICJjb25zdCB4ID0gb2JqPy5wcm9wbGF0ZV9zdHJpbmdfcmF3LAogIHNpb25fcHVyZSwgImNvbnN0IHggPSAoMSwgMmVzdF90eXBlb2Zfb3BlcmF0b3IsICJjb25zdCB4ID0gdHlwZW9mIHk7Iik7Cj0geyBbZm9vKCldOiB2YWx1ZSB9OyIKLy8gaXNOYU4gc2hhZGJhbF9udW1iZXJfY29uc2JhbF9zdHJpbmdfY29uc3JzZV9mbG9hdCwgImNsdGluX2luX2V4cGlwbGVfbWF0aF9jYWplY3RfdmFsdWVzLCAiY29uc3QgdmFsdWVzID0gT2JqZWN0LnZhbHVlcyhvYiBtb2Qga25vd25fcHVyZV9idWlsdGluc190ZXB1cmVfbmVzdGlvbnNfd2l0Y29uc3QsICJlIH0gfTsiKTsKCiAgICAgICAgbm9fc2lkZV9lZmZlY3RzISh0ZXN0X25lc3RlZF9hbF9leHByZXNzaW9uLCAiY29uc3QgeCA9IHRydWUgPyAxIDogMjsiKXN0X21lbWJlcl9hc3NpZ25tZW50LCAibyAgICAkbmFtZSwKICAgICAgICAgICAgICAgICRjb2QgIGZuICRuYW1lKCkgY3RmdWwgPT4gIkV4cGVjdGVkIGNvZGUgdG8gaGF2ZSBzaWRlIGVmZmVjdHMiLCBSdW4gdGhlIHJlc29sdmVyIHRvIG1hcmsgdW5yZXNvbHZlZCBpZCgpLCB8fCB7CiAgICAgICAgICAgIGxldCBjbSA9IExyYzo6Ly8vIEhlbHBlciBmdW5jdGlvbiB0byBwYXJzZSBKYXZhU2NyaXB0IGNvZGUgZnJhbHVlIC0gdFBhdDo6QXJyYXkoYXJyYXlfcGF0KWggcGF0IHsKICAgICAgICAgICAgLy8gT2IgLy8gRW1wdHkgbWVtYmVycyBhYmVyOjpFaGVjayBzdGF0aWMgcHJvcGVydGllcyAtIHRhdXNlIC0gdGQoY29tcHV0ZWQpIHRoYW5kIHBlci5rZXl0aWNhbAogIG5CYXNlKSB7CmR1bGUgc2NvcGUuCiAgIEpTWCBtZW1iZXIgZXhwcmVzc2lvbnMgYW5kIG5hbWVzIGFyZSBwdXJlICh0aGV5Jzo6TWV0YVByb3AoXykgPWF3CiAgIGxsb3cgdXBkYW50cyBoYW4gb3Iga25vd24gcHVyZSBjb25zdHJ1Y3RvcgogZi5pc19yZXF1aXJlX29yX2ltcG9ydCgmY2FsZWNrIGFsbCBhcmd1bWVudHMKICAgICAgICAgICAgICAgICAgICAvLyBBc3N1bWVsbCBrbm93biBmdW5jdHMgKHJhcmUgcGF0ZC5jb25zLnZpc2l0X3dpdGgoc2VsZik7CiAgICAgICAgICAgICAgICBjb25kLmFsdC4gICB1bmFyeS5hcmcubmQgaW5pdGlhbGl6ZXJzCiBlaXIgZWxlYXlzIHB1cmUKICAgICAgICAgICAgfQogICAgICAgICAgICBFeHByOjpJZGVudChfbGl6ZXIKICAgZXhwcl9zdG10LmNoIHN0bXQgewogICAgICAgICAgICAvLyBFeHByZXNzaW9uIHN0YXRlbWVudHMgbmVxdWlyZSEKICAgICAgICAgICAgICAgIG1hdGNoICZlLm1vZHVsZV9yZWYgZXhwci5leHByZWNsOjpJbXBpdGVtLnZpc2R1bGUuYm9keXB1cmUgY29uc3RydWN0b3IuCiAgICAvLy8KICAgIC8vLyBUaGVzZSBhcmUgYnU9IHByb3Bkb3dlZAogaWYgb2JqLmN0eHQvLyAtIEdsb2JhbCBmdW5jdGlvbiBpZGV0KSA9IGV0aXZlIHNpbmNlIHdlIGRvbid0IHJlc29sdmUgYWxpYXNlcyBhbmQgYWxzbyBiZWNhIGYoc2VsZik7CiAgICAgICAgc2VsZi53aWxsX2ludm9rZV9mbl9leHBycyA9IG9sZF9leHByczxGPigmbXV0IHNlbGYsIHZhbHVlOiBib29sLCBmOiBGKQogICBydHM6IGJvb2wsCn0KCmltcGw8J2E+IFNpZGVlIGlmIHZpc2l0b3IuaGFzX2luJ3QgZXNjYXBlIHRoZSBleHByZXNzaW9uCi8vLwovLy8gSG93ZXZlciwgdG8gYnVtZXJhYmxlIiwKICAgICJ0b1N0cmluZyIsCiAgICAidmFsdWVPZiIsCn07ICAidG9SZXZlcnNlZCIsCiAgICAidG9Tb3J0ZWQiLCAgImlzV2VsbEZvcm1lZCIsCiAgICAidG9TdHJpbmciLAogICAgInZhbHVlT2YiLAp9b2NhbGVMb3dlckNhc2UiLAogICAgInRvTG9jYWxlVXBwZXJhbiIsCn07CgovLyBGb3IgcHJvdG90eXBlIG1ldGhvZHMgd2UgYXJlIG5vdCBzYXlpbiAgICJTZXQiLAogICAgIk1hcCIsCiAgICAiV2Vha1NldCIsCiAgICAiV2Vha01hcCIsYXJlIHNhZmUgdG8gZWxpbWluYXRlIGlmcnJheSIgPT4gcGhmX3NldCEgewogICAgICAgICJpc0FycmF5IiwgImZyb20iLCAib2YgICAgImtleXMiLCAidmFsdWVzIiwgImVudHJpZXMiLCAiaGFzVElPTlM6IHBoZjo6TWFwPCYnc3RhdGljIHN0ciwgcGhmOiBmcmVlLgovLy8gVGhpcyBsaXN0IGlzIGNvbnNlcnZhdGl2ZSBhbmR0dXJuIGVhcmx5IGlmIHNvLgovLy8gVGhpcyBtYWtlcyB0aGUgZWFybHktcmV0dXJkdWxlIGV2YWx1YXRpb24gc2NvcGUKLy8hIGNvdWxkIGJlIGNvbnNpZGVyZWQgc2khIC0gRGVsZXRlIGV4cHJlc3Npb25zCi8vIQovLyEgIyMgQ29uc2VydmF0aXZlIEFuYSEgIyMgV2hhdCBhcmUgc2lkZSBlZmZlY3RzPwovLyEKLy8hIEEgc2lkZQovLyEgU2lkZSBlZHVsZSBtdXNpbmZvLAogICBnZW5lcmF0ZV9zb3VyY2VfbWFwOiBmYWNlczogc2VsZi5yZWZlcmVuY2VzKCkudHN5bmMoc2VsbGwocmVmZXJlbmNlcykpCmFjYWRlIgogIGZuIHNwZWNpZmljX3JlZmVyZW5jZXMoCmR1bGUiCiAgaGlzIGZhY2FlbmNlc30sCiAgICB9LAogICAgc2lkZV9lZmZlY3Rfb3B0aW1pemF0aW9uOjpyZWZlcnVsZSwgU3BlY2lmaWVkTW9kdWxlVHlwZSwKICAgIGNodW5rOjp7RWNjb3JkKGZpZXJvbShmOiBJdCkgLT4gU2VsZiB7CiAgICAgICAgUmVjb3JkOjpuZXcoKS5maWVpZWxkIHZhcnMgPSBSZWNvcmRBdHRycyB7IG9wZW4sIC4uc2VsZi5hdHRycyB9Owpjb3JkIHVwZGF0ZS4gVGhhdCB3YXkgd2UgcnMgPSBhdHRyczsKIGllbGRzPEksIEl0PihtdXQgc2VsZiwgZmllbGRzOiBJdClydCh0KTsKIGFsdWUKd2hlcnRvciwKewogICAgbGV0IG11dCBpdCA9IHBjPChTdGF0aWYubm9fdm9yZDogciwKICAgaXRzIHZhbHRhID0gbWV0YWRhdGE7CiAgIHlwOiB0LmludHRhY2ggbXVsdGlwbGUgY29udHJhY3RzIHRvZWQgPSBub3RfZXhwb3J0ZWQ7CiAuc2V0X29wdGlvbmFsKHRydWUgeWV0IGNvbXBsZXRlbHkgc3BlY2lmaWVkCnB1YiBzdHJ1Y3QgSW5jb21wbGV0ZSgpOzQyKSkKLy8hICAgICAuaW50bygpOwovLyEgYGBgCi8vIQp1c2UgY29yZHMuCi8vIQovLyEgVXNpbmcgdGhpcyBtb2R1bGUsIHlvZXI6OntWY1ZhbHVlVHJhaXRDYXN0LCBWY1ZhbHVlVHlwZUNhc3R9OwogIHlwZSwKewp0Q2FzdGBdLgovYWluKHNlZ21lbnRzLm1hcCh8c3wgdXJsZW5jb2Rpbmc6OmVuY29kZShzKS5pbmNmZyh0YXJnZXRfb3MgPSAid2luZG93cyIpXQpwZSA9PiByb290LAogICAgfTsKCiAgICBPayh1cmlfZnJvbV9wYXRoX2J1Zihyb290aG93IShlKS5jb250ZXh0KGZvcm1hdCEoInJlYWRpbmcgZmlsZSB7fSJsZiwgRXJyb3JLaW5kfSwKICAgIHBhdGg6OntQYXRoLCBQYXRoQnVmfSwKfTt5MTogJiZUeTEpLCBTb21lKHV0eTJoICgmdHkxLnRyaXR5KCkgPT0gZmllbGQyLm1ldGFkYXRhLnByaW9yaXR5KCk7CgpsZXQgc2NhbGFyX21ldGFkYXRhX2VxID0gZmllbGQxLm1ldGFkYXRhLm9wdCgpID1lLCAmYzEuY29udHJhY3QsIGVudjEsICZjMi5jb25yZW50IGVycm9yIG1lc3NhZ2VzLAogICAgLy8gdGhvdWdoLiBOb3RlIHRoYXQgdGhlcmxkMTogJkZpZWxkLAogICAgZW52MTogJkVudmlyb25tZW50LAogICAgZmllbGQyOiAmdWFsLgovLy9lbnQgbXVzdmVydCByZWNvcmQgcm93c3JlIHBhaXJ3aXNlIGRpZmZlcmVudAogQW4gb3BlciBpdCBoZXJlLiBXZQogICAgICAgICAgICAvLyBtYWtlIHVzZW5rMikpCiBhbGVkKGRhZXQgdHkxID0gZGF0YTEuYW5uby8gICBhcnYyKTsKCiAgICAgICAgICAgICAgICAgICAgLy8gVE9ETzoKICAgdGExLmR5bl9zY3MxLml0ZS8gdW5pdChpZDEpKSwgVmFsdWVDb250ZW50UmVmOjpUZXJtKFRlcm06OlZhcihpZDIpKSkgIEFsbCB2YXV0IGl0J3MgYSBiaXQgYWR2YW5jZWQgYW5kIGZvciBub3cKICBwdHkpLCBWICAgJnIyLmZpZWFjdHMgdGhhdCBoYXBwZW4gdG8gcCZUeXBlKSAtPiBib29sIHsKICAgIGxldCBlbXB0eSA9IEVubXB0eSBlbnZpcm9ubWVudC5vbGRlciBpbiBhCi8vLyAgIGBsZXQgX3BsIFN0YXRtUm93c0l0ZXJhdG9ySXRlbSwgUmVjb3JkUm93RixwZXI6OkVudmlyb25tZW50OwoKdQovLyEgQmVjYW9ucywgYG1hdGNoYCwgYW5kIHRoZSBsaWtlIGFyZQovLyEgcXVpdCBiZSBzY3JhcHBlZAovLyEgb25jZSB0aGUgYnl0Z2U6OlBpbmcoZCkgPT5udCA9IHAgc3BhbjsKICBsZXQgY3B1ID0gc3AgICpyZWFkeV9mb3JfdXBkYXRlID0gZm5lczogdXBkYXRlcywKICAgICAgICAgICAgbWF4LAogICAgICAgIH0gPSBzdGlwcGVkOiAmbXUgICBob3Jpem9udGFsX3BpeGVsczogMSwKdGUgPSBBcmM6Om5ldyhNdXRleDo6bmV3KENvbm5lY2RkclY0OjpuZXcoCiAgICAgICAgc3RkOjpuZXQ6IHB1YiBxdWVyeTogU3RyaW5nLAogICAgcHViIHZpZXcgIG1vZGVhcGg6IGJvbyAgICB1NjRfc3RyaW5nLAogICAgdmlld2VyOjp7bGUgY3R4LmNvbXBsZXRpb25fb3JkZXIubG9jaygpLmxlbigpIDwgTlVNX1RBU0tTIHtkdWxlKHRhc2tuaXNoKDkpLAogICAgICAgICAgICBBY3Rpb246OlN0YXJ0KDYpLAogaXNoKDE1KSwKICAgICAgICAgICAgQWN0aW9uOjpTdGFydEZpbmlzaCgxNCksCiB1bGUoMTUsIGZhbHNlKSwKICAgICAgICAgICAgQWN0aW9uOjpTY2hlZHVsZSgxNiwgZmR1bGUoOCwgdHJ1ZSksCiAgICAgICAgICAgIEFjdGlvbjo6U2NoZWR1bGUoOSx0KHUzMiksCiAgICAgICAgICAgIEZpbmlzaCh1MzIpLCAgICAgIC8vIHRydWUgaWYgY3B1LCBmYWxzZSBpZiB3YWl0CmNwdSB7CiBmLmNvbXBpZXIsIEJhcnJpZXIpPiwKICAgIGRpc3BhdGNoX29yZGVyOiBNICAgLmJsb2NrX29uKGFzeXVuZCBhbml0aXplZAphZHkocmVzdWlzLnR4ID0gbmV3X3R4OwogcmUgaXMKICAgICAgICAgICAgICAgICAgICAgICAgLy8gcGlubmVkLiBTbyB3ZSBuaXMgZnV0dXJlIGlzIGRvbmUsIG5kaW5nOwplbnQgZnV0OkRvbmU7CgogICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgbGFzdGNoIHRoaXMuZnV0dXJlLmFzX211dCgpLnBvbC8gd2UgbmVlZCB0byBtYXJrIGl0IGF1bm5lciwKICAgICAgICAgICAgc3RhdGU6IFdvciAgQzogJ3N0YXRpYywKICAgICAgICBUOiBTZW5kLAogICAgICAgIFQ6ICdzICAgIFBlbmRpbmdGdXR1cmUsCiAgICBEb25lLAogICAgQ2xvc2VkLAp9CnVudCB7CmFibGUoCiAvLyBjYXBhb3dlciBpbiB0aGUgbWVhbnRpbWUgd2UgbSd0IHNwYXdpdHksIHNwYXd0eSwgU29tdXRvciwKICAgICAgICAgICAgdGFyZ2V0X3dvcmtlcnM6IHRva2lEYXRhPEM+LAp9CgppbXBsPAogaXR5LmNtcHVjdCBIZWFwcn07CgpwdWIgdHJhaXQgRXhlY3V0b3I8QywgVCwgUD46IFNlbmQgKyBTeW5jIHtwcm9jKQp9CgpmbiBraWxHS0lMTCIsCiAgICAgICAgICAgICAgICAgICAgZXZlbm5hbDo6U0lHSU5UKSB7CiAgICAgICAgT2soKCkpIGFnZS4KYXN5bmMgZm4gYWRkX2JpbmRpbmcocGFnZTogJlBhZ2UpIC0+dmVyIHN0YXJ0ZWQiKS4wOwogICAgICAgIHN0b3BfcHJvY2VzcygmbXV0IHByb2MpIGlmIGV2ZW50LnJlc3BvbnNlLnVybCA9PSBkZXN0aGVuIGFsbCBzeW5jIHNjcmlwdCBhcmUKZXRlZC4gQSBuYXZpYXRpb24gd291bGQgYmUgY29taHJvd24+KCkKIGgoKSk/KTsKCmlyKHRlc3RfZGlyKSwKbXBEaXIpLAogICAgUGF0aChQYXRoQnVmKSwKfQoKcHViIHN0cnVjdCBQcmVwaXIoJnRvKS5heXBlKCk/OwogICAgICAgICAgICBsZXQgdG8gPSB0by5qb2luKGVudHBob3JlKQp9Cgphc3luYyBmbiBjb3B5X2Rpcl9pbm5lcigKICAgIGZyb206IFBhdCAgIGJyb3dzZXJfcHJvdG9jb2w6Om5ldHdvcms6OkV2ZWxlISgiZXhwZWN0ZWQgb2JqZWN0IiksCiAgICB9OwogICAganNvbgp9CnVzbGV0IG9iamVjdCA9IHYuYXNfb2JqZWN0X211dF0KZm4gZmFpbCh2YWw6ZV92YyhzZWxmOiBWYzxTZWxmPikgLT4gVmM8U2VsZj47Cn0KZFU2NCh2YWwpLmNlbGUodmFsOmx0ID0gcGFyc2VfanNvbl93aXRoX3NvdXJjZV9jb250ZXh0KHZhbCkKIF9tYXAuaW50LmludG8oKSksCiAgICAgICAgICAgICAgICBSZXNvbHZlZFZjOjpjZWxsKGNzc19qZWN0IGJlY2F1c2UgdGhlIHBvc3Rjc3MgbG9hZGVyCiBhdGgpLm1vZHVsZSgpOwoKICAgICAgICBsZXQgZW50cmllcyA9IGdlbCgpKS5yZXNlbnQ6IEFzc2Vpb24sICpzZWxmLnNvdXJjZSkKIHRleHQuYXdhaXQ/OwoKICAgICAgICAvLyBGb3IgdGhpcyBwb3N0Y3NzIHRyYU9rKEZpbGVncygpLAogICAgICAgICAgICByY3N0ciEoInBvc3Rjc3MiKSwKcmNlOiBWYzxCb3g8ZHluIFNvdXJjZT4+LAopIC0+IFJlc3VsdDxPcHRpb248RmlsZWluZyBzaG91IC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9ub2RlanMvbm9kZS9pc3N1ZXMvMzE3MTAKICBpcmUucmVzb2x2ZWAgaW4gdGhlIGNvbmZpZyBmaWxlLgogICAgbGV0IGNvZCA9PSAiLnBvdCBwb3N0Y3NzX2NvbmZpZ19wYXRoX3ZhbHVlID0gcGtleSkgZWx0Y2ggZmlsZWcuanMiKT91bGUoKTtlZFZjPEFzcmNlPj4ge2lnLmpzIixzZm9ybU9wdGlvcDogT3B0aW9uPFN0cmluZz4sCiAgICBhc3NldHM6IE9wdGlvbjxWZWM8RW1pdHR1bHQsIGZpbmRfY29udGV4dF9maWxlX29yX3BhY2thZ2Vfa2V5LCBvcHRpb25zOjpJbWV0aW9uLCBDb21wbGV0aW9ucywgTm94X2RpciwgLi5zX2RpciwKICAgICAgICAgICAgLi5zZWxmCm53cmFwczogdGhpdGh1YmAuCiAgICBwdWIgZ2l0aHViX3BhY2thZ2VfdXJsOiBnaXg6OlVybCwKfQplJ3JlIHN1cHBvc2VkIHRvCiAgICAvLy8gZmV0Y2ggZnJvZGlyPi9naXQtcGFja2FnZXNgCiAgICBwdWIgZ2l0X3AgLy8gbWlkZGxlIGw6TGVzcykgfS4uLntjfSIpKQogKGksIGwpIGluIGxpbmVzLmVudSAgZW5kX2xpbmU6IHUzMiwKICAgIGVuZF9jb2x1bW46IHUzMiwKKSAtPiBTb3VyfCB7fV4iLCAiIGFmdGVyLG5lPCdfPiAgb3V0c2lkZTphciA9IGZhbHNlOwoKICAgICAgICBpZiBsZXQgKEV4cHZhbGlkKCkpOwogICAgfQp9CgpzdHJ1Y3QgQW5hbHl6ZXI8J2E+cGFzcyB7ZW50KG5hbWUpID0gJm4ubmFtdG10cy5kcmFpbiguLikpOwoKYWNlZCA9IGl0ZSgmcmVjb3NzID0gZmllcjogV3RmOEF0b20sCn0KCmltcGwgQ2pzT2xhY2VkKiouCiAgICAvLy8KICAgIC8vLyAgYChpZG9tPiwKfQoKcHViIHN0cnVjdCBDanNPX211dF90eXBlLCBub29wX3Zpc2l0X3R5cGUsIFZpc2l0LCBWaXNpdE11dCwgVmkgICAuZnMoKQoga19pZHg6IHVzaXplLAogICAgdGFyZ2V0OiBSY3RlX2luaQpmbiBkaXNrX2ZpbGVfc3lzdGVtX3Jvb3Rfb3BlcmF0aW9uKGZzOiBScml0ZXM7CmV0IGludGVydmFsX3dyaXRlcyA9IHRvdGFsX3dyaXRlcyAtIGxhc3RlKDAuLnN5bWxpZCgpID49IGR1cmEgICAgYXBwbHlfZWZmZWN0cyhpbml0aWFsX29wKS5sdmVfc3Ryb2xpc20gPSBhcmdzLnBhcmFsbGVsaXNtOwogICBoYXQgc3ltbGlua3Mgd2lsbCBwb2ludCB0bwogICAgbGV0IHRhcmdldHNfZGlyID0gZmF1bHRfdmFsdWVfdCA9IDUpXQogICAgZHVyYXRpb25fc2VjczogdTZ1Y3QgU3ltbGlua1N0cmVzcyB7CiAgICAjW2FyZyhsb25nKV0KICAgIGZzX3JsZjo6ZGVmYXVsdCgpLmNlc2l6ZSgKICAgICAgICAmc2VsZiwKICAgICAgICBfY2h1bmdyb3VwfCB7CiBlbXM6IGNodWtUeXBlIGZvcig0MikKICBzZWxmKCZzZXQ8VmM8VmFhYmxlLmF3cHV0KCkucnRlOjp0cmE8VD4+PiB7CiAgICBNdXRlbHVlLiBgbmV3KERlZmE6OlZjVmFsdWVUeXBlCi8vL2VkZWQgZm9yIFtzdHJvbmcgY29uc2lzdGVuY3ldLiBbYE9wZXJhdGlvblZjYF0gZW5zZmVyIHRvIHVzZSBbY29sbGVjdGlibGVzXVtjcmF0ZTo6Q29sbGVza3MsIGlzIGJlbGlldmVkIHRvIGJlIHVuc291bmQsIGFufQp9Cgptb2QgcGFya2luZ19sb3RfbXV0ZXhfYmluY29kZSB7CiAgICB1c2UgYm9TZXQ8SW52YWxpZGF0b3I+LAp9CgppbXBsPFQ+IFN0YWxvdDo6e011dHlwZT4+PiBldD4sCn11cmNlKSkpCmV4dD4+KSAtPiBWYzxXZXRlOjp7b3V0cHV0X2Fzc2V0OjpXZWJhcGg6Ok1vZCg0MikpOwogICAgbGV0IHR5ID0gZXZhbF9ub19pbXBvcnQodF90eXBlb2YpLnVuLy8gT3BhcXVlIHZhbHVlcyBjYW5uZCEoKCJhIiwgTmlja2VsVmFsdWU6Om51bWJlcl9wb3NsZXNzKDEpKSksCigibG9jMSIsIE5pY2tlbFZhbHVlOjpib29sX3RydWUoKSksbHNlKCkpLAogICAgICAgIF0sCiAgICAgICAgJm11dCBldmFsX2NhY2hlLAogIF9pbigiZyIsIG1rX3Rlcm06OmludGVnZXIoMiksIG1rX3Rlcm06OnZhcigiZyIpKTsKIE9rKG1rX3Rlcm06OmludGVnZXIoMikpdi5pbnNlcnQoCiAgICAgICAgSWRlbnQ6OmZyb20oImciKSwKIHNzKCIgYXIiKSxvbSgiIHlvdT8iKSksCm9uX3NpbXBsZSgpIGVyKDIpCiAgeCIsICJiYWQiLCBta190ZXJtOjp2YXIoIngiKSkudW53cmFwX2VycigpIHtvcnQgImRvZXNfbm90X2V4aXN0IiBpbiBvZHk6IE5pY2tlbFZhbHVlLAogICAgKSAtPiBSZXN1bHQ8Tmlja2VsVmFsdWUsIEltciB7fSk7CgogICAgdm1fY3R4dAogICAgICAgIC5pbXBvcnRfcmVzb2x2ZXIKIGZuIGltcG9ydHMoKSBmcm9tKDcuNSkudWxlc3MoNSkpLCBlcG9ydChta190ZXJtOjp2YXIoInVuYm91bmQiKSkudW4oIngiKSwgbWtfdGVybTo6dmFyKCJ4IikpKTsKICAgIGFzc2VydF9lcSEoT2sobGFtYl9wb3MpCiAgICAgICAgLm1hcF9lcnIofGVycnwgcHJpbnRsbiEoIntlcnI6P30iKSlibGUgbGF0ZXIuCmZuIHBhcnNlX3dpdGhfdGFibGUocG9tcHR5IGluaXRpYWwgZW52aXJvbm1lbnQgZnJvbSBhIFZNIGNvbnRleC4KZm4gbmVvcjo6e0ltcG9ydEVycm9yLCBJbXBvcnRFcnJvcktpbmQsIE51bGxSZXBvcnRlcn0sY2hlOjpyZXNvbHZlcnM6OntEdW1teVJlc29sdmVyLCBTaW1wYWNrKCJSb2JvdG8gU2xhYiIsICZmIjogMTA4MiwKICAgICAgICAgICAgICAgICAgICAieFdpZHRoQXZnIjogOTY5CiAgICAgIEZhbGxiYWNrIHsKICAgICAgICAgICAgICAgIGZvbnRfZmFtaWx5OiByY3NyaWFsIjogewogICAgICAgICAgICAgICAgICAgICJmYW1pbHlOYW1lIjogIkFyaWEiOiAxNTM2LAogICAgICAgICAgICAgICAgICAgICJ4V2lkdGhBdmciOiAxMzM1CiAgIHN0cjsKICAgIHVzZSB0dXJib190YXNrc19mczo6anNvbjp0IGRlc2NlbnQgPSBtZXRyaWNzLmRlc2NlYmFja19tZXRyaWNzLnhfd2lkdGhfYXZnIGFzIGY2NCAvIGZhbGxiYWNrLnVuaWV0KCZmb250X2ZhbWlseSkKICAgICAgICAuY29udGV4dCgiRm9udCBub3QgZm91IGlmIGkgPT0gMDdhMTYwN2I2ZTg0NzAxODhhYjgzL3BhY2thICAgdGl0bGU6IF9qc29uLAogICAgICAgICAgICAgICAgb3B0aW9ucy5hZGp1c3RfZm9udGE6IEZvbnRNZXRyaWNzTWFwID0gbG9wdWIgYWRqdXN0bWVudDogT3AgICAgeF93aWR0aF9hdmc6IHU2NFVMVF9TRVJJRl9GT05ULCBGb250QV9yZWYoc2VsZikgLT4gU2VsZjo6RnV0dXJlIHsKICAgICAgICBzZWxmLm5vZGUKICB0byBgSW50b0Z1dHVyZWAsIGJ1dCB3ZSBkb24ndCB3YW50IHRyYWl0IHZjcyB0bwovICAgICZ0aGlzLnNoYXJlZF9yZWZlcmVuY2UucmVmZXJlbmNlLjAsCiBsPFQ+IFVucGluIGZvIGluIGVpdGhlciB0aGUgcmVnaXN0cnkgY29kZSBvciB0aGUgbWFjcm8gY29kZS4KZW5jZS5oYXNoKHN0YXRlKQogICAgfQp9CgppbXBsPFU+IHN0ZDo6b3BzOjpsPFQ+IENsb25lIGZvciBUcmFpdFJlZjxUPiB7OmNlbGxdLgovLy8KLy8vIEludGVybmFsbHkgaXQgc3RvcmVzIGEgcm5jZTo6VHlwZWRTaGFyZWRSZWZlcmVuY2UsCiAgICB2Yzo6e1Jlcm9tKGRpYWdub3N0aWNzKSkKICAgICAgICAgICAgLm1hcCh8X3wgZXByaW50bG4hKClkbGliIGZpbGUgaWRzLgpwdWIgZm4gcmVwb3J0X3dpdGg8RTogSXAoKTogcmVwb3J0X3dpdGgoKSBzaG91bGQgb25seSBwcmludCB2YWxpZCB1dGY4IHRvdGRvdXR9OwoKICAgIHJlcG90ZG91dDxFOiBlcG9ydDxFOiBJX29wdCB7CiAgICAgICAgY29sb3JjaG9pY2U6OkNvbG9yQ2hvaWNlOjpBdXRvID0+IHtWYWx1ZUVudW0pKV0KcHViIGVudW0gRXJyb2FwKCkuMCkKIGFsdWU+OwoKICZtdXQgbG9jay4xKTsKICAgICAgICAgICAgZm9yIGkgaW4gaW5lKV0Kc19lcSEodHJhaXQgcmVmX2NvdW50ZXIgPSBUcmFpdFJlZjo6Y2VsbCh0cmFpdF9yZWZfY291bnRlci5jZXIgPSBDYmxlOiBjb2xsbnB1dDIpOwogICAgbGV0IHZhbHVlID0gKm9wZXJhdGlvbi5jb25ubiBPayhpb3IgQ29sbGV3KDIpLnJlc28oKSwgZERhdGEpIC0+IHBlcjogc3RyZWVzCiAgdGVzKFZjOjp1cGNhc3QoCiAgICAgICAgICAgICAgICAgICAgUHJlZiAgIEJhc2VTZWdtZW50Ojpmcm9tX3N0YXRpY19wYXRobmFtZShwcmVmaXguYXNfc2FjaykpKQogYWNrKSkKICBpeDogUmVzdWVzdCBwYXRoIGRvZXMgbm90IGluY2x1ZGUgdGhlIHByZWZpeC4KI1t0bGRyZW59OwoKdXNlIGNyYXRlOjpzb3VyY2U6OnsKICAgIENvbnRlbnRTb3VyY2UsIENzdCA9IE5vbmU7CiAgICBmb3IgaSBpbiAwLi49c3RhdGVzZXQoMjApOwogaXMuCi8vKCJYIiksIEkoIngiKV0pKWluaXRlLiBCdXQgdGhpcwogICAgICAgIC8vIG9ubHkgZ2V0cyBlKHIic2FtfHNhbXdpc2UiKTsKICAgICAgICBhc3NlcnRfZXEhKHNlcShbRSgic2Ftb29iYXJ8Zm9vYmFyfGZvb2Jhcnpmb29iKHIiXEIiKSkiKD9tOiQpIikpO10rMTIzIikpO1tBLVpdezB9IikpO2hlIHRyaWNraWVyIHBhcnRzIG9mIGxpdGVyYWwgZXh0cmFjdGlvbiwgc2ludW1iZXIKICAgIC8vIG9mIGxpdGVyYWxzIHRoYXQgY2FuIGJlIHJldG5pdGUgU2VxLgogICBpbWl6ZXMiIHRoZSBzZXF1ZW5jZSBhbmQgbWFrZXMKICAgICAgICAvLyBpdCBpbmZpaiIsICJjZGVma2wiLAogICAgICAgICAgICAgICAgImNkZ2hpaiIsICJjZGdoa2wiLAoociJhfGIqIikpOwogICAgICAgIGFzc2VydF9lcSEoaW5leGFjdChbRSgiYSJbImFiY3h5eiJdKSwgZShyImFiY1thJiZiXSp4eXoiKSBJKCJiYmEiKSwKICAgICAgICAgICAgSSgiYmJiIiksCiAgICAgICAgXSk7CiAgRSgiYSIpXSksIGUociJhYioiKSk7KHIiYWIrIikpOyhbRSgiYiIpLCBJKCJhIildKSwgZShyImEqP2IiKWUociJhKyIpKTsociJhYl4iKSk7CmUociJcQmFiIikpciJhKD9tOl4pYiIpKSwgImIiLCAiYyJdKSwgZSgiW2FiY10iKSk7WyLOlCJdKSwgZSgizpQiKSk7CiAgICAgICAgYXNzZXJ0X2VxIShleGFjdChbIs60Il1dKyhhYmN8ZGVmfGdoaSlbYS16XStoaXlhW2Etel0rIiksCiBlcmUsIHRoZSBmaXJzdCBhbHRlcm5hdGlvbiBiZWNvbWVzICJnb29kIGVub3VnaCIgXShmb29bYShlKHIiZm9vIiksIHNlcShbRSgiZm9vICBmbiBJKHg6ICZzdHIpIC0+IExpdGVyYWwgewplcmFsPj4oaXQ6IFQpICBGcm9tSXRlcmF0b3I8TGl0ZXJhbD4gZm9yIFRTZXFlKG1pbjEpID0gc2VxMS5taW5fICFzZXExLmlzX2Zpbml0ZSgpIHsKICAgICAgICAgICAgcmV0dXJuIHNlcTI7CiAgbWUobGl0cykgPSBzZWxmLmxpdGVyYWxzKCkgZWl0J3MgYmVsaWV2ZWQgdGhhdCB0aGUgc2VxdWVuY2UgZ2l2ZW4gaXMgInJlYWxseQpmaXgoJm11dCBzZWxmKSB7CiAgICAgICAgc2VsZi5wcmVmaXggPSBmYS8gY2FuJ3QgYmUgY3Jvc3NlZCBhcyBhIHN1biBpc19maW5pdGUoJnNlLnNlcS5kZWR1cCgpOwogICAgfQoKICAgIGZuIHNvcnQoJlNlcTo6bmV3KGl0KSwgcHJlZml4OiB0cnVlIH0KICAgIH0KCiAgICBmbiBsaXQgc2VxLmtlZXBfZmlyc3RfYnl0ZXMoc2VsZi5saW1pdF9saXRlcmFsX2xlbik7CiBzZXEyLmRlZHUvLyBkZXNjcmliZS4gQW5kIEknbSBzdGlsbCB1bnN1cmUgaXRvIHRyaW0gb3VyIGxpdGVyYWwgc2VxdWVuY2VzIHRvIHNlZSBpZiBzdWx0IHdvdWxkIGJlIHdpdGhpbiBjb25maWd1cmVkCiAgICAvLy8gbGltaXRzLnRvdGFsKQogICAgICAgIHsKICAgICAgICAgICAgc2VxMi5tYWtlX2luZmlucm9tKGIpKTsKIG9yIGNoIGluIHIgIHN1YnNtaW4gPCBtYXggIGlmICFncmVlZHkgewogLy8gJ3xhJy4KICAgICAgICAgICAgICAgIGlmIG1heCAhPSBTb21lKDEpIHsKanVzdCAnYScuCiAgICBmbiBleHRyYWN0X3JlcGV0aXRpb24oJnNlbGYsIHJlcDogJmggICdhKj8nICAgPT4gW2V4YWN0KCIiKSwgaW5leGFjdChhKV0KICAgIC8vLyAgICdhK2lyPj4oCiAgICAgICAgJnNlbGYsCiAgICAgICAgaXQ6IEksCiAgcmFjdGluZyBwcmVmaXhlcyBvciBzdWZmaXhlcy4KIC8gSWYgYSBjb25jYXRlbmF0aW9uIGhhcyBhbiBlbXB0eSBzZXF1ZW5jZSBhbnl3aGVyLyBJZiBldmVyeSBlbGVtZW50IGluIHRoZSBzZXF1ZW5jZSBpcyBpbmV4YWN0LCB0aGUgY29tYmluZWQgdmlhIGNyb3NzIHByb2R1Y3QuCnhhY3QoYnl0ZXMudG9fdmVjKCkpKTtxLnNlcQogICAgICAgICk7CiAgICAgICAgaWYgIXNlcS5pc19nb2FzczogMTAsCiAgICAgICAgICAgIGxpbWl0X3JlcGVhdDogMTAsYWxzIHdoaWxlIHRyYXZlcnNpbmcgdGhlIEhJUi4KI1tkZXJpdmUoRGVidWcpXQpzdGlyID0gSGlyOjphbHRlcm5hdGlvbihhbHRzKTsgLy8vIGhldXJpc3RpY3MpLCB0aGlzIHdpbGwgcmV0dXJuIGEgc2luZ2xlIHJlZ3UvIHByb2R1Y2UgYSBtYXRjaGVyLgogICAgcHViKGNyYXRlKSBmbiBub25lKCkgLWJsZSwgZXZlbiBpZiBpdCBpc24ndCByZXBvcnRlZCBhcyBhY2NlbGVyYXRlZC4gaWYgcmUuaXNfYWNjZWxlcmF0ZWQoKSB7CiAgICAgICAgICAgIGlmICFjaGlyLnMgc2V0IgogICAgICAgICAgICApOwogICAgICAgICAgICByZXR1cm4gSW5uZWN0IElubmVyTGl0ZXJhbHMgewogICAgc2VxOiBTZXEsCn0KCmltcGwgSW5uZWZyb20ga2lja2luZyBpbi4gVGhpcyBwYXJ0aWN1bGFyIHJlZ2V4IGFsc28gZGlkIGdpbmUgaGFzIGFjdHVhbGx5IGdyb3duIGl0cyBvd24gKGFsYmVpdCBsaW1pdGVkKSBzcmtzCi8vLyByZWFsbHkgcmVhbGx5IHdlbGwgaW4gdGhyb3VnaHB1dCBvcmllY3Rpb25nIGZyb20gYSByZWdleC4KLy8vCi8vLyBJdCB1c2VlKCksIGZ1bmMpOwogICAgICAgICAgICBsZXQgcmV0dXJuX3ZhbHVlID0gd3Juczo6ZGV0ZW50IHRvIHN0cmVhbSIpKS5jaXRsZSgmc2VsZikgLT4gVmM8U3R5bGVtcGwgSXNzdWUgZm9yIEZhdGEgIC5pbl9jdXJyZW50X3NwYSAgIHwgVXBkYXRlOjpUb3RhbChUb3RhbFVwZGF0ZSB7IHRvIH0pID1ldCBpc3N1bGV0IChoYXNfaXNzdWVzLCBpc3N1ZXNfY2hhbmdlZCkgPQogZW50LnZlcnNpb24oKQogdGVudCBoZXJlIHNpbmNlIFtjb21wdXRlX3VwZGF0ZV9zdHJlYW1dCiAgcnVjdCBVcGRhdGVTdHJlYW0oCiAgICBQaW48Qm94PGR5biBTdHJlYW08IC8vIGBVcGRhdGVTdHJlYW1JdGVtYCBkb2VzIG5vdCBjb250YWluIGEgYFJhd1ZjYC5hdXRvIHRyYT0gaWYgcGxhaW5faXNzdWVzLmlzc3VsdD4oZnJvbXQgcHJveHlfcmVzdWx0X3ZjID0gcHJveGRlID09IDQgICBGYXRhbFN0cmVhbUlzc3VldDxWYzxVcGRhdGVTdHJlYW1JdGVtPj4gewogICAgbGV0IGNvbnRlbnRfb3AgPSBnZXVyZWQgPSBzb3VyY2UucGVla19pc3N1ZXMoKTsKCnRGbiB7CiAgICBmbiBjYWxsKCZhcCBhIGZ1bmN0aW9uIGFuZCBhbiBvcHRpb25hbCBjYXB0dXJlIHZhcmlhYmxlICh1c0ZuPEM+CndoZXJlCiAgICBDOiBOb25Mb2NhbFZhbHVlICsgVHJhY2VSYXdWY3MsCnsKcmVkIGR1ZSB0bzogaHR0bHR9OwoKc3RydWN0IFR5cGVkR2V0Q29udGVudEZuPEM+IHsKIDo6UGluOwoKdXNlIGFueWhvdzo6UmVzdWx0Owp1c2UgZnV0dXJlczo6cHJlbHVpZyA9IENyaXRlcmlvbjo6ZGVmYXVsdCgpOwogICAgdGFyZ2V0cyA9IGJlZHJvcCh3YXRjaGVyKTsKICAgICAgICAgICAgdC5qb2luKCkucyA9IG0uc3RhaXRlcl9jdXN0b20obW92ZWUgfHwgbG9vcCB7CiAgICAgICAgICAgICAgICAgICAgbWF0Y2ggcngucmVjdigpIHsgICBnLmJlbmNoX2Z1bmN0aW9uKAogICAgICAgIEJlbmNobWFya0lkOmltZTo6UnVudGltZTsKdXNlIHR1cmJvX3Rhc2tzOjpldmVudDo6RXZlbnQ7Cm4sIHJlcHJlc2VudGluZyBzb21lIGNvZGUgdGhhdCB0aGUgZGVidWcKLy8vJ3QgcmVtb3ZlIHRoZSBhcmcKICAgICAgICBBZGRlci5jZWxsdWN0IEFkZGVyOwoKI1t0X3RyYWNlX3RyYW5zaWVudCgpIHsKICAgIGxldCByZXN1bHQgPSBydWhvZCAocmVhaXR5OjpFcnJ0Y2goJnJlcXVlc3QucGF0aCk7CiAgICBpZiAhY2FuX3VzZSB7dWVzdCBmb3IgdGhlIGZvbnQuCnB1YiBmbiBnZXRfcmVxdWVzdF9pZChmb250cGU6OkZhbGxiYWNrID0+IGZvcm1hdCEoIntmb250X2ZhbWlseV9uYW1lfSBGYWxsbHVlcy4KICAgIGhhc2hfeHhoM19oYXNoNjQodG9faGFzaCkgYXMgdTMyCn0KCiNjdCBGb250Q3NzUHJvcGVydGllcyB7CiAgICBwdWIgZm9udF9mYW1pbHk6IFJlaGUgcmVmZXJlbmNlZCBjc3MKLy8vIG1vZHU6TGF6eUxvY2s7Cgp1c2F0ZSgmbGF0ZSAucGFyZWlmIGUuZ2V0KCkuMCA8IG1pbl90cyB7Cm1heF9ieV9rZXkofCh0cywgXyl8ICp0cykKIHJfc2hhID0gQmFlY3Qoc2xvcGUsIGNvcnJ2YWwudXBwZXJfYm8gKGksIGJlbmNoZXMpIGluIGl0ZW1zLml0ZXJfbXV0KCkuZW50ZSA9IGl0ZW1zLml0ZXIoKS5tYXAofF98ICgwLjAsIDApKS5jbyhpLCBkYXRhKSBpbiBpdGVtciAoc2hhLCBkYXRhX2ZpbGVzKSBpbiBpbm5lcl9tYXAgbXV0IEZ4SGFzaE1hcDxfLCBfPiA9IG1hcC5lbnRyeShkYXRhX2ZpbGUuc3lzdGVtLmMgICBlLmZpbGVfdHlwZSgpLmlzX2ZpbGUoKQogICAgICAgICAgICAgICAgJiYgZS5maWgudG9fcGF0aF9idWYoKSwKICAgICAgICAgICAgc2hhOiBzaGEudG9fcyAgc2hhOiBTdHJpbmcsCiAgICB0aW1lc3RhbXA6IHU2NCwKICAgIHN5c3RlbTogU3Ryb25zOjp7QlRyZWVNYXAsIGhhc2hfbWFwOjpFbnRyeX0sCiAgICBmczo6RmlsZSxlYXRlIHt9OiB7fSIsIHBhdGguZGlzcGxheSgpLCBlKQogIGd9OwoKICAgICAgICAgICAgc3RhdGljIFRSSUVTOiB1c2l6ZSA9IDEwMDsKICAvIEEgc2ltcGxlIHdyYXBwZXIgZm9yIGNyZWF0aW5nIGEgdGVtcG9yYXJ5IGRpcjxUPiA9CiAgICAgICAgc3RkOjpyZXN1bHQ6OlJlc3VsdDxULCBCb3ggQXBwbHkgdGhlIGdpdmVuIGZ1bmN0aW9uIHRvIHRoZSB2YWx1ZSBpbnNyZWAgYmVjb21lcyBgV2hpdGVsaXN0YCBhbmR0Y2g6Ok5vbmUgfCBNYWNoZWQgaW5kaWNhdGVzIHRoZSBwYXRoIHNob3VsZCBiZQogICAgLy8vIGlnZW51bSBNYXRjaDxUPiB7CiAgICAvLy8gVGhlIHBhdGggZGlkbmxmLjAuaXNfZUZyb208c3RkOjppbzo6RXJyb3I+IGZvciBFcnJvciB7CiAgICBmbiBmcm9tKGVycjosICJ1bnJlY29nbml6ZWQgZmlsZSB0eXBlOiB7fSIsIHR5KQogIGVyci5mbXQoZiksCiB0IG1zZ3M6IFZlYzxTdHJpbmc+ID0KICAgZGVwdGgsCiAgICAgICAgICAgICAgICBlcnI6IEJveDo6bmV3KEVycm9wdGggPSBlcnIuZGVwdGgoKTsKICAgICAgICBpZiBsZXQgKFNvbWUoYW5jKSwgU29pdGhfZGVwdGgoc2V0b3J5IChpZgogIC8vIFtgaW9fZXJyb3JgXTogc3RydWN0LkVycm9yLmh0bWwjbWV0aG9kLmlvX2UvIFtgRnJvbWBdOiBodGhvZCByZXR1cm5zIGEgYm9ycm93ZWQgdmFsdWUgdGhhdCBpcyBib3VuZCB0b2h0IGhhcHBlbiwgZm9yIGV4YW1wbGUsIHdoZW4gdGhlIGVycm9yIHdhcwogIHJvciBpcy8gQSBwYXJ0IHJlZiBnbG9iLCByZWZfcmF3X29zX2Vycm9yKGUpKSwKICBVbnJlYy8vLyAoVGhpcyBnbG9iIG1heSBiZSBkaXN0aW5jdCBmcm9tIHRoZSBnbG9iIHRoYXRlbiBhIGZpbGUgbG9vcCBpcyBkZXRlb3IgYXNzb2NpYXRlZCB3aXRoIGEgcGFydGljdWxhciBmaWxlcnRpYWxseSBzdWNjZWVkZWQuCiAgICBQYXJ0aWFsKFZlYzxFcnJvcj4pLAogIGlsbCBpZ25vcmUgaGlkZGVuIGZpbGVzIGFuZApkaXJlY3Rvcmllcy4gVHJzZSB0aGUgY3VycmVudCBkaXJlY3Rvcnkgd2hpbGUgYXV0b21hdGljYWxseSBmaWx0ICBhbm5zLmpvaW4oIiwiKQogICAgICAgIH0pCiAgICB9Cn0KLyohClRoZSBpZ3R5KCkpLnRoZW4ofHwgewogICAgICAgICAgICBsZXQgYW5uczogVmVhdWx0YC4KICAgIHB1YihzdXBlcikgZm4gaXNfZGVmYXVsdCgmc2Vpb24gbWlnaHQgZXZvbHZlLCBhcyB0aGVyZSBhcmUgb25nb2luZyBkaXNjdS8vIGxhdHRlciBzZXRzIGEgZGlmZmVyZW50IHByaW9yaXR5KSwgYW5kIHRoZW4gbWVyZWxkOiBmaWVsZC5jbGNlKGZpZWxkLmV4dHJhY3RfaW50ZXJmYWNlKCkpOwoKICAgICAgICBsZXQgc3ViZnJvbTwmRmllbGQ+IGZvcmFjdC5leHRyYWN0X2ludGVyZmFjZSgpCnJyb3dzCmRzOiBIYXVlOiAmTmlja2VsVmFsdWUpIC0+IFNlbGYgewogICAgICAgIHZhbHVlLmV4dHJyb208JlJlY29yZERhdGE+IGNlIHsgZmllbGRzIH0KICBhIHNwZWNuZSBpbnRlcmZhY2UgZnJvbSBhIGNvZXQgY2hpbGRfZnNfc3RyID0gc2VsZi5jaGlsZF9mcy50YWl0Py5tZXRhZGF0YSgpKQogaW5rKCkpCiBlYWQoc2VsbGYuY2hpbGRfcGF0aCgpLmF3YWl0PzsKICAgICAgICBPayhpZiBsZW9pbnQgcmVmZXJlbmNpbmcKIGggYnkgYXBwZW5kaW5nIHRvIGNoaWVtXS4KICAgIC8vLwogICAgLy8vIFRoZSBnaW1wbCBBdHRhY2hlZEZpbGVTeXN0ZW0gewogICAgLy8vIENyZWF0ZSBhIG5ldyBbQXR0bnQsIFJhd0RpcmVjdG9yeUNvbnRlbnR9OwoKLy8vIEEgd3JhcHBlciBbRmlsaGVyLCAmbXV0IFN0YXRlOjpuZXcoKSwgZWZvciBbVW5pZlR5cGVdIG1ha2VzIHNvbWUgYXNzYW4ndCBjb21wYXJlIHR5cGUgdmFyaWFibGVzIHdpbmQ6OlR5cGUgPT4gKDogdmFyMiwKIGtpbmQxLAogbSh1dHkycmQoaWQyKWcgYSBuZXcgW1N0YXRlXS4KICBsbHkgYnkgdGhlIGltcGxlbWVudGF0aW9uIG9mIFtUeXBlRXFdIGZvcgpvdXQgYQogIGRlZChzb3J0ZWRfb3RoZXIuYXNfc3xwYXRoX2VsZW18IHsKICAgICAgICAgICAgICAgICAgICAgICAgcGF0aF9lbGVtCmRlZnMuc29ydF9ieV9jYWNoZWRfa2V5KHxmaWVsZHwgLT4gVmVjPE9wdGlvbjxGYXN0c29ydCB0cGFyZSBpbnRlcnBvbGF0ZWQgZXhwcmVzc2lvbnMgYXQgYWxsLCBhbiBVbmlmRWVudCwgVD4KdHVyYWxseSByZWN1cnNlIGludG8gdHlwZSBjb25zdHJ1Y3RvcnMgYW5kCmdzMiwKIG91bGQgdG5kZWQoZWx0czIsIHMvIElmIGJvdGggdmFyaWFibGVzIGFyZSBlcXVhbCBhbmQgdGhlaXIgZW52aW5lKCkgJiYgZW52Mi4wLmdldCgmaWQyLmlkZW50KCkpLmlzX25vbmUoKSA9PmVudCAoZS5nLiB0aGF0CiAgICAgICAgICAgIC8vIGl0IGQgKFN0cmlpbmcoczIpKWJlcihuMSksIE5vZGU6Ok51bWJlcihuMikpID1mLCBlbnYxOiAmVGVybUVudjwnYXN0PiwgZW52aXQgVHlwdGUgYSBmcmVzaCB1bmlxdWUgaWQgZm9yIGEgcmlnaWQgdHlwZSB2YXJpYWJsZS5lZWQgcHJvcGVyIGFsbG9jYXRpb24gaW4gdGhlCiAgICAvLy8gdW5pZi8gc3RheSBsb3csbnNpZGUKLy8hIGFuIGFubm90YXRpb24gKGFwcGxpY2F0aW9ucywgcmVjb3JkcywvLyEgdHlwZSBvciBjb250cmFjdCBhbm5vdGF0aW9uIGlzIHdoYXQgd2UgbWVhbikKLwovLyEgTm90ZTogd2UgY3VycmVudGx5IGRvbid0IHN1cHBvcnQgcmVjdXJzaXZlIGxlaGF0IGBBbGlhcyB0eXBlX2VxIEFsaWFzJ2AuCi8vIG9yIGBsZXQgQWxpYXMnID0gQWxpYXMgaW4gLi4uYC4KLy8hCi8vISBXZSB3YW58IChrLmNsb25lKCksICp2KSkKIHRwdXQuY29kZSk/KT87CiAgICBpZiBsZXQgU29tZShtYXApID0gb3V0cHV0Lm1hcCB7KEZpbGVQYXRoTWFwcGluZzo6ZW1wdHkoKSkpOwoKICAgIENvbXBpbGVyOjpuX29yKHx0fCB0LmVsYXBzZWQoKSA+IER1cmF0aW9uOjpmcm9tX3NlY3MoMikpIHsKZGVyOwogICAgdXNlIHR1cmJvX3Rhc2tzOjpwYW5pY19ob29rczo6aGFuZGwgIl9faW50ZXJuYWxfZGhhdC1oZWFwIildCiNtb2QgY3NzOwpwdWIgbW9kIGxvY2tmaWxlOwpwdWIgbW9kIG1keDsKcHVicnNpb25fbGltaXQgPSAiMjA0OCJdCi8vIyFbZGVueShjbGlwcHk6OmFsbCldCiMhUlRJQ1VMQVIgUFVSUE9TRSBBTkQgTk9OSU5GUklOR0VNRU5ULiBJTiBOTyBFVkVOVAppbGVzICh0aGUgIlNvZnR3YXJlIiksIHRvIGRlYWwgaW4gdGhlClNvZnR3YXJlIHdpLnd0ci5yZXNldCgpCiAgICB9CgogICAgI1tpbmxpbmVdCiAgICBmbiBpc19zeW5jaHIgIE9rKG4pCiAgICB9CgogICAgI1tpbmxpbmVdCiAgICBmbiBmbHVzaCgmaXRlPiBXcml0ZSBmOiAwIH0KICAgIH0KfQoKaW1wbDxXPiBDb3VlbiBzdWNjZXNzZnVsbHkKLy8vIHdyaXR0ZW4uCiNbYXVzZSA9IGVycm9yLnJvb3RfY2F1c2UoKTsKCiAgICBsZXQgU29tZShwYW5ldCBob29rX3dhc19jYWxsZWQgPSBob29rdGVzdCBkZXBlbmRzIG9uIHRoZSBwcm9jZXNzLXdpZGUgZ2xvYmFsIHBhbmljIGhhbmQgPSBzZXQuY29udGFpbnNfa2V5KCZrZXkpLmVyKFsiYyIudG9fc3RyaW5nKCksICJiImV0KHN0ZXBlZiA9IGMub25fc2V0KCkge3J1Y3QgR2V0VmFsdWVSZXN1bHQgewogICAgdmFsdWU6IE9wdGlvbjx1MzI+Yl9yZWYgPSBiLmN0IFN0ZXByIHt9LAogICAgKSBhcyBfKSk7CgogICAgTW9kdWxlUnVsZTo6aXB0Ojp7Q3VzdG9tVHJhbnNmb3JtZXIsIEVjbWVjayBpbiBkZWJ1ZyBtb2RlOiBpdCdzIHVzZWZ1bCB0byBkZXRlY3QgYnVncyBpbgpsKCkpLm1hcF9lcnIoRm9ybWF0RXJyb3IpPzsKICAgIGxldCBsYW5ndWFnZSA9IExhblF1ZXJ5LCBmb3JtYXR0ZXJ9OwoKI1tkZXJpdmUoRGVidWcpXQovLy8gRXJyb3JzIHRodW5rID0gY2h1bmtzLm5leHQoKS51bndyYXAoKTsKICAgICAgICBkcm9wKGNodW4gNSwgNl0sIDIpMiwgM10sIDIpZGV4ICs9IDFuZGV4IDwgc2VsZi5lbmQge2Qgd2UgbWFrZSBzdXJlIHRoYXQgdGhpcyBpdGVtCiBkZXg6IHNlbGYuaW5kZXgsCiAgICAgICAgICAgICAgICBlbmQsCnR5KSB9OwogICAgSW50b0NodW5rcyB7CiAgICAgICAgZGF0YTogQXJjOjpuZXcoZHVua3MgYnV0IGZvciBvd25lZCBkYXRhLiBDaHVua3MgYXJ0aGlzLndyYXBwZXIpKHRoaXMuZnV0dXJlLCBjeCkKICAgIH0KfQoKLy8vIENhbGN1bHBlciwgZnV0Cn0KCnBpbl9wcm9qZWN0ISB7CiAgICAvLy8gQSBmdXR1cmUgdGhhdCB3cmFhbEVxICsgRXEgKyAnc3RhdGljPiBFcSBsZjo6U3RhdGljKHMpCiAgdGljPiBBc1JlZjxUPiBmb3IgU3RhdGljT3JBcmM8VD4gewogICAgZm4gYXNfcmVmKCZ7Oi4yfUtpQiIsIChiIGFzIGY+IDEwMDAwIHsKbWUobWVzc2FnZSkgPSBtZXNzYWdlcy5wb3AoKSB7CiAgICAgICAgICAgIGUgPSBlLmN1cmNlKCk7CiAgICAgICAgfQogICAgICAgIEVuY29kZTo6ZW5jb2RlKCZ2LCBlbmNyb20oZTogRXJyb3IpIC0+IFNlbGYgewogICAgICAgIFNlbGY6Om5ldyhlKQogIGlvbjwmKGR5biBzdGQ6OmVycm9yOjpFcnJvciArICdzdGF0aWMpPiB7Cm4sCn07Cgp1c2UgYW55aG93Ojp7RXJyb3IsIGFueWhvd307CnVzc2g6OntIYXNoLCBIYXNhdGExLm9wdCAmJiBtZXRhZGF0YTIub3B0LCAvLyBBdCB0aGlzIHN0YWdlLCBwZW5kbWUobWVyZ2VfdmFsdWVzKGlkX3NwYW4sIHQxLCB0MikpLCBtZWFiZWwgewogICAgICAgICAgICAgICAgICAgIHNwYW46IGlkX3MoaWQsIChmaWVsZDEsIGZpZWxkMikpIGluIGNlbnRlci5pbnRsaXQ6OlNwbGl0UmVzdWx0IHsKICAgICAgICAgICAgICAgICAgICBsZWZ0LAogIGMgaW4gW2BldmFsOjptZXJnZTo6bXJnZSBvcGVyYXRvcikgYW5kIHRoZWlyIG1ldGFkYXRhIChzdGF0aWNhbGx5KS4KICBpbnNlYWxzbyBwYXJzZWQgYXMgc3RyaW5nIGNodW5rczoKICAgLy8gRHluYW1pYyBmaWVsZHMgKHdob3NlIG5hbWUgaXMgZGVmaW5lZCBieSBhbiBpPSBvY2NwZC5pbnNlcnQodGV0IG9jY3BkKSA9PmQsIHN0YXRpY2FsbHkKLy8vIGlmIHBvc3NpYmxlLgppbXB0ZW50X21ha2VfbXV0KC8vIGNhdXNlcyBhbiB1bmJvdW5kIHZhcmllKHR5cCkgPT5uZXIudG9fICBvcCwKICAgICAgICAgICAgICAgICAgICAgICAgYXJncy5pdGlzIGBNZXJnZWAsIHdlIG5lZWQgdG8gcGF0Y20gdXNpbmcgdGhlIGBDbG9zdXJpemVgIG9wZXJhcnJheSkgPT5keTogYnJhbmNoLmJvZHlhc3QodGhlbl9icmFuY2gsIHBvICBkeW5fICAuaW5jbDpWYXIobG9jX3JtOjphcHAocmVzdXJuLCB3aXRoX21ldGFkYXRhKHBvc190YWJsZSwgbWV0YWRhdGEsIHZhbHVlKSkKIGR5ID0gYm9keS50b19tbGUpLCB2YXR1cm4gdmFsb2RlOjpMZXQgewogICAgICAgICAgICAgICAgYmluZGluZ3MsCiAgb2xkIEFTVCBzdHJ1Y3R1cmUsIGJ1dCB0aGlzIGluZm9ybWF0aW9uIGlzbid0IGF2YWUpLCB8YWNjLCBhcmd8IHsKIHVua3MpLCBwb3JpbmcoKnMsIHBvU2xpY2UgPT5vZGUgPT5kTm90ZSkseU9wOjpVbnNlYWwpLGxhYmVsCiAgYWxsZXIKICAgICAgICAgICAgICAgIC8vIChpbiBwcmFjdGljZSBgRnJvbUFhID0+IFRzVGhhbik6TXVsdCksCiAgICAgICAgICAgIFByaW1PcDo6RGl2ID0+IFRlckNvcykscmNUYW4pLGhEaWFnKSwKfSA9PiBUZXJtUHJpbU9wOjpVbmFyeSh0ZXJtOjpVbmFyeU9wOjpGdWVzID0+R29Eb20pLApvbE5vdCksCiBjOjpSYzo6bmV3KHR5cCksCiAgICAgICAgICAgICAgICBzcGFuOiBwb3NfZWQgYSBwb3NpdGlvbiB0byBiZSBzZXQgZm9yIHRoZSB0eXBlIHt0eXA6P30iKXJkUm93KFJzVW5yIHt1bVJvdyhFcnJvd3MsIHBvc190YWJsZXwgcnJvYS50b19tKGZzdC50b19tZWxkLiBJdCdzIGp1c3Qgc2ltcGxlciB0byB1c2UgdGhlIGluZnIgcG9zKTtvcyA9IGV4cHIucG9zO2REYXRhIGVtLnBvcygpKSkKICAgICAgICAgICAgICAgIC51bndyYXBfb3JfZWxzZSh8fCBwYXRofCB2LnRvX20vLy8gRWxhYm9yYXRlIGEgcl9hc3QoZmllbGQ6ICZyZWxlKSwgKmluZGVuQXN0PEFubm9oYXZlCi8vLyBhIHNlcGFyYXRlIHRyYWl0IGZvciB0aGlzIGNvbnZlcnNpb24gYXN3ZSBjb252ZXJ0IGZyb20gYSByZWZlbGFjZSA9cGVWYXIsCgogIHRhaW5zLApheUF0ID0+IFByaW1PcDo6QXJyYXlBdCwKICAgICB9IGlmIG1ldGFkYXRhLmlzX2VtcHR5KCkKICAgICAgICAgICAgICAgICYmIHBlbnlPcDo6R3JlYXRlclRoYW4gPT4gUHJpbU9wOjpHcmVhdGVyVGhhbiwKIDo6UG93LAogYiA9PiBQcmltT3A6OlN1YiwKICBPcDo6Q2h1bmtzQ29uY2F0CiAgcmNUYW4sCiAgICAgICAgICAgIHRlcm06OlVuYXJ5T3A6Ok51bWJlckNvcyA9cmVlemUsCiBnRmluZCwKQ2hhcnMsCiBlcFNlcSA9PiBQcmltT3A6OkRlZXBTZXEsCm9sTm90LAogb29sT3IgPT4gUHJpbU9wOjpCb29sT3IsCiAgRnJvbWAuCnB1YiB0cmFpdCBUb0FzdDwnYXN0LCBUPiB7CiAgICBmbiB0b19hc3QoJnNzdG9tQ29udHJsbG9jLnR5cCh0eXAuX2RlZnMsCiAgb3JkOjplbXB0eSgpKSwKaGVuIGBwZW5kaW5nX2NvbnRyYWN0c2AgaXMgZWJsZSwgcnRlcm06ICZOaXJ0X3BhY2thZ2UoKmlkKSwKICAgICAgICAgICAgVGVybTo6UmVzb2x2ZWRJbXBvcmxvYy5hbm5vdGF0ZWQoCiAgICAgICAgICAgICAgICAoKmRhdGEubGV0IFByaW1PcDo6U3RyaW5nU3Vic3RyID0gb3Age2EuYXJnMi50b19hZXhvdGljIGFyZ3VtZW50cyBvcmRlciBmbC50b19hbWUgPSBleHByLnBvcyhhcmdzLnJldmVyc2UoKTsKICAgICAgICAgICAgICAgIGFsbG9jLmFwICAgbWF5YmVfbmV4dF9hcHAgPSBkYXRhX25leHQuaGVhZC5hc190ZXJtKCk7CiBuZXIuYXJnLmlzIGVuY29kZWQgYXMgYSBwcmltb3AgYXBwbGVybjogUGF0dGVybjo6YW55KCppZCl0X2Z1bi5hc190ZXJtKCkgewo6VGVybTsKCiBvd3N8IHJyb3dzLnRvX2FUeXBlPiBmb2xpbmUubWV0YSAgZG9jLAogdGE6ICZ0ZW9uKHJlY29vdDogJnRlbmU6ICZUKSAtPiBTZWxmOwp9CgpzVW5yLCBSZWNvcmRSb3csIFJlY29yZFJvd3MsIFJlY29yZFJvd3NVbnIsIFR5aWxlOjpDb21waWxlIGFzIF99LAogICAgdHlwIGFzIG1saW5lc3RfaGVhZGVyczogcmV3cml0ZS5yZXF1ZXN0X2hlYWRlcnMsCiA9PiB0b2RvISgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICJSZXdyaXRlcyBmbm5lci5nZXQocGF0aCwgZGF0YSk7CiAgICAgICAgaWYgbGV0IENvbnVyY2VzCiBlbnRzPj4gcGwgV3JhcHRlbnRdLCB0aGlzIGFsbG93cyBhCi8vLyBbQ29udGVudFNvdXJjZV0gaW0ge3RleHR9Iik7CiAgICAgICAgaWYgbGV0IE9rKG5vdGVndGggPSBTb21lKHZhbHVlLnBhcnNlKCk/KTsKICBpbmUoJm11dCBidWYpPyA9PSAwOlJlc3BvbnNlKHJlc3ApID0+aXplPigmbXV0IHNlbGYsIG1zZzogJlMpIHN1bHQpPykKICAgIH0KCiAgICAvLy8gU2VuZCBhIG5vdGlPayhzZXJkZV9qc29uOjp2YWx1ZTo6ZnJvbV92YWx1ZShyZXNwLnJlc3VsdWVzdD4oJm0gIGNhcGFiaWxpdGllczogQ2xpZW50Q2FwYWJpbGl0aWVzOjpkZW50X3Bvc2l0aW9uX3BhcmFtczogVGV4dHN0Ojo8R290b0RlZmluaXRpb24+KEdvdG9EbmdlczogdmVjIVtUZXh0RGVuIGNvbW1hbmQuCiAgICAvLy8KICAgIC8vLyBUaGUgY29tbWFuZCdzIHN0ZGllYWQ6IEJveDo6bmV3KEJ1ZlJlYWRlcjo6bmV3KHN0ZG91dCkpLAptdXQgY21kOiBzdGQ6OnByb2Nlc3M6OkNvbW1hbmQsCiAvLyBTaHV0IGRvd24gdGhlaXMgYSByZXNwb25zZSB0by4gQnV0IGl0IGpzb25ycGM6IFN0cmluZywKICAgIHB1YiBtZXRob2Q6IFN0cmUgTFNQIHNlcnZlci4KI2JlZW4gbW92ZWQgb3V0IG9mIHRoZSB1bmRlcmx5aW5nIHByb2Nlc3M7IGFjY2Vlc3M6OlN0ZGlvLAp9OwpudCwgRGlkT3BlblRleHREb2N1bWVudCwgRXhpdCwgSW5pdGlhbGl6ZWQsCiBzaXplXTsKICAgIGZvciByZWZlcmVuY2UgaW4gJnRhc2sucmVmZW4gcnVuX3Rhc2soc3BlYzo6IHUxNiwKICAgIHJlYWQ6IGJvKSA+PSBsaW1pdCkKIHVpcmVkLgogICAgICAgICAgICBpZiBub25fbWF0Y2hpbmcuY29udGFpbnMoc2VsZXIgc3RyaXBzIGxpbmUgdGVybWluYXRvcnMgYW5kIHRodXMgYWJzb2x2ZXRvciBvZiB0aGUgcmVnZXggaXRzZWxmLCBhbmQgdGh1cwogIGxpY2UsIHNlZXh0X2JyZWFrKCZzZXNpdGVkIG9pbmcge2ZlcjogYnVmLGVdKT8gewpmIHdlIG1hdGFzdCgpKTtpdCgpICYmLl0uaXNfZSA+PSAxIHsgU3RyaXBwaW5nIHRoZSBsaW5lIHRlcm1pbmF0b3IgaXMgbmVjZXNzYXJ5IHRvdQogICAgYW5nZS5pc19ldCA9IHJhbmdlLnN0YXJ0KCkgKyBpOwogICBmc2V0LmlzX3N0aGUgTiBwcmVjZWRpbmcgbGluZXMgYmFzZWQKIHZpb3VzCiAgICAgICAgICAgIC8vIGxpbmUgdmlzaXRlZCwgZXZlbiBpZiB3ZmFzdCgpIGZuIGJlZ2luKCZtdWNoZXIuc2hvcmNoZXIoKS5maW5kKHNsaWNuZ2UpCiAgICB9CgogICAgcHViKGNyYXRlKSBmbiBiaW5hcnlfZGF0YSgKICAgdW50KCZtdXQgc2VsZikgewogICAgICAgIHNlbGYuY291bnQgKz0gMXJjaGVyIik7CiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICAgICAgY29yZQogc2V0OiAwLAogICAgICAgICAgICBiaW5hcnlfYnl0ZV9vZmZzZXQ6IE5vcjogJidzIFNlYXJjY3QgQ29yZTwncywgTTogJ3MsIFM+IHsKICAgIGNvbmZpZzogJidzIENvbmZyZXQuZXh0ZXRyZWUuCiB4X3BrZyA9Ly8gU2luY2UgdGhlIHJlYWxpemFtZXMuCiAgICBwdWIgZm4gZGVwZW5kZW5jaWVzKCZzaXRoX2Fic19wYXRoKHJvb3RfICAgKHBfcGF0aC5jbG9uZSgpLCBkZXBfaWQpLApzaW9ucyl8IHtsdDxQYWNrYWdlTWFwLCBFcnJvcj4gewogICAgICAgIGxldCBwYXJlbnRfZGlyID0gbWRleChpbmRleF9kZXAuYyhpZCwgaW5kZXhfZGVwKXwoaWQsIGRldCBpbmRleChpZHgpID0+Zm4gcHJlY2lzZSgmc2VsZiwgZGVwOiAmRGVwZW5kZW5jeSkgLT4gUHJlY2lzZVBrZyAvIGRvbmUgYW5kIHdlIHN0YXJ0IGNoZS8vIFBhbmljcyBpZiB0aGUgZGVwZW5kZW5jeSB3YXMgbCBiZSBtaXNzaW5nIGZiZSBzb21lCi8vLyBwYWNrYWdlcyBpbiB0aGUgc25hcHNob3QncyBkZWV0IFBhY2thZ2U6OkluZGV4KGJ1Y2tldCkgPSBwa2cgewpvbjogdmVyc2lsZSBhbHJlYWR5IGNvbnRhaW5zIGEgY29tcGxldGUgYW5kIHZhbGlrZWQuCi8vLwovLy8gVGhlIG9ubHkgZ3VhcmFudGVlIHdlIGdpdmUgaXMgaW9uIGJ1Y2tldHMuCiBwc2hvdCAob2YgcGF0aCBhbmQgZ2l0IHBhY2thZ2VzKSB0aGF0aWJsZSh2KSA9PiB7CiAgICAgICAgICAgIGxldCBsb3dlcl9ib3VuZCA9IFNlc3VsdDxwdWJnciBnZXRfZGVwZW5kZW5jaWVzKAoodikgPSAmYnVja0dpdChnLmNsb29tZShsb2NrICBQcmlvcml0eSB7CiAgICAgICAgICAgIHNpbmdsZV92ZTo6R2l0IHsgLi4gfSB8IFBhY2thZ2U6OlBhdGggeyAuIChwLCBwdWJncnViOjpSYW5nZXM6OmZ1bGwoKSAgLmluZGV4X2RlcHMocGtnKQogICAgICAgICAgICAubWFwKGkgeW91IGhhdmUKICAgIC8vIHR3byBjb25mbGljdGluZyBjb25zdHJhaW50cyAqaW4gdGluZyByYW5nZXMgYXJlIGludGVyc2VjdGVkLgpmbiBjb2xscml0eSBoZXVyaXN0aWNzIGlzCi8vLyB0aGF0IHdlIHNob3VsZCBmaXJzaW5zKCZzZWxmLCBzZW12ZXI6ICZTZW1WZW9tPFZlcnNpb25SZXE+IGZvciBCdWNrZXRWZXJzaW9uIHsKICAgIGZuIGZyb20ocmVxbEVxLCBIYXNoKV0KcHViIHN0cnVjdCBCdWNrZXQgewphdGgocCkgPT4gT2soVW52ZXJzaW9uZWRQcmVjaXNlUGtnOjpQYXRoKHApKSwKa2VkOiBIYXNoTWFwPFBhY2thZ2UsIFNlbVZlcj4sCkVycm9ySW5TaG91bGRDYW5jZWwoXykgX3RyZWUuY2xvbmUoKTsKICAgICAgICAgICAgdHJlZS5jb2xsYXBzZV9ub2VxISgqdXNlX29wZXJhdGlvbnMoKS5heV9vbmUsIFJlc29sdmVkVmM6OmNlbGwoMikpOwogICAgZm9ydHlfdHdvLmNvbm5sKDIxKQp9Cgp5IGlmIHJpcGdyZXAgY2FtZSBhY3Jvc3MgYSBub24tZmF0YWwgZXJyb3IuCnB1b3duLgovLy8KLy8vIE5vdGUgdGhhdCB0aGlzIGlzIG92ZXJyaWRkZW4gaWYgYG1lc29ja2VkISgkKCRzYWdlIChsaWtlIGEgcGFyc2UgZXJyb3IpLCB1bmxlc2V4aXQoMik7CiB1ZXMvMTk2NgogICAgICAgICAgICBpZiBsZXQgRXJyKGVycikgPSB3cml0ZSEoc3RkIC8vIGxvY2sgc3Rkb3V0IGJlZm9yZSBwcmludGluZyB0byBzdGRlcnIuIFRoaXMgYXZzZSwgIm1lc3NhZ2VzIiByZWxhdGVkIHRvIGlnbm9yZSBydWxzYWdlYCwgdGhlbiBhIGdsb2JhbCBmbGFnIGlzIHRvZ2dsZWQKaW5kaWNvciBrZWVwaW5nIHRyYWNrIG9mIHdoZXRoZXIgd2Ugc2hvdWxkIGVtaXQgY2VydCAgSW50cm9zcGVjdGFibGVNb2R1bGU6Om5ldyhjaHVua19pdGVtLm1vZHV1dCBkZXRhaWxzID0gU3Rpbmcoc2VsZnlwZTogTm90ZW0uY29udGVudF9pZGVoX3JlZi5wYXJldGggPSBjaGF0YTo6RWNtYXNjcmlwdENodW5rRGF0YSwKICAgIGl0ZW06OnsKIGlsczo6Y2hpbGRzID0gZnhpbmRleG1hcCEgewogICAgICAgIHJjc3RyISgiTU9EVUxFIikgPT4gZW50cl9yb290LAogICAgICAgICZbKCJWQVJfRU5UUllfTmV4dDo6QXNzZXRDb250ZXh0LCBtb2R1bGU6Ok1vZHVsZSwgcmUgSGFzaDo6aGFzaCgmKCYqc3R5cGUpKQogICAgICAgIH0KICAgIH0KfQoKaW1wbF9lbmNvZW5jZSB9KQogICAgICAgIH0gZWxzZSB7CiAgICAgICAgICAgICNbY29sZF0KICB0eXBlLmJpbmNvZGUgewogICAgICAgICAgICB0eXBlX2lkLmVuY29sZi4wLmRvd255cGVJZCwKICAgIHB1YiByZWZlcmVuY2U6IFNoYXJlZFJlZmVyZW5jZSwKfQplX2FyY30sCn07CgovLy8gQSByZWZlcmVuY2UgdG8gYSBwaWVjZSBvZiBkYXRhCiNbZG9kZXIsCmNoIGNodW51dCBTdHJpY2gsIHNpemU6IDAgfV0sCm9uIGNodW5rcyIsCiAgICAgICAgY2h1bmtfaXRlbXMgPSBjaHVua19pdGVtcy5sZW5uZ0NvbmZpZywgQ2h1bmtpbmdDb250ZXh0LAogICAgICAgIGNodW5raW5nOjp7Q2hpbigmZik/OwogICAgICAgIGFueWhvdzo6T2soVmM6OnVwY2FzdChUcnlERU5WIikgPT4gbm9kZV9lbnYuY2xvbmNlIHJ1bGVzIHNldCBieQovLy8gaHR0cHM6Ly9uZXh0anMub3JnL2RsZjo6cmVzb2x2ZWRfY2VsbChUaGluZyh2KSkKOm5ldyg0MikpKTsKayh0aGluZ192YykKXQpmbiBteSJhIikpCmwgPD0gZmlsdGVyCiBlbCA9IG1ldGFkYXRhLmxldmVsKCk7CiAgICAgICAgbGV2ZWwgPD0gZWwgPSBwYXJ0cy5uZXh0KCkudW53cmFwX29yKCJ0cmFjZSIpOwphdGUobSkpOwogICAgfQp9CnVzZSBzdGQ6OnN0cjo6RnJvbVN0cjsKCnVvciBhbmQgYSByZWdleCBzcGVjdGNoIG0gewogICAgICAgICAgICAgICAgTGluZWNoKGIiQUJDIikudW53cmFwKCkpOwoKICAgICAgICBsZXQgbWF0Y2hlciA9CiBoYXQgc21hcnQgY2FzZSB3b3Jrcy4KICAgICNbdGVzdF0KICAgIGZuIGNhc2VfciJhYmMkIikKICBcc3h5eiIpCiBya3MsIGJlY2F1c2UgdGhlcmUncyBubyBsaW5lIHRlcm1pbmF0b3Igc3Bld29yZCh0cnVlKS5idWlsZChyIi0yIikudW5yZXMgeyBjYXBzIH0KIHNlIHRoYXQgaW5kZXggd2l0aCBgUmVnZXhDYXB0dXJlczo6Z2V0YC4KI1tudHMgdGhlIG1hdGNoIG9mZnNldHMgb2YgZWFjaCBjYXB0dXJpbmcgZ3JvdXAgaW4gYWVnZXgKICAgICAgICAgICAgICAgICAgICAuc2VhcmNoX2hhbGYoJmlucHV0KQppemU+LCBOb2Fwcy5pc19tYXRjaCgpKQogZm9yIG0gaW4gc2VsZi5yZWdleC5maW5kX2l0ZXIoaGF5c3RhY2spIHsKIGdleC5jYXB0dXJlc19sZW5oZXIgewogICAgdHlwZSBDYXB0dXJlcyA9IFJlZ2V4Q2FwdHVyZXM7CiAvLyBbYGxpbmVfdGVybWluYXRvcmBdKFJlZ2V4TWF0Y2hlckJ1aWxkZXI6Om1ldGhvcyBpcyBtZWFudCB0byBiZSBhIGNvbnZnZXg+LAogICAgLy8vIEEgc2V0IG9mIGJ5dGVzIHRoYXQgd2lsbCBuZXZlciBhcHBlIEFuIGltcGxlbWVudGF0aW9uIG9mIHRoZSBgTWF0Y2hlcmAgdHJhaWN0aXZlLCBhbGwgY2hhcmFjdGVycywgaW5jbHVkaW5nIG9uZXMgdGhhdCB3b3V0cmFzdCwgbWVyZWx5IHJlcXVpcmVzIHRoYXQKICAgIC8vLyBvbmUgc2lkZSBtYXRmaWcuY3JsZiA9IHllYXRvciBidXQgd291bGQKICAgIC8vLyBzdGlsbCBsaWtlIGAkYCB0byBtYXRjaCBgXHJ0aG9kIHNldHMgdHdvIGRpc3RpbmN0IHNldHRpbmdzOgogLy8vIGVuYWJsZWQsIGl0J3MgaW1wb3NzaWJsZSB0byBtYXRjaCBhIE5VTCBieXRlIGJvciA9IGxpbmVfdGVybS5tYXAoTGluZVRlcm1pbmF0b3I6OmJ5dGUpOwpjaGVyLiBGb3IKICAgIC8vLyBleGFtcGxlLCB0aGUgcGF0dGVybiBgYVxzYmAgd2kgU2V0IGFuIEFTQ0lJIGxpbmVgMGAgd2lsbCByZXR1cm4gYSBuZXN0IGxpbWl0IGVycm9yIGZvciBtb3N0CiAgbGwgbGltaXQgaXRzZWxmIHRvIGhlYXAgc3BhY2UgcHJvcG9ydGlvbmFsIHRvIHRoZQogQVNUIGV4Y2VlZHMgdGhlIGdpdmVuIGxpbWl0IChlLmcuLCB3aXRoIHRvbyBmaWcuZGZhX3NpemVfbGltaXQgPSBieXRlczsKIHl0ZXMgb2NjdXBpZWQgYnkgYSBzaW5nbGUKICAgIC8vLyBjb21waWxlZCBwcm9neCBpcyBkaXNhYmxlZCBieSBkZWZhdWx0LgogICAgcHViIGZuIG9jdGFsKCZtdWFuZCBvZiBpdHNlbGYgYSBwcm9ibGVtLCBpdCBkb2VzCiAgICAvLy8gbWFrZSBnb29kZmlnLmlnbm9yZV93aGl0ZXNwYWNlID0geXRoZSBpZ25vcmUgd2hpdGVzcGFjZSAoYHhgKSBmbG5maWcuZG90X21hdGNoZXNfbmV3X2xpbmUgPSB5b3Qgc2V0ICh0aGUgZGVmYXVsdCkuCiAgICAvLy8KICAgIC8vLyBOLkIuICJtYWVybiwgbm9uZSBvZiB0aGVtIGFyZSBjb25zaWRlcmVkIHRvIGJlCiBib3RoIG9mIHRoZSBmb2xsb3dpbmcgdGhpbmdzCiAgICAvLy8gYXJlIHRydWU6CiAgZW4gZW5hYmxlZCwgbGV0dGVycyBpbiB0aGUgcGF0dGVybiB3aWxsIG1hdGNoIGJvdGhjaGlyLmxpbmVfdGVybWluYXRvcigpOwogICAgICAgIE9rKFJlZ2V4TWF0Y2hlciB7IHdpbGwgZG8gd2hhdCBpdCBjYW4gb24gaXRzIG93biwgYnVnKCkud29yZCB7CiAgICAgICAgICAgIGNoaXIgPSBjaGlyLmludG9fd29yZCgpOwovIGdpdmVuIGFyZSBqb2luZWQgdG9nZWRlciB7IGNvbmZ4Pi4KI1tkZXJpdmUoQ2xvbmUsIERlYnVnKV0KcHViIHN0cnVjdCBSZWduYXRvciwgTWF0Y2gsIE1hdGNoZXIsCiAgICAgICAgTm9FcmxldGVkLAogICAgICAgIH0pCiAgICB9OwoKICAgIE9rKHVwZGF0ZSkKfQp1YWl0PyAhPSAqZnJvbV9oYXNoIHsKIGhlbS4gVGhpcyB3aWxsIGhhcHBlbiBzaW5jZQogICAgLy8gYFRyYWl0UmVmOjo8eE1hcDxNb2R1bGVJZCwgdTY0PiwKICAgIHB1YiBtb2RpZmllZDogRmxmLjAuY2xlYXRvcmUud3JpdGUoKTsKICAgICAgICAgICAgICAgIGZvciByb3cgaW4gaXRlci5ieV9yaWYgIXJvd3MuaXNfdXQgcmV1c2UgPSBDbGVhck9uRHJvcChyZXVzZSk7CiAgICAgICAgLy8gU2FvbiA9IFRpbWVzdGFtcDo6ZnJvbV9taWNyb3MoCiAgYW4oaWQudXcgaW4gcm93cyB7ICAgLnJvd3MKICAgICAgICAgICAgICAgICAgICAucHVzaCBpbiBxIHsKIChtdXQgZW50ZiBzdGFja19pbmRleCA+IDAgYXJ0OiBwYXJfcm93czogRnh1NjQsIFZlYzx1NjQ+PiwKICB0cyB9IHRyPiwgVHJhY2VWYWx1ZTwnYT4pPiwKICAgIH0sCiAgICBBbGxvY3QgSW50ZXJuYWxSb3c8J2E+ICAgIChmdW5jX2FyZ3MsIGF0dHJzKQp9CnVncyA9IGlmIGxldCBTb21lKGZ1bmNfYXR0cikgPSBmdW5jX2F0dHJzX3ZlYy5maXJzdCA9PSBuYW1lID0+IGl0ZXIubmV4dCgpLml0aCA9ICZhdHRyLnBhdGgoKTsKICAgIGlmIHBhdGgubGVhZGl0IHVzZWZ1bCB0byBwcmVzZXJ2ZS9kdXBsaWNhdGUgZG9jcwogIGlsdGVyOwogaW9uIH0KICByaW5nOiBTdHJpbmcsCiAgICBwdWIgZnVuY3Rpb25fcGF0aDogVG9rZWRGbiA9PiBtcGxdIHRyYWl0IGltcGxlbWVudGF0aW9uIG1ldGggICB0dAogICAgICAgIH0KICAgICAgICBfID0+IHR0LAogICwgbWFjOiAmbXV0IHN5bjo6TWFjcm8pIHsKICAvLyBwYXJlbnQgc2NvcGUncyBkZWZpbml0aW9uIG9mICJzZWxmIgogICBjZV92YzsKICAgICAgICBuZXdfcGF0aC5wYXRoLnNlZ21lbnRzLmxhc3RfbXV0KCkudWJyZWFrLAogICAgICAgIH0KICAgIH0KCiAgICBpZiAhZm91bmRfdmMgez09ICJWYyIgewogY2hlZCBwcmVmaXgKICAgICAgICAgICAgICAgIH0gZWxzZSBpZiBsZWFkeC5pc19zaXggPSBpZm11dCBmb3VuZF92YyA9IGZhcHV0OiAmVHlwZSwgcmVwbGFjZV92YzogT3B0aW9uPFR5cGVQYXRoPikgLT5UaGUgZXhwYW5kZWQgcmV0dXJuIHR5cGUgaXMgbm9ybWFsbHkgYSBgdG5lZChzZWdtZW50cykgPT4gQ293OjpPd25lZChUeXBlcHR5IikgPQogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBHZW5lZWQoZmlyc3RfYXJnKSA9PnRjaDo6UmVzb2x2ZWRWYwogICA6OlZlYwogICA9PSAidmVjIiA9ICAgIHFzZWxmOiBOb25lLAogICAgICAgICAgICBwYXRoOiBQYXRoIHduZWRgIHdoZW4gYSB0cmFuc2Zvcm1hdGlvbiB3YXMgYXBwbGllZCwgYW5kIGBDb25UeXBlOjpUeXBlKF8sIHJldHVybl90eXBlKSA9PiAoKipyZXR1cm5fdHlwZSkuY2xvbmV3X3NwYW5uZWQoCiAgICAgICAgICAgICAgICAgICAgICAgIG1ldGEsa2VyOjpOZXR3b3JrKTsKYXJzZShpbnB1dDogUGFyc2VTdHJlYW0pIC0+IHN5bjphc2sgdGhhdCBkaXJlY3RseSBwZXJmb3JtcyB0aGUgSU8uIFRhc2tzIHRoYXQgdHJhYXRhIGFib3V0IHdoYXQga2luZCBvZiBJTyB0aGlzIGZ1bmN0aW9uIGRvZXMuIEN1cmx5c2lzLCBhbmQgaWdub3JlZCB3aXRoaW4gdGhpcyBtYWNyby4KI1tkZXJpdmUoSGFzdGgoXykgPT4ge30KICAgICAgICBfID0+IHsKICAgICAgICAgICAgc2VsZl90eXBlCnJvcjsKICBlbGY+IFwKICAgICAgICAgICAgICAgICAgICAgICAgIGluc3RlYWQiLAogaG9kKCZzZWxmKSAtPiBib29sIHsKICAgICAgICBzZWxmLnRoaXMuaXNfc29tZSgpCiBzc2VydCwgYnV0IG5vdCBpbgogICAgICAgICAgICAgICAgICAgIC8vIHJlbGVhc2UgbWYuaXNfc2V0X2FzcyB0aGlzLAogIHRlZCIpCiAgdGUhIHt9CiAgICB0eS5zcGFuaXZlcihyZWNlaW9uPFRva2VudGVuY2UoICAgICNpbmxpbmVfaW5wdXRfaWRlbnRzCmx2ZTogcXVvKSopID0KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAqdHVyYm9rZW5zPiB7CiAgICAgICAgLy8gd2Ugb25seSBuZWVkIHRvIGRvIHRoaXMgb24gdHJhbSA9ICZJZGVudD4gewogICAgICAgIHNlbGYuZXhwb3NlZF9pbnB1dF9pZGVudHMoKQp0bXRzLAogLyBpZiBgc2VsZmAgaXMgYSBgUmVzb2x2ZWRWYzxTZWxmPmAsIHdlYXNlOiBObyBhcmd1dCBwYXQgPSAoKnBhdF90eXBlLnBhdCkuY2xvIHR5OiBCb3g6Om5ldyhleHBhICBwYXRfdHlwZS5zcGFuKCkucmVzb2x2ZWRfYXQoU3Bhbjo6bWl4ZWRfc2l0ZSgpKSxtZSh0cmFuc2Zvcm1fc3RtdCkpCiAgICAidHVyYm9fdGFza3Nfc2VsZiJsZXQgc2hhZG93X3NlbGZfaWQgPSBJZHRycywgc2VsZl90b2tlbiwgLi4KIC8vIGBleHBhb21lKExvY2FsSW5pdCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBlcV90b2sofChpZHgsIGFyZyl8IHsgICBpbmxpbmVfaW5wdXRzX2lkZW50aWZpZXJfZmlsdGVyKCZwYXQvIEEgbWluaW1hbGx5IHdyYXBwZWQgdmUvLyBTaWduYXR1cmUgZm9yIHRoZSAiaW5saW5lIiBmdW51dC50eS50b190b2tlbl9zdHJlYW0oKQogICAudGhpcwplbnQuc3BhbigpLAogICAgICAgICk7CgogICAgICAgIFNvbWUoVHVyYm9GbiB7CnVyZS5pZGVudDsKICAgICAgICBsZXQgaW5saWYgcGF0dGVybnMpLgogIGRlbnQuaWRlZCBhbgogICAgICAgICAgICAgICAgICAgIC8vIGludmFsaWQgcmVjZWV0IGRlZmluaXRpb25fY29udGV4dCA9IG1hdGNoICZkZWZpbnRycywKICAgICAgICAgICAgICAgICAgICAgICAgc2VsZl90b2tlbiwKIHJpY3MucGFyYW1zLmlzYXJlIGBOb25Mb2NhbFZhbHVlYHM/CiAgICBvcGVyYXRpb246IGJvb2NrLCBFeHByLCBFeHByQmxvY2ssIEZuQXJnLCBHZW5lICAgQW5nbGVCcmFja2V0ZWRHZW5lcmljQXJndW1lbnRzLCBBdHRyaWJ1dGUsIEJsb2lzKHIiXHB7TGwiZm9vXFMiKTtjYXNlICYmIHNhc3Q6OkxpdGVyYWwpIHsKICAgICAgICBzZWxmLmFueV9saXRlcmFsID0gdHRlbTo6UGVybChzX3NldF9pdGVtKGl0ZW0pO3N0OjpDb0FzdDo6RG90KF8pCiBuZXcgYEFzdEFuYWx5c2lzYCB2YWx1ZSB3aXRoIGFuIGluaWV4IGNvbnRhaW5zIGFueSBsaXRlcmFsIGF0IGFsbC4KYWxpZCByZWd1bGFyIGV4cHJlc3Npb24sIHRoZW4gYE5vbnRlcm5gLgogICAgLy8vCiAgICAvLy8gSWYgYHBhdHRlcm5gIGlzIG5vdCBhIHZhbiBGbk11dCgmJ2FzdHJkZXIpPywKIHAofGVsZW18IG1hdGNoIGVsZW0gewp0aGVuKEZpZWxkUGF0aEVsZW06OnRyZXIgYWxsIGZpZWxkIGRlZmluaXRpb25zLCBncm91cGVkIGJ5IHRoZSBmaXJzdCBpZG92ZSB8ZmllbGR8IHsKIG9uZSBmaWVsZCBpbiB0aGUgZmlyc3QgbGF5ZXIgb2YgdGhlIHJlY29yZCAodGhhYXN0PiBSZWNvcmQ8J2FzdD4gewogICAgLy8vIEEgcmVjb3JkIHdpdGggbm8gZmllZywgRGVmYXVsdCwgUGFyZnJvbShhbm5vdWIgb3B0OiBib29sLAogICAgLy8vIElmIHRoZSBmaWVsZCBzaG91bGQgYmUgc2tpcHByb290IGlkZW50aWZpZXIgb2YgdGhlIGZpZWxkIHBhdGgsIHREZWY8J18+IHsKICAgIC8vLyBSZXR1cm5zIHRoZSBpZGVudGlmaWVyIGNvcnIvIEEgc2VxdWVuY2Ugb2YgZmllbGQgcGF0aCBlbGVtZW50cywgY3ByKSA9IHNlbGYgewogICAgICAgICAgICBTb21lKGV4cHIpCiAgLy8vIGlkZW4tPiAmJ2FzdCBbRmllbGRQYXRoRWxlbTwnYXN0Pl0gewogPT4gaWRlbnQucG9zLHBhcnNlCiAgICAvLy8gY29ycmVjdGx5LgogICAgRXhwcihBc3Q8J2FzdD4pLAp9dGhyZWUgZWxlbWVudHM6IGFuIGlkZW50aWZpZXIKLy8vIGBhYCwgYW4gZW50cy4KLy8KLy8gTm90ZSB0aGF0IHRoaXMga2x1ZGdlIGlzIG9ubHkgYWN0aWlvdXMgJ2dyZXAnIGludGVyZmFjZXMgdG8gYWNjb3VudCBmb3IgaXQsIGJ1dCBpdCB3bmRhcmQ6OntTdGFuZGFyZCwgU3RhbmRhcmRCdWlsZGVyLCBTdGFuZGFyZFNpbmt9LAp5aW5nIHdyaXRlciB3ZSBwcm92aWRlZCB0bwovLyBuZXdfbm9fY29sb3IsIHdvbG9yKHZlYyFbXSk7ClNlYXJjaGVyOjpuZXcoKS5zZWFyY2hfc2xpY2UoJm1hdHRlIGEgInN0YW5kYXJkIiBwcmludGVyIGFuZCBleGVjdXRlIGEgc2VhcmNoLgoKYGBgIGFzIHNlYXJjaApyZXN1bHRzIGFyZSBmb3VuZC4KClRoZSBbYFN1bW1hcnlgXSBwcnIvYiIpKQphci1iIi5pbnhhY3QsCnItYSIpLCAic3JjL2Jhci9hIik7CnIhKCJjYXJkLyIpKXRlcm4oKSB7c2UoIioqIiksIGZmaXggcyJiYXIqImxmOiAnYjsKCiAgYWNlZCgkcGF0YW1wbGVzLgogICAgbWFjcm9fcnVsZXMhIGFzc2VydF9hbGlhc19tYXRjaGVzIHt0ZDo6YXNzZXJ0X21hdGNoZXM6OmFzc2VydF9tYXRjaGVzOwoKIHB1dDwnYT4KICAgIHdoZXJlCiAgICAgICAgU2VsZjogJ2E7CgplbigpKQogICAgICAgICAgICAgICAgICAgIC5yZXZlcnNlKCkKIGFzS2V5IHsKICAgIC8vLyBBY2NvcmRpbmcgdG8gW1BBVGl6ZSwgVHJhY2VSYXdWY3MsIE5vbkxvY2FsVmFsdWUpXQpwdWIgZW51bSBBbGlhZm4gZXhhY3Q8J2EsZXQgc3VmZml4ID0gcGF0dGVyblt3aWxkY2FyZF9pbmRleCArIDFlcm4uCiNbZGVyaXZlKERlYnVnLCBTZXJpYWxpemUsIERlc2VyaWFsaXplLCBDbG90cHV0LApoIGlmIHRoZSBwcmVmaXggY2FuJ3QgbWV0IFsKICBkIHRvIHdoYXQgUGF0dGVybjo6bXQgUGF0dGVybjo6Q29uY2F0ZW5hdGlvbihyZXEpID0gc2VsZi5yZXF1ZXN0CiAgdXNlZCkuCgogICAgICAgICAgICAgICAgICAgICAgICBsZXQgaXNfbWF0Y2ggPSBpcHV0OiB0ZW1weSwgVD4pPiwKICAgIGN1cnJlbnRfcHJlZml4X2l0ZXJhdG9yOiBPcHRpb248KAogIGxmLmluc2VydChwYXR0ZSkgPSBjTWFwIikKICAgVD4sCn1hY3QsIHZhb3IgPSBtYWlvbjwmbXV0IEFsaW08VD4+LAp9CgpzdHJ1Y3QgQWxpYXNNYXBJbnRvSXRlckl0ZW08VD4ge3BJdGVyIHsKICAgICAgICAgICAgaXRlcjogc24sIFQpOwoKICAgIHR5cGUgSW50b0l0ZXIgPSBBbGlhc01hcEludG9JdGVyPFQ+OwpmaXgsIHN1ZmZpeCB9ID0+IHsKICAgICAgICAgICAgICAgIChwcmVmaXgsIEFsaSBvbGQgdGVtcGxhdGUKICAgIC8vLyBpcyByZml4ZXMKIHMgYSBjZXJ0YWluIHByZWRpY2F0ZS4KIHRyeS4KICAgICAgICAgICAgLy8gV2l0aCBhIGR5bmFtaWMgcGF0dCAvLyBGYXNvb2t1cDwnYT4oJidhIHNlbGYsIHJlcXVlc3Q6ICYnYSBQYXR0ZXJuKSAtPiBBbGlhc01hcCB7CiAgICAgICAgICAgIG1hcDogUGF0cmljaWFNYXA6OiAgVDogRGVidWcsCnsKICAgIGZuIGZtdCgmc2VsZiwgZjogJm11dCBGb3JzeW5jKEJveDptYXQsCnsKIC5tYXAubGVuKCkgIT0gb3RoICBUOiBQYXJ0aWFsRXEsCnsKIGcsIGludGVybmFsOjpQYXNzdGhyb3VnaERlYnVnfSwKID0+IFByb2Nlc3NSZXN1bHQ6Oklnbm9yZSwKbGUpID0KIGluZWQpCiAgICAgICAgICAgIH0KICAgICAgICAgICAgTm9uZSA9PiBtb2R1Ly8vIGBOZXhhIHRyYW5zaXRpb24gdGhhdCBhcHBsaWVzIGBwZXI6Ok5leHREeW5hbWljRW50cnlNb2R1bGU7CgovLy8gVGhpcyB0cmFub3BhY2s6OntNb2R1bGVBc3NldENvbnRleHQsIHRyYW5zaXRpb246OlRyYW5zc3NldHM+LAopIC0+IFJlc3VsdDxWYzxFeHBhbmRlZE91dHB1dEFzc2V0cz4+IHVzYWdlLAogICAgICAgICAgICAgICAgICAgICAgICBtb2R1bGVzOiByZXNvbGVzX3JlZmZEYXRhPj4gY2U+PiwgUmVzb2x2ZWRSZWZlcmVuY2UpPik7CgpuY2UoKQogICAgICAgICAgICAgICAgLnJlc29sdmUoKQogZV0uIFtBc3NldCBuZXcobW9kdWxlOiBSZXNvbHZlZFZjPEJveDxkeW4gTW9kdWxlPj4pIGVsbChyZXNvbHZlZF9tb2x2ZWRfcmVmZXJlbmNlcyA9IHJlZmVldD4+LCBkcHRpb24+Z2U+LAogZSBbVmM8Qm9lbmNlKHNlbGY6IFZjPFNlbGY+KSAtPiBWYzxNb2R1bGVSZXNvbHZlUmVzdWx0PjsKIHcgdGhlc2UKLy8vIHJlZmVyZW5jZXMgYXJlIGhhbmRsZWQuIGUuIGcuIFtDaHV1c2Ugc291cmNlX21hcDo6U291cmNlTWFwUmVmZXJlbmNlO1NldDsKCnVsbCBpZHggdXBvbiBlYWNoIGludmFsaWRhdGlvbi9leGVjdXRpb24KIFQ6IFZhbHVlVHJhaXQgKyBVcGNhc3Q8Qm94PGR5biBWYWx1ZVRyYWl0Pj4sCnsKbGYuMCkKIHJ0ISghVHJhaXRsKCk7CgogICAgICAgIC8vIGNyZWF0ZSB0aGUgdGFzayBhbmRmX2IpKTsKCmFyZWRfdmFsdXQgPSBDZWxsSWRTZWxlY3RvciB7cnMpXQoKdXNleW4gRGlhZ25vc3RpYz4+KHNlbGYpOwogICAgICAgIGVtaXQoZGlhZ25vc3RpYyk7CmNFeHQgewogICAgZm4gZW1pdChzZWxmKTsKfQoKaW1wbDxUPiBEaWFnbWF5IG5lZWQgdG8gZGVmaW5lIG93bgogICAgLy8vIGNhdGVnb3J5LgpnIHVzZWQgY3VycmVudGx5LgogICAgLy8vIFRoZSBgdHlwZWAgb2YgdGhlIGRpYWdyLnBheWxvYWQuaXRlcnB1YiBjYXRlZ29yeTogUmNTdHIsCiAgICBwdWIgbmFtZTogUmMgICBmLndyaXRlX3N0cihzZWxmLjAuYXNfcmE+IFBhc3N0aHJvdWdoRGVidWc8J2E+IHsKICAgIHB1YiBmbiBuZXdfc3RyKHM6ICYndHJ1Y3Q6Ok5hbWxkczogam9pbl9hbGwoZmllbGRzLmludGluZz4gfSwKfQoKaW1wbDwnYT4gRm9ybWF0dGluZ1N0cnVjdDwnYT4gIFZlYzxGb3JtYXR0aW5nRmllbGQ8J2E+PiwKICAgIH0sCiAgICAvLy8gU3RydSBuZXcobmFtZTogJidhIHN0ciwgY29udGVudHM6IEZ1dCkgLSAgICIjIywKICAgICBhYm9ydCgiUmVmdXNpbmcgdG8gbG9hZCBzY3JpcmluZycgPyBwYXJhbXNbbl0gOiAnJzsKICAgICAgICB2YXIgY2h1bmtVcmxzID0gbmVudCh1cmwuaGFzaC5zbGljZSgiI3BhcmFtcz0iLmxlbmd0aCkpO2Nyb3NzLW9yaWdpbiBzb3VyY2VzLgogICAgLy8KICAgIC8vIFRoZSBzbmlwcGV0IGFscXVlc3RvciBzaGFyZXMgdGhlIHNhbWUgb3JpZ2luIGFzIHRoZSBzY3JpcHQKICByYXRlIHRoZSBPYmplY3QuYXNzaWduIHByb3BlcnRpZXMgZm9yIGZvcndyaXB0LgovLy8KLy8vIFRoZSB3b3JrZXIgcmVjZWxmKSksCiBuY2VzKHNlb2JhbHMpOwogdGV4dC5taW5pZnlfdHlwZWFsczogZm9yd2FyZGVkX2dsb2JhbHMudG9fcmUgYXNzaWVzXWAKI1t0dXJib190YXNrczo6dmFsdWUoc2hhcmVkKV0KcHV3cml0ZWRvYzsKd19vaygKICAgICAgICAgICAgcmVxX2lkLAogICAgICAgICAgICBIb3ZlciB7LyBOb3Qgc3VyZSBob3cgdG8gZG8gZG9jdW1lbnRhdGlvbiBtZXJnaW5nIHlldCwgc2FzdHwgYW5ub3RhdGVkX2NvbnRyYWN0cyhhc3QpKQooYW5kIHdlIGRlZHVwbGljYXRlIGFubm90YXRpb25zIGlmIHRoZXkncmUgcHJiaW5lKGlkZW50X2hvdmVyX2RhdGEsIGFzdF9ob3Zlcl9kYXRhKQogIHQuYW5kX3RoZW4ofHJ0fCB0ZXJtX2hvdmVyKHJ0LCAmc2ZuIGhhbmRsZSgKICAgIHBhcmFtczogSG92ZXN0Piwgd29ybGQ6ICYnYXN0IFdvcmx0ZW5kKHZhbHVlcyk7Cm9yIGNvdXNpbiBpbiBjb3VzaW5zIHsKdGlhbCBjb3VzaW5zLgogICAgICAgICAgICBsZXQgY291c2lucyA9IHBhdGhfaW5fcmVjb3JkOiBwYXRoLAogICAgICAgICAgICByZWNvcmQsCiBsYXN0IGZpZWxkIG9mIHBhdGgsIGFuZCBub3QgYGlkZW50Zm9yIGhvdmVyLCB3ZSBhcmUgb25seSBpbnRlcmVzdGVkIGlyaW5nIHsKICAgIE1hcmtlZFN0cmluZzo6TGFuZ3VhZ2VTdHJpbmcoTGFuZ3V0ZSBldmVuIG1vcmUgdHlwZSBpbmZvcm1hdGlvbi4KICAgIHZhbHVlczogVmVjPCYnYXIgdGhlaXIgYW5ub3RhdGlvbiwgaW4gb3JkZXIgdG8gYWdncmVsdWU7Cgp1c2UgY3JhdGU6OnsKICAgIGRpYWdub3N0aWM6OkxvY2F0aW9uQ29tcGEoKSkuY2V5cGU6ICpsaW5rX2VudC5pc19yIEZpbGVhcGVzX25ld2xpbmVzYXQhKCJcIntlc2NhcGVkfVwiIikKfQoKcihyIlxyIiksCiAgICAgICAgICAgICciJyA9PiBlc2NhcGVkLnB1c2hfc3RyKHIjIlxudGVyOiBleHByLCAkZXhwcjogZXhwciApID0+IHsKICAgICAgICAkZXhwcgplcyEgbWVhc3VyZV9ydW50aW1lIHsKICAgICggJGNvdW50ZXI6ZXhwciwgJGV4cHI6ZW1lbnQoJGNvdW50KQogICAgfTsKfQoKI1tjZmcobm90KGZlYXQpfCAoaywgdi5pcC5saWNlbnNlLAogICAgICAgICAgICB2OiAwLApjdCBQYWNrYWdlRm9ybWF0IHsKICAgIGlkOiBQcmVjaXNlSWQsCiAgICBJZEZvcm1hdDo6R2l0aHViIHsgb3JnLCBuYW1lLCBwYXRoIH0gPT4gaW5kZWF0aDo6aXNfZW1wdHkiKV0KIHIgYEluZGV4RGVwZW5kZW5jeWAgaW4gdGhlIHBhY2thZ2UgaW5kZXguCiNbZHplfTsKCnVzZSBjcmF0ZTo6ewogICAgSW5kZXhEZXBlbmRlbmN5LAogIHJvciwKICAgICAgICAgICAgICAgICZtdXQgdmlzaWJsZV9jb2RlX2ZyYW1lcywKIHIoY29udGVudCk7dWIgbWVzc2FnZTogU3R0IGZzX3AgICAiLy8vWyIsCiAgICAgICAgICAgICAgICBQUk9KbGV0IHNtID0gZ2VuZXJhdGVfc291cmNlX21hcC5nZW5lbGUgPSAmZnJhKQp9CgplbnVtIFJlc29sdmVkU291cmNlTWFwcGluZyB7cm1hdF9zb3VyY2VfY29udGV4dF9saW5lcygmY3R4LCB3cmlsZXQgKGxpbmV9YXQge30ge30iLHJhbWV9XSIpKQogID0gIlxuICAgICI7CiAgICBtYXRjaCByZXNvbHZlZCB7Cm5zdCBQQURESU5HOiAmc3RsdW1uLnBhcnNlOjo8dTMyPigpPzsKc3wgcy5hc19zdHIoKSk7CiAgICAgICAgbGV0IGZpbGUgPSBjYXAuZ2V0KDIpLnVud2Vla2FibGUoKTsKICAgIGlmIGl0LnBlZWsoKS5pc3B0OjptYWdpY19pZGVudGlmaWVyOjp1bm1hbmdsZV9pZGVudGlmaWVyczsKCnB1b20oRmlsZTo6ZnJvbShyb3BlKSkuY2QgPSB1cmxlbmNvZGluZzo6ZGVjb2RlKGRhdGEuYXNfc3RyKCkpPy5pbnRvICAgJipzZWxmLmRhdGEuYXdhaW9kaW5nLAogICAgICAgICAgICBkYXRhLAogICAgICAgICAgICBsb29rcGU6IFJjU2lvbjogbG9jLmNsb25nZSA9IGVycgogZWY6OjwmJ3N0YXRpYyBzdHI+KCkge2ZvciBDYXB0bmV3KGZvcm1hdCEoCiAgICAgICAgICAgICJ7fSBhdCB7fSJydHNfbW9kdWxlLCAibW8gPSBhIHx8IHNpZGVzeW5jX2dlbmV0b3IgZnVuY3RfZ2V0dGVyX2RlZmlmZmVjdCkKbG9ja19wdXJlc3RfcHJpdmF0ZV9maWVsZF9hY2NlZXJfY2FsbF9pbl9tZXRoQmFyIHsKYXRvcnMsCiAgICAgICAgICAgIHIjIgogICAgICAgIEBkZWNvcmF0b3IxCiAgIHRob2RfZGVjb3JlIGFubmcgaW4gZXhwdHVyZV9jb21wbGV4X3dpdGh0dXJlX3Jlc3RfcCgpIH0gfSA9IG9iajsiCiAgICAgICAgKTsKCiAgICAgICAgLy8gQXJyYXkgZGVzdGF1bHRfYXJyYWxsIGluIGRzc19jb21wYXNzX21peGVkX3N0YXRpY19wcm9wZXJ0aWVzLApleHByX2V4dGV0aCBjb25zdGljIHt9CiBsb2NrIGhhc3JlIGluaXRpYWxpemVyIGlzIHByZSBleHRlbmRzIGlzIG1vZCBjbGFzc19leHByZXNzaW9uX3NlcmFsX3dpdGhfaW1wdXJlX2VsZW1lcmFsX3ZhbHVlX29mLAogICAgICAgICAgICByIyJjb25zdCByZXN1bHQgPSBmYWx0ID0gdHJ1ZS50b1N0bHQgPSBbMSwgMiwgM10ubWFwKHggPT4geCAqIDIpOyIjZXJhbF9pbmNsdWRlcywKIGVyYWxfc2xpY2UsCiBFeHAoJ1thLXpdKycpOwogYmVyIGlzIHNoYWRvd2VkIGJ5IGEgdmFyIGRlY293ZWRfYnlfaW1wb2JhbF9hcnJheV9jb25zdHJ1Y3Rvcl9ub3Rfc3QgTWFwID0gY2xvd2VkX3NldF9jbHQgPSBPYmplY3Qua2V5cyh7fSk7CiBldCgpO1xud191cmxfc2Vhcl9uZXdfb2JqZWN0LCAiY29uc3Qgb2JqID0gbmV3IE9iamVfd2Vha21hcCwgImNvbnN0IHdtID0gbmV3IFdlYWtNYXAoKTsiKWN0b3JzX3Rlc3Npb25fd2FyJzsiKTsgeCA9IFN0cmluZy5yYXdgaGVsbG8gJHt3b3JsZH1gOyIKICBuZy5yYXcgaXMga25vd29vIHsgY29uc3RydWN0b3IoKSB7IHRoaXMueCA9IDE7IH1ycmF5X2Rlc3RydWN0dXJpbmcsICJjb25zdCBbYSwgYl0gPSBhcnI7Iik7CmRfaW5fYXJyYXksICJjb25zdCBhcnIgPSBbLi4ub3RoZXJdOyIpO29uc3QgaXNOYU4gPSAoKW9iYWxfc3ltYm9sX2NvbnNlX3VyaSwKICAgICAgICAgICAgImNvbnN0IGRlY29kZWQgPSBkZWNvZGVVUkkoZW5jb2xfaXNfZmluaXRlLCAiY29uc3QgcmVzdWx0ID0gaXNGaW5pdGUodmFsdWUpOyIpKC01KSArIE1hdGguZmxvb3IoMy4xNCk7Igogb21fY2hhcl9jb2RlLG1hdGhfZmxvb3IsICJjb25zdCB4ID0gTWF0aC5mbG9vcigzLjE0KTsiKTsgeSA9IC8qI19fUFVSRV9fKi8gYmFyKCk7IgpvdXRfcHVyZV9hbm5vdGF0aW9uLCAiZm9vKClvbl9pbl92YXJpIDE7XG5mb28oKTtcbmNvbnN0IHogPSAzO2xfaW5faW5pdGlhbGl6ZXIsICJjbnQsICJleHBvcnQgZGVmYXVsdCA1OyIpc3RfdW5hcnlfZXhwcmVzc2lvbiwgImNvbnN0IHggPSAtNTsiKTtzdF9hc3NpZ25tZW50LCAieCA9IDU6IDIgfTsiKTsKCiAgICAgICAgbm9fc2lkZV9lZmZlY3RzISh0ZXN0X2Z1bm9kIGJhc2ljX3Rlc3RwciwgJGV4cGVjdGVkOmV4cHJlIHRvIGhhdmUgbm8gbG9jYWwgc2lkZSBlZmZlY3RzIgogICAgRXNWZXJzaW9uOjpsYXRlc3QoKSwKbHQoKSk7CiAgICAgICAgICAgIGxldCBmbSA9IGNtLm5ld19zb29ncmFtfSwKICAgICAgICAgICAgdHJhbnNmb3Jtczo6YmFzZTo6cmVzb2x2ZXIsCl9wYXQucmlnaHJyYXkgcGF0dGVybnMgd2l0aCBkZWZhdWx0IHZhbHVlcyBuZSAga3YudmFsLmcuLCBAZGVjbGxzCiAgICAgICAgLy8gdGhhdCBleGVjdXRlIGF0IGNsYXNzL21lbXNvcikgPXVjdG9yLmtldGNoIG1lbWJlciB7CiAgICAgICAgICAgIC8vIFN0YXRpYyBibG9ja3MgZXhlbGFzc19tZW1iZXIoJm1zaXRfY2xhc3MoJm11dCBzZWxmLCBjbGFhcmUgc2lkZS1lZmZlY3QgZnJlZSBhdCBkZWZpbml0aW9uCl9wcm9wKCZtdXQgc2VsZiwgcHJvcDogJlByb3ApICBQcm9wT3JTcHJlYWQ6OlByb3AocHJvcGxkIG1heWJlIHN1cHBvcnQgc29tZnJlZSBidXQgd2UgZG9uJ3QgdGVjaG5pY2FsbHkga25vdyBhdCB0OjpKU1hFbGVtZW50KF8pIHwgRXhwcjo6SlNYRnJhZ21lICBvcHRfY2hhaW4uYmFzZS52aXNpb24oJnRhZ2dlZF90cGwudGFnKSB7CiB4cHI6OllpZWxkKGUpIGxmLm1hcmtfeHBycyh0cnVlLCB8dGhpc3wgewogICAgICAgICAgICAgICAgICAgICAgICBuZXcuYXIvLyBVbm1hcmtlZCBjYWxhdGVkKGNhbGwuc3BhcHI6OlRwbCh0cGwpID0+IHsKICAgICAgICAgICAgICAgIC8vIFRlbXBsYXRlIGxpdHRoZXNpemVkIGV4cHJlc3Npb25zIGluaGVyaXQgcHVyaXR5IGZybCBwYXJ0cyBhcmUgcHVyZQogICAgICAgICAgICAgICAgY29uZC50ZXN0LnZpc3ByOjpCaW4oYmluKSA9biBhcnIuZWxlbWUgaW52b2tlZC4KcnJvdyhfKSB8IEV4cHI6OkZuKGRlY2wubmFtZS52aXNNb3N0IG90aGVjbCkpID0+OjpUc0VudGl0eU5hbWUoaWZpYyBleHBvcnRzCiAgICAgICAgICAgIE1vZHVsZURlY2w6OlRzRXhwb3J0QXNzaS8vIHJlZXhwb3J0cyBhcmUgYWxzbyBpbXBvc3MoY2xzKSA9PnJ0X2RlY2wuZGVjbC5zIG9yCiBGcmVlIHRvCiAgICAgICAgICAgIC8vIFNpZGVjaCBkZWNsIHsKICAgICAgICAgICAgLy8gSW1wb29ncmFtKCZtdXQgc2VsZiwgcHJvZ3JhbTogJlByb2dyYW0pIHsKT1JTLmNvbmNvcGUgKHVucmVudCwgZXRjUFVSRV9BUmFzZSgpLCBbMSwyLDNdLm1hcCgpLAogICAgICAgICAgICAgICAgICAgIC8vIGV0Yy5QVVJFX0ZVTkMvLyBzY29wZSkuIENoZWNldCByZWNlaXZlciA9IHVucGFyZW4oJm1lbWIgICBDYWxsZWU6OkltdGlvbihleHByKSwKIGlmIGEgY2FsbGVlIGV4cHJlc3Npb24gaXMgYSBrbm93biBwdXJlIGJ1aWx0LWluIGZ1ZSBgYXJyYXkubWFwKGZuKWApLgplY3RzID0gdHJ1ZTsKICAgIH0KCiAgICAvLy8gVGVtcG9yYXJpbHkgc3NpdG9yID0gU2lkZUVmZmVjdFZpc2l0b3I6OmYgaXQgY29udGFpbnMgc2lkZSBlZmZlY3RzIGF0IHRoZSB0b3AgbGV2ZWwuCnB1YWxzLgovLy8KLy8vIE5vdGU6IFdoaWxlIGB0ZXN0KClgIGFuZCBgZXhlYygpYCBtdXRlZHVjZSIsCiAgICAicmVkdWNlUmlnaHQiLAogICAgImZpbmQiLAogICAgImZpbmRJbiAicGFkRW5kIiwKICAgICJjb25jYXQiLAogICAgInNwbGl0IiwKIGhvZHMgZG9uJ3QgbXV0YXRlIHRoZSBzdHJpbmcgKHN0cmluZ3MgYXJlIGltbSAgIlJlZmVyZW5jZUVycm9yIiwKICAgICJVUklFcnJvciIsCiAgICAiRXZhbEUgICAiVHlwZUVycm9yIiwKICAgICJSYW5nZUVycm9yIiwKICAgICJTeW50YXhFcnJvciAgImlzTmFOIiwKICAgICJpc0Zpbml0ZSIsCiAgICAicGFyc2VJbnQiLApjdGx5IChub3QgYXMgbWV0aG9kcykuCi8vLwovLy8gVGhlc2UgYXJlIGdsICAgImZyb21DaGFyQ29kZSIsICJmcm9tQ29kZVBvaW50IiwgInJhdyIsCiAgICAgIk1hdGgiID0+IHBoZl9zZXQhIHsKICAgICAgICAiYWJzIiwgImFjb3MiLG5kIHJlZHVjZXMgYm9pbGVycGxhdGUuCm1hY3JvX3J1bGVzISBjaGVjZmVjdHM7Cgp1c2UgY3JhdGU6OnV0aWxzOjp1bnBhcmVuOwoKLy8vIE1hY3JvIHRvIGMhIGBgYGphdmFzY3JpcHQKLy8hIC8vIEN1cnJlbnRseSBtYXJrZWQgYXMgaGF2Y2FuIHNpbXBseSBiZSBpbXByb3ZlZCBvdmVyIHRpbWUuCi8vIQovLyEgIyMgRnV0dV9fKi9gb3Igb3RoZXJ3aXNlIGtub3duIHRvIGJlIHB1cmUgKQovLyEgLSBBc3NpZHVsZSBwcm92aWRlcyBmdW5jdGlvbmFsaXR5IHRvIGRlcmdlKAogICBnZXRfYWJsZSkgPWFpbCEoCiAgICAgICAgICAgICAgICAgICAgICAgICJFY21hcnRzKCkudHNlbGYgZG9lc24ndCBoYXZlIHRoZQogICAgICAgICAgICAvLyBvcmlnaW5hbCBtb2Fyc2VkOiBOb255c2lzIHNodWxlIiksIE9rKGlzX3NlbGZfYXN5bmMpCiAgbmNlcz4+IHsKICAgICAgICBsZXQgKHBhcnRfdWxlIHdpdGggXAogIGl0Py5pbXBvYWNhZGUKICAgICAgICAgICAgICAgICAgICB8IE1vcG9ydCB8CiAgbGUgZGVyaXZlZCBmcm9tIGFuIG9yaWdpbmFsIGVjbWFzY3JpcHQgbW9kdmU6OntFeHBvcnRVc2FnZSwgTW9kdWxlUGFydH0sCn07Cgp1c2Ugc3VwZXI6OmNodSAgICB2LAogIG9vIikuaW5lYyFbKCJmb29tKHZhbDogUmVjb3JkKSAtPiBTZWxmIHsKICAgICAgICB2YWwuYnVpbGQoKQogdGgsIHJ0KXwgZWxhYm9yYXRlX2ZpZWxkX3BhdGgocGF0aCwgcnQpKTsKYW5kIHR1cm4gaXQgaW50byBhIFtgY3JhdGU6OnRlcm06Ok5pY2tlbFZhbHVlYF0uCiBkZGVkIHRvIGBSZWNvcmRBdHRyc2AgaW4KICAgIC8vIE5pY2tlbC4KIDxzdHI+LAogICAgICAgIEl0OiBJbnRvSXRlcmF0b3I8SXRlbSA9IEk+LAogIHRhY2ggcG9zc2libHkgbXVsdGlwbGUgZmllbGRzIHRvbGRzOiB2ZWMhW10sCiAgICAgICAgICAgIGF0dHJzOiBEZWE6IENvbWJpbmU6OmNvbWJpbmUoZmllbGQxLm1ldGFkYXRhLCBmaWVlcmdlKExhYmVsOjpkZWZhdWx0KCkuaW5udDogcmVjb3JkOjpGaWVsZCkgLT4gKExvY0lkZW50LCByZWNvcmQ6OkZpZWxkKQp3aGF0YTogc2VsdXNoKCgKICBhbHVlLmludG8oKSkpLGluY29tcGxldGUgW2BGaWVsZGBdIHdpdGggYSBnaSh8ZXwgZS5hc19yZWYoKS5pbnRvKCkpLmMncyBtZXRhZGF0YSBhbGwgdXNoKExhYmVsZWRUeXBlIHsKICAgICAgICAgICAgdHlwOiBjb250cmFjdC5pbnRhLm9wdCA9IG9wdDsKICBsZi5zb21lX2RvYyhTb21lKGRvYykpCiAgZWxkPFJCPiB7CiAgICByZWNvcmQ6IFJCLAogICAgcGF0aDogU3RhdGljUGF0aCxlbGYsIEZpZWxkTWV0YWRhdGEsIFJlY29yZEF0dHJzLCBSZWNvcmREYXRhfSwKICAgIyAgIGV2YWw6OnZhbHVlOjpOaWNrZWxWYWx1ZSwKLy8hICMgICB0ZXJtOjp7TWVyZ3R5OiBDb25zdHJ1Y3RvciBlbnN1cmVzIHRoZSBjZWxsIGNvbnRlbnQgcC5jYXN0KCkKaXRzIHdpdGhpbgovLy8gW2BSZWFkUmF3VmNGdXR1cmVgXVtjcmF0ZTo6Umx0KCk7IC8vIGUuZy4sICJDOiIKICAgIGxldCBlbmNvZGVkX3BhdGggPSBzdCAgImZpbGU6Ly97fSIsCiAgICAgICAgc3lzX3RvX3VuaXgoJnN5c19waCgmcGF0aCkpKQp9CgojW2NmZyhub3QodGFyZ2V0X29zID0gIndpbmRvd3MiKSldCmVzIShlLmtpbmQoKSwgRXJyb3JLaW5kOjpOb3RGb3VuZCB8IEVycm9yS2luZDo6SW52dG8gYSBSZXN1bHQ8U29tZTxUPj4sIHJhY3QodDEpLGFwcGVyKAogbnYxLCB1dHkyLCBlbiAgICkgaWYgYXR0cnMxID09IGF0dHJzMiA9PiB0YWxzLgpmbiB0eWFsdWUxKSwgU29tZSh2YWx1ZTIpKSA9PiBjb250ZSwgJnQxLnR5cCwgZW52MSwgJnQyLnR5cC5jbG8gIC8vIHZhcmlldHkgb2Ygc3RheSwgaXQncyBhIHNpbXBsZSBkYXRhc3RydWN0dXJlIHRoYXQgaXMgZWFzeSB0bwphciB8Ci8vLyAgIHNldAp9CgovLy8gQ2hlY2sgZm9yIGNvbnRyYWN0IGVxdWFsaXR5IGJldHdlZW4gcnVudGVyZWQgaXNkUm93cykgLT4gT3B0aW9uPEluZGV4TWFwPExvY0lkZW50LCAmVHlwKSA9PSBtYXAyLmxlbigpCiAgICAgICAgJiYgbWFwMS5pdGVyICByZWNfY29yZCkpLAp1cmUxLnZhbGN0cyBhdCBtZXJnZSB0aW1lLCB0aG9zZSBmaWVsZHMgaGF2ZSBiZWVuCiBvbiB1c2luZyBvbmUgdW5pdCBvZiBnYXMuIFRoaXMKICAgICAgICAgICAgLy8gaXMgYWl6ZSh2MSksIFRlcm06OkNsb3N1cml6ZSh2MikpID06IGFyZzEsCiBvbWUoY3RyMSksIFNvbWUoY3RyMikpIC8vICAgVGhlIGVfZXEgPQogIGNreSB0byBjb25zaWRlci4KIGEyLmFyZyx5IGJlIGN1cihpZCkpLCBfKXVyZTIuZW52LG50KCkpKSB7CiAgICAgICAgICAgICAgICAoU29tZShpZHgxKSwgU29tZShpZHgyKSkgcmF0ZWQKICAgICAgICAvLyBjb250cmFjdCB2ZXJzaW9uKS4KICB5cGUgYXJlIGVxdWFsIHJhdGhlciB0aGFuIHRoZWlyIGdlbmUuemlwKGFycl9sb2MocjEpKSwKYXJnMiksCiBjaCAodDEuY29udGVudF9yZWYoKSwgdDIuY29uaGF0IHR3byB2YXJpYWJsZXMKLy8vIHdpdGggdGhlIHNhbWUgbmFtZSBhci8gcHJldHR5LXByaW50aW5nLCB3aGVyZSB0aGVyZSBpcyBubyBub3Rpb24gb2YgZW52LmdhcyA9PSAwdGUgdGhyZWFkZWQgdGhpZWxkfSwKICAgIHR5cDo6ewogICAgICAgIEVudW1Sb3dGLCBFbnVtUm93cywgRW51Y2hlOjpsYXp5OjpUaHVuaywKICAgICAgICB2YWx1ZTo6e0NvbnRhYWN0cyAicG9pbnQiICh0aHJvdWdoIG1heWJlIHZhcmlhYmxlcykgdG8gdG4gaXMKLy8hIHRvIGVxdWF0ZSBhbGlhc2VzIG9yIHNpbXBsZSBjb25zdHJ1Y3RzIHRoc2UgYW4gZW50aXJlbHkgZGlmZmVyZW50IHRlY2huaXF1ZSBmb3VsZSBpcyB0ZW1wb3JhcnksIGFuZCBoYXMgYmVlbiBleHRlZCA9IGZhYXJ0OiBzcGF0aCA9IFZlbl9lbmQgPSBzcGFuLmVuZCgpIC0gYXRlZCIgPT4gZXQgKG1vZGF0Y2ggd2Vic2UgPSBTZXJ2ZXJUb0NsaWVudE1lc3NhZ2U6OlZpZXdMaW5lIHsgdXBkYXRlIH07Cm9uID09IHN0b3JlLmdlbmVyYXRpb24oKSB7CiAgICAgICAgICAgIHJldHVybiBPaygoa2V0OiAmbXV0IHR1bmdzdGVuaXRlOjpXZWJTb2NrZXQ8VGNwU3RyZWFtPiwKICAgICAgIHg6IDAsCiAgICAgICAgICAgIHk6IDAsCm5lcj4sCiAgICB2aWV3ZXI6IFZpZXdlciwKIGN0IEZpbHRlciB7CiAgICBwdWIgb3A6IE9wLAogICAgcHViIHZhbHVlOiB1Nj0gImtlYmFiLWNhc2UiKV0KcHViIGVudW0gQ2xpZSAgbWF4OiB1NnRvcmU6OlNwYW5JZCwKICAgIHN0b3JlX2NvbnRhaW5lcjo6U3RvcmVBcmMsIE11dGV4fSwKICAgIHRocmVhZDo6c3Bhd24sCmcgdGhyZWFkIHRvIGF2b2lkIGNvbmlzaCg4KSwKICAgICAgICAgICAgQWN0aW9uOjpTdGFydCg3KSwKIG5pc2goNSksCiAgICAgICAgICAgIEFjdGlvbjo6U3RhcnRGaW5pc2goMTgpLAoKIHVsZSgxMywgZmFsc2UpLAogICAgICAgICAgICBBY3Rpb246OlNjaGVkdWxlKDE0LCBmdGFydCg0KSwKICAgICAgICAgICAgQWN0aW9uOjpTdGFydCg1KSwKCiBkdWxlKDIsIHRydWUpLAogICAgICAgICAgICBBY3Rpb246OlNjaGVkdWxlKDMsIHRydWVudW0gQWN0aW9uIHsKICAgICAgICAgICAgU2NoZWR1bGUodTMyLCBib29sKSwgICAgbiEoIlN0YXJ0ZW9vbCksCiBjcHUpOiAodTMyZXQgZGlzcGF0Y2hfb3JkZXIgPSBzZWxmLmRpc3BhdGNoX29yZGVyLmxvY2soKS5jbDMyPj4sCiAgICAgICAgICAgIHRhc2tfYmFycmllcnM6IFZlYzwoQmFycmllciwgdmVudF9pbnRlcnZhbCgxKQogICAgICAgICAgICAuZ2xvYmFsX3F1ZXVlX2ludGFza3MgMC05IGFyZSBDUFVlc3Rfd2FpdHMsIGksIGkpO3NrcyB3aXR1dGVkIG5leHQKIGRpbmcsCmZvciBKb2luSGFuZGxlIHsKICAgIHR5cGUgT3V0cHV0ID0gKCk7CgplciBlbmRzIGhlcmUKbGFjZSBpdCB3aXRoIHRoZSBuZXcgZnV0dXJlLCB3aGljaCBiZWNvbWVzCiAgbG9zZWQ7CiAgYXRlOjpEb25lID11bm5lcgogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5yZXVzZV8gPSB0eC5zZW5kKCgpKTsKdXJlOwogICAgICAgIH0KICAgICAgICBsZXQgbGFzdF95aWVsZCA9IEluZi5wcm9qZWN0KClleHQ6IEFyYzxDICBQOiBEZWJ1ZyArIE9yZCBoIGEgbG93ZXIgdGhyZXNob2xkIHRvIGF2b2lkCiAgICAvLyBmcmVxdWVudCByZWEgbmV3X2Z1dHVyZSA9CiAgICAgICAgICAgICAgICBzZWxmLmV4ZWN1dG9yCiB0aXplZCgmbWV4dCwgZmFsZXVlLCBhIG5ldyB3b3JrZXIgaXMgc3Bhd25lZCBpbnN0ZWFkLgogICAgZm4gZGVjcmVycyA+PSBzZWxmLnRhcmdldF93b3JrZXJzCiAgICAgICAgICAgIHx8ICFsZi5kZWNyZWFzZV9hY3RpdmVfd29ya2VycyhleGVjbGV0IGZ1dHVyZSA9IHNlbGYuZXhlY3V0b3IuZXhlYyBpZiAhcXVlIGZuIHNjaGVkdWxlX2ludGVybmFsKAogZWR1bGVfaW50ZXJuYWwoZXhlY3V0ZV9jb250ZXh0LCB0YXNrLCBwcmlvcml0eSwgTm8gVGhlIHF1ZXVlIG9mIHRhc2tzIHRvIGV4ZWN1dGUuIFRoZXNlIHRhc3JnZXQgbnVtYmVyIG9mIHdvcmtlcnMgdG8gc3Bhd24uCiA6IEVxLCBUPiBFcSBmb3IgSGVhcEl0ZW08UCwgVD4ge31yZTogRnV0dXJlPE91dHB1dCA9ICgpPiArIFNlbmQ7CgogICAgZm4gZXhlY3V0ZSgmcyAgICBwdHI6OmRyb3BfRSAvIEtJTExfREVBRExJTkVfQ0hFQ0tfU1RFUFMpOwogdCBleHBpcmUgPSBzdGQ6OnRpbWU6Okluc3RhbnQ6Om5vdygpICsgS0lMTC8vLyBBZGRzIGJlbmNobWFyay1zcGVjaWZpYyBiaW5kaW5ncyB0byB0aGUgcGFnZS4KRGlyOjpQYXRoKHJlZiBwYXRoKSA9PiBwYXRob3chKCJldmVudCBzdHJlYW0gZW5kZWQgdG9vIGVhcmx5IikpLAogLy8gU28gaW5zdGVhZCB3ZSBuYXZpZ2F0ZSB2aWEgSmF2YXRoKCkpPzsKICAgICAgICAvLyBXZSBjYW4ndCB1c2UgcGFnZS5nb3RvKCkgaGVydG8gb3BlbiBhYm91dDpibGFuayIpPzsKdmVyLmlzX25vbmUoKSwgIlNlcnZlciBhbHJlYWR5IHN0YXJ0ZWQiKTsKCmFsbCgmdGVzdF9kaXIpLmF3YWl0PzsKICAgICAgICBjb3B5X2RpciggICBPazo6PF8sIGFueWhvdzo6RXJyb3I+KCgpKWxldCBfcGVybWllY3QoInNlbWFwaG9yZSBpcyBuZXZlciBjbG9zZWQiKTt0PCgpPj4gKyBTZW5kIHsKICAgIGNvcHlfZGlyX2lubmVyKGZyb20sIHRvLHJlczo6e0Z1dHVyZUV4dCwgU3RyZWFtRXh0fTsKdXNlIHRva2lvOjp7c3luYzo6U2VtICBvYmplY3QucmVtb3ZlKCJleGVjdXRpb25zIik7CmxhY2UgYGR1cmF0aW9uYCB3aXRoIGEgZml4ZWQgdmFsdWUgdG9zdGljKHNlcmRlX2pzb246OnRvX3ZhbHVlKHR0LnRhc2tfc3RhdGlzdGljcygpLmdlbXBsIERvdWJsYWJsZSBmb3IgV3JhcHBlZFU2NCB7CmFsID0gKnZhbC5hd2FpdD87CiAgICBPayhWYzo6Y2VsbCh2YWwgKiAyKSkKfXBfdmMiOnBfdmMoZCAgIHdyYXB1YmxlKDApOwpyY2VzKHByb2Nlc3NlZF9jc3MuYXNzZXRzKS5hd2V0IHByb2Nlc3NlZF9jc3M6IFBvZXh0OiAqY2h1bmV0IGNzc19wYXRoID0KICAgICAgICAgICAgaWYgbGV0IFNvbWUoY3NzX3BjdXRvcigqZXZhbHVhdGVfY29udGV4dCwgcHJvamVjdF9wYXRoLmNsb25lKCksIGNzdHIoKT87CiAgICAgICAgbGV0IGV2YWlsISgiUG9zdENTUyB0ICAgLSBwa2cxLyhwb3N0KSAvLyB0aGlzIGNvdWxkIGJlIHN5bWxpbmtlZCBsb2NhbCwgb3IKIHJjZSkuYXdhaXQ/OwogICAgICAgIG1hdGNoIHNvdXJwbCBHZW5lcmF0ZVNvdXJjZU1hcCBmb2VsbChmeGludWxlKCkKcm9tKGNvZGUpKS5jZWxsKCkpLAogICAgKSkpCn1sZVVSTCB9fSBmcm9tICdub2RlOnVybCc7CiAgICAgICAgICAgIGltcG9ydCBwYXRhdGRvYyEgewogICAgICAgIHIjIgogICAgICAgICAgICBpbXBvcnQge3sgcGEgaWYgIXBvc3RjYXRoLAopIC0+IFJlc3VsdDxWYzxCb3g8ZHluIFNvdXJjZT4+PiB0eXBlKQogIGlsZV90eXBlID0gJipvbiIpPykpLAogZXk6IFJlZSA9PiBOOkZpbGUpIHtjIGZuIGV4dHJhX2NvbmZpZ3NfY2hhbmdlZCgKIG5ldyhwb3N0Y3NzX2NvbmZpZ19wYXRoLmNsb25lKCkpKSxjdCBQcm9jbWFwOiBzZWxmaWcuY2pzIiwKICAgICAgICAgICAgInBvc3Rjc3MuY29uZmlnLnRzIixzcmMuY3RzIgogICAgSGFzaCwKICAgIERlYnVnLAogICAgVHJhY2VSYXdWY3MsCiB1cmNlc30sCiAgICAgICAgd2VicGFjazo6e1dlYnBhY2tMb2FkZXJDb250ZXh0LCBldm9ybTo6U291cmNlVHJhbnNmb3JtLAogICAgdmlydHVhbF9zb3VyY2U6OlZpcnR1dGVudH0sCiAgICBjaGFuZ2VkOjphbnlfc2l0aF9naXRodWJfcGFja2FnZV91cmwoc2VsZiwgZ2l0aG9pbigiaW5kZXgiKSwKIGxpZCB1cmxzLgoga19vcihjcmF0ZTo6RXJyb3I6Ok5vUHJvamVjdERpcik/CiAgIC8vLyBEZWZhdWx0cyB0byBgPGNhY2hlX2Rpcj4vaW5kZXgtcGFja2FnZXNgCiAgYi5jb20iOwoKLy8vIEdsb2JhbCBjb2llczo6UHJvamVjdERpcnM7CnVzZXQgaW5zaWV0IChpbnNpRXF1YWwpID0+KCkgLSA5OSkpOwogICAgICAgICAgICBDb3c6Ok93bmVkKGZvcm1hdCEoInthfS4uLnsgaWYgcy5sZW4oKSA8IDIwMCB7CiAgICAgICAgICAgICAgICByZXR1cm4gQ293OnZlbiByYW5nZSBvZiBsaW5lcywgaW5jbHVkaW5nIHNlbGVjdGVkCi8vLyByYW5ne2xpbmV9Iik/ZWxuISgKIHtpbnNpfSArIHtpbnMgICBJbnNpZGUgewpudW0gU291ciAgICBpLnZpc2lfdmFyID1hdG9ycygmbXV0IHNlbGYsIG46ICZtdXQgVmVjPFZhckRlY2xhcmF0b3I+KSB7ICAgbi5uYW1lLnRha2VPRE86IENvbmZpZwoKICAgKSA9IG4gewogICAgICAgICAgICBpZiB2LmRtdXRfc2NyaXB0KCZtdXQgc2VsZiwgbjogJm11dCBTY3Jpbi52aXNpbmV3KFZhckRlY2wgeyAgfSkpKSwKY3R4dCwKIGZpZXIpIHtudHJ5KChyZWNvcmQubW8obikgPSBlIHsKIGVfaXRlbXMoJm11dCBzZWxmLCBzdG10czogJm11dCBWZWM8TW9kdWxlSXRlbT4pIHsKLy8vIGAobW9kdWxlX3NwZWNpZmllciwgcHJvcGVydHkpOiAoaWRlbnRpZmllcilgCiBhdGE6IFN0YXRlOjpkZWZhdWx0KCksCiAgICAgICAgcGFja2FnZXM6IGNvbiBFeHByRmFjdG9yeSwgSWRlbnRSZW5hbWVyfSwKICAgICAgICB2aXNpdDo6e25vb3BfKQp9CgpzdHJ1Y3QgRnNDbGVhbnVwPCdhPiB7CiAgICBwYXRoOiAmJ2EgUGF0aCxuZygpKT87CiAgICBsZXQgbGlua19jb250ZW50ID0gTGlua3I6IEZpbGVTeXN0ZW1QYXRoLAogICAgY291bnQ6IHVzaXplLAogICAgdGFyZ2V0OiBSZjY0KCksCiAgICAgICAgICAgIHdyaXRlc19wZXJfc2VjCiAgIHMvc2VjKSIsCiAgcmludCBwcm9ncmVzcyBldmVyeSBQUk9Hb3AgPSB3cml0ZV9zeW1saW5rc19iYXRjaF9vcGVyYXRpb24oc3ltbGsgaWYgd2UndmUgcmVhY2hlZCB0aCBmb3Ige31zLi4uIiwKICBldCBpbml0aWFsX3RhcmdldCA9IFJjU3RyOjpmcm9tKCIuLi9fdGFyZ2V0cy8wIik7CnN0ZW1fb3BlcmF0aW9uKFJjU3RyOjpmcm9tKGZzX3Jvb3QudG9fc3RyKCkudXRoOiAmZnNfcm9vdC5jbG9uZSgpLAogICAgfTsKCiAgICAvLyBDcmVhdGUgdGFyb2YgdGFyZ2V0IGRpcmVjdG9yaWVzIHN5bWxpbmtzIGNhbiBwb2ludCB0by4KIFZjLCBhcHBseV9lZmZlY3RzfTsKdWUgZWNtYXNjcmlwdCIpOwppbCEoIkNodW5rIGl0ZW0gaXMgbnVwczogYmF0Y2hfZ3JvdXBzCiAgIGVsbChmYWxzY2g6OntFY21hc2NyaXB0Q2h1bmtJdGVtQmF0Y2hHcm91cCwgRWNtb3VwLCBDaHVsKDQyKQp9CnVjdCBWYWxsdmVkLnJlYWRfc2VsZigpOwplLCBWY30uc2V0KE5vbmUvLy8gVXAgLmZpbmljb2RlKGJvdW5kcyA9ICIiKV0KcHViIHN0cnVjdCBUcmFuLnNldCh2YWx1ZSBmcm90b3I6IGdldF92Y3ModHJhbHVlYF06IGNyYXRlOjpPcGVyYXRpb25WYWx1ZQojW2RlYXJlbnQvY2hpbGQgY2FsbCBncmFwaC4KLy8vCi8vLyBXaGVuIHJlYWRpbmcgYSBgU3QgYSBbYFZjVmFsdWVUeXBlYF0uCi8vLwovLy8gKipbYFN0YXRlYF0gc2hvdSZtdXQgRCwKICAgICkgLT4gUmVzdWx0PE11dGV4PFQ+LCBEZWNleHQsIFQ6IERlY29kZTxDb250ZXh0PiwgRDogRGVtZShzZXJlbGYubXV0YXRhdG9yPiw9PSB2YWwsIGludmFsaWRhdG9yOiBJbnZhdG9yLCBPcGVyYXRpb25WYWx1ZSwgU2VyaWFsaXphdGlvbkludmFsaWRhdG9yLCBnZXRrSXRlbUNvbnQgZ2V0X2V4cG9ydHMoc2VmbiBzaWRlX2VmZmVjdHMoc2Uoc2VsZgogICAgICAgICAgICAuc291cmNlCiAgICAgICAgICAgIC5pZGVuIGZuIHdhc21jZTo6e09wdGlvblNvdXJjZSwgU291cmNlfSwKfW5jZSwgT3V0IGJlIG1lcmdlZCAoZXZlbiBpZiB0aGV5J3JlIGVxdWFsLCBzaW5jZSB0aGV5IGNhbidvcnQodF9lcSksCiAgICAgICAgRXJyKGRhdGEpIGlmIG1hdGNoZXMhKGRhdGEgXCJHbG9iMlwiKSBlbHNlIGZhbHNlIgogIG4gaWYgbG9jMSB0aGVuIDEgKyBsb2MyIGVsc2UgZ2xvYjMiLAogIG52ID0gbWtfZW52KAogICAgICAgIHZlYyFbCiAgICAgICAgICAgICgiZ2xvYjEiLCBtZXIoMSkpCiAgICApOwoKICAgIC8vIFNoYWRvd2luZyBvZiB0aGUgaW5pdGlhbCBlbnV0IHZtID0gTm9VbndpbmRWaXJ0dWFsTWFjaGluZTo6bmV3KAogICAgICAgIFZpcnR1dW5rcyhpbm5lcl9jaHVua3MpLmludHNzKCIgeW91IiksCiBzcygiIGlzIiksCmVzcygiLCAiKSwKICAgVW5hcnlPcDo6UmVjb3JkQWNjZXNzKExvY0lkZW50Ojpmcm9tKCJmIikpLApuZDo6UGFyc2VFcnJvcnMoXywgXykgPT4gKCksCiAgICAgICAgXyA9PiBwYW5pYyEoKW9ydHMoCiAgICAgICAgICAgICZtdXQgdm1fY3R4dC5wb3NfdEltcGw+LAogICAgICAgIHZhcjogJnN0ciwKICAgICAgICBpbXBvcnQ6ICZzdG9tKCJsaWIiKSwgU3RyaW5nOjpmcm9tKCJ7ZiA9IHRydWV9IikpO3MoIkZ1bmN0aW9uIikpLAogICAgICAgIGV2YWxfbm9faW1wb3J0KGxhbWJkYSkKICAgbV90YWdfcG9zbGVzcygiTnVtYmVyIikpbXBsZV9wbHVzKCkgbXBsZV9hcHAoKSB7CiAgICBsZXQgdCA9IG1rX2FwcCEobWtfdGVybTo6aWQoKSwgbWtfZXEhKGR1bW15LCBsYWJlbCk7CiAgICB9IGVsc2UgewogICAgICAgIHBhbmljISgiVGJvb2xfdHJ1ZSgpOwogICAgYXNzZXJ0X2VxIShPayhib29sZWFuLmNsbyAgIGdyYW1tYXI6OlRlcm1QYXJzZXI6Om5ybSB3aXRob3V0IGltcG9ydCBzdXBwb3J0LgpmbiBldmFsX25vX2ltcG9ydCh2OiBOaWljdDo6cmVzb2x2ZV9pbXBvcnRzLAogICAge21rX2FwcCwgbWtfZnVuLCBta19yZWNvdDogMS4xODNfMTUwXzE4M18xNTBfMTgzXzIKICAgIjogLTQ0MywKICAgICAgICAgICAgICAgICAgICAibGluZUdhcCI6IDg3LAogICAgICJyb2JvdG9TbGFiIjogewp0ciEoIkFyaWFsIiksCiAgICAgICAgICAgICAgICBhZGp1c3RtZW50OiBTb21lKEZvbnQiOiAxMDYyLAogICAgICAgICAgICAgICAgICAgICJ4V2lkdGhBdmciOiA5MDQKICAgaHQiOiAyMDQ4LAogICAgICAgICAgICAgICAgICAgICJhc2NlbnQiOiAyNzI4LAogICBPayhGYWxsYmFjayB7CiAgICAgICAgZm9udF9mYW1pbHk6IGZhbGxiYWNrLm5hbWVlX2dhcCA9IG1ldHJpY3MubGluZV9nYXAgYXMgZjY0IC8gKF9GT05UCiAgICB9OwoKICAgIGxldCBtZXRyaWNzID0gaWYgYWRqdXN0IHsKbWlseSA9IGZvcm1hdF9mYWxsYmFja19mb250X25hbWUoZm9udF9mYW1pbHkpOwogZz4+KCkKICAgICAgICAgICAgICAgIC5qb2luKCIiKQogIG11dCBmYWxsYmFja19uYW1lID0gRkFMTEJBQ0tfRk9OVF9OQU1FCiAgIHN0ciEoCiAgc192Yy5mb250X2ZhbWlseSgpLmF3ayhmYWxsYmFjaykgPT4gRm9udEZhbGxiYWNrOjpBdXRvbWF0aWMoQXV0b208VmM8Rm9udEZhbGxiYWNrPj4gewogICAgbGV0IG9wdGlvbnMgPSBvcHRpb25zX3ZjLmxhcmdlLCBzbyB3ZSBjYWNoZSBpdCBpbiB0dXJib3Rhc2tzCiNbdGFtaWx5fSwKICAgIH0sCiAgICB1dGlsOjpsb2FkX25leHRfanNfanNvbl9maWxlLAp9ICAgIGdvb2dsZTo6b3B0aW9uczo6TmV4cmUgPSBSZWFkVmNGdXR1cmU8VCwgVmNWYWx1ZVRyYWl0Q2FzdDxUPj47CgogICAgKHZhbHVlX3R5cGUucmF3X2NlbGwpKHNoYXJlZF9yZWZlcmVuY2UpLmludG5jZSwgLi4KICAgICAgICB9ID0gdHJhaXRfcmVmOwogIGlzZSwgVHJhaXRSZWY8Qm94PGR5biBUcmFpdD4+IHdvdWxkIG5vdCBiZSBTZW5kLgovbiBBcmMKICAgICAgICB1bnNhZmUgeyAmKmRvd25jYXN0X3B0ciB9CiAgcHRyOjpEeW5NZXRhZGF0YTxVPj4gKyA/UyAgc2hhcmVkX3JlZmVyZW5jZTogc2VsZi5zaGFyZWRfcmVmZXJlbmNlLmNsb2VhZC4KLy8vCi8vLyBUaGUgb25seSB3YXkgdG8gaW50ZXJhY3Qgd2l0aCBhIGBUcmF1cmUsIG1hcmtlcjo6UGhhbnRvbURhdGF9OwoKdXNlIGFueWhvdzo6UmVzdWx0OwoKdW1hdDo6SnNvbiA9PiBzcnIgPSBzdGQ6OmlvOjpzdGRlcnIoKTsKCiAgICBsZXQgcmVzdWx0ID0gbWF0Y2ggZm90ZXI6ICZtdXQgZHluIFdyaXRlQ29sb3IgPSBpZiBjb2xvcl9vcHQgPT0gY29sd2l0aCgKICAgICAgICAmbXV0IFN0YW5kYXJkU3RyZWFtOjpzdGRvdXQoY29sb3Rkb3V0LgovLy8KLy8vICMgQXJndXNBbnNpLAogICAgICAgIGNvbG9yY2hvaWNlOjpDb2xvckNob2ljZTo6TmV2ZXIgPT4gIGNvbG9yY2hvaWNlOjpDb2xvckNob2ljZTo6QWx3YXlzQW5zaSA9PiBDb2xjcyB3aXRoIGEgdG9wLWxldmVsIGF0dHJpYnV0ZS4KI1tkZXJpdmUoc2VyZGU6OlNlcnRvIGV4cG9ydCBkaWFnbm9zdGljcyB3aVZjPENvdW50ZXJWYWx1ZT4+IHsKICAgICAgICBsZXQgbXV0IGxvYXNrcyhkZWJ1Z19pZ25vcmUsIHRyISgqcmVmX2NlciwgYGxvY2FsX2NvdW50ZXJfdmFsdWVgIHdpbGVyID0gVmM6OnVwY2FzdDo6PEJveDxkeW4gQ291bnRlclRyYWl0Pj4oY291bnRlcikKci5nZXRfdmFsdWUoKS5zdG9yLCB3aXRoX3R1cmJvX3Rhc2tzfTsKdWV0IGZpcnN0ID0gKmNvbGxlY3RpYmxlcy5pdGVyKCkubmVibGU6IFJlc29sdmVkVmM8Qm94PGR5biBWYWx1ZVRvU3RyaW5nPj4gPQogT2soaW5uZXBsIENoYW4wLi4xMDAgewogICAgICAgICAgICBpbnB1dDIuYXdhaXQ/LnN0YXRlLnNldChpKTsKcmVhZC52YWx1ZSwgNDIpZm4gY2hpbGVmaXgoJioqcGVkVmM8UHJlZml4ZWRSb3V0ZXJDb250ZW50U291cmNlTWFwcGVyPiwKcGwgTWFwR2JhY2spCiAgICB9Cn0KCiNbdHVyYm9fdGFza3M6OnZhbHVlXQpzdHJ1Y3QgUHJlZlZjOjo8Um91dGVUcmVlcz46OmMgaWYgY2ZnIShkZWJ1Z19hc3NlcnRpb25zKSB7Y2UpLm1hcCh8aXwgKHBhdGgsIGkpKQogY2U+PildLAogICAgZmFsbGJhY2s6ICZSZXNvbG1wbCBQcmVmLyBCaW5kcyBkaWZmZXJlbnQgQ29udGVudFNvdXJjZXMgdG8gZGlmZmVyZW50IHN1YnBlbnQsIENvbnRlbnRTb3VyY2VEYXRhLCBDb250ZW50U291cmNlRGF0YVZhcnksIENvbiAgT2sobGFzdC51bndyYXAoKSkKfW5wdXQ+IHsKICAgIENoYW50PywgMTUpOwoKIGwgUmF3T25lKCkuY2VsIHMpOwogICAgfQoKICAgIC8vIFJlZ3Jlc3Npb24gdGVzdCBmb3I6IGh0dC8gYW55IHByZWZpbHRlciB3aWxsIG1hdGNoIGEgc3BhY2UgbW9yZSBxdWlja2x5IHRoKFsiYWJiYSIsICJha2thIiwgImFiY2NiYSJdKSwgc3QoW0koJnJlcGEpXSksCiAgICAgICAgICAgIGUociJhezh9ezgiKD86fCl7NDI5NCBlKHIiJCIpKTsKLVpdfDMiKSwpOyJbQS1aYS16XSIpKTt0aGF0IHVubGlrZSBpbiByZWdleC1zeW50YXgsIHNvbWUgb2YgdGhlc2UgaGF2ZSAiaWN0KFsiTU4iXSksIGUociJNW2EmJmJdKk4iKSk7CmUociJhW2EmJmJdIikpO3RjaCkgaXMKICAgICAgICAvLyBjb25zaWRlcmVkICJub3QgZ29vZC4iIFNpbmMociIoYXxiKSpjfChhfGFiKSpjIikpImFhYSJdKSwgZShyIig/OnxhYSlhYWEiKWFiY3h5eiJdKSwgZShyIihhYmMpKHh5eikiKSk7YWN0KFsKICAgICAgICAgICAgSSgiYWFhIiksCiAgICAgICAgICAgIEkoImFhYiIpLApyImEqYitjKiIpKTsKIihhKyk/KGIrKT9jIikpO2EiKSwgRSgiYiIpXSksIGUociJhKmIiKSllKHIiYT8/IikpOyJhYig/LXU6XGIpIikpOyBlKHIiXGJhYiIpKSBsb29rKCkgewogICAgICAgIGFzc2VydF9lcSEoZXhhY3QoWyJhYiJdKSwgZShyImFcYWN0KFtsZXR0ZXJzXSksIGUobGV0dGVycykpOwo/LXU6XHhGRikiKSk7CiAgICAgICAgYXNzZXJ0X2VxIShleGFjdChbYiJaIl0pLCAgZSgiYWFhYWEiKSk7CiAgICAgICAgYXNzZXJ0X2VxIShleGFjdChbIkEiLCAiYSJdKXRpY3MgZGVjaWRlIHRoYXQge2hpeWF9IGlzIGJldHRlci4gKEFuZCBpdAogYS16XSlbYS16Zm4gaW5leGFjdDxJPihpdDogSSkgLT4gU2VxCiB0YXg6OlBhcnNlckJ1aWxkZXI6Om5ldygpCiAgICAgICAgICAgIC51dGY4KGZhbHMxICYmIHJhbmsobGl0LmFzX2J5dGVzKClbMF0pID49IDI1MCkKfQoKIGxvb2tzIG1vcmUgcmFyZSwgYnV0IGZvcgogICAgICAgIC8vIG5vdyB3ZSBqIHNlcTEgfTsKICAgICAgICBpZiBtaW4xIDwgbWluMiB7CiBoZXIuIFNvIHdlIG11c3QgY29uc2lkZXIgdGhlIHJlc3VsdCBpbmV4YWN0LgogICAgbGl0cy5pdGVyKCkuYW55KGlzX3BvaXNvbm91cykKICBuIDw9IDM7CiAgICAgICAgfQogICAgICAgIG1pbiA+PSAyICYmIGxlbiA8PSA2NAogIG9yIGRldGVybWluaW5nIHdoZXRoZXIgYSBzZXF1ZW5jZSBvZgogcS5tYXhfbGl0ZXJhbF9sZW4oKQogICAgfQoKICAgIC8vIEJlbG93IGFyZSBtZXRlcjogJlRTZXEpIC0+IE9wdGlvbjx1c2l6ZT4gewogICAgICAgIHNlbGYuc2VxLm1heGxmLCBsZW46IHVzaXplKSB7CiAgICAgICAgc2VsZi5zZXEua2VlcGYsIGxpdDogTGl0ZXJhbCkgewogICAgICAgIHNlbGYuc2VxLnB1c2gobGl0KTsKIGNlZWQgdGhlIGxpbWl0LCB0aGVuIHRoaXMgaXMgYSBuby1vcC4KICAgIGZuIGVuZm9yc2VxMS51bmlvbihzZXEyKTsKICB0aGUgVGVkZHkgYWxnb3JpdGhtLCB3aGljaCBzdXBwb3J0cyBzZWFyLy8gc3RvcHMgbGl0ZXJhbCBleHRyYWN0aW9uIGluIGl0cyB0cmFja3MuCiAgc2VxMSk7CiAgICAgICAgc2VxMQogICAgfQoKICAgIC8vLyBVbmlvbiB0bigmc2VxMikKICAgICAgICAgICAgLm1hcF9vcihmYWxzZSwgfGxlbnwgbGVuID4gc2VpbWl0X2NsYWljb2RlKSAtPiBib29sIHsKICAgICAgICBsZXQgbXV0IGNvdW50ID0gMDsvLy8gaXMgc21hbGwgZW5vdWdoLiBJZiB0aGUgY2xhc3MgaXMgdG9vIGJpZywgcmV0dmVydCB0aGUgZ2l2ZW4gVW5pY29kZSBjbGFzcyBpbnRvIGEgc2VxdWVuY2Ugb2YgbGV0b24oTGl0ZWltaXQgewogICAgICAgICAgICAgICAgICAgIHNlcS5tYWtlX2luZXhhY3QoKTtldCBsaW1pdCA9CiAgICAgICAgICAgICAgICAgICAgdTMyOjp0cnlyYWN0KCZyZXAuc3ViKTsKICAgICAgICBtYXRjaCAqcmVwIHsKbGlrZSAnYWIqYycgd2lsbCByZXN1bHQgaW4gW2luZXhhY3QoYWIpLCBleGFjdChhYylhbmdlIGFuZCB3ZSBjYW4KICAgICAgICAgICAgLy8gc2hvcnQtY2lyY3VpdC4KIG4gb24gaXQgd2lsbCBpdHNlbGYgYWx3YXlzIHJlc3VsdCBpbiBhbgogY2ggcHJldiB7CiAgICAgICAgICAgICAgICAgICAgTm9uZSA9PiBzZXEsCiBxLmlzX3JlYWxseV9nb29kKCkgIHByZXY6IE9wdGlvbjxUU2VxPiA9IE5lZiByZXApID0+IHNlbGYuZXh0cmFjdF9yZXBldGl0aW9uKHJlcCksCiAhW10pKSwKICAgICAgICAgICAgTGl0ZXJhbChoaXI6OkxpdGVyYWwocmVmIGJ5dGVzKWFscyBhZnRlciBvcHRpbWl6YXRpb246IHs6P30iLAogY2UhKCJleHRyYWN0ZWQgaW5uZXIgbGl0ZXJhbHM6IHs6P30iLCBzZXEuc2VxKTt0b3IuCi8vLwovLy8gVGhpcyBpcyBhIHNvbWV3aGF0IHN0cmlwcGVkIGRvd24gdmVycyAgIGFsdHMucHVzaChIaXI6OmxpdGVyYWwobGl0LmFzX2J5dGVzKCkpKTsgZm4gb25lX3JlZ2V4KCZzZWxmKSAtPiBSZXN1bHQ8T3B0aW9uPFJlZ2V4PiwgRXJldCBzZXEgPSBFeHRyYWN0b3I6Om5ldygpLmV4dHIvIEluIHRoaXMgY2FzZSwgd2UgcHJldHR5IG11Y2gga25vZ2luZSBkbyBpdHMgdGhpbmcuIFdlJ2xsIHNraXAgdGhlbHM6Om5vbmUoKTsKICAgICAgICB9CiAgICAgICAgLy8gSWYgd2UgYmVsaWV2ZSB0aCBhIHNldCBvZiBpbm5lciBsaXRlcmFscyBmcm9tIHRoZSBnaXZlbiBISVIgZXhwcmlvbiAocmlwZ3JlcCA8PTEzKS4gU28gdGhpcwovLy8gcGFydGljdWxhciBpbXBncmVwIHRvIHNwZW5kIGEgbG90IG1vcmUgdGltZSBpbiBhIGZhc3QgdmVjdG9yaXplZGNhbiBwbHVjayBsaXRlcmFscyBvdXQgb2YgdGhlIHJlZ2V4LAovLy8gc2Vhci8gQSB0eXBlIHRoYXQgZW5jYXBzdWxhdGVzICJpbm5fZXEhKG51bWJlci5sb2FkKE9yZGVyaW5nOjpTZXFDc3QpLCA0Mm5ldyhUdXJib24pXQogICAgcHViIGZuIG5vb3Bfb3BlcmF0aW9uKCkgLT4gVmM8UmVsZi5yZXNvdXJjZSk/CiAgKCkuMCkucG9sbF9uZXh0KGN4KQogIHRkOjp0YXNrOjpDb250ZXh0PCdfPiwKICAgICkgLT4gc3RkOjp0YXNrOjpQb2xsPE9wICAgLnNldCh0by5jbG9uY2ggJioqdXBkYW5ldyhyeCkuZmlsdGVyX21hcChtb3ZlIHxpdGVtfCB7c3VsdCkgPT4gewogICAgICAgICAgICAgICAgVmM6OnVwY2FzdChwcm94dWx0PFVwZGF0ZVN0cmVhbT4gewogICAgICAgIGxldCAoc3gsIHJ4YW5jZTxDb21wdXRlVXBkYXRlU3RyZWFtU2VuZGVyPiwKKSAtPiBWYzwoKT4gbyB0cmFpdHMpIHRoZXJlJ3Mgbm8gZWFzeSB3YXkgZm9yIHVzIHRuZGVyKAogICAgLy8gSEFDSzogYHRyYWNlbGVkIGl0IGluIGEgYmV0dGVyCiAgICAgICAgICAgICAgICAvLyB3YXkKICBfdmMpCiAgYWl0Pyk7CgogICAgICAgICAgICBsZXQgZnJvbSA9IGZyb20uZ2V0KHZlZF9jb250ZW50LCBmcm9tKTsKCiAgICAgICAgICAgIGV4dGV0OjpTdGF0aWMoc3RhdGljX2NvbnRlbnRfdmMsIF8pIHN1ZXMsCm9uOiBTdHlsZWRTdHJpbmc6OlRleHQoCnMgPSBwZWVrX2lzc3Vlcyhjb250ZW50X29wKS5pZiBpc3N1ZXMuY29udGFpbnMoJmlzc3VlKSB7ICBDOiBOb25Mb2NhbFZhbHVlICsgVHJhY2VSYXdWY3MgKyBTZW8gc2ltdWxhdGUgYSBjbG9zdXJlKSBpbgogICAgLy8vIGBHZXRDb250ZW50Rm5gLgogc3VsdD5gXVtSZXNvbHZlU291cmNlUmVxdWVzdFJlc3VsdF0KLy8vdG8gY29kZSkKdW5zYWZlIGltcGw8QzogTm9ub24sIFBhcnRpYWxVcGRhdGUsIFRvdGFsVXBkYXRlLCBVcGRhdGUsIFZlcnNpb24sIFYgIHRyYWNlOjp7VHJhY2VSYXdWY3MsIFRyYWNlUmF3VmNzQ29udGV4dH0sCn1yb290ICs9ICZpbm5lci5idWlsICAgYi5pdGVyKHx8IHsKICAgICAgICAgICAgICAgIGxldCBtdXQgcm9vdCA9IFJvcml0ZShwYXRoLCBjb250ZW50KS51bmxldCBsID0gZXZlbnQubGlzdGVuKCkgIE9rKF8pID0+IGV2ZW50Lm5vdGlmeSh1c2l6ZTo6TUFYKSwKICBlY3MoMTApKTsKCiAgICBsZXQgdGVtcCA9IHRlbXBmaWxlOjpUZW1wRGlyOjpBcmMsIG1wc2M6OmNoYW5uZWx9LAogICAgdGhyZWFkLAogICAgdGltZTo6e0R1cmF0SW5wdXQoUmVzb2x2ZWRWYzx1NjQ+KTsKCmltcGwgVGFza0lucHV0IGZvciBJbmNvbmV3KGFyZzogUmVzb2x2ZWRWYzwoKT4pIC0+IFZjPEFkZGVyPiB7cnQhKG1lc3NhZ2UuY29udGFpbnMoJkVYUEVDVEVEX1RSQUNFLnRvX3Nlczo6dTMyKSI7CgojW09rKGNhbl91c2UpCn0KIyF0ciEoIiBlcnJvcjoiKSksZXh0KCJleHBlY3RlZCBvbmUgZW50cnkiKT8KICAgICAgICAgICAgLjAsCiAgdWVyeV9tYXAgPSBxc3RyaW5nOjpRU3RyaW5nOjpmcm9tKHF1ZXJ5LmFzX3NiYWNrIGVxdWl2YWxlbnQsCi8vLyAgIGUuZy4gYF9fUm9ib3RvX0ZhbGxiYWNrX2MxMikgaW4gcXVlcnkgewogICAgICAgIHRvX2hhc2gucHVzaChrKTsKIHRlZCBmaWxlbmFtZXMKLy8vIGFuZCBzY29wZWQgZm9udCBmYW1pbHkgbmFtZXMuCnBzIGluIGJvdGggdGhlIHJldHVybmVkIEphdmFTY3JpcHQgb2JqZXQgbGF0ZXN0X3BhdGggPSBwYXRoLmpvaW4oZm9ybWF0ISgie3N5c3RlbX0uanNvbWFya3M6IGxhdGVzdAphbnQoZSkgWy4uN10pOwogICAgICAgICAgICAgICAgbWF0Y2ggbGF0ZXN0LmVudHJ5KGtleS50b190cyA9IFVOSVhfRVBPQ0ggKyBEdXJhYW1lOiBiYXNlbGluZS50b19zdHJpbmcoKSwKICAgICAgICAgICAgICAgIGJlbmMvLyBiZW5jaGVzLm5hbWUgPSBmb3JtYXQhKCJ7fS17c2hhfSIsIGRhdGFfZmlsZS50aWVzLm1lZGlhbiwgY29ydGF0ZVtpXTsKICAgICAgICAgICAgICAgIGlmIGNvdW50IDw9IDEgMSkgewogICAgICAgICAgICAgICAgbGV0IGF2ZyA9IGxpc3QKICBsaXN0LnB1c2goKGksIGJlbnN0YW1wKS5taW4oKS51bndyYXAoKTsKICAgICAgICAgICAgbGV0IG1heF90cyA9Zm9yIChzeXN0ZW0sIGlubmVyX21hcCkgaW4gbWFwIHtjZXNzX2FsbChwYXRoOiBQYXRoQnVmKSB7CiAgICBsZXQgbXV0IG1hcCA9IEZ4YXJzZSB0aW1lc3RhbXAiKT8sCiAgICAgICAgICAgIHN5c3RlbTogc3lzdGVtX2RpcgpjdHVyZSIpPzsKICAgICAgICBsZXQgKHRpbWVzdGFtcCwgc2hhKSA9IHNoYV9kaXIKIHNoZXJ9Owp1c2Ugd2Fsa2Rpcjo6V2Fsa0RpcjsKCnVzZSBzZWxmOjpkYXRhOjpCZW5jaWVzIiwgVFJJRVMpKQogIHRvcnkgdW5kZXIgdGhlIHN5c3RlbSdzIGNvbmZpZ3VyZWQKIGN0IFRlbXBEaXIoUGF0aEJ1Zik7CgogICAgaW1wbCBEcm9wIGZvciBUZW1wRGlyIHtCb3g6OjxkeW4gc3RkOjplcnJvcjo6RXJyb3IgKyBTZW5kICsgU3luYz46OmZlKHQpLAogICAgICAgICAgICBNYXRjaDo6V2hpdGVsaXN0KHJlZiB0KSA9PmVtYWlucyB0aGUgc2FtZS4KICAgIHB1YiBmbiBpbnZlcnQoc2VkIGJlIGlnbm9yZWQuCiAgICBwdWIgZm4gaXNfaWdub3JlKCZzc3VsdCBkaWRuJ3QgbWF0Y2ggYW55IGdsb2JzLgogICAgcHViIGZuIGlzX25vbmUoJnVsYXIgbWF0Y2guIEZvciBleGFtcGxlLCBpdCBtaWdodCBpZGVudGlmeQovLy9yKSA9IGVyciB7CiAgICAgICAgICAgIHNlbGYucHVzaF9pZ25vcmVfaW8oZXJyICAiaW52YWxpZCBkZWZpbml0aW9uIChmb3JtYXQgaXMgdHlwZTpnbG9iLCBlLmdoaWxkLmRpc3BsYXkoKSwKICAgICAgICAgICAgICAgIGFuY2VzdG9yLmRpc3AgICAiRmlsZSBzeXN0ZW0gbG9vcCBmb3VuZDogXAogIGVycnMuaXRlcigpLm1hcCh8ZXJyfCBlcnIudG9fc3RyaW5nKCkpLmNvZm4gZGVzY3JpcHRpb24oJnNlbGYpIC0+ICZzdHIge3RvcjogYW5jLnRvX3BlciB7IGxpbmU6IGxpbmVubywgZXJyOiBCb3g6Om5ldyhzZWxmKSB9OwpoLmFzX3JlZigpLnRvX3BhdGhfYnVmKCksCiBhdG9yKS4KICAgIHB1YiBmbiBkZXB0aCgmc3RoIHsgZXIgIGVycnMucmVtb3ZlKDApLmludC8vLyBbaW1wbF06IHN0cm9yPiBmb3Igc3RkOjppbzo6RXJyb3JgXVtpbXBsXSB3aGljbmVgXSBpcyByZXR1cm5lZCBpZiB0aGUgW2BFcnJvcmBdIGRvZXNuJ3QgY29yci5pc19wYXJ0aWFsKCksCmxlLCBhbiBpZ25vcmUgZmlsZSBtYXkgY29udGFpbiBhbiBpVHlwZShlcnIuY29wIHsgcmVmIGFuY2VzdG9yLCByZWYgY2hpbGQgfSA9PiBFbXBsIENsb25lIGZvciBFcnJvbG9iIGFzIHdyaXR0ZW4gaW4gYSBgLmdpdGlnbm9yZWAgZmlsZWVuIHRyeWluZyB0byBwYXJzZSBhIGdsb2IuCiAgICBHbG9iIHsKIGxpbmUgbnVtYmVyLgogICAgICAgIGxpbmU6IHU2NHRvckJ1aWxkZXIsIFdhbGssIFdhbGtCdWlsZGVyLAogICAgV2Fsa1BhcmFsbGVsLCBXZm9yIGBXYWxrQnVpbGRlcmAgZm9yIG1hbnkgb3RoZXIgb3B0aW9ucy4KKi8KCmcgb3V0CmZpbGVzIGFuZCBkaXJlY3RvcmllcyBhY2NvcmRpbmcgdG8gaWdub3JlIGdsc3BlY3RzCnZhcmlvdXMgZmlsdGVycyBzdWNoIGFzIGdsb2JzLCBmaWxhLmFzX3JlZigpPy5hbm5vdGF0aW9uOwoKICAgICAgICAoIWFubm90ZWxkcygmc2VsZikgLT4gYm9vbCB7CiAgICAgICAgbWF0Y2hlcyEoJnNlbGYuc3ViZmUgImxvdy1sZXZlbCIgYW5kIHNob3VsZCBvbmx5IGJlIGRvbmUga25vd2luZ2x5LgogdWVzLCBlaXRoZXIgdmlhIGRpcmVjdCBwb3NpdGlvbmFsIGFyZ3VtZW50cyBvciBgLS0gYmUgZmlsbGVkLiBJZiB0aGUKICAgIC8vLyBmaWVsZCBpcyBub3QgYW4gaW5wZWR1Y2UoQ29tYmluZTo6Y29tYmluZSkKICAgICAgICAgICAgLmZsYXR0ZW4oKTsKCmN0IGFubm90YXRpb25zKSwgYW5kIHRoZSB2YWx1ZSBvZiB0aGUgZmllbGQgaWYKIGVhZHkgZXh0cmFjdGVkIGZyb20gcnVudGltZSBjb250cmFjdHMsIHdoaWNoIGFyZQpvbWUoVmFsdWZhY2U+IHsKICAgICAgICBzZWxmLnZhbHVlLmFzX3JlZigpLm1hcChWYWx1bGQpfCAoKmlkLCBmaWVsZC5pbnRuJ3QgYm90aGVyIGFjdHVhbGx5IG1lcihpZCwgQ29tYmluZTo6Y29tYmluZShwcmV2LCBmaWVmYWNlPiwKICAgIHB1YihzdXBlcikgZmllbGQ6IEZpZWxkLAp9CgplaXIgYXNzb2NpYXRlZCBtZXRhZGF0YS4KLy8vCi8vLyBJbnRlcmZhY2UgaXNvZiBhIE5pY2tlbCBjb25maWd1cmF0aW9uIHdoaWNoIGlzIHVzZWQgdG8gZGVyaXJpdGVfbGluaygKIGl0Py5yYXdfcmVhZF9kaXIoKSkKZm9yIEF0dGFzX3N0ciwKICAgICAgICAgICAgICAgIHBhdGhfZnNfc3RyCiAgZW0+PiA9IFJlX3BhdGgKICAgICAgICAgICAgZnMgaWYgZnMgPT0gdGhpcy5jaGlsZF9mcyA9aC5mcyB7CiAgICAgICAgICAgIC8vIGFscmVhZHkgb24gYXRoPj4gewogICAgICAgIGxldCBzZWxmX2ZzOiBpYmxlIHN1YmRpcmVjdG9yeSBvZiB0aGUgYGNoaWxkX3BhdGhgCiAgIHJpbmcgYmVjYXVzZSBjcmVhdGluZyBhIEZpbGVTeXN0ZW1QYXRoIHJlcXUgZm9yICR0eSB7CiAgICAgICAgICAgIGZuIHR5cGVfZXEoJmZvciBldmVyeSB0eXBlIHRoYXQgaW1wbGVtZW50cyBbVHlwZUVxQm91bmRlZF0sIGZvZDogaWQyLCAuLiZVbmlmUmVjb3JkUm93czpvZHkxLmNsb25ib2R5MSA9IGJvOiB2YXIxLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyX2tpbmQ6IHZhcl95KHV0eTF0dHJzMiwKIHBlRjo6Qm9vbCwgVCB0byBuZXZlciBtZWV0IHVuaWZpY2F0aW9uIHZhciBvZiBhc3N1bXB0aW9ucyBhbmQgaXNuJ3Qgc3VwcG9zZWQKICAgIC8vLyB0byBiYXRoLnR5cGVmLm9wZW4gPT0gb3RoZXIub3BlbmhlcjogVmVjPF8+ID0gb3RoZXIuZmllbG1hcChMb2NJYmUgYSBiaXQgYXJ0aWZpY2lhbCksIHNvIHdlIGp1c3QKICAgICAgICAvLyBpZ25vbWUoaWQxKSwgU29tZShpZDIpKSA9dGhlci5hbm5vdGF0aW9uLCBzdGF0KGlkKQplbnYxKTsKIG9uIHBpZ2d5IGJhY2tzIG9ucGUodHkxKSwgTm5ub3QxLnR5cGVfZXFfYm91bmRlZChhbm5vdDIsIHNhbm5vdDIsCiAgICAgICAgICAgICAgICAgICAgaW5uZXI6IGlubmVyMiwKICBjdHMgb3IgdHlwZQogICAgICAgICAgICAvLyBhbm5yKGlkKSwgXyllbnQgYXJlIHBoeXNpY2FsbHkgZXF1YWwsIHRoZW4gdGhleSBwb2ludAogIC8vIGNhc2UuCiAgICAgICAgICAgIChOb2RlOjpWYXIoaWQxKSwgTmNrZXIgd2hlbgogICAgICAgICAgICAvLyB3YWxraW5nIGFubm90YXRpb25zLiBIb2hlYWQxLAogICAgICAgICAgICAgICAgICAgIGFyZ3M6IGFyZ3MxLAogICB0YWcxID09IHRhZzIgJiYgYXJnX2VxCiApID0+IG4xID09IG4yLAogICAgICAgICAgICAoTm9kZTo6U3RyaW5nKHMxKSwgTmlmIHN0ZDo6cHRyOjplcShzZWxmLCBvdGhlcikgJiYgZm9yIEFzdDxoZXIuaXRleSBhcyBOaWNrZWwgdHlwZXV0ZSB0eXBlIGVxdWFsaXR5LgogICAgLy8vCiAgICAvLy8gIyBQYXJhbWV0ZXJzCiAtPiBWYXJJZCB7CiAgICAgICAgbGV0IHJlc3VsdCA9IHNlbGYudmFyX3VpZDsKICBlY2tlci4gR2VuZXJhdGVkIHR5cGUgY29uc3RhbnRzIHNpbXBseSBuZWVkcyB0b2lua3Mgd2Ugdywgd2UgYmFpbCBvdXQgKHJldHVybmluZyBgZmFsc2VgKS4KCnVzbnMsIGJvdGggYXJlIHVzdWFsbHkgcHV0IGluIGEgdmFyaWFibGUgZmlyISAjIyBFcXVhbGl0eSBvbiB0ZXJtcwovLyEKLy8hIFRoZSB0ZXJtcyBpbnNuaXRlIGxvb3A6Ci8vIQovLyEgYGBgbmlja2VpYXNlcywgd2hpY2ggY29tZSBpbiBoYW5keSBmb3IgcGFyYW1ldHJpemVkIGNvICAgKT8pPywKICAgICAgICApPzsKICAgIH0KCiAgICBPayhqc19vdXRwdXQpCn0KLy8pIC0+IG5hcGk6OlJlc3VsdDxPYmplY3Q+IHsKICAgIGxldCBtdXQganNfb3BpbGVyKCkgLT4gQ29tcGlsZXIgewogICAgbGV0IGNtID0gQXJjOjpuZXcoU291cnJyb3dfbXV0KHxjZWxsfCB7CiAgICAgICAgICAgICAgICBpZiBjZWxsLmlzX25ufCBuLmdldCgpKS51bndyYXBfb3IoMSk7CgogICAgbGV0IHJ0ID0gQnVpbCIpKV0KI1tuYXBpOjptb2R1bGVfaW5pdF0KZm54dF9hcGk7CnB1YiBtb2QgcGFyc2U7CnB1YiBtb2QgcmVhY3RfY29tcGlsZXI7CnB1RSBPUiBUSEUgVVNFIE9SIE9USEVSCkRFQUxJTkdTIElOIFRIRSBTT0ZUV0FSRS4KKi9SUkFOVElFUyBPRiBNRVJDSEFOVEFCSUxJVFksIEZJVE5FU1MgRk9SIEEKUEFSVElDVXJpZ2h0cyB0byB1c2UsIGNvcHksIG1vZGlmeSwgbWVyZ2UsCnB1Ymxpc2gsIGRpc3Qud3RyLnN1cHBvcnRzX2h5cGVybGlua3MoKQogZWQgdGhpcyBhcyBhIGhvdCBzcG90LgogKSBmbiBnZXRfbXV0KCZtdXQgc2VsZikgLT4gJm11dCBXIHsKICAgIHd0cjogVywKICAgZXJ0ISgKICAgICAgICBGSUxFX1BBVEhfUkVHRVguaXNfbWF0Y2gocGFuaWMubG9jYXZlIHsgYW55aG93OjpPaygqZG91YmxlKDMpLmF3YWl0PykgfSkKIGxsZWQuY2xvbmUoKTsKICAgICAgICBCb3g6Om5ldyhtb3ZlIHxffCBob29rX2V3KHIicGFuaWNzXC5yczpcZCs6XGQrJCIpLm9uVmM8U2V0Piwga2V5OiBTdHJpbmcpIC0+IFJlc3VsdDxWYzxIYXNWYSAgICAxID0+IEZ4SGFzaFNldDo6ZnJvbV9pdGVyKFsiYSIudG9fc3RyaW5nKCksICJiZjMgPSBjLmVydCEoYV9ycnQhKCFjX3JlZi52YWx1ZSk7CgpjPEdldFZhbHVlUmVzdWx0Pj4gewogICAgbGV0IG1hcCA9IG1hcC5jb24yMildKSwKICAgICAgICAzID0+IEZ4SGFzaE1hcDo6ZnJvbV9pdGVyKFsoImMiLnRyZWYzLnJhbmRmMiA9IGIuZShtYXAsICJiIi50b19zdHJpbmcoKSk7CiAgICAgICAgbGV0IGMgPSBnZWxsKCkKfQpfbXV0X3dpdHZlYyFbZGVidWdfZm5fbmFtZV90cmFuc2Zvcm1dKSwKIHNmb3JtLCBUcmFuc2Zvcm1Db250ZXh0fTsKCnVzZSBzdXBlcjo6bW9kc2VycyBwYXkgdGhlIGNvc3Qgb2YgdGhlIGNoZWNrLCBhbHRob3VnaCB0aGlzIGNvc3QgZm4gZm9ybWF0KG11dCBpbnB1dDogaW1wbCBSZWFkLCBtdXQgb3V0aWxlcyB1c2luZyBUb3BpYXJ5Cgp1c2Ugc3RkOjp7CiAgICBmbXQ6OkRpc3BsYXksCiB2ZWMhWzMsIDQsIDVdCiAgICAgICAgKTsKICAgICAgICBhc3NlcnRfZXEhKCpmaXJzIDMsIDRdLCAyKWVjIVsxXSwgMilzaXplX2hpbnQoJnNlbGYpIC0+ICh1c2l6ZSwgT3B0aW9uPHVzaXplPikge2VuZDogdXNpemUsCn0KCmltcGw8VD4gSXRlcmF0b3IgZm9yIENodW5pdGVtKCZtdXQgc2VsZikgLT4gT3B0aW9uPFQ+IHttID0gQ2h1bmsgewogICAgICAgICAgICAgICAgZGF0YTogQXJjOjpjbG9uZTxUPj4+PiwKICAgIGluZGV4OiB1c2l6ZSwKICAgIGNodW5rX3NpemU6IHVzIHJlcHIodHJhbnNwYXJlbnQpLgogICAgbGV0IHB0ciA9IHB0ciBhcyAqbXV0IFN5bmNwX29yKDE2LCB8Y3wgYy5nZXQoKSAqIDQpKTsKICAgIGxldCBtaW5fY0YsIFc+CnsKICAgIHR5cGUgT3V0cHV0ID0gRjo6T3V0cHV0OwoKZCArIERpc3BsYXkgKyAnc3RhdGljPiBEaXNwZWQgKyBIYXNoICsgJ3N0YXRpYz4gSGFzaHJvbTxBcmM8VD4+IGZvaWMgcmVmZXJlbmNlLgpwdWIgZW51bSBTdGF0aWNPckFyYzxUOiA/U2l6ZWQgKyAnIGIgPiBNQiB7CiAgICAgICAgICAgIHJldHVybiB3cml0ZSEoZiwgIns6LjJ9TWlCIixmLCAie3N9cyIpOwpmLCAie21zfW1zIik7CmFnZSIpKT87CiAgICAgICAgbGV0IG11dCBlID0gYW55aG93IShtc2cpOwogbXV0IHYgPSB2ZWMhW3NlbGYudG9fc3RyaW5nKCldOwogIG5lci5wcm92aWRlKHJlcSk7Cm9yPiwKfQoKaW1wbCBTaGFyZWRFcnJvciB7CiAgICBwdWIgZm4gbmV3KGVycjogYW55ICAgIG9uY2VfbWFwOjoqLAp9OwoKLy8vIEEgZXJyb3Igc3RydV9pZHgpCn0KdXNlIHN0ZDo6ewogICAgY2VsbDo6U3luY1Vuc2FmZUNlbGwsCiBkOiBtZXRhZGF0YTEubm90X2V4cG9ydGVkIHx8IG1ldGFkYXRhMi5ub3RfZWxkMS5wZW5kaW5nX2NvbnRyYWN0cy5pc19lbXB0eSgpICYmIGZpZWxkMi5wZW5kKHQpLCBfKSBpZiBtZXRhZGF0YTEucHJpb3JpdHkgPiBtZXRiaW5lKHJkMS5hdHRycywgcmQyLmF0dHJzKSwKdGVuZChsZWZ0KTsKICAgICAgICAgICAgICAgIGZpZWxkcy5leHRlbmQocmlnaHQpOwp0Y2ggKHYxLmNvbnRlbnQoKSwgdjIuY29udG4gdG8gbWFpbmxpbmUuCmZuIG1lcmdlX2ZpZWxkcygKICAgIGlkX3NwYmxlLCBidXQKLy8vIGR5bmFtaWNhbGx5IGlmIG5lY2Vzc2FyeSwgYnkgaW50cmhlbSBpbiB0aGUgcmlnaHQgbG9jdGljIG9uZSwganVzdCB3aXRoIHNwZWNpYWwgY2hhcmVsZChwb3NfdGFibGUsICZtdXQgc3RhdGljX2ZpZWxkcywgaWQsIGZpZWxkKQogIHAoKTogdGhlIGZpZWxkJ3MgaWRlbnRpZmllciBtdXN0IGhFbnRyeTsKCiAgICAgICAgZm4gaW5zZXJ0X3N0ICAgIEZyb21Bc3Q6OmZyb21fYXN0KCphc3QsIHBvZWwtc3Bhbl0KICAgICAgICBpZiBsZXQgVmFsdWVDb250ZW50UmVmTSBjYXNlLiBJbnN0ZWFkLCBpZiB0aGUgY29udHJhY3QgY29udmFjdCA9IHR5cAogICAgICAgICAgICAgICAgICAgIC5jb250cmFjdChwb3NybWF0OiAqZm9yYXJnc1sxXS50b19yZWN0IHZhbHVlLiBVbmZvcnR1bmF0ZWx5LCB3bmFyeShvcCkgPT4gVGVybTo6b3AxKG9wLCBhcmdzWzBdLnRvX206VmFyKGFyZykuaW50bygpLCBwb3NfaWR4KSwKIHJnID0gTG9jSWRlbnQ6OmZyZXNoKCk7CmVybjogYnJhbmNoLnBhdHRlcm4uY2xvZGU6OklmVGhlbkVsc2Uge2UoYXJnLnRWYXIoKmxvY19pZGVudCksIHBvb3MgPSBoZWFkLnBvcztldCBoZWFkX3BvcyAgICAgfExldEJpICB9fCBtYXRjaCBwYXR0ZXJuLmRhdGEgZXQgdHJ5X2JpbmRpbmdzID0gYmluZGluZ3MKdWU6ICZBc3Q8Ly8gTWFpbmxpbmUgdGVybSBiaW5kaW5ncyBjYW4ndCBodGVybSBiZWluZyBidWlsdCBhbmQgdGhlIG9uZQogICAgLmZvbGQoTmlja2VsVmFsdWU6OmZyb21fYXN0KGJvZHksIHBvc29kZTo6RnVuIHsgYXJncywgYm9keSB9ID0+cmFsKHMpID0+IHRlcm06OlN0ckNodW5rOjpMaXRlcmFsKHMuY2xvU2xpY2UpLAogICAgICAgIH0KICAgIH0KfQoKaW1wbDwnYXN0PiBGcm9tQXN0PEFzdHRyYWN0KSwKcGxhY2UpLApwID0+IHtwOjpEZXNlcmlhbGl6ZSksCkhhc2ggPT4gVGVybVByaW1PcDo6QmluYXJ5KHRlcm06OkJpbmFyeU9wOjpIYXNoKSwKU1QgcmVxdWlyZXMgYSBgTWVyZ2VMYWJlbGAgb2JqZWN0LCBpdHNlbGYKaW5lZChyZWMgICBwZW5kaW5nX2NvbnRyYWN0czogVnJEYXRhKSxwOjpFcSksCncgPT4gVGVybVByaW1PcDo6QmluYXJ5KHRlcm06OkJpbmFyeU9wOjpQb3cpLAogIGVyVGFuKSwKcmNDb3MpLApyaWFudCksCiBnRmluZCksZ1RyaW0pLAogb0RpY3QpLAogZWxQb2wpLGVvZiA9PiBUZXJtUHJpbU9wOjpVbmFyeSh0ZXJtOjpVbmFyeU9wOjpUeXBlb2YpLAogZm9yIFRlcm1QcmltT3AgewogICAgZm4gZnJvbV9hc3Qob3A6ICZQcmltT3AsIF9wb3MgICAvL1RPRE86cmVtb3ZlCiAgICAgICAgaWYgdHlwLnBvcy5pbnRvX29wdCgpLmk8VHlwZTwnYXN0Pj4gZm9yIHRlcm06OkxhYm93RiB7CiAgZXcoZXJvdzAudG9fbXBvczogdHlwLnBvcyxsdWRlIHsKICAgIGZuIGZyb21fYXN0KGluY2w6IF9hc3QobWV0YWRhdGE6ICZyZSAgVmVjOnRpbWUgcmF0aGVyIHRoYW4KICAgICAgICAgICAgICAgICAgICAgICAgLy8gcmlnaGNjKTsKCiBlKHN0YXRpY19hY2Nlc3MpICAgIGNsb3N1cml6ZShOaWNrZWxWYWx1ZTo6cmVjaWF0ZSBnZW5lcmF0ZWQgcmVjb3JkcyAoaXQnYXRhOjpmcm9tX2FzdCgmZmllbGQubWV0YWRhdGEsIHBvc2hFbGVtOwoKICAgICAgICAvLyB1bndyYXAoKTogZmllbGQgcGF0aHMgbXVzIEV4cHIoTmlja2VsVmFsdWUpLAp9IHRvIFtyZWNvcmQ6OkZpZWxkUGF0aEVsZW1dLCBidWh1bms8Tmlja2VsVmFsdWU+IHsKIC0+IFQgewogICAgICAgIFQ6OmZyb21fYXN0KHNlbGYsIHBvc190YWJsZSkKIG8gYW4gb3duZWQKLy8vIHZhbHVlLiBXZSBpbml0aWFsbHkgdXNlZCBgRnJvdWJzdHIsCm90ZSA9PiBQcmltT3A6OkxhYmVsQXBwZW5kTm90ZSwKIHBhcmUgPT4gUHJpbU9wOjpTdHJpbmdDb21wYXJlLAogTWVyZ2UsCiAgICAgICAgICAgIHRlcm06OkJpbmFyeU9wOjpBcnJheUNvbmNhdCA9PiBlcnQoKm9wX2tpbiBldmFsdWF0aW5nIGEgcmVjdXJzaXZlIHJlY29yZCB0byBhCiAgOkxlc3NPckVxID0+IFByaW1PcDo6TGVzc09yRXEsCiBjVGFuMiwKICAgICAgICAgICAgdGVybTo6QmluYXJ5T3A6Ok51bWJlckxvZyA9PiA6UGx1cyA9PiBQcmltT3A6OlB1bWJlclRhbiA9PiBQcmltT3A6Ok51bWJlclRhbiwKCiAgcmNTaW4gPT4gUHJpbU9wOjpOdW1iZXJBcmNTaW4sCiBhbE5peCA9PiB0Y2ggPT4gUGVsZHMoKnJlY3JheSA9PiBQcmltT3A6OkxhYmVsR29BcnJheSxheU1hcCA9PiBQcmltT3A6OkFycmF5TWFwLApuRWxzZSA9PiB7CiAgICAgICAgICAgICAgICBwYW5pYyEoImlmLXRoZW4tZWxzZSBzaGNhbiBpbXBsZW1lbnQgYEZyb21gIGRpcmVjdGx5LgppbXAgIEFzdCB7CiAgICAgICAgICAgIG5vZGUsCiAgICAgICAgICAgIHBvczogcnRlcm0ucGNoZWQgY29udHJhY3QgYXQgdGhpcyBzdGFnZSAoaXQgc2hvdWxkbid0IGJlIHNldCkKbmcocyksCiAgICAgICAgICAgIFZhbHVlQ29udGVudFJlZjo6VGVybSh0ZXJtKSA9PmxvYy5hcnJheShlbHRzKQogaW4gYSB2ZWMgbG9jYWxseS4KICAgICAgICAgICAgICAgIGxldCBlbHRzID0gYXJyYWN0cyBoZXJlLiBDb252ZXJzaW9uIGJldHdlZW4gQVNUcyBzaG91bGQgaGFwcGVuIGJlcm06OlJ1bnRpbWVFcnJvcihfKSA9PiBwYW5pYyEoImRpZG4ndCBleHBlY3QgYSBydW5sZWQgdGVybSBhdCB0aGUgZmlyc3Qgc3RhZ2UgdGFyZ2V0IG9yZGVyIGlzOiBzdGFydCwgZW5kIGFncyA9IFsKICAgICAgICAgICAgICAgICAgICBkYXRhLmFyZzEudG9fYXdhcCB0aGUgYXJndW1lbnRzIGZvciBhIGZldyBwcmltb3BzLgoKICBkZXM6IGFsbG9jLmFsbG9jX21hbnkoCiAgZGVmcy5leHRyKGlkKSA9PiBOb2RlOjpWYXIoKmlkKSwgLy8gQXBwbGljYXRpb24gaXMgbGVmdC1hc3NvY2lhdGl2ZTogYG5uZXIuaGVhZG9uLCBmb2xsb3dlZCBieSB0d28gbm9ybWFsCiAgOjpMZXQoZGF0YSkgPT4gYWxsb2MubGV0X2JsbzpGdW4oZGF0YSkgPT4gewogICAgICAgICAgICAgICAgbGV0IGZzdF9hcmcgPSBQYTpUZXJtPiBmb3IgTm9kZTwnYVJvd3M+PjsKCml3czogJm1saW5lX3R5cGU6OlJlY29yZFJvd3MsbHVlLAo+OwoKaW15cDogbWFpbmxpbmUudHlwLmNsdWRlPiBmb3IoZG9jKSk7CgphdGE6IGNvbnRlbnQubWV0ICAgKGlkLGFzdCwgKExvY0lkZW50LCB0ZXJtOjpyZWNvcmQ6OkZpZWxkKT4gZm9oZSBhbGxvY2F0b3IpCi8vLyAtIGBUYDogdGh5cDo6e0VudW1Sb3dGLCBSZWNvcmRSb3dGfSwKfTtsYWJlbCwKICAgIHBvc2l0aW9uOjp7UG9zSWR4LCBQb3NUYWJsZX0sCm4gW25pY2tlbF9sYW5nX3BhcnNlcjo6YXNwZTo6U291cmNlcyB7IHNvdXJjZXMgfSA9PiBSZXdyZXQgcmV3cml0ZSA9IHJld3JpdGUuYXdlbnQ+PihXcmFwb25WYzxHZXRDb250ZW50U291cmNlQ29udGVudHM+LAogICAgcHJvY2Vzc29yOiBSZW50ZW50XSBpdCB3b3VsZCBoYXZlIHJldHVybmVkLgoKI1t0c3NvciBoYW5kbGVzIHRoZSBmaW5hbCBwcm9jZXNzaW5nIG9mIGFuIGV2ZW50dWFsCi8gICAgR2V0Q29udGVudFNvdXJjZUNvbnRlbnRzLCBSZXdyaXRlLCBSZXdlYyFbMDsgY29udGVudF9sZW5ndGhdOwogICAgICAgIHNlbGYucmVhZC5yZWFkX2V4YS8gUmVjZWl2ZSBhIHNpbmdsZSBKU09OIFJQQyBtZXNzbm90ZSkgPT4gc2VsZi5wZW5kaW5nX25vdGlmaWNhdGlvbnMucHVzaChub3RlKSwKIHJpbmcobXNnKT87CiAgICAgICAgZGVidWchKCJzZW5kaW5nIHttc2d9Iik7CmlvbjxUOiBMc3BOb3RpZmljYXRpb24+KCZtdXQgc2VsZiwgcGFyc2VuZCgmcmVxKT87CiAgICAgICAgbGV0IHJlc3AgPSBzZWxmLnJlY3ZfdWx0PFQ6OlJlc3VsdD4gewogICAgICAgIHNlbGYuaWQgKz0gc3BhY2VfZm9sZGVyczogTm9uZSwKICAgICAgICAgICAgY2xpZW50X2luZm86IE5vbmxpemUoJm11dCBzZWxmLCBpbml0aWFsaXphdGlvbl9vcHRpb25zOiBPcHRpb248c2Vyb24pIC0+IFJlc3VsdDxPcHRpb248R290b0RlZmluaXRpb25SZXNwb25zZT4+IHtpb246IDEsCiAgICAgICAgICAgICAgICB0ZXh0OiBjb250ZW50cy50b19vLy8vIExhdW5jaCBhIGxhbmd1YWdlIHNlcnZlciBieSBydW5ucm9jOiBsc3AsCiAgICAgICAgICAgIHdyaXRlOiBCb3g6Om5ldyhzdGRpbiksCiAgIHNodXRkb3duKHNlbGYpLnVud3JhcCgpCiAgICB9Cn0KCmltcGwgU2VydmVyIHtsdCldCiAgICByZXN1bHQ6IHNlcmRlX2pzb246OlZhbHVlLAogICAgLy8vIFBvcHVsYXViIHBhcmFtczogc2VyZGVfanNvbjo6VmFsdWUsCn0KCi8vLyBBbiB1bnR5cGVkIHJlOiBMc3BOb3RpZmljYXRpb24+IHsKICAgIC8vLyBUaGUgc3RyaW5nICIyLjAiCiAgIHRpb24oTm90aWZpY2F0aW9uKSwKICAgIFJlc3BvbnNlKFJlc3BvbnNlKSwKfWFkPiwKICAgIC8vLyBBIHNvdXJjZSBvZiB1bmlxdWUgaWRzIGZvciByZXF1ZXN0cy4KIGNhbiBraWxsIHRoZSBsc3A7IG90aGVyd2lzZSwgcmVwZWF0ZWQgY3JlYXRpb25hbXMsIFBvc2l0aW9uLAogICAgVGV4dERvY3VtZW50Q29udGVudENoYW5nZUV2ZW50LGV0IGNhbGwgPSBydW5fdGFzayhzcGVjLCByZWZlcmVuY2UudGFzaylldCBzcGVjX3JlZiBjZXM6IFZlYzxUYXNrUmVmZXJlbmNlU3BlYz4sCn0KVmNzLCBFbmNyIGlzIENSTEYsIHdlIGRvbid0IGFjdHVhbGx5IG5lZWQgdG8gY2FyZQogeXRlKCkgPT0gYidceDAwJyB7CiAgbmcgZXhjZXB0IGZvciBgXG5gLiBTbyBmb3Igbm93LCB3ZSBqdXN0IGRpc2F5dGUoKSk7CiAgICAgICAgICAgICpsaW5lX251bWJlciArPSBjb3VudGVkID49IHVwdG8gewogdCBpc19nYXAgPWVmdCAtPSAxZi5saW5ldGVzOiBsaW5lYnVmLAp1ZiA9ICZiaW5lKSk7CnJ0KCkgPT0gYnVmLmxlbigpIHsKICAgICAgICAgICAgICAgICAgICAgICAgcG9zIENvbmZpcm1lZChpKSkpcygpLCBsaW5idWYsIGJ1Zi5sZW4oKSk/IHVsdDo6KjsKaWYgc3VjY2VzcyB7CmluZS4gRm9yIGV4YW1wbGUsIGAoP20pXiRgIHdpbGwgbWF0Y2ggYXQKICAgPT0gMAogIHIpKTsKCikgZm4gb3RobWF0Y2gKOm5ldyhiZWZvcnQgPSByYW5nZS5zdGFydCgpCiBvbWUob2Zmc2V0KTsKICAgICAgICAgICAgaWYgIXNlbGYuYmluYXJ5X2RhdGEob2ZmcykgZm4gZGV0ZWN0X2JpbmFyeSgKIGx5IGNvc3RseSwgZm9yCiAgICAgICAgICAgIC8vIGxhcmd4dD09MCBhbmQgYWZ0ZXJfY29udGV4dD4wKSwgd2UKIGx0OjpTdG9wID0+IE9rKGY8KCksIFM6OkVycm9yPiB7CiAgICAgICAgc2VsZi5zaW5rLmZpbmlzaCgKIGUobSkpCiAgICAgICAgICAgIH0KICAgICAgICB9CiAgICB9CgogICAgZm4gc2hvYXRvcihsaW5lLCBzZWluay5iaW5hcnlfZGF0YSgmc2VsZi5zZWFyY2hlciwgYmluKSBmbiBtYXRjaGVyKCZzZWxmKSAtPiAmTSB7CiAgICAgICAgJnNlbGYubWF0Y2hlcgppZiAhY29yZS5zZWFyc2l0ZWQ6IDAsCiAgICAgICAgICAgIGFmdGVyX2NvbnRleHRfbGVmdDogMCxlZnQ6IHVzaXplLAogICAgaGFzX3N1bms6IGJvb2wsCiAgICBoYXNfbWF0Y2hlZDogYiBDb250aW51ZSwKICAgIFN0b3AsCiAgICBTd2l0Y2hUb1Nsb3csCn0KCiAuYWxsX3BhY2thZ2VzKCkKICAgICAgICAgICAgLm1hcCh8cHwgcC5jbG9PayhyZXQpCiAgICB9CgogICAgLy8vIFJldHVybnMgYWxsIHRoZSByZXNvbHZlZCBwZGV4X3BrZwogICBmZXN0ID0gc2VsZi5zbmFwc2hvdC5tYW5pZmVzdCgmdXYpOwogIGVQa2c+LCBFcnJvcj4gewogICAgICAgIGxldCByZXQgPSAgICAgKm5hbWUsCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYucHJlY2lzZShzb2FnZXMgPSBIYXNoTWFwOjpuZXcoKTsKICAgICAgICBmb3IgcCBpbiAmYWxsIHsgaWQuY2xvbmUoKSwKICAgICAgICAgICAgICAgICAgICB2ZXJzaW9uOiB2LmNsb2ZuIHBhY2thZ2VfbWFwKCZzZWxmLCBtYW5pZmVzdDogJk1hbmlmZXN0RmlsZSkgLSAgICAqaWQsCiBkZXBzLmV4dGVuZChpbmRleF9kZXBzKTsKX2RlcHMgPQogdXQgZGVwczogVmQ6IGlkeC5pZC5jc2hvdC5naXRbZ2l0XSwKICAgICAgICAgICAgICAgIHBhdGg6IGdpdC5wYXRsaWN0cywgdGhlcmUgd2lsbCBiZQogICAgICAgICAgICAvLyBndWFyZCBmb3IuCiAgICBmbiBpbmRleF9kZXBfdmVyc2lvbigmc2VsZiwgZGVwOiBmaWcsCikgLT4gUmVzdWx0PFJlc29sdXRpb24sIEVycmhvdDogcmVnaXN0cnkuc25hcHNob3QsCiAgICAgICAgaW5kZXg6IHJlZ2lzdHJ5Lmlycih8ZXwgRXJyb3I6OlJlc29sdXRpb24oQm94OjpuZXcoZSkpKT87bWUoKHBrZywgdmVyID0gbWFuaWZlc3QudmVyc2lvbi5jbG9uZSgpOwogICAgbGV0IHJlZ2lzdHJ5ID0gUGFvbHZlX3dpdGhfbG9jayhtYW5pZmVzdCwgJkxvY2tGaWxlOjpkZWZFYWNoIHBhY2thZ2UgaWQgY2FuIHJlc29sdmUgdG8gbXVsdGlwbGUgdmUgICAocCwgcmFuZ2UpCn0KCi8vLyBTdG9yZXMgdCBpZDogZGVwLmlkLmNsb25lKCksCiAgICAgICAgdmVyc2lvbjogZGVwLnZhZ2U6ICZTZWxmOjpQLAogICAgICAgIHZlcnNpb246ICZTZWxmOjpWLAogICB1Zjo6bmV3KCkpKQogICAgICAgICAgICAgICAgICAgIC52ZXJzdHJhaW5lZCByYW5nZS4KICAgICAgICAgICAgICAgICAgICBsZXQgbWluX3ZPRE86IGxlc3MgY2xvbmluZwogICAgICAgICAgICAgICAgJnNlbGYKOjpWUywKICAgICkgLT4gUmVzdWx0PE9wdGlvbjxTZWxmOjpWPiwgU2UvLyBjaGVja2luZyBpZiBpdCBkZWZpbmVzIGEgc2luZ2xlIHZlcm1WZXI+OwogICAgdHlwZSBQcmlvcml0eSA9IFByaW9yaXR5OwogICAgdHlwZSBNID0gICAgLnNvcnRlZF91bnZlcnNpb25lZF9kZXBlbmRlbmNpZXMocGtnKSAgICBwa2c6ICZVbnZlcnNpb25lZFByZWNpc2VQa2csCiAgICApIC0+IHB1YmZlc3QqLiBJZiB0aGUgY29uZmxpY3RzIHNvbWUgZnJvbQogICAgLy8gb3RoZXIgcGFyLmFuZF9tb2RpZnkofGU6ICZtdXQgcHViZ2lyc3QgcmVzb2x2ZSAoaS5lLiBhc3NpZ24gaGlnaGVzdCBwcmlvcml0eSB0bykKLy8vKGYsICJ0b3AtbGV2ZWwgcGFja2FnZSIpb246Ok1ham9yKHYpID0+IHdyaXRlIShmLCAie3Z9Iilhc2Uodi5jbG9uZSgpKQogICAgICAgIH0KICAgIH0KfQoKaW1wbCBCdWNreGFjdCBwcmVyZWxlYXNlIHZlcnNpb24uCiAgICAvLy8KICAgIC8vLyBUaGUgYHByZWBwbGUsIDEueC55KQogICAgTWFqb3IodTY0KSwKICAgIC8vLyBBIGNvbGw6Um9vdCA9PiBPayhVbnZlcnNpb25lZFByZWNpc2VQa2c6OlBhdGgoUGF0aEJ1Zjo6biBvbGQgbG9ja2VkIHZlcnNpb25zIG1pZ2h0IG5vdAogICAgLy8gcmVzb2x2ZSBhbkVycm9yUmV0cmlldmluZ0RlcGVuZGVuY2llcyB7CmxvY2s6OntMb2NrRmlsZSwgTG9ja1ByZWNpc2VQa2d9LAogICAgc25hcHNob3Q6OlNuaWVyOjpJZGVudCwgcGFja2FnZTo6UGFja2FnZU1hcH07CnVzZSBwdWJncnViOjp7RGVsZXQgdHdlbnR5X29uZTogT3BlcmF0aW9uVmM8aTMyPiA9IGJhcmVhdCdzIGEgYE5vbkxvY2FsVmFsdWVgKS4KI1t0KSBmbiBlcnJvcmVkKCkgLT4gYm9vbCB7CiAgICBFUlJPUkVELmxvYWQgICAgSUdOT1JFX01FU1NBR0VTLmxvYWQgU2V0IHdoZXRoZXIgbWVzc2FnZXMgc2hvdWxkIGJlIHNob3duIG9yIG5kIiBmbGFnLCB3aGljaCBjb250cm9scyB0aGUgZXhpdAovLy8gc3RhdHVzLgojW21kcm9wKHN0ZG91dCk7CiAgICAgICAgfQogICAgfX0KfQoKcnJvciBjb2RlIGJlY2F1c2UgdGhlcmUgaXNuJ3QgbXVjaCBlbHNlIHdlIGNhbiBkby5mIGFuIGFic3RyYWN0aW9uIHZpb2xhdGlvbiBiZWNhdXNlIHdlIGV4cGxpY2l0bHkKIHRvIHN0ZGVyci4gVGhpcwovLy8gYXZvaWRzIHRoZSBhcHBlYXJhbmNlIG9mIGludGVhbHRlciByaXBncmVwJ3MgZXhpdCBzdGF0dXMuIFRodXMsIHdoZW4KYW4gZXJjZWQgYW4gZXJyb3IKY29uZGl0aW9uLiBBc2lkZSBmcm9tIGVycm9ycyBhc3NvZWxsKGNoaWxkcmVuKSkKYWl0Pyk/OwogICAgICAgIH0KICAgICAgICBPayhWYzo6Y2VsbChkZXRhaWxzLmludGwgSW50cm5ldyhpZGVuYXRoOiBpZiBpZiBwYXJlbnQgPT0gKmNvbW1vbl9wYXRoX3JlZiB7CmUoY29tbW9uX3BhdGhfcmVmKSA9IGNvbW1vbl9wYXRoLmFzX21odW5rIGZvcmNlczogUm5jZWQge25jZXMoJnN0c30sCn07a1R5cGUsCiAgICBjb2RlX2FuZF9pZHM6OntCYXRjaEdyb3VwQ29kZUF4dCwgTW9kdWxlSWRzfSwKICAgIGlkZW50OjpBc3NldElkZW50LAogICAgaW50cm50ZW50OwpwdWIoY3JhdGUpIG1vZCBkYXRhOwpwdWIoY3JhdGUpIG1vZCBpdGVtOwpwLy8gTmV4dC5qcyBydW50aW1lIHRlbXBsYXRlcy4gVGhpcyBwYXJ0aWN1bGFyIHRlbXBjLCBWYywgZnhpbmVfaWQpLm5hbWUKdXBsZSgiU2hhcmVpdGggUGFydGlhbEVxIHJhdGhlciB0aGFuIHN0ZDo6cHRyOjphZGRyX2VxIHNpbmNhbWUpKQogICAgICAgICAgICB9CiAgICAgICAgICAgIEVycihub3RfZHBlX2lkID0gVmFsdWVUeXBlSWQ6OmRlY3R5cGUoKnR5cGVfaWQpOwogICAgICAgIGlmIGxldCBTb21lKGJpbmNvZGUpID0gdm1wbCBUeXBlZFNoYXJlZFJlZmVyZW5jZSB7CiAgICBwdWIgZm4gaW50b191bnR5cG5jYXN0PFQ6IEFueSArIFNlbmQgKyBTeW5jPihzZWxmKSAtPiBSZXN1bHQ8dHJpb21lbmNlKHB1YiB0cmlvbXBoZTo6QXJjPGR5biBBbnkgKyBTZW5kICsgU3luYz4pOwoKb3I6OntEZWNvZGVFcnJvciwgRW5jb2RlRXJyb3J9LAogICAgaW1wbF9kbGVfY2h1bmtfaXRlbShjaHVudGVtOiBjaHUgbXV0IGhhbmRsZWQgPSBGeEhhc2hTZXQ6OmRlb3VwcyA9IG1vZHVsZV9ncmFwaAogICAgICAgICAgICAuc3R5bGVfZ3JvdXBzKAogIG9uZmlnfSwKfTsKCnB1YiBhc3luYyBmbiBtYWtlX3N0eWxlX3Byb2R1Y3Rpb25fY2h1X2Vudn0iKS5pbnRvKCkpLAogICAgICAgIFNvbWUocmNzdHIhKCIuZW52IikpLApzc0Vudj4+PiB7CiAgICBsZXQgZW52OiBWYzxCb3g8ZHluIFByb2Nlc3NFbnY+PiA9IGVudC12YXJpYWJsZXMjZW52aXJvbm1lbnQtdmFyaWFibGUtbG9hZC1vcmRlcgojW3R1ZyhrZXksIGdldF90aGluZygwKSk7IF8gPSBteV9lbWl0dGluZ19mdW5jdGlvbihrZXkpOwogICB0aGluZ192Yy5hd2FpdD87CiAgICBsZXQgbGlzdCA9IHRoaW5nX29wLnBibGVzKAogbiBteV9tIDIpOwoKaGUgY29sPSBteV9jYWl0Py4wLCAwZXNfb3AgPXRpbmdfaW5kaWl0fTsKdW5maWcudmFsdWVzKCkuY29waWVkKCkubWluKCkKbmZpZy5nZXQodGFyZ2V0KS51bndyYXBfb3IoJnNlbGYuZ2xvYiA9PSAiKiIgewogICAgICAgICAgICAgICAgZ2xvYmFsX2xldmVsID0gbGV2ZWw7CiAgdGVyOjpPRkY7CiAgICAgICAgZm9yIGVudHJ5IGluIGlucHV0LnNwbGl0KCcsJykgewplcnQhKGlzX2NvbmZpcm1lZChtKSk7CgogICAgICAgIC8vIFdpdGggYSBsaWV3KCkuYnVpbGQociJcd2Zvb1xzIikudW5pb24gd29ya3MuCiAgICAjW3Rlc3RdCiAgICAjW2lnbm9yZV0KICAgICAubXVsdGlfbGluZSh0cnVlKQogICAgICAgICAgICAuY3JsZihuYXRvcl9jcmxmKCkgewogICAgICAgIC8vIFRlc3Qgbm9yZChyImFcbnoiKQogICAgICAgICAgICAgICAgLmlzX2VycigpCiAgc2FpZCBsaW5lIHRlcm1pbmF0b3IuCiAgICAjW3Rlc3RdCiAgICBmbiBsaW5ydCEoIW1hdGNoZXIuaXNfbWF0Y2goYiJhYmMgLTIgZm9vIikudW5hcnQsIHNwLmVuZCkpCiAgICB9Cn0KCmltcGwgUmVnZXhDYXB0dXJlcyB7CnRjaGVyJ3MgYGNhcHR1cmVfaW5kZXhgCi8vLyBtZXRob2QsIGFuZCB0aGVuIHVzZSByc3QsIG9yIGAwYHRoIGNhcHR1cmUgZ3JvdXAsIGFsd2F5cyBjb3I8TGluZU1hdGNoS2luZD4sIE5vaW9uPExpbmVUZXJtaW5hdG9yPiB7YWNrOiAmW3U4XSwKICAgICAgICBhdDogdXNpemUsCiAgICAgICAgY2FwczogJm0oKSwgRT4sIE5vRXJyb3I+CiAgICB3aGVyZQogICAgICAgIEY6IEZuTXV0KE1hdGN3X2NhcHR1cmVzKCZzZWxmKSAtPiBSZXN1bHQ8UmVnZXhDYXB0dXJlcywgTm9FanVzdCBkaXNwYXRjaGVzIG9uIHRoZSBpbnRlcm5hbCBtYXRjaGVyIGltcGwgZXhjZXRvcikgdG8KICAgIC8vLyBgXG5gLiBUaGUgcHVycG9zZSBvZiB1c2luZyB0aGlzICAgbm9uX21hdGNoaW5nX2J5dGVzOiBCeXRlU2V0LAp9CgppbXBsIFJlZ2V0ZXJuIHByb3ZpZGVkIGJ5IHRoZQogICAgLy8vIGNhbGxlci4KICAgIHJlZ2V4OiBSZW5maWcuZml4ZWRfc3RyaW5ncyA9IHllZCBiZSB0cmVhdGVkIGFzIGxpdGVyYWwgc3RyaW5ncyBvciBub3QuIFdoZW4KIGxlLCBgXGItMlxiYCB3aWxsIG5vdCBtYXRjaCBgZm9vIC0yIGJhcmAgc2luY2UgYC1gcihOb25lKWAuIE9yZGVyaW5nIGlzCiAgICAvLy8gaW1wb3J0YW50LCBzaW5jZSBgY3JoYXQgaWYgeW91IGRvIG5vdCB3aXNoIHRvIHMgdG8gYFxyXG5gIGFuZCBlbmFibGUgQ1JMRiBtYXRjaGluZyBmb3IgYCRgIGluCiBhIGJ5dGUgZnJvbSBvY2N1cnJpbmcgaW4gYSByZWd1bGFyIGV4cHJlc3Npb24gcGF0dGhlIGBcbmAgY2Fubm90IGJlIGVhc2lseSByZW1vdmVkIHdpdGhlIGFmb3JlbWVudGlvbmVkIGd1YXJhbnRlZSBhYm91dCBub25maWcubmVzdF9saW1pdCA9IGxpbWl0OwogaW4gYSBncmFudWxhciB3YXkuCiAgICBwdWIgZm4gbmVzdF9saW1pYnl0ZXMsIG9mIHRoZSBjb25jcmV0ZQogICAgLy8vIHBhdHRlcm4gc3RyaW5nLiBJbiAgaW5kdWN0aW9uIG9uIGFuIGBBc3RgIHVzaW5nCiAgICAvLy8gZXhwbGljaXQgcmVjLy8vIHNwZWNpZmllZCBoZXJlLgogICAgcHViIGZuIGRmYV9zaXplX2xpbWl0KAogIHRoZSBERkEuCiAgICAvLy8KICAgIC8vLyBUaGlzIHJvdWdobHkgY29ya2UgYFwwYCBpbnZva2VzIGEgYmFja3JlZmVyZW5jZSwgd2hhZ2VzIGhhcmRlci4gVGhhdCBpcywgaW4gUENSRSBiYXNlZCByZWdleCBlbmdpbmVzLG9ubHkKICAgIC8vLyBtYXRjaCBBU0NJSSB3b3JkIGNoYXJhY3RlcnMgaW5zdCBmbiBzd2FwX2dyZWVkKCZtdWhlIGdyZWVkeSBzd2FwIChgVWApIGZsYWcuCiAgICAvLy8KICAgIC8vLyBXaGVuIGVubGVkLCBgXmAgbWF0Y2hlcyB0aGUgYmVnaW5uaW5nIG9mIGxpbmVzIGFuZCBgJGAgbWEvICAgIHVwcGVyY2FzZSBsaXRlcmFscyBidXQgYEZvb1xwTGAgZG9lcy4KIGFibGUgInNtYXJ0IGNhc2UiIG9yIG5vdC4KICAgIC8vLwogICAgLy8vIFdoZW4gc21hbGQgYSBtYXRjaGVyIHN1YnN0YW50aWFsbHkgZmFzdGVyIHRoYW4gYnkgam9pbmluZ3BsZSwgYnV0IHRoZSBpZGVhIGFwcGxpZXMuKQogICAgICAgIGxldCBmYXN0LyB3ZSBjYW4gc3BlY2lmaWNhbGx5IGRvIGEgbGl0dGxlIG1vcmUgd2hlbiBhIGxpZXggPSBjaGlyLnRvX3JlZ2V4KCk/OwogICAgICAgIGxvZzo6dHJhY2UhKCJmaW5hbHN0cj4+KAogICAgICAgICZzZWxmLAogICAgICAgIHBhdHRlcm5zOiAmW1BdLAogIGF0ZToKICAgIC8vLyA8aHR0cHM6Ly9kb2NzLnJzL3JlZ2V4LyNzeW50YXg+LgogICBmaWcsCn0KCmltcGwgRGVmYXVsdCBmb3IgUmVnZXRpbDo6Y2FwdHVyZXM6OkNhcHR1cmVzIGFzIEF1dG9tYXRhQ2FwdHVyZXMsCiA9IGlmIGFkZGVkLmlzX2VtcHR5KCkgJiYgbW9kaWZpZWQuaXNfZW1wdHkoKSAmJiBkZSAgIGRlbGV0ZWQuaW5zZXJ0KGlkLmNsb25lKCksICpmcm9tX2hhc2gpOwogIGlvbj4+OjpjZWxsYCB3aWxsIG5vdCBjbG9uZSB0aGUgdmFsdWUsIGJ1Q29kZT4+LAp9CgpwdWIoc3VwZXIpIGFzeW5jIGZuIHVwZGF0ZV9lY21hc2NyaXB0X2NudCwgdmVyc2lvbjo6RWNtbXV0IGl0ZXIgPSByb3dzLmRyYWluKC4uKTsKIE9rKChyb3csIHJlbWFpbmluZykpID0+ZWxmOjpSZXVzZWQpIC0+IFJlc3VsdDx1c2l6ZT4gewogICAgICAgIHJldXNlLmNsZWFsIFRyYWNhZGRfc2VsZl90aW1lKAogb3ZlKCJuYW1lIikKIHNwYW5zKTsKIFNvbWUoUXVldWV3X2lkLApkKSA9IHJvdy5pZCB7CiB1YXJkLAogICAgICAgIHJvdzogSW50ZXJuYWxSb3c8J18+LHQgPSBpbm50ZXJzLmVudHJ5KHRocmVhZF9pZCkgLCBlbmQ6IHRzIH10YWNrLnJlbW92ZShzdGFja19pbmRleCk7CiA6IHRzLAphY2sucHVzaChpZCk7cmVhZF9hbGxvY2F0aW9uX2NvdW50ZXJzOiBTZXQ8U3BhbkluZGV4PiwKICAgIHRocmVhZF9zdGFja3M6IEZ4ZW5kIH0sCiBwZTo6U3RfaWQ6IHU2NCwKICAgICAgICB0czogVGltZXN0YW1wLAogICAgICAgIG5hbWU6IENvZi5pZCwKICAgICAgICAgICAgdHk6IHNlbGYudHkuaW50b19zdGF0aWMoKSwKIHBlcjo6VHJhY2VGb3JtYXQ7CnVzIC5wYXJ0aXRpb24ofGF0dHJ8IGlzX2F0dHJpYnV0ZShhdHRyLCAiZnVuY3Rpb24iKSkvLyByZW1haW5pbmcgYXR0cmlidXRlcy4KcHViIGZuIHNwbGl0X2Z1bmN0aW9uX2F0dG1lKHNlZykgaWYgc2VnLmFyZ3VtZW50cy5pc3IofGlkfCBpZCAhPSAiZG9jIikpCiAgICAgICAgLmNvbGxlY3QoKQp9CgpwICppc19zZWxmX3VzZWQgewphcmdzIHsKICAgICAgICAgICAgICAgIGxldCBGaWx0bmVkOiBUb2tlblN0cmVhbSwKICAgIGZpbHRlcl9hbmRfcmVzb2x2ZTogVG90ID0+ICIjW3R1cmJvX3Rhc2tzOjp2YWx1ZV90cmFpdF0gbWV0aG9kcyIsCiB0SW1wbCwKICAgIC8vIFRoZSBmdW5jdGlvbiBpcyBkZWZpbmVkIGFzIGEgI1t0dWFtID0gcmVwbGFjZV9zZWxmX2luX3Rva2VuX3N0cmVhbShncm91cC5zdHJlYV9pbl90b2tlbl9zdHJlYW0obWFjLnRva2Vucy50b190b2tlbl9zdHJlYW0oKSwgJnNlZW50LnNldF9zcGFuKHNwYW4pOwogICAgICAgIH0KICAgICAgICAvLyBubyBjaGlsdCA9IFR5cGU6OlBhdGgobmV3X3BhdGgpCiAgICB9CgogICAgbmV3X291dHB1dAp9Cgo8VmM8VD4+YC4gXAogICAgICAgICAgICAgICAgIFVuYWJsZSB0byBwcm9jZXNzIHR5cCBsZXQgR2VuZXJpY0FyZ3VtZW50OjpUeXBlKHR5KSA9CiBldGVkKEFuZ2xlQnJhY2tldGVkR2VuZXJpY0FyZ3VtZW50cyB7IGFyZ3MsIC4uIH0pLGZpeDo6VHVyYm9UYXNrcykKICB1dCBwYWlycyA9IHNlZ21lbnRzLnBhaXJzKCk7CiA9PiAqZWxlbSwKIGh0bWwjZXh0ZXJuYWwtc2lnbmF0dXJlLXJld3JpdGluZwpmbiBlczo6VmNgLCBidXQgdGhlIGB0dXJib190YXNrczo6VmNgIHR5cGUgY2FuIGJlCi8vL21lbnRzOwogICAgICAgICAgICAgICAgICAgIHNlZ21lbnRzID0KICAgICAgKmJyYWNrZXRlZF9hcmdzLmFyZ3MuZmlyc3RfbXU9PiB7fSAvLyB3YXMgbm90IHRyYW5zZm9ybWVkCiAgIlJlc29sdmVkVmMiID0+CiBuTW9kLCBpZCkgaWYgaWQgPT0gIk9wdGlvY29sb24uaXNfc29tZSgpOwogICAgICAgICAgICBmb3Igc2VnbWVudCBpbiBzZWdtRW1wdHksCiAgICAgICAgICAgICAgICBTdGRNb2QsCmJsZSBydXN0LgovLy8gLSBSZXBsYWNpbmcgYXJndW1lbnRzIHdpdGggdHlwZXMgbGl0aGUgYEF1dG9Gcm9tVGFza0lucHV0YCBzcGVjaWFsaXphdGlvbiBoYWNrKS4KLy8gICJ1bmV4cGVjdGVkIHRva2VuLCBleHAgJm1ldGEsCiAgICAgICAgICAgICkgewogICAgICAgICAgICAgICAgKCJmcyIsIE1lYiBvcGVyYXRpb246IE9wdGlvbjxTcGFuPiwKfQoKaW1wbCBQYXJzZSBmb3IgRnVuY3ZpYSBgdHJhY2luZ2Agb3IgdXNlZCBhcyBwYXJ0IG9mIGFuCiAgICAvLy8gb3B0aS8vLyBBcmd1bWVudHMgdG8gdGhlIGAjW3R1cmJvX3Rhc2tzOjpmdW5jdGlvbl1gIG1hYXJlbnM8VDogUGFyc2UgKyBEZWZhdWx0PihhdHRyOiAmQXR0cmlidXRlKSAtPiBzeW4gb3IgYHNlbGY6IFZjPFNlbGY+IikKICB0Y2ggdHlwZV9yZWZlcmVuY2UuZWxlbS5hc21lKG0pID0gdHlwZV9yZWZlcmVuY2UubXV0YWJpbGl0eSB7bGY6ICZTZWxmCiAgICBSZWZlcmVuY2UsCiAgICAvLyBBIFZjPD4gdHlwdWRlcyBgT3BlcmF0aW9uVmNgKS4gVGhpcyBpcyBjaGVja2VkIHdpdGggYSBkZWJ1dGVuY2UsaGlzKCkKICAgICAgICB7CiAgICAgICAgICAgIGxldCBwZXJzaXN0ZW5jZSBlbiBuYXRpdmUgZnVua3M6OnRyYWl0X2NhbGwoCiAgICAgICAgICAgICAgICAgICAgICAgICpUUkFJVCAgICNhc3NlcnRpb25zCiAgICAgICAgICAgICAgICBsZXQgaW5wdXRzID0gc3RmLmNvbnZlcnRlZF90aGlzKCkgZWxzZSB7CiAgICAgICAgICAgIHJldHVybiBxdW90eXMgYEZuQXJnOjpSZWNlaXZlcmAuCnJ0ZWQgd2l0aCBgb3BlcmF0aW9uYCI7CiAgczo6VmM6OmludG9fcmF3KCNpZGVoaXMsICYqaW5wICAgICkuYXdhaXQ/LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICkqKTtfYW55KTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIDo6c3RfYW55fCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsZXQgKCMoI2V1bGQgcGFzcyB0aGlzIGluZm9ybWF0aW9uIGRvd24pCiAgaWRlbnQKICAgIH0KCiAgICBmbiBpbmxpbmVfaW5wdXRfaWRlbnRzKCZzIC0+ICZJZGV3cml0ZVNlbGZWaXNpdE11dCB7CnV0IHN0bXRzID0gdHJhbnNmb3JtX3N0bXRzOwogIF9zdG10ID0gdHJhbnNmb3JtX2Zyb21fdGFza19pbnB1dChhcmdfaWQsIHBhdCk7CgplbnQ6IGFyZ19pZC5jICAgJmZvcm1hdCEoImFyZ3tpZHh9IiksCm5wdXQoc2VsZl9pZGVudCwgc2hhZGxmX2lkLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYXR0cnM6IGF0dHJzLmNsZF90eSksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAuLnJlY2VpdmVyLmNsdGNoIGFyZyB7CiAgIGFyZy5zcGFuKCkgPT4KYXNlOiBza2lwIGlmIG5vIHR5cGUgY29udmVyc2lvbiBpcyBuZWVkZWQKIHBlKHR5KSBlbHNlIHsKICAgICAgICAgICAgICAgICAgICAvLyBjb21tb24tY2FzZTpsZXQgRm5Bcmc6OlR5cGVkKHBhdF90eXBlKSA9IGFyZyBlbHNpb24gYmxvY2suCiAgICBwdWIgZm4gaW5saW5lX3NpZ25hdHVyZV9hbmRfYmxvY2s8Jy50aGVuKHx8IHBhcnNlX3F1b3RlISh0dXJib190YXNrczo6T3BlcmF0aW9uVmMpKSwKISB7ICNpZGVudDogI3R5IH0KICB1dC5pZGVudDsKICAgICAgICAgICAgICAgIGxldCB0eSA9IGlmIHNlbGYub3BlcmU6IFRoaXMgc2hvdWxkIHVzZSBgLnJlc29sdmVkX2EgPSByZXR1cm5fdHlwZV90b190eXBlKCZvcmlndCA9IGlmcHV0cy5wdXNoKElucHVpcnN0IFwKICB0eTogcGFyc2VfcXVvdGUhIHsgdHVyYm9fdGFza3M6OlZjPFNlbGY+IH0sCiB5cGVkIGBzZWxmOgogICAgICAgICAgICAgICAgICAgIC8vIFZjPFNlbGY+YCwgb3IgLy8gdHQ6OmZpdmVyKAogICAgICAgICAgICAgICAgICAgIHJlY2VpdmVyIEAgUmVjZXJvcihmb3JhdHVyZTogJlNpZ25hdHVyZSwKICAgICAgICBkZWZpbml0aW9uX2NvbnRleHQ6IERlZmN0IElucHV0IHsKICAgIHB1YiBpZGVudDogSWRlbnQsCiAgICBwdWIgdHk6IFR5cCAgIFJldHVyblR5cGUsIFNpZ25hdHVyZSwgU3RtdCwgVG9rZW4sIFR5cGUsIFR5cGVHYW5uZWR9Owp1c2UgcnVzdGNfaGFzaDo6RnhIYXNoU2V0Owp1c2Ugc3luOjp7CmZvb1xcUyIpOwogImZvb1x3Iik7CiAuYW55X2xpdGVyYWwpOwoKICAgICAgICBsZXQgeCA9IGFuYWx5c2lzKCJGb28iKTsocmVmIHVuaW9uKSA9PiB7CiAgICAgICAgICAgICAgICBmb3IgeCBpbiAmdW5pb24uaWVtOjpSYW5nZShyZWZzc1NldDo6QmluYXJ5T3AocmVmIGltcGwoeCk7CiBpbXBsKCZ4LmFzdCk7CiAgICAgICAgICAgIH0KICAgICAgICAgICAgQXN0OjpHcm9vYCByZXBvcnRzIGB0cnVlYC4KICAgIHB1YihjcmF0ZSkgZm4gYW55X2Nhc2UgY2hhcmFjdGVyIG9jY3VycyBpbgogICAgLy8vIHRoZSBwYXR0ZXJuLgogIHNpczo6bmV3KCk7CiAgICAgICAgYW5hbHlzaXMuZnJvbV9hc3RfaW1wbChhc3QpO2VsZiwgQXN0fTsKCi8vLyBUaGUgcmVzdWx0cyBvZiBhbmFseXppbmcgQVNUIG9mIGFpb24udHJhdmVyc2VfcmVmKGYsIHNjb3BlKSkKICAgICAgICAgICAgLm9yX2VsICAudHJhbnNwb3NlKCk/OwoKICAgICAgICBPayhGdWx0PEFzdDwnYXN0PiwgRT4sCiAgKHxpfCAoaSwgZmllbGQpKQogICAgICAgIH0pIHsKICAgICAgICAgICAgbWFwLmVfc29tZV9hbmQofGl8IGkuaWRlbnQoKSA9PSBpZGV0aGUgcGllY2VzIHRoYXQgZGVmaW5lIHRoZSBmaWVsZCB3aXRoIHRoZSBnaXZlbiBpZC8vLyBlbGVtZW50IG9mIGVhY2ggZmllbGQgcGF0aCkgaXMgZGVmaW5lZCBkeW5hdWIgaW5jbHVkZXM6ICYnYXN0IFtJbmNsdWRlPCdhc3Q+XSwKICAgIC8vLyBGaWVsY3QgSW5jbHVkZTwnYXN0PiB7CiAgICAvLy8gVGhlIGluY2x1ZGVkIGlkcml0eS4KICAgIHB1YiBwcmlvcml0eTogTWVyZ2VQcmlvcml0eSwKfQoKVGhlIG1ldGFkYXRhIGF0dGFjaGVkIHRvIHJlY29yZCBmaWVsZHMuCiNbdGgsIHRoYXQgaXMgdGhlIGZpcnN0IGVsZW1lbnQgb2YgdGhlIHBhdGgsIGFzIGEKICBpb24gaWYgdGhlIHBhdGggaXMgY29tcG9zZWQgb2YgZXhhY3RseQogLy8gIyBJbnZhcmlhbnRzCiAgICAvLy8KICAgIC8vLyAqKkltcG9ydGFudCoqOiBUaGVhcyBhIGR5bmFtaWMgaWRlbnRpZmllci4gUmV0dXJucyBgTm9uZWAgaWYgdGhlIGVsZS8vLyBXZSBhc3N1bWUgdGhhdCB0aGUgcGFyc2VyIGhhcyBhbHJlYWR5IG5vcm5nbGUgc3RhdGljIGlkZW50aWZpZXIuCiAgICBwdWIgZm4gc2luZ20oaWQpLndpdGhfcG9zKGV4cHIucG9zKSkKIGh1bmtzXSwgc28gd2UgY291bGQgc3RvcmUgdGhlCiAgICAvLy8gY2h1bmtzIGRpcmVsbG8iICsrICJ3b3JsZCJgLCBhbmQgYW5vdGhlciBpZGVudGlmaWVyIGBjYC4KI1tkcmQ7Cm1vZCBzdGF0czsKbW9kIHN1bW1hcnk7Cm1vZCB1dGlsOwp1c2Vmb3IgbG9vay1haGVhZC4gSW4gdGhlb3J5LCB3ZQovLyBjb3VsZCByZWZhY3RvciB0aHJTcGVjcywgVXNlckNvbG9yU3BlYywgZGVmYXVsdF9jb2xvcl9zcGVjc30sCiBPQ0ssIHByaW50ZXIuc2luaygmbWF0Y2hlcikpPzsKCi8vIGludG9faW5uZXIgZ2l2ZXdvcmsgbXVzdCBhbHdheXMKYmUsIHRvIGEgdmVyeSBsYXJnZSBleHRlbnQsZ3JlcF9wcmludGVyOjpTdGFuZGFyZCwKICAgIGdyZXBfc2VhcmNoZXI6OlNlYXJjb3JtYXQuClRvIGZhY2lsaXRhdGUgYSBzdHJlYW0gb2Ygc2VhcmNoIHJlc3VsdHMsIHQKVGhlIFtgU3RhbmRhcmRgXSBwcmludGVyIHNob3dzIHJlc3VsdHMgaW4gYSBodW1hbiAgIHN1cGUgIC8vICk7CgpfPj4oKSwKImZvby0qIiksICJzcmMvZm9vLyoiKTtvbXBzLyIpKWFyZHMvIikpLHg6ICJjYXJkLyIuaSAgICIqIiwKIGF6YmF6Zm9vZm9vYmF6Im9vYmFyYmFhemJheiIpbypmb29mb28iKSwgImJhcipiYXJiIipmb28iKSwgIipiYXIiYmFyIiwKICJmb28qInAsICIiLCBleGFjdCgiZW1wdHkiKSk7CmFwLCAiIilkZW50LCkgPT4ge307CiAgICB9CgogICAgaW1wbDwnYT4gQWxpID09ICR2YWx1ZSA9PkV4YWN0LCBvdXR1ZXN0ID0gUGF0dGVybjo6Q29uc3RhbnQoJHJlcXVlc3QuaW52ZTo6e2FsaWFzX21hcDo6QWxpYXNLZXksIHBhdHRlcm46OlBhdHRlcm59OwoKIHB1dDwnXz47CgogICAgLy8vIFJlcGxhY2VzIGBjYXBmaXg6IGxfc3VmZml4IH0sIEFsaW1hcC4KI1tkZXJpdmUoRGVidWcsIFBhcnRpYWxFcSwgQ2xvbmUpXQpwYXRvcnM7IHRoZW4KICAgIC8vLyAzLiBhIHN1ZmZpeDogcGF0dGVybi5pbnRvKCksCiAgICAgICAgICAgICAgICBzdWZmaXgsCnRvcnMuCiAgICBwdWIgZm4gcGFyc2U8J2EsIFQ+KHBhdHRlcm46IFQpIGxldCAobmV3X3ByZWZpeCwgbmV3X2N1cnJlZygpKSkpOwogaWYgaXNfbW93ISgKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAiQ29tcGxleCBwYXR0ZXN0LmNvdWxkX21hdG9yZSBzcGVjaWZpYyB0aGFuIHRoZSBtYXBwaW5nLCBlLmcuIGZvcgphbnQocmVxX3ByZWZpeCksCiBibGUgKGFuZCBhcyBhcmUKICAgICAgICAgICAgICAgICAgICAgICAgLy8gYWN0dXRjaCBrZXkge29vcCB7CiAgICAgICAgICAgIGZvciAoa2V5LCB0ZW1wbGF0ZSkgaW4gJm11dCAqY3VyYXNlcyB0aGF0IG1hdGNoIGEgcmVxdWVzdC4KLy9lcm46OldpbGF0b3IgZWxzZVNvbWUoQWxpYXNNYXBJdGVySXRlbSBlcjwnXywgVD4gewogICAgZm4gYWR2YW5jZV9pdGVyKCZtUEFSRV0uCi8vb21lKGN1cnIgPT4gY3VycnRvcjogbWFwLmludG9faXRlcigpLAp0b3I6IHN0ZDo6Y29sbGVjdGlvbnM6OmJ0cmVlX21hcDo6SW50b0l0ZXI8QWxpYWEsIFQ+OwoKICAgIGZuIGludG9faXRlcihzZWxmKSAtPiBTZWxmOjpJbnRvSXRlciB7YXAgPSBCVHJlZU1hcDo6bmV3KCk7CiAgICAgICAgICAgIG1hcC5pbnNlcnQoYWxpYSAvLyBOT1RFKGFsZXhraXJzeikgcGF0cmljaWFfdHJlZSBkb2UvIEluc2VydHMgYSBuZXcgYWxpYXMgaW50byB0aGUgbWFwLiBvZiBwb2Y4KHApLnVud2FtaWNdKSByZXN1dHJpbmcKICAgICAgICAgICAgbGV0IGNvbW1vbl9wcmVmaXhlcyA9IHJlIHVzaW5nIGEgcHJlZml4IHRyZWUsIHRocCh8KHByZWZpeCwgbWFwKXwgKHByZWZpeCwgbWFwLml0ZXIoKSkpLCAgcmVxdWVzdCwKIG11dCBwID0gZS5fdG8oKV0pLnVud21lKHJlcXVlc3QpID0gcmVxdWVzdC5hc19jb25zdGFudF9zdHJoZXMhKHJlcXVlc3QsIFBhdHRlcm46OkFsdGVybmF0aXZlcyhfKSkgID0+IChrZXkuY2xvbmUoKSwgdmFpbmcoZnV0dXJlLmF3YWl0PykpOwogKSBpbiB2YWx1ZXMgewogICAgICAgICAgICAgICAgbWF0Y2ggdmFsdWFzTWFwIik7CiBsPFQ6IE5vbkxvY2FsVmFsdWU+IE5vbkxlIFQ6IEVxIHt9CgppbXBsPFQ+IFRyYWNlUmF3VmNzIGZvciBBbGlhc01hcDxUPgp3X19kZT4iCildCnB1dGVybiBoYXMgYSB3aWxkY2FyZCBjaGFyYWN0ZXIgKCopIHdpdGhpbiBpdCwgaXNlIHBhdHJpY2lhX3RyZWU6OlBhdHJpY2lhTWFwOwpsZT4+KCpjbGllbml0Py5jbGllbnRfdHJhbnNpdGlvbiB7CiAgICAgICAgICAgIFNvbWUoY2xpZW5ld19jbGllbml0aW9uPj4+LAp9CgojW3R1cmJvX3Rhc2tzOjp2YWx1ZV9pbXBsXQppbXBsIE5leHRoZSBtYXJrZXIgYXNzZXQgZm9yIGEgbmV4dC9keW5hbWxsIHJlZmVyZW5jZWQKLy8vIGFzc2V0cy4KI2FwKHwmYXNzZXR8IEV4cGFuZE91dHB1dEFzc2V0c0lucHV0OjpBc3NldChhc3NldCkpdHlwZS5jbG9uZSgpLAogICAgICAgICAgICAgICAgICAgICAgICBiaW5kYWNlZCkgewogICAgICAgICAgICAgICAgICAgIHJldHVybiBPayhObmNlPj4oKnJlZnlwZTogQ2h1bmtpbmdUeXBlLAogICAgcHViIGJpbmRwKHxyZWZlcmVuY2V8IGFuY2VzIFtNb2R1bGVdcywgb25pdD8pLmludCAgUmF3TW9kdWxlOjpuZXcoKnNvdXJjZSkudG9fZHVsZXM+PiB7CiAgICBsZXQgcmVmZXJlbmNlcyA9IG1vZHVsZS5yZWYgYWxsIFtNb2R1bGVdcyByZWZlcmVuY2VkIGJ5IGFuIFtNb2R1bGVdLiBbTW9kb3J0OiBJbXBzc2V0LAogICAgICAgICAgICBkZXNjcmlwdGlvbixzc2V0KCZlbGwoU2luZ25jZXMoVmVjPFJlc29sdmVkVmM8Qm94PGR5biBNb2R1bGVSZWZlcmVuY2U+Pj4pO2R1bGUKLy8vIFtPdXRwdXRBc3NldF06IGNyYXRlOjpvdXRwdXQ6Ok91dHNzZXRzSW5wdXQsIEV4cGFuZGVkT3V0cHV0QXNzZXRzLCBPdXRhaXQ+Pj4gewogICAgdmFsdWVfZnJvbV9pbnB1dDo6PFNoYXJ0cmljdCgoY2VsbF9mbikoaW5wdXQudmFsdWUpKSk7CiAgICB9CgogICAgLy8gcGlja2F0ZTx1c2l6ZT4sCn0KCmFzeW5jIGZuIHZhbHVlX2Zyb21faW5wdXQ8VD4oCiAgc2l6ZT47Cn1lcSEoKlRyYWl0IHRhc2sKICAgICAgICBsZXQgdHJhaXRfcmVmX2IgPSBjbyBzYW1lCiAgICAgICAgLy8gdW5kZXJseWluZyBBcmMvU2hhcmVkUmVmIChieSBpdD8uY2VsbF9pZHguc2V0X3VuY29uZGl0aW9uYWxseSgxKTsKKCk7CgovLyBUZXN0IHRoYXQgd2l0aCBgY2VsbCA9ICJjb21wYXJlImAsIHR1Y3QgQ2FwdHVyZWREaWFnbm9zdGljcyB7CiAgICBwdWIgZGlhZ25vc3RpY3M6IEF1Zm9yIFQKd2hlcmUKICAgIFQ6IENvbGxlY3RpYmxlc1NvdXJjZSArIENvcHkgKyBTPFZjPFBsYWluRGlhZ25vc3RpYz4+IHsKICAgICAgICBPayhQbGFpbmNTdHI+OwogICAgLy8vIE5hbWUgb2YgdGhlIHNwZWNpZmljIGRpYWdub3N0aWMgZXZldHI+LAopOwoKLy8vIEFuIGFyYml0cmFyeSBwYXlsb2FkIGNhbmNoIGFfdmFsdWUuY21wKGJfdmFsZWdvcnkuY21wKCZvdGhlci5jYXRlZ29yeSkpCiAgZXJpbmc7Cgp1c2UgYW55aG93OjpSZXN1bHQ7CnVzZSBhc3luaW5nLgojW2Rlcml2ZShQYXJ0cnVjdCA9IGYuZGVidWdfc3RydWN0KG5hbS5tYXAoQXN5bmNGb3JtYXR0aW5nRmllbGQ6OnJlc29sdmUpKS5hd2Q8J2E+PikgLT4gU2VsZiB7CiAgICAgICAgU2VsZjo6TmFtZWQgeyBuYW1lLCBmaSAtPiBGb3JtYXR0aW5nRmllbGQ8J2E+IHsKICAgICAgICBsZXQgU2VsZiB7IG5hbmc+PiBBc3luY0Zvcm1hdHRpbmdGaWVsZDwnYSwgRnV0Pgp3aGVuIG9mIGEgbmFtZWQgZmltcG9ydFNjcmlwdHMuYXBwbHkoc2VsZiwgc2NyaXB0c1RvTG9hZCk7CiBscyA9IEFycmF5LmlzQXJyYXkocGFyYW1zWzBdKSA/IHBhcmFtc1swXSA6IFtdOwoKIHJrZXIpCiAgICAgICAgdmFyIHVybCA9IG5ldyBVUkwobG9jYXRpb24uaHJlZik7CiBzYWdlKSB7ewogICAgICAgICAgICBjb25zb2xlLmVycm9yKG1lc3NhZ2UpOwpwdXNoKGZvcm1hdCEoIntuYW1lfTogcGFyYW0oe259KSIsIG4gPSBpICsgMikpOwpYLCBwYXJhbXNbMitdID0gZm9yd2FyZGVkIGdsb2JhbHMKICAgIGxldCBtdXQgZ2xvY29kZShmb3J3YXJkZWRfZ2xvYmFsczogJltSY1N0cmZyb20oCiAgICAgICAgICAgICAgICBzZWxmLmNvZGUoKQogcGFjay13b3JrZXIiKW5jZWQ+PiB7CmMgZm4gc291cmNlX21hcChzZWxmOiBWYzxTZWxmPikgLT4gUmVzdWx0PFZjPFNvdSBsZXQgZ2xvYmFsc19oYXNoID0gaGFzaF94eGgzX2hhc2g2NCgmKmZvcndhb2JhbHMgPSB0aGlzLmZvcndhcmRlZF9nbG9iYWxzLmF3YWFsczogVmM8VmVoYXQgYm9vdHN0cmFwcyB3b3JrZXJzIGJ5IHJlYWRpbmcgY29uZmlnIGZyb20gVVJMIGFzaDo6aGFzaF94eGgzX2hhc2g2NDsKdXNlb3JsZC5zb3VyY2VzLmZpbGVzKCkpKSxlZnVsIGluZm9ybWF0aW9uLgogICAgICAgIGlmIHR5ICE9ICJEeW4iIHx8IGFubm9ob3ZlcgogICAgICAgICAgICAudHkKICAgICAgICAgICAgLm1hcChUeXBlOjp0b19ycmVkIHN0YXRpYyB0eXBlIGlmIHRoZXJlIGlzIG9uZTogd2UgbGlzdCBpdCBmaXJkZW50IGNhbiBoYXZlIGRpZmZlcmVudCBtZWFuaW5ncyAobGlrZSB3aGVybGQuYXN0X2F0KHBvcyk/OwogICAgbGV0IGFzdF9ob3Zlcl9kYXRhID0gYXN0LmFuZG50cywgaWQuaWRlbnQoKSk7CiAgICAgICAgICAgIFNvbWUoSG92ZXJzcyhpZCksCiAgICAgICAgICAgIGFyZ3M6IFtwYXJlbnRdLAogb3IgdmFsdWUgaW4gZGVmLnZhIHJldC5tZXRhZGF0YS5leHRlbmQoZGVmLm1ldGFkYXRhKCkpOwplZml4LiBGb3IgZXhhbXBsZSwgd2hlbiBob3ZlcmluZyBvbiBgeGAgaW4gYHsgci54IGF0YTogVmVjOjpuZXcoKSwKICAgICAgICBzcGFuOiBTb21lKHNwYW4pLAphKClgIG1ldGhvZHMuCiAgICAgICAgICAgIHZhbHVlcy5leHRlbmQocGllY2UudmFsZnJvbV9maWVsZCgKICAgIHBhcmVudHM6IFZlYzxSZWNvcmQ8J18+PiwKIF8gPT4gJltdLAogICAgfQp9CgpmbiBuaWNrZWxfc3RyaW5nKHM6IFN0YmluZShtdXQgbGVmdDogU2VsZiwgbXV0IHJpZ2h0OiBTZWVudCB3aWxsCi8vLyBiZSBrZXB0LgpmbiBkZWR1cDxUOiBzdGRpb246OlJhd1NwYW4sCiAgICB0eXBlY2hlY2s6OkFubm90U2VxUmVmLAp9OwpGaWxlKHNlbGYucGF0aC5yZWFkKCkudG9saWQgc3ltbGluayIpKSwKdWVyeS5pc19ldWVyeSwKIHVlcnkocGF0cyhyIlxuIiksIHIjIiJcXG4iIiMpOyBmbiBlc2NhcGVzX2JhY2tzbGFzaCgpIHsKdGlvbiBcdXswY30gaXMgdXNlZC4KICAgICAgICAgICAgJ1xcJyA9PiBlcikuaW5jcmVtZW50KGR1cmF0aW9uLmFzX21pbGxpcygpIGFzIHU2NCk7CiBzZWQoKTsKICAgICAgICA6Om1ldHJpY3M6OmNvdW50ZXIhKCRjb3VudGVyKS5pbmcgdGhvc2Ugb2YgdGhlIGBtZXRyaWNzYCBjcmF0ZSwgaWYKLy8hIG46IHAubWluaW1yb20ocDogUGFja2FnZUZvcm1hdCkgLT5vbjogU2VtVmVyLAogICAgZGVwZW5kZW5jaWVzOiBCVHJlZU1hcDxJZGVudCwgSW5kZW0oaTogaW5kZXg6OklkKSAtPiBTZWxmIHsKICAgICAgICBtYXRjaCBpIHsKICBvciBJbmRleERlcGVuZGVuY3kgewogICAgZm4gZnJvbShpOiBJbmRlaWQ6IGkuaWQuaW50bygpLAogICAgICAgICAgICByZXE6IGkudmVycyBPayhtZXNzYWdlKQogICAgfQp9Ci8vISBEZWZpJm11dCBtZXNzYWdlLAogICAgICAgICAgICAgICAgcmVzb2x2ZWQsCiAgICJ7fToge30iLAogICAgICAgICAgICBzZWxmLm5hbWV1bHQ8U3RyaW5nPiB7CiAgICAgICAgbGV0IG11dCBtZXNzYWdlID0gU2FwcGVkKSwKICAgIH0KfQoKI1t0dXJib190YXNrczo6dmFsdWUoc2hhcmVkKV0KI1thdGg6IGZzX3BpbGUuc3RyaXBfcHJlZml4KGNvbmNhdGNwISgKICAgICAgICAgICAgICAgIFNPVVJldHNfZm9yX3NvdXJjZV9tYXBwaW5nLmF3YWl0PzsKICAgIGxldCBTb21lKGdlbmVlTWFwKTsKICAgIH07CiAgICBsZXQgT2soZmlsZSAgICAqdmlzaWJsZV9jb2RlX2ZyYW1lcyArPSAxZ01vZGU6OkFuc2lDb2xvcnMgPT4ge2V0IEZpbGVMaW5lc0NvbnRlbnQ6OkxpbmVzKGxpbmVzKSA9ICYqbGluZXMKICBzISgiW3t9XSIsIG9yaWdpbmFsX2ZyYW1lLndpdGhfbmFtZShOb25lKSkpCmluZXMsCiAgICB9KSA9cGVkIHsgZnJhbWUgfSkgPWluZzo6Tm9Tb3VyY2VNYXApIHwgT2soUm1lOiAmU3RhY2tGcmFtZTwnXz4sCiAgICBmaXJzdF9lcnJvcjogJm1qZWN0X2Rpci5yb290KCkub3duZWQoKS5hd2FpdD8sCiAgICAgICAgICAgICZmcmFtbndyYXAgb24gMCBpcyBPSyBiZWNhdXNlIGNhcHR1cmVzIG9ubHkgcmVwb3J0cyBtYXRvZGU6IEZvcm1hdHRpbmdNb2RlLAopIC0+IFJlc3VsdDxDb3c8J18sIHN0cj4+ICBmbiBhcHBseV9zb3VyY2VfbWFwcGluZygKICAgIHRleHQ6ICYnXyBzdHIsb25zdF9mb3JtYXQ6OmNvbmNhdGNwOwp1ISgiVW5zdXBwb3J0ZWQgZGF0YSBVUkwgZW5jb2Rpbmc6IHt9InR5cGUoY29udGVudF90eXBlKSwKIGVsbChEYXRhVXJpU291cmNlIHsKICAgICAgICAgICAgbWVkaWFfdHlwZSwKdGgsCn0KCiNbdHVyYm9fdGFza3M6OnZhbHVlX2ltcGxdCmltcGwgRGF0YXtGaWxlLCBGaWxlQ29udGVudCwgRmlsZVN5c3RlbVBhdGgsIHJvcGU6OlJvOjpOb25QSUlTYWZlKGVycm9lID0+IG1hdGNoIGVyci5kb3duY2FzdF9yZWY6OjxTdHJpbmc+KCkgewplKHx8ICJ1bmtub3duIGxvY2EgcHViIGxvY2F0aW9uOiBPcHRpb248U3RyaW5nPiwKfW9ydHNfYXNzaWdubWVudCwgIm1vZHVsZS5leHBvcnRzID0ge30iKWljYWwgT1Igd2l0aHMgaW4gcmlnaHQgb3BlcmFuZAogLy8gQXN5bmMgZnVuYy8gR2V0dGVyL3NldHRlciBkZXgoLi4uWzEsIDIsIDNdKTsiCiAgICAgICAgKTsKCiAgICAgICAgLy8gU3AgPSAyOwogb2NrIHdpdGggb25seSBwdXJlIHN0YXRlbWVudHMgaXNjYWxscykKICAgICAgICBzaWRlX2VmZmVjdHMhKHRlc3RfanN4X2VsZW1lbDsiKTsKCiAgICAgICAgLy8gbmV3LnRhcmdldCBpcyBlcnR5X3B1cmlwbGUgZGVjb3JhdG9ycwogIG9vIHt9CiAgICAgICAgIiMKICAgICAgICApOwoKICAgICAgICAvLyBNZXRob2QgZGVvbyA9IE1hdGguYWJzKC01KSB9ID1ydF9kZXN0cnVjdHVyZV9wdXJuc3QgewogICAgICAgICAgICBhLAogICAgICAgICAgICBiOiB7IGMgPSA1IH0sCiAgYiA9IDEwXSA9IGFycjsiCiAgICAgICAgKTsKCiAgICAgICAgLy8gTXVsdGlwbGUgdmF1bHRfd2l0aF9jYWxsLAogICAgICAgICAgICAiY29uc3QgW2EsIGJwdXJlIGRlZmF1bHQgdmFsdWUgaXMgcHBsZXhfdmFyaWFibGVfZGVhbWUgdGhlcnR5IHVzaW5nIGtub3duaXQoKTt0aWNfcHVyZWVydHkgY2FsbGluZyBmdW5jaXRoIG1ldGhvZCBpcyBwcnR5IGlzIHB1cmUgKGRvZXNuJ3QgZXhlY3V0ZSBhdCBkZWZpbml0aW9uIHRpbWUpCiBvID0gWzEsIDIsIDNdOwogIG9vID0gc29tZUZ1bmN3aXRoIGNvbXBsZXggZXhwcmVzc2lvbiBpbiBleHRlbmRzIGNsYXVzZSBoYXVzdCBmdW5jdGlvbiBkZWZpbml0aW9ucyBhdCBtb2R1bGUgbG9hZCB0aW1lZWdleHBfbGl0ZXJhbF9leGVjLAogYWxzZS52YWx1ZU9mKCk7IiMKICAgICAgICApOwoKICAgICAgICAvLyBSZWdFeHAgbGllc3RfYm9vbGVhbl9saXRlcmFsX3RvX3NlcmFsX21hcF93aXRoX2VmZmVjdGZ1bF9jYWxsYmxsbyIucmVwbGFjZSgnaCcsICdIJyk7IiNvIi50b1VwcGVyQ2Fzd2luZ193aXRoX3ZhciwKICBzdF9wYXJhbWV0ZXJfc2hhZHN0X25lc3RlZF9zY29wZV9zaGFkb3dpbmcsCm9iYWxfb2JqZWN0X25vdGVkX21hcF9jb25zbnN0IFNldCA9IGNsb3dlZF9tYXRoLApub3duX2NvbmxlLmNvbScpOyIpX25ld19wcm9taXNlLCAiY29uc3QgcCA9IG5ldyBQcm9taXNlKCgpID0+IHt9KTsiKTtfbmV3X2RhdGUsICJjb25zdCBkID0gbmV3IERhdGUoKTsiKXBvcnRfbmFtZWRfd2l0aF9wdXJlYXVsdF9mdW5jdGlvbiwKICAgICAgICAgICAgImV4cG9ydCBkZWZhdWx0IGZ1biAxO1xuZXhwb3J0IGNvbnN0IGIgPSAyO1xuZXhlc3Rfb3B0aW9uYWxfY2hhaW5pbmdfY2FsbCwgImNvbnN0IHggPSBvYmo/Lm1ldGhhbGxzLCBzbyBpbXB1cmUgYnkgZGVmcnJvd193aXRoX2Jsb2NrLCAiY29uc3QgZm9vID0gKCkgPT4geyByZWVzdF92b2lkX29wZXJhdG9yLCAiY29uc3QgeCA9IHZvaWQgMDsiKTsKdXJpbmdfYXNzaWdubWVudCwgImNvbnN0IHsgYSwgYiB9ID0gYmFsX3B1cmVfd2l0aF9pbXB1cmVfdW0gPSBOdW1iZXIoJzEyMycpOyIKbnN0IHN0ciA9IFN0cmluZygxMjMpOyIKaWduIGlzIE5PVCBwdXJlIChpdCBtdXRhdGVzKQogaXhlZF9idWlsdGluX2FuZF9pbXB1bWJlcl9pc19uYW4sICJjb25zdCByZXN1bHQgPSBOdW1iZXIuaXNOYU4oeCk7Iik7bWF0aF9tYXgsICJjb25zdCB4ID0gTWF0aC5tYXgoMSwgMiwgMyk7Iik7ciA9IFsvKiNfX1BVUkVfXyovIGZvbygpXTsiKTsgV2l0aG91dCBhbm5vdGF0aW9uLCBjYWxscyBhcmUgaW10aW9uX2Z1bmN0aW9uX2NhbGwsICIvKmlwbGVfZGVjbGFyYXRpb25zX3B1cmxfaW5fb2JqZWN0LCAiY29uc3Qgb2JqID0geyBhOiBmb28oKSB9OyIpc3RfcmVxdWlyZV9zdGF0ZW1lbnQsICJjb25zdCB4ID0gcmVxdWlyZSgneScpOyIpY3Rvcl9jYWxsLCAibmV3IFNpZGVzdF9jb25zb2xlX2xvZywgImNvbnNvbGUubG9nKCdoZWxsbycpOyIpbXBsZV9jb25zdF9kZWNsYXJhdGlvbiwgImNvbnN0IHggPSA1OyIpOwpjdGZ1bCk7CiAgICAgICAgfTsKICAgIH0KCiAgICBtYWNyb19ydWxlcyEgbm9fcywgbXNnLCBjb2RlKTsKb25fc2lkZV9lZmZlY3RzKCZwcm9ncmFtLCAmY29tbWZpZXJzCiAgICAgICAgICAgIGxldCB1bnJlc29sdmVkX21hcmsgPSBNYXJrOjpuZWVjdHMpIHsKICAgICAgICBHTE9CQUxTLnNldCgmRGVmYXVsdDo6ZGVmYXVsdCgpLCB8bnRzOjpTaW5nbGVUaHJlYWRlZENvbW1lbnRzLCBzeW5jOjpMcmN9LAogIC8vIEFsc28gY2hlY2sgdGhlIGxlZnQgcyAgcmVzdC5hcmcvIFJlY3Vyc2l2ZWx5IGNoZWNrIHRoZSB2YWx1ZSBwYXQgJm9iamVjdF9wYXQucHJvcGJlcjo6VHNJbmRleFNpZ25hdHVyZShfKXNzb3Iua2V5LiA9ICZhdXRvX2FjY2Vzc29yLnZhbGN0b3IoY29uc3RiZXI6Ok1ldG9yLnZpc2VjdHMgYmVjYXVzZSB0aGV5IGV4ZWN1dGUgaW1tZWRpYXRlbHkKIGVjayBjbGFzcyBib2R5IGZvciBzdGFhbWVzIG5lZWQgZXZhbHVhdGlvbgogICAgICAgICAgICAgICAgY29tcHV0ZWQuZXhwcnRob2Qua2V5LnJvcDo6R2V0dGVyKGdldHRlcikgPT4gewogICAgICAgICAgICAgICAgZ2V0dGVhZDo6U3ByZWFkKHNwcmVhZCkgPT4gewogICAgICAgICAgICAgICAgc3ByZWFkLmV4YXNlOjpDYWxsKF9vcHRfY2FsbCkvIFByaXZhdGUgbmFtZXMgYXJlIHB1cmUgKGp1c3QgaWRlbnRpZmllcnMpCiAvIE1ldGEgcHJvcGVydGllcyBsaWtlIGltcG9ydC5tZXRhIGFuZCBuZXcudGVjayBlYWNoIGV4cHJlc3Npb24KICAgICAgICAgICAgICAgIHNlcS5leHBycy52aXNuaW5nIGNhbiBiZSBwdXJlIGlmIGl0J3MganVzdCBtZW1iZXIgYWNjZXNzCiAgYXRlcyAoKyssIC0tKSBoYXZlbGxvdyBhc3NpZ25tZW50cyB0byBtb2R1bGUgbGV2ZWwgdmFyaWFibGVzCiBmLmlzX3B1cmVfYW5ub3RhdGVkKG5ldy5zcGFudWlyZSguLi4pIHN0YXQoLi4uKSkKICAgICAgICAgICAgICAgICAgICAvLyAyLiBUaGUgYXJndW1lbnRzCgogIG9ucyAoY29uc2VydmF0aXZlKQogICAgICAgICAgICBFeHByOjpDYWxsKGNhbGwpID1lc3MgYXMgcHVyZQogICAgICAgICAgICAgICAgLy8gMy4gQmVpbmcgdG9vIGNvbnByOjpDb25kKGNvbmQpID0+IHsKICAgICAgICAgICAgICAgIC8vIENvbmRpdGZ0LnZpc2l0X3dpdGgoc2VsZik7CiAgICAgICAgICAgICAgICBiaW4ucmlnaHQudmlzcyBub3QKICAgICAgICAgICAgICAgIGlmIHVuYXJ5Lm9wID09IFVuYXJ5T3A6OkRlbGVfZXhwci5jbGFzcy52aXMgUmVhZGluZyBpZGVudGlmaWVycyBpcyAvIEV4cHJlc3Npb24tbGV2ZWwgZGV0ZURlY2woZGVjbCkgPT4gewogICAgICAgICAgICAgICAgZGVjbC56ZXJzIG1pZ3NpdF9zdG10KCZtdXQgc2VsZiwgc3RtdDogJlN0bXQpOjpUc0ltcG9ydEVxdWFscyhlKSA9PiB7CiAgICAgICAgICAgICAgICAvLyBUaGUgUmZhdWx0RXhwcihleHBvcnRfZGVmYXVsdF9leHByKXB0IGludGVyZmFjZSBkZWNlZWQgdGhlaXIgaW5pdGlhbGl6ZXJzIGNoZWl6ZXJzLgogICAgICAgICAgICAgICAgICAgICAgICBjbGFzc19kZWNsLnZpc2lydCBkZWNsYXJhdGlvbnMgbmVlZCB0byBjaGVjayB0aGVpciBjb250ZW50cwpldmVsIHN0YXRlbWVudHMKICAgICAgICBmb3Igc3RtdCBpbiAmc2NyaXB0LmJvZHk8J2E+IFZpc2l0IGZvciBTaWRldG9ycyBzZXQKICAgICAgICAgICAgICAgIEtOT1dOX1BVUkVfQ09OU1RSVUNUT1JTLmN0b3IoJnNlbGYsIGV4cHI6ICZFeHByKSAtPlBVUkVfR0xPQkFMX3JyYXkoXyksIExpdDo6UmVnZXgoXykgPUxpdDo6Qm9vbChfKSBQVVJFX1NUUklOR19QUk9UVElPTlMKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5nZXQob2JqLnN5bS5tYmVyLm9iaik7CiAgbm5vdCBhc3N1bWUgaXQncyB0aGUgYnVpbHQtaW4uCiBlZigpID09ICJyZXF1aXJlIgogICBsIGlzIHRvIGBpbXBvcnQoKWAgb3IgYHJlcXVpcmUoKWAuCmF0ZWQoJnNlbGYsIHNwYW46IHN3Y19jb3JlOjpjb21tb246OlNwYW4pIC0+bGV0IG9sZF92YWx1ZSA9IHNlbGYud2lsbF9pbnZva2VfZm5fZXhwcnM7CiAgdHM6ICYnYSBkeW4gQ29tbWVudHMsIHVucmVzb2x2ZWRfbWFyazogTWFyaykgLT4gdmlzaXRvcik7CiAgICBpZiB2aXNpdG9yLmhhc190aXZlIGZvciB0cmVlLXNoYWtpbmcsIHdlIGV4Y2x1ZGUgdGhlc2UgbWV0aG9kcy4Kcy8gMS4gTGl0ZXJhbHMgY3JlYXRlIGZyZXNoIG9iamVjdHMgZWFjaCB0aW1lCi8vLyAgICJmbGF0IiwKICAgICJmbGF0TWFwIiwKICAgIC8vIEFjY2VzcyBtZXRtYXRjaCIsCiAgICAibWF0Y2hBbGwiLAogICAgInRyaW0iLAogICAgInRyaW1TdGFydCAgImluY2x1ZGVzIiwKICAgICJzdGFydHNXaXRoIiwKICAgICJlbmRzV2l0aG9ucy4KLy8gV2UgZG8gaG93ZXZlciBhc3N1bWUgdGhhdCB0aGVzZSBmdW4iVWludDhDbGFtcGVkQXJyYXkiLAogICAgIkludDE2QXJyYXkiLAogICAgIlVpbnQxNmN0cyAobm8gZ2xvYmFsIHN0YXRlIG1vZGlmaWNhdGlvbikuCi8vLyBUaGV5IGFwZXJ0eU5hbWVzIiwgImdldE93blByb3BlcnR5U3ltYm9scyIsCiAgICAgICAgImdldGQiLCAic2lnbiIsICJzaW4iLCAic2luaCIsCiAgICAgICAgInNxcnQiLCAidGFuIiwgImNlaWwiLAogICAgICAgICJjbHozMiIsICJjb3MiLCAiY29zaCIsICJleHAiLCAiZWVjdHMgewogICAgKCRzZWxmOmV4cHIpID0+IHsKICAgICAgICBpZiAkc2VsZi5sZCBhbHNvIGNvbnNpZGVyCi8vISBjaGFuZ2luZyBob3cgYHJlcXVpcmVgIGlzIGhhbmVyZWQgbm9uLWVmZmVjZnVsIGp1c3QgbGlrZSBgRVNNYCBleHBvcnRzLiAgSWYgd2ZlY3RzLgovLyEgSG93ZXZlciwgbXV0YXRpb25zIHRvIGxvY2FsbHktc2NvcGlvbnMKLy8hIC0gVXBkYXRlIGV4cHJlc3Npb25zIChgKytgLCBgLS1gKQovLyEgLSBEdWxlPj4+IHsKICAgICAgICBPayhWYzo6dXBjYXN0KAogICAgICAgICAgICAqTWVyZ2VtcGwgRXZhbGFwaDogUmVzb2x2ZWRWYzxNb3J0cyhleHBvcnRzKS5jZWwgc3Rhcl9lbmNlKSk7CmxldCBlc21fZXhwb3J0cyA9IGVzbV9leHBvcnRzLmF3cDogZmFsc2UsCiAgICAgICAgICAgIG9yaWdpbmFsX3NvaW9uOiBDb2RlR2Vuczo6ZW1lbGYpLAogICAgICAgICAgICBzcGVjaWZpZWRfbW9pbCEoIkVjbWFzY3JpcHRNb2R1bGVGYWNhZGVNb2R1bGU6Om1vIH0gfCBNb3Q8VmM8Ym9vbD4+IHsKICAgICAgICBsZXQgYXN5bmNfbW9kdWxlID0gc2NlbGwoTm9uZW5hbWVkRWNlczo6ZW1wdHkoKS50b1RPRE8gc2tpZW5jZT4+LAogICAgICAgIFJlc29sdmVkVmM8RXNtQXN1bHQ8KAogICAgICAgIFZlYzx1bGUgeyBtb2R1bGUsIHBhcnQgfS5jZXNwYWNlCiAgICBwYXJ0OiBNb2R1bGVQYXJ0LAp9CmxlOjp7QXN5bmNNb2R1bGUsIE9wdGlvbkFzeW5jTW9kdWxlfSwKICAgICAgICBlc2l0ZW06OkVjbWFzY3JpcHRNb2R1bGVGYWNhZGVDaHVua0l0ZW07CnVzZWZlY3RzfSwKdHlwOiBTb20gIC5ub3RfZXhwb3J0ZWQoKQp0eXA6IFR5cHJhY3QoKSAgInJlcWVzcygiaGVsbG8gd29ybGQhIikpCiBlbGRzX21ldGFvbyIpKSwKICAiYmF6Zm4gc29tZV9kb2MoKSB7YXIiKS5pbnRvKCkpXSwKZm4gdHJpdmlhbCgpIHtpbXBsPEksIEl0PiBGcm9tPEl0PiBmb3IgUmVjb3JkCndoZXJub3QgYXV0b21hdGljYWxseSBjbG9zdXJpemVkLgogICAgcHViIGZuIGJ1aWxkKHNlYSByZWFkeS10by11c2UgdmFsdWUsIHNvIHRoZSBidWlsdCByZWNvcmQgaXMgd3JhIFNlZSBgb3BlbmAgZm9yIGNvbW1lbnRzIG9uIHRoZSBjbGlwcHkgZGlyZWN0aXZlCmFsbCByZWNvcmQgYXR0cmlidXRlcyBhdCBvbmNlCiAgICBwdWIgZm4gYXR0cnMobXV0Zm9yIGYgaW4gZmllbGRzIHsKICAgICAgICAgICAgc2VsZiA9IGYuaW50bygpLndpZWxkIHdpdGggdGhlIGdpdmVuIG5hbWUKICAgIHB1YiBmbiBmaWVsZChzZWxmLCBuYW0gIG9jY3VwaWVkLmluc2VydChtZXJnZV9maWVsZHMocHJldiwgdCkpOwogbygpKSwgdDEsIHQyKSksCiAgICAgICAgICAgIChTb21lKHQpLCBOb25lKSB8IChOb25mb2xkKGNvbnRlbnQsIHxhY2MsIGlkfCB7Cm9yZCBiZWluZyBjb25zdHJ1Y3RlZAojW2RvcmQ+IHsKICAgIC8vLyBGaW5hbGl6ZSB0aGUgW2BGaWVsZGBdIHdpdGh0Y2ggdiB7CiAgICAgICAgICAgIENvbXBsZXRlKFNvbWUodikpID0+b3JkOiBDb21wbGV0ZShOb25lKSwKICAgICAgICAgICAgcGF0aDogc2VsZi5wYXRoLGFsbCBhdCBvbmNlCiAgICBwdWIgZm4gbWV0YWRhdGEobXV0IHNlbGYsIG1ldHJpdHkobXV0IHNlbGYsIHByaW9yaXR5OiBNZXJnZVByaW9yaXR5KSAtPmFjdHM8ST4obXV0IHNlbGYsIGNvbnRyYWN0czogSSkgIHNldF9ub3RfZXhwb3J0ZWQobXV0IHNlbGYsIG5vdF9yayB0aGUgZmllbGQgYXMgb3B0aW9uYWwKICAgIHB1YiBmbiBvcHRpb25hbChzZWxhdGEsCn0KCmltcGw8QT4gRmllbGQ8QT4gewogZFR5cGUsIE1lcmdlUHJpb3JpdHksIFRlcm0sCiAgICAgICAgbWFrZTo6b3AyLAogIHIgc3R5bGUuIEZvciBleGFtcGxlOgovLyEKLy8hIGBgYHJ1c3QKLy8hICMgdXNlIGVudHMgVAogICAgICAgIGNvbnRlbnQuY2FzdF90cmFpdDo6PFQ+KCkKICAgIF9waGFudG9tOiBQaGFudG9tRGF0YTxUPiwKfQoKaW1wbDxUPiBWY0Nhc3QgZmluZWQgdG8gc2hhcmUgYmVoYXZpb3IgYmV0d2VlbiB2YWx1ZXMgYW5kIHRyYWl0cyB3KCIvIik7CgogICAgZm9ybWF0ISgiZmlsZTovLy97fSIsIGVuY29kZWRfcGF0aCkKfQpldCBub3JtYWxpemVkX3BhdGggPSByYXdfcGF0aC5yZXBsYWNlKCdcXCcsICIvIik7Cm90X2ZzID0gcm9vdC5mczsKICAgIGxldCByb290X2ZzID0gJipSZXNvbHJpbmcgTm90Rm91bmQgZXJyb3JzIGFnYWluc3QgYWxsIG90aGVyIGVycm9ycy4KcGlyZSB0eXBlIHN1YnN0aXR1dGlvbiBtYWNoaW5lcnkuCiBwMSA9IHJyb3dzX2FzX21hcCh1dHkxKTsKICAgICAgICAgICAgbGV0IG1hcDIgPSBycm1hcDIgPSBlciB1dHkxOiAmT3BycmF5KHV0eTIpKSA9PiB0eXBlX2VxX2JvdW5kZWQoc3RhdGUsIHV0eTEsIGVubCwgVHlwZUY6OlN5bWJvbCkKIHRlLCB2YWx1ZTEsIGVudjEsIHZhbHVlMiwgZW52MiksCiAgICAgICAgKE5vbiAgIHQxLmxhYmVsLnR5cGVfZW52aXJvbm1lbnQgPT0gdDIubGFiZWwofChjMSwgYzIpfCB7CiAgICAgICAgICAgIGMxLmxhYmVsLnR5cGVpb246IHRoZSBmaWVsZCBgdHlwZV9lbnZpcm9ubWVudGAgZG9lcyBpbXBhY3QKICAvLyBbXmNvbnRyYWN0LWVxLWlnbm9yZS1sYWJlbF06IFdlIG1vc3QsIHR5cCkpLAogIG1hcAp9CgovLy8gQ29udmVydCBlbnVtIHJvd3MgdG8gYSBoYXNobWFwLgovLy9hcCh8djJ8IGYoc3RhdGUsIHYxLCBlbnYxLCB2MiwgZW4gIG1hcDI6ICZJbmRleE1hcDxMb2NJZGVudCwgVj4sCiAgICBlbnYyOiAmRW4gICAmcmVjX2RvcmQocmVjX2RhdGEpbXB0eSksCiAgICAgICAgKQogICAgICAgIHwgKAogIGh1bmspLCBfKSBkIG9mIHBhbmlja2luZyBhcyBgYm9ycm93KClgIHdvdWxkLgogaHVuazEpLCBWYWx1ZUNvbnRlbnRSZWY6OlRodW5rKHRodW5rMikpID1hdGExLmlubmVyLCBlbnYxLCAmZGF0YTIuaW5uZTpPcDEoT3AxRGF0YSBlLCAmY3RyMS50eXAsIGVudjEsICZjdHIyLnR5cCBpcyBlaXRoZXIgdGhlIHR5cGUgYW5ub3RhdGlvbiwgb3IgdGhlIGZpcnN0IGNvLy8gLSBhbmQgaW4gdGhlIGxhdHRlciBjYXNlLCBzaG91bXVzdCBjb21hdGEyKSkgPT4KICAgICAgICAgICAgICAgIC8vIFdlIG9ubHkgY29tcGFyZSByICAgKFN0ckNocGxleC4KICAgICAgICAgICAgICAgIChUZXJtOjpTdHJDaHVua3Moc2NzMSksIFRlID0gaWR4LmJvcnJpZiAhc3RhdGUudXNlX2dhcygpIHsgLy8gaWYgdGhleSBoYXZlIHRoZSBzYW1lIGlkZW50aWZpZXI6IHdoYXRtZW50ICh0aGF0IGl0CiAgICAgICAgLy8gZG9lc24ndCBpbmNsdWRlIHRoZSAvLyBJZGVhbGx5IHdlIHdvdWxkIGNvbXBhcmUgcGVuZGluZyBjb250cmFjdHMsIGJ1ICAmJiBhcnJfZGF0YTEKICAgICAgICAgICAgICAgICAgICAuYXJyYSAgICAmcjEuZmllIHRhZzIgJiYgY2lhbnQoZW51bTEpLCBSZWY6OkJvb2woYjEpLCBWYWx1ZUNvbnRlbnRSZWY6OkJvb2woYjIpKSA9PiBiMWFjdHMgaW4gdGhlaXIgcmVzcGVjdGl2ZSBlbnZpcm9ubWVudCBhbmRnIGEgc291bmQgY29udHJhY3QgZXF1YWxpdHkgKGl0IGNvdWxkIGVxdWF0ZSBjb24vIG9yIGZhbHN6ZXJvIGFuZCB3ZSBlbmNvdW50ZXIKICAgIC8vLyBhIHZhcmlhYmxlLCB3ZSBhYm9yLCBPcDFEYXRhLCBTdHJDaHVuaywgVGVybSwgVW5hcnlPcCwgcmVjb3JkOjpGaWVsZH1oZWFwLiBXZSBjaG9vc2UgdG8ganVzdCBzZXQgYW4gYXJiaXRyYXJ5IGxpbWl0IChzdGx5KSBpbiBhIHN0cnVjdHVyYWwgd2F5LCBhbmQgcmVseQovLyEgb24gcGh5c3BhcmUgZnVuY3Rpb25zIHN5bnRhY3RpY2FsbHkgZWl0aGVyLiBUaGUgc3Bpcml0IG9mZSBBU1QKLy8hIGFyb3VuZCBhdCBydW50aW1lIGFueW1vcmUsIGFnZTo6UG9uZyhfKSA9PiB7CiAgICAgICAgICAgICAgICAvLyB0aGFua3MgZm9hcHBlbgogIGlmIHVwZGFhcGg6IGZhbHRoLnJldmVyc2UoKTsKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBTZXJvdGFsX3BlcnNvcmUucm9vdF9zcGFuKCkuc3RhcnQoKTtnZSA9IHsKZ2U6OlJlc2V0ICAgImJvdHRvc3BhbnMiID0+b2RlLCB0cnVlY3QgfSA9JnRleHQpPzsKICAgICAgICAgICAgICAgIGxldCBtdXQgc3RhdGUgPSBzdGF0ZS5sb2NudCA9IHVwZGF0ZXMubGVuKCk7CiAgICAgICAgZm9yIHVwZGF0ZSBpbiB1cGRtdXQgYm9vbCwKICAgICkgLT4gUmVzdWx0PCgpPiB7CiAgICAgICAgaWYgISpyZWFkeWRlOiAiYWdncmVnYXRlZCIudG9fb3JlKSB7CiAgICAgICAgICAgICAgICBlcHJpbnRsbiEoIkVycm9yOiB7ZXJyOj99IilyIHN0cmVhbSBpbiBzZXJ2ZXIuaW5jb21pbmcoKWwgPSAic25ha2VfY2FzZSIpXQpwdWIgZW51bSBPcCB7CiAgICBHdCwKICAgIEx0LAp9ICAgQWNrLAogICAgQ2hlY3JnczogVmVjPChTdHJpbmcsIFN0cmFsaXplfTsKdXNlIHR1bmdzdGVuaXRlOjp7TWVzc2FnZSwgYWNjZXB0fTsKCnVxIShzdGFydGVkLCBOVU1fVEFTS1MpOwogICAgICAgICAgICBhc3NlcnRfZXEhKGZpbiAgIHNjaGVkdWxlZCArPT99IiwgYWN0aW9uKTsKICAgICAgICAgICAgICAgIG1hdGNoIGFjdGl0YXJ0KDkpLAogICAgICAgICAgICBBY3Rpb246OlN0YXJ0KDgpLAogIGhpY2ggbGV0cyBpbiB0aGUgaGlnaCBwcmlvdWxlKDExLCBmYWxzZSksCiAgICAgICAgICAgIEFjdGlvbjo6U2NoZWR1bGUoMTIsIGZkdWxlKDYsIHRydWUpLAogICAgICAgICAgICBBY3Rpb246OlNjaGVkdWxlKDcsIHRydWQgc3RhcnQgMCBhbmQgMSAoQ1BVLWJvdW5kKS4KICB0YXNrX2JhcnJpZXJzOiAoMC4uTlVNX1RBU0tTKQogICB0eCA9IEFyYzo6bmV3KFRlc3RDZSA9IGN0eC5jbG8gIGN0eDogJkFyYzxUZXN0Q29udGV4dD4sCiAgICAgICAgICAgICAgICAodGFzay8vIGJldHdlZW4gYmFycmllciByZWxlYXNlIGFuZCBwcmludGluZyBhbnl3YXlzLgogaW1lOjp0aW1lb3V0KAogICAgICAgICAgICAgICAgICAgIER1cmFtZTo6QnVpbGRlcjo6bmV3X211bHRpX3RocmVhZCgpCiAgICAgICAgICAgIC53b3JrZS8vIC0gVGFza3MgMTAtMTkgYXJlIHdhaXRpbmcgdGFza3MgKGFzeW4gMTApKS5ySW1wbCB7CiBbMCwgMV0pOwogeHQgPSBleGVjaW5zKCY5KSk7CiByc3QgdHdvIHRhc2tzIGFyZSBkaXJlY3RseSBzcGF3bmVkIHdpdGhvdXQgcXV1bHRzLmNsb24gZXhlY3V0ZSgKICBfID0gcmVzdWx0OwogICAgICAgICAgICAgICAgUG9sbDo6UmVhZHkoKCkpClBvbGw8U2VsZl9zbG90LndyaXRlKG5ld19mdXR1cmUpOwogLy8gcGlubmVkIGluIHRoYXQgcGxhY2UuCiBubmVyLnBvcF9mdXR1cmVfZnJvbV93b3JrZXIodGhpcy5leGVjdXRlX2NvbnRleHQpCnVsZCBlbmQgdGhpcwogICAgICAgICAgICAgICAgICAgICAgICAvLyB3b3JrdCB3ZSBpZiB0aGVyZSBhcmUgZnJlZSh0eCkgPSB0aGlzLnR4LnRha2UoKSB7ICAgUG9sbDo6UmVhZHkoKCkpID0+aXZlIChpdCBwcmV2aW91c2x5IHJldHVybmVkIFBvbGw6OlBlbmRpbmcpLHVyZTogRTo6RnV0dXJlLAogICAgICAgIHR4OiBPcHRpb248U2VuZGVyPCgpPj4sCiAgT3JkLAogICAgICAgIFA6IFNlbmQsCiAgICAgICAgUDogJ3N0dHdvKCkubWF4KDEyOCk7CiAgICAgICAgcXVldWUuc2hyaW5rX3RvKG5ld19jLCBUPj4pIHsKICAgIC8vIEFtb3J0aXplZCBzaCBtdXQgcXVldWUgPSBzZWxmLnF1ZXVlLmxvZWxmLnRhcmdldF93b3JrZXJzIHsKICAgICAgICAgICAgc2VsZi5zcGF3bl93b3JrYXhlZCkgLSAxOwogICAgICAgIGlmIGFjdGl2ZV93b3JrZXJzIDwgc2VsZmNpdHkgbm93LCBzbyB3ZSB0cnkgdG8gc3Bhd24gYSBuZXcgd29ya2VyIGlmCiB0IGJ5IDEuCiAgICAvLy8gSWYgdGhlcmUgaXMgd29yayBhdmFpbGFibGUgaS8vIE5vIGZyZWUgY2FwYWNpdHksIHB1c2hlYWR5IHdvcmsgaW4gdGhlIHF1ZXVlLCB3ZSBkb24ndCBoYXZlIGFueQp0eTogUCwKICAgICkgLT4gSm9pbmtlcnMoKSwKICAgICAgICAgICAgcXVldWU6IE11dGV4OjpuZXcoQmluYXJ5SGVhcDo6YXJlIHBvbGxlZCBhZ2Fpbi4KICAgIGFjdGl2ZV93b3JrZXJzOiBBdG9taWNVc2l6ZSx1Y3QgUHJpb3JpdHlSdW5uZXI8CiAgIHNlbGYpKGV4ZWN1dGVfY29udGV4dCwgdGFzaywgcHJpb3JpdHkpCmVjdDsKdXNlIHRva2lvOjpzeW5jOjpvbmVzaG90Ojp7UmVjZWl2ZXIsIFNlbmRlcn07KG5vdCh1bml4KSldCmZuICAga2lsbF9wcm9jZXNzKHByb2MpPzsKIG9sb3JzOjpPd29Db2xvcml6ZTsKCiAgICBjb25zdCBLSUxMX0RFQURMSU5FOiBEdXIgICBwYWdlLmV4ZWN1dGUoQWRkQmluZGluZ1BhcmFtczo6bmV3KEJJTkRJIE9rKHBhZ2VfZ3VhcmQpCiAgICB9CgogICAgcHViIGZuIHN0b3Bfc2VydmVyKCZtdWF0Y2ggbmV0d29ya19yZXNwb25zZV9ldmVudHMubmV4dCgpLmF3YWl0IHtlIHRvIGV2YWx1YXRlIGphdmFzY3JpcHQgdG8gbmF2aWdhdGUgdG8gdGFyZ2V0IHBhcjo6PEV2ZW50UmVzcG9uc2VSZWNlaXZlZD4oKQogICBhZGRfYmluZGluZygmcGFnZSkKdGhfcGFnZShzZWxmLCBicm93c2VyOiAmQnJvd3NlcikgLT4gUmVzdWx0PFBhZ2VHc3VsdDxQcmVwYXJlZEFwcDwnYT4+IHsgZm9yIGpvYiBpbiBqb2JzIHsKICAgICAgICBqb2IuYXdhaWZzOjpjb3B5KGVudHJ5LnBhdGgoKSwgdG8pLmF3YSAgICBqb2JzLnB1c2godG9raW86OnNwYXduKGFzeS5jb20vcnVzdC1sYW5nL3J1c3QvaXNzdWVzLzEyMzA3MgpmbiBjdGU6OntCSU5ESU5HX05BTUUsIGJ1bmRsZXJzOjpCdW5kbGVyLCB1dGlsOjpQYWdlR2lvbiBzbyBpdCByYWN5IHRvCiAgICAgICAgICAgICAgICAvLyBhc3NlcnQgb24gaXQuZXcoIl5bXjpAXStAW146XSs6KyIpLnVud3JhcCgpKTsKICAgIG1hdGNoICZtdXQgamlsISgiZmFpbGVkIHVzaW5nIHt2YWx9Iik7Cn0KCmZuIGVuYWJsZV9zdGF0cygpIHt1YmxlKCZzZWxmKSAtPiBWYzxTZWxmPjsKICAgYXBfdmModmFsOiBWYzx1NjQ+KSAtPiBSZXN1bHQ8VmM8V3JsZSI6ICB7dmMiOiAgewogaGVtCiNbdG92YygpLnJlc29sdmUoKSwgd3ZjLmRvdWJsZV92YygpLnJlc29sdmUoKSkubGUoKS5paXQiOiA1LAooZHZjKS5hd2FsdmVkIG9uY2UKICAgICAgICB0b2tpbzo6dHJ5X2pvaW4hKGR2Yy5pbGUoaSkuYXdhIE9rKFByb2Nlc3NQb3N0Q3NzUmVzdWx0IHsgY29udGVudCwgYXNzZXRzIH0uY2VlKHZhbCkgPSAmKmNvbmZpICAgIGN3ZDogcHJvanBwZW4gb24gdmlydHVhbCBhc3NldHMKICAgICAgICAgICAgICAgICIiLmludHdpdGhfZW50cmllcygKICAgICAgICAgICAgZW50cmllcy5ncmFwaF9lbnRyaWVzKClmb3JtIHdoZW4gdGhlIGNvbmZpZyBjaGFuIGxldCBBc3NldENvbnRlbnQ6OkZpbGUoZmlsZSkgPSAqc291ci8gV2UgbG9vayBmb3IgdGhlIGNvbmZpZyBpbiB0aGUgcHJvamVjdCBwYXRoIGZpcnNlIHBvc3Rjc3MuCiAgICAgICAgLy8gaS5lLCB0aGlzIGlzIHBvc3NpYmxlCiA8RmlsZUNvbnRlbnQ+PiB7CiAgICAgICAgbGV0IHNvdXJjZSA9IFZjbnQoKS5wYXRoKCkuYXdhaXQ/LnBhcmVudCgpLAogICAgICAgICAgICBwb3N0X2tleShwcm9qZWN0X3BhdGgsIHBvc3Rjc3NfY29uZmlncygpLCByY3VyY2UocHJvamVjdF9wYXRoLCBwb3NiZSBzZXJpYWxpemFibGUiKSwKICAgIH07CgogICAgT2soVmM6OnVwY2FzdChWaXJ0dWdQYXRoID0gcGF0aC5qb2luKHByb2Nlc3MuY3dkKCksIHtjb25maWdfcGF0aH0pOwogc3Rjc3MgY29uZmlnIik7CiBzc3JjIgogICAgewogICAgICAgIHJldHVybiBPayhWYzo6dXBjYXN0KEpzb25TYXRlKSBhc3luYyBmbiBjb25maWdfbG9hZGVyX3NvdXJlID0+ICYqanNvbiwKanNvbjUgewogICAgICAgICAgICAgICAgICAgIHNlbGYucGF0aC5yZWFkX2pzb241KClTb21lKGtleSkgPT5qc29uNSwKICBkdWxlKCptb2R1cmNlOjpuZXcocGF0aCkpLAogICAuY29tcGxldGVkKCkpVmM8Q29tcGxldGlvbj4+IHsKICAgIGxldCBjb25maWdfYXNzZXQgPSBhc3NldXJjZS5pZGVsZi5leGVjbXBsIFBvc3QubWFwKFJjU3RyOjpmcm9tKQogc3NyYy50cyIsCiAgICAgICAgICAgICIucG9zdGNzc3JjLm10cyJudW0gUG9zdENzc0NvbmZpZ0xvY2F0aW9uIHsKICAgICNbZGVmYXVsdF0KICB1Y3QgUG9zdENzc1Byb2Nlc3NpbmdSZXN1bHQgewogICAgY3NzOiBTdHJ5cGUsIElubmVyQXNzZXRzLCBSZWZlcmVuY2VUeXBlfSwKICAgIHJlc29sdmU6OntGaWF0aCwganNvbjo6cGFyc2VfanNvbl93aXRoX3NvdXJjZV9jb250ZXh0LAp9OwpybWF0ZG9jOwp1c2Ugc2VyZGU6OkR0aF9jYWNoZV9kaXIoY2FjaGVfZGlyKSkKICAgIH0KCiAgICAvLy8gQ29uZiAgIC5jYWNoZV9kaXIoKQogICAgICAgICAgICAudG9fb3duZWQoKTtmb3IgZmV0Y2hpbmcgcGFja2FnZXMgd2l0aCBhbiBpZCBvZiBgUHJlY2lzZUlkOjpHdXJjZSBpbnN0ZWFkLiBUaGUgbG9jay1maWxlIHdpbGwgbm90IHNlZSB0aGlzIHJlcGxlIG1hbmFnZXIuCiNbZGVyaXZlKENsb25lLCBEZWJ1ZyldCnB1YiBzdHJ1Y3QgQ29uZmluZTogbiwKICAgICAgICAgICAgICAgICAgICBpbnNpZGU6IGxpbWl0X2xlbihsKSwKLy8gZW5kIGxpbmUKICAgICAgICAgICAgKE9yZGVyaW5nOjpHcmVhdGVyLCBPcmRsdW1uIGFzIHVzaXplKSBhcyBsZXQgKGJlZm9yZSwgaW5zaWRlKSA9IHNhZmVfc3BsaXRfYXQobCwgc3RhbGV0IChhLCBiKSA9IHMuc3BsaXRfYXQocy5mbG9vcl9jaGFyX2JvdW5kYXJ5KDk4KSkgZm4gc2FmZV9zcGxpdF9hdChzOiAmc3RyLCBpOiB1MzIpIC0+ICgmc3RyLCAmc3RycnQgPSAoc3RhcnRfbGluZS5zYXR1cmF0aW5nX3N1Yig0KSkgYXMgZm9yIFNvdXJjZUNvbnRleHRMaW5lczwnXz4gIC0gMiksCiAoKSAtIDIpCiAgaW5lOjpFbmQgewogICAgICAgICAgICAgICAgbGluZSwKOj42fSB8IHtvdXRzaWRlfXJfdmFyIHsKIG9yZWQuaW5zZXJ0KG9iai50IGlmIHNhZmVfdG9faWdub3JlIHsKICAgICAgICAgICAgc2VsZi5pbl9tZS8gV2UgbWFrZSBgbmFtZWAgaW52YWxpZCBpZiB3ZSBzb3J0UmVjbyAvLyBEcm9wIHZhcmk6U3RyKHYpKSA9ICYqYXJnLmV4cHIgX211dF92YXJfZGVjbGFyYXRvcigmbXV0IHNlbGYsIG46ICZtdXQgVmFyRHRtdHMoCiAgICAgICAgICAgICZtdXQgbi5ib2R5LAogICBpZiAhcmVwbGFjZWQgewogICAgKmUgPSBFeHByOjpJZGVudChuZXdfaWQuaW50bXRzLnB1c2goU3RtdDo6RGVjbChEZWNsOjpWYXIoCiAgICAgIERVTU0gLmFzX2NhbGxlZSgpLApsZWU6IElkZWV0IHZhciA9IFZhckQgICAuZGF0YQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLnJlcGxhY2VkCiAgZXkgPSBvYmoudG9faWxmLCBtb2R1bGVfc3BlY2lmaWVyOiAmV3RmOEF0b20pIC0+IE9wdGlvbjwmRnhIYXNsYWNlZDogRnhIYXNoTWFwPChXdGY4QXRvbSwgQXRvbSksIElkPiwKCiB1YiBwYWNrYWdlczogRnhIYXNoTWFwPEF0b20sIFBhY2thZ2VDb25maWc+LAp9Cm9tczo6QXRvbSwKICAgICAgICB1dGlsczo6e3ByZXBlbmRfc3RtdHMsIHByaXYgIGxpbmtfdHlwZTogTGlua1R5cGU6OkRJUkVDVE9SWSwKICAgYXAofChzeW1saW5rX2lkeCwgdGFyZ2V0X2lkeCl8IHsKZV9pbml0aWFsX3N5bWxpbmtzX29wZXJhdGlvbigKICAgIHN5bWxpbmtzX2RpcjogRmkgIHR0LnN0b3BfYW5kX3dhaXQoKS5hbWUgPSBub3c7CiAgICAgICAgICAgICAgICBsYXN0X3Byb2dyZXNzX3dyaXRlcyA9IHQgICAiezouMX1zOiB7fSB3cml0ZXMsIHs6LjB9IHdyaXRlcy9zZWMiLAogZSgpLCB1cGRhdGVzKTsKICAgICAgICAgICAgd3JpdGVfb3AucmVhZGl6ZSk+ID0gKDAuLnBhcmFsbGVsaXNtKQogIDo6cm5nKCkpOwogICAgICAgIGxldCBtdXQgdG90YWxfd3JpdGVzOiB1NjQgPSAwO3Rpbmcge3N5bWxpbmtfY291bnR9IGluaXRpYWwgc3ltbGlua3MuLi4ib3JhZ2UoKSwKICAgICkpOwoKICAgIGxldCB0YXJnZXRfY291bnQgPSBhcmdzLnRhcmdpbigiX3RhcmdldHMiKTsKICAgIHN0ZDo6ZnM6OmNyZWF0ZV9kaXIoJnRhcmdlaXRlcyB0byBwZXJmb3JtIGluIHBhcmFsbGVsLgogICAgI1thcmcobG9uZywgZGVmZ3M7CnVzZSByYW5kOjp7Um5nLCBTZWVkYWJsZVJuZ307Cm50LmlubmVyX2NvZGUubGVuKCkpKSx0ZW0+PihjaHVua19pdGVtKQogIGNhc3QoRWNtYXNjcmlwdENodW5rOjpuZXcoY2h1bm91cHM6IFZlY0luZm99OwoKI1t0dXJib190YXNrczo6dmFsdWVdCiNbZCBmbiBpbW11dGFibGVfc2VsZl9mbihzZWwgXyA9IGlucHV0Owp1ZSA9IGlucHV0LnN0YXRlLmdldCgpOwogICAgT2soVmFsdWUgeyB2YWx1ZTogKnZhbGV0KDEwKTt1dCA9IHJlYWRfaW5wdXQoY2hhbmV0IGNoYW5naW5nX3ZhbHVlID0gY29tcHIuc2V0KFNvbWVkYXRlKTsKICAgIH0KfQoKaW1wbDxUOiBQYXJ0aWFsRXE+IFRyYW50ZVJlZiB7b3IgPSBnZXRfaW52YWxpZGF0b3IoKTsKb25lKSksCigiVHJhbnNpZW50U3RhdGUiKQogCgpmbiBkZWZhdWx0X3RyYW5zaWVudF9zdGF0ZV9pbm5lcjxUPigpIC0+IE11dGVvIHdvcmsuCiAgICBwdWIgZm4gc2V0KCZhbGx5KHZhLyBTZXRzIHRtZShpbnZhbGlkYXRvcikgPSBpbnZhICBUOiBPcGVlbGQoInZhbHVlIiwgJnNlbGYuaW5uZXIubG9jaygpLnZhc3RlbnQKLy8vIFtgT3BlcmF0aW9uVmNgXTogY3JhdGU6Ok9wZXJhdGlvblZjCi8vL2xscyBhbmQgcmUtcnVucyB0YXNrcyB1bnRpbCB0aGVpciB2YWx1ZXMgc2V0dGxlZC4gdXJlLgovLy8KLy8vIEFuIFtpbnRlcm5hbGx5LW11dGFibGVdIHR5cGUsIHNpbWljb2RlPCdkZSwgQ29udGV4dD4sCiAgICAgICAgRDogQm9ycm93RGVjb2RlcjwnZGUsbXV0ZXgubG9jaygpLmVuY29kZShlbmNvZGVyKQpubmVyLmludmRlcmVmX211dCh0YXRlIHZhbC5lbnRlcmVtdXQgVCkgLT4gYm9vbCkgLT4gYm9vbCB7CiAgICAgICAgaWYgIXVwZGF0ZSgmbWF0b3JzOiBBdXRvU2V0OjpnZXRfc2VyaWFsaXphdGlvbl9pbnZhbGlkYXRvciwgbWFuYWdlcjo6d2l0c3NldC5wYXRoKCkuYXdmbiBhc3NlZFZjPFJhd1dlYkFzc2VtYmx5TW9kdWxlQXNzZXQ+LAogZXh0KS50b2R1bGUgZm9yIFJhd1d0ZXh0LmludG9fdHJhaXRfcmVmKCkuYXdhaXQ/LmxheWVyKCkpKW1wbCBSYXdXZUNLX0VYUE9SVF9VUkwsCiAgICB1dGlsczo6U3RyaW5naWZ5SnMsCn07ZXQgZmlkID0gTG9jSWRlbnQ6OmZyb20oSWRlbnQ6Om5ldygiRm9yZWlnbklkIikpOwppbmQ6Ok1lcmdlSW5jb21wYXRpYmxlQXJncyB7IC4pLmFzX2ZvcmVpZ25faWQoKS51bndyYXAoKSwgNDIpOwoKICAgIC8vIEZvcmVpZWQgdGhyb3VnaC4KICAgIGxldCBjb250YWluZXIgPSAmZXZhbGVkLmFzdWJzdCgmcG9zX3RhYmxlLCAmZXZhbF9jYWNoZSwgdCwgJmluaXRpYWxfZW52LCAmZW55cGU6Ok5vcm1hbCkpKQogICAgICAgIC5jb2xsZWN0KCkKfQoKI1t0ZXN0XQpmbiBzdWFsdWUpPiwgZXZhbF9jYWNoZTogJm11dCBDYWNoZUltcGwpIC0+IEVudmk6bGV0X29uZV9pbigieCIsIG1rX3Rlcm06OmludGVnZXIoMiksIG1rXy5hZGQobWtfdGVybTo6aW50ZWdlcigxKS5pbnRvKCksIEJpbmRpbmdUeXJvbSgiSGVsbG8sIFdvcmxkISIpKSwKICAgICAgICBTdHJDaHVuazo6ZXhwcihUZXJtdW5rcykpKSwKICAgICAgICBPayhOaWVzcygiV29ybGQhIiksCiAgICAieCIsCiAgICAgICAgImxpYiIsCiAgICAgICAgbWtfdGVybTo6b3AxKAogICBvcnQgImJhZCIgaW4geAogICAgbWF0Y2ggKm1rX2ltcCh8cmVzb2x2ZV9yZXN1bHR8IHJlc29sdmVfcmVzdWx0LnRyYW5zZm9ybWVkX3Rlcm0gZm4gbWtfaW1wb3J0PFI+KAogICAgICAgIHZtX2N0eHQ6ICZtdXQgVm1Db3JvbSgidHdvIiksIFN0cmluZzo6ZnJvbSgiMSArIDEiKSk7CiAgICB2bV9jdHh0CiAgZXNzKCJCb29sIikpLAogICAgICAgIGV2YWxfbm9faW1wb3J0KGJvb2xlYW4pCiAgcG9ydChudW0pCiAgICApOwoKICAgIGxldCBib29sZWFuID0gbWtib29sX2ZhbHNlKCksCiAgICApOwogICAgYXNzZXJ0X2VxIShPayhOaWNrXQpmbiBvbmx5X2Z1bl9hcmVfYXBwbGljYWJsZSgpIGV0IGR1bW15ID0gTGFiZWw6OmR1bW15KCk7CiAgICBsZXQgcmVzID0gZXZmcm9tKDQ1LjMpLnVud3JhcCgpKTsKICAgIGFzc2VydF9lcSEoT2sobnVtLmNsb1RhYmxlOjpuZXcoKSwgcykKfQoKLy8vIFNhbWUgYXMgW3BhcnNlXSwgYnV0IHdocnRlciB7fSkKfQoKLy8vIENyZWF0ZXMgYW4gbm9uLXVud2luZGluZyBtYWNoaW5lIHduaW1hbCBWTSBjb250ZXh0IGZvciB0ZXN0IHB1cnBvc2UuCmZuIHZtX2N0eHQoKSAtLTAuMjI5XzA0Nl8yMzRfMDM2XzM3N183LAogIHQiOiAxMzU2LAogICAgICAgICAgICAgICAgICAgICJhc2NlbnQiOiAxODI1LAogICAgICJ0aW1lc05ld1JvbWFuIjogewp1c3Q6IDEuMDc0XzAxNF80ODFfMDk0XzEyNwogICAgbnQiOiAxODU0LAogICAgICAgICAgICAgICAgICAgICJkZXNjZW50IjogLTQzNCwKICBlZ29yeSI6ICJzYW5zLXNlcmlmIiwKIGVyOjp7Rm9udEFkanVzdG1lbnQsIEZvbnRNZXRyaWNzTWFwfTsKICB3aWR0aDsKCiAgICAgICAgbGV0IGFzY2VudCA9IG1ldHJpY3MuYXNjZW50IGFzc19tYXAuMC5nZXQoJmZhbGxiYWNrLmNhcHNpemVfa2V5KS51bndiYWNrX25hbWUucmV0YWluKHxjfCAhYy5pc193aGl0ZXNwYWNlKCkpOyAgLmVudW1lcmF0ZSgpCiAgICAgICAgICAgICAgICAubWFwKHwoaSwgZm9udG5ldyhyIig/Ol5cd3xbQS1aXXxcYlx3KSIpLnVud3JhcCgpKTsKCi8vIEZyb20gaHR0ciBmb250IGB7fWAiLAogICBFcnIoXykgPT4gewogICAgICAgICAgICAgICAgICAgIE5leHRGb250SXNzdWUgICAgICZvcHRpb25zLmZvbnRfZmFtaWx5LAogICAgICAgICAgICAgICAgJm1ldHJpb21lKGZhbGxiYWNrKSA9PiBGb250RmFsbGJhY2s6Ok1hbnVhbChmYWxsYmFjay5jbGFsdWUpXQpzdHJ1Y3QgRmFsbGJhY2sgewogICAgcHViIGZvbnRfZmFtaWx5OiBSY250OiBpMzIsCiAgICBsaW5lX2dhcDogdTMyLAogICAgdW5pdHNfcGVyX2VtOiB1M29udDo6ewogICAgICAgIGZvbnRfZmFsbGJhY2s6OnsKICAgICAgICAgICAgQXV0b3VyZTsKfQoKaW1wbDxUPiBJbnRvVHJhaXRSZWYgZm9yIFZjPFQ+dHVyZS1saWtlIHNlbWFudGljcyBhcyB2YWx1ZSB2Y3Mgd2hlbiBpdCBjb21lcyB0cmFpdCBgVGAuCiAgICBwdWIgZm4gY2VsbCh0cmFpdF9yZWY6IFRyYWl0UmVmPFQ+KSAgbmV3KHNoYXJlZF9yZWZlcmVuY2U6IFR5cGVkU2hhcmVkUmVmZXJlbmNlKSAtPmVuY2UucmVmZXJlbmNlLjAuYXNfcHRyKCkgYXMgKmNvbnN0ICgpLAp0UmVmPEJveDxVPj4Kd2hlcmUKICAgIEJveDxVPjogVmNWYWx1ZVRyYWl0PFZhbHVuY2UgPT0gb3RoZXIuc2hhcmVkX3JlZmVyZW5jZQpmPFQ+YCBpcyBieSBwYXNzaW5nCi8vLyBpdCBhcm91bmQgb3IgdHVybmluZyBpdCBiYWljISgiZXJyb3I6OnJlcG9ydF93aXRoKCk6IGNvdWxkIG5vdCBwcmlhdDo6VG9tbCA9PiB0b21sOjp0b19zdHJpbmcoJkRpYWdub3N0aWNzV3JhcHBlcjo6ZnRpY3MgPSBlcnJvci5pbnRvX2RpYWdub3N0aWNzKGZpbGVzKTsKIGljZTo6TmV2ZXIgewogICAgICAgIG5vX2NvbG9yID0gTm9Db2xvcjo6bnR1cm4gaXQuCnB1YiBmbiByZXBvcnRfYXNfc3RyPGVudHMKLy8vCi8vLyAtIGBjYWNoZWAgaXMgdGhlIGZpbGUgY2FjaGUgdXNlZCBkdXJPcHQsCikgewogICAgdXNlIHN0ZDo6aW86OntJc1Rlcm1pbmFsLCBzdGRlcnJ9OwoKcl9vcHQ6IENvbG9yT3B0LCBpc190ZXJtaW5hbDogYm9vbCkgLT4gQ29sb0Zyb208VmVjPERpYWdub3N0aWM8RmlsZUlkPj4+IGZvciBEaWFnbm9zdGljc1dyYXBwCi8vISBFcnJvciBkaWFnbm9zdGljcyByZXBvcnRpbmcgYW5kIHNlcml0b3IoKS51bndyYXAoKSk7CiAgICAgICAgT2soVmM6OmNlbGwobG9jay4wKSkKICBub25lIiwgY2VsbCA9ICJuZXciLCBlcSA9ICJtYW51YWwiKV0Kc3RydWN0IENvdW50PywgMik7CiAgICAgICAgYXNzZXJ0X2VxISgqbG9jYWxhbHVlYAogICAgICAgIC8vIGF0IHRoZSB0aW1lIGl0IHdhcyB0dXJuZWQgaWl0PywgMCk7CgogICAgICAgIGNvdW50ZXIuYXdhaXQ/LmluY3IoKTsKbmV3KCgwLCBEZWZhdWx0OjpkZWZhdWx0KCkpKSxldCwgbWVtOjp0YWtlLCBzeW5jOjpNdXRleH07Cgp1biBPayhjb21wdXRlKCppbnB1dCwgKmlucHV0MiwgaW5uZXJuZXNzIC0gMSkpOwp1dGUyKHtpbm5lcm5lc3N9KSIpOwogICAgaWYgaW5uZXJuZXNzID4gMHB1dDogUmVzb2x2ZWRWYzxDaGFuZ2luZ0lucHV0PiwKICAgIGlucHV0MjogUmVldygxKSwKIGxlLCAiOTkiKTsKIG5ldygxKS5yZXNvbHZlKCkuYXdhaXQ/OwogICAgICAgIGxldCBpbnB1dDIgPSBDaGFuYmFjaykuYXdhKENvbnRlbnRTb3VyY2VDb250ZW50Ojpub3RfZm91bmQoKSkKdGVudC5nZXQoUmNTdHI6OmRlZmF1bHQoKSwgZGF0YSkpOwogLmdldF9jb250ZW50LnZhcnkoKQogIG1hcF9nZXRfY29udGVudCgKICAubWVyZ2UoKSkKb3VyY2UKICAgICAgICAgICAgICAgIC5nZXRfcm91dGVzKCkKZXQgaW5uZXJfdHJlZXMgPSBzZWxmLnJvdXRlcy5pdGVyKCkubWFwKHwocGF0aDxWYzxSb3V0ZVRyZWU+PiB7CiAgICAgICAgbGV0IHByZWZpeCA9ICYqc2VsZi5wcmVmKHxyfCByLjEpCiAgICAgICAgICAgIC5jaGFpbihzdGQ6Oml0ZXI6Om9uY2UoKmZhbGxwdWIgZmFsbGJhY2s6IFJlc2JlZ2luIHdpdGggdGhlIHByZWZpeCwgd2hpY2ggd2lsbCBiZSBzdHJpcHBlZCAoYWxvb3JlOjppbnRyb3NwZWN0Ojp7SW50cm9zcGVjdGFibGUsIEludHJwdXQpLmF3YWl0PzsKICAgIE9rKFZjOjpjZWxsKHZhbHVlKSkKfTMyPiwKfQoKI1t0dXJib190YXNrczo6ZnVuY3Rpb25dCmFzeW5jIGZuIGNvbXBpdD8sIDIwKTsKCnV0ID0gZ2V0X3N0YXRlKCkucmtzOjp7U3RhdHIgUmF3T3V0cHV0IHt9CgovIEEgbW9kdWxlIHdoZXJlIHNvdXJjZSBjb2RlIGRvZXNuJ3QgbnMgZXhhY3QsIHNwYWNlcyBhcmUgb2theSwgc2luY2Ugd2UgcHJlc3VtZSByYWxzLgogICAgICAgIGxldCBzID0gZShyImFiYmF8YWtrYXxhYmNjYmEiKTsKIFRoaXMgZ2V0cyBhIGNvbW1vbiBwcmVmaXggdGhhdCBpc24ndCB0b28gc2hvcnQuCiAgciIoPzopezY0fXs2NH17NjR9ezY0fXs2NH17NjR9IikpO2UociJhLnoiKSk7W0koIjEiKV0pLCBlKHIiMVtBLVpdIikpOyhyIig/cykuIikpOwpyaWx5IHRydWUsIHRoZQogICAgLy8gb3Zlci1lc3RpbWF0aW9uIGlzIGp1c3QgZmluZS8vIGRldGVjdGlvbiwgdXN1YWxseSBiZWNhdXNlIGl0IHdvdWxkIGJsb3cgc29tZXkgYXJlLiBXaGljaCBpbiB0aGlzIGNhc2UsIGZvciBzb21lIG9mIHRoZSB0ZXN0cwphbmQgZGlzYWJsZSBvcHRpbWl6YXRpb25zLCB0aGlzIHdpbmRzIHVwIGJlaW5nIG9rYSAgIGV4YWN0KFsiYWJlZiIsICJhYmdoIiwgImNkZWYiLCAiY2RnaCJdKSwKIChyImF8KD86YnxjKikiKSk7WyJhYmNtbm94eXoiXSksIGUociJhYmMoKW1ubygpeHl6IiksICJiYmIiXSk7CiAgICAgICAgYXNzZXJ0X2VxIShleHBlY3RlZCwgZShyIlthYl17M0koImFiIiksIEUoImFjIildKSwgZShyImFiKmMiKSk7LCBFKCJjIildKSwgZShyIihhK3wpKGIrfCljIikpOwogICAgICAgIC8vIEEgZmV3IChyImFaKz9iIikpOwoKICAgICAgICBhc3NlcnRfZXEhKGV4YWN0KFsiYVpaYiJdKVsiYWIiLCAiYVpiIl0pLCBlKHIiYVo/P2IiKSkociJhYlxCIikpOwoociIoP206XilhYiIpdChbIs60IiwgIs61Il0pLCBlKCJbzrXOtF0iKSk7CmN0KFsiUyIsICJzIiwgIsW/Il0pLCBlKCIoP2kpxb8iKSk7CmN0KFsi4piD4piD4piD4piD4piDIl0pLCBlKCLimIPimIPimIPimIPimIMiKSk7CiAgc2VxKFtJKCJhYmMiKSwgSSgiZGVmIiksIEkoImdoaSIpXSkKICAgb2Ygb3VyIHN1c3BpY2lvdXMgaGV1cmlzdGljcyB0cnkgdG8gInBpY2sgYmV0dGVyCl1mb28pKFthLXpdZm9vKVthLXpdIiksIHNlcShbSSgiZm9vIildKSlleGFjdDxCOiBBc1JlZjxbdThdPiwgSTogSW50b0l0ZXJhdG9yPEl0ZW0gPSBCPj4oaWVybiA9IHBhdHRlcm4uYXNfcmVmKCk7CiAgICAgICAgbGV0IGhpciA9IHJlZ2V0Y2ggdmVyeQovLy8gZnJlcXVlbnRseSwgYW5kIGlzIHRodXMgbm90IGEgZ29vZCBjYWlmIGxlbjIgPCBsZW4xIHsKICAgICAgICAgICAgcmV0dXJuIHNlcTE7CiAgdGhleSB3b3VsZG4ndAogICAgICAgIC8vIGhhdmUgYSBtaW5pbXVtIGxpdGVsZXQgKG11dCBzZXExLCBtdXQgc2VxMikgPSAoc2VsZShtaW4pID0gc2VsZi5taW5fbGl0ZXJhbF9sZW4oKSBlbHNlIHsgcmF2ZSBzb21lIHZlcnkgc2hvcnQgbGl0ZXJhbHMsIHRoZW4gbGV0J3MgcmVxYSBzdWZmaXggb2YgYW5vdGhlciBzZXF1ZW5jZS4KICAgIGZuIG1ha2Vfbm90X3ByZWFzICJub3QgYSBwcmVmaXguIiBXaGVuIHRoaXMgaGFwcGVucywgdHEuaXNfZXhhY3QoKQogICAgfQoKICAgIGZuIGlzX2luZXhhY3QoJnNlbXV0IFRTZXEpIHsKICAgICAgICBzZWxmLnNlcS51bmlvbigmbXV0IG90aGlvbjwmW0xpdGVyYWxdPiB7CiAgICAgICAgc2VsZi5zZXEubGl0ZXJhbHMoKQogaXZlbiBzZXF1ZW5jZS4gSWYgbm9uZSBvZiB0aGUKICAgIC8vLyBsaXRlcmFscyBpbiAgc2VxMi5rZWVwX2ZpcnN0X2J5dGVzKDQpOwogICAgICAgICAgICBzZXExLmRlZHViZSBhIHR1bmVhYmxlIHBhcmFtZXRlciwgYnV0IGl0IHNlZW1zIGEgbGl0dGxlIHRyaWVyYWxzLiBUaGUgaWRlYSBpcyB0aGF0IHdlJ2QgcmF0aGVyIHRyaW0gZG93bgogICBpdGggYHNlcTFgLgogICAgZm4gdW5pb24oJnNlbGYsIG11dCBzZXExOiBUU2VxLCBzcHV0ZSB0aGUgY3Jvc3MgcHJvZHVjdCBvZiB0aGUgdHdvIHNlcXVlbmNlcyBpZiB0ICs9IHIubGVuaW1pdHMKICAgIC8vLyBvbiB0aGlzIGV4dHJhY3Rvci4KICAgIGZuIGNsYWltaXRfYnl0ZXMoY2xzKSB7CiAgICAgICAgICAgIHJldHVybiBUU2VxLy8gc2VxdWVuY2UuCiAgICBmbiBleHRyYWN0X2NsYXNzX3VuaWNvZGUoJnNlIDAuLnN0ZDo6Y21wOjptaW4obWVxLCBzdWJzZXEuY2xtZW06OnN3YXAoJm11dCBzdWJzZXEsICZtdXQgZW1wdHkpOwogICAgaGlyOjpSZXBldGl0aW9uIHsgbWluOiAwLCBtYXgsIGdyZWVkeSwgLi54YWN0JyB2cyAnZXhhY3QnCiAgICAvLy8gYXR0cmlidXRlcyBjb3JyZWN0IG9uIGVhY2N0KGEpXQogICAgLy8vICAgJ2F7M30nICA9PiBbZXhhY3QoYWFhKV0KIC8vIEV4dHJhY3QgYSBzZXF1ZW5jZSBmcm9tIHRoZSBnaXZlbiBhbHRldikgPT4gcHJldi5jaG9vc2Uoc2VxKSwKYWxzbyBpbmNsdWRlcwogICAgICAgICAgICAvLyBpbmZpbml0ZSBzZXF1ZW5jZXMuCiBkdWN0IHdpbGwgYWx3YXlzIGJlIGEgbm8tb3AuIFRodXMsIHRoZXJlIGlzIG5vdGhpbmlvbi4gU2VxdWVuY2VzIGZyb20gZWFjaCBvZgogICAgLy8vIHRoZSBjaGlsZCBISVJoaXI6OkhpcktpbmQ6Oio7CgogICAgICAgIG1hdGNoICpoaXIua2luIGJlIHNsb3ciCiAgICAgICAgICAgICk7CiAgICAgICAgICAgIHNlcS5tYWtlX2luZmN0b3IgYXQgdGhlIHRvcC1sZXZlbCBhbmQgcmV0dXJuIGFuIHVudGFnZ2VkIHNlcXVtX2hpcigmaGlyKQogICAgICAgICAgICAubWFwX2VycihFcnJvcjo6cmVnZXgpPzsKIHV0IGFsdHMgPSB2ZWMhW107CiAgICAgICAgZm9yIGxpdCBpbiBsaXRzLml0Ly8vIGdlbmVyYXRlZCB0aGVzZSBsaXRlcmFsIHNldHMuIFRoZSBpZGVhIGhlcmVnZ2VkKGNoaXIuaGlyKCkpOwogICAgICAgIElubmVyTGl0ZXJhbHMgeyBzZXEgfQogIG5nIHJlZ2V4IGlzIGJlbGlldmVkIHRvIGFscmVhZHkgYmUgYWNjZWxlcmF0ZWQiLAp3b3JkIGJvdW5kYXJpZXMuCiAgICAgICAgLy8gSWYgaXQgZG9lcywgdGhlcmUncyBlbiAgICJza2lwcGluZyBpbm5lciBsaXRlcmFsIGV4dHJhY3Rpb24sIFwKIHRvciB3YXMgY29uZmlndXJlZCwgdGhlbiB0aGlzIGFsd2F5cyBkZWNsaW5lcyB0b3VsYXIgaXMgd2hhdCBpbmhpYml0cyB0aGUgcmVnZXggZW5naW5lJ3Mgb3duIGlvbiB3YXMgZmFyIG1vcmUgaW1wb3J0YW50IGluIHRoZSBvbGQgZGF5cywgYnV0IHNpZ3JlcCBzZWFyY2hlcyBpbmRpdmlkdWFscyBsaW5lcyBhbmQgbm90IGFjcm9zcyBsaW5lbGYsIEhpciwKICAgICAgICBsaXRlcmFsOjp7TGl0ZXJhbCwgU2VxfSwKICAgICAgbnVtYmVyLnN0b3JlKDQyLCBPcmRlcmluZzo6U2VxQ3N0KTsKc3RfZ2V0X2NvbnRlbnRfZm4oKSB7CiAgICAgICAgbGV0IHR0ID0gVHVyYiBBcmMsCiAgICAgICAgYXRvbWljOjp7QXRvbWljSTMyLCBPcmRlcmluZ30sCiAgbiBzdGFnZSgmc2VsZikgLT4gVmM8SXNzdWVTdGFnZT4gewplbnVtIFVwZGF0ZVN0cmVhbUl0ZW0gewogICAgTm90Rm91bmQsCiAgICBGb3VuZGx0PFJlYWRSZWY8VXBkYXRlU3RyZWFtSXRlbT4+OwoKICAgIGZuIHBvbGxfbmV4dCgKIFByb3BhZ2F0ZSBvdGhlciB1cGRhdGVzCiAgZWN0KCJmYWlsZWQgdG8gdXBkYXRlIHZlcnNpb24iKTsKCiAgT2soVXBkYXRlU3RyZWFtSXRlbTo6Rm91bmQgeyB1cGRhdGUsIC4uIHVuZCB7IGlzc3VlcywgLi4gfSkgPSBpdGVtLmFzX2RfID0+IFZjOjp1cGNhc3QoTm90Rm91bmRWZXJzaW9uOjpuZXcoKSksCmVudC5jYWxsKCk7CiAgICAgICAgLy8gV2UgY2FuIGlnbm9yZSBpc3N1ZXMgcmVwb2VtID0gZ2V0X3VwZGF0ZV9zdHJlYW1faXRlbV9vcGVyYXRpb24ocmVzb3VyY2UsIGZyYXNlKSBpZiB3ZSBoYWQgc29tZSB3YXkgb2Ygd3JhcHBpbmcgYXJiaXRyYXJ5CiByaXZlKFRyYWNlUmF3VmNzKV0Kc3QvLyBDbGllbnQgcmVxdWVzdGVkIGEgbm9uLWV4aXN0aW5nIGFzc2U6Tm9uZS5jZWxsKCkuYXdmcm9tKS5hd2FpdD8KICAgICAgICAgICAgICAgICYmIGZyb20uYXdhaXQ/ID09IHByb3RlX29wID0gdmVyc2lvbmVkX2NvbnRlbnRfdXBkYXRlX29wZXJhdGlvbihyZXNvaXMgY2FuIGhhcHBlbiB3aGVuIGEgY2h1bmsgaXMgcmVtb3ZlZCBmYXRlOiB1cGRhdGUuYXdhaXQ/LAogICAgICAgICAgICAgICAgaXNzdWVzOiBwbGFpICBwbGFpbl9pc3N1ZXMucHVzbnQ6IFRyYW5zaWVudEluc3RhbmNlPEdldENvbnRlbnRGbj4sCikgZygpKS5hd2FpdAp9CgpmbiBleHRlbmRfaXNzdWVzKGlzc3VlczogJm9uVmM8VD4pIC0+IFJlc3VsdDxWZWM8UmVhZFJlZjxQbGFpbklzc3VlPj4+IHt1cmUgKGUuZy4gbW92ZWQgdmFsdWVzIGluIGEgY2xvc3VyZSkgYW5kIGZ1bmVsZi5mdW5jKSgmc2VsZi5jYXB0dXJlKQogIGFsdWVgLCBgZnVuY2Agc3RvcmVzIG5vIGRhdGEgKGlzIGEgc3RhdGljIHBvaW4gICBDb2xsZWN0aWJsZUlzc3Vlc0V4dCwgSXNzdWUsIElzc3VlRmlsdGVyLCBJc3N0aW9uCik7CmNyaXRlcmlvbl9tYWluIShiZW5jaGVzKTsKdXNlIHN0ZDo6cGluOjo7Cn0KCmNyaXRlcmlvbl9ncm91cCEoCiAgICBuYW1lID0gYmVuY2hlczsKIHRpb24oYzogJm11dCBDcml0ZXJpb24pIHsKIG4gPSBtLmVuZChzKTsKICAgICBiLnRvX2FzeW5jKFJ1bnRpbWU6Om5ldygpLnVubmV3KEV2ZW50OjpuZXcofHwgfHwgInRlc3QgZXZlbnQiLnRvX2Vfd2F0Y2hpbmciLCAiY2hhbmdlIGZpbGUiKSwKICAgICAgICBtb3ZlIHxifCB7CiBlbnQ6OntNZWFzdXJlbWVudCwgV2FsbFRpbWV9LAp9Owp1c2Ugbm90aWZ5Ojp7Q29jZWxsKCp2YWx1ZS4wLmF3YWl0PykpCn0KCi8vLyBIYXMgYW4gaW50ZW50aW9uYWNlbGwodTY0Ojpmcm9tKCphcmcxLmF3YWl0PykgKyB1NjQ6OmZyb20oKmFyZzIuYXdhYWRfaW5jb3JyZWN0X3Rhc2tfaW5wdXRfb3BlcmF0aW9uKEluY29yeXBlIHR1cmJvLXRhc2tzQHR1cmJvX3Rhc2tzOjpwcmltaXRpdmVzOjooKSkKICBhcmdfb25jZV93aXRob3V0X2NhY2hlX2NoZWNrfTsKCnN0bGU6IFN0eWxlZFN0cmluZzo6TGluZSh2ZWMhZ2V4OjpuZXcoIl4oc3JjLyk/X2RvY3VtZW50XFwuW14vXSskIikudW5SY1N0cl0gZm9yIFtTdHJpbmddIHVuaXF1ZWx5IGlkZW50aWZ5aW5nIGUgYSBzY29wZWQgY2xhc3NuYW1lIGZvciB0aGUgbWFpbiBmb250IG9yIGl0cyBmYWxsc3BsYXllZCBhcyA2LSBvciA4LWNoYXJhY3RlcgogICAgLy8gaGV4YWRlY2ltYWwgdmEvIEEgaGFzaCBvZiB0aGUgcmVxdWVzdGVkIHF1ZXJ5bWFwIGRlcml2ZWQgZnJvbSBob0lzc3VlOwoKLy8vIENTUyBwcm9wZXJ0aWVzIGFuZCB2YWxmb3Jfc3lzdGVtKS51bndyYXAoKTsKICAgICAgICBwcmludGxuISgie30iLCBsYXRlZXIsICZsYXRlc3RfZm9yX3NoYSkudW53cl9zaGFfcGF0aCA9IGRhdGFfZmlsZXMKICAgICAgICAgICAgICAgIC5maXJzdHMgPSBEYXRlVGltZTo6PFV0Yz46OmZyb20odHMpOyBmb3Iga2V5IGluIGFsbF9iZW5jaG1hcmtfa2V5cyB7CiBsZXQgYmFzZWxpbmUgPSAmc2hhWy4uN107CiAgICAgICAgICAgIGxldCBtdXQgbGF0ZXRoLnBhcmVudCgpLnVud3JhcCgpLmpvaW4oIm5vcm1hbGl6ZWQuanNvbiIpOwogbWF0ZSAqPSBmOwogICAgICAgICAgICAgICAgICAgICAgICBzLnN0YW5kYXJkX2Vycm8gICAqc3VtICs9IGNvcnJlY3Rpb247CiAgICAgICAgICAgICAgICAgICAgKmNvdW4gICAuc3VtOjo8ZjY0PigpCiAgICAgICAgICAgICAgICAgICAgLyBsaXN0YW1lLCBiZW5jaCkgaW4gZGF0YS5iZW5jaG1hcmtzLml0aWxlOjpvcGVuKCZkYXRhX2ZpbGUucGF0aCkudW53ZW1zOiAmbXV0IFZlYzxCZW5jaERhdGFGaWxlPiA9CiB5IGluIFdhbGtEaXI6Om5ldygmcGF0dGFtcDogdGltZXN0YW1wLnBhcnNlKCkubWFwX2Vycih8X3wgInVuYWJyID0gJidzdGF0aWMgc3RyOwoKICAgIGZuIHRyeV9mcm9tKHBhdGg6ICYnYSBQYXRoKWhvdzo6Q29udGV4dDsKdXNlIGNocm9ubzo6e0RhdGVUaW1lLCBVdGN9Owp1fSk/OwogICAgICAgICAgICAgICAgcmV0dXJuIE9rKFRlbXBEaXIocGF0aCkpOwpudjo6dGVtcF9kaXIoKTsKICAgICAgICAgICAgZm9yIF8gaW4gMC4uVFJJRVMgewogIC8vLyBhdXRvbWF0aWNhbGx5IGRlbGV0ZWQgd2hlbiBpdCdzIGRyb3BwZWQuCiBlbmllbnQgcmVzdWx0IHR5cGUgYWxpYXMuCiAgICBwdWIoY3JhdGUpIHR5cGUgUmVzdW5vcmUoZih0KSksCiAgICAgICAgICAgIE1hdGNoOjpXaGl0ZWxpc3QodCkgPW5vcmUodCkgPT4gTWF0Y2g6OldoaXRlbGlzdCh0KSwKIC8gSW52ZXJ0cyB0aGUgbWF0Y2ggc28gdGhhdCBgSWdub3JlYCBiICAgIElnbm9yZShUKSwKICAgIC8vLyBUaGUgaGlnaGVzdCBwcmVjZWRlbnQgZ2xvYnlwZSB0aGF0IHByb3ZpZGVzIG1vcmUKLy8vIGluZm9ybWF0aW9uIGFib3V0IGEgaW50b19lcnJvcl9vcHRpb24obXV0IHNlbGYpIC0+IE9wdGlvbjxFcnJvIGZuIHB1c2goJm11dCBzZWxmLCBlcnI6IEVycm9yKSB7CiAgICAgICAgc2VsZi4wLnBsb2I6IE5vbmUsIHJlZiBlcnIgfSA9PiB3cml0ZSEoZiwgInt9IiwgZXJyKSwgICAge30gcG9pbnRzIHRvIGFuIGFuY2VzdG9yIHt9IixUeXBlKF8pID0+ICJ1bnJlY29nbml6ZWQgZmlsZSB0eXBlIiwKICBlcnIuZGVzY3JpcHRpb24oKSwKICAgICAgICAgICAgRXJyb3I6Okdsb2IgeyByZW5ldyhpZ19lcnIpIH07CiAgICAgICAgfQogICAgICAgIGlnX2VycgogICB0aDogUCwgbGluZW5vOiB1NjQpIC0+IEVycm9yIHsKICAgICAgICBsZXQgZXJybGluZXJvciBpbnRvIGEgdGFnZ2VkIGVycm9yIHdpdGggdGhlIGdpdmVuIGRlcHRoLgogbnMgYSBkZXB0aCBhc3NvY2lhdGVkIHdpdGggcmVjdXJzaXZlbHkgd2Fsazo6SW8oZXJyKXJgXTogaHR0cHM6Ly9kb2MucnVzdC1sYW5nLm9yZy9zdGFibGUvc3RkL2lvL3N0cnVjWzBdLmlvX2Vycm9yKCkKIC9zdGQvY29udmVydC90cmFpdC5Gcm9tLmh0bWwKICAgIC8vLyBbYEVyb3JgXSBhbmQgaXMgX25vdF8gdGhlIHNhbWUgYXMKICAgIC8vLyA+IFtgaW1wbCBzZSBhIGN5Y2xlIHdhcyBmb3VuZCBpbiB0aGUgZGlyZWN0b3J5IHRyZWUgd2hpbGUKIGlzIGV4Y2x1c2l2ZWx5IGFuIEkvTyBlcnJvci4KICAgIHB1YiBmbiBpc19pbygmc2VsZWQgd2hpbGUgb3RoZXJzCiAgICAvLy8gbWF5IGhhdmUgc3VjY2VlZGVkLiBGb3Jsb2I6IGdsb2IuY2xvbmVzdG9yLmNsb25lKCksCiAgICAgICAgICAgICAgICBjaGlsZDogY2hpbGQuY2xveXBlIGRlZmluaXRpb24gY291bGQgbm90IGJlIHBhcnNlZC4KICAgIEludmFsb2IgcHJvdmlkZWQgYnkgYW4gZW5kIHVzZXIuCiAgICAgICAgLy8vIGUuZy4sIEl0b2luZyBJL08sIHN1Y2ggYXMgcmVhZGluZyBhbiBpZ25vcmUgZmlsZS4KICAgIElvKHNhIHBhcnRpY3VsYXIgZGlyZWN0b3J5IGRlcHRoIHdoZW4gcmVjdSBtb2QgZ2l0aWdub3JlOwpwdWIgbW9kIG92ZXJyaWRlczsKbW9kIHBhdGh1dGlsOwpwaWxkKCkgewogICAgcHJpbnRsbiEoIns6P30iLCByZXN1bHQpOwp9CmBgYAoKU2VlIHR0b3J5IGVudHJ5IG9yIGFuCiAgICAvLyBlcnJvciwgc28gZWl0aGVyIHByaW50IHRoIGZvcgpgV2Fsa0J1aWxkZXJgLgoKU2Vjb25kYXJpbHksIHRoaXMgY3JhdGUgZXhwbGRzLCBTb21lKGludGYpIGlmICFpbnRmLmZpZWxkcy5pc19lbXB0eSgpKQpuIGlzX2lucHV0KCZzZWxmKSAtPiBib29sIHsKICAgICAgICAhc2VsZi5pc19kZWJlIG1hZGUKICAgIC8vLyBmaXJzdC1jbGFzcyAoW3JlbGF0ZWQgaXNzdWVdKGh0dGVuY2UgcG9pbnQgb2Ygdmlldywgd2Ugd2FudCB0byBtYWtlIGEgY2xlYXIgZGlzdGRSb3dGPCZUeXBlPj4gZm9yIEZpZWxkSW50ZXJmYWNlIHsKICAgIGZuIGZyb20ocnJvcm9tX2NvbnRyYWN0cyA9IGZpZWxkCiAgICAgICAgICAgIC5tZXRhbGQgaW5mb3JtYXRpb24gZnJvbSBhbGwgdGhlIHNvdXJjZXMgd2UgY2FuOiBzdGF0Zm9yIFJ1bnRpbWVDb250cmFjdCB7CiAgICBmbiBleHRyYWN0X2ludGVyZmFjZSgmc2YudHlwIHsKICAgICAgICAgICAgVHlwZUY6OlJlY29yZChycm93cykgPT5tcHR5ID0+IFZhbHVlSW50ZXJmYWNlIHsKICAgICAgICAgICAgICAgIGZpZWxkczogSHJvbTwmTmlja2VsVmFsdWU+IGZvciBWYWx1bmx5IHRvIHNob3cgYSBkZWZhbGRzOiBDb21iaW5lOjpjb21iaW5lKGZpcnN0LnN1YmZpZWxkcywgc2Vjb25kLnN1YmZlbGQsIGlmIGl0J3MgYSByZWNvcmQgaXRzZWxmLgogICAgcHViKHN1cGVyKSBzdWJmcmUgYWNjZXNzaWJsZSBmcm9tIHRoZSByb290IHRlcm0gdG9nZXRoZXIgd2l0cml2ZSB0aGUKLy8hIGN1c3RvbWl6ZSBtb2RlIG9mIHRoZSBjb21tYW5kLWxpbmUuCnVnZXQ6IFZjPExpbmtDb250ZW50PiwKICAgICkgLT4gUmVzdWx0PFZjPCgpPj4gewphaXQ/LndyaXRlKGNvbnRlbnQpKWhpcy5yb290X2ZzLnJvb3QoKS5hd2FpdD8uam9pbigmcGF0aC5hdGguZnMgIT0gc2VsZl9mcyB7CiAgICAgICAgICAgIGxldCBzZWxmX2ZzX3MvIG9uIHRoZSBbQXR0YWNoZWRGaWxlU3lzdGVtXQogICBpbGQgZnMiLAogICAgICAgICAgICAgICAgY29udGFpbmVkX3BhdGgudmFsdWVfdG9fc3RlbSwganVzdCBuZWVkIHRvIHJlYmFzZSBvbiB0aGlzIGZpbGVzeXN0ZW0KICBpdmVuIFtGaWxlU3lzdGVtUGF0aF0gdG8gYSBwYXRoIGluIHRoaXMgW0ZpbGxkX2ZzOiBSZXNvbHZlZFZjPEJveDxkeW4gRmlsZVN5c3RlbT4+LAp9c3RlbV0uCi8vLwovLy8gQ2F2ZWF0OiBUaGUgYGNoaWxkX3BhdGhgIGl0c2VsZiBpcyAgICAoJHR5OnR5KSA9PiB7CiAgICAgICAgaW1wbDwnYXN0PiBUeXBlRXE8J2FzdC8vIERlcml2ZSBhIFtUeXBlRXFdIGltcCAgICAoVW5pZlR5cGU6OlVuaWZWYXIgeyBpZDogaWQxLCAuLiAgIFZhcktpbmQ6OkVudW1Sb3dzIHsgLmJvZHkyID0gYm9keTIuY2xvbmtpbmQyLAogICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9keTogYm9keTIsCiByYWN0KCh0MSwgZW52MSkpLCBUeXBlRjo6Q29udHJhY3QoKHQyLCBlbnYyKSkpID0gICYmIHQxLnR5cGVfZXFfYm91bmRlZCh0Miwgc3R0cnMxLAogIGNoIChzMSwgczIpIHsKYmVlbiBpbnRyb2R1Y2VkIGJ5IGB0eXBlX2VxX2JvdW5kZWRgIGl0c2VsZi4gVGhpdmVseSBvbiB1bmlmaWFibGUKICAgIC8vLyB0eXBlIGRvZXNuJ3QgbWFraGVyLm1ldGFkYXRhLCBzdGEmJiBpbmNsdWRlc19zZWxmX3NvcnRlZCA9PSBpbmNsdWRlc19vdCAgIHNvcnRfZmllbGRfZGVmcygmbXV0IHNvcnRlZF9vdGhlcik7CgplbnQ6OmlkZW50KQogICAgICAgICAgICAgICAgICAgICAgICAgICAgLm1hcChGYXN0T2ZuIHNvcnRfZmllbGRfZGVmczwnYXN0PihmaWVsZF9kZWZzOiAmbXV0IFsmJ2FzdCBGbXBhcmUKICAgICAgICAvLyBzdGF0aWMgZmlpdHkgPT0gb3RoZXIucHJpb29yIEFubm90YXRpb248J2FzdD4gewogICAgZm4gdHlwZV9lcV9ib3VuZGVkKAogZFJvd3NFZGVkKCZtYXBfbz4+ID0gcykgPT0gb3RoZXIubGV0eXBlKG90aGVyLmNsb25lKCksIGVudjIpOwogZSB3ZSBuZWVkIHRvIGluc3RhbnRpYXRlIGBmb3JhbGxzYCB3aXRoIHJpZ2k9IGlkMiAmJiBhcmdzMS50eXBlX2VxX2JvdW5kZWQoYXJnczIsIHMgICYmIGlubmVyMS50eXBlX2VxX2JvdW5kZWQoaW5uZXIyLCBzdCAgLy8gUXVlc3Rpb25zOgogIHJyYXkoZWx0czIpKSA9PiB7CiAgICAgICAgICAgICAgICBlbHRzMS50eSAoXywgTm9kZTo6VmFyKGlkKSkgPT5uZGxlIGNvLXJlY3Vyc2l2ZSBjb250cmFjdHMgc3VjaCBhcyBge0ZvbyA9IEJhciwgQmFyKGlkMikpCiAgICAgICAgICAgICAgICBpZiBlbnYxLjAuZ2V0KCBoZWFkMS50eXBlX2VxX2JvdW5kZWQoaGVhZDIsIHN0LnppcChzY3MyLml0ZXJ1bmtzKHNjczIpKSA9PiB7CiAgICAgICAgICAgICAgICBzY3MxLmxlbnJnMSksIFNvbWUoYXJnMikpID0+IGFyZzEudHlwZV9lcV9ib3VuZGVkKGFyZzIsIHN0Y2ggKCZzZWxmLm5vZGUsICZvdGhlci5ub2RlKSB7ClRlc3QgZm9yIHBoeXNpY2FsIGVxdWFsaXR5IGFzIGJvdGggYW4gbyBmb3IgT3B0aW9uPFQ+Cnd2MjogJlRlcm1FbnY8J2FzdD4sCiAgICApIC0+IGJvb2w7Cn0KCnBlcy4gVGhpcyB0cmFpdCBwcm92aWRlcyB0aGUKLy8vICJpbnRlcm5hbCIgaW1wbGVsZi5nYXMgLT0gMTsKYm9ydCB0aGUgY29tcHV0YXRpb24gYW5kIHJldHVybiBmYWxzZS4KICAgIGdhczogdThpb24gdGFibGUgb3IgdG8gY2FyZSBhYm91dCB0aG9zZSBpZHMgY2xhc2hpbmcgeE1hcCwKICAgIHR5cDo6VmFyS2luZCwKfTsKCi8vLyBUaGUgbWF4aW1hbCBudXRlY3QgdHdvIHZhcmlhYmxlcwovLyEgcG9pbnRpbmcgdG8gdGhlIHNhbWUgY29uaXJzdCAtIHRoZXkgdW5saW5rZWx5IHRvIGFwcGVhciBfaW5saW5lXyBpbiBhCi8vISBuaXRlIGN5Y2xlLiBTdHlsZSwgZ2FzIGlzIGEgc2ltcGxlIHdheQovLyEgdG8gYm91bmUgd2UganVzdCBmb2xsb3dzIHZhcmlhYmxlcywgYW5kIGRvbid0IGFwcGx5IGZ1bkFsaWFzYCB3aXRoIGBGb28gImJhciIgImJheiJgLgovLyEKLy8hIFdlIGFsc28gd2FuaWYgIXVzZV9jYWNoZV90ZWxlbWV0cnlfdHJhY2tlci5pc19lX3N0ZChzZXJkZV9qc29uOjp0b19zdHJpbmcoJmVsaW1pbmF0ZWRfcGFja2FnZXMpPykgLy8gQXZvaWQgdGhlIGV4dHJhIGxpZm8gc2xvdCB0byBhdm9pZCBzdGFsbGluICAubWF4X2Jsb2NraW5nX3RocmVhZHModXNpemU6Ok1BWCAtIHdvcmtuaWM7CiAgICB1c2UgdHVyYm9fdGFza3NfbWFsbG9jOjpUdXJib01hbGxvYzsKCiAgc3RhbnQ+PiA9IGNvbnN0IHsgUmVmQ2VsbDo6bmV3KE5vbmUpIH07Cm9wYWNrOwpwdWIgbW9kIHV0aWw7CgojW2NmZyhub3QoYW55KGZlYXR1cmUgPSAiX19pUk9NLCBPVVQgT0YgT1IKSU4gQ09OTkVDVElPTiBXSVRIIFRIRSBTT0ZUV0FSRSBPUiBIT1VUIFdBUlJBTlRZIE9GCkFOWSBLSU5ELCBFWFBSRVNTIE9SIElNUExJRUQsIElOQ2lnaHQgKGMpIDIwMTcgVGhlIHN3YyBQcm9qZWN0IERldmVsb3BlcnMKClBlcm1pc3NpbGluayhsaW5rKQogICAgfQoKICAgICNbaW5saW5lXQogICAgZm4gcmVzZXQoJm11Q29sb3I+IFdyaXRlQ29sb3IgZm9yIENvdW5lbGYudG90YWxfY291bnQgKyBzZWxmLmNvdW50CiAgbiBvciB0aGUKICAgIC8vLyBsYXN0IHRpbWUgYHJlc2V0YCB3YXMgY2FsbGVkLgogZWYoKS51bndyYXAoKSksCiAgICAgICAgIlBhbmljIGxvY2F0aW9uICd7fScgc2hvdWVydCEoaG9va193YXNfY2FsbGVkLmxvYWQoT3JkZXJpbmc6OlNlcUNzdCkpOwoKbGV0IF9ob29rX2d1YXJkID0gcmVnaXN0ZXJfcGFuaWNfaG9vayh7CiAgdGVzdCBtdXN0IGJlIHJ1biBpbiBpdHMgb3duCi8vIHByb2Nlc3MgaW4gaXNvbGF0aSAgQXJjLCBMYXp5TG9jaywKICAgICAgICBhdG9taVZjPFNldD4+IHsKICAgIGxldCBzdGVwID0gc3RlcC5hd2FpZXJ0IShjX3JlZjMuc2V0KDMpOwoKICAgICAgICBsZXQgYV9yZWYzID0gYS5ldCwgImEiLnRvX3N0cmluZygpKTsKICAgICAgICBsZXQgYiA9IGhhdTMyPiwKICAgIHJhbmRvbTogdTMyYXAoc3RlcDogUmVzb2x2ZWRWYzxTdGVwPikgLT4gUmVzdWx0PFZjPE1hcD4+IHsKU29tZSgzKSk7CiAgICAgICAgYXNzZXJ0X2VxIShiX3JlZjIucmFuZG9tLCBiX3JlbGV0IGNfcmVmMiA9IGMucmVhZGFwID0gY3JlYXRlX21hcChzdGF0ZSk7CiAgICAgICAgbGV0IGEgPSBnZTI+KTsKCiNbdHVyYm9fdGFza3M6OmZ1bmN0aW9uXQpmbiBjcmVhdGVfc3RhZSA9ICJkZWJ1Z19mbl9uYW1lIiwgc2tpcF9hbGwpXQogIHZlYyFbTW9kdWxlUnVsZUVmZmVjdDo6RXh0ZW5kRWNtYXNjcmlwdFRyYW5mb3JtID0gRWNtYXNjcmlwdElucHV0VHJhbnNmb3JtOjpQbHVnaW4oUmVzb2lvbnMpLAogICAgICAgICAgICB0b2xlcmF0ZV9wYXJzaW5nX2Vycm9yczogZm0gYGlucHV0YCwgd3JpdGluZyB0aGUgcmVzdWx0IHRvIGBvdXRwdXRgLgpwdWJvcm1hdEVycm9yKHRvcGlhcnlfY29yZTo6Rm9ybWF0dGVyRXJyb3IgICBzZWNvbmRfY2h1bmsuaW50b19pdGVyKCkubWFwKHxhfCAqYSkuY29sa19pdGVyYXRvcigpIHsKICAgICAgICBsZXQgZGF0YSA9IFsoKTsgMTBdCiAgIGVzdF9pbnRvX2NodW5rc19sZW4uZGF0YVtzZWxmLmluZGV4XS5nZXQoKSkgfTsKZyBpdGVtcwogICAgICAgIHdoaWxlIHNlbGYubmV4dF9pdGVtKCkuaXNFVFk6IFdlIGFyZSB0aGUgb25seSBvd25lciBvZiB0aGlzIGNodW5rIG9mIGRleCA9IGVuZDsKICAgICAgICAgICAgU29tZShpdGVtKQogICAgKHNlbGYuZGF0YS5sZW4oKSAtIHNlbGYuaW5kZXgpLmRpdl9jZWlsKHNlbCBhcmUgU2VuZCBhbmQgU3luYyB0byBhbGxvdyB0byB1c2UgaXQgZm9yCi8vLyBwYXJha2xvYWQgaXMgZXZlbmx5IGRpc3RyaWJ1dGVkIGFjcm9zcyB0aGUgdGhyZWFkcy4KcHVyZTogRiwgd3JhcHBlcjogVykgLT4gU2VsZiB7CiAgICAgICAgU2VsZiB7IHdyYXB2ZXJ5IHBvbGwgY2FsbC4KICAgIHB1YiBzdHJ1Y3QgV3JhcCAgKipzZWxmID09ICoqb3RoZXIKICAgIH0KfQoKaW1wbDxUOiA/U2l6ZWQgKyBQYXJ0ZChiKQogICAgfQp9CgppbXBsPFQ6ICdzdGF0aWM+IEZyb208VD4gZmYsICJ7Yn1CIikKICAgIH0KfQoKLy8vIFNtYXJ0IHBvaTFfMDI0OwogICAgICAgIGNvbnN0IE1COiB1c2l6ZSA9IDFfMDI0ICogS0I7CiAgIHMgPSBzZWxmLjAuYXNfc2VjcygpOwogICAgICAgIGlmIHMgPiAxMDAge2V0IG1zID0gc2VsZi4wLmFzX21pbGxpcygpOwogICAgICAgIGlmIG1zID4gMTAge2tfb3IoRGVjb2RlRXJyb3I6Ok90aGVyKCJleHBlY3RlZCBhdCBsZWFzdCAxIGVycm9vbWUocykgPSBzb3VyY2UgewogICAgICAgICAgICB2LnB1c2gocy50b19zbmVyLCAmb3RoZXIuaW5uZXIpCiAgICB9Cn0KCmltcGwgRXEgZnJyOiAmYW55aG93OjpFcnJvciA9ICZzZWxmLmlubmVyOwogICAgICAgIGVyci5hc19lYWQ6OmF2YWlsYWJsZV9wYXJhbGxlbGlzbSwKICAgIHRpbWU6OkR1cmF0aW9uLAp9O2RleC4KI1tpbmxpbmVdCnB1YihjcmF0ZSkgZm4gY2xvc3VyaXplKHZhbHVlOiBOaWN0aW1lIG1lcmdpbmcKICAgICAgICAvLyBjb2RlOiB3ZSBkb24ndCB1c2UgW2BDb21iaSAgLy8gW2BGaWVsZE1ldGFkYXRhOjpjb21iaW5lYF0gcHJvZHVjZXMgc3ViZGF0YTIgPSBmaWVsZDIubWV0YWRhdGEuaW50b19pbm5lcigpOwoKICBsZW5zMS5yZXN0b3JlKCksCiAgICAgICAgICAgICAgICBsZW5zMi5yZXN0Y2l0eShsZWZ0LmxlbigpICsgY2VudGVyLmxlbigpICsgcmlnaHQubGVubGV0IHJkMSA9IGxlbnMxLnRha2UoKS51bndyYXBfb3JfYWxsb2MoKTsKdWVzLzE0MjcuCi8vLwovLy8gVGhpcyBpcyBhIGhlbHBlciBmb2F0aWMgcmVjb3JkcyAoW2B0ZXJtOjpUZXJtOjpSZWNvcmRgXXMpLCB0aGVpciBtZXJnIHBvcyksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmaWVsZCxzcyA9IGV4cHIKICAgICAgICAgICAgICAgICAgICAgICAgLmFzX3Rlcm0oKQogIHh9IiA9IHRydWV9CiAgICAgICAgICAgICAgICAgICAgLy8gYGBgCiAgICAgICAoRmllbGROYW1lOjpJZGVudChpZCksIGZpZWxkKSA9PmlvbiBkdXJpbmcgcGFyc2luZy4KICAgICAgICAgICAgICAgICAgICBvY2NwZC5pbnNGaWVsZD4sCiAgICAgICAgICAgIGlkOiBMb2NJZXJ0IGEgcmVjb3JkIGRlZmluaXRpb24gdG8gYSBtYWlubGluZSByZWN1ZXJnZShsYWJlbCkgPSAmbXV0IGRhdGEub3AKICAgcnJvciAod2hpY2ggaXQgc2hvdWxkbid0IGFueXdheSBpZiB0aGUgdGVybSBoYXMKICAgZmFsbGlibGUganVzdCBmb3IgdGhpcyBvbmUgc3BlYXRoOiAoKnBhdGgpLnRvX29hcmd8ICgqYXJnKS50b19oaXMgd2hvbGUgbm9kZS4gV2UgZGVsZWdhdGUgdGhpcyB0byB0aGUgY2FsbGVyLCBsdWU6OmFycmF5KGFycmF5LCBWZWM6Om5ldygpLCBwb3NfaWR4KSkKIG9uXTogV2hlbiBjb252ZXJ0aW5nIGZyb20gdGhlIEFTVCwgd2UgbmVlZCB0byBnZW5ldGVybSgKICAgICAgICAgICAgICAgICAgICBUZXJtOjpGdW4odGVybTo6RnVuRGF0YSBsZXQgYnJhbmNoZXMgPSBkYXRhCiAgICAgICAgICAgICAgICAgICAgLmJyYW5jaGVzCnAofGluY2x8IGluY2wudG9fbWlhbnQoCiAgICAgICAgICAgICAgICAqdGFnLAogb2RlOjpFbnVtVmFyaWFudCB7IHRhZywgYXJnOiBOb25lIH0gPSBvZiBuZXN0ZWQgdW5hcnkKICAgICAgICAgICAgICAgIC8vIGFwcGwgICAgfXwgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIChwYXQgIHJlYzogKnJlYywKIGN0Ojo8T3B0aW9uPFNtYWxsVmVjPF8+Pj4oKTsKCmVycy4gSWYgdGhpcyB3b3Jrcywgd2UgY2FuIGVtaXQKIGVybTo6YW5ub3RhdGVkKG1ldGEvIHdoaWNoIGlzIGFjaGlldmVkIGJ5IHRoaXMgaGVscGVyLgogdGVybSh0ZXJtLCBwb3NfdGFibGUucHVzaChhcmcucG9zLmZ1c2UoYm9keV9sZTo6Y29tcGlsZV9mdW5fcGF0dGVybihwb3NfdGFibGUsIGFyZywgYWNjIGJvZHlfcG9zID0gYm9keS5wb3M7CgogICAgICAgICAgICAgICAgLy8gV2UgdHJhdW5rOjpFeHByKGV4cHIsIGluZGVudCk6TnVsbCA9PiBOaWNrZWxWYWx1ZTo6bnVsbCgpLndpdGhfcG9zX2lkeChwb3NfYXIpLAogICAgICAgICAgICBQcmltT3A6OkFycmF5U2xpY2VlZ2V4KSwKICAgICAgICAgICAgUHJpbU9wOjpTdHJpbmdTdWJzdHIgPT4gc2FnZSksCiAgICAgICAgICAgIFByaW1PcDo6TGFiZWxXaXRoTm90ZXMgPT4gU3BsaXQpLAogICAgICAgICAgICBQcmltT3A6OlN0cmluZ0NvbnRhaW5zID0+IC8vIHNldHRpbmcgdGhlIHNwYW4gb2YgdGhlIGR1bW15IG1lcmdlIGxhYmVsIGNvcnJhbid0IHByb3ZpZGUgaGVyZSAtIGl0J3Mgc3RvcmVkIGhpZ2hlciB1cCBpbnRQYWlyKSwKICAgICAgICAgICAgUHJpbU9wOjpSZWNvcmREaXNqb2ludE1lcmdlID0+ICAgb3Bfa2luZDogKnJlY29BcHBseSksCiAgICAgICAgICAgIFByaW1PcDo6Q29udHJhY3RDaGVjayA9PiBUb25jYXQpLAogICAgICAgICAgICBQcmltT3A6OkVxID0+b2R1bG8pLAogICAgICAgICAgICBQcmltT3A6Ok51bWJlckFyY1RhbjIgPT4gVGFsTml4KSwKCiAgICAgICAgICAgIC8vIEJpbmFldFRhZyksCiAgICAgICAgICAgIFByaW1PcDo6Q29udHJhY3RDdXN0b20gPT5yZWV6ZSA9PiBuZEFsbCksCiAgICAgICAgICAgIFByaW1PcDo6RmNhc2UpLAogICAgICAgICAgICBQcmltT3A6OlN0cmluZ0xlbmd0aCA9PiBUYXlHZW4pLAogZWxHb0RvbSA9PmlwUG9sKSwKIDpDYXN0KSwKICAgICAgICAgICAgUHJpbU9wOjpCb29sQW5kID0+ICAgIE5BcnkodGVybTo6TkFyeU9wKSwKfQoKaW1wbCBGcm9tQXN0PFByaW1PcD4gZi8vIHByb2JhYmx5IHN3aXRjaCB0byBgUmF3U3BhbmAgaW5zdCB0eXA6IG1saW5lX3R5cGU6OlR5cGUgPW1Bc3Q8UmVjb2JsZXwgQm94OjpuZXcodHlwLnRtQXN0PEVudW1SbUFzdDxUeXBlVW5yPCdhc3Q+PiBmb3IgTWFpbmxpbmVUeXBlVW5yIHsKIGVudDogaW5jbC5pZGVudCwKICAgICAgICAgICAgbWV0YWRhdGE6IGluY2wubWV0YWlvbjogbWV0YWRhdGEuYW5ub3RhdGlvbi50b19tOjpyZWNfcmVjbyBjb21wcmlzZWQgb2YKICAgICAgICAgICAgICAgICAgICAgICAgLy8gb25lIGR5bmVsZHMgPSBJbmRleE1hcDo6dGhlbih0ZXJtOjpUZXJtOjp0cnlfc3RyX2NodW5rX2FzX3N0YXRpY19zdHIpOwoKIHNfaWR4ID0gcG9zX3RhYmxlLnB1c2gocG9zKTsKIGNfcG9zCiAgICAgICAgICAgICAgICAubWFwKHxwfCBwLmZ1c2UocGF0aF9lbGVtLnBvaXRoX2ZpZWxkX25hbWUobmFtZV9pbm5lcm1vc3QpCiBpb24gc3BlY2lmaWVkIGFzIGEgcGF0aCwgbGlrZSBgYS5iLmMgPSBmb29gLCBpbnRvZm9yIChGaWVsZE5hbWUsIHRlcm06OnJlY29yZDo6RmllbGQpIHsKX2FzdChjaHVuazogJlN0cmluZ0NodW5rPEFzdDwnYXN0Pj4sIHBvbm5vdC50eXAuYXNfcmVmKCkubWFwKHx0eXB8IHR5cC50b19tYXV0bwovLy8gZGVyZWYgYW5kIGJsYW5rZXQgaW1waXMgY2F1c2VzIGFubm95aW5nIGluZmVyZW5jZSBpc3N1ZSBhcm91bmQgYXV0bwpyYWN0LAogICAgICAgICAgICB0ZXJtOjpOQXJ5T3A6OlJlY29yZFNlYWxUYXBlY3QgJXJlY29yZC9pbnNlcnQlIGF0IHRsV2l0aE1lc3NhZ2UgPT4gbU9wOjpIYXNoLAogICAgICAgICAgICB0ZXJtOjpCaW5hcnlPcDo6U2VyaWFsaXplID1yZEdldCA9PiBQcmltT3A6OlJlY29yZEdldCwKIGN0cy5pc19lbXB0eSgpCiAgICAgICAgICAgICAgICAmJiAqZXh0X2tpbmQgPT0gdGlzIGNvcnJlc3BvbmRzIHRvIGEgY2FsbCB0byBgJXJlY29yZC91bWJlckxvZywKICAgICAgICAgICAgdGVybTo6QmluYXJ5T3A6OlBvdyA9PiBQOjpEaXYgPT4gUHJpbU9wOjpEaXYsCiAgbmRBbGxDb21waWxlZChfKQogICAgICAgICAgICB8IHRlcm06OlVuYXJ5T3A6OlJlY0R1bUdldFRhZyA9PiBQcmltT3A6OkVudW1HZXRUYWcsCiAgZXRBcmcsCiAgICAgICAgICAgIHRlcm06OlVuYXJ5T3A6OkVudW1NYWtlVmFyaTpFbnVtRnJvbVN0cmluZyA9PiBQcmluZ0xlbmd0aCwKICAgICAgICAgICAgdGVybTo6VW5hcnlPcDo6VG9TdHJwOjpTZXEgPT4gUHJpbU9wOjpTZXEsCiAgaXBQb2wsCiAgICAgICAgICAgIHRlcm06OlVuYXJ5T3A6OkxhYmVsUG9sID1vcDogJnRlcm06OlVuYXJ5T3ApIC0+IFNlbGYgewogICAgICAgIG1hdGNoIG9wIHsKYXN0LCBTLCBUPiBUb0FzdDwnYXN0LCBUPiBmb3IgUwp3aGVyZQogICAgVDogRnJvbVJlZjo6TGFiZWwoXykKICAgICAgICAgICAgfCBWYWx1ZUNvbnRlbnRSZWY6OkN1c3RvZWY6OlR5cGUoVHlwZURhdGEgeyB0eXAsIGNvbnRyYWN0OiBfIH0pID1pYW50KEVudW1WYXJpYW50RGF0YSB7IHRhZywgYXJnIH0pID1hcCh8ZWx0fCBlbHQudG9fYW5zbGF0aW9uJ3MgcGVyZm9ybWFuY2Ugc28gaXQncyBzaW1wbGVyIHRvIGp1c3QgY29sbm9kZSA9IG1hdGNoIHJ0ZXJtLmNvbnRlbnRfcmVmQXN0Ojpmcm9tX21haW5saW5lKGFsbG9jLCBwb3NfdGFibGUsIHZhbHVlKS5ub2RlLAptX29wKG9wLCBhcmdzKQogIGVxIShhcmdzLmxlbigpLCAzKTsKICAgICAgICAgICAgICAgICAgICAvLyBUaGUgb3JtOjpPcE4oZGF0YSkgPT4gewogICAgICAgICAgICAgICAgLy8gU2VlIFtecHJpbW8gLy8gaGlzdG9yaWNhbCByZWFzb25zLiBUaGUgbmV3IEFTVCB0cmllfSkpOwoKICAgICAgICAgICAgICAgIGFsbG9jLnJlY29yZChSZWNvICBwb3MsCnBfb3IocG9zX2ZpZWxkX25hbWUpOwoKZTogZmllb2MuYXBwKGRhdGEuaGVhZC50b19hc3QoYWxsb2MsIHBvc190YWJsZSksIGFyZ3MpCiBhcmdzLnB1c2goZGF0YV9uZXh0LmFyZy50b19hc3QoYWxsb2MsIHBvc190YWJsZSkpO3VybiBhbGxvYy5pZl90aHRoZSBpZiBhbmQgZWxzZSBicmFuY2hlcywgd2hpY2ggaXMgYSBiaXQgcGFpbiA9PiBicmVhayBtYXliZV9uZXh0X2Z1biwKICBtdXQgYXJncyA9IHZlYyFbZnN0X2FyZ107CiAgbGxvYy5zdHJpbmdfY2h1bmtzKGNodW5rcy5pdGVyKCkucmV2KCkubWF3c1VuciA9CiAgICBtbGluZV90eXBlOjpSZWNvcmRSb3dzRmVyb3dzfCBhbGxvYy5hbGxvYygoKmVyb3dzKS50b19tUm93cywKICAgICkgLT4gU2VsZiB7CiAgICAgICAgRW51bVJvd3MoZXJvd3BlVW5yPiBmb3IgVHlwZVVucjwnYXN0PiB7CiAgICBmbiBmcm9tX21haW4gICBtYWlubGluZTogJm1saW5lZW50OiBtYWlubGluZS5pZGVudCwKICAgICAgICAgICAgbWV0YWRhdGE6IG1haWl0eTogbWV0YWRhdGEucHJpb3JpdHkuY2xvZG9jfCBhbGxvYy5hbGxvY19zdHIoZG90KCppZCkpLAogICAgICAgICAgICB2YWx1ZTogY29udGVudAogZXQgdHlwID0gYW5ub3QKICAgICAgICAgICAgLnR5cAogICBja2VsIG9iamVjdCAoW3Rlcm06OlRlcm1dLCBldGMuKQpwdWIgdHJhaXQgRnJvbS8gLSBgJ2FzdGA6IHRoZSBsaWZldGltZSBvZiB0aGUgQVNUIG5vZGVzLCB0aWVkIHQ6OkNvbWJpbmUsCiAgICBldmFsOjp2YWx1ZTo6ewpzc29yLnByb2Nlc3MocmVzKSkKICAgIH0KfQovLyEgQ29tcGF0aWJpbGl0eSB3aWNlczogd3JhcF9zb3VyY2VzX29wZXJhdGlvbigqc291cmNlcywgc2Vscml0ZSB7CiAgICAgICAgICAgICAgICAgICAgdHk6IG1hdGNoICZyZXdyaXRlLnR5IHsgICAgKipzLCAqcHJvY2Vzc29yLAogbnQgeyBpbm5lciwgcHJvY2Vzc29yIH0uY2V0ZW50PikgLT4gVmM8Q29udGVudFNvdXJjZUNvbnRlbnQ+Owp9CgovLy8gQSBXcmFwLy8vIHNvbWUgaW5uZXIgQ29udGVudFNvdXJjZSdzIGZ1bGx5IHJlc29sdmVkIFtDb25rczo6e09wZXJhdGlvblZjLCBSZXNlbmd0aC5jb250ZXh0KCJubyBDb250ZW50LUxlbmd0aCBoZWFkZXIiKT87CiBpZiBidWYgPT0gIlxyXG4iIHsKcnZlciB1bnRpbCB3ZSBnZXQgYSByZXF1ZXN0J3MgcmVzcG9uc2UuCiAvLyBzZW5kIHdlbGwtZm9ybWVkIEpTT04gUlBDLgogICAgZm4gc2VuZDxTOiBTZXJpbnMgc2VudCBieSB0aGUgc2VydmVyLgogICAgcHViIGZuIHBlbmRpbmdfbm90aW9yIGEgcmVzcG9uc2UgYWZ0ZXIgc2VuZGluZyBhIHJlcXVlc3QsIHRoZXJlJ3Mgb25vbjo6PEluaXRpYWxpemVkPihJbml0aWFsaXplZFBhcmFtcyB7fSkKICBsZi5zZW5kX3JlcXVlc3Q6OjxJbml0aWFsaXplPihJbml0aWFsaXplUGFyYW1zIHsKLy8gYHJvb3RfcGF0aGAgaXMgZGVwcmVjYXRlZCwgYnV0IHdlIG5lZWQgb3QgaW5pZW50OiBWZXJzaW9uZWRUZXh0RG9jdW1lbnRJZGVudGlmaWVyIHsgdXJpLCB2ZXJsYWNlX2ZpbGUoJm11dCBzZWxmLCB1cmk6IFVybCwgdmVyc2lvbjogaTMyLCBjb24ncyB3aGF0IExTZXMgZG8pLgogICAgcHViIGZuIG5ldyhjbWQ6IHN0ZCAgICBsc3AuaW5pdGlhbGl6ZShpbml0aWFsaXphdGlvbl9vcHRpb25zKT87CgpsdDxTZXJ2ZXI+IHsKICAgICAgICBsZXQgbXV0IGxzcCA9IGNtZAogICBydmVyIGdyYWNlZnVsbHkuCiAgICAgICAgcHViIGZuIHNodXRkb3duKHRoaXM6ICZtY3QgUmVzcG9uc2UgewogICAgLy8vIFRoZSBzdHJpbmcgIjIuMCIsIGhvcGVmdWxsIFRoZSB2YWx1ZSBvZiBUOjpNRVRIT0QKICAgIG1ldGhvZDogJidzdGF0aWMgc3RyLHplKV0Kc3RydWN0IFNlbmRSZXF1ZXN0PFQ6IExzcFJlcXVlc3Q+IHtpdmVkIGZyb20gdGhlIGxzcCBidXQgbm90CiAgICAvLy8geWV0IGRlbGl2ZXJlZGVudElkZW50aWZpZXIsIFRleHREb2N1bWVudFBvc2l0aW9uUGFyYW1zLCBVcmwsCiAgbGllbnRDYXBhYmlsaXRpZXMsIERpZENoYW5nZVRleHREb2N1bWVudFBhcmFtcywgRGl0aW9uLWdyYWRlIGltcGxlbWVudGF0aW9uLgoKdXNlIGFueWhvdzo6e2JhaWwsIENvbmMsIDApLmF3YWFzazogOSwKICAgZW50OiB0cmFzazogNiwKICBhc2s6IDQsCiAgYXNrOiAzLAogIHQuanMvcHVsbC83OTQ1MQogICAjIVthbGxvLm1heF9tYXRjaGVzLm1hcF9vcihmYWxzZSwgfGxpbWl0fCBzZWxmLmNvdW50KCkgPj0gYXJlIGBcbmAgb3IgTlVMLgogICAgICAgICAgICBpZiBsaW5nZXggdG8gYmUgYWJsZSB0bwogICAgICAgICAgICAvLyBkZWFsIHdpdGggbGNlID0gJmJ1ZltzZWxmLmxhc3RfbGluZV9jb3VudGVkLi51cHRvXXRleHQgPiAwIHx8IHNlbGYuY29uZmlnLmFmdGVyX2NvbnRleHQgPiAwOwoKaW5kOjpPdGhlciwKaW5kOjpBZnRlciwKZXJtOiBzZWxldCBvZmZzZXQgPSBzc2luay5tYXRjaGVkKAogdGV4dChyYW5nZGF0ZShpKSkpID0ndCByZXBvcnQgdGhpcyBhcyBhIG1tdXQgcG9zID0gc2VsZi5wb3MoKTsKICAgICAgICB3aGlsZSAhYnVmW3Bvcy4uXS5pc2Zhc3QoCmlmIGludmVydF9tYXRjaC5pc19lYXRjaCk7CgogICAgICAgIGxldCBpbnZlT2soQ29udGludWUpCiBjaGVkIHsKICAgICAgICAgICAgICAgIHJldHVybiBPayhTd2l0Y2hUb1Nsb3cpOwplIGlmIHNjaGVkICE9IHNlbGYuY29uZmlnLmludmVydF9tYXRjaDsKICAgIC8vIHBvc2l0aW9uICgyLCAyKSBpbiB0aGUgc3RyaW5nIGBhXG5gLgplZCA9IHsKICBlU3RlcDo6bmVmdCA9IGFmdGVlZnQgPSBzZWxmLmFmdGVyX2NvbnRleHRfbGVmdDsKICBuIE9rKHRydWUpOwogICAgICAgIH0KICAgICAgICBsZXQgZXhjZWZpZy5iZWZvcmVfY29udGV4dCAtIDEsCiAgICB1cHRvOiB1c2luYXJ5LjAgewogICAgICAgICAgICBCaW5hcnlEZXRlY3Rpb246OlF1aXQoYikgKCkgLSBjb25zdW1lZCk7CiAgICAgICAgY29uc3VtZWQKICB1bWVkID0KICAgICAgICAgICAgICAgIHN0ZDo6Y21wOjptYXgoY29udCAgLy8gLi4uIGhvd2V2ZXIsIHdlIG9ubHkgbmUoYnVmKQogICAgICAgIH0KICAgIH0KCiAgICBwdWIoY3JhdGUpIGZuIHJvbGwoJm11c2luay5iZWdpbigmc2VsZi5zZWFyY2hlcikKIGF0Y2goCiAgICAgICAgJm11dCBzZWxmLAogICAgICAgIHNsaWNlOiAmW190ZXJtKTsKICAgICAgICBzZWxmLm1hdGNoZXIuaXNfbWF0Y2gobGluZSkubWFwIGAoP20pXiRgIGNhbiBtYXRjaCBhdCB0aGUgZmluYWwgcG9zaXRpb24gYmV5b25kIGFmZnNldC5tYXAofG9mZnNldHwgb2Zmc2V0IGFzIHU2NCkKICAgIHNldF9wb3MoJm11dCBzZWxmLCBwb3M6IHVzaXplKSB7CiBzaW5rLAogICAgICAgICAgICBiaW5hcnksCiAgICAgICAgICAgIHBvczogMCxjaGVyOiBNLAogICAgICAgIHNpbms6IFMsCiAgICAgICAgYmluYXJ5OiBib291c2UgYnN0cjo6Qnl0ZVNsaWNlOwoKdXNlIGdyZXBfbWF0Y2hlcjo6e0xpbmVNaWQsIHZzKXwgewogICAgICAgICAgICB2cy5pdGVyKCkubWFwKHx2fCB7ICAgIChkZXBfbmFtZSwgcHJlY2lzZV9kZXApCiAgIEVycihQcmVjaXNlSW5kZXhQa2cgeyBpZCwgdmVyc2lvbiB9KSA9a2cgPSBtYXRjaCBkZXAuY2xvbmUoKS5hc191bnZlcnNpb25lZCgpIHN1bHQ8XywgRXJyb3I+PigpPywKCiAgICAgICAgICAgIHBhY2thZ2VzLAogaChjb25maWcsICZzZWxmLmluZGV4KT8sCiBsZXQgcF9wYXRoID0gcAogICAgICAgICAgICAgICAgLmNsb24gIGFsbC5leHRlbmQoc2VsZi5pbmRleF9wYWNrYWdlcy5pdGV0IG1hbmlmZXN0X2RpciA9IG5vcm1hbGl6ZV9wYXRoKCZwYXJlbnRfZGlyKS53aXRpZDogaW5kZXhfZGVwLmlkLmNsZGVwcy5kZWR1cCgpOwogICAgICAgICAgICAgICAgT2soZGVwcykKICBlc3QoJnV2KQogIDxWZWM8KElkZW50LCBEZXBlbmRlbmN5LCBQcmVjaXNlUGtnKT4sIEVycnBhdGgudG9fb3duZWQoKSksCiAgICAgICAgICAgIERlcGVuZGVuY3k6OkluZGV4KGlkY2ggZGVwIHsKICAgICAgICAgICAgRGVwZW5kZW5jeTo6R2l0KGdpdCkgPT4gUHJlY3JzdCBtYXRjaGluZyB2ZXJzaW9uLiBPbmNlIHZlcnNpb24gcmVzb2x1dGlvbiBpcwogb3IgbGlzdCBpbiBpbmRleF9wYWNrYWdlcy52YWx1ZXNfbXVtVmVyPj4gPSBIYXNoTWFwOjpuZXcoKTsKCiAgICBmb3IgZW50cnkgaW4gbG9jay5wYXJuZWQgaGVyZSBpcyBub3QgZ3VhcmFudGVlZCB0byBiZSBhICp2YWxpZCogcmVzb2FnZXMuZW50cnkoYnVja2V0LmlkKS5vcl9kZWZhdWx0KCkucHVzaCh2ZXJzaW9uKTtvY2tlZDogbG9jawogICAgICAgICAgICAucGFja2VydmUgdGhlIHZhbGlkIHBhcnRzIGJ1dCBtYWtlIG5vIGd1YXJhbnRlZXMuCnB1Y2thZ2UncyBkZXBlbmRlbmNpZXMsIGdpdmluZyBwcmVmZXJlbmNlIHRvIHRoZSB2ZXJhZ2VzIGFyZSBub3QgInJlc29sdmVkIjsKICAgIC8vLyB0aGV5IGhhdmUgZml4ZWQgdiAgcHViZ3J1Yjo6UmFuZ2VzOjpoaWdoZXJfdGhhbihsb3dlcl9ib3VuZCkKIG5nZXM8U2VtVmVyPikgewogICAgbGV0IHAgPSBQYWNrICBPayh1dikgPT4gc2VsZi5zbmFwc2hvdF9kZXBlbmRlbmNpZXMoJnV2KSwKIG5zKHYpKTsKICAgICAgICAgICAgICAgICAgICBPayhtaW5fdmVydGhlIHNtYWxsZXN0IHZlcnNpb24gdGhhdCdzIGluIHRoZSBidWNrZXQgYW5hZ2U6OkluZGV4KGJ1Y2tldCkgPT4gewogICAgICAgICAgICAgICAgaWYgbGV0IEJ1Y2FpbnMobG9ja2VkX3ZlcnNpb24pCmlvbjogQnVja2V0VmVyc2lvbjo6UHJlcmVsZWFzZShfKSwKICBlIEVyciA9IGNyYXRlOjpFcnJvcjsKCiAgICBmbiBwcmlvcml0aXplKAogIGxsZWN0X2ludGVyc2VjdGlvbnMoaW5kZXhfZGVwcy5jaGFpbihvdGhlcl9kZXBzKS8vLyBgcGtnYCBtdXN0IG5vdCBiZSBhbiBpbmRleCBwYWNrYWdlLgppc3RyeSB7CiAgICAvLy8gUmVhZCBnaXQgb3IgcGF0aCBkZXAKCi8vIExpa2UgYGNvbGxlY3RgLCBidXQgaWYgaXQgZW5jb3VudGVycyBhIGR1cGxnZXMgd2hvc2UgdmVyc2lvbiBpcyBhbHJlYWR5IGtub3duLCBhbmQKLy8vIC0gcGFpb246Ok1pbm9yKHYpID0+IHdyaXRlIShmLCAiMC57dn0iKSwKbjo6UHJlcmVsZWFzZSh2KSA9PiB2ID09IHNlbXZlciwKIHJvbSh2OiBTZW1WZXIpIC0+IFNlbGYgewogICAgICAgIGlmIHYucHJlLmlub3IocHJlZml4Lm1ham9yLCBwcmVmaXgubWlub3IudW53cmFqb3IgdmVyc2lvbiB6ZXJvLCBhbmQgdGhlIHNhbWUgbWlub3IgdmVyc2lvbiBudW1ibmRleChzZWxmKSAtPiBSZXN1bHQ8VW52ZXJzaW9uZWRQcmVjaXNlUGtnLCBCdWNrbmdlZCAob3Igc29tZSBwYXRoLWRlcGVuZGVuY3kgY2hhbmdlZCkgdGhlbkVycm9yQ2hvb3NpbmdWZXJzaW9uIHsgcGFja2FnZTogXywgc291cmNlIH0gPWFnZVJlZ2lzdHJ5PjsKCnB1YiBmbiBwcmludF9yZXNvbHZlX2Vycm9yKGY6ICZtb3J0ZXIsIERlcGVuZGVuY3lQcm92aWRlciwgUmVwb3J0ZXIgYXMgX307Cgp1aXBseSh2YWx1ZTogT3BlcmF0aW9uVmM8aTMyPiwgY29lZmZpY2llbnQ6IAoKLy8gb3BlcmF0aW9ucyBjYW4gdGFrZSBgUmVzb2x2ZWRWY2BzIHRvbyAoYW55dGhlcnMgc2hvdWxkIG5vdCB1c2UgdGhpcyBkaXJlY3RseS4gSW5zdGVhZCwgaXQgaXMgYyAgICBNRVNTQUdFUy5zdG9yZSh5ZXMsIE9yZGVyaW5nOjpSZWxheGVkKQp9bm90IHNob3duLgpwdWIoY3JhdGUpIGZuIHNldF9tZXNzYWdlcyh5ZXM6IGVzOjpzZXRfZXJyb3JlZCgpOwogICAgICAgIG1lc3NhZ2UhKCQoJHR0KSopOwogIFBpcGUgewogICAgICAgICAgICAgICAgICAgIHN0ZDo6cHJvY2Vzczo6ZXhpdCgwKTsgY2FuIGdldCBpbiBzb21lIGNhc2VzIGlzIGEgYnJva2VuIHBpcGUgZXJyb3IuIEFuZGdyZXAgYmVjYXVzZSBgc2VhcmNoX3BhcmFsbGVsYCB1c2VzIGB0ZXJtY29sb3JgLAogdmluZyBvdXRwdXQgd2hlbiBzdGRvdXQgYW5kIHN0ZGVyciBib3RoCi8vLyBjb3JydXJyZWQuIFdoZW4gcmlwZ3JlcCBleGl0cywgdGhpcyBmbGFnIGlzCmNvbnN1bHRlZCBsbHkgc2V0IGF0CnN0YXJ0dXAgdGltZSB3aGVuIENMSSBhcmd1bWVudHMgYXIgIGNoaWxkcmVuLmluc2VydCgoCiAgICAgICAgICAgICAgICByY3N0ciEoIm1vZHVsYyBmbiBkZXRhaWxzKCZzZSBmbiB0aXRsZShzZWF0ISgiY2h1bmsge30iLHNldHMsCiAgICAgICAgICAgIG1vZGlmaWVyczogVm1hcCh8JmNodW5rX2l0ZW18IGFzeXF1ZWx5CiAgICAgICAgZm9yICZjaHVua19pdGVtIGluIGNodW5rX2l0ZW1zLmloID0gaWYgbGV0IFNvbWUoY2h1bmtfaXRlbSkgPSBjaHVua19pdGVtcy5maXJzdCgpIGV0czogUmVyID0gd2l0aF9pbmZvLnJlZmVyZW5jZXMoKS5mbiBlbnRyeV9pZHMoc2VsZjogVmM8U2VsZj4pIC0+IFZjPE1vZHVsZUlkcz4gewogcHViIGNodW5zZSBzZWxmOjp7CiAgICBiYXRjaDo6ewogICAgICAgIEVjbWFzY3JpcHRDaHVua0JhdGVuY2VkfSwKICAgIHNlcnZlcl9mczo6U2VydmVyRmlsZVN5c3RlbSwKfTsKcm5hbChSZXNvbHZlZFZjOjpjZWxsKGlubmVyX2Fzc2V0cykpLApvbiBoZWxwZXIgc28gdGhpcyBjb2RlIGlzIGtlcHQgaW4gc3luYyB3aXRoIG90aGV0dWFsIHdyYXBwZXIgbGl2ZXMgaW4gdGhlIE5leHQuanMgdGUoZiwgInVudHlwZWQgdmFsdWUiKQogICYoJipvdGhlci4wIGFzLy8gb25seSBjb21wYXJlcyB0aGVpciBhZGRyZXNzZXMuCiAgICAjW2FsbG93KGFtYmlpbXBsIEhhc2ggZm9yIFNoYXJlZFJlZmVyZW5jZSB7CiAgICBmbiBoYXNoPEg6IHN0ZCBub3RfZGVjb2RhYmxlKHZhbHVlX3R5cGU6ICZWYWx1ZVR5cGUpIC0+IERlY29kZUUgRXJyKEVuY29kZUVycm9yOjpPdGhlclN0cmluZyhmb3JtcmVmPFQ6IEFueT4oJnNlbGYpIC0+IE9wdGlvbjwmVD4gewp0Y2ggZG93bmNhc3RfdHJpb21waGVfYXJjKHNlbGYuMCkgewogIG5ldyhkYXRhOiB0cmlvbXBoZTo6QXJjPGltcGwgQW55ICsgU2VuZCArIFN5bmM+KSAgLmluc3RydW1lbnQoc3Bhbl9vdXRlcikKIG5mbzo6Q2h1bmtJdGVtIHsgY2h1bmtfaXRlbSwgLmVudDogcmNzdHIhKCIiKSwKIHRlbSkgewogICAgICAgICAgICAgICAgaWYgaGFuZGxlZC5pbnNlcnQoYmF0Y2gpIHsKICAgbWF4X2NodW5rX3NpemU6IGNodW5oSW5mbywgU3BsaXRDb250ZXh0LCBtYWtlX2NodW5rfSwKIGxvY2FsIikuaW50bygpKSwKICAgICAgICBpZiBub2RlX2VudiA9PSAidGVzdCIgewogaWxlcyA9IFsKICAgICAgICBTb21lKGZvcm1hdCEoIi5lbnYue25vZGVfZW52fS5sb3NzRW52OwoKLy8vIExvYWRzIGEgc2VyaWVzIG9mIGRvdGVudiBmaWxlcyBhY2NvIG5ldyh2OiB1MzIpIC0+IFJlc29sdmVkVmM8U2VsZj4gewogICAgICAgIFNlbGY6OnJrZXk7CiAgICBzbGVlcChEdXJhdGlvbjo6ZnJvbV9taWxsaXMoMTAwKSkuYWNvcGUoCiAgICBrZXk6IFJjU3RyLAogICAga2V5MjogUmNTdHIsCiAgICBrZXkzOiBSbiBteV90cmFuc2l0aXZlX2VtaXR0aW5nX2Z1bmN0aW9uKGtleTogUmNTdHIsIGtleSJiIikpCiBsdF92YyA9IHJlc3VsdF9vcC5jb25uZWN0KCk7CiAgICByZXN1bHRfdmMuc3RybyBmbiBteV9jYmxlc193aXRoX3Jlc29sdmUoKSB7aXRoX2NoaWwoImIiKSk7Ymxlc19wYXJ0X29wLnRpdD8uYXNfc3RyKCkpKQo9IG15X211bHRpX2VtaXR0aW5nX2Z1bmN0aW9uKCk7Cm9uX2NvbGxlY3RpYmxlcyhyY3N0bGlzdCB7CiAgICAgICAgICAgIGFzc2VydCEoZXhwKCIiKSk7CmtzOjp7Q29sbGVjdGlibGVzU291cmNlLCBSZXNvbHZlZFZjLCBWYWxjdHg6IHRyYWNpbmdfc3Vic2NyaWJlcjo6bGF5ZXI6OkNvbnRleHQ8J18sIFM+LAogIGlnLmluc2VydCh0YXJnZXQudG9fc3RyaW5nKCksIGxldmVsKTsKICBpbmcsIExldmVsRmlsdGVyPiwKICAgIGdsb2JhbF9sZXZlbDogTGV2ZSAgLy8gcXVpY2tseSBmaW5kcyBjYW5kaWRhdGUgbWF0Y2hlcy4KICBpc19jYW5kaWRhdGUobTogTGluZU1hdGNoS2luZCkgLT5oYXQgZmluZGluZyBjYW5kaWRhdGUgbGluZXMgd29ya3MgYXMgZXhwImFiY1xyXG4iKS51bndyYXAoKSk7CgogICAgICAgIC8vIE5vdyBjaGVjaXRzIGAkYCB0byBtYXRjaCBhdCB0aGUgZW5kIG9mIGEgbGluZS4KICAvLyBFbnN1cmUgdGhhdCB0aGUgYnVpbGRlciByZXR1cm5zIGFuIGVycm9yIGlmIGFhdG9yIHByZXZlbnRzIGl0IGZyb20gbWF0Y2hpbmcgdGhyb3VnaAogICAgLy8gc2FpZGVuY2UgYmV0d2VlbiBpdCBhbmQgc3Vycm91bmRpbmcgdGhlIHJlZ2V4IGluIGBcYmAuYXBzLmdyb3VwX2luZm8oKS5hbGxfZ3JvdXBfbGVuKClnZXgsIGAoP1A8Zm9vPlx3KXwoP1A8YmFyPlxXKWAsIG9ubGlvbiBhdCB3aGljaCB0aGUgbGVmdCBvcGVuaW5nIHBhcmVudGhlc2lzIG9jY2xmLmZhc3RfbGluZV9yZWdleCB7CiAgICAgICAgICAgIFNvbWUocmVmIHJlZ2V4KSA9Zm4gbm9uX21hdGNoaW5nX2J5dGVzKCZzZWxmKSAtPiBPcHRpb248JkJ5dGVTZXQ+IHtrKCgpKSkKICAgIH0KCiAgICAjW2lubGluZV0KICAgIGZuIGNhcHR1cmVzX2F0KAogIHRjaCBtYXRjaGVkKE1hdGNoOjpuZXcobS5zdGFydCgpLCBtLmVuZCgpKSkge09rKFJlZ2V4Q2FwdHVyZXM6Om5ldyhzZWxmLnJlZ2V4LmNyZWF0ZV9jYXB0dXJlcygpb3ZlZCB0cmFuc3BhcmVudGx5LgogICAgcHViIGZuIG5ld19saW5lX21hdGNoZXIocGFoYXQgaGVscCBzcGVlZCB1cCBsaW5lIG9yaWVudGVkIHNlYXJjaC4gVGhlc2UgdHlwaW9uLCBidXQgbWF0Y2hlcyBsaW5lcyB0ZXJtaW5hdGVkIGJ5IGBcbmBtb3JlIHF1aWNrbHkKICAgIC8vLyB0aGFuIGByZWdleGAuIFR5cGljYWxsLyBXaGV0aGVyIGVhY2ggcGF0dGVybiBzaG91bGQgbWF0Y2ggdGhlIGVudGlyZSBsaW5jaWFsIHJlZ2V4IG1ldGEgY2hhcmFjdGVycywgYXJlIG1hdGNoZWQgbGl0ZXJhbGx5LiBzaWRlcyBvZiB5b3VyIHBhdHRlcm4uIEluIHBhcnRpY3VsYXIsIGEgYFxiYCBhc3Nlbm90IHRvdWNoIHRoZSBgY3JsZmAgc2V0dGluZy4KICAgIHB1YiBmbiBjcmxmKCZtdWhlciBmcm9tIGV2ZXIgcHJvZHVjaW5nIGEgbWF0Y2ggdGhhdCBjb250YWlucwogIGIgZm4gYmFuX2J5dGUoJm11dCBzZWxmLCBieXRlOiBPcHRpb248dTg+KSAtPndpbGwgbGlrZWx5CiAgICAvLy8gd2FudCB0byBiYW4gdGhlIHNhbWUgYnl0ZSB0aHIpLCBidXQgdGhlIHBhdHRlcm4gYGFcbmJgCiAgICAvLy8gd2lsbCByZXN1YXRjaCBgYVxuYmAgKHdoZW4gYFxuYCBpcyB0aGUgbGluZSB0ZXJtaW5hdG9yKSwgYm9yLiBCZWNhdXNlIG9mIHRoaXMgZ3VhcmFudGVlLCB1cyBvZiBgMGAgcGVybWl0cyBgYWAgYnV0CiAgICAvLy8gbm90IGBhYmAsIHNpbmNlIGBhdCB0byBwdXQgYSBsaW1pdCBvbiB0aGUgYW1vdW50IG9mIGhlYXAgc3BhY2UgdXNlZCwvLy8gb3ZlcmZsb3cgZm9yIGNvbnN1bWVycyB0aGF0IGRvIHN0cnVjdHVyYWwgaW5kdWlzIGEgKnBlciB0aHJlYWQqIGxpbWl0LiBUaGVyZSBpcyBubyB3YXkgdG8gc2V0IGEgZ3JhbS4gSWYgdGhlIHByb2dyYW0gZXhjZWVkcyB0aGlzIG51bWJlciwgdGhlbiBhCiAvLy8gbWVzc2FnZSB3aWxsIGV4cGxpY2l0bHkgbWVudGlvbiB0aGF0IGJhY2tyZWZlcmxlLCBgYWAsIGBceDYxYCwgYFx1MDA2MWAgYW5kCiAgICAvLy8gYFwxNDFgIGFyZSB0aGUgVW5pY29kZSAoYHVgKSBmbGFnLgogICAgLy8vCiAgICAvLy8gRW5hYmxlZCBiZWVkeSAodHJpZXMgdG8gZmluZCBsb25nZXN0IG1hdGNoKS4KICAgbGF6eSAodHJpZXMgdG8gZmluZCBzaG9ydGVzdAogICAgLy8vIG1hdGNoKSBhbmRoZSBhbnkgY2hhcmFjdGVyIChgc2ApIGZsYWcsIHdoZXJlIGluIGAuYC8gICAgYGFcd2AgY29udGFpbnMgYSBsaXRlcmFsIChgYWApIGJ1dCBgXHdgIGRvZWZpZy5jYXNlX2luc2Vuc2l0aXZlID0geWVzOwogZXJucyB3aXRoCiAgICAvLy8gYSBgfGAgYW5kIGNhbGxpbmcgYGJ1aWxkYC4KIHVyZWQgSElSIGRvZXNuJ3QKICAgICAgICAvLyBzdXBwb3J0IGl0LgppbmUgY29udGFpbmluZyBgZm9vYCBhbmQKICAgICAgICAvLyB0aGVuIHJ1biBldCBub25fbWF0Y2hpbmdfYnl0ZXMgPSBjaGlyLm5vbl9tYXRjaGluZ19ieXRlcygpO2NoZXIgYmVoYXZlcyBhcyBpZiBhbGwgb2YgdGhlIHBhdHRlcm5zCiAgICAvLy8gZ2l2bHQoKSB9CiAgICB9CgogICAgLy8vIEJ1aWxkIGEgbmV3IG1hdGNoZXIgdXNpbiBuZXcgYnVpbGRlciBmb3IgY29uZmlndXJpbmcgYSByZWdleCBtYXRjaGVyLgpjcmF0ZSdzCi8vLyBidWlsZGVyLCBpbiBhZGRpdGlvbiB0byBhIGZldyBvdGFzaGVzLmNvbnRhaW5zX2tleShpZCkgewogICAgICAgICAgICBhZGRlZC5pbmluZyBlbnRyaWVzIGFyZSBhZGRlZAogICAgZm9yIChpZCwgZW50cnkpIGluIGVudENodW5rVXBkYXRlPiB7CiAgICBsZXQgdG8gPSBjb250ZW50Lm93bl92ZXJzaW9uKCkuZUlkLCAodTY0LCBSZXNvbHZlZFZjPENvZGU+KT4sCiAgICBwdWIgZGVsZXRlZDogRnR5cGUgVGFyZ2V0ID0gVmVjPFQ+Owp0b3JlLmludmFsaWRhdGVfb3V0ZGF0ZWRfc3BhbnMoJnNlICBidWZmZXIgPSByZW1haW5pbmc7CiAgICAgICAgICAgICAgICAgICAgcm93cy5wdXN0Y2ggcG9zdGNhcmQ6OnRha2VfZnJvbV9ieXRlcyhidWZmZXIpIHsuYWRkX2RlYWxsICAgdHMuc2F0dWhlbih8dnwgdi5hc191NjQoKSkKIGx1ZXMgPSB2YXJkIHsgcmVmIHZhbHVyZ2V0LmludHBpbmcuZ2V0KCZpZCkgewogICAgICAgICAgICAgICAgU29tZSgqaWQpCiBsZXQgcSA9IHRha2UoJm11dCBxdWV1ZSk7CiAgICAgICAgICAgIGZvciByb3cgaW4gcSBpZiBkaWZmdW50ID0KICBkaWZmID0gQWxsb2NhdGlvbkluZm86OmRlZm9tZShzdGFycmVudCA9IHN0YWNrW3N0YWNrX2luZGV4IC0gMV07CiAgdGFydCwKICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZW5kOiB0cyxudCwgdGhyZWFkX2lkKSkKIHc6OkVudGVyIHsgdHNSb3c6OlJlY29yZCB7IGlkaWQ6IHBhcmVudCwKdzwnXz4pIHsKICAgICAgICBtYXRjaCByb3cgewpvd3M6IFZlYzxJbnRlcm5hbFJvdzwnc3RhdGljPj4sCn0KCnB1YiBzdHJ1Y3QgVHVyYm9yZCB7IHZhYW1lLmludGwgSW50ZXJuYWxSb3dUeXBlPCdfPiBudW0gSW50ZXJuYWxSb3dUeXBlPCdhPiB1YXJkfSwKICAgIHRpbWVzdGFtcDo6VGltZXN0YW1wLAp9OwoKI1tkZXJpdmUoRGVmYSAgICJPbmx5IG9uZSAjW3R1cmJvX3Rhc2tzOjpmdW5jdGlvbl0gYXR0cmlidXRlIGlzdHRycyk6IChWZWM8Xz4sIFZlYzxfPikgPSBhdHRycwogIGJ1dGVzKAogICAgYXR0cnM6ICZbQXR0cmlidXRlXSwKKSAtPiAoc3luOjpSZXN0byBjYWNoZSB0aGVzZQogICAgIWFyZ19pZGVudC50b19zdHJpbmcoKS5zdGFyYiBmbiBmaWx0ZXJfaW5saW5lX2F0dHJpYnV0ZXM8J2E+KAogICAgYXR0cnM6IGltZXdfZnVudGhvZCgKICBuZF9yZXNvbHZlLAogICAgaXNfbWV0aG9kLAogICAgICAgICAgICBpc19zZWxmX3VzZWQsCnVjdCBOYXRpdmVGbiB7CiAgICBwdWIgZnVuY3Rpb25fZ2xvYmFsX25hbWU6IFRva2lvbl0gbmFrZWQgZnVuY3Rpb25zIiwKICAgICAgICAgICAgRGVmaW5lLCBFcSwgUGFydGlhbEVxKV0KcHViIGVudW0gRGVmaXRleHQgaW4gd2hpY2ggdGhlIGZ1bmN0aW9uIGlzIGJlaW5nIGRlZmluZWQuCiNbZHRfbXV0Ojp2aXNpdF9tYWNyb19tdXQoc2VsZiwgbWFjKTsKIG4gb2YgInNlbGYiIGluc2lkZSBvZiBhbiBpbXBsIGlzIGRpZmZlcmVudCB0aGFuIHRob3V0ZXJtb3N0IHR5cGUgbXVzdCBiZSBhIHBhdGggdG8gYFZjYCIpCiAgOyAvLyB3ZSBvbmx5IHN1cHBvcnQgZXhwYW5kaW5nIFJlc3VsdDwuLi4+CiAgIHJzdCgpLmV4cGVjdCgiUmVzdWx0PC4uLj4gdHlwZSBoYXMgYW4gYXJndW1lbnQiKQogZXJpYwogICAgICAgICAgICAgICAgbGV0IFNvbWUoUGFpcjo6RW5kKFBhdGhTZWdtZVNvbWUoUGF0aFByZWZpeDo6QW55aG93KQogIG1lKGZpcnN0KSA9IGN1cl9wYWlyLmFzX3JlZigpLm1hcCh8cHwgcC52YWx1ZSgpKSB7ICAgbGVhZGluZ19jb2xvbiwKICAgICAgICAgICAgICAgICAgICAgICAgcmVmIHNlZ213aXNlIGdldCBmcm9tCi8vLyBgPFQgYXMgVGFza091dHB1dD46OlJldHVybmAsIHNvIGxhY2VkIHdpdGggYSBjdXN0b20gdHlwZSB1c2luZyBgcmVwbGFjZV92Y2AuIFR5cGVzOjpWYyAjYXJncykpOwptdXQgYnJhY2tldGVkX2FyZ3MgPSBicmFja2V0ZWRfYXJncy5jbG8uLiB9LAogICAgICAgICAgICAgICAgICAgICkgPSAmbGFzdF9zZWdtZW50LmFyZ3V1dCBzZWdtZW50cyA9IENvdzo6Qm9ycm93ZWQoc2VnbWVudHMpOwpsc2UsIFBhdGhNYXRjaDo6RW1wdHkgfCBQYXRoTWF0Y2g6OlR1cmJvVGFza3NNb2QsIHRjaCAoaGFzX2xlYWRpbmdfY29sb24sIHBhdGhfbWF0Y2gsICZzZWdtZW50LmlkZSAgIFZlY01vZCwKICAgICAgICAgICAgICAgIFZlYywKICByb3dlZGAgd2hlbiBubyBjaGFuZ2Ugd2FzCi8vLyBtYWRlIHRvIHRoZSBpbnB1dCB0eXlwZSBgVGAgdG8gYDxUIGFzIEZyb21UYXNrSW5wdXQ+OjpUYXNrSW5wdXRgIChpbiBjcGFyZW5fdG9rZW46IHRva2VuOjpQYXJlbjo6ZGVhcnNlZF9hcmdzLm9wZXJhdGlvbiA9IFNvbWUobWV0YS5zcGFua2VuIVssXSk/OwogICAgICAgIGZvciBtZXRhIGluIHB1bmN0dWF0ZWQgewpuIGFuIGBPcGVyYXRpb25WY2AgaW5zdGVhZCBvZiBhIGBWY2A/IEFsc28gZW5zdXJlcy8gYnkgc29tZSBzdGF0aWMgYW5hbHlzaXMgdG9vbHMuIE1heSBiZSBleHBvc2VkIHZsbHkgcGFyc2VzIGBUYCBmcm9tIGEgcGFyZXRoZW5zaXplZCBhdHRyaWJ1dGVzLCByIEFsbCBvdGhlciBjYXNlcyBhcmUgYXNzdW1lZCB0byBiZSBhIFZDLCB0aGkuaXNfaWRlbnQoIlNlbGYiKSA9PiB7fQogICAgICAgICAgICAgICAgXyA9PiB7OlR5cGU6OlJlZmVyZW5jZSh0eXBlX3JlZmVyZW5jZSkgPWVudW0gUmVjZWl2ZXJTdHlsZSB7CiAgICAvLyBBIHJlZmVyZW5jZSBsaWtlICZzZWxldCB2Y19vdXRwdXQgPSAjYmxvY2s7CiAgICAgICAgICAgICAgICAgICAgLy8gQXNzdWFzIHN0ZDo6Ym94ZWQ6OkJveDxkeW4gdHVyYm9fdGFza3M6Ok1hZ2ljQW55PiwKICAgICAgJiNuYXRpdmlzID0gI2NvbnZlcnRlZF90aGlzOwogIHRzID0gc2VsZi5pbmxpbmVfaW5wdXRfaWRlbnRzKCk7cnM6Okxhenk8JidzdGF0aWMgdHVyYm9fdGFza3M6OlRyYWl0TWV0aG9kPiA9CiBpZGVudDsKICAgICAgICBsZXQgb3V0cHV0ID0gJnNlbGYub3V0cHV0OwplISB7ICMoI2Fzc2VydGlvbnMpKiB9CiAgdHkgPSAmcGF0X3R5cGUudHk7CiBFUlJPUjogJnN0ciA9ICJtZXRob2RzIHRha2luZyBgc2VsZmAgYXJlb3VsZCBzdXBwb3J0IG1ldGhvZHMgYnkgcmV3cml0aW5nIHRoZSBleHBvc2VkIHNlbHRoaXMoJnNlbGYpIC0+IGltcGwgVG9Ub2tlZCA9ICgjKAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICA8Xzo6Qm94OjpuZXcoKCMoI2lubGluZV9pbnB1dF9pZGVudHMsKSopKQogIFNvbWUoRmlsdGVyVHJhaXRDYWxsQXJnc1Rva2VucyB7CmRzLCBidXQgd2UncmUgZG9pbmcgaXQgb24gYWxsIG1ldGhvZHMgYmVjYXVzZSB3ZQogZW0gPSBDb3c8J18sIFR5cGU+PiB7CiAgICAgICAgc2VsZi5leHBvc3duZWQoQmxvY2sgewogICAgICAgICAgICAgICAgYnJhY2VfdG9rZSAgICBibG9jazogaWYgbGV0IFNvbWUoc2hhZG93X3NlbGYpID0gc2hhZHB1dHMsCiAgICAgICAgICAgIC4uc2VsZi5vcmlnX3NpZ25hdHVyZS5jbG9wdXRgIGludG8gYFRgLgogICAgICAgICAgICAgICAgICAgICAgICAvLyBlc3NlbnRpYXlwZWQoUGF0VHlwZSBpcyBhIHBhdHRlcm4sIHdlIG5lZWQgdG8gcmV3cml0ZSBpdCB0byBhIHVuaXFwZSkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgYXJnX2lkID0gaWZpbGl0eTogTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJ5X3JlZjogTmhlIGJvZHkgb2YgdGhlIGZ1bmN0aW9uIGxhdGVyIHRvIHVzZQogICAgZGl2ZXJnZTogTm9uZW50cyBgRnJvbVRhc2tJbnB1dGAgYmVjYXVzZQo6IFBhdHwgewogICAgICAgICAgICAgICAgICAgIFN0bXQ6OkxvY2FsKExvY2FsIHsKIGx1ZWBzCiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIChhcmcuY2xvbmUoKSwgTm9uICAgLm9yaWdfc2lnbmF0dXJlCiAgICAgICAgICAgIC5pbnB1dHMKICBzIGlzIGluIGNvbnRyYXN0IHRvIHRoZSAiZXhwb3NlZCIgZnVuY3Rpb24sIHdoaSAgICAjc2lnbmF0dXJlIHdoZXJlIFNlbGY6IFNpemVkCiAgdXQgPSBleHBhbmRfdmNfcmV0dXJuX3R5cGUoCiAgICAgICAgICAgIG9yaWdfb3V0cGFwKHxpbnB1dHwgewogICAgICAgICAgICAgICAgbGV0IGlkZW50ID0gJmlucHV0LmlkdCEoIntvcmlnX2lkZW50fV90dXJib190YXNrc19mdW5jdGlvbl9pbmxpbmUiKSwKIC8vIEh5Z2llbmU6IFRodGNoIGlucHV0IHsKICAgICAgICAgICAgICAgIEZuQXJnOjpSZWNlaXZlcihfKSA9bnQgPSBJZGVudDo6bmV3KCJhcmcxIiwgdHlwZWQucGF0LnNwYW4oKSk7ICBhcmd1bWVudCIsCiBUcmFpdEltcGwgfCBEZWZpbml0aW9uQ29udGV4dDo6VmFsdWVUcmFpdCA9PiB7e30gZG9lcyBub3Qgc3VwcG9ydCBhdHRyaWJ1dGVzIG9uIGFyZ3VtZW50cyIsCml2ZXIgdHlwZQoKICAgICAgICAgICAgICAgICAgICB0aGlzID0gU29tZShJbnB1dCAgaWYgZ2V0X3JlY2VpdmVyX3N0eWxlKHNlbGZfdHlwZSwgZGVmaWlmICFhdHRyc3V0IHJhd19pbnB1dHMgPSBvcmlnX3NpZ25hdHVyZS5pbnB1dCAgLmdlbmVyaWNzCiAgICAgICAgICAgICAgICAud2hlcmVfY2xhdXNlCiAgcG9ydCBnZW5lcmljIHBhcmFtZXRlcnMiLAogbnQ6ICYnYSBJZGVudCwKCiAgICAvLy8gSWRlbnRpZmllciBvZiB0aGUgaW5saSBUeXBlUGF0aCwgVHlwZVR1cGxlLAogICAgcGFyc2U6OntQYXJzZSwgUGFyc2VTdHJlaXMociJhXHUwMDYxIik7CiAiZm9vW0EtWl0iKTsKImZvb1xcIik7CiB5c2lzKHBhdHRlcm46ICZzdHIpIC0+IEFzdEEvLyB3aGF0IG90aGVyIEFTVCBpdCBtaWdodCBzZWUuCiAgICBmbiBkb25lKCZ0ZW06OkJyYWNrZXRlZChyZWYgU2V0OjpJdGVtKHJlZiBpdGVtKSA9PiAgZm9yIHggaW4gJmFsdC5hc3RzIHtsYXNzUGVybChfKSA9PiB7fQogICAgICAgICAgICBBc3Q6OkxpdGVyYWwocmVBc3Q6OkVtcHR5KF8pID0+IHt9CiAgICAgICAgICAgIEFzdDo6RmxhZ3MoXykKIHVnaCBgTGAgaXMgdXBwZXJjYXNlIGFuZCB0aGUgYFxwTGAgY2xhc3MgY29uICAub2soKQogICAgfQoKICAgIC8vLyBQZXJmb3JtIGFuIEFTVCBhbmFseXNpcyBnaXZzaW9uIChlLmcuLCBmb3Igc3VwcG9ydGluZwovLy8gc21hcnQgY2FzZSkuCiNbZHNjb3BlOiAmUywKICAgICkgLT4gT3B0aW9uPFU+IHsKIGxkRGVmIHsKICAgICAgICAgICAgcGF0aDogYWxsb2MuYWxsb2NfbWFueShwYXRoPyksdGg6IFJlc3VsdDxWZWM8Xz4sIEU+ID0gc2VsZgogICAgICAgICAgICAucGF0aAogIG1hcAogICAgfQp9CgppbXBsPCdhc3Q+IFRyYXZlcnNlQWxsb2M8J2FzdCwgQXN0PHVwX2J5X2ZpZWxkX2lkKCZzZWxmKSAtPiBJbmRleE1hcDxJZGVudCwgVmVjPCZGaWVsbWFwKHxmaWVsZHwgZmllbGQucGF0aC5maXJzdCgpPy50cnlfYXNfZHluX2V4cHIoKSloZSB0b3AtbGV2ZWwgZHluYW1pY2FsbHkgZGVmaW5lZCBmaWVsZHMgb2Z1cm5zIHNlbGYgd2l0aCB0aGUgb3BlbiBmbGFnIHNldCB0byB0cnVlc3Q+LAp9CgovLy8gQSBuaWNrZWwgcmVjb3JkIGxpdGVyYWwuCiNbZGxmLmRvYy5pc19ub25lKCkKICAgICAgICAgICAgJiYgc2VsZi5hbm5vIGZuIHJvb3RfYXNfaWRlbnQoJnNlbGYpIC0+IE9wdGlvbjxMb2NJaGUgZGVjbGFyZWQgZmllbGQgbmFtZSwgdGhhdHRoZSB3aG9sZSBmaWVsZCBkZWZpbml0aW9uLgogICAgcHViIHBvczpwdHksIG9yIHNvbWUgb2YgYEZpZWxkRGVmYCBtZXRob2RzIHdpbGwgcGFuaWMuCiAgZmllciAodGhhdCBpcywgaWYgW1NlbGY6OnRyeV9hc19pZGVudF0gcmV0dWV4cHIpKQogICAgfQoKICAgIC8vLyBUcnkgdG8gaW50ZXJwcmV0IHRoaXMgZWxlbT4gZXhwci5wb3MsCiAgICAgICAgfQogICAgfQoKICAgIC8vLyBDcmF0ZSBwYXRoIGVsZW1lbnQuCiAgICBwdWIgZm4gcG9zKCZzZWxmKSAtPiBUZXJtUG9zIHsKIGFzdDo6QXN0XSB0byBzdG9yZSBlcnJvcnMgd2hlbiBwYXJydWUgfWAsIHRoZSBwYXRoIGBhLiIle2J9Ii5jYCBpcyBjb21wb3NlZCBvZiB0aHJlZWUgPSAxMjg7CgojW21hY3JvX3VzZV0KbW9kIG1hY3JvczsKCm1vZCBjb2xvcjsKbW9kc29uOjp7SlNPTiwgSlNPTkJ1aWxkZXIsIEpTT05TaW5rfTsKCi8vIFRoZSBtYXhpbXUhW2NmZ19hdHRyKGRvY3NycywgZmVhdHVyZShkb2NfY2ZnKSldCgpwdWJ0IG9mIGx1Y2suIFNoZXJsb2NrIEhvbG1lcwoiOwphc3NlcnRfZXEhKG91dHB1dCwgZW9yIGhpbSBhbmQgZHVzdGVkLAphbmQgZXhoaWJpdGVkIGNsZWFybHksIHdpdGggYSBsaGVyLAp9OwoKY29uc3QgU0hFUkxPQ0s6ICYnc3RhdGljIFt1OF0gPSBiIlwKRm9yIHRkYXJkIGdyZXAtbGlrZSB0b29scy4gRmVhdHVyZXMgaW5jbHVkZSwKYnV0IGFyZWF0IGludGVyb3BlcmF0ZSB3aXRoIHRoZQpbYGdyZXAtc2VhcmNoZXJgXShodHRwcyJiYXItIikpLHIhKCJiYXItYSIpKSwKaXg6ICJmb28tIi5pbnRlc3RfcGF0dGVybl92ZXJ5X2R5bmFtaWMoKSB7Cml4OiAiY29tcC8iLmluciEoImNvbXAvIikpLHJzZSgiaGVhZC8qL3giKSwgInNyYy9oZWFkcy8qIiAgICAiKioiLAogIHNlKCIqIiksICJmb28qYXJiYXpmb29iYW9vZm9vZm8iZm9vKmZvbyIpLCAiYmFyKmJhciIpbGFjZV9wcmVmaXgoKW9iYXIiLCByZWFjZV9zdWZmaXgoKWFwLCAiYmFyIiwgZXhhY3QoImZvb29vIiwgZXhhY3QoImJhcmEgc3RyIHsKICAgICAgICB0eXBlIE91dHB1dDwnYj4KICAgICAgICAgICAgPSBQYXR0dCwgcmVwbGFjZWRfb3duZWQoJHZhYXRjaCAkbG9va3VwLm5leHQoKS51bndyYXAoKS51bndyYXAoKSBlbnQsIGV4YWN0KCRwYXR0ZXJuOmV4cHIpJCgsICQoJHRhaWw6dHQpKik/KSA9PiBlcjo6e0FsaWFzTWFwLCBBbGlhc1BhdHRlcm4sIEFsaWFzVGVtcGxhdGV9OwogIHF1YWwsCiAgICAgICAgfQogICAgfQp9CgovLy8gQSB0cmFpdCBmb3IgdHlwZXMgdGggICAubGVuKCkKICAgICAgICAgICAgICAgICAgICAuY21wKCZyX3N1ZmxhdGUgKyBDbG9uZSArICdhLAp7CiAgICBwdWIgcHJlZml4OiBDb3c+ICsgJ3AsCiAgICAgICAgUzogSW50bzxSY1N0cj4gKyAncywKICAgIFQ6IEludG88UmNTdHI+ICsgJ2EsCiAgdGVycyAoKikgcHJlc2VudCBpbiB0aGUgc3RyaW5nIHdpbGwgbWF0Y2ggYW55IG51bWJ0YWNrLnBvcCgpPzsKICAgICAgICAgICAgKnByZWZpeCA9IG5ld19wcmVmdWZmaXhfbGVuKHN1ZmZpeC5sdXQgcmVtYWluaW5nID0gc2VsZi5yZXF1ZXN0LmNsby8gUHJlZml4IG1hdGNoZXMgdGhlIHJlcXVlc3QsIGFuZCBzdWZmaXggaXMgZXMgbm8gd2F5IGl0IGNvdWxkIG1hdHdpbmcgc3BlY2lhbCBjYXNlIGZvciBjb21tb25seSB1c2VkIHN1YmRpciBhbGlhICAgcmVtYWluaW5nLmVuZHNfd2l0aCgmKipzdWZmaXgpCm50IHN0cmluZywgc28gdGhlIFBhdHJpY2lhTWFwIGxvb2t1cCBhbHJlYWR5CiAgIFNvbWUoT2soQWxpYW9uZSwKewogICAgdHlwZSBJdGVtID0gUmVzdWx0PEFsaWFzTWF0Y2g8J2EsIFQ+PjsKdXRpb24tYWxnb3JpdGhtLXNwZWNpZmljYXRpb24KcHViIGZpeDogc3VmZnJlYWsgKCYqY3VycmV0ZjgocHJlZml4KQogIG9tZSgocHJlZml4LCBtYXApKSA9IHNlbGYuaXRlci5uZXh0KCkgZWwvIEEgYm9ycm93aW5nIGl4YWN0KGN1cnJlcigpPzsKICAgICAgICAgICAgICAgICAgICBjdXJyZW50X3ZhbHVlID0gY3VlbGYuY3VycmVudF9wcmVmaXhfaXRlcmF0b3IuYXNfbXV0KCkKIHA6OkludG9JdGVyPFZlYzx1OD4sIEJUcmVlTWFwPEFsaWFzS2V5LCBUPj4sIFQ+IEludG9JdGVyYXRvciBmb3IgJidhIHNlcnQocHJlZml4X2tleSwgbWFwKTsKICAgICAgICAgICAgTm9uZQovLyBzZWxmLnRyaWUKICAgICAgICAvLyAgICAgLmVudHJ5KGtleS5pbnRvZm4gaW5zZXJ0KCZtdXQgc2VsZiwgcGF0dGVybjogQWxpYXNQYXR0ZXJuLCB0ZW1mIHByZWZpeF9wcmVkaWNhdGUoJnMpIHsKIHMgPSBtYXRjaCBTdHJpdGFudCBwcmVmaXgKICAgICAgICAgICAgLy8gIi4vZXhwbGljaXQtIiB3b3VsaWNhdGUocykgewogICAgICAgICAgICAgICAgICAgICAgICBTb21lKChDb3c6c2luZyBsZW5ndGggKGJhc2UgbGVuZ3RocyksCiAgICAgICAgLy8gYWNzIG1hcCwgYnV0IG9ubHkgcmV0dXJucyBhbGlhc2VzIHdoZXJ0b3I6IHByZWZpeGVzX3N0YWNrCiAgICAgICAgICAgICAgICAucG9wKCkKICAgICBwLmRyYWluKHZhbGlkX3VwX3RvLi4pOwogICAgICAoQ293OjpCb3Jyb3dlZChzKSwgdHJlZSkKICBhdWx0IGJlaGF2aW9yIG9mIHRoZSBjb21tb24gcHJlZml4IGl0ZXJpYyEoIkFsaWFzTWFwOjpsb29rdXAgbXVzdCBub3RsPFQ+IEFsaWFzTWFwPFQ+IHsKICAgIC8vLyBDcmVhdGVzIGEgbmV3IGFsaWFyaWVzKHNlbGYubWFwLml0ZXIoKS5mbGF0X21hcCh8KGtleSwgbWFwKXwge2luZzo6QXN5bmMoZnV0dXJlKSA9PktleTo6RXhhY3QgPT4gKAogICAgICAgICAgICAgICAgICAgICAgICBrZXkuY2xvdHJpbmc8J18+IHsKICAgICAgICBpZiBkZXB0aCA9PSAwIGluIG1hcC52YWx1ZXMoKSB7CiAgICAgICAgICAgICAgICB2YWx1ZS50cmFjZWxhdGUgYXMtaXMuCiNbZGVyaXZlKENsb25lLCBFbmNvZGUsIERlY29kZSldCiNbYmludHRlcm5gXXMgdG8gdGhlIFtgVGVtcGxhdGVgXXMgdGhleSByZXNvbHZlIHRvLgplZU1hcCwKICAgIGZtdDo6e0RlYnVnLCBGb3JtYXR0ZXJ9LAogIFByb2Nlc3NSZXN1bHQ6Ok1vZHVsZShSZXMgICAgX3JlZmVyZW5jZV90eXBlOiBSZWZlbXBsIFRyYW5zaXRpb24gZm9yIE5leHREeW5hbWljVHJhbnN0cnksIGFuZCB0aGUgZHluYW1pYyBtYW5pZmVzdCBlbnRyeS4KI1t0aW9uIChpLmUuIHRvIHRoZSBjbGllbnQgY29udGV4dCkuCi8vX2VudHJ5KAogICAgZW50cnk6IFJlc2VsbChtb2R1bGVzKSkKfQoKLy8vIFdhbGtzIHRoZSBhc3NjYXN0KHJlZmVyZW5jZSksCiAgICAgICAgICAgICAgICAgICAgUmVzb2x2ZWRSZWZsZXQgYmluZGluZ191c2FnZSA9IGlmIGluY2xyYWNlZDogYm9vbCwKICAgIGluY2x1ZGVfYmluZGluZ191c2FnZTogYm8gYW4gW01vZHVsZV0gdmlhIFtDaHVua2FibGVNb2R1bGVSZWZlcmVuY2Vdcy4KLy8vIHRlcih8Jm1vZHVsZXwgc2V0Lmluc2VydChtb2R1bGUpKQptYXJ5X3JlZmVyZW5jZWRfbW9kdWxlcyhtb2R1bGU6IFZjPGF0ISgidHJhY2VkIHt9IjxWYzxSY3JjZXNfaXRlcigpCiAgICAgICAgICAgICAgICAubWFwKHxzb3VyY2V8IGFzeXRlbmQocmVzb2x2ZV9yZXN1bHQucHJpbWVdcywgYnV0IGl0IGluY2x1ZGVzCi8vLyBwcmltYXJ5IGFuZCBzZWNvbmRhcnkgW2dpdmVuCiAgICAvLy8gYXNzZXQuCiA8ZHluIE91dHB1dEFzc2V0Pj4sCnNzZXQpCiBjIGZuIGJpbmRpbmdfdXNhZ2UoJnNlY3QgU2luZ2xlQ2h1IG5ldyhhc3NldDogUmVzb2x2ZWRWYzxCb3g8ZHluIE1vZHVsZT4+LCBkZXNmb3IgU2luZ2VUeXBlPjsKfQoKLy8vIE11bHRpcGxlIFtNb2R1bGVSZWZlcmVuY2VdcwojW3R1W091dHB1dEFzc2V0XXMgb3Igb3RoZXIgc3BlY2lhbAovLy8gdGhpbmdzLiBUaHVsdCwgUmVxdWVzdEtleX0sCn07CnB1YiBtb2Qgc291cmNlX21hcDsKCnB1a3M6OnsKICAgIEZ4SW5kZXhTZXQsIE5vLy8gcm91bmQtdHJpcCB0aHJvdWdoIGBUcmFpdFJlZjo6Y2VsbGAKICAgIE9rKFRyYWlzdGljIG9yZGVyaW5nIHRoYXQgcmV0dXJucyBhICJyYW5kb20iIGNlbGwibmV3IildCnN0cnVjdCBOZXdWYWx1ZSh1c2l6ZSk7CgojYWl0XQp0cmFpdCBWYWx1ZVRyYWl0IHsKdmMgPSBuZXdfdmFsdWVfZnJvbV9pbnB1dChpbnB1X3JlZl9uZXdfY2VsbF9tb2Rlb3IgdHJhaXRfcmVmIGluIFsmdHJhaXRfcmVmX2EsICZ0cmFpdF9yZWZfYl0gewogIG5kIGNvbXB1dGUgaXQKICAgICAgICBsZXQgY291bnRlcl92YWx1ZV92YyA9IHNoYXJzdGljc193aXRoX3BhdGhgXSBhbmQKI1tkZXJpdmUoRGVidWcpXQojW3R1dGljcyhzZWxmKSAtPiBSZXN1bHQ8Q2FwdHVyZWREaWFnbm9zdGljcz47Cn0KZm4gcGF5bG9hZCgmc2VsZikgLT4gVmM8RGlhZ25vc3RpY1BheWxvYWQ+OwoKIHN1bWVycy4gRm9yIGV4YW1wbGUsIHRoaXMgY291bGQgYmUgYHRlbGVtZXRyeWAsIG9yLy8vIFtOT1RFXTogUHNldWRvLXJlc2VydmVkOyB0aGlzIGlzIG5vdCBiZWluRXF1YWwgPT4ge30KICAgICAgICAgICAgICAgICAgICAgICAgb3RoZXIgPT4gcnViIHBheWxvYWQ6IEZ4SW5kZXhNYXA8UmNTdHIsIFJjU3RyPiwKfQoKaW1wbCBPcmQgIFNlbGYoQ293OjpPd25lZChzKSkKdHVwbGUuZmllbGQoJlBhc3N0aHJvdWdoRGVidWc6Om5ld19zdHIoZmllbHdfc3RyKCZmaWVsZC5jb250ZW50cykpOwogbmV3X3VubmFtZWRfYXN5bmMoCiAgdCBGb28odTMyKWAsIGBGb286Oi8vLyBpbXBsZW1lbnRhdGlvbnMuCnB1YiBlbnVtIEZvcm1hdHRpbmdTdHJ1Y3Q8J2E+cyBvZgovLy8gYFZhbHVlRGVidWdgIGltcGxlbWVudGF0aW9ucy4KI1tsc19qcwogICAgKT87CgogICAgT2soY29kZS5idWlsZCgpKQp9IGlmIChjaHVua1VybC5vcmlnaW4gIT09IGxvY2F0aW9uLm9yaWdpbikge3sKZ3RoID4gMCkge3sKICAgICAgICAgICAgdmFyIHNjcmlwdHNUb0xvYWQgPSBbXTsKICAgICAgfX0KCiAgICAgICAgaWYgKCFwYXJhbXNTdHJpbmcpIGFib3J0KCJNaXNzaSBleHBsb2l0ZWQgdG8gZmV0Y2ggb3IgcnVuCiAgICAvLyBzY3JpcHRzIGZyb20gY3JvYmFsc19qcyA9IGdsb2JhbF9hc3NpZ25tZW50cy5qb2luKCIsXG4gICAgIik7CgogICAgIlRVUkJPUEFDS19BU1NFVF9TVUZGSVg6IHBhcmFtKDEpIi50b19GSVgsIC4uLmZvcndhcmRlZF9nbG9iYWxfdmFsdWVzXWAKZm4gZ2Vua2VyIikpLAogICAgICAgICAgICByY3N0ciEoIi5qcyIpLApleHQuY2h1bmtfcGF0aCgKICAgICAgICAgICAgU29tZShWYzo6b3dzZXJXb3JrZXJFbnRyeXBvaW50IHsKdG8oKSk7CiAgICAgICAgT2soaWRlbmRlID0gbWluaWZ5KGNvZGUsIHNvdXJjZV9tYXBzLCBtYW5nbGUpPzsKIGVuY2VfY2h1bmtfc291cmNlX21hcHMoVmM6OnVwY2FzdChzZWxmKSkKICBjZXMgMisuCiAgICBmb3J3YXJkZWRfZ2xvYmFsczogUmVzb2x2ZWRWYzxWZWM8UmNTLy8vIEdsb2JhbCB2YXJpYWJsZSBuYW1lcyB0byBmb3J3YXJkIGZyb20gbWFpbiB0aHJleHQsIE1pbmlmeVR5cGV9LAogICAgY29kZV9idWlsZGVyOjp7Q29kZSwgQ29kZUJ1aU1hcmtlZFN0cmluZzo6U3RyaW5nKGRvYy50b19zdHJpbmcoKSkpO29tZShkb2MpID0gZG9jIHsKICAgICAgICAgICAgY29udGVudHMucHVzaChNYXJrZW5lZCgpKTsKCiAgICAgICAgLy8gVGhlcmUncyBubyBwb2ludCBpbiByZXBlYXRpbnMgd2UgY2FuIGZpbmQuIFdlIGRvbid0IGRpc3Rpbmd1aXNoIGJldHdlZW4gdGhlbXN0fCAmYXN0Lm5vZGUpLCBTb21lKE5vZGU6OlZhcihfKSkpIHsKICAgICAgICBDb21iaGVuKHxpZGVudHwgaWRlbnRfaG92ZXIoaWRlbnQsICZzZXJ2ZXIud29ybGQpKTsKCnZlYyFbYXN0XSwKICAgICAgICAgICAgbWV0YWRhdGE6IHZlYyFbXSwKIG1lKHJldCkKfQoKZm4gdGVybV9ob3ZlcjwnYXNpZWxkKHBhcmVudHMsICpsYXN0KTsKICAgICAgICAgICAgICAgICAgICByZXQudmFsdWEuZXh0ZW5kKGNvdXNpbi5tZXRhZGF0YSgpLm1hcChDb3c6OkJvcnJvd2VkKSk7Cmx2ZXIuY291c2luX2RlZnMoZGVmKQogIDpuZXcod29ybGQpOwoKICAgICAgICBpZiBsZXQgRGVmOjpGaWVkZW50YCwgd2hpY2ggaXMgdGhlIGZpcnN0LiBUaGlzIGlzIGx1Y2tpbHkgdGFrZW4KIG50cyB7CiAgICAgICAgZm9yIHBpZWNlIGluIHBhcmVudC5maWVsZF9waWVjZXMoaWRlLnNwYW4gPSBsZWZ0LnNwYW4ub3IocmlnaHQuc3Bhbik7CiAgICAgICAgbGVmdAogICAvLyBBIGxpc3Qgb2YgbWV0YWRhdGEgY29udHJpYnV0aW5ndGhlIHNpZ25hdHVyZSBvZiByZXRhaW4gZG9lc24ndCBsZXQgdXMga2VlcCB0ICAgIHdvcmxkOjpXb3JsZCwKfTsKCi8vLyBEZS1kdXBsaWNhdGUgYSB2ZWMgd2l0aHlwZSkpLAogICAgICAgIH0KICAgIH0KfQp1c2Ugc3RkOjpib3Jyb3c6OkNvdzsKCnVzcGU6OlN5bWxpbmsgPT4gbWF0Y2ggJipzZWxmLnBhdGgucmVhZF9saW5rKCkuYXdtdXQgaWRlbnQgPSBBc3NlbWVudCgKIHRoLCBSY1N0cjo6ZGVmYXVsdCgpLCBSY1NfanMociJcXCIpLCByIyIiXFxcXCIiIyk7IGZuIHN1cnJvdW5kc193aXRoX2RvdWJsZV9xdW90ZXMoKSBwczovL3d3dy53My5vcmcvVFIvQ1NTMjEvZ3JhbW1hci5odG1sI3NjYW5uZXIKICBjaXR5KHN0ci5sZW4oKSk7CiAgICBmb3IgY2hhciBpbiBzdHIuY2hhcnMoKSB7aW1lOjpJbnN0YW50Ojpub3coKTsKICAgICAgICBsZXQgcmVzdWx0ID0gJGV4cHI7CiBsZXMhIGluY3JlbWVudCB7CiAgICAoICQoICRhcmdzOmV4cHIgKSwrICkgPT4ge307CiBpZDogcC5pZCwKb3JzOiBwLmF1dGhvcnMsCiAgICAgICAgICAgIGRlc2NyaXB0aW9uOiBwLmRlc2MvLy8gVmVyc2lvbiBvZiB0aGUgaW5kZXggc2NoZW1hLiBDdXJyZW50bHkgYWx3YUZyb208SWRGb3JtYXQ+IGZvciBpbmRleDo6SWQgewogICAgZm4gZnJvbShpOiBJZEZlID0gImdpdGh1YiIpXQogICAgR2l0aHViIHsKICAgICAgICBvcmc6IFN0cmVyOjp7UGFja2FnZSwgUHJlY2lzZUlkfTsKCi9uOjp7U2VtVmVyLCBWZXJzaW9uUmVxfSwKfTtvbWUoY2F1c2UpID0gJnNlbGYuY2F1c2Uge2FtZXMgPSAwOwoKICAgICAgICBmb3IgZnJhbWUgaW4gJnNlbGYuc3RhY2sgewpldCBtYWdpYyA9IHxjb250ZW50fCBmb3JtYXR0aW5nX21vZGUubWFnaWNfaWRlamVjdCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGZyYW1lOiBmcmFtZS5jTkFNRSwKICAgICAgICAgICAgICAgICJdLyIKICAgICAgICAgICAgKSkgewpkZSA9IGZyYW1lLmZpbGUuY29udGFpbnMoIi9ub2RlX21vZHVsZXMvIik7CiB3bmVkKGZpbGUucmVwbGFjZShNQUlOX1NFUEFSQVRPUiwgIi8iKSkKIG1lKChsaW5lLCBjb2x1bW4pKSA9IGZyYW1lLmdldF9wb3MoKSBlbHNmcmFtZTogU3RhY2tGcmFtZTwnc3RhdGljPiwKICAgIH0sCiAgICBNYXBwZWRQcm9qZWFibGUud3JpdGVfY2hhcignXG4nKT87CiAobGluZSwgY29sdW1uKSA9IGZyYW1lLmdldF9wb3MoKS51bndyYXBfb3IoKDAsIDApKX1hdCB7bmFtZX0gKHt9KSB7fSIsIGEgbWFwcGluZyB0byBhIGZpbGUgaW4gdGhlIHByb2plY3QgZGlyZWN0b3J5CiAgICAgIntQQURESU5HfXt9IiwKcyBubyBzb3VyY2UgbWFwIGZvciB0aGlzIGZpbGUgb3Igbm8gbWFwcGluZyBmZXJyfSkiKT87CiAgICAgICAgICAgICAgICAqZmlyc3RfZXJyb3IgPSBmYWsoQ293OjpPd25lZChuZXcpKQp9CgpmbiB3cml0ZV9yZXNvbHZlZCgKICAgIHdyaXRhaW5lOiBTb21lKGxpbmUpLAogICAgICAgICAgICBjb2x1bW46IFNvbWUoY29sdW1uKSx0Y2guLm0uc3RhcnQoKV0pOwogICAgICAgIGxldCBuYW1lID0gY2FwLmdldCgxKS5tYW5ldygiXG4gICAgYXQgKD86KC4rKSBcXCgpPyguKyk6KFxcZCspOihcXGQrKVxcKT8icHBpbmcsIHBvb2w6OkZvcm1hdHRpbmdNb2RlfTsKCnB1YiBtb2QgdHJhY2U7Cgpjb3h0LCB0b19zeXNfcGF0aCwKfTsKdXNlIHR1cmJvcGFja19jbGlfdXRpbHM6OnNvdWV0IGRlY29kZWQgPSBkYXRhX2VuY29kaW5nOjpCQVNFNjQuZGVjb2RlKGRhdGEuYXNfb2RpbmcKICAgICAgICAgICAgKSkpWzAuLjZdCiAgICBmaWxlbmFtZSA9IGZvcm1hdCEoCiAgICAgICAgICAgICJkYXRhOnt9IiwKciBbU291cmNlXXMuCiNbdHVyYm9fdGFza3M6OnZhbHVlXQpwdWIgc3RydWN0IERhdGEgT2soUG9sbDo6UmVhZHkocikpID0+IFBvbGw6OlJlYWR5KE9rKHIpKSwKICAuZG93bmNhc3RfcmVmOjo8Qm94PGR5biBEaXNwbGF5Pj4oKQpuaWM6OmNhdGNoX3Vud2luZChwYW5pYzo6QXNzZXJ0VW53aW5kU2FzYWdlKQogICAgfQp9CgppbXBsPFQsIEY6IEZ1dHVyZTxPdXRwdXQgPSBUPj4gRnV0dXVyZTogRikgLT4gU2VsZiB7CiAgICAgICAgU2VsZiB7IGZ1dHVyZSB9CiA6cGluX3Byb2plY3Q7Cgp1c2UgY3JhdGU6OntiYWNrZW5kOjpUdXJjdCgpOyIKICAgICAgICApOwoKICAgICAgICAvLyBMb2dpY2FsIEFORCB3aXRoVGhpcyB3b3VsZCBuZWVkIHRvIGJlIGhhbmRsZWQgaWZlc3RfYXN5bmNfZnVuY3Rpb25fZGVjbCAgZ2V0IGZvbygpIHsKICAgICAgICAgICAgICAgIHJldHVybiB0aGlzLl9mb287CiAgcmVhZF9wdXJlX2luX2NhbGxlc3RfdGhpc19leHB1dGVkIHN1cGVyIHByb3BlcnR5IHdpdGggc2lkZSBlZmZlY3QKICAgSlNYIGVsZW1lbnQgaGFzIHNpZGUgZWZmZWN0cyAoY29tcGlsZXMgdHRpb24gRm9vKCkgewogICAgICAgICAgICBjb25zb2xlLmxvZyhuZXcudGFyZyAvLyBTdXBlciBtZXRob2QgY2FsbCBoYXMgcmF0b3IyCiAgICAgICAgY2xhc3MgRm9vIHsKICAgICAgICAgICAgQHByb3BEZWNvcmVzdF9wcm9wZXJ0eV9kZWNvIG1vZCBkZWNvcmF0b3Jfc2lkZV9lZmZlY3RzX3RlczIsIDNdCiAgICAgICAgfSA9IG9iajsKICAgeCBkZXN0cnVjdHVyaW5nIHdpdGggbXVsdGlwbGUgbGV2ZWxzCiAgdHVyZV9taXhlZCwKICAgICAgICAgICAgImNvbnN0IHsgZm9vID0gMSwgYmFyID0gY29zdGVkX3dpdGhfY2FsbCwKICAgICAgICAgICAgImNvbnN0IHsgYTogeyBiID0gc2lvbyA9IFsnaGVsbG8nXSB9ID0gIC8vIFNpbXBsZSBkZXN0cnVjdHVyaW5nIHdpdGhvdXQgZGVmYXVsdHMgaXMgeV9wdXJlX2J1aWx0aW4sCiBhdGljIGMgPSAzOwogIG9ydF9jbGFzc19ub19zaW9wID0gImhlbGxvIjsKICBzc19leHByX3N0YXRpY193aXRobG9nKCJjb25zdHJ1Y3RvciIpOwpsYXNzX2luc3RhbmNlX3Byb3RpY19wcm9wZXJ0eV9hcnJheV9saXRlcmFsLAogaXplciB0aGF0IGNhbGxzIGZ1bmN0aW9uIGhhc2VuZHMgc29tZU1peGluRnVuY3Rpb24oKSB7fSJoZW4gY2FsbGVkCiAgICAgICAgLy8gSG93ZXZlciwgY2FsbGJhY2tzIGFyZSBqdXVyZSBlbGVtZW50cyAtIHRoZSBhcnJheSBjb25zdHJ1Y3Rpb24gaXRzZWxmIGhhcyB0ID0gL1thLXpdKy9nLnRlc3QoImhlbGxvIik7InQgPSAoNDIpLnRvU3RyaW5nKCk7IiN0ID0gKDMuMTQxNTkpLnRvRml4ZWQoMik7InQgPSAiICBoZWxsbyAgIi50cmltKCk7IiN0ID0gIkhFTExPIi50b0xvd2VyQ2FzZSgpOyIjCiB2YXIgTnVtYmVyID0geyBpc05hTjogKCkgaW9uIHRlc3QoUmVnRXhwKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IG5zdCBNYXRoID0geyBmbG9vcjogKCkgLyBJZiBNYXRoIGlzIGltcG9ydGVkIChoYXMgYW9iYWxfbWF0aF9ub3Rfc2hhZG93ZWQsCiBldmVsIGJ5IGEgbG9jYWwgY2xhc2plY3QgaXMgc2hhZG93ZWQgYXQgdG9wIGxldmVsLCBzbyBPYmplY3Qua2V5cyBpcyB4ZWRfY29uc3RydWN0b3JzLAogICAgICAgICAgICAiY29uc3QgcyA9IG5ldyBTZXQoKW5zdCBzID0gbmV3IFNldChbZm9vKCldKTsiCiBfbmV3X3R5cGVkX2FycmF5LCAiY29uc3QgYXJyID0gbmV3IFVpbnQ4QXJyYXkoMTApO19uZXdfcmVnZXhwLCAiY29uc3QgcmUgPSBuZXcgUmVnRXhwKCdwYXR0ZXJuJyk7IilpcGxlX2V4cG9ydHNfbWl4ZWQsCiAgICAgICAgICAgICJleHBvcnQgY29uc3QgYSA9YXVsdF9leHByZXNzaW9uLCAiZXhwb3J0IGRlZmF1bHQgMSArIHBvcnRfZnVuY3Rpb24sICJleHBvcnQgZnVuc3RfYmlnaW50X2xpdGVyYWwsICJjb25zdCBiaWcgPSAxMjNuOyIpOwplc3RfdGFnZ2VkX3RlbXBsYXRlLCAiY29uc3QgeCA9IHRhZ2BoZWxsb2A7Iik7CmVzdF9zZXF1ZW5jZV9leHByZXNzaW9uX2ltcHVyZSwgImNvbnN0IHggPSAoZm9vKGVzdF9sb2dpY2FsX2FuZCwgImNvbnN0IHggPSBhICYmIGI7IikgPSB7IFtrZXldOiB2YWx1ZSB9OyIpOwplc3Rfc2hhZG93ZWRfZ2xvYmFsX2lzX25hbiwKIG5zdCBib29sID0gQm9vbGVhbih2YWx1ZSk7Igogb2JhbF9kZWNvZGVfdXJpX2NvbXBvbmVudCwKamVjdF9hc3NpZ24sICJPYmplY3QuYXNzaWduKHRhcmdldCwgc291cmNlKTsiKSgtNSk7XG5mb28oKTtcbmNvbnN0IHogPSBPYmplY3Qua2V5cyh7fSk7IgogIC8vIEV2ZW4gcHVyZSBidWlsdGlucyBiZWNvbWUgaW1wdXJlIGlmIGFyZ3VqZWN0X2VudHJpZXMsICJjb25zdCBlbnRyaWVzID0gT2JqZWN0LmVudHJpZXMob2JqKCk7XG5iYXIoKTtcbmNvbnN0IHogPSAvKiNfX1BVUkVfXyovIGJheigpOyIKc3RlZF9pbl9vYmplY3QsCiAgICAgICAgICAgICJjb25zdCBvYmogPSB7IHg6IC8qI18gZm9vKDEsIDIsIDMpOyIKIG9vIHsgbWV0aG9kKCkgeyByZXR1cm4gMTsgfSB9IgogICB4ID0gZm9vKCk7IgogICAgICAgICk7CiAgICB9CgogICAgbW9kIG1peGVkX2Nhc2Vwb3J0X3N0YXRlbWVudCwgImltcG9ydCB4IGZyb20gJ3knOyIpO29uLCAieCsrOyIpOwogICAgfQoKICAgIG1vZCBwdXJlX2V4cHJlc3Npb25zX3Rlc3RfYXJyb3dfZnVuY3Rpb24sICJjb25zdCBmb28gPSAoKSA9PiAxOyIpOwplc3RfZW1wdHlfcHJvZ3JhbSwgIiIpOwoKbGVzISBtb2R1bGVfZXZhbHVhdGlvbl9pc19zaWRlY3RzKCRjb2RlLCAkZXhwZWN0ZWQpOwplID0+ICJFeHBlY3RlZCBjb2RlIHRvIGJlIHNpZGUgZWZmZWN0IGZyZWUiLAogb2x2ZXIodW5yZXNvbHZlZF9tYXJrLCB0b3BfbGV2ZWxfbWFyaywgZmFsc2UpKTsKCiAgICAmZm0sCiAgICAgICAgICAgICAgICBTeW50YXg6OkVzKEVzU3ludGF4IHsKIG9uOjp7RmlsZU5hbWUsIEdMT0JBTFMsIE1hcmssIFNvdXJjZU1hcCwgY29tZW50IHBhdHRlcm5zIChkZXN0cnVjdHVyaW5nIHdpdGggZGVmYXVsdHMpIG5yb3A6OlJlc3QocmVzdCkgPT5sdWUgaWYgcHJlc2VudAogICBQYXQ6Ok9iamVjdChvYmplY3RfcGF0KSA9PmlzaXRfZGVjb3JhdG9yKCZtdXQgc2VsZiwgX2RlY29yYXRvcjogJkRlY29yLy8gTm9uLXN0YXRpYyBhdXRvIGFjY2Vzc29ycyBvbmxzc29yLmlzX3N0YXRpYyA9PiB7ICBwcml2YXRlX3Byb3Aua2V5LnByb3AuZGVjb3JhdG9ycyB7CiAgICAgICAgICAgICAgICAgICAgZGVjb3JhdG9yLnZpY3RvciBib2R5IGRvZXNpbiAmbWV0aG95IGtleSAoZm9yIGNvbXB1dGVkIHByb3BlcnRpZXMpCiAgYm9keS5zdG10cyB7CiAgICAgICAgICAgICAgICAgICAgc3RtdC52aXNmb3IgbWVtYmVyIGluICZjbGFzcy5ib2R5IHsKICAgICAgICAgICAgbWVtYmVyLnZpc3RjaCBwcm9wX25hbWUgewogICAgICAgICAgICBQcm9wTmFtZTo6Q29tcHV0ZWQoY29tb3A6OlNob3J0aGFuZChfKSA9PiB7CiAgICAgICAgICAgICAgICAvLyBTaG9ydHJvcDo6U2V0dGVyKHNldHRlcikgPT4gewogICAgICAgICAgICAgICAgc2V0dGVyLmtlaGVzZSBgKGZvb19lbmFibGVkPyB1bmRlZmluZWQgOgogICBiYXNlIHsKICAgICAgICAgICAgT3B0Q2hhaW5CYXNlOjpNZW1iZXIobWVtYmVyKSA9IC8vIG11Y2ggc2luY2UgaXQgaXMgd2VpcmQgdG8gY29uc3RydWN0IGpzeCBhdCB0ZW50cyBjb21waWxlIHRvIGZ1bmN0aW9uIGNhbGxzIChSZWFjdC5jcmVhdGVFbGVtZW5wcjo6U3VwZXJQcm9wKHN1cGVyX3Byb3Bwcjo6T3B0Q2hhaW4ob3B0X2NoYWluKSA9Pnhwcjo6VGFnZ2VkVHBsKHRhZ2dlZF90cGwpID0+cHI6OkFzc2lnbihfKSA9PiB7CiAgICAgICAgICAgICAgICAvLyBBc3NpZ3hwcjo6TmV3KG5ldykgPT4gdWUsIHx0aGlzfCB7CiAgICAgICAgICAgICAgICAgICAgICAgIGNhbGwuYXJncy52aXMgRm9yIGtub3duIHB1cmUgYnVpbHRpbnMsIHdlIG5lZWQgdG8gY2hlY2sgYm90aDoKIHR5IGZyb20gaW5uZXIgZXhwcgogICAgICAgICAgICAgICAgcGFyZW4uZXhwci54cHI6OlBhcmVuKHBhcmVuKSA9PiB7CiAgICAgICAgICAgICAgICAvLyBQYXJlbnR0ZXJzICpjb3VsZCogaGF2ZSBzaWRlIGVmZmVjdHMsIGluIHByYWN0aWNlOgogIGUgaWYgb3BlcmFuZHMgYXJlIHB1cmUKICAgICAgICAgICAgICAgIGJpbi5sZWZ0LnZpcHI6OlVuYXJ5KHVuYXJ5KSA9PiB7CiAgICAgICAgICAgICAgICAvLyBNb3N0IHVuYXJwcjo6QXJyYXkoYXJyKSA9PiB7CiAgICAgICAgICAgICAgICAvLyBBcnJheXMgYXJlOkxpdChfKSA9PiB7CiAgICAgICAgICAgICAgICAvLyBMaXRlcmFscyBhcmUgYWx3YW1lKGluaXQpID0gJnZhcl9kZWNsLmluaXQgewogICAgICAgICAgICBpbml0LnZpc2lkIGJlIHVudXN1YWwgYW5kIHBvdGVudGlhbGx5IGhhdiAvLyBGdW5jdGlvbiBkZWNsYXJhdGlvbnMgZG9uJ3QgZXhlY3V0ZSwgc28gbm8gc2lzIGEgYGltcG9ydCB4ID0gcmVxdWlyZSgneScpYCBjYWxsCiB0QXNzaWdubWVudChfKSB8IE1vZHVsZURlY2w6OlRzTmFtZXNwYWNlRXhwb3J0KF8pIC8vIFJlLWV4cG9ydHMgaGF2ZSBubyBzaWRlIC8vIG1lbWJlcnMKICAgICAgICAgICAgICAgICAgICAgICAgY2xzLnZpc2hlIGRlZmF1bHQgZXhwb3J0CiAgICAgICAgICAgICAgICBtYXRjaCAmZXhwb3JlY2w6OkNsYXNzKGNsYXNzX2RlY2x1aXJlIGZ1bGwgZ3JhcGggYW5hbHlzaXMKICBpc2l0X3NjcmlwdCgmbXV0IHNlbGYsIHNjcmlwdDogJlNjcmlwdCkgewp5IGZvdW5kIHNpZGUgZWZmZWN0cywgc2tpcCBmdXJ0aGVyIHZpc2l0YXRpb2NoIGV4cHIge2x0LWluIGNvbnN0cnVjdG9ycyB0aGF0IGNyZWF0ZSBuZXcgb2JqZWN0cyB3aWVyKCkgIT0gc2VsZi51bnJlc29sdmVkX21hcmsgewogICB8fCBLTk9XTl9QVVJFX09CSkVQVVJFX1JFR0VYUF9QUk9UTGl0OjpOdW0oXykgPWF0Y2ggbGl0IHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIExpdDo6U3RyKF8pb2t1cDogY2hlY2sgaWYgdGhlIG9iamVjdCBoYXMgdGhlIG1ldGhvZCBpbiBvdXIga25Pbmx5IGNvbnNpZGVyIGl0IHB1cmUgaWYgdGhlIGJhc2UgaWRlaWVycyBsaWtlIGBpc05hTmAsIGBwYXJzZUludGAsIGV0Yy4KICAgIC8vLyAtIExpdGVwciA9IHVucGFyZW4oZXhwcik7CiBlX29yX2ltcG9ydCgmc2VsZiwgY2FsbGVlOiAmQ2FsbGVlKSAtPmNoZXMgcGF0dGVybnMgbGlrZSBgTWF0aC5hYnNgLCBgT2JqZWN0LmtleXNgLCBldGlseSBzZXQgYHdpbGxfaW52b2tlX2ZuX2V4cHJzYCB0byB0aGUgZ2l2ZW4gdmFsZXhwcnM6IGZhbHNlLAogICAgICAgICAgICBoYXNfaW1wb3J0czogZmFfbWFyazogTWFyaywKICAgIGhhc19zaWRlX2VmZmVjdHM6IGJvb2wsCiAgICB3aWxsX3MgbG9jYWwgdG8gdGhhdCBvYmplY3QKLy8vIDMuIFRoZSBtdXRhdGVkIHN0YXRlIGRvdXRhdGUgYGxhc3RJbmRleGAgb24gcmVnZXhlcyB3aXRoIGdsb2JhbC9zdGlja3kgZmxzdHI+ID0gcGhmX3NldCEgewogICAgImhhc093blByb3BlcnR5IiwKICAgICJwcm9wZSAgICJ0cmltUmlnaHQiLAogICAgInJlcGVhdCIsCiAgICAicGFkU3RhcnQiLAogICAgInN1YnN0ciIsCiAgICAiaW5kZXhPZiIsCiAgICAibGFzdEluZGV4T25vdCBtb25rZXkgcGF0Y2hlZC4KCi8vLyBLbm93biBwdXJlIHByb3RvdHlwZSBtZXRoRmxvYXQzMkFycmF5IiwKICAgICJGbG9hdDY0QXJyYXkiLAogICAgIkJpZ0ludDY0QXJpcyB1bnVzZWQuCnN0YXRpYyBLTk9XTl9QVVJFX0NPTlNUUlVDVE9SUzogcGggICJpc0V4dGVuc2libGUiLCAiaXNGcm96ZW4iLCAiaXNTZWFsZWQiLAoibG9nMTAiLCAibG9nMXAiLCAibG9nMiIsICJtYXgiLCAibWluIiwgInBvdyIsICJybyIsICJhc2luaCIsICJhdGFuIiwgImF0YW4yIiwgImF0YW5oIiwgImNicnQiLCAiY2VpbHVkZXMgZnVuY3Rpb25zIHRoYXQ6Ci8vLyAxLiBEb24ndCBtb2RpZnkgZ2xvYiBiZSBlZmZlY3RmdWwKCnVzZSBwaGY6OntwaGZfbWFwLCBwaGZfc2V0fTsKb3J0cyBgbW9kdWxlLmV4cG9ydHMgPXt9YCBhbmQgYGV4cG9ydC5mb28gPSBgIGNvdWxhdGl2ZS4gV2hlbiBpbiBkb3VidCwgaXQgYXNzdW1lcyBjb2RlCi8vISBoYXMgIHB1cmUpCi8vISAtIENvbnN0cnVjdG9yIGNhbGxzICh1bmxlc3MgbWFya2VkIHdpY3QgYW5hbHlzaXMgZm9yIEphdmFTY3JpcHQvVHlwZVNjcmlwdCBwcm9ncmFtcy4KLy9kdWxlIHt9CgojW3R1cmJvX3Rhc2tzOjp2YWx1ZV9pbXBsXQppbXBsIE1lcmc8VmM8T3B0aW9uQXN5bmN0cyA9IEVzbUV4cG9ydHMgewogICAgICAgICAgICBleHBvcnRzLAogICAgICptdXRhYiAgICAqcmVmZXBhY2UocmVmZTpuZXdfcGFydCgKIGxldCBFY21hc2NyaXB0RXhwb3J0czo6RXNtRXhwb3J0cyhlc21fZXhwb3J0cykgPSAqb3J0cygmc2VsZikgLT4gUmVzdWx0PFZjPEVjbWFzY3JpcHRFeHBvcnRzPj4gcnRlZCByZWZlcmVuY2VzCiAgICAgICAgICAgIC8vIGNvbnRhaW4gc3BhbnMgZnJvdDxWYzxFY21hc2NyaXB0TW9kdWxlQ29udGVudE9wdGlvbnM+PiB7aG91dF9hbmFseXNpcygKICAgICAgICAmc2VsZiwKICAgICAgICBfZ2VuZWNhZGUgPT4gc2VsZi5tb2R1bGUuc2lkZV9lZmZlY3RzKCksCmYucmVmZXJlbmNlcygpOwogICAgICAgIGxldCBpc19zZWxmX2FzeW5jID0gYXNjYXN0KCpyKSkpCiA+IFZjPHR1cmJvcGFja19jb3JlOjpzb3VyY2U6Ok9wdCAgRXNtQXNhZ2U6OmFsbCgpLGx0ID0gbW9kdWxlLmFuYWx5emUoKS5hZW5jZXM+LAogICAgKT4gewogICAgICAgIE9rKG1hdGNoICZzZWxmLnBhcnQge25hbHMsCiAgICAgICAgICAgICAgICAgICAgYXN5bmNfbW9kdWxlLmF3YWl0Py5oYXNfICAgIntwYXJ0Oj99IGlzIHVuZXhlYWJsZT4+LAogICAgLy8vIFRoZSBwYXJ0IG9mIHRoZSBtb2R1bGUgdGhhb2R1bGVMb2NhbHNNb2R1bGVdLiBJdCBhbGxvd3MgdG8gZm9sbG93CiNbdHVvZGVHZW5zLAogICAgZXhwb3J0OjpMaXZlbmVzcywKICAgIHJlZmVyZW5jZXM6OnsKICAgIE1lcmdlYWJsZU1vZHVsZXMsIE1lcmdlYWJsZU1vZHVsZXNFeHBvc2VkLAogYmVsOiBEZWZmb28/Ii5pbnRmbiBleGVyY2lzZV9tZXRhZnJvbShUeXBlQSAgICApXSwKIHBlbjogdHJ1ZXcoKS5vcGVuKCkuaW4gICAoImZvb2RlcnMiLCAiZm9vIl0pCiBycyJdKQogICAgICAgICAgICAudmFsdWUoUmVjb29wdDogdHJ1ICAgIHQsCiAgICAgICAgICAgIGJ1aWxmbiBmaWVsZHMoKSB7bygpLCBEZWZhdWx0OjpkZWZhdWx0KCkpLAoiYmF6IikuZG9jKCJiYXoiKS5ub19vbyIpLnZhbHVlKE5pY2tlbFZhbHVlOjpudWxsKCkpLAptID0gKExvY0lkZW50LCByZWMgIHBvc2l0aW9uOjpUZXJtUG9zLAogICAgICAgIHRlcm06OntOaWNrZWxpY2l0bHkgY3JlYXRlZAogICAgLy8vIGJ5IGZpZWxkIHBhdGhzLiBIb3dldmVyLCBmaXMgcmVjb3JkIGFzICJvcGVuIiB3aGVuIHVzZWQgYXMgYSBjb250cmFjdCwgZGVseSBmaWVsZCBpbiBgUmVjb3JkQXR0cnNgLgogICAgLy8gTmV2ZXJ0aGVsZXNzLCB3ZWF0aDxJdCwgST4oc2VsZiwgcGF0aDogSXQpIC0+IEZpZWxkPFJlY29yZD4KICAgY29yZDogc2VsZiwKICAgICAgICAgICAgcGF0aDogdmVjIVtJZGVudDo6bmV3KG5hbWVpbXBsIFJlY29yZCB7CiAgICAvLy8gTWFrZSBhIG5ldywgZW1wdHkgcmVjb3JkIGJ1aWQsIHQpIGluIGZpZWxkcyB7CiAgICAgICAgbWF0Y2ggc3RhdGljX2ZpZWxkcy5lbnRlbGRzKGZpZWxkMTogcmVjb3JkOjpGaWVsZCwgZmllbGQyOiByZWNsZHM6IFsoTG9jSWRlbnQ6OmZyb20oaWQpLCBhY2MpXS5pbnQKCmZuIGVsYWJvcmF0ZV9maWVsZF9wYXRoPEk+KHBhdGg6IEksIGNvbmxkYF0gYnkgc2V0dGluZyBpdHMgYSB2bGV0IHYgPSBzZWxmLnJlY29yZDsKICAgICAgICBsZXQgZiA9IEZpZWwgbmFtZShuYW1lOiBpbXBsIEFzUmVmPHN0cj4pIC0+aDxJLCBJdD4ocGF0aDogSXQpIC0+IFNlbGYKICAgIHdoZXJlCiAgICAgICAgSTogQXN5cGVzKG11dCBzZWxmLCB0OiBpbWFwKHxjfCBMYWJlbGVkVHlwZSB7CiAgICAgICAgICAgICAgICB0eXA6IGMsCiAgZWxkIGFzIGBub3RfZXhwb3J0ZWRgCiAgICBwdWIgZm4gbm90X2V4cG9ydGVkKHNlZyBvbiBgb3B0YAogICAgcHViIGZuIHNldF9vcHRpb25hbChtdXQgc2VsZiwgb3B0OmxpemVkCnB1YiBzdHJ1Y3QgQ29tcGxldGUoT3B0aW9uPE5pY2tlbFZhbHVlPik7CgovZXNzKCJmb28iKSk7Ci8vISBsZXQgdCA6IE5pY2tlbFZhbHVlID0gYgovLyEgICAgICB5b3UgY2FuIGRlZmluZSBOaWNrZWwgcmVjb3JkcyB1c2luZyBhIGJ1aWxkZXIgc3R5cmFpdCBTZWFsZWQge30KICAgIGltcGw8VD4gU2VhbGVkIGZvciBWY1ZhZWY8VD5gXS4KcHViIHN0cnVjdCBWY1ZhbHVlVHJhaXRDYXN0PFQ+CndudGVkIGJ5IHVzZXJzLgpwdWIgdHJhaXQgVmNDYXN0OiBwcml2YXRlOjpTZWFsZWQge3lwZSwgYmFja2VuZDo6VHlwZWRDZWxsQ29udGVudH07CgovLy8gVHJhaXQgZGVmdXJib191bml4X3BhdGg6OnN5c190b191bml4OwogICAgbGV0IHN5c19wZXh0KCJFeHBlY3RlZCByb290IHRvIGhhdmUgYSBEaXNrRmlsZVN5c3RlbSIpPwogcmFjdF9kaXNrX2FjY2VzczxUPih2YWx1ZTogaW86OlJlc3VsdDxUPiwgcGF0aDogJlAndCBoYW5kbGUgZm9yYWxscyBpbiB0aGlzIHRlbXBvcmFyeSBtb2R1bGU6IHRoZXRlLCAmbTEsIGVudjEsICZtMiwgZW52MikpCiB0IG1hcDEgPSBlcm93c19hc19tYXAodXR5MSk7CiAgICAgICAgICAgIGxldCBtYXAyIHRjaCAodXR5MSwgdXR5MikgewogICAgICAgICAgICAgICAgICAgIChTb21lKHV0eTFhdGUsIHMxLCBlbnYxLCBzMiwgZW52MikgJiYgdHlwZSAgIHR5MTogJlR5cGUsCiAgICBlbnYxOiAmRW52aXJvbm1lbnQsCiAgICB0eTI6ICZUaW9uc19lcSAmJiBzY2FsYXJfbWV0YWRhdGFfZXEgJiYgdmFsdWVfZXEKfQoKL3RoYXQgInNjYWxhciIgbWV0YWRhdGEgKHNpbXBsZSB2YWx1ZXMpIGFyZSBlcXVhbHMKZXQgcGVuZGluZ19jb250cmFjdHNfZXEgPSBmaWVsZDEKICAgICAgICAucGVuZGloYXQgYSBjb250cmFjdCBibGFtZSBvciBub3QuIERpZmZlcmVudCBsYWJlbHMgbWlnLy8gbG9vayBhdCB0aGUgY29udHJhY3RzIG9mIGVhY2ggYmFyIGZpZWxkLgpmbiB0IHNldDogT3B0aW9uPEluZGV4TWFwPExvY0lkZW50LCBPcHRpb248Xz4+PiA9IGVyb25vdCByb3cgdHlwZSwgb3IgaWYgaXQgaXMgYQovLy8gcmVjb3JkIHJvdy4KZm4gZXJvdCBiZSBgUm93RW1wdHlgKSwgb3RoZXJ3aXNlIGBOb25lYCBpcwovLy8gcmV0dWVudCwgJlYsICZFbnZpcm9ubWVudCkgLT4gYm9vbCwKewogICAgbWFwMS5sZW4gICYmIG1hcF9lcSgKICAgICAgICAgICAgICAgICAgICBjb250cmFjdF9lcV9maWVsRW1wdHlgIGltcGxpZXMgY2xvc2VkLgogICAgICAgICAgICAgICAgJiYgIWRhdGEuaHVuay5ib3Jyb3dfb3JpZygpOwoKICAgICAgICAgICAgc3RhdGUudXNlX2dhcygpICZlMiA9IHRodW5rMi5ib3Jyb3dfb3JpZygpOwoKbHVlIGJ1aWx0IHlldC4gVGhpcyBzdGF0ZSBpcwogICAgICAgICAgICAvLyBub3Qgb2JvbSBhIHZhcmlhYmxlLCBpdCBtaWdodCBiZSB0aGFtZSBzaGFwZQogICAgICAgICAgICAgICAgXyA9PiBmc3MoaWQyKSwKIGFsdWVfZXEgJiYgdHlfZXEKICBzYW1lIGxvZ2ljIGFzIGluIHRoZSB0eXBlY2hlY2tlcjogdGhlIHR5cGUgYXNzb3Rpb25zPwogICAgICAgICAgICAgICAgICAgIC8vIC0gZG9lcyBpdCBldmVuIGhhcGVudjEsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAmZGF0LmUuIHdpdGhvdXQgZHluYW1pYwogICAgICAgICAgICAgICAgLy8gZmllbGRzKSBhbmQgICYmIGNvbnRyYWN0X2VxX2JvdW5kZWQoc3RhdGUsICZkYXRhMS5hcmcsIGVudnRjaCAoJnRlcm0xLCAmdGVybTIpIHsKICAgICAgICAgICAgICAgIC8vIFdlIG9ubCh0ZXJtMSksIFZhbHVlQ29udGVudFJlZjo6VGVybSh0ZXJtMikpIGFwKHxpZHh8IHsKICAgICAgICAgICAgICAgICAgICAgICAgbGV0IGNsb3N1cmUgPSBpc3VyZTEgPSBpZHgxLmJvcnJ0ZXZlciBnbG9iYWwgZW52aXJvbm1lbnQgdGhlIHRlcm0gd2lsbCBiZSBwdXQgaW4sCm91bmQpIG1heSBiZSBkZWVtZWQgZXF1YWwKICAgLy8gKGFuZCBpdCdzIHByb2JhYmx5IGVhc2llciB0byBwcm92ZSB0aGF0IHR5UmVmOjpBcnJheShDb250YWluZXI6OkFsbG9jKGFycl9kYXRhMSkpLApsb2MocjIpKSwKICAgICAgICApID0+IHsKICAgICAgICAgICAgbWFwX2VxKAo6IHRhZzEsCiAgICAgICAgICAgICAgICAgICAgICAgIGFyZzogU29tZShhcmcxKSwKIG50KGVudW0yKSkgPT4gewogICAgICAgICAgICBtYXRjaCAoZW51bTEsIGVudW0yKSB7IGlmIHQxLnBoeXNfZXEodDIpICYmIEVudmlyb25tZW50OjpwdHJfZXEoZW52MSx0eSwgdDIsICZlbXB0eSkKfQoKLy8vIERlY2lkZSB0eXBlIGVxdWFsaXR5IG9uIGNvdygpLCB0MSwgZW52MSwgdDIsIGVudjIpCn0KCi8vLyAqKldhcm5pbmcqKjogdGhpcGluZyB2YXJpYWJsZXMgdG8gdGhlaXIgZGVmaW5pdGlvbiAodGhlIHNlY29uZCBwbGF1dGlvbi4gUmV0dXJuIHRydWUgaW4gY2FzZSBvZiBzdWNjdWFsaXRpZXMgYmV0d2VlbiBzaW1wbGUgY29udHJhY3RzIGFyZSB1bmR1bHkgcmVqYWxseSBwZXJmb3JtZWQgbWFueSB0aW1lcyBkdXJpbmcgdHlwZWNoZWNraW5nLCB0eXBtIGZvbGxvd2luZyBhbGwgdmFyaWFibGVzIGxpbmtzIGJsaW5kbHksIGFzIHRoZXIgaW52b2x2ZWQgY2FuIGJlIGFyYml0cmFyaWx5IGNvbXBsZXguIFByaW1vcHMgYXBwbGlzb24gZmFpbHMsIHdlIGRvIGEgc2ltcGxlIHN0cnVjdHVyYWwKLy8hIHJlY3VhbHVlYCkuIEl0J3MgdXNlZCBieSB0aGUgY3VycmVudCB0cmVlLXdhbGtpbmcgdmlydGFnZTo6QmluICk/OwoKICAgICAgICAgICAgICAgICAgICAgICAgY29udGludWU7CiB0OiAwLApvbnM6IDAsCiAgY3B1LAogICAgIGlzX2dyYXBoLAogICAuYXJncygpCiBuID0gc3Bhbi5jb3JyZWN0ZWRfdG90YWxfdGltZSgpO2V0IHN0b3JlID0gc3RhdGUuc3RvcmUucmVhZCgpOwombXV0IHdlYnNvY2tldCwKIGdhdGVkQm90dG9lOjpCb3R0b21VcCB7IHNvICAgIChtb2RlLmFzX3N0cigpLCBmYWxyaXBfc3VmZml4KCItc29ydGVkIikgewpNb3JlRGF0YSA9PiB7YWdlOjpDaGVja0Zvck1vcmVEZXdlci5jb21wdXRlX3VwZGF0ZSgmc3RvcmUsICZzdGF0ZS52aWV3X3JlY3QpOwogaWYgZm9yY2Vfc2VuZCB7CiAgICAgICAgICAgICAgICAqdXBkYXRlX3NraXBwZWQgPSAgICB3aWR0aDogMSwKICAgICAgICAgICAgaGVpZ2h0OiAxLApsZXQgd2Vic29ja2V0ID0gYWNjZXB0KHN0cmVhbS51bndyYXAoKSkudWV0IHNlcnZlciA9IFRjcExpc3RlbmVyOjpiaW5kKFNvY2tldEFkZHI6OlY0KFNvY2sgcHViIHg6IHU2NCwKICAgIHB1YiB5OiB1NjQsCiAgICBwdWIgd2lkdGg6IHU2NF9yZWN0OiBWaWV3UmVjdCwKCiAgICBRdWVyeVJlc3Vlcjo6e1VwZGF0ZSwgVmlld0xpbmVVcGRhdGUsIFZpZXdNb2RlLCBWaWV3ZXJ9LAp9OyAgIG5ldDo6e1NvY2tldEFkZHIsIFNvY2tlcnRlZCArPW5pc2godGFzaykgPT50eCA9IGN0eF9jbG9uZTsKICAgICAgICAgICAgbGV0IG11dCBzY2hlZHVsZWQgPSBpc2goMTEpLAogICAgICAgICAgICBBY3Rpb246OlN0YXJ0RmluaXNoKDEwKSwKCiBpc2goMTcpLAogICAgICAgICAgICBBY3Rpb246OlN0YXJ0RmluaXNoKDE2KSwKICBzZSksCgogICAgICAgICAgICAvLyBMZXQgQ1BVLWJvdW5kIDIgYW5kIDMgcmVhY2Fza3Mgd2hpbGUgdGhlIENQVS1ib3VuZCB0YXNrcyBhcmUgcnVubmluZwogb25zOiAmW0FjdGlvbl0gPSAmWwogICAgICAgICAgICAvLyBTY2hlZHVsZSBldyhFeGVjdXRvckltcGwpKTsKCiAgICAgICAgI1tkZXJpdmUoRGVidWcpXQogICBjdHguY29tcGxldGlvbl9vcmRlci5sb2NraW5nKG1vdmUgfHwgewp1dG9yPFRlc3RDb250ZXh0LCAodTMyLCBib29sKSwgdTMyPiBmb3IgRXhlY25kIGZhaWx1cmUgY2FzZXMpLiBOb3QgYXNzZXJ0ZWQgYmVjYXVzZSB0aGUgYmFycmVjdCgiVGltZWQgb3V0IikKICAgLy8vIEVhY2ggdGFzayB3YWl0cyBvbiB0d28gYmFycmllcnMgKHN0YXJ0LCBmaW5pdGhhdCB2ZXJpZmllcyBwcmlvcml0eSBvcmRlcmluZyB3aXRoIG1peGVkIENQVS11bGUoJnJlc3VsdHMsIGksJkFyYzxNdXRleDxWZWM8dTMyPj4+LAogLjEwXS5jb250YWlucygmMikpOwppbzo6dGltZTo6c2xlZXAoRHVyYXRpb246OmZyb21fbWlsbGlzKDEwKSkuYXdubmVyPE11dGV4PFZlYzx1MzI+PiwgdTMyLCB1MzIsIF8rIDEpICogMTApKTsKIDIpXQogICAgYXN5bmMgZm4gdGVzdF9jcHVfYm91bmRfd2l0aF95aWVsZF90YXNsbiEoIlJlc3VsdHM6IHs6P30iLCAqcmVzdWx0cyk7CgpuZXcoZXhlY3V0b3IpKTsKbG4hKCJFeGVjdXRpbmcgdGFzayB7fS4uLiIsIHRBcmMsIEJhcnJpZXJ9LAogICAgICAgIHRocmVhZDo6c2xlZXAsCiAgYXRjaCBQaW46Om5ldygmbXV0IHRoaXMucmVjZWl2ZXIpLnBvbGwoY3gpIHsKIGRyb3BfaW5fcGxhY2UoZnV0dXJlX3Nsb3QpOwogVFk6IFRoZSBwaW5uZWQgZnV0dXJlIGlzIGRyb3BwZWQgaW4gcGxhY29tZSgobmV3X2Z1dHVyZSwgbmV3X3R4KSkgPQoga2VycyA+IHRoaXMucnVubmVyLnRhcmdldF93b3JrZXJzIHsgLy8gdXAgb3RoZXIgdGFza3MgaW4gdGhlIHF1ZXVlLgogbGFzdF95aWVsZC5lbGFwc2VkKCkgPiBEdXJhdGlvbjo6ZnJvbV9taWxsaXMoNSkgewp1cmUgPT4gdW5yZWFjaGFibGUhKCksCmVzISh0aGlzLnN0YXRlLCBXb3JrZXJTdGF0ZTo6UGVuZGluZ0Z1dHVyZSkgewpwYXduKFNlbGYgewogICAgICAgICAgICBmdXR1cmUsCiAgICAgICAgICAgIHR4LAogIHBvcnQgYm91bmRzIHdpdGggKwogICAgICAgIEM6IFNlbmQsCiAgICAgICAgQzogU3luKCkgPiBxdWV1ZS5sZW4oKSAqIDMgJiYgcXVldWUuY2FwYWNpdHkoKSA+IDEyOCB7CiBpdGVtLnByaW9yaXR5KTsKCiAgICAgICAgICAgIGlmICF1bnVzZSAgLmV4ZWN1dGUoZXhlY3V0ZV9jb250ZXh0LCBoZWFwX2l0ZW0udGFzaywgaGVhaW9uPChFOjpGdXR1cmUsIE9wdGlvbjxTZW5kZXI8KCk+Pik+IHsKa2VycyBiZWNhbWUgbG93ZXIgd2UgbWlnaHQgaGF2ZSBmcmVlCiAgLy8gQmV3YXJlIHRoZSByYWNlIGNvbmRpdGlvbiBoZXJlOgogICBrZXJzKHNlbGY6ICZBcmM8U2VsZj4sIGV4ZWN1dGVfY29udGV4dDogJkFyYzxDPikge2V0Y2hfYWRkKDEsIE9yZGVyaW5nOjpSZWxheGVkKTsKICAgICAgICBpZiBhY3QgLy8gZnJlZSBjYXBhY2l0eSBzbyB3ZSBjYW4ganVzdCBwdXNoIHRoZSB0YXNrIHRvIG9tZSh0eCkpOwogICAgICAgIEpvaW5IYW5kbGUgeyByZWNlaXZlcjogcnggfQogIDxDPiwgdGFzazogVCwgcHJpb3JpdHk6IFApIHsKICAgICAgICBzZWxmLnNjaGUgb2YgYWN0aXZlIHdvcmtlcnMgY3VycmVudGx5IHBvbGxpbmcgdGFza3MuCiBQPiArICdzdGF0aWMsCj4gewogICAgZXhlY3V0b3I6IEUsCiAgICAvLy8gVGhlIHRhcmw8UDogT3JkLCBUPiBPcmQgZm9yIEhlYXBJdGVtPFAsIFQ+IHsKICAgIGZuIGNtcCgmbXBsPEMsIFQsIFAsIEYsIEZ1dD4gRXhlY3V0b3I8QywgVCwgUD4gZm9yIEYKd2hlcnByb2Mua2lsbCgpPzsKICAgIHByb2Mud2FpdCgpPzsKICAgIE9rKCgpKQp9ZX0gLSBwcm9jZXNzIHtwaWR9IGRpZCBub3QgZXhpdCBhZnRlciBTSUdJTlQsIHNlbm1fcmF3KHByb2MuaWQoKSBhcyBfKTsKICAgIG1hdGNoIGtpbGwocGlkLCBTaWduYSAgIHN5czo6c2lnbmFsOjp7U2lnbmFsLCBraWxsfSwKICAgICAgICB1bmlzdGQ6OlBpdXQgcHJvYyA9IHNlbGYuc2VydmVyLnRha2UoKS5leHBlY3QoIlNlcnZlciBuZXZlZXQgcGFnZV9ndWFyZCA9IFBhZ2VHdWFyZDo6bmV3KHBhZ2UsIGJpbmRzc2lvbihmb3JtYXQhKCJ3aW5kb3cubG9jYXRpb249J3tkZXN0aW5hdGlvbn0nIikpCmUgdG8gbGlzdGVuIHRvIHJlc3BvbnNlIHJlY2VpdmVkIGV2ZW50cyIpPzsKaW5ncyBzdXJ2aXZlIHBhZ2UgcmVsb2Fkcy4gU2V0IHRoZW0gdXAgYXMgZWFybHkgYXNnZSA9IGJyb3dzZXIKICAgICAgICAgICAgLm5ld19wYWdlKCJhYm91dDpibGFuayIpCiBuZXdfd2l0aG91dF9jb3B5KAogICAgICAgIGJ1bmR0aW9uPChDaGlsZCwgU3RyaW5nKT4sCiAgICB0ZXN0X2RpcjogUHJlcGFyZWREaXIsCmVybWl0ID0gc2VtYXBob3JlCiAgICAgICAgICAgICAgICAgICAgICAgIC5hY3F1aXJleSBpbiAmbXV0IGRpciB7CiAgICAgICAgICAgIGxldCBlbnRyeSA9IGVudHJ5PzsKICAoNjQpKSkuYXdhaXQKfQoKLy8gSEFDSzogTmVlZGVkIHNvIHRoYXQgYGNvcHlfc2UgY2hyb21pdW1veGlkZTo6ewogICAgQnJvd3NlciwgUGFnZSwKICAgIGNkcDo6ewo6OkFyYywKfTsKCnVzZSBhbnlob3c6OntDb250ZXh0LCBSZXN1bHQsIGFueWhvd307CmF0c19kZXRlcm1pbmlzdGljKG11dCBqc29uOiBzZXJkZV9qc29uOjpWYWx1ZSkgLT50byBzaW1wbGlmeSB0ZXN0IGFzc2VydGlvbnMKZm4gbWFrZV9zdGF0c19kICBXcmFwcGVkVTY0KHNlbGYuMCAqIDIpLmNlbHNlcyBgTG9jYWxUYXNrVHlwZTo6UmVzb2x2ZU5hdGl2ZWAuCiNzIjogMQogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICAgICJ3cmFwX3ZjIl92YygpCiAgICAgICAgICAgIC5hc19zaWRldCI6IDE3LAogIGl0IjogNywKYXAoaSkpOwogdF9keW5fdHJhaSAgICB3dmMudmMoKS5pbnRvX2Z1dHVyZSgpLCB3dmMubGVfdmMiOiB7CnMiOiAxLAogICAgICAgICAgICAgICAgICAgICJjYWNoZV9oaXQiOiAwLGVzdF9hd2FpdF9zYW1lX3ZjX211bHRpcGxlX3RpbWVzKCkgLW1wbGVfdGFza3RkOjpmdXR1cmU6OkludG9GdXR1cmU7Cgp1ZXh0KCJVbmFibGUgdG8gZGVzZXJpYWxpemF0ZSByZXNwb25zZSBmcm9tIFBvc3RDU1NhbHVlIGVsc2UgewogICAgICAgICAgICAvLyBBbiBlcnJvciBoYXBwZW5lZCwgdyAgZW52OiAqZW52LAogICAgICAgICAgICBjb250ZXh0X3NvdXJjZV9mb3JfaXNzdWdldF9yZWxhdGl2ZV9wYXRoX3RvKCYqY3NzX2ZzX3BhdGguYXdhaXQ/KSB7CiByYXBoID0gTW9kdWxlR3JhcGg6OmZyb21fc2luZ2xlX2dyYXBoKFNpbmdsZV9tYXAgPSBzZWxmLnNvdXJjZV9tYXA7CgogIHRlbnQoY29udGVudCkgPSAmKmZpbGUuYXdhaXQ/IGVsc2UgICAgYWN0dWFsIHJlbW90ZSBwa2cgb3IgYW55dGhpbmcKLy8gc291cmNlIHBhdGggd2lsbCBhcnJpdmVzIHNwZWNpZmljIHByb2plY3QgY29ub2x2ZV9zaWRlY2FzdDo6PEJveDxkeW4gR2VuZXJhdGVTb3VyY2VNYXA+Pigqc2VsaGVzIShsb2NhdGlvbiwgUG9zdENzc0NvbmZpZ0xvY2F0aW9uOjpQcm8pCn0KCmFzeW5jIGZuIGZpbmRfY29uZmlnX2luX2xvY2F0aW9uKAogICAgcHJvamF0aChyY3N0ciEoInRyYW5zZm9ybXMvcG9zdGNzcy50cyIpKQogZW5kKCJfLmxvYWRlci5tanMiKT8sCiAgICAgICAgQXNzZXRDb250ZW50OjpmaWxlKEZvbHV0ZSBwYXRocyBkb24ndCB3b3JrIHdpdGggRVNNIGltcG9ydHMgb24gV2luZG93c3QgdG8gYnVuZGxlIHRoZSBjb25maWcgZmlsZSwgc28gd2UgbG9hZCBpdCB3b21lKHJjc3RyISgicG9zdGNzcyIpKSksCnBhdGhfZmlsZW5hbWUgPT0gInBhY2thZ2UuanNvbiIgewogbSh2YWx1ZS50b19zdHJpbmcoKSkpLmNlZSkgPSBqc29uLmdldCgmKiprZXkpIHBsIEFzc2V0IGZvciBKc29uaW1wbCBKc29uZShtb2R1bGUpID0+IFNvbWUoCiAgYXAofHBhdGh8IGFzeW5jIG1vdmUgewogICAgICAgICAgICBPaygKICBuKCJ0YWlsd2luZC5jb25maWcubWpzIik/LCAgZXh0cmFfY29uZmlnc19jaGFuZ2VkKGFzc2V0X2NvbnRleHQsIHBvcyAgT2soKnNlbGYucHJvY2VzcygpLmF3YWl0Py5jb250bWFwOiBib29leHQ6IHNlbGYuZXZhbHUgICAgUG9zdCBuZXcoCm5maWcuanNvbiIsCiAgICAgICAgXQogICBzcmMueW1sIiwKICAgICAgICAgICAgIi5wb3N0Y3NzcmMuanMiLApwdWIgcG9zdGNzc19wYWNrYWdlOiBPcHRpb248UmVzb2x2ZWRWYzxJbXBvcnRNYXBwaWF1bHQsCiAgICBDb3B5LAogICAgQ2xvbmUsCiAgICBQYXJ0aWFsRXEsCiAgICBFcSwKUE9SVDsKCnVzZSBjcmF0ZTo6ewogICAgZW1iZWRfanM6OmVtYmVkX2ZpbGVfcGF0VmMsIFRhc2tJbnB1dCwgVHJ5RmxhdEpvaW5JdGVyRXh0LCBWYywKICAgIGZ4aW5kdGhfaW5kZXhfdXJsKHNlbGYsIGluZGV4X3VybDogZ2l4OjpVcmwpIC0+aXZlZCBwYXRocwogICAgLy8vIGJhc2VkIG9uIHRoZSBuZXcgcm9vdCBjYWNoZSBkaXJYX1VSTC50cnlfaW50bygpLnVud3JhcCgpLAogICAgICAgICAgICBnaXRodSBwdWIgZ2l0X3JlcGxhY2VtZW50czogSGFzaE1hcDxnaXg6OlVybCwgZ2l4OjpVcmw+Ly8vIEdpdCBzb3VyY2UgcmVwbGFjZW1lbnRzOiBhbnkgZ2l0IHBhY2thZ2VzIHRUaGUgcGxhY2Ugd2hlcmUgd2UgcHV0IHRoZSBkb3dubG9hZGVkIHBhY2stbGFuZy9uaWNrZWwtbWluZS5naXQiOwpjb25zdCBERUZBZnRlciA9IGxpbWl0X2xlbihhZnRlcik7CnRfYXQodGVtcCwgZW5kX2NvbHVtbiAtIHJlYWxsZXQgYmVmb3JlID0gbGltaXRfbGVuKGJlZm9yZSk7CiBsZXQgKF8sIGMpID0gYi5zcGxpdF9hdChiLmNlaWxfY2hhcl9ib3VuZGFyeShiLmxlbmF0ZSgpLnRha2UoY29udGV4dF9lbmQgKyAxKS5za2lwKGNvbnRleHRfc3RhcnQpIHsKdXNpemU7CiAgICBsZXQgY29udGV4dF9lbmQgPSAoZW5kX2xpbmUgKyA0KSBhcyBpbmU6Okluc2lkZSB7IGxpbmUsIGluc2kgfCB7fV57fV4iLAogIHt9dnt9diIsCiAgZW4oKSksCiAgICAgICAgICAgICAgICAgICAgIi0iLiAgU291cmNlQ29udGV4dExpbmU6OkNvbnRleHQgeyBsaW5lLCBvdXRzaWRlIH0gPWVydChpLnRvX2lkKCkpOwogICAgICAgIH0KICAgIH0KfQp1c2Ugc3RkOjp7Ym9ycm9zaXRfbWVtYmVyX2V4cHIoJm11dCBzZWxmLCBlOiAmTWVtYmVyRXhwcikgKiJyZXF1aXJlIiB7CiAgICAgICAgICAgICAgICAgICAgc2FmZXRhOiAmJ2EgbXV0IFN0YXRlLAp9CgppbXBsIFZpc2l0IGZvciBBbmFseXplcjwnXz4gICBrZXksCiBhdGEuaWdub3JlZC5jb250YWlucygma2V5LmN0eHQgPT0gc2VsZi51bnJlc29sdmVkX2N0eHQgJiYgaWRlbnQuc3ltID09ICoicmUgRmluZCBgcmVxdWlyZSgnZm9vJylgCiAgICAgICAgaWYgbGV0IFNvbWUoRXhwcmxmKTsKCiAgICAgICAgcHJlcGVuZF9zdG10cygmbXV0IG4uYm9keSwgc2VsX211dF9tb2R1bGUoJm11dCBzZWxmLCBuOiAmbXV0IE1vZHVsZSkgewogIGRlY2xzOiB2ZWMhW3Zhcl0sCiAgbGV0IFN0bXQ6OkRlY2woRGVjbDo6VmFyKHYpKSA9ICZzIHsKIGluaXRlOiBmYSAgIHJlbmFtZWQuY2xvIGF0b20hKCJyZXF1aXJlIiksCi8vIFRyYW5zZm9ybSBhcyBgcmVxdWlyZSgnZm9vJykuYmFyYAogIHJkKSA9IHNlbGYuZGF0YS5pbXBvcnRzLmdldCgma2V5KSBfbXV0X2V4cHIoJm11dCBzZWxmLCBlOiAmbXV0IEV4cHIpIHsKICAgICAgICBlLnZpc2ZpZXIpLm1hcCh8dnwgJnYudHJhbnNmb3JtcykKICAgIH0KfQoKaW1wbCBWaXNpLy8gTGlzdCBvZiBgcmVxdWlyZWAgY2FsbHMgKip3aGljaCBzaG90YXhDb250ZXh0KSAtPiBDanNPcHRpbWl6ZXIgewogICAgQ2pzT2VJdGVtLCBQYXQsIFNjcmlwdCwgU3RtdCwgVmFyRGVjbCwgVmFyRGVjbEtpbmQsIFZhQXRvbX0sCiAgICBjb21tb246Ont1dGlsOjp0YWtlOjpUYWtlLCBTeW50YXhDb2xpbmtfcGF0aCA9IHN5bWxpbmtzX2Rpci5qb2luKCZzeW1saW5rX2lkeC50b19zIC0+IGFueWhvdzo6UmVzdWx0PCgpPiB7CiAgICAoMC4uY291bnQpCiAgICBEaXNrRmlsZVN5c3RlbTo6bmV3KHJjc3RyISgicHJvamVjdCIpLCBmc19ycml0ZXNfcGVyX3NlYyA9IHRvdGFsX3dyaXRlcyBhcyBmNjQgLyBlbGFwc2VkLmFzX3MgIGlmIG5vdy5kdXJhdGlvbl9zaW5jZShsYXN0X3Byb2dyZXNzX3RpbWUpID49IFBSTyAgIHRvdGFsX3dyaXRlcyArPSBwYXJhbGxlbGlzbSBhcyB1NjQ7CgogIHRoZSBkdXJhdGlvbiBsaW1pdAogICAgICAgICAgICBpZiBzdGFydF90aW1lLmVsYXBtdXQgcm5nID0gcmFuZDo6cm5nczo6U21hbGxSbmc6OmZyb21fcm5nKCZtdXQgcmFuZGlua3MgdmlhIHR1cmJvLXRhc2tzLCBhbGwgcG9pbnRpbmcgdG8gdGFyZ2V0IDAKICAgc2VjcyhhcmdzLmR1cmF0aW9uX3NlY3MpOwoKICAgIHR0LnJ1bl9vbmNlKGFzeV9kaXIoJmFyZ3MuZnNfcm9vdCk/OwogICAgbGV0IGZzX3Jvb3QgPSBhcmVsaXNtOiB1c2l6ZSwKICAgIC8vLyBIb3cgbG9uZyB0byBydW4gdGhlIHN0cmVhdGgsIExpbmtDb250ZW50LCBMaW5rVHlwZX07CgojW2Rlcml2ZShBcmdzKV0KcHV0ZW50X3dpdGhfYXN5bmNfbW9kdWxlX2luZm8oYXN5bmNfbW9kdWxlX2luZm8sIHRydWl0ZW0gYnV0IHJlcG9ydGluZyBjaHVuayB0eXBlIGVjbWNJbmZvOjpmcm9tX2NodW5rX2l0ZW1fb3JfYmF0Y2gpCiAgR3JvdXA+PiwKICAgICkgLT4gUmVzdWx0PFZjPEJveDxkeW4gQ2h1bms+Pj4ge2VudCwgRWNtYXNjcmlwdENodW5rSXRlbX07CnVzZSBjcmF0ZTo6Y2h1bms6OmJhdGNoeHQsIFZhbHVlRGVmYXVsdCwgVmFsdWVUb1N0cmluZywgVmN9CmZuIGltbXV0YWJsZV9mbihpbnB1dDogVmM8VmFsdW4hKCJjcmVhdGVfaW5wdXQoKSIpOwogICAgT2soQ2hhbmdsdWUsIDUpO3VlLnN0cm9uZ2x5X2NvbnNpc3RlbnQoKS5hd2FpdD8udmFsdWUsIDEwKWxmID0gY2hhbmdpbmdfdmFsdWVfcmVzb2x2ZWQuaW1tdXRhYmxlX3NlbGZfZm4oKTsKYyBmbiBoaWRkZW5fbXV0YXRlKHlwZXMpXQojJm11dCBPcHRpb248VD4pIC0+IGJvb2wpIHsKdG9yOiBOb25lLAogICAgICAgICAgICBpbm5lciwKIEdldHMgdGhlIGN1cnJlbnQgdmFsdWUgb2YgdGhlIHN0YXRlLiBVbnRyYWNrZWQuCiBsZiwgX290aGVsPFQ6IFRyYWNlUmF3VmNzPiBUcmFjZVJhd1ZjcyBmb3IgVHJhbnNpZW50U3RhdGVuZXcoU3RhdGVJbm5lcjo6bmV3KE5vbmUpKQp9CgppbXBsPFQ6IERlYnVnPiBEZWJmICFpbm5lci51cGRhdGVfY29uZGl0aW9uYWxseSh1cGRhdGUpIHsvIFVwZGF0ZXMgdGhlIGN1cnJlbnQgc3RhdGUgd2l0aCB0aGUgYHVwZGF0ZWAgZnVuYyBzZXRfdW5jb25kaXRpb25hbGx5KCZzZWxmLCB2YWx1ZTogVCkgewogdG9yOiBTb21lKCZzZWxmLnNlcmlhbGl6YXRpb25faW52YWxpZGF0b3IpLAogSW5uZXI6Om5ldyh2YWx1ZSkpLAogICAgICAgIH0KICAgIH0KCiAgICAvLy8gR2V0cyBsPFQ6IERlZmF1bHQgKyBPcGVyYXRpb25WYWx1ZT4gRGVmYXVsdCBmb2ggPSAicGFya2luZ19sb3RfbXV0ZXhfYmluY29kZSIpXWF0ZTo6Z2V0YF0sIHRoZSBzdGF0ZSBpdHNlbGYgKHRob3VnaCBub3QgYW55IHZhbHUvIFNldHRpbmcgdmFsdWVzIGluc2lkZSBhIFtgU3RhdGVgXSBieXBhc3NlcydzIG5vCi8vLyBwbGFuIGZpeCBpdC4qKiBZb3Ugc2hvdWxkIHByZWZlciB0Y29kZTxUOiBFbmNvZGUsIEU6IEVuY29kZXI+KAogICAgICAgIG11dGV4OiAmTXV0ZXhkYXRlKCk7Cm5uZXIudmFsdWUKICAgIH0KfQoKaW1wbDxUPiBEZXJlZk11dCBmb2ZvciBpbnZhbGlkYXRvciBpbiBpbnZsZi5pbnZhbGlkYXRvcnMpOwogICAgICAgIGlmICFpbnZhbGlkYXRvcnMuaXNlX2NvbmRpdGlvbmFsbHkoJm11dCBzZWxmLCB1cGRhdGU6IGltcGwgRm5PbmNlKCZtdXVlID0gdmFsdWU7CiAgICAgICAgbGV0IF9zcGFuID0gdHJhY2Vfc3BhbiEoInN0YXRlOntNdXRleCwgTXV0ZXhHdWFyZH07CnVzZSB0cmFjaW5nOjp0cmFjZV9zcGFuOwoKdXNtcGwgRWNtYXNjcmlwdENodW5rSXRlbSBmb3IgUmF3TWVuY2VkPiB7CiAgICAgICAgT3V0cHBvcnRzPiB7CiAgICAgICAgRWNtYXNjcmlwdEV4cG9ydHM6OlZhbHVlLmNlbCAgIHdhc21fYXNzZXQ6IHNlbGYud2FzbV9hc3NldCgqY2h1bmtmZWN0cz4gewogICAgICAgIC8vIHRoaXMganVzdCBleHBvcnRzIGEgcHNzZXQ+IHsKICAgICAgICBXZWJBc3NlbWJseUFzc2V0OjpuZXcoKnNlbGVkVmM8V2ViQXNzZW1ibHlTb3VyY2U+LAogaCB0byB0aGUgV2ViQXNzZW1ibHkgZmlsZSB3aXRob3V0IGxvYWRpbmcgaXQuCiNbdGhlcyEodHkuYXNfZW51bV90YWcoKSwgU29tZShmKSBpZiBmID09IGZpZCk7Cn0KZXQgdF90eXBlb2YgPSBta190ZXJtOjpvcDEoVW5hcnlPcDo6VHlwZW9mLCBOaWNlbGQgPSBjb250YWluZXIuZ2V0KCJiIi5pbnRvKCkpLnUvLyBUZXJtcyB0aGF0IGluY2x1ZGUgZm9yZWlnbiBpZHMgY2FuIGJlIG1hbmlwdWxhdCA9IDEgaW4gaWYgdHJ1ZSB0aGVuIDEgKyAoaWYgZmFsc2UgdGhlbiAxIGVsc2UgXCJHICAgKCJnbG9iMiIsIHBhcnNlKCJcIkdsb2IyXCIiKS51bndyYXAoKSksCiAgIHZtLmV2YWwodCkubWFwKE5pY2tlbFZhbHVlOjp3aXRob3V0X3BvcyksOm5ldyhEdW1teVJlc29sdmVyIHt9LCBzdGQ6OmlvOjpzaW5rKCksIE51bGxSZXBvcmZuIGluaXRpYWxfZW52KCkgewogICAgbGV0IG11dCBpbml0aWFsX2VudiA9IEVudmllc3MoIiBtZSIpLAogICAgICAgICkpLAogICAgXTsKICBdCmZuIGludGVycG9sYXRpb25fbmVzdGVkKCkgewogICAgbGV0IG11dCBpbm5lcmFsKFN0cmluZzo6ZnJvbSgiIEhvdyIpKSwKY3R4dCkKICAgICAgICAgICAgLmV2YWwobWtfaW1wb3J0X2xpYi51bndyYXAoKSkKIHQgInR3byIgaW4geAogICAgbGV0IG1rX2ltcG9ydF90d28gPSBta19pbXBvcnQoJm11X2N0eHQsICJ4IiwgImRvZXNfbm90X2V4aXN0IiwgbWtfdGVybTo6dmFyKCJ4IikpLnVsdmVyLmFkZF9zb3VyY2UoCiAgICAgICAgU3RyaW5nOjpmcm9tKCJjeWNsZSIpLApyb20oImJhZCIpLCBTdHJpbmc6OmZyb20oIl4kKi8uMjNhYiAwwrBAIikpOwpfY3R4dDogVm1Db250ZXh0PF8sIENhY2hlSW1wbD4gPQogICAgICAgIFZtQ29dCmZuIGFza2luZ19mb3JfdmFyaW91c190eXBlcygpIHsKICAgIGxldCBudW0gPSBta29ydCh0KSk7Cn0KCiNbdGVzdF0KZm4gc2ltcGxlX2l0ZSgpIHsKICAgIGxldCB0ID0gbiBzaG91bGQndmUgcmV0dXJuZWQgYSBCbGFtZUVycm9yISIpOwogQmxhbWUsCiAgICAgICAgTmlja2VsVmFsdWU6OmxhYmVsX3Bvc2xlc3MoZHVtbXkuY2xyaWN0X2NvbXBhdChwb3NfdGFibGUsIGlkLCBsZXhlcjo6TGV4ZXI6Om5ldyhzKSkKIEZpbGVzOjplbXB0eSgpLmFkZCgiPHRlc3Q+IiwgU3RyaW5nOjpmcm9tKHMpKTsKCm5kX3ZtPFI6IEltcG9ydFJlc29sdmVyLCBDOiBjYWNoZTo6Q2FjaGU+KAogICAgdm1fRXJyb3JUb2xlcmFudFBhcnNlckNvbXBhdCwgZ3JhbW1hciwgbGV4ZXJ9LAp0OiAwLjg4NV82NDVfNDM4XzI3M185OTNfOCwKICBlIjogIlRpbWVzIE5ldyBSb21hbiIsCiAgICAgICAgICAgICAgICAgICAgImNhdGVnbnQiOiAyMTQ2LAogICAgICAgICAgICAgICAgICAgICJkZXNjZW50IjogLTU1NSwKICAgICBhc2NlbnQ6IDAuOTAxXzk4OV83MDBfMzc0XzUzMiwKICAgImNhcEhlaWdodCI6IDE0NjcsCiAgICAgICAgICAgICAgICAgICAgImFzY2VudCAgICJ1bml0c1BlckVtIjogMjgxNiwKICAgICAgICAgICAgICAgICAgICAieEhlaWdoZXN0X2ZhbGxiYWNrX2Zyb21fbWV0cmljc19zYW5zX3NlcmlmKCkgLT5sZXQgc2l6ZV9hZGp1c3QgPSBtYWluX2ZvbnRfYXZnX3dpZHRoIC8gZmFsbGJhY2tfZmV0IG1haW5fZm9udF9hdmdfd2lkdGggPSBtZXRyaWNzLnhfd2lkdGhfYXZnIGFzIGZsZXQgZmFsbGJhY2sgPSBpZiBtZXRyaWNzLmNhdGVnb3J5ID09ICJzZXJpZiIgewogbGV0IGZvbnRfbWF0Y2hlcyA9IGZvbnRfbWF0Y2hlcy51bndya2FnZXMvbmV4dC9zcmMvc2VydmVyL2ZvbnQtdXRpbHMudHMjTDEwMQpmbiBmb3IgICBzZXZlcml0eTogSXNzdWVTZXZlcml0eTo6V2FybmluZywKICBsb2NhbF9mb250X2ZhbWlseTogZmFsbGJhY2suZm9udF9mYW1pbHksCiBzY29wZWRfZm9udF9mYW1pbHk6IGdldF9zY29wZWRfZm9udF9mYW1pbHkoCiAgICBvcHRpb25zX3ZjOiBWYzxOZXh0Rm9udEdvb2dsZU9wdGlvbnM+LAopIHhNYXA8UmNTdHIsIEZvbnRNZXRyaWNzTWFwRW50cnk+LAopOwoKI3RoZSBHb29nbGUgZm9udHMgbWV0cmljcyBtYXAKI1tkZXJpdmUoRGVzZXJrczo6e0Z4SW5kZXhNYXAsIE5vbnRDYXN0PFNlbGY6OlZhbHVlVHJhaXQ+IGFzIFZjQ2FzdD46Ok91dHB1dD4+OwoKciBpcyByYXJlbHkgbmVlZGVkLCBzbyBpbiBtb3N0IGNhc2VzLCBgLmF3YWl0YGluZyBucyBhIG5ldyBjZWxsIHRoYXQgcG9pbnRzIHRvIGEgdmFsdWUgdGhhdCBpbWxseSBjb250YWluIGEgVC4KdW5zYWZlIGltcGw8cmFpdD4+IHdvdWxkIG5vdCBiZSBTeW5jLgovLyBTQUZFVFk6IFRyYWl0UmVmIGRvZXNyYWl0ID0gVT4sCiAgICBVOiBzdGQ6OnB0cjo6UG9pbnRlZTxNZXRhZGF0YSA9IHN0ICAgIGYuZGVidWdfc3RydWN0KCJUcmFpdFJlZiIpCiAgbHVlIHRyYWl0IHZjIGJ5IGNhbGxpbmcKLy8vIFtgUmVhZFJlZjo6Y2VsbGBdW2NyYXRkZXJyOiB7ZXJyfSIpLAogICAgfTsKfQp1c2Ugc3RkOjp7Zm10OjpEZWJ1ZywgZnV0dXN0aWNzKSkKICAgICAgICAgICAgLm1hcCh8cmVwcnwgZXByaW50ISgie3JlcHJ9IikpOlRleHQgPT4gZGlhZ25vc3RpY3MuaXRlcigpLnRyeV9mb3JfZWFjaCh8ZHwgewogd2l0aCh3cml0ZXIsIGZpbGVzLCBlcnJvciwgRXJyb3JGb3JtYXQ6OlRleHQpO2NvbG9yX29wdCwgc3Rkb3V0KCkuaXNfdGVybWluYWwoKSkpLmxvY2soKSwKIHJpbnQgc25pcHBldHMgd2hlbiBuZWVkZWQuCnB1YiBmbiByZXBvcnRfdG9fc3Rkb3UvLy8gUHJldHR5LXByaW50IGFuIGVycm9yIG9uIHN0ZGVyci4KLy8vCi8vLyAjIEFyZyBUZXh0LAogICAgSnNvbiwKICAgIFlhbWwsCiAgICBUb21sLAp9Cmx0KV0KI1tjZmdfYXR0cihmZWF0dXJlID0gImNsYXAiLCBkZXJpdmUoY2xhcDo6VmFsaSwgTm9Db2xvcn07Cgp1c2Ugc3VwZXI6Oio7CgovLy8gU2VyaWFsaXphYmxlIHdyYWFsdWUubG9jaygpLnVud3JhcCgpOwogICAgICAgIGxvY2suMS5pbnNlcnQoZ2V0X2l1dGV4PCh1c2l6ZSwgSGFzaFNldDxJbnZhbGlkYXRvcj4pPiwKfQoKaW1wbCBDb3VuYXAoKQp9CgojW3R1cmJvX3Rhc2tzOjp2YWx1ZSh0cmFuc3BhcmVudCldCiNbZGUgLy8gd291bGQpLgogICAgICAgIGxldCBsb2NhbF9jb3VudGVyX3ZhbHVlID0gVHJhaXNhbWUgYGNvdW50ZXJgIGluc3RhbmNlIGFzIGBjb3VudGVyYC4KIF9vbmNlfTsKCnNSZWYsIEludmFsaWRhdG9yLCBUcmFpdFJlZiwgVmMsIGdldF9pbnZhbGlkYXRvciwgd2libGVzLmxlbigpICE9IDEgewogICAgICAgIGJhaWwhKCJleHBlY3RlZCAxIGNvbGxlbWl0KGNvbGxlY3RpYmxlKTsKCiAgICBPayhWYzo6Y2VsbCg0MikpCn0KdXRlMihpbnB1dDogVmM8Q2hhbmdpbmdJbnB1dD4sIGlubmVybmVzczogdTMyIG5ldyhrZXk6IHUzMikgLT4gVmM8U2VsZj4gewogICAgICAgIGxldCBfID0ga2V5OwpxIShyZWFkLmNvbGxlY3RpYmxlLCBpLnRvXy5zZXQoMSk7CiAgICAgICAgaW5wdXQyLmF3YWl0Py5zdGF0ZS5zZXQoMTAwMCk7CiBdIC8vIGNsaXBweSBidWcgY2F1c2VzIGZhbHNlIHBvc2l0aXZlCgp1c2VjZWxsKGZvcm1hdCEoInByZWZpeDogJ3twcmVmaXh9JyIpLmluZi5tYXBwZXIuYXdhaXQ/LnByZWZpeC5hd2Fpb3V0ZXJHZXRDb250ZW50U291cmNlQ29udGVudCB7CiAgICBtYXBwZXI6IFJlczxkeW4gR2V0Q29udGVudFNvdXJjZUNvbnRlbnQ+PiwKdXJjZXM+IHsKICAgICAgICBnZXRfY2hpbGRyZW4oJnNlbGYucm91dGVzLCAmc2ViYXNlKHByZXBlbmRlZF9iYXNlKQogICAgICAgICAgICAgICAgLm1hcF9yb3V0ZXMoVmVydCEocHJlZml4LmlzX2VtcHR5KCkgfHwgcHJlZml4LmVuZHNfd2l0aCgnLycpKTsKYWluKHN0ZDo6aXRlcjo6b25jZSgoUmNTdHI6OmRlZmF1bHQoKSwgKmZhbGxiYWNrKSllPj4sCikgLT4gUmVzdWx0PFZjPEludHJvc3BlY3RhYmxlQ2hpbGRyZW4+PiB7CmVjPChSY1N0ciwgUmVzb2x2ZWRWYzxCb3g8ZHluIENvbnRlbnRTb3VyY2U+Pik+LApicGF0aCkKLy8vIGJlZm9yZSBxdWVyeWluZyB0aGUgQ29udGVudFNvdXJjZS4gQSBmYWVudCwgUm91dGVUcmVlLCBSb3V0ZVRyZWVzfSwKfSAgIGxhc3QgPSBTb21lKGNvbXB1dGUyKFZjOjpjZWxsKGkpKSk7Cm5wdXQ+KSAtPiBSZXN1bHQ8VmM8dTMyPj4gewouc2V0KDUpOwogICAgICAgIGFzc2VydF9lcSEoKm91dHB1e1N0YXRlLCBWYywgbWFya19zZXNzaW9uX2RlcGVuZGVudH07CnVyY2U+PikgLT4gVmM8UmF3T3VzIG5vIHJlZmVyZW5jZXMgdG8gb3RoZXIgbW9kdWxlcy4KI1t0ciIoP2k6ZS54fGV4KSIpOwogICAgICAgIGFzc2VydF9lcSEocywgc2VxKFtJKCJYIilnZXRzIHRyaWdnZXJlZCB3aGVuIHdlIGRvbid0IGhhdmUgYSBjb21wbGV0ZWx5IGV4YXMgcG9pc29ub3VzLCBzbyBvdXIgc2VxIGJlY29tZXMgaW5maW5pdGUsIGV2ZW4KICB9ezh9ezh9ezh9IikKICAgICAgICApOwogICAgICAgIGxldCByZXBhID0gImEiLnJlcHU6XEIpIikpOwogICAgfQoKICAgICNbdGVzdF0KICAgIGZuIGNyYXp5X3JlcGVhdHMoKFtJKCIyIildKSwgZShyIig/OnwxKVtBLVpdMiIpKTsoW0koIjEyMyIpXSksIGUociJbQS1aXSsxMjNbQS1aXSsiKSk7ZSAiaW5uZXIiIGxpdGVyYWxzCiAgICAvLyBleHRyYWN0ZWQgd2hlcmUgYSBwcnRoZSBpbXByZWNpc2lvbiBkb2Vzbid0IG1hdHRlcjogdG9vIGJpZyBpcyB0b28gLyBpdCBrbm93cyB3aWxsIGJsb3cgYSBsaW1pdCwgaXQgcmVwbGFjZXN0KFsiYSIsICJiIl0pLCBlKHIiYXxjW2EmJmJdfGIiKSk7bml0ZSBpZiBpdCBpc24ndCAiZ29vZC4iIEFuIGVtcHR5IHNlcXVlbmNlIChnZW5lciAgIF0pLAogICAgICAgICAgICBlKHIiKGFifGNkKShlZnxnaCkoaWp8a2wpIikKICBjIiwgIk1OIiwgInh5eiJdKSwgZShyImFiY3xNW2EmJmJdKk58eHl6IiAgIGluZXhhY3QoW0UoImFiYyIpLCBJKCJtWiIpLCBFKCJtbyIpLCBFKCJ4eXoiKV0pSSgiYWJhIiksCiAgICAgICAgICAgIEkoImFiYiIpLAogICAgICAgICAgICBJKCJiYWEoW0koInoiKSwgRSgiYXpiIildKSwgZShyInoqYXpiIikpO2hlc2UgbWF5IGhhdmUgYQogICAgICAgIC8vIHNpbWlsYXIgcHJvYmxlbSBhcyBhYm92SSgiYVpaIildKSwgZShyImFaezIsM31iIikpKHIiYVp7MH1iIikpOwogICAgICAgIGFzc2VydF9lcSEoZXhhY3QoWyJhWmIiLCAiKHIiYWIoP206XikiKSk7CihyIig/LXU6XEIpYWIiKSJhMWIiLCAiYTJiIiwgImEzYiJdKSwgZSgiYVsxMjNdYiIpKTtldCBsZXR0ZXJzID0gIs2xzbPNt86QzqzOrc6uzq/OsM6xzrLOs860zrXOts63ziAiQWIiLCAiYUIiLCAiYWIiXSksIGUoIig/aS11KWFiIikpO2lvbiBzaG9ydCBjaXJjdWl0cyBlYXJseS4ge2hpeWF9IGlzIHByb2JhYmx5IHN0aWxhLXpdKyhhYnxjZHxlZilbYS16XStoaXlhW2Etel0rIiksIHNlcShbSSgiaGl5YSIpXShlKHIiKFxkezEsM31cLil7M31cZHsxLDN9IiksIHNlcShbSSgiLiIpXSkpOwplbSA9IExpdGVyYWw+LAogICAgewogICAgICAgIFNlcTo6ZnJvbV9pdGVyKGl0KQogIHJhbDo6aW5leGFjdCh4LmFzX2J5dGVzKCkpCiAgICB9CgogICAgZm4gc2VxPEk6IElub3IgYSBwcmVmaWx0ZXIuCmZuIGlzX3BvaXNvbm91cyhsaXQ6ICZMaXRlcmFsKSAtPldlIGNvdWxkIGRvIGV4dHJhIHN0dWZmIGxpa2UgbG9vdXJuIHNlcTIgfTsKICAgICAgICBsZXQgU29tZShtaW4yKSA9IHNlcTIubWluX2xpdHRvIGEgaG9kZ2UgcG9kZ2Ugb2YgaGV1cmlzdGljcy4KICAgIGZuIGNob29zZShzZWxsc2UgfTsKICAgICAgICBtaW4gPj0gMyAmJiBsZW4gPD0gOAogICAgIGlzIGl0c2VsZiB2ZXJ5IHNtYWxsLgogICAgICAgIGlmIG1pbiA8PSAxIHthbHMgaGFzIGFueSBzaG90IG9mIGJlaW5nIGZhc3QuCiAgICBmbiBpc19nb29kKCZzZXRvIGEgU2VxIG1ldGhvZC4KCiAgICAvLy8gVGFncyB0aGlzIHNlcXVlbmNlIGFzICJuLnNlcS5pc19maW5pdGUoKQogICAgfQoKICAgIGZuIGlzX2VtcHR5KCZzaGVyLnByZWZpeCk7CiAgICAgICAgc2VsZi5zZXEuY3Jvc3NfZm9yd2FyZCgmbXV0IG9uIG5ldzxJLCBCPihpdDogSSkgLT4gVFNlcQogIG93KGRlYWRfY29kZSldCmltcGwgVFNlcSB7CiAgICBmbiBlbXB0eSgpIC0+Ly8vIEFwcGxpZXMgdGhlIGxpdGVyYWwgbGVuZ3RoIGxpbWl0IHRvLy8gbGVha2FnZS4gRG93bnN0cmVhbSwgdGhlIGxpdGVyYWxzIG1heSB3aW5kIHVwIGcgICAvLwogICAgICAgICAgICAvLyBXZSBkbyB3ZSBrZWVwIDQgYnl0ZXMgaGVyZT8gV3QhKHNlcTEubGVuKCkubWFwX29yKHRydWUsIHx4fCB4IDw9IHNlbG1pdHMuIE90aGVyd2lzZSwgbWFrZSBgc2VxMmAgaW5maW5pdGUgYW5kIGNyb3NzIHRoZm9yIHIgaW4gY2xzLml0ZXIoKSB7CiAgICAgICAgICAgIGlmIGNvdW50ID4gc2VsZm9yIGIgaW4gci5zdGFydCgpLi49ci5lbmQoKSB7ICBzZXEucHVzaChMaXRlcmFsOjpmcm9tKGNoKSk7CiBsZi5jbGFzc19vdmVyX2xpbWl0X3VuaWNvZGUoY2xzKSB7CnJhbDo6ZXhhY3QodmVjIVtdKSk7CiAgICAgICAgICAgICAgICBmb3IgXyBpbiAwLi5zbWluKG1pbiwgbGltaXQpIHsKICAgICAgICAgICAgICAgICAgICBpZiBzZXEuaXNfaXJ0IShtaW4gPiAwKTsgLy8gaGFuZGxlZCBhYm92ZQogICAvLyBlcXVpdmFsZW50IHRvICdhfCcuIFNpbWlsYXJseSBiZWxvdywgJ2E/PycgaXMgaGF0ICdhKicgZ2l2ZXMgdXMgYW4gaW5leGFjdCAnYScgYW5kIGFuIGV4YWN0IGVtcHRpdmVuIHJlcGV0aXRpb24uIFdlIGRvIG91cgogICAgLy8vIGJlc3QsIFNvbWUgZXhhbXQgc2VxID0gVFNlcTo6ZW1wdHkoKTsKICAgICAgICBmb3IgaGlyIGluIGl0IHsKICAgc2VxID0gc2VsZi5jcm9zcyhzZXEsIHNlbGYuZXh0cmFjdChoaXIpKTsKaWJsZSBmb3IgdGhlIGNvbmNhdGVuYW50aW9uIHRvIGV2ZXIgbWF0Y2guIFNvIHdlCiBvbmNhdDwnYSwgSTogSXRlcmF0b3I8SXRlbSA9ICYnYSBIaXI+Pigmc2VsZiwgaXQ6ICAgICBDYXB0dXJlKGhpcjo6Q2FwdHVyZSB7IHJlZiBzdWIsIC4uIGxhc3MoaGlyOjpDbGFzczo6VW5pY29kZShyZWYgY2xzKSkgPT4gICAidGhyb3dpbmcgYXdheSBpbm5lciBsaXRlcmFscyBiZWNhdXNlIHRoZXkgbWlnaG1pdF9saXRlcmFsX2xlbjogMTAwLAogICAgICAgICAgICBsaW1pdF90b3RhbDogNjQsdCB3ZSB0cnkgdG8gaWRlbnRpZnkgYSAiYmVzdCIgc2V0Ci8vLyBvZiByZXF1IC5jb25maWd1cmUoUmVnZXg6OmNvbmZpZygpLnV0ZjhfZW1wdHkoZmFsc2UpKQogYXJjaCBmb3IuIGkuZS4sIEl0IGlzCiAgICAvLy8gdXN1YWxseSBhIHNpbmdsZSBsaSAgIGZvdW5kIGFsdGVybmF0aW9uIG9mIGxpdGVyYWxzLCBkZWZlcnJpbmcgdG8gcmVnZ2luZSB3aWxsIGhhbmRsZQogICAgICAgIC8vIGl0IGFzIGJlc3QgYXMgcGVzKCkubG9va19zZXQoKS5jb250YWluc193b3JkX3VuaWNvZGUoKS8vIGF0IHRoaXMgbGV2ZWwgaXMgbm90IHZhbGlkLgogICAgICAgIGlmIGNoaXIuY29ud2lsbCBxdWVyeSBzb21lIHN0YXRlIGFib3V0IHRoZSBjb21waWxlZCByZWdleC4gVGhpYXJ0eSlccytgLiBUaGUgYFtBLVpdYCBiZWZvcmUgdGhlIGBhdHNvYAovLy8gaW4gcGN0b3IgaGVscHMgaXMKLy8vIGBccysoU2hlcmxvY2t8W0EtWl1hdHNvW2Etel18TW9yZXMuIChVbmxlc3MKLy8vIC1VLy0tbXVsdGlsaW5lIGlzIGVuYWJsZWQuKSBOYW1ldXNlcyBhIGh1Z2UgcGlsZSBvZiBoZXVyaXN0aWNzIHRvIHRyeSB0byBwbHVjayBvdXRwbCBEZWJ1ZwogICAgICAgICAgICBhc3NlcnQhKCpyZXR1cm5fdmFsdWUgPT0gUmVzIGZuIGZ1bmMobnVtYmVyOiAmQXJjPEF0b21pY0kzMj4pIFRhc2tzOwogICAgdXNlIHR1cmJvX3Rhc2tzX2JhY2tlbmQ6OntCYWNrZXRyISgiRmF0YWwgZXJyb3Igd2hpbGUgZ2V0dGluZyBjc3N1ZSB7CiAgICBmbiBzZXZlcml0eSgmc2VsZikgLT4gSXNzdWVTZXZlcml0eSB7CiByZWFtKEJveDo6cGluKHN0cmVhbSkpKQogICAgfQp9CgppbXBsIFN0cmVhbSBmb3IgIGlmIGhhc19pc3N1ZXMgfHwgaXNzdWVzX2NoYW5nZWQgewphdGU6OlBhcnRpYWwoUGFydGlhbFVwZGF0ZSB7IHRvLCAuLiB9KQogICAgIChoYXNfaXNzdWVzLCBpc3N1ZXNfY2hhbmdlZCkKIHN1ZXMgPSBmYWxzZTsKCiAgICAgICAgbGV0IHN0cmVhbSA9IFJlY2VpdmVyU3RyZWF0aGVtCiAgICAgICAgbGV0IHZlcnNpb24gPSBtYXRjaCAqY29udGVudC5jb25uIFN5bmM+PiwKKTsKCmltcGwgVXBkYXRlU3RyZWFtIHsKICAgICNbdHJhY2lvc2VkIGVycm9yLgogICAgbGV0IF8gPSBzZW5kZXIuMC5zZW5kKGl0ZW0pLmF3LyBJdCBjb3VsZCBiZSBzYWZlIChhdCBsZWFzdCBmb3IgdGhlIEdDIHVzZS1jYXNlKSBvcmVgOiBJdCdzIG5vdCBjb3JyZWN0IG9yIHNhZmUgdG8gc2VuZCBgVmNgcyBhY3JvVE9ETyBhZGQgc3BlY2lhbCBpbnN0cnVjdGlvbnMgZm9yIHJlbW92ZWQgYXNzZXRlbTo6Rm91bmQgewogICAgICAgICAgICAgICAgdXBkYXRlOiBVcGRhb21lKGZyb20pID0gVmM6OnRyeV9yZXNvbHZlX2Rvd25jYXN0X3R5cGU6OjxQcm94eXN0UmVzdWx0OjpIdHRwUHJveHkocHJveHlfcmVzdWx0X29wKSA9cmFwaC4KICAgICAgICAgICAgaWYgc3RhdGljX2NvbnRlbnQuc3RhdHVzX2NvZGUgPT1vbj4+KE5vdEZvdW5kVmVyc2lvbjo6bmV3KCkpCiBwdXNoKAogICAgICAgICAgICAgICAgUGxhaW5Jc3N1ZTo6ZnJvbV9pc3N1ZSgKICAgICBmcm9tOiBSZXNvbHZlZFZjPFZlcnNpb25TdGF0ZT4sCiAgICBnZXRfdHVyZWQuZ2V0X3BsYWluX2lzc3VlcyhJc3N1ZUZpbHRlcjo6ZXZlcnl0aGluZygpKS5uZXI6IEJveDo6bmV3KFR5cGVkR2V0Q29udGVudEZuIHsgY2FwdHVyZSwgZnVuYyB9KWFsbG93Ci8vLyBzYWZlIGltcGxlbWVudGF0aW9uIG9mIHRoZXNlIGRlc2lyZWQgdHJhZW50Rm5UcmFpdDogTm9uTG9jYWxWYWx1ZSArIFRyYWNlUmF3VmNzIHsKIGVudEZuPEM+IHt9CgovLyBNYW51YWwgKG5vbi1kZXJpdmUpIGltcGwgcmVxdXVyZTogQywKICAgIGZ1bmM6IGZvcjwnYT4gZm4oJidhIEMpIC0+IE9wZXJ5bmM6Om1wc2M6OlNlbmRlcjsKdXNlIHRva2lvX3N0cmVhbTo6d3JhcHBlcnM6OlJlYyByb290LmJ1aWxkKCk7CiAgICAgICAgICAgICAgICBsZXQgX3YgPSByb3BlLnJlYWQgbXV0IGcgPSBjLmJlbmNobWFya19ncm91cCgidHVyYm8tdGFza3MtZnMiKTsKZSA9IG0uYWRkKCZ2YWx1ZSwgJmR1cmF0aW9uKTsKIGUgfGl0ZXJzfCB7CiAgICAgICAgICAgICAgICAgICAgbGV0IGV2ZW50ID0gZXZlbnQuIFJlY29tbWVuZGVkV2F0Y2hlcjo6bmV3KHR4LCBDb25maWc6OmRlZmF1bHQoKSkudSBmczo6d3JpdGUoCiAgICAgICAgdGVtcF9wYXRoLmpvaW4oImZpbGUudHh0IiksCiBlcmlvbjo6ewogICAgQmVuY2htYXJrSWQsIENyaXRlcmlvbiwgY3JpdGVyaW9uX2dyby8vLyB0cmFjaW5nIG1pZ2h0IGJlIHBhcnRpY3VsYXJseSB1c2VmdWwgd2l0aC4KI1tkIGFyZzE6IFJlc29sdmVkVmM8dTE2PiwgYXJnMjogUmVzb2x2ZWRWYzx1MzI+KSAtPiAgIC5hZGRfbWV0aG9kKFZjOjpjZWxsKDIpLCBWYzo6Y2VsbCgzKSkKICBlczo6dTE2KQogICAgdW5rbm93biB0cmFuc2llbnQgdGFzayAocmVhZCBjZWxsIG9mIG9uc3QgRVhQRUNURURfVFJBQ0U6ICZzdHIgPSAiXApBZGRlcjo6YWRkX21ldGhvZCAoICAgU3R5bGVkU3RyaW5nOjpDb2RlKHJjc3RyISgibmV4dC9mb250OiIpKSwKdWVzdC5wYXRoKT87CiAgICBsZXQgY2FuX3VzZSA9ICFET0NVTUVOVF9SRS5pc19tICAgZm9udF9mYW1pbHkudG9fbG93ZXJjYXNlKCkucmVwbGFjZSgnICcsICJfIiksCiBfbmFtZWAgLSBUaGUgZm9udCBuYW1lIHRvIHNjb3BlLCBlLmcuIGBSb2JvdG9gCi8vdGhlIGhhc2ggdG8gdTMyLiBUaGVzZSBoYXNoZXMgYXJlIHVsdGltYXRlbHkgZGlzcGxfaGFzaChxdWVyeTogJnN0cikgLT4gdTMyIHsKICAgIGxldCBxdWVyeSA9IHFzdHJpbm9yIGEgZ2l2ZW4gZm9udCB2YXJpYXRpb24uIFRoZXNlIGFyZSByZW5kZXJlZCBhcwovfChfLCBrZXksIGJlbmNoKXwgKGtleSwgYmVuY2gpKQogbSA9IEJhc2VCZW5jaG1hcmtzIHsKICAgICAgICAgICAgbmFtZTogImxhdGVzdCIudG8gICBlLmluc2VydCgobWluX3RzLCBrZXlfdHNfc2hhLCBiZW5jaC5jbG90cyA9IHRzLmZvcm1hdCgiJVktJW0tJWQgJUg6JU0iKTsKIHwoaSwgYil8IChkYXRhX2ZpbGVzW2ldLnRpbWVzdGFtcCwgYikpCiAgIC8vIGxldCBmaWxlID0gRmlsZTo6Y3JlYXRlKCZub3JtYWxpemVkKS51bncgICBjb3JyZWN0KCZtdXQgYmVuY2guZXN0aW1hdGVzLnN0ZF9kZXYsIGNvcnJlY3Rpb2ZuIGNvcnJlY3QoczogJm11dCBDU3RhdHMsIGY6IGY2NCkgewogbiA9IHN1bSAvIGNvdW50IGFzIGY2NDsKICAgICAgICAgICAgICAgIGZvciBiZW5jaCBsaXN0IGluIGJ5X25hbWUudmFsdWVzKCkuZmlsdGVyKHxsfCBsLmxlbigpID4gMSkgeyBsaXN0OiAmbXV0IFZlYzxfPiA9IGJ5X25hbWUuZW50cnkobmFtZSkub3JfYXRhOiBCYXNlQmVuY2htYXJrcyA9IHNlcmRlX2pzb246OmZyb21fcmVhZGVyKHJlYWRubmVyX21hcC5lbnRyeShkYXRhX2ZpbGUuc2hhLmNsb25lKCkpLm9fbWFwKFJlc3VsdDo6b2spCiAgICAgICAgLmZpbHRlcih8ZXwgewogYWxpZCBjaGFycyBpbiBmaWxlIG5hbWUiKT8KICAgICAgICAgICAgLnNwbGlldCBzeXN0ZW1fZGlyID0gc2hhX2Rpci5wYXJlbnQoKS5va19vcigiaW52YWxpZCBzdFNldDxUPiA9IEluZGV4U2V0PFQsIEJ1aWxkSGFzaGVyRGVmYXVsdDxGeEhhc2hlcj4+IHBhdGgoJnNlbGYpIC0+ICZQYXRoIHsKICAgICAgICAgICAgJnNlbGYuMAogIHRoID0gdG1wZGlyLmpvaW4oInJ1c3QtaWdub3JlIikuam9pbihjb3VudC50b19ldSBvZiB0ZW1wZmlsZSBiZWNhdXNlIHRlbXBmaWxlIGJyaW5ncyBpbiB0b28gbWFueWYuaXNfbm9uZSgpIHsgb3RoZXIgfSBlbHNlIHsgc2VsZnRjaCBoYXMgbm8gdmFsdWUsIHRoZW4gcmV0dXJuIHRoZSBtYXRjaCB1bmNoYW5nZGUgdGhpcyBtYXRjaCBpZiBpdCBleGlzdHMuCiAgICBwdWIgZm4gaW5uZXIoJnNuIGlzX3doaXRlbGlzdCgmc2VsZikgLT4gYm9vbCB7CiAgICAgICAgbWF0Y2ggKnNlbGVsaXN0ZWQuCiAgICBXaGl0ZWxpc3QoVCksCn0KCmltcGw8VD4gTWF0Y2g8VD4ge3JlIGZpbGUgYW5kIHRoZSBzcGVjaWZpYyBnbG9iIHBhdHRlcm4gdGhhdCBjYXVzZWQKIGlmICFlcnIuaXNfaW8oKSB7CiAgICAgICAgICAgIHNlbGYucHVzaChlcnIpOwogLmcuLCBcCiAgICAgICAgICAgICAgICAgICAgICAgICAgIGh0bWw6Ki5odG1sKSIKICBvYiB7IGdsb2I6IFNvbWUocmVmIGdsb2IpLCByZWYgZXJyIH0gPShmLCAibGluZSB7fToge30iLCBsaW5lLCBlcnJ9IiwgbXNncy5qb2luKCJcbiIpKQogdGlhbChfKSA9PiAicGFydGlhbCBlcnJvciIsCiBtdXQgaWdfZXJyID0gRXJyb3I6OklvKHN0ZDo6aW86OkVycm9yOjpmcm9tKGVycikpO3JvbV93YWxrZGlyKGVycjogd2Fsa2Rpcjo6RXJyb3IpIC0+IEVycm4gaXQgaXMgb21pdHRlZCBmcm9tIHRoZSBlcnJvci4KICAgIGZuIHRhZ2dlZDxQOiBBaXZlbiBmaWxlIHBhdGguCiAgICBmbiB3aXRoX3BhdGg8UDogQXNSZWY8UGF0aD4+KHNlciB7IGVyciwgLi4gfSA9PiBlcnIuaW50Z2luYWwKICAgIC8vLyBbYHN0ZDo6aW86OkVycm9yYF0gaWYgb25lIGV4aXN0cy4KIDpXaXRoUGF0aCB7IHJlaHRtbCNpbXBsLUZyb20lM0NFcnJvciUzRQogICAgcHViIGZuIGlvX2Vycm9yKCZzZWhlIFtgRXJyb3JgXS4gVG8KICAgIC8vLyBvYnRhaW4gYW4gb3duZWQgdmFsdWUsIHRzcG9uZCB0byBhbgogICAgLy8vIFtgc3RkOjppbzo6RXJyb3JgXS4gVGhpcyBtaWdoPiBlcnJzLmxlbigpID09IDEgJiYgZXJyc1swXS5pc19pIC8vLyBnbG9iIGFtb25nIG90aGVyd2lzZSB2YWxpZCBnbG9icy4KICA6OklvKHN0ZDo6aW86OkVycm9yOjpuZXcoZXJyLmtpbmQoKSwgZXJyLnRvX29yOjpJbyhyZWYgZXJyKSA9PiBtYXRjaCBlcnIucmF3X29zX2Vycm9yKCkgVHlwZShTdHJpbmcpLAogICAgLy8vIEEgdXNlciBzcGVjaWZpZWQgZmlsZSB0eXBlIGQgaXMgYWN0dWFsbHkKICAgICAgICAvLy8gY29tcGlsZWQsIGFmdGVyIGFjY291bnRpbmV0ZWN0ZWQgd2hlbiB0cmF2ZXJzaW5nCiAgICAvLy8gc3ltYm9saWMgbGlua3MuCiAgIFRoZSB1bmRlcmx5aW5nIGVycm9yLgogICAgICAgIGVycjogQm94PEVycm9yPiwKIG9mICJzb2Z0IiBlcnJvcnMuIFRoZXNlIG9jY3VyIHdoZW4gYWRkaW5nIGFuIGlnbm9hdGU6OndhbGs6OnsKICAgIERpckVudHJ5LCBQYXJhbGxlbFZpc2l0b3IsIFBhcnQgaW4gV2Fsazo6bmV3KCIuLyIpIHsKICAgIC8vIEVhY2ggaXRlbSB5aWVsZGVkIGJ5c2UgY2FzZXMKdGhhdCBkZW1hbmQgbW9yZSBmaW5lLWdyYWluZWQgY29udHJvbC4KCiNhcCh8Y3RyfCBjdHIubGFiZWwudHlwLnRvX3N0cmluZygpKQogaWVsZCBoYXMgYSB2YWx1ZS4KICAgIHB1YihzdXBlcikgZm4gaXNfZGVmaW5lZCgmc2hlIG1lYW5pbmcgb2YgImlucHV0IiwgIm91dHB1dCIsIGFuZCBpZiB0aG9zZSBjb25jaXMgbW9zdGx5IGNvbmNlcHR1YWw6IGluIHByYWN0aWNlLCB3ZSBzaW1wbHkgZ2F0aGVkZGVuIHZpYSBgLS1vdmVycmlkZWAuCiAgICAvLy8KICAgIC8vLyBDdXJyLm1hcChFeHRyYWN0SW50ZXJmYWNlOjpleHRyYWN0X2ludGVyZmFjZSk7Cgogcm9tKGZpZWxkOiAmRmllbGQpIC0+IFNlbGYgewogICAgICAgIC8vIFdlIGNvbGxvbnMgYW5kIGlnbm9yZSBmbGF0IHR5cGVzIGFzCiAgICAgICAgICAgIC8vIHdlbGwKICBsZXQgUmVjb3JkUm93c0l0ZXJhdG9ySXRlbTo6Um93KHJyb3cpID0gaXRlbWxsb2MocmVjb3JkKSA9PiByZWNvcmQuaW50YWNlKCkudW53cmFwX29yX2RlZmF1bHQoKQogICAgfQp9Cgp0cmFpdCBFeHRyIGJ1dCBqdXN0IGtlZXAgYW55CiAgICAgICAgICAgICAgICAvLyBzaWRlIHRob21lKHByZXYpID0gZmllbGRzLnJlbW92ZSgmaWQpIHt1dCBmaWVsZHMgfSA9IGZpcnN0OwoKICAgICAgICBmb3IgKGlkLCBmaWVsZCkgaW4gaW9uIChhIE5pY2tlbCBwcm9ncmFtKSB3aGljaCByZXByZXNlbnRzIGFsbCBuZXN0dCEoIntyb290X2ZzX3N0cn0td2l0aC17Y2hpbGRfZnNfc3RyfSIpLml0PFZjPEZpbGVNZXRhPj4gewogZm4gcmF3X3JlYWRfZGlyKHNlbG9uKGZzKV0KICAgIGFzeW5jIGZuIHJlYWRfbGluayhzZWxmOiBWYzxTZWxmPiwgcGF0ICAgInBhdGggZnMgZG9lcyBub3QgbWF0Y2ggKGV4cGVjdGVkIHt9LCBnb3Qge30pIm9jYWwgcGF0aCBvZiB0aGUgcm9vdCBvciBjaGlsZCBmaWxlc3lzdGVtIGZyb210cnVjdHMgYSBbRmlsZVN5c3RlbVBhdGhdIG9mIHRoZSBhdHRhY2htZW50IHBvaW5oaWxkIGZpbGVzeXN0ZW0sIHNvIHdlIGV4cGFuZCB0byB0aGUgZnVsbCBwYXRoIGJ5IF0sIHRoZSBjaGlsZAogICAgLy8vIFtGaWxlU3lzdGVtXSBvciB0aGlzIFtBdHRhYyBPayhBdHRhY2hlZEZpbGVTeXN0ZW0gewogICAgICAgICAgICByb290X2ZzOiBjaGlsc3RlbSB3aGljaAogICAgLy8gd2UgYXJlIGNyZWF0aW5nIChjaXJjdWxhciByZWZlOwp9CgpkZXJpdmVfdHlwZV9lcSEoQXN0PCdhc3Q+KTsKdXNldGFudChpMSksIFVuaWZUeXBlOjpDb25zdGFudChpMikpID0+IGkxID09IGkyLAogIGJlZW4gc3Vic3RpdHV0ZWQgYXQgdGhpcyBwb2ludCwgc28gd2UgYmFpbAogICAgIHV0eTFfc3Vic3QudHlwZV9lcV9ib3VuZGVkKCZ1dHkyX3N1YnN0LCBzdGEgYm9keTIuc3Vic3QodmFyMiwgJlVuaWZUeXBlOjpDb25zdGFudChjc3RfaWQpKSwKICAgaWYgdmFyX2tpbmQxICE9IHZhcl9raW5kMiB7CiBwZUY6OkZvcmFsbCB7CiAgICAgICAgICAgICAgICAgICAgICAgICAgICB2YXI6IHZhciAgICBzMS50eXBlX2VxX2JvdW5kZWQoczIsIHN0aW5nLCBUeXBlRjo6U3RyaW5nKSA9PmVGOjpCb29sKQogICAgICAgICAgICAgICAgICAgIHwgKFR5cGVGOjpTeW1ib2wsIFR5Y2tpbmcsIGFuZCB3ZSBjYW4KICAgIC8vLyBqdXN0IHN0YXJ0IGZyb20gYDBgIHdoZS8vLyBbY3JhdGU6OmFzdDo6dHlwOjpUeXBlXSwgYnV0IGl0IG1ha2VzIGEgbnVtYmJhciB8CiAgICAvLy8gU3RyaW5nfX1gLiBUaG9zZSB0d28gcmVjb1RoZSBhdHRhY2hlZCBtZXRhZGF0YSBtdXN0IGJlIGVxdWFsIGFzIHdsdWRlc19zZWxmX3NvcnRlZCA9IHNlbGYuaW5jbHVkZXMudG9fdmVjKCk7CmVsZW0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIC50cnlfYXNfaWRlbnQoKQogICAvLyBnb29kIG9yZGVyaW5nICh3ZSBjb3VsZCBkZXJpdmUgaXQsIGFsYmVpdCBpdCB0Y2ggKHNlbGYudHJ5X2FzX2lkZW50KCksIG90aGVyLnRyeV9hc19pZGVudCgpKSB7JlNlbGYsCiAgICAgICAgX3N0YXRlOiAmbXV0IFN0YXRlLAogICAgICAgIF9lbnYxOnRoZXIuY29udHJhY3RzLCBzdGFsZXQgKFNvbWUobWFwX3NlbGYpLCBoZXI6IE9wdGlvbjxJbmRleE1hcDxMb2NJZGVudCwgXz4+ID0gb3RoYXN0PiBUeXBlRXFCb3VuZGVkPCdhc3Q+IGZvciBVbmlmUmVjb3J0eXBlcykpLAogICAgICAgICAgICAgICAgXyA9PiBOcCh8djJ8IHYxLnR5cGVfZXFfYm91bmRlZCh2Miwgc3RhdGUsIGVudjEsIGVudjIpKQp1dHlwZS50eXBlX2VxX2JvdW5kZWQoJm90aGVyX2FzX3V0eXBlLCBzdGFmb3IgW3N1cGVyOjpVbmlmVHlwZV0gaW1wbGVtZW50YXRpb24sCiAgICAvLy8gYmVjYW9kZTo6VHlwZSh0eTIpKSA9PiB0eTEudHlwZV9lcV9ib3VuZGVkKHR5Miwgc3RvIHRoZXkgY2FuIGNoYW5nZSB0aGVpciBhcmd1bWVudC4KCiAgbm90OiBhbm5vdDEsCiAgICAgICAgICAgICAgICAgICAgaW5uZXI6IGlubmVyMSwKICB8KGFzdDIsIGVudjIpfCBzZWxmLnR5cGVfZXFfYm91bmRlZChhc3QyLCBzdCh8KGFzdDEsIGVudjEpfCBhc3QxLnR5cGVfZXFfYm91bmRlZChvdGhlLy8gQWx0aG91Z2ggd2UgZG9uJ3QgYnVpbGQgcmVjdXJzaXZlIGVudmlyb25tZW50IHkvIGluLCBmcmVlIHZhcmlhYmxlcyBhcmUgbm90IHJlZGVmaW5lZCBsb2NhbGx5IGFuZCAgICBoZWFkOiBoZWFkMiwKICAgICAgICAgICAgICAgICAgICBhcmdzOiBhcmdzMiwKID09IHNjczIubGVuKCkKICAgICAgICAgICAgICAgICAgICAmJiBzY3MxCiAgIHQgYSBwbGFpbiBzdHJpbmcgKHRoZXkgZG9uJ3QgY29udGFpbiBhbnkKIGFyZ19lcSA9IG1hdGNoIChhcmcxLmFzX3JlZigpLCBhcmcyLmFzX3JlZigpKSB7b24gYW5kIGEgd2F5IHRvIGNoZWFwbHkgZXF1YXRlIGNvbXBsZXgKICAgICAoKnNlbGYpLnR5cGVfZXFfYm91bmRlZCgqb3RoZXIsIHN0YXRlLCBlbnYxLCBlblNvbWUoeDEpLCBTb21lKHgyKSkgPT4geDEudCBmb3IgW1RdCndoZXJlCiAgICBUOiBUeXBlRXFCb3VuZGVkPCdhc3Q+LAp7CiB0aCBhIGJvdW5kZWQgbnVtYmVyIG9mIHZhcmlhYmxlIGxpbmtzLCBzdG9yZWQgaW4gYCBUcnkgdG8gY29uc3VtZSBvbmUgdW5pdCBvZiBnYXMgZm9yIGEgdmFyICB2YXJfdWlkOiB1c2l6ZSwKCiAgICAvLy8gVGhlIGN1cnJlbnQgZ2FzIHJlbWFvbGVseSBhcyByaWdpZCB0eXBlIHZhcmlhYmxlczogdGhpcyBpcyB3aHkgdGhleSBkb3QgdG8gdW5mb2xkIGJlZm9yZSBhYmFuZG9uaW5nIHRoZSBjaGVjay4gSXQgc2hvb3JkcywgcHJpbWl0aXZlIGNvbnN0YW50cyBhbmQgYXJyYXlzLCBtb3N0bHkpLgovLyFpb24gKHRoZXkgc3VyZWx5IGFwcGVhciBpbnNpZGUgY29udHJhY3QKLy8hIGRlZmlpbmtzIHRoYXQgdGhlIHR5cGUgZXF1YWxpdHkgbWF5IGZvbGxvdy4gRG9pbmcgc28sIHdoaWxlCi8vISB3YWxraW5nIHRoZSBncmFwaC4gU3RpbGwsIGFzIGl0IGlzIHBvdGVsZAovLyEgdW5pZnkuCi8vIQovLyEgIyMgQWxpYXNlcwovLyEKLy8hIE9uZSBiYXNpY2xpdHkgZm9yIGNvbnRyYWN0cy4KLy8hCi8vISBEZXRlcm1pbmUgaWYgdHdvIGNvbnRydHkoIm1hcCIsIGVudi5jcmVhdGVfc3RyaW5nX2Zyb21fc3RkKG1hcCk/KT87CiAgICAgY3JlYXRlX2N1c3RvbV90b2tpb19ydW50aW1lKHJ0KTsKfQoKI1tpbmxjbWE6OmF0b21zOjpoc3RyOjpnbG9iYWxfYXRvbV9zdG9yZV9nYygpOwogICAuZW5hYmxlX2FsbCgpCiAgICAgICAgLm9uX3RocmVhZF9zdG9wKHx8IHsKIHRpYyBBTExPQzogZGhhdDo6QWxsb2MgPSBkaGF0OjpBbGxvYzsKCiNbY3JuYWxfZGhhdC1hZC1ob2MiKSkpXQojW2dsb2JhbF9hbGxvY2F0b3JdCnN0YXRpYyBBSU9OCk9GIENPTlRSQUNULCBUT1JUIE9SIE9USEVSV0lTRSwgQVJJU0lORyBGUk9NLCB0d2FyZS4KClRIRSBTT0ZUV0FSRSBJUyBQUk9WSURFRCAiQVMgSVMiLCBXSVRIT1VUIHJlYnkgZ3JhbnRlZCwgZnJlZSBvZiBjaGFyZ2UsIHRvIGFueQpwZXJzb24gb2J0YWluc2V0X2h5cGVybGluaygmbXV0IHNlbGYsIGxpbms6ICZIeXBlcmxpbmtTcGVjKWYud3RyLndyaXRlKGJ1Zik/OwogICAgICAgIHNlbGYuY291bnQgKz0gbiBhcyB1KSAtPiBXIHsKICAgICAgICBzZWxmLnd0cgogICAgfQp9CgppbXBsPFc6IFdyaXRlPiByaXRlcjxXPiB7CiAgICAvLy8gUmV0dXJucyB0aGUgdG90YWwgbnVtYmljISgib2ggbm8iKTsKfQp1c2Ugc3RkOjppbzo6e3NlbGYsIFdyaXRlfTsKCjo6UGFuaWMocGFuaWMpID0gcGFuaWMgZWxzZSB7CiAgICAgICAgcGFuaWMhKCJFeHBlaG9vayA9IHRha2VfaG9vaygpOwogICAgc2V0X2hvb2soQm94OjpuZXcobW92ZSB8aW4oKTsKCnN0YXRpYyBGSUxFX1BBVEhfUkVHRVg6IExhenlMb2NrPFJlZ2V4PiA9CiB1bHQgeyB2YWx1ZSwgcmFuZG9tIH0uY2VsbCgpKQp9CnVzZSBjb3JlOjpwYW5pYzsKdXJ1Y3QgSGFzVmFsdWVSZXN1bHQgewogICAgdmFsdWU6IGJvb2wsCiAgICByYW5kdWN0IFNldChGeEhhc2hTZXQ8U3RyaW5nPik7CgplcSEoYV9yZWYucmFuZG9tLCBhX3JlZjIucmFuZG9tKTsKICBhc192YWx1ZShzZXQsICJiIi50b19zdHJpbmcoKSk7CiAgICAgICAgbGV0IGMgPSBoYWx1ZShtYXA6IE9wZXJhdGlvblZjPE1hcD4sIGtleTogU3RyaW5nKSAtPnRlcihbKCJhIi50b19zdHJpbmcoKSwgMSksICgiYiIudG9fc3RyaW5nKCksIDIyKV0pbGV0IGJfcmVmMyA9IGIucmVhZG9tZSgyMikpOwogICAgICAgIGFzc2VydF9lcSEoY19yZWYyLnZhbHVlLCBOb21lKDEpKTsKICAgICAgICBhc3NlcnRfZXEhKGJfcmVmLnZhbHVlLCBTb21lKDIpKTsKYyBmbiBpbnZhbGlkYXRpb25fbWFwKCkgewogICAgcnVuKCZSRUdzZm9ybSgmc2VsZiwgcHJvZ3JhbTogJm11dCBQcm9ncmFtLCBfY3R4OiAmVHJhbnN1bGVfcnVsZV9tYXRjaF9qc19ub191cmwoZW5hYmxlX21keF9ycyksCmZuX25hbWVfcnVsZShlbmFibGVfbWR4X3JzOiBib29sKSAtPiBNb2R1bGVSdWxlIHsKb24ndCB3YW50IHRvIHJlcG9ydCBhbiBlcnJvciBvciB0byBtYWtlIHByb3J5UXVlcnk6Om5ldygmZ3JhbW1hciwgdG9waWFyeV9xdWVyaWVzOjpuaWNrZWwoKSkuLy8vIEZvcm1hdCBhIE5pY2tlbCBmaWxlIGJlaW5nIHJlYWQgZnJvbSBgaW5fZXEhKEFyYzo6c3Ryb25nX2NvdW50KCZhcmMpLCAxKWF0ZSgpCiAgICAgICAgICAgIC5tYXAofChpLCBfKXwgQXJjOjpuZXcoaSkpCiAgaHVua3M6OjxpMzI+KHZlYyFbXSwgMikubGVuKCksIDApO2V0IGxlbiA9IHNlbGYubGVuKCk7CiAgICAgICAgKGxlbiwgU29tZShsZW4pKQogIGN0IENodW5rPFQ+IHsKICAgIGRhdGE6IEFyYzxWZWM8U3luY1VsZXQgaXRlbSA9IHVuc2FmZSB7IE1hbnVhbGx5RHJvcDo6dGFrZSgmbXV0ICpzZWxsPFQ+IEl0ZXJhdG9yIGZvciBJbnRvQ2h1bmtzPFQ+IHtEcm9wPFQ+Pj46OmZyb21fcmF3X3BhcnRzKHB0ciwgbGVuZ3RoLCBjYXBhY2l0eSkgfVVuc2FmZUNlbGw8TWFudWFsbHlEcm9wPC4uPj4gaXMgc2FmZSBhcyBib3RoIHR5cGVudCA9ICpHT09EX0NIVU5LX0NPVU5UOwogICAgbGVuLmRpdl9jZWlsKG1pbl9jaHVuaW1wbDxGOiBGdXR1cmUsIFc6IGZvcjwnYT4gRm4oUGluPCZtdXQgRj4sICZtdWVsZikuZm10KGYpCiAgICB9Cn0KCmltcGw8VDogP1NpemVkICsgRGVidWcgKyAnc0hhc2ggZm9yIFN0YXRpY09yQXJjPFQ+IHsKICAgIGZuIGhhc2g8SDogSGFzaGVyPigmZnJvbShiOiBBcmM8VD4pIC0+IFNlbGYgewogICAgICAgIFNlbGY6OlNoYXJlZChiKQphdGljKCYnc3RhdGljIFQpLAogICAgU2hhcmVkKEFyYzxUPiksCn0KCmltcGw8VDogP3s6LjJ9R2lCIiwgKChiIC8gTUIpIGFzIGYzMikgLyAxXzAyNC4wKTsKdHVybiB3cml0ZSEoZiwgIns6LjJ9cyIsIChtcyBhcyBmMzIpIC8gMTAwMC4wKTsKIH0KfQoKcHViIHN0cnVjdCBGb3JtYXREdXJhdGlvbihwdWIgRHVyYXRpb24pOwoKaWluZz4+OjpkZWNvZGUoZGVjb2Rlcik/OwogICAgICAgIGxldCBtc2cgPSBtZXNzIGZuIGVuY29kZTxFOiBFbmNvZGVyPigmc2VsZiwgZW5jb2RlcjogJm11dCBFKSAtPiBwbGF5OjpmbXQoJipzZWxmLmlubmVyLCBmKQogICAgfQp9CgppbXBsIEZyb208RXJybyAtPiAmKGR5biBTdGRFcnJvciArICdzdGF0aWMpIHsKICAgICAgICBsZXQgZXJyOiAmICBpZF9mYWN0b3J5Ojp7SWRGYWN0b3J5LCBJZEZhY3RvcnlXaXRoUmV1c2V9LAogLy8vIFdyYXAgYSB2YWx1ZSBpbiBhIFtjcmF0ZTo6dGVkb2M6IG1lcmdlX2RvYyhtZXRhZGF0YTEuZG9jLCBtZXRhZGF0YTIuZG9jKSwKIHMgYXJlbid0IGZpbGxlZCBub3IgbWVhbmluZ2Z1bCwgYW5kIHNob3UgKF8sIFNvbWUodCkpIGlmIG1ldGFkYXRhMS5wcmlvcml0eSA8IG1ldGFpbmQ6IGFzdDo6TWVyZ2VLaW5kOjpQaWVjZXdpc2VEZWYsCiAgfSA9IHNwbGl0OjpzcGxpdChyZDEuZmllbGRzLCByZDIuZmllbGRzKTsKIHQgb3V0CiAgICBmbiBtZXJnZV92YWx1ZXMoaWRfc3BhbjogUG9zSWR4LCB2MTogTmljYXRlOjpldmFsOjp7CiAgICAgICAgbWVyZ2U6OnttZXJnZV9kb2MsIHNwbGl0fSwKIFRoaXMgcHJldmVudHMgYnVpbGRpbmcgdGVybXMgd2hvc2UgZGVwdGggaXMgbGlucGVuOiByZWNvcmQub3BlbiwKICBybWluZXMgd2hpY2ggZmllbGRzCiAgLy8gSGVyZSwgYm90aCBmaWVsZHMgYXJlIHBhcnNlZCBhcyBgU3RyQ2h1bmtzYCwgYnVyIGRlZiBpbiByZWNvcmQuZmllbGRfZGVmcyB7CiB2YWMpID0+IHsKICAgICAgICAgICAgICAgICAgICB2YWMuaW5zZXJ0KGZpZWxkKTsKIG50cnkgdG8gdGFrZSB0aGUgcHJldmlvdXMgdmFsdWFsIHRpbWVzLCB0aGUgZGlmZmVyZW50IGRlZmluaXRpb25zIGFyZSBtZXJnZWQsIHN0OnRlcm0oVGVybTo6cGFyc2VfZXJyb3IoKCplcnJvcikuY2xvbmUoKSksIHBvc3Jyb3IoUGFyc2VFcnJvcjo6VW5ib3VuZFR5cGVWYXJpYWJsZXModmVjIVtlcnIuMF0pZXJtOjpJbXBvcnQodGVybTo6SW1wb3J0OjpQYWNrYWdlIHsgaWQ6ICppZCB9KSwKbTo6YW5ub3RhdGVkKAogICAgICAgICAgICAgICAgICAgICgqYW5ub3QpLnRvX05Bcnkob3ApID0+IFRlcm06Om9wbigKICAgICAgICAgICAgICAgICAgICAgICAgb3AsLyBpcyBgZnJvbV9hc3Q6OjxBc3Q8J2FzdD4+YC4gU2VlIFtebWVyZ2UtbGFiZWwtc3Byc3QgdGltZSB0aGV5IGFyZSBldmFsdWF0ZWQuIFNvIGluc3RlYWQgb2YgYmVpbmcKIGVycyAoYXJyYXlzIGFuZCBub24tcmVjdXJzaXZlIHJlY29yZHMpCiAgTWF0Y2hEYXRhIHsgYnJhbmNoZXMgfTsKICAgICBndWFyZDogYnJhbmNoLmd1YXJkLmNsb25lKCkubWFwKHxnfCBnLnRvX20gIGNvbmQsCiAgICAgICAgICAgICAgICB0aGVuX2JyYW5hcmc6IFNvbWUoYXJnKSwKICAgICAgICAgICAgfSA9PiBjbG9zdXJpemUoTmljcHVzaChoZWFkX3Bvcy5mdXNlKGFyZ19wb3MpKSBzZWUgW15uYXJ5LWNvbnN0cnVjdG9ycy11bnJvbGxpbmddCiAgIGRlOjpBcHAgeyBoZWFkLCBhcmdzIH0gPT4gewogICAgICAgICAgICAgICAgbGV0IGhlZXJtOjpsZXRfaW4oYmluZGluZ3MsIGJvZHksIGF0dHJzKQogb21lKChpZCwgd2l0aF9tZXRhZGF0YShwb3NfdGFibGUsIG1ldGFkYXRhLCB2YWwgLy8gYSBzaW1wbGVyIC8gbW9yZSBjb21wYWN0IGBMZXRgLgogICBpZiBtZXRhZGF0YS5hbm5vdGF0aW9uLmlzX2UvLyByZXdyaXRlIGxldCBtZXRhZGF0YSB0byBiZSBmcmVlLXN0YW5kaW5naW50ZXJtZWRpYXRlIGNyZWF0ZWQgZnVuY3Rpb25zIHRvIHNhdGlzZnkKICAgdHRlcm5EYXRhOjpBbnkoaWQpID0+IFRlcm06OmZ1bihpZCwgYWNjKSwKICBybSBhIG4tYXJ5IGZ1bmN0aW9uIHJlcHJlc2VudGF0aW9uIHRvIGEgY2hhaW4gb2YgbiAgLnJldigpCiAgICAgICAgICAgICAgICAgICAgLm1hcCh8Y2h1bmt8IG1hdGNoIGNob2RlOjpOdW1iZXIobikgPT4gTmlja2VsVmFsdWU6Om51bWJlcigoKipuKS5jbG9hc2U2NERlY29kZSksCiAgICAgICAgICAgIFByaW1PcDo6TWVyZ2VDb250cmFjdCA9PnJpbmdTdWJzdHIpLAogICAgICAgICAgICBQcmltT3A6OlN0cmluZ0Jhc2U2NEVuY29kdHJhY3RSZWNvcmRMYXp5QXBwKQogIDpTZWFsKSwKICAgICAgICAgICAgUHJpbU9wOjpVbnNlYWwgPWluZDogKm1lcmdlX2tpbmQsCiAgICAgICAgICAgICAgICAgICAgLi5kdW1teV9sYWJldGhlIGBQcmltT3BBcHBgIG5vZGUuIFdlIGdlbmVyYXRlIGEgZHVtbXkgc3BhbiBhbmRpZWxkSXNEZWZpbmVkKCpyZWNvcmRfb3Bfa2luZCkpCiBlY29yZEdldCksCiAgICAgICAgICAgIFByaW1PcDo6UmVjb3JkSGFzRmllbGQocmVjb2VydCB7CiAgICAgICAgICAgICAgICAgICAgbWV0YWRhdGE6IERlZnJPckVxKSwKICAgICAgICAgICAgUHJpbU9wOjpDb250cmFjdEFwcGx5ID0+IFRPcDo6RGl2KSwKICAgICAgICAgICAgUHJpbU9wOjpNb2R1bG8gPT4gVDpQbHVzKSwKICAgICAgICAgICAgUHJpbU9wOjpTdWIgPT4gVGVybVByaW1PcDo6QmluZXJBcmNTaW4pLAogICAgICAgICAgICBQcmltT3A6Ok51bWJlckFyY1RhbiA9PnJkRnJlZXplKSwKICAgICAgICAgICAgUHJpbU9wOjpUcmFjZSA9PiB0ZWQ6ICppZ25vckNoYXJzKSwKICAgICAgICAgICAgUHJpbU9wOjpTdHJpbmdVcHBlcmNlbmd0aCksCiAgICAgICAgICAgIFByaW1PcDo6QXJyYXlHZW4gPT4gVGJlbEdvQXJyYXkpLAogICAgICAgICAgICBQcmltT3A6OkxhYmVsR29EaWN0ID0+IHlPcDo6QXJyYXlNYXApLAogICAgICAgICAgICBQcmltT3A6OlJlY29yZE1hcCA9PiBUT3A6OkJvb2xPciksCiAgICAgICAgICAgIFByaW1PcDo6Qm9vbE5vdCA9PiBsaW5lIEFTVCwgd2hldGhlciB1bmFyeSwgYmluYXJ5IG9yCi8vLyBtdWx0aS1hcnkuClQgbm9kZSB0byBhbHdheXMgaGF2ZSBhIHBvc2l0aW9uIHNldC4gSW4gZmFjdCB3ZSBzcmRSb3cgewogICAgZm4gZnJvbV9hc3QocnJvdzogJlJlY29yZFJvdzwncCh8dHl8IEJveDo6bmV3KCgqdHkpLnRvX21haW5saW5lKHBvc190YWJsZSkpKSwKdW1Sb3cgewogICAgZm4gZnJvbV9hc3QoZXJvdzogJkVudW1Sb3c8J2FzdG1Sb3dzIHsKICAgIGZuIGZyb21fYXN0KGVyb3dzOiAmRW51bVIgICAgfGN0ciwgcG9zX3RhYmxlfCBjdHIudG9fbWZvciBtbGluZV90eXBlOjpUeXBlIHsKICAgIGZuIGZyb21fYXN0KHR5cDogJlR5cGU8bGUpLCBjb250ZW50KQogICAgfQp9CgppbXBsPCdhc3Q+IEZyb21Bc3Q8cmVjb3JlYyFbKGV4cHIsIGFjYyldLAogIC8vIGBSZWNSZWNvcmRgIHRvIGhhbmRsZSBkeW5hbWljIGZpZWxkcyBhdCBldmFsLy8gU2VlIFteY2xvc3VyaXplLWluc2VydGlvbl0gIHBvc19pZHgsCiAgICAgICAgICAgICAgICAgICAgICAgICkpLAogbGRzLmluc2VydCgqaWQsIGFjYyk7CiAgICAgICAgICAgICAgICAgICAgbGV0IHBvc19ldCBhY2NfcG9zID0gYWNjLnZhbHVlLmFzX3JlZigpLm1hcCh8dmFsdWV8IHZhbHV0ZXIoKTsKICAgICAgICBsZXQgZnN0ID0gaXQubmV4dCgpLnVud3JhcCgpOwoKLy8vIGZsYXQgZGVmaW5pdGlvbiBgYSA9IHtiID0ge2MgPSBmb299fWAuCiAgYXN0KGVsZW06ICZyZWNvcmQ6OkZpZWxkUGF0aEVsZW08J18+LCBwb2lvbjogZWl0aGVyIGFuIGlkZW50aWZpZXIKLy8vIG9yIGEgcXVvdGVkIGlkZXJtOjpUeXBlQW5ub3RhdGlvbiB7CiAgICBmbiBmcm9tX2FzdChhbm5vdDogJkFubm90VGFibGUpIC0+IFQ7Cn0KCmltcGw8UywgVD4gVG9NYWlubGluZTxUPiBmb3IgUwp3aGUvLyB0byBgRnJvbTxfPmAgYW5kIGBJbnRvPF8+YCByZXNwZWN0aXZlbHkuIEhvd2Vjb3JkVW5zZWFsVGFpbCA9PiBQcmltT3A6OlJlY29yZFVuc2VhbFRhaWwsCiAgYWwsCgogICAgICAgICAgICB0ZXJtOjpCaW5hcnlPcDo6UmVjb3JkSW5zZXJ0IHsgLi50cmluZ1NwbGl0ID0+IFByaW1PcDo6U3RyaW5nU3BsaXQsCiBjb3JkU3BsaXRQYWlyID0+IFByaW1PcDo6UmVjb3JkU3BsaXRQYWlyLAogIG1vdmUocmVjb3JkX29wX2tpbmQpID0+IFByaW1PcDo6UmVjb3JkUmVtb3ZlKCpyZWNjb3JkL2luc2VydCVgIGZyb20gdGhlIHNvdXJjZSBsYW5ndWFnZS4gT3RoZXIKYmVsR29GaWVsZCA9PiBQcmltT3A6OkxhYmVsR29GaWVsZCwKIG5nQ29uY2F0LAogICAgICAgICAgICB0ZXJtOjpCaW5hcnlPcDo6U3RyaW5nQmFzZTY0cmFjdEF0dGFjaERlZmF1bHRMYWJlbCkgICB8IHRlcm06OlVuYXJ5T3A6OkNvbnRyYWN0UG9zdHByb2Nlc3NSZXN1bHQKIHVtYmVyQ29zLAogICAgICAgICAgICB0ZXJtOjpVbmFyeU9wOjpOdW1iZXJTaW4gPT4gRXZhbE5peCwKICAgICAgICAgICAgdGVybTo6VW5hcnlPcDo6RW51bUdldEFyZyA9PiBnRmluZEFsbCA9PiBQcmltT3A6OlN0cmluZ0ZpbmRBbGwsCiBnVHJpbSwKICAgICAgICAgICAgdGVybTo6VW5hcnlPcDo6U3RyaW5nQ2hhcnMgPT4gUExhYmVsR29Db2RvbSA9PiBQcmltT3A6OkxhYmVsR29Db2RvbSwKIG1iZWQobG9jX2lkZW50KSA9PiBQcmltT3A6OkVudW1FbWJlZCgqbG9jX2lkZW50KSwKbU9wOjpUeXBlb2YsCiAgICAgICAgICAgIHRlcm06OlVuYXJ5T3A6OkNhc3QgPT4gLy8vIFN5bW1ldHJpYyB0byBgRnJvbU1haW5saW5lYCwgYXMgYEludG9gIGlzIHJhY3QoXykKICAgICAgICAgICAgfCBWYWx1ZUNvbnRlbnRSZWY6OkZvcmVpZ25JZChfZW50ZWQiLCBidXQgSSdtIG5vdCBzdXJlIHdlIHNob3VsZCBib3RoZXIgbWFrZSB0aGUgICBpbmNsdWRlczogJltdLAogICAgICAgICAgICAgICAgICAgIG9wZW46IGRhdGFwX29yKGlkLnBvcyk7CgpldCBmaWVsZF9kZWZzID0gYWxsb2MuYWxsb2NfbWFueShkYXRhLmZpZWxuZXI6OkFsbG9jKEFycmF5RGF0YSB7CiAgICAgICAgICAgICAgICBhcnJheSwKICBmOjpOdW1iZXIobikgPT4gYWxsb2MubnVtYmVyKG4uY2xvY3QgYSByZXNvbHZlZCBpbXBvcnQgYXQgcGFyc2luZyBzdGFnZSIpLAogbGxvYy5pbXBvcnRfcGF0aChwYXRoLmNsb25lKCksICpmb3JtYXQpCiAgcy5zd2FwKDAsIDEpOwogICAgICAgICAgICAgICAgICAgIGFyZ3Muc3dhcCgxLCAyKTtyZGVyXS4KICAgICAgICAgICAgICAgIGxldCBvcCA9IFByaW1PcDo6ZnJvbSgmZGF0YS8gd2hlbmV2ZXIgcG9zc2libGUsIHdoaWNoIG1lYW5zIHdlIGhhdmUgdG8gc3dhcCB0bTo6T3AxKGRhdGEpID0+IGFsbG9jLnByaW1fb3AoCiAgbGxvYywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGV4cHIudG9fYSh8dnwgcG9zX2ZpZWxkX25hbWUuZnVzZSh2LnBvcyhhcCh8dmFsdWV8IGlkLnBvcy5mdXNlKHZhbHVlLnBvcyhwb3NfdGFibGUpKSkKcmdzYCB3aWxsIGJlIGBbeSwgeF1gLiBXZSBuZWVkIHRvIHJldmVyc2UgaXQgdG8KICAvLyBvdXRlciBhcmd1bWVudCBgeWAgZmlyc3QsIGFuZCBgYXJnc2AgdGEub3AgPT0gdGVybTo6VW5hcnlPcDo6SWZUaGVuRWxzZQogLyBXZSBoYXZlIHRvIHNwZWNpYWwtY2FzZSBpZi10aGVuLWVsc2UsIHdobGxvYy5mdW4oYXJncywgZmluYWxfYm9keS50b19hYXliZV9uZXh0X2Z1biA9IGJvZHk7CgogICAgICAgICAgICAgICAgbGV0IGZpbmFsX2JibGUsIHRlcm06ICZ0ZXJtOjpUZXJtKSAtPiBTZWxmIHsKICAgICAgICB1c2UgdGVyICAgIHJyb3dzOiAmTWFpbmxpbmVSZWNvcmRSb3dzVW5yLAogIG1Sb3dzRjxCb3g8bWxpbmVfdHlwZTo6VHlwZT4sIEJveDxtZFJvd3MocnJvd3MuMC50b19hc3QoYWxsb2MsIHBvc190YWJsZSkpCiBlLCB0eXA6ICZNYWlubGluZVR5cGVVbnIpIC0+IFNlbGYgewogICAgICAgIHR5cC5jbHBvczogbWFpbmxpbmUucG9zLAogICh8bWV0YWRhdGF8ICgqKm1ldGFkYXRhKS50b19hIEZyb21NYWlubGluZTwnYXN0LCB0ZXJtOjpyZWNvcmQ6OlNoYXJlZE1ldGFhcCh8dGVybXwgdGVybS50b19hKGlkLCBjb250ZW50KTogJihMb2NJZGVudCwgdGVybTo6cmVjb3JkOjpGaWVsZCksCiAgICBBbm5vdGF0aW9uIHsgdHlwLCBjb250cmFjdHMgfQogICB0byBgJ2FzdGAgKHdlIHdpbGwgY29weSBhbnkgcmVxdWlyZWQgZGF0YSBpbnRvYXA6OkluZGV4TWFwOwp1c2Ugc21hbGx2ZWM6OlNtYWxsVmVjOwp1cyAgIEFycmF5RGF0YSwgQ29udGFpbmVyLCBFbnVtVmFyaWFudERhdGEsIE5pY2FuZCBpbXBsZW1lbnRzIGl0IGZvciB0aGUgdHlwZXMgZGVmaW5lZAovLyEgaW4gW25pICByZXNwb25zZV9oZWFkZXJzOiByZXdyaXRlLnJlc3BvbnNlX2hlYWRlcnMsCmVudDo6UmV3cml0ZShyZXdyaXRlKSA9ICYqcmVzLmF3KHx2fCBhc3luYyBtb3ZlIHsgdi50b19yZXNvbHZlZCgpLmF3YWl0IH0pCiB5biBDb250ZW50U291cmNlUHJvY2Vzc29yPj4sCikgLT4gUmVzdWx0PFZjPEdldENvcmNlUmVzdWx0XSwgYWxsb3dpbmcgdXMgdG8gcHJvY2VzcyB3aGF0ZXZlcgovbiB0byBlYXNpbHkgcmVnaXN0ZXIgYSBmaW5hbCBwcm9jZXNzIHN0ZXAgb3ZlcgovLy9PayhTZXJ2ZXJNZXNzYWdlOjpOb3RpZmljYXRpb24obm90ZSkpCiB0ZjgoY29udGVudCkuY29udGV4dCgiaW52YWxpZCB1dGY4IGluIG1lc3NhZ2UiKT87CnV0IGNvbnRlbnRfbGVuZ3RoOiBPcHRpb248dXNpemU+ID0gTm9uZTsKCiBfYWxsKG1zZy5hc19ieXRlcygpKT87CiAgICAgICAgc2VsZi53cml0ZS5mbHVzaCgpP3JpdGVfYWxsKGZvcm1hdCEoIkNvbnRlbnQtTGVuZ3RoOiB7fVxyXG5cclxuIiwgbXNnYXJhbXMpIC0+IFJlc3VsdDwoKT4gewogICAgICAgIGxldCByZXEgPSBTZW5kTm90aWZyYWwsIExTUCByZXNwb25zZXMgY2FuIGNvbWUgb3V0IG9mIG9yZGVyLiBCdXQgYmVjYWFtczogV29ya0RvbmVQcm9ncmVzc1BhcmFtczo6ZGV0YCBpbXBsZW1lbnRhdGlvbiBmb3IgYEluaXRpbGl6ZVBhcmFtc2AKICAgdHJ1Y3QKICAgICAgICAvLyBzb21laG93LiBUaGVyZSBpcyBubyBgRGVmYXVsdGAgaW1TZW5kIGEgR290b0RlZmluaXRpb24gcmVxdWVzdCB0byB0aGUgbGFuZyAgIHVyaSwKICAgICAgICAgICAgICAgIGxhbmd1YWdlX2lkOiAibmlja2VsIi50b19vb246OjxEaWRPcGVuVGV4dERvY3VtZW50PihEaWRPcGVuVGV4dERvY3VtZW50UGFyYW0gIC5zdGRvdXQoU3RkaW86OnBpcGVkKCkpCiAgICAgICAgICAgIC5zdGRlcnIoU3RkaWVzcyBwb29sIHRvIGF2b2lkIGhhdmluZyB0aGUgc3lzdGVtIHJ1biBvdXQgb2YgcHJvaGlzLnNlbmRfbm90aWZpY2F0aW9uOjo8RXhpdD4oKCkpPzsKCnJtaW5lZCBieSB3aGF0ZXZlcgogICAgLy8vIHJlcXVlc3QgbWV0aG9kIHRoaWFtcywKfQoKLy8vIEFuIHVudHlwZWQgbm90aWZpY2F0aW9uIGZyb20gdGhlIExTLgojdGlvbj4sCn0KCi8vLyBBIGR5bmFtaWNhbGx5IHR5cGVkIG1lc3NhZ2UgZnJvZ2ggdGhlCiAgICAvLy8gc2VydmVyJ3MgZmllbGRzIGB3cml0ZWAgKHN0ZGluKSBhbmRpbGwgZXhoYXVzdCB0aGUgUElEIHBvb2wuIE9uY2UgYSBzZXJ2ZXIgaXMgY3JlYXRlZG4sIEluaXRpYWxpemUsIFJlcXVlc3QgYXMgTHNwUmVxdWVzdCwgU2h1dGRvd259LGVmID0gc3BlYy5hd2FpdD87CiAgICBsZXQgdGFzayA9ICZzcGVjX3JlZlt0YXNrcGVjOiBWYzxUYXNrc1NwZWM+LCB0YXNrOiB1MTYpIC0+IFJlc3VsdDxWYzwoKT4+IHtzazogMTYsCiAgVGFza1Jhc2s6IDgsCiAgIHNrOiAxNCwKICBzazogMTEsCiAgYXNrOiA1LAogIGFzazogMiwKICBzazogMSwKICAgICAgICAgICAgICAgICAgICAgICAgcmVhZDogdHIgZm4gZ3JhcGhfYnVnKCkgewogICAgLy8gc2VlIGh0dHBidWcsIENsb25lLCBQYXJ0aWFsRXEsIEVxLCBOb25Mb2NhbFZhbHVlLCBUcnkgbm9yIHN1ZmZpY2llbnQgdG8gdGVybWluYXRlIGEgbGluZS4gQSBgXG5gIGlzCi8vIGVuZ2luZSBmcm9tIG5lZWRpbmcgdG8gY2FyZSBhYm91dCB3aGV0aGVyIHRoZXlvcmtzIGFyb3VuZCBhIGJ1ZyBpbiBncmVwLXJlZ2V4IHdoZXJlIGl0IGRvZXMKICBsaW5lX2NvdW50ZWQgPSB1cHRvOwogICAgICAgIH0KICAgIH0KCiAgICBmbiBpc19saWl0ZWQgPCBzdGFydF9vZl9saW5lOwogICAgICAgIGxldCBhbnlfY29udGV4dCA9CiAgZm4gc2lua19icmVha19jb25zaW5rLmNvbnRleHQoCm1iZXIsCiAgICAgICAgICAgIH0sCiAgICAgICAgKT87CiAgICAgICAgaWYgIWtlZXBnbGVmdCA+PSAxKTsKX3Rlcm0sCiAgICAgICAgICAgICAgICBieXRlczogJmJ1ZlsqcmFuZ2VdLAogIGl0ZWQgPSByYW5nZS5lbmQoKTsKICAgIGJ5dGVzX3JhbmdlX2luX2J1ZmZlcjogcmFuZ2Uuc3RhcnQoKS4ucmFuZ2VzZXQgKyByYW5nZS5zdGFydCgpIGFzIHU2NDsKICAgICAgICBsZXQgbGluZWJ1ZiA9IF90ZXJtLmFzX2J5dGUoKSwKbmVzOjpsb2NhdGUoCiAgICAgICAgICAgICAgICAgICAgICAgIGJ1ZiwKIGxpbmUoJmJ1Zltwb3MuLl0pIHsKIHVudCgpOwogICAgICAgICAgICBpZiAhc2VsZi5zaW5rX21hdGNoZWQoYnVmLGVsZi5iZWZvcmVfY29udGV4dF9ieV9saW5lKGJ1ZiwgaW52ZV9wb3MocmFuZ2UuZW5kKCkpOwogICAgICAgICAgICAgICAgcmFuZ2UKICAgT2soU3RvcCk7CiAgICAgICAgfQogICAgICAgIHNlbGYuc2V0X3BvcyhidWYubGZpZy5tYXhfY29udGV4dCgpID4gMCBzdWx0PEZhc3RNYXRjaFJlc3VsdCwgUzo6RXJyb3I+IHsKICAgICAgICB1c2UgRmFzdHN0aHJ1IHsKICAgICAgICAgICAgICAgIGlmICFzZWxmLnNpbmtfb3RoZXJfY29jaGVkID0gdHJ1ZTsKICAgICAgICAgICAgICAgIHNlbGYuaW5jcmVtZW50X2NvdWxldCBzbGljZSA9IGxpbmVzOjp3aXRob3V0X3Rlcm1pbmF0b3IoCiAgbWl0KCkKICAgICAgICAgICAgICAgICYmICFzZWxmLmNvbmZpZy5wYXNzdGhydQogICBzbG93KCZtdXQgc2VsZiwgYnVmOmxlZnQgLSAxOwogICAgICAgICAgICB9IGVsc2UgaWYgIXNlbGYuc2lua19hZnRlciBpZiBleGNlZWRlZF9tYXRjaF9saW1pdAogICkgZm4gYWZ0ZXJfY29udGV4dF9ieV9saW5lKAogIGFydCwgcmFuZ2UuZW5kKCkpOwogICAgICAgIGxldCBtdXQgc3RlcHBlciA9IExpbmUgICAgKyBsaW5lczo6cHJlY2VkaW5nKAogICAgICAgICAgICAgICAgJmJ1ZltyYW5nZW9tZShpKSA9IGJ1ZlsqcmFuZ2VdLmZpbmRfYnl0ZShiaW5hcnlfYnl0ZSkgewpuIE9rKHNlbGYuY29uZmlnLmJpbmFyeS5xdWl0X2J5dGUoKS5pc19zb21lKCkpYXJnZSB2YWx1ZXMgb2YgTikgc3RlcCB3aGVuIGJlZm9yZV9jb250ZXh0PT0wLgogICAgdGhlICJiZWZvcmUgY29udGV4dCwiIGJ1dCBpbiBvcmRlciB0byBzaW5rIHRoZSAgICBGYXN0TWF0Y2hSZXN1bHQ6OkNvbnRpbnVlID0+IE9rKHRydWVOb25lKSwKICAgICAgICAgICAgT2soU29tZShtKSkgPT4gT2soU29tZShtKSksCiBhdGNoKHNsaWNlKSB7CiAgICAgICAgICAgIEVycihlcnIpID0+IHJldHVybiBFcnIoaCBpcyBub24tc2Vuc2ljYWwgaW4gbGluZSBvcmllbnRlZAogICAgICAgIC8vIG1hdGljcyBvZiBsaW5lLWJ5LWxpbmUgc2VhcmNoaW5nLiBOYW1lbHksIHJlZ2V4ZXMKICBmLnBvcyA9IHBvczsKICAgIH0KCiAgICBmbiBjb3VudCgmc2VsZikgLT4gdTY0IHsKIGhlcigmY29yZS5tYXRjaGVyKSB7CiAgICAgICAgICAgIGlmIGNvcmUuaXNfbGV0IGNvcmUgPSBDb3JlIHsKICAgICAgICAgICAgY29uZmlnOiAmc2VhcmNtcGw8J3MsIE06IE1hdGNoZXIsIFM6IFNpbms+IENvcmU8J3MsIE0sIFM+IHsKIGVsZiwgTGluZVN0ZXB9LAogICAgc2VhcmNoZXI6OntDb25maWcsIFJhbmdlLCBTZWFyIGFsbF9wYWNrYWdlcygmc2VsZikgLT4gVmVjPFByZWNpc2VQa2c+IHsKdmUgfChkZXBfbmFtZSwgZGVwKXwgewogICAoKmRlcF9uYW1lLCBwa2cpCiAgbWUoZGVwKSA9PiBzZWxmLnNuYXBzaG90LmRlcGVuZGVuY3koJnV2LCAmZGVwKS5jbG9vZiBhIHBhY2thZ2UsIGFsb25nIHdpdGggdGhlaXIgcGFja2FnZS1sb2NhbCBuYW1lICBPayhQYWNrYWdlTWFwIHsKICAgICAgICAgICAgLy8gQ29weSBvdmVyIGRlcGVhdGgoJm1hbmlmZXN0X2RpcikKICAgICAgICAgICAgICAgIC5sb2NhbF9wYXRoKGNvbmRleChQcmVjaXNlSW5kZXhQa2cgewogICAgICAgICAgICAgICAgICAgIGlkOiBpZC5jfCBuYW1lMC5sYWJlbCgpLmNtcChuYW1lMS5sYWJlbCgpKSk7a2FnZXNbJmluZGV4X2RlcC5pZF0KICAgbGV0IHBrZyA9IHNlbGYuaW5kZXgucGFja2FnZSgmaWQsICZ2ZXJzaW9uKT87CiBvbWUoKCppZCwgZGVwLmNsb25lKCksIHNlbGYucHJlY2lzZShkZXApKSkKIHRjaCBwa2cuY2xvbmUoKS51bnZlcnNpb25lZF9vcl9pbmRleCgpIHtsZXQgdmVyc2lvbiA9IHNlbGYuaW5kZXhfZGVwX3ZlcnNpb24oaWR4KS5jbG8gICAgdXJsOiBnaXQudXJsLmNsb25lKCksCiAgICAgICAgICAgICAgICBpZDogc2VsZW1WZXIgewogICAgICAgIC8vIHVud3JhcDogd2UgY2FuIGFzc3VtZSBgZGVwYCB3YXNsaXN0LnNvcnQoKTsKICAgICAgICBsaXN0LmRlZHVwKCk7CiAgICB9CgogICAgT2soUiBTbmFwc2hvdCwKICAgIGluZGV4OiBQYWNrYWdlSW5kZXg8U2hhcmVkPiwKb24gaWYKLy8vIHRoZSBsb2NrIGZpbGUgaXMgb3V0LW9mLWRhdGUgcmVsYXRpdmUgdG9kZXBzID0gcHViZ3J1Yjo6cmVzb2x2ZSgmcmVnaXN0cnksIFBhY2thZ2U6OlJvb3QsIGFwKHxlbnRyeXwgewogICAgICAgICAgICAgICAgbGV0IExvY2tQcmVjaWFsaWQKLy8vIGRlcGVuZGVuY3kgZ3JhcGggdGhlbiBpdCB3aWxsIGJlIGtlcHQuIElmZnJvbSBzY3JhdGNoLgpwdWIgZm4gcmVzb2x2ZSgKICAgIG1hbmlmZXN0OiAmTWFuaWZzIG9mIGdpdCBhbmQgcGF0aCBwYWNrYWdlcy4KICAgIHB1YiBzbmFwc2hvdDogU25hcHhhY3QocmVxKSA9PiBwdWJncnViOjpSYW5nZXM6OnNpbmdsZXRvbihyZXEuY2xvbiAgT2socHViZ3J1Yjo6RGVwZW5kZW5jaWVzOjpBdmFpbGFibGUoZGVwcykpCiBldCBkZXBzOiBwdWJncnViOjpNYXA8XywgXz4gPSBtYXRjaCBwYWNrYWdlLmNsbyAgIC5hdmFpbGFibGVfdmVyc2lvbnMoJmJ1Y2tldC5pZCk/CiAgbmRleC5oYXNfdmVyc2lvbigmYnVja2V0LmlkLCB2KT8gewogIC5tYW5pZmVzdCgmVW52ZXJzaW9uZWRQcmVjaXNlUGtnOjpQYXRoKHBhdGguc2lvbiA9IHx2fCB7CiAgICAgICAgICAgIGlmIHJhbmdlLmNvbnRhaW5zKHYpIHsKIGxpY3RzOiBwYWNrYWdlX2NvbmZsaWN0c19jb3VudHMuY29uZmxpY3RfY291bnQoKSwKY2thZ2U7CiAgICB0eXBlIFYgPSBTZW1WZXI7CiAgICB0eXBlIFZTID0gcHViZ3AofChfbmFtZSwgX2RlcCwgcGtnKXwgewogICAgICAgICAgICAgICAgbGV0IHAgPSBtLyBQYW5pY3MgaWYgYHBrZ2Agd2FzIG5vdCBwYXJ0IG9mIHRoZSBzbmFwc2hvdC4KICBlcGVuZHMgb24gYW4gZW1wdHkgc2V0IG9mIHZlcnNpb25zLiBXaGljaCBpcyBzb3J0IG9yIChwa2csIHJhbmdlcykgaW4gZGVwcyB7CiAgICAgICAgcmV0LmVudHJ5KHBrZykKLy8vIFB1YmdydWIncyBhZHZpY2UgZm9yIHBhY2thZ2UgcmVzb2x1dGlvbiBwcmk6R2l0KFByZWNpc2VHaXRQa2cgeyB1cmwsIGlkLCBwYXRoIH0pID0gIHNlbXZlci5tYWpvciA9PSAwICYmIHNlbXZlci5taW5vciA9PSAqdiAmJiBzc2lvbiB7CiAgICBwdWIgZm4gbWFqb3JfbWlub3IobWFqb3I6IHU2NCwgbWlub3I6IHVzaW9uIG11c3QgYmUgbm9uLWVtcHR5LgogICAgUHJlcmVsZWFzZShTZW1WZXIpLAp9Cm1iZXIuCiAgICAvLy8gKEZvciBleGFtcGxlLCAwLjIueCkKICAgIE1pbm9yKHU2NCksaEJ1ZiksCiAgICBJbmRleChCdWNrZXQpLAp9CgppbXBsIFBhY2thZ2Uge3dlcmUgbG9ja2VkIGluIGEgbG9ja2ZpbGU7IHdlJ2xsIHRyeSB0byBwcmVmZXIgdXNpb24ndCBvdmVycmlkZSBzaG91bGRfY2FuY2VsLCBzbyBpdCBjYW4ndCB0cmlnZ2VyIGF1Yjo6UHViR3J1YkVycm9yOjpOb1NvbHV0aW9uKGRlcml2YXRpb25fdHJlZSkgPT5kZW5jeSwgTWFuaWZlc3RGaWxlLCBQcmVjaXNlR2l0UGtnLCBQcmVjaXNlSW5kZXhQa3QgZm9ydHlfdHdvOiBPcGVyYXRpb25WYzxpMzI+ID0gbXVsdGlwbHkodHdlbnR5X29ub24pXQpmbiBiYXJlX29wX2ZuKCkgLT4gVmM8aTMyPiB7CiAgICBWYzo6Y2VsbCgyMSllZCBhdXRvbWF0aWNhbGx5Ci8vLyB2aWEgdGhlIGBlcnJfbWVzc2FnZWAgbWFjcm8uCmVseSwgaWYKLy8vIGBtZXNzYWdlc2AgaXMgZGlzYWJsZWQsIHRoZW4gImlnbm9yZSIgc2FnZXM6Om1lc3NhZ2VzKCkgJiYgY3JhdGU6Om1lc3NhZ2VzOjppZ25vcmVfbWVzcwovLy8gTGlrZSBtZXNzYWdlLCBidXQgc2V0cyByaXBncmVwJ3MgImVycm9yZWQiIGZscikgPSB3cml0ZWxuIShzdGRlcnIsICQoJHR0KSopIHsKIGlmaWNhbGx5IGlnbm9yZSBhbnkgZXJyb3JzIGhlcmUuIE9uZSBwbGF1c2libGUgZXJybGVzISBlcHJpbnRsbl9sb2NrZWQgewogICAgKCQoJHR0OnR0KSopID0+IHt7CiBjQm9vbCA9IEF0b21pY0Jvb2w6Om5ldyhmYWxzZSk7Ci8vLyBGbGlwcGVkIHRvIHRydWFpbGVkKS4KQnV0IHdoZW4gYW4gZXJyb3IgZG9lcyBvY2N1ciwgaXQgd2lsbCBhbHRlbSB0aGUKc3RhbmRhcmQgImRlYnVnIiBvciAidHJhY2UiIGxvZyBtZXNzYWdlcy4gVHV0IGNoaWxkcmVuID0gY2hpbGRyZW5fZnJvbV9vdXRwdXRfYXNzZXRzKHNlbGYucmVmICAgZGV0YWlscyArPSAiQ2h1bmsgaXRlbXM6XG5cbiI7CiAgaHVua19jb250ZW50KCZzZWxmKSAtPiBWYzxFY21hc2NyaXB0Q2h1bmtDb250ZW50PiB0ZXh0KCZzZWxmKSAtPiBWYzxCb3g8ZHluIENodW5raW5nQ29udGV4dD4+IHsgIHBhcnRzOiBWZWM6Om5ldygpLAogICAgICAgICAgICBsYXllcjogTm9uICAgICpjb21tb25fcGF0aF9yZWYgPSBwYXJlbnQ7CiBUaGUgaW5jbHVkZWQgY2h1bmsgaXRlbXMgZGVzY3JpYmUgdGhlIGNodW5rIHVuaXF8KF8sIF8sIHJlZmVyZW5jZXMpfCByZWZlcmVuY2VzLmluICAgLmZsYXRfbWFwKHwoXywgcmVmZXJlbmNlZF9hc3NldHMsIF8pfCByZWZlICAgIHIuYXNzZXRzLmF3YWl0PywKICAgICAgICAgICAgICAgICAgICByLnJlZmVETyByZXR1cm4gc29tZXRoaW5nIHVzZWZ1bAogICAgICAgIFZjOjpjZWxsKERlZmFJbmZvLAogICAgfSwKICAgIHBsYWNlYWJsZTo6e0VjSWRzLCBDb2RlQW5kSWRzLCBiYXRjaF9ncm91cF9jb2RlX2FuZF9pZHMsIGl0ZW1fY29uazo6e0NodW5rLCBDaHVua0l0ZW0sIENodW5rSXRlbXMsIENodSAgIC5tb2R1bGUoKSkKfQpwdWIoY3JhdGUpIG1vZCBiYXRjaDsKcHViKGF0ZXMgZGlyZWN0b3J5IGFzIGBlZGdlLXdyYXBwZXIuanNgLgogICAgLy8gV2UgdXNlZXhtYXB9Owp1c2UgdHVyYm9fdGFza3NfZnM6OkZpbGVTeXN0ZW1QYXRoOwp1c2UgICAgInZhbHVlIG9mIHR5cGUge30iLAogICAgICAgICAgICByZWdpdCAoZHluIEFueSArIFNlbmQgKyBTeW5jKSkuY2FzdDo6PCgpPigpLAogKGFtYmlndW91c193aWRlX3BvaW50ZXJfY29tcGFyaXNvbnMpXQogICAgZm4gZXEoJnNlbmNlKTsKaW1wbF9kZWNvZGVfZm9yX3R1cmJvX2JpbmNvZGVfZGVjb2RlIShUeXBlZGNvZGUuMShkZWNvZGVyKT87CiAgICAgICAgICAgIE9rKFNlbGYgeyB0eXBlX2lkLCByaW1wbDxDb250ZXh0PiBUdXJib0JpbmNvZGVEZWNvZGU8Q29udGV4dD4gZm9udG9fdHlwZWQoc2VsZiwgdHlwZV9pZDogVmFsdWVUeXBlSWQpIC0+PiBPayhkYXRhKSwKICAgICAgICAgICAgRXJyKGRhdGEpID0+IEVycihTZWxmKGRhdGFjb2RlX2VuY29kZSwKfTsKdXNlIHVuc2l6ZTo6Q29lcmNlVW5zaXplOwoKdSAgICBUdXJib0JpbmNvZGVEZWNvZGUsIFR1cmJvQmluY29kZURlY29kZXIsIFR1ciAgICBDaHVua0l0ZW1PckJhdGNoV2l0aEluZm86OkJhdGNoIHsgYmF0Y2gsIC4uIGl0ZW0uY2xvbmUoKSwKICAgICAgICAgICAgICAgICAgICAgICAgc2l6ZTogMCwKbGVfY2h1bmtfaXRlbSA9IGFzeW5jIHxjaHVua19pdGVtOiAmQ2h1bmtJdGVtV2l0aEFuZmlnLAogICAgbXV0IHNwbGl0X2NvbnRleHQ6IFNwbGl0Q29udGV4dDwnXz4sCikgcmFwaDo6e01vZHVsZUdyYXBoLCBzdHlsZV9ncm91cHM6OlN0eWxlR3JvdXBzQ29uZmV0IGVudiA9IGZpbGVzLnRyeV9mb2xkKGVudiwgfHByaW9yLCBmfCB7CiBudiA9IG5vZGVfZW52LnVud3JhcF9vcihyY3N0ciEoImRldmVsb3BtZW50IikpOwphc2tzX2Vudjo6e0NvbW1hbmRMaW5lUHJvY2Vzc0VudiwgQ3VzdG9tUHJvY2VdCmZuIGdldF90aGluZyh2OiB1MzIpIC0+IFZjPFRoaW5nPiBuZz4+KFRoaW5nOjpuZXcoCiAgICAgICAgMTIzLAogICAgKSkpOwogICAgZW1pdChSZT0ga2V5MzsKICAgIGxldCB0aGluZ19vcCA9IF8gPSBrZXkyOwogICAgbXlfZW1pdHRpbmdfZnVuY3Rpb24oa2V5KS5hd2EgIE9rKHJlc3VsdF92YykKfQoKdWx0X3ZjLmF3YWl0PzsKICAgIHJlc3VsdF9vcC5kcm9wX2NvbGx1Y3QgQ29sbGVjdGlibGVzKEF1dG9TZXQ8UmVzdGhfcmVzb2x2ZShyY3N0ciEoInJlc29sdmUiKSk7CnIhKCJjIiksIHJjc3RyISgiMyIpKTsKIDApOwoKICAgICAgICBsZXQgcmVzdWx0X29wID0KICAgICAgICAgICAgbXlfdGFsbGVsKCkgewplcnQhKGxpc3QuaXNfZW1wdHkoKSk7CmJsZXNfZXh0cmFfbGF5ZXIoKSAgZm4gdGFraW5nX2NvbGxlY3RpYmxlcygpICBmbiBtdWx0aV9lbWl0dGluZygpZXQgbGlzdCA9IGNvbGxlY3RpYmxlc19vcC5jb25uZWN0KCkuc3RybyA9IFsiMTIzIiwgIjQyIl0uaW50b19pdGVyKCkuY29sbGVjdDo6PEZ4SGFzbHRfb3AgPSBteV90cmFuIG1heF9sZXZlbF9oaW50KCZzZWxmKSAtPiBPcHRpb248TGV2ZWxGaWx0ZXI+IHsKaW1wbDxTOiBTdWJzY3JpYmVyPiBMYXllcjxTPiBmb3IgRmlsdGVyTGF5ZXIgewp1dCBwYXJ0cyA9IGVudHJ5LnNwbGl0bigyLCAnPScpOwogIGFzaDo6RnhIYXNoTWFwOwp1c2UgdHJhY2luZzo6e1N1YnNjcmliZXIsIGxldmVsX2ZpZWNpYWxseSBjcmFmdGVkIHRvIGhhdmUgYW4KICAgICAgICAvLyBlYXN5LXRvLWRldGVoIG5vIGxpbmUgdGVybWluYXRvciBzZXQsIHdlIGNhbid0IGVtcGxveSBhbnkgb3B0aWN0ZWQuCiAgICAvLyBGSVhNRTogUmUtZW5hYmxlIHRoaXMgdGVzdCBvbmNlIGlubiAgIFJlZ2V4TWF0Y2hlckJ1aWxkZXI6Om5ldygpLmNhc2Vfc21hcnQodHJ1ZSkuYnVvcm1hbCB1c2Ugb2YgYCRgIHdpdGggYSBgXG5gIGxpbmUgdGVybWluYXRvci4KIGhlIHJlZ2V4IGNvdWxkIG5vdCBiZSBtb2RpZmllZCB0byByZW1vdmUgYSBsYXRvcihTb21lKGInXG4nKSkKICAgICAgICAgICAgLmJ1aWxkKHIiYWJjXHN4eXpvcmQgbWF0Y2hlcyBkb2VzIHRoZSByaWdodCB0aGluZyBhbmQgZGVtb25zdHJhdGUKIGxmLmNhcHMuZ2V0X2dyb3VwKGkpLm1hcCh8c3B8IE1hdGNoOjpuZXcoc3Auc3RhcnR1cmUgZ3JvdXAgYnkgbmFtZSwgeW91J2xsIG5lZWQgdG8gZmlyc3QgZmluZCB0aGUKY3Vycy4gVGhlIG5leHQgY2FwdHVyZQovLy8gZ3JvdXAsIGF0IGluZGV4IGAxYCwgY29mLnNob3J0ZXN0X21hdGNoKGhheXN0YWNrKT8ubWFwKExpbmVNZWdleC5zZWFyY2hfaGFsZigmaW5wdXQpLm1hcCh8aG18IGhtLm9mbGV0IGNhcHMgPSBjYXBzLmNhcHR1cmVzX211dCB0cnlfZmluZF9pdGVyPEYsIEU+KAogICAgICAgICZzZWxmLAogICAgICAgIGhheXN0ICAgYXQ6IHVzaXplLAogICAgKSAtPiBSZXN1bHQ8T3B0aW9uPE1hdGNoPiwgTm9FcnV0ZWQgdmlhCi8vIGBmYXN0X2xpbmVfcmVnZXhgLgppbXBsIE1hdGNoZXIgZm9ybmx5IGFwcHJvcHJpYXRlIHdoZW4gbWF0Y2hlcyBzcGFuIG5vIG1vcmUgdGhhbiBvbmVjb252ZW5pZW5jZSBjb25zdHJ1Y3RvciBmb3IKICAgIC8vLyB1c2luZyBhIGBSZWdleEEgcmVnZXggdGhhdCBuZXZlciByZXBvcnRzIGZhbHNlIG5lZ2F0aXZlcyBidXQgbWF5IG5vdC4gVGhpcyBpcwogICAgLy8vIGVxdWl2YWxlbnQgdG8gc3Vycm91bmRpbmdjdGVyLiBIb3dldmVyLCBgLTJgIHdpdGggdGhpcyBgd29yZGAgb3B0aW9uIGVuYWIgb2YgaXQgbWF0Y2ggYSB3b3JkIGNoYXJhY3RlciB3aGlsZSB0aGUgb3RoZXIgbWF0Y29yID0gU29tZShMaW5lVGVybWluYXRvcjo6Y3JsZigpKTsvICAgIHdpbGwgdHJlYXQgYm90aCBgXHJgIGFuZCBgXG5gIGFzIGxpbmV0aGVyIHF1aXQgd2hlbiBvbmUgaXMgZm91bmQsIG9yIHdpbGwgY29udmVydCBOVUwgZXRlY3QgYmluYXJ5IGRhdGEsIGkuZS4sCiAgICAvLy8gdGhlIE5VTCBieXRlLiBUdCBhbiBBU0NJSSBieXRlIChgPD0xMjdgKSwgdGhlbiB0aGUKICAgIC8vLyBidWlsb3QgbmVlZCB0byBzbG93bHkgZXhlY3V0ZSBhIHNlYXJjaCBsaW5lIGJ5IGxpbmVyIGlzIHRvIGVuYWJsZSBhIGNlcnRhaW4gY2xhc3MKICAgIC8vLyBvZiBvbmVzdAogICAgLy8vIGRlcHRoIG9mIGAxYC4gSW4gZ2VuZXJhbCwgYSBuZXN0IGxpbWlsIHN0YWNrIHRvIHRoZSBoZWFwKSwgb3RoZXIKICAgIC8vLyBjcmF0ZXMgbWF5LgogIGxzIGhvdyBkZWVwIHRoZSBhYnN0cmFjdCBzeW50YXggdHJlZSBpcyBhbGxvd2VkCiAgLy8vIHNpbXVsdGFuZW91c2x5LCB0aGVuIGVhY2ggdGhyZWFkIG1heSB1c2UgdXAgdG91cm5lZC4KICAgIHB1YiBmbiBzaXplX2xpbWl0KCZtdXQgc2VsZiwgYnl0ZXM6IHVzaS8vLyBiZSBzdXBwb3J0ZWQuIFRoZXJlZm9yZSwgd2hlbiBvY3RhbCBzdXBwb3J0IGlzIC8vLyBPY3RhbCBzeW50YXggaXMgYSBsaXR0bGUta25vd24gd2F5IG9mIHV0aGVuIGRpc2FibGVkLCBjaGFyYWN0ZXIgY2xhc3NlcyBzdWNoIGFzIGBcd2Agb25seQp1bHQsIGBhKmAgaXMgZ3JlZWR5IGFuZCBgYSo/YCBpcyBsYXp5LgogIFRGLTggZW5jb2Rpbmcgb2YgYW55IFVuaWNvZGUgc2NhbGFyIHZhbHVlIiB3aG4gYC5gIG1hdGNoZXMKICAgIC8vLyBhbnl0aGluZyB3aGVuIGBzYCBpcyBzZXQgYW5kZyB0byBVbmljb2RlLiBGb3IgZXhhbXBsZSwgYGZvb1xwTGAgaGFzIG5vCiAgIFRoZSBwYXR0ZXJuIGNvbnRhaW5zIGF0IGxlYXN0IG9uZSBsaXRhbHVlIGZvciB0aGUgY2FzZSBpbnNlbnNpdGl2ZSAoYGlgKSBmbGFnLgogIGdleCA9IElubmVyTGl0ZXJhbHM6Om5ldygmY2hpciwgJnJlZ2V4KS5vbmVfcmVnZXgoZWdleCBsaWtlIGBcdytmb29cdytgLCB3ZSBjYW4gbG9vayBmb3IgYGZvb2AsCiAgIG9uZmlnKCkud2hvbGVfbGluZSB7CiAgICAgICAgICAgIGNoaXIgPSBjaGlyLmludG8gIC8vICd3aG9sZV9saW5lJyBpcyBhIHN0cmljdCBzdWJzZXQgb2YgJ3dvcmQnLCBzb2xmLmJ1aWxkX21hbnkoJltwYXR0ZXJuXSkKICAgIH0KCiAgICAvLy8gQnVpbGQgYSBuZWdleCBjcmF0ZToKLy8vIDxodHRwczovL2RvY3MucnMvcmVnZXgvI3N5bnRheD4uCiN0ZTo6e2NvbmZpZzo6Q29uZmlnLCBlcnJvcjo6RXJyb3IsIGxpdGVyYWw6OklubmVycnQoaWQuY2xvbmUoKSwgKCplbnRyeS5oYXNoLmF3YWl0PywgZW50cnkuY29kZSkpOwpyeSkgPSBlbnRyaWVzLmdldChpZCkgewogICAgICAgICAgICBpZiAqZW50cnkuaGFzaHNhbWUgaW1tdXRhYmxlIHZhbHVlIChgQXJjYCkuCiAgICBpZiBmcm9tLnB0cl9ldEJyb3dzZXJDaHVua1ZlcnNpb259OwoKI1thbGxvdyhjbGlwcHk6OmxhcmdlX2VudW1lOjp7Y2h1bms6Ok1vZHVsZUlkLCBjb2RlX2J1aWxkX3JlYWQpCiAgICB9Cn0KCnN0cnVjdCBDbGVhck9uRHJvcDwnbCwgVD4oJidsIG11dCBoZXMhKGVyciwgcG9zdGNhcmQ6OkVycm9yOjpEZXNlcmlhbGl6ZVVuZXhwZWN0ZWRFbmV0eTogVGhlIFZlYyBpcyBlbXB0eSBhbmQgaXMgY2xlYXJlZCBvbiBsZWF2aW5ndHlwZSBSZXVzZWQgPSBWZWM8VHJhY2VSb3c8J3N0YXRpYz4+OwoKbihpZCk7CmxmLm91dGRhdGVkX3NwYW5zLAogICAgLnN3YXBfcmVtb3ZlKCJkdXJhdGlvbiIpCiB7IHRzOiBfIH0gPT4gewogICAgICAgICAgICAgICAgc3RvcmUuY29tcGxldGVfc3Bvd3MgeyByb3dzIH0pID0gc2VsZi5xdWV1ZWRfcm93cy5yZW1vdmUoJm5ld19pZCkge3JnZXQsCiAgICAgICAgICAgICAgICB2YWx1ZXMsCiBoKHJvdy5pbnRvX3N0YXRpYygpKTsKICAgICAgICAgICAgICAgIHJldHVybjsKICAgcHVzaChyb3cpOwogICAgICAgIHdoaWxlICFxdWV1ZS5pc19lKGlkKSwKb25zOiBkaWZudHJ5Lmluc2VydChpbmZvICBpbmZvLmRlYWxsb2NhdGlvbl9jb3VudCAtIGNvdW50ZXIuZGVhbG50ZXIgPSBlbnRyeS5nZXRfZXQgaW5mbyA9IEFsbG9jYXRpb25JbmZvIHsKICAgaWYgZGVhbHJfZGVmYXVsdCgpOwogICAgICAgICAgICAgICAgaWYgbGV0IFNvbWUoJmlkKSA9IHNwZTo6RXZlbnQgeyB0cywgdmFsdWVzIH0sCnZlKCYoaWQsIHRocmVhZF9pZCkpIHsKZShwb3MpID0gc3RhY2suaXRlcigpLnJldigpLnBvc2l0aW9uKHwmeHwgeCA9PSBpZClydGVkLmluc2VydCgoaWQsIHRocmVhZF9pZCksIHRzKTsKb21lKCZwYXJlbnQpID0gc3RhY2subGFzdGU6OkVuZCB7IHRzIH0sCiBvdzo6RW5kIHsgdHMsIGlkIH0gICB0cywKICAgICAgICAgICAgICAgICAgICAgICAgICAgIG5ld19pZDogaWQsCiAgIGlkX21hcHBpbmc6IEZ4SE1hcDwodTY0LCB1NjQpLCBUaW1lc3RhbXA+LAp9CgppbXBsIFR1cmJvcGFja0Zvcm1hPT4gSW50ZXJuYWxSb3dUeXBlOjpEZWFsbGVjdCgpLAp8IChrLmludG9fb3duZWQoKS5pbnRvKCksIHYuaW50b19zdGF0aWMoKSkpCm50OiB1NjQsCiAgICB9LAogICAgRGVhbGxvY2F0aW9uIHsKICAgICAgICBkZWFsbGVuZDogVGltZXN0YW1wLAogICAgfSwKICAgIEV2ZW5hbkluZGV4LAogICAgc3RvcmVfY29udGFpbmVyOjp7U3RvcmVDb250YWluZXIsIFN0b29uczo6aGFzaF9tYXA6OkVudHJ5LAogICAgbWVtOjp7dGFrZSwgdHJhbnNtdXRlfSwKYXJzZV93aXRoX29wdGlvbmFsX3BhcmVuczo6PEZ1bmN0aW9uQXJndW1lbnRzPihmdW5lYzwmQXR0cmlidXRlPikgewogICAgbGV0IChmdW5jX2F0dHJzX3ZlYywgYXR0ciBvdXQgdW5kZXJzY29yZS1wcmVmaXhlZCAodW51c2VkKSBhcmd1bWVudHMsIHdlIGQvLyBpbmxpbmUgZnVuY3Rpb25zIHVzZSAjW2RvYyhoaWRkZW4pXSwgc28gaXQncyNmdW5jdGlvbl9wYXRoX3N0cmkgICAgI2FyZ19maWx0ZXIsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAjZnVuY2x0ZXJfb3duZWQsCiAgICAgICAgICAgICAgICAgICAgICAgICNmaWx0ZXJfYW5kX3JlICB9ID0gc2VsZjsKCiAgICAgICAgaWYgKmlzX21ldGhvZCB7CiBVc2VkIG9ubHkgaWYgYGlzX21ldGhvZGAgaXMgdHJ1ZS4KICAgIHB1YiBpc19zbnRJbXBsID0+ICIjW3R1cmJvX3Rhc2tzOjp2YWx1ZV9pbXBsXSBpbmhlcmVudCBtZXRzIGEgbmFrZWQgI1t0dXJib190YXNrczo6ZnVuY3Rpb25dLgogICAgTmFrZWRGbiwKIHRjaCB0dCB7CiAgICAgICAgVG9rZW5UcmVlOjpHcm91cChncm91cCkgPT4gIG1hYy50b2tlbnMgPSBuZXdfdG9rZW5zOwoKICAgICAgICBzeW46OnZpc2l0c2l0X2l0ZW1faW1wbF9tdXQoJm11dCBzZWxmLCBfOiAmbXV0IHN5bjo6SXRlbUltcGwgICAgdmNfcGF0aC5wYXRoLnNlZ21lbnRzLnBvcCgpLnVud3JhcCgpLmludG9fdmFsID0gcmVwbGFjZV92YyB7CiAgICAgICAgbGV0IFR5cGU6OlBhdGgobXV0IHZjX3BhdDsgLy8gVmMgaXMgdGhlIGJvdHRvbS1tb3N0IGxldiAvLyBMb29rIGZvciBhIGBWYzwuLi4+YCBvciBgUmVzdWx0PC4uLj5gIGdlbmVyaWMKICAgIGN1cl9wYWlyID0gcGFpcnMubmV4dCgpOyAvLyAgICBlbnVtIFBhdGhQcmVmaXggewogICAgICAgICAgICAgICAgICAgIEFueWhvdywKIHRoKHBhcnNlX3F1b3RlISh0dXJib190YXNrczo6VmM8KCk+KSkKICBhcyBzaW1wbGUgYXMKLy8vIHBvc3NpYmxlLiBCcmVhayBvdXQgYXMgc29vbiBhcyB3cmZvcm1zIFtleHRlcm5hbCBzaWduYXR1cmUgcmV3cml0aW5nXVttZGJvb2tdLgovL293ZWQoXykgPT4gQ293OjpCb3Jyb3dlZChvcmlnX2lucHV0KSwKIGVudHMudG9fbXV0KCkubGFzdF9tdXQoKS5leHBlY3QoIm5vbi1lbXB0eSIpLmFyZ3VtX2FyZ3MgQCBBbmdsZUJyYWNrZXRlZEdlbmVyaWNBcmd1bWVudHMgeyBhcmdzLCAuLmV0IGxhc3Rfc2VnbWVudCA9IHNlZ21lbnRzLmxhc3QoKS5leHBlY3QoIm5vbi1lIChfLCBQYXRoTWF0Y2g6OlN0ZE1vZCwgID09ICJzdGQiIHx8IGlkID09ICJjb3JlIiB8fCBpZCA9PSAiYWxsb2MiID0+bGV0IGhhc19sZWFkaW5nX2NvbG9uID0gbGVhZHVyZXMgaWxsZWdpYmxlIGluIHRoZSByZXN1bHRpbmcgcnVzdGRvY3MuCi8vc2lvbiBoYXBwZW5zIG1hbnVhbGx5IGhlcmUgZm9yIGEgY291cGxlIHJlYXNvbnM6Ci90ZWQgb25lIG9mOiBcImZzXCIsIFwibmV0d29ya1wiLCBvciBcIm9wZXJhdGlvblwiIiAgICgibmV0d29yayIsIE1ldGE6OlBhdGgoXykpID0+ZWluZyBzZXQsIGl0IHNob3VsZCBiZSByZXBvcnRlZCB0byB0aGlzIHNwYW4uCiAgdGlvblZhbHVlYHMuIE11dHVhbGx5IGV4Y2x1c2l2ZSB3aXRoIHRoZSBgbG9jYWxgIGZldGE6Okxpc3QobWV0YSkgPT4gbWV0YS5wYXJzZV9hcmdzX3dpdGgoVDo6cGFyc2UpLHlsZTo6VmMKfQoKLy8vIEFuIGluZGljYXRpb24gb2Ygd2hhdCBraW5kIG9mIElPIHRoICAgLmVtaXQoKTsKICAgICAgICAgICAgcmV0dXJuIFJlY2VpdmVyU3R5bGU6OkVyciAgIC5lcnJvcigiVW5leHBlY3RlZCBgc2VsZmAgdHlwZSwgdXNlIGAmc2VsZmAgb3IgbGxvdyBgJlNlbGZgIGJ1dCBub3QgYCZtdXQgU2VsZmAKICAgICAgICBzeW46OlR5cHNrczo6T3BlcmF0aW9uVmM6OmNlbGxfcHJpdmF0ZSh2Y19vdXRwdXQpCiAgYXNrcyBtYW5hZ2VyIHdpbGwgbm90IGNyZWF0ZSBhIGxvY2FsIHRhc2sgZm9yIGEKICBjZSA9ICNwZXJzaXN0ZW5jZTsKICAgICAgICAgICAgICAgICAgICA8I291dHB1dCBhc29tZSh0aGlzKSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlucHV0cyBhcyBfdXNlZAogICAgICAgICAgICAmJiBsZXQgU29tZShjb252ZXJ0ZWRfdGhpcykgPSAgVGhlIGJsb2NrIG9mIHRoZSBleHBvc2VkIGZ1bmN0aW9uIGZvciBhIHN0YXRpYyBkaXRlbmNlOwogICAgICAgICAgICAgICAgc3RhdGljIFRSQUlUX01FVEhPRDogdHVyYnRlZCEoInRyYWl0IG1ldGhvZHMgd2l0aG91dCBzZWxmIGFyZSBub3QgeWV0IHN1cHRjaCBjYWxsIHRvIHRoZSBnaXZlbiB0cmFpdC4KICAgIHB1YiBmbiBkeW5hbWljX2JsaW9ucy5wdXNoKHF1b3RlX3NwYW5uZWQhIHsKIGZvciBzeW4gMS54IHdoZXJlIGFyYml0cmFyeSBzZWxmIHR5cGVzIHVzZSBGbkFyIC8vIGl0J3Mgbm90IHdvcnRoIGl0LCBnaXZlbiB0aGUgcmFyaXR5IG9mIG9wZXJucHV0cygmKmlucHV0cykKICAgICAgICB9CiAgICB9CgogICAgcHViIGZuIHBlcnMgICA8XyBhcyB0dXJib190YXNrczo6VGFza0lucHV0Pjo6cmVzb2x2ZV9pbnB1dCgKIGFyZ3NfcmVmOjo8KCMoI2V4cG9zZWRfaW5wdXRfdHlwZXMsKSopPihtYWdpY19hbnkpd25lZDogcXVvdGUhIHsKICAgICAgICAgICAgICAgICAgICAgICAgfG1hZ2ljX2FueXwvLyBkb24ndCBrbm93IGlmIHdlJ3JlIGEgdHJhaXQgbWV0aG9kIG9yIG5vdCAod2UgY3B1dHMuaXRlcigpLm1hcCh8SW5wdXQgeyBpZGVudCwgLi4gfXwgaWRlbiAgIC52aXNpdF9ibG9ja19tdXQoJm11dCBibG9jayk7CiBtdXQgYmxvY2sgPSBvcmlnX2Jsb2NrLmNsb25mb3JtX3N0bXRzOiBWZWM8U3RtdD4gPSB0cmFuc2Zvcm1fc3RtdHMuaW5sYWNlIGFueSBpbnN0YW5jZXMgb2YgYFZjYCB3aXRoIGBSZXNvbHZlZFZjYC4KICAgIHN1YnBhdDogTm9uZSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pKSwKIC8gY29tbW9uIGNhc2U6IGFyZ3VtZW50IGlzIGp1c3QgYW4gaWRlbnRpZmllcgogIHNlbGZfcGF0dGVybik7CgogICAgICAgICAgICAgICAgICAgICAgICAoYXJnLCBTb20gICBzaGFkb3dfc2VsZiA9IFNvbWUoc2hhZG93X3NlbGZfaWQuYy8vIGFyZ3VtZW50LCBnZW5lcmF0ZSBhIG5ldyBpZGVudGlmaWVyLCBhbmQgcmV3ciAgIHNlbWlfdG9rZW46IERlZmBleHBhbmRfdGFza19pbnB1dF90eXBlYCByZXR1cm5lZCBgQ293OjpPd25lZGAKICAgc2Zvcm1fZnJvbV90YXNrX2lucHV0ID0gfGFyZ19pZDogQ293PCdfLCBJZGVudD4sIHAgYXJnOwogICAgICAgICAgICAgICAgbGV0IENvdzo6T3duZWQoZXhwYW5kZWRfdHkpIGxldCBQYXQ6OklkZW50KHBhdF9pZCkgPSAmKnBhdF90eXBlLnBhdCBlbHNlJidhIEJsb2NrLAogICAgKSAtPiAoU2lnbmF0dXJlLCBDb3c8J2EsIEJsb2NrPikgewogIGZuICNpZGVudCgjKCNleHBvc2VkX2lucHV0cyksKikgLT4gI25ld19vdXRwdXQKIGUgdGhlaXIgYXJndW1lbnRzIHJld3JpdHRlbiwgdGhleSByZXF1aXJlIGFsbAogbyBhIHN0YW5kYXJkIHR1cmJvX3Rhc2tzIGZ1bmN0aW9uIHNpZ25hdHVyZS4KICB2ZWRfYXQoU3Bhbjo6ZGVmX3NpdGUoKSlgLCBidXQgdGhhdCdzIHVuc3RhYmxlLCBzb3R1cmUub3V0cHV0KTsKCiAgICAgICAgbGV0IG9yaWdfaWRlbnQgPSAmb3JpZ19vciAoaSwgaW5wdXQpIGluIHJhd19pbnB1dHMuZW51bSB0eTogKCp0eXBlZC50eSkuY2xvaXRpb25fY29udGV4dC5mdW5jdGlvbl90eXBlKCksCiA9ICYqdHlwZWQucGF0IHsKICAgICAgICAgICAgICAgICAgICAgICAgbWF0Y2ggZGVmIGlmICF0eXBlZC5hdHRycy5pc19vbid0IHZhbGlkYXRlIHRoYXQgdGhlIHVzZXIgcHJvdmlkZWQgYSB2YWxpZCBgdHVyaW9ucyBpbiB0dDo6dmFsdWVfaW1wbCBjYW4gZWl0aGVyIHRha2Ugc2VsZiBhcyBhZWl2ZXIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIC5zcGFuKCkKIG9tZShwb3NzaWJseV9yZWNlaXZlcikgPSByYXdfaW5wdXRzLm5leHQoKSB7cG9ydCB3aGVyZSBjbGF1c2VzIiwKICAgICAgICAgICAgICAgICAgICBkZWZpaW9uPFR1cmJvRm48J18+PiB7CiAgICAgICAgaWYgIW9yaWdfaW9uIChzYW1lIGFzIHRoZSBvcmlnaW5hbCBmdW5jdGlvbidzIG5hbWUpLgogCiAgICBMb2NhbCwgTG9jYWxJbml0LCBNZXRhLCBQYXQsIFBhdElkZW50LCBQYXRUeXBlYW0sIFRva2VuVHJlZX07CnVzZSBxdW90ZTo6e1RvVG9rZW5zLCBxdW90ZSwgcXVvciJmb29bXFNcdF0iKTsKc2lzKCJmb08iKTsKICAgICAgICBhc3NlcnQhKHguYW55biB2YXJpb3VzKCkgewogICAgICAgIGxldCB4ID0gYW5hbHlzaXMoIiIpOwogc2UgPSBzZWxmLmFueV91cHBlcmNhc2UgfHwgYXN0LmMuaXNfdXBwZXJjYXNlKCk7X2FzdF9saXRlcmFsKCZ4LmVuZCk7CnB0eShfKQogICAgICAgICAgICB8IGFzdDo6Q2xhc3NTZXRJdGVtOjpBc2NpaShfKQogZWxmLCBhc3Q6ICZhc3Q6OkNsYXNzU2V0KSB7CiAgICAgICAgaWYgc2VsZi5kb25lKClBc3Q6OlJlcGV0aXRpb24ocmVmIHgpID0+IHNpcyB7IGFueV91cHBlcmNhc2U6IGZhbHNlLCBhbnlfbGl0ZXJhbDogZmFsc2UgfQogcGxlLCBhIHBhdHRlcm4gbGlrZSBgXHBMYCBjb250YWlucyBubyB1cHBlcmNhc2UgbGkgIC5wYXJzZShwYXR0ZXJuKQogICAgICAgICAgICAubWFwKHxhc3R8IEFzdEFseXNpc2AgdmFsdWUgYnkgZG9pbmcgYW5hbHlzaXMgb24gdGhlIEFTVCBvZiBgcGF0dGVfcmVmKGYsIHNjb3BlKSkpCiAgICB9Cn0KdXNlIHJlZ2V4X3N5bnRheDo6YXN0Ojp7biB0cmF2ZXJzZV9yZWY8UywgVT4oCiAgICAgICAgJidhc3Qgc2VsPiBPayhGaWVsZFBhdGhFbGVtOjpJZGVudCgqaWRlbnQpKSwKICAgIGY6ICZtdXQgRiwKICAgICAgICBvcmRlcjogVHJhdmVyc2VPcmRlciwKIHRoZWlyCiAgICAvLy8gcGF0aHMgKHRoYXQgaXMsIHRoZSBmaWVsZCB3aGljaCB0aGV5Y29yZC4KICAgIHB1YiBmbiBkZWZzX29mKCZzZWxmLCBpZGVudDogSWRlbnQpIC0+YWxsKHxmaWVsZHwgZmllbGQucGF0aC5pdGVyKCkuYW55KHxlbGVtfCBlbGVtZCBpcyBvcGVuLCBpLmUuIGlmIGl0IGVuZGVkIHdpdGggYC4uYC4KICAgIHB1YiBvcGVpZWxkIG1ldGFkYXRhLgogICAgcHViIG1ldGFkYXRhOiBGaWVsaGVzIShzZWxmLnByaW9yaXR5LCBNZXJnZVByaW9yaXR5OjpOZXV0cmFsKQogICAgVGhlIGRvY3VtZW50YXRpb24gb2YgdGhlIGZpZWxkLgogICAgcHViIGRvYzpudCBpcyBhbiBleHByZXNzaW9uLgogICAgcHViIGZuIG5hbWVfYXNfaSBsZXQgW2VsZW1dID0gc2VsZi5wYXRoIHsKICAgICAgICAgICAgZWxlbS50cnlfLy8gc3RyaW5ncywgYSBwb3RlbnRpYWwgdmFsdWUsIGFuZCBhc3NvY2lhdGVkIG1ldHVybnMgYFNvbWUoXylgKS4KICAgIHB1YiBmbiB0cnlfYXNfZHluX2V4cHIoJnNlcG9sYXRpb24gaW5zaWRlLiBEdWFsIG9mIFtTZWxmOjp0cnlfYXNfZHluX2V4cHJdLnRlIGEgcGF0aCBjb21wb3NlZCBvZiBhIHNpbmdsZSBkeW5hbWljIGV4cHJlc3Npb24uZmllciB0byBbU2VsZjo6SWRlbnRdLgogICAgcHViIGZuIGV4cHIoZXhwcjogQXN0PGlvbiwgZS5nLiBgIiV7cHJvdG9jb2x9IiA9IC4uIGAuIE5vcm1hbGx5LAogcGxlLCBpbiAgYHsgYS4iJXsiaGVsbG8tIgovLy8gKysgIndvcmxkIn0iLmMgPSB0cnRpdmUgaW4gbXVsdGktbGluZSBtb2RlLgpjb25zdCBNQVhfTE9PS19BSEVBRDogdXNpbGFyZ2UgY2hhbmdlLiBTbyBmb3Igbm93LCB3ZSBqdXN0IGxldCBQQ1JFMiBnbyBsb28gICBzdW1tYXJ5Ojp7U3VtbWFyeSwgU3VtbWFyeUJ1aWxkZXIsIFN1bW1hcnlLaW5kLGlubmVyKCkpPzsKbGV0IGV4cGVjdGVkID0gIlwKMTpGb3IgdGhlIERvY3RvciBXYXRzb20gYSB3aXNwIG9mIHN0cmF3IG9yIGEgZmxha2Ugb2YgY2lnYXIgYXNoOwpidXQgRG9hcmNoIGluIGEKaHVtYW4gcmVhZGFibGUgZm9ybWF0LCBhbmQgaXMgbW9kZWxlZCBhZnBzOi8vanNvbmxpbmVzLm9yZy8pIGJ5IGVtaXR0aW5nIGEgc2VyaWVzIG9mIG1lc3NzLnJzL2dyZXAtc2VhcmNoZXIpCmNyYXRlLgoKIyBCcmllZiBvdmVydmlldwoKVGhlICBtYXAubG9va3VwKCZQYXR0ZXJuOjpDb25jYXRlbmF0aW9uKHZlYyFpeDogImJhci1hIi5pbnRvKCksCiAgICAgICAgICAgICAgICBrZXk6ICZBbGlhc3RyISgiZm9vLSIpKSwKcnNlKCJiYXItYiIpLCAic3JjL2Jhci9iIik7CgogICAgICAgIC8vIFRPRE8gcmVxdXRyISgiaGVhZC8iKSksCiAgICAgICAgICAgICAgICBQYXR0ZXJuOjpEeW5hbWljLAogYXJkIHsKICAgICAgICAgICAgICAgICAgICBzdWZmaXg6IHJjc3RyISgiL3giKQogIHRyISgiL3giKSksCiAgICAgICAgICAgIF0pKQogIHNlKCJjb21wLyoveCIpLCAic3JjL2NvbXBzLyoveCIpOwogKCJiYXIqZm9vIiksCiAgICAgICAgICAgIHJlcGxhY2VkX293bmVkKCJmb28qKmZvbyJsYWNlX29ubHkoKSB7CiAgICAgICAgbGV0IG11dCBtYXAgPSBBbGlhc01hcDo6ZCgiYmF6YmF6YmFyYmF6IilhcmJhcmJhciIpLAogICAgICAgICAgICByZXBsYWNlZF9vd25lZCgiYmFyZm9vYmFvZm9vKmZvbyIpLCAiYmF6YmF6KmJheiIpOwoKICAgICJiYXJmb29mb28iLAogICAgICAgICAgICAvLyBUaGUgbG8oImZvb2ZvbyoiKSwgImJhcmJhcioiKTsKCnRlc3RfbGVmdF93aWxkY2FyZCgpIHJzZSgiIiksICJlbXB0eSIpOwogciIpOwogICAgfQoKICAgICNbdGVzdF0KICAgIGZuIHRlc3RfbWFueV9leGFjbmRsZSB0cmFpbGluZyBjb21tYS4KICAgICAgICAoQG5leHQgJGxvb2t1cDppZGVuTWF0Y2h7a2V5OiBzdXBlcjo6QWxpYXNLZXk6OldpbGRjYXJkey4ufSwgb3V0cGFudChjKSwgLi59IGlmIGMgPT0gJHBhdHRlcm4gPT4ge29rdXAgPSAkbWFwLmxvb2t1cCgmcmVxdWVzdCk7CgogICAgICAgICAgICAkKGFzc2VyLy8vIEFzc2VydHMgdGhhdCBhbiBbYEFsaWFzTWFwYF0gbG9va3VwIHlpZWxkcyB0aCdhOwoKICAgIC8vLyBUdXJuIGBzZWxmYCBpbnRvIGEgYFNlbGY6Ok91dHB1dGAKICAgaCh8fCBsX3N1ZmZpeC5jbXAocl9zdWZmaXgpKQogICBwdWIga2V5OiAmJ2EgQWxpYXNLZXksCiAgICBwdWIgb3V0cHV0OiBUOjpPdXRwdXQ8Zm4gd2lsZGNhcmQ8J3AsICdzLCBQLCBTPihwcmVmaXg6IFAsIHN1ZmZpeDogUykgLT54ICsgMS4uXS5pbnRvKCk7CiAgICAgICAgICAgIHBhdHRlcm4udHJ1bmNhdGUod2lsdGVybiB7CiAgICAvLy8gUGFyc2VzIGFuIGFsaWFzIHBhdHRlcm4gZnJvbSBhIHN0bmdsZSB3aWxkY2FyZC4KICAgIFdpbGRjYXJkIHsgcHJlZml4OiBSY1N0ciwgc3VmZlNvbWUoRXJyKGUuY29udGV4dChzZWxmLnJlcXVlc3QuZGVzY3JpYmVfYXNfc250ZWQgeWV0OiB7fSBpbnRvICd7fSp7fSciLAogIGVybnMgaW50byB3aWxkY2FyZCBleHBvcnRzIGZpZWxkcyBhcmUgbm90IFwKICAgICAgICBdID0gcmVxLmFzX3NsaWNlKCkKIC8gYHJlcXVpcmUoJ0AvZm9vLycgKyBkeW4pYCBpbnRvIGEgYEAvKmAgbWFwcGluZwogZXQgcmVtYWluaW5nID0gJnJlcXVlc3RbcHJlZml4LmxlbigpLi5dOwogIHVpdGUgbWVzc3kgYXMgd2UnZCBoYXZlIHRvIG1hdGNoIGFnYWluc3QgdGhlIEZTIHRvbGF0ZS5jb252ZXJ0KCksCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KSk7CiBvbnM6OmJ0cmVlX21hcDo6SXRlcjwnYSwgQWxpYXNLZXksIFQ+LAogICAgKT4sCn0sIFQpPiwKICAgIHsKICAgICAgICBmb3IgKHBhdHRlcm4sIHZhbHVlKSBpbiBpdGVyIHRlbmQ8SXQ+KCZtdXQgc2VsZiwgaXRlcjogSXQpCiAgZXIoKSB7CiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIE5vbmVsZXQgKGN1cnJlbnRfcHJlZml4X2l0ZXJhdG9yLCBjdXJyZW50X3ZhbHVlKSA9IGxvb3Rpb248QWxpYXNNYXBJdGVySXRlbTwnYSwgVD4+LAp9CgpzdHJ1Y3QgQWxpZml4OiBjdXJyZW50X3ByZWZpeF9pdGVyYXRvci5wcmVmaXguY2xvdHVybiBTb21lKG1hdGNoIGN1cnJlbnRfdmFsZWxmLmFkdmFuY2VfaXRlcigpPywKICAgICAgICAgICAgU29tZShyZWYgbXV0IGN1cnJvSXRlckl0ZW08VD4+IHsKICAgICAgICBsZXQgKHByZWZpeCwgbWFwLy8vIFtQQVRURVJOX0tFWV9DT01QQVJFXTogaHR0cHM6Ly9ub2RlanMub3Jlcm4sICYnYSBUKTsKCiAgICB0eXBlIEludG9JdGVyID0gQWxpYXNNYXBJdGVyPFRyZWVTZXQ6Om5ldykKICAgICAgICAvLyAgICAgLmluc2VydCh2YWxtZW50IHN0ZCdzIGBFbnRyeWAgQVBJLAogICAgICAgIC8vIHdoZXJlIHdlIG1hcCBoYWQgdGhpcyBhbGlhcywgdGhlIHRlbXBsYXRlIGlzIHVwZGF0ZWQsIGFuZGFuIGVudHJ5IG1hdGNoZXMgb3Igbm90CgogICAoaXQncyBub3QgYSBwcmVmaXgpLgogICAgICAgICAgICBzZWxmLm1hcAogICAvLyBTbG93IHBhdGg6IHRoZSBwYXR0ZXJuIGlzbid0IGNvbnN0YW50LCBzbyB3ZSBodXRmOChwKSB7CiAgICAgICAgICAgICAgICAgICAgICAgIE9rKHMpID0+IHMsCiAgLy8gSW52YXJpYW50OiBwcmVmaXhlcyBzaG91bGQgYmUgc29ydGVkIGJ5IGluY3JiIGZuIGxvb2t1cF93aXRoX3ByZWZpeF9wcmVkaWNhdGU8J2E+KAogICAgICAgICYnYW9mIHBvdGVudGlhbCBtYXRjaGVzLiBgQWxpYXNNYXBMb29rdXBJdGVyYXRvcmAKICAgZF91cF90byA9IGUudXRmOF9lcnJvcigpLnZhbGlkX3VwX3RvKCk7bm5vdCB1c2UgY29tbW9uX3ByZWZpeGVzIGF0IGFsbCBiZWNhdXNlIG1hdGNoaW5nCiAvIEZhc3QgcGF0aDogdGhlIHJlcXVlc3QgaXMgYSBzaW5ndWxhciBjb25zdGFudCBzdG9uIGFsdGVybmF0aXZlcywgcmVjZWl2ZWQge3JlcXVlc3Q6P30iKTsKZml4IH0gPT4gKGZvcm1hdCEoIntrZXl9KntzdWZmaXh9IiksIHZhbCAgT2soZm9ybWF0ISgie3ZhbHVlc19zdHJpbmc6Iz99IikpCiB0KGtleSwgUGFzc3Rocm91Z2hEZWJ1Zzo6bmV3X3N0cmluZyhzdHJpbmcpKTsKIGx1ZS52YWx1ZV9kZWJ1Z19mb3JtYXQoZGVwdGguc2F0dXJhdGluZ19zdWIoMSkpLAogbmc6OlN5bmMoc3RkOjphbnk6OnR5cGVfbmFtZTo6PFNlbGY+KCkudG8mbXV0IFRyYWNlUmF3VmNzQ29udGV4dCkgewogICAgICAgIGZvciAoXywgbWFwKSBpbih3aXRoX3NlcmRlKV0KICAgIG1hcDogUGF0cmljaWFNYXA8QlRyZWVNYXA8QWxpYXNhdGU6OnJlc29sdmU6OnBhdHRlcm46OlBhdHRlcm47CgovLy8gQSBtYXAgb2YgW2BBbGRlYnVnOjp7VmFsdWVEZWJ1Z0Zvcm1hdCwgVmFsdWVEZWJ1Z0Zvcm1hdFN0cmlpbCEoIm5vdCBhbiBlY21hc2NyaXB0IGNsaWVudF9tb2QgICBjbGllbnRfdHJhbnNpdGlvbi5wcm9jZXNzKHNvdXJjZSwgbW9kaWVzIGBjbGllbnRfdHJhbnNpdGlvbmAgYW5kIGFkZHMgYSBtYXJrZXIKICAgbmV3X21hcmtlcigpIC0+IFZjPFNlbGY+IHsKICAgICAgICBOZXh0RHluYW1pY1RyYXBvcnQuIE9wdGlvbmFsbHksIGl0IGNhbiBhbHNvIGFwcGx5IGFub3RoZXIgdHJhbnNldHNJbnB1dDo6QXNzZXQoZW50cnkpKSwgdHJ1ZSkuYXdhaXQ/LAogICAgKSkKfQp1YyBmbiBhbGxfYXNzZXRzX2Zyb21fZW50cmllcygKICAgIGVudHJpZXM6IFZjPE91ZW5jZS5iaW5kaW5nX3VzYWdlKCkub3dfdHlwZSkgPSAmKnJlZmVyZW5jZS5jaHVuaW9uXQpwdWIgYXN5bmMgZm4gcHJpbWFyeV9jaHVua2FibGVfcmVmbnQpXQpwdWIgc3RydWN0IE1vZHVsZXNXaXRoUmVmRGF0YShWZWM8KFJlc28gLnByaW1hcnlfbW9kdWxlcygpCiAgICAgICAgICAgICAgICAub3duZWQoKQpjZSB7IG1vZHVsZSB9KQogICAgfQp9CgovLy8gQWdncmVnYXRlcyBhbGwgcHJpbW1wbCBDaHVua2FibGVNb2R1bGVSZWZlcmVuY2UgZm9yIFRyYWNlZE1vZGVjdCgpKSkKfQoKI1t0dXJib190YXNrczo6dmFsdWVdCnB1YiBzdHJ1Y3QgVHJhY3VsZXNfcmF3X2l0ZXIoKSk7CiAgICAgICAgbW9kdWxlcy5leHRlbmQoCiAgZC4KLy8vCi8vLyBbTW9kdWxlXTogY3JhdGU6Om1vZHVsZTo6TW9kdWxlCiNbdHVuY2UgeyBhc3NldCwgZGVzY3JpcHRpb24gfSkKICAgIH0KCiAgICAvLy8gVGhlIFtWY21wbCBTaW5nbGVPdXRwdXRBc3NldFJlZmVyZW5jZSB7CiAgICAvLy8gQ3JlbGYuZGVzY3JpcHRpb24uY2xvbnQ8VmM8QmluZGluZ1VzYWdlPj4gewogICAgICAgIE9rKEJpbmRpbmdVc2FnZSAgICAgaG9pc3RlZDogZmFsc2UsCiAgICAgICAgfSkpCiAgb246IFJjU3RyLAogICAgZXhwb3J0OiBSZXNvbHZlZFZjPEV4cG9ydFVzYWdlPiwKfQogbmV3IFtWYzxTaW5nbGVNb2R1bGVSZWZlcmVuY2U+XSB0aGF0IHJlc29zc2V0OiBSZXNvbHZlZFZjPEJveDxkeW4gTW9kdWxlPj4sClRPRE8gdGhpbmsgYWJvdXQgZGlmZmVyZW50IHR5cGVzCiAgICAvLyBmbiBraW5kKCZzYSBidW5jaCBvZiBvcHRpb25hbCB0cmFpdHMgdGhhdCBjYW4gaW5mbHVlbmNlIGhvdyBsdmU6OntCaW5kaW5nVXNhZ2UsIEV4cG9ydFVzYWdlLCBJbXBvcnRVc2FnZSwgTW88TmV3VmFsdWU+KGlucHV0LCBWYzo6PE5ld1ZhbHVlPjo6Y2VsbCkuYXdhaXQKfQp1cyBmb3IgX2lkeCBpbiAwLi4yIHsKICAgICAgICB1cGNhc3RfdmNzLnB1c2goVmM6OmlwbGUgY2VsbHMgc28gdGhhdCB3ZSBjYW4gcGljayBmcm9tIHRoZW0sIHNpbXVsYXRpYWx1ZSgmc2VsZikgLT4gVmM8dXNpemU+IHsKICAgICAgICBWYzo6Y2VsbChzZXNpbmcgYGNlbGwgPSAibmV3ImAsIHRoZXNlIHRyYWl0IHJlZnMgbXVzdCB1c2UgZGlmbHVlOiA0MiwKICAgICAgICAgICAgY2VsbF9pZHg6IFN0YWVydCEoVHJhaXRSZWY6OnB0cl9lcSgmdHJhaXRfcmVmX2EsICZ0cmFpdF9yZWZfYikpYXNrLCBhbmQgcGljayBhIGRpZmZlcmVudCBjZWxsIGlkIGZvciB0aGUgbmV4dCBleGViZSByZS11c2VkIGFzIGxvbmcgYXMgdGhlCi8vIHZhbHVlIGlzIGVxdWFsLgojW3RvdGljcyBjYXB0dXJlZCB3aXRoCi8vLyBbYERpYWdub3N0aWNzVmM6OnBlZWtfZGlhZ25sZXQgZGlhZ25vc3RpYyA9IFJlc29sdmVkVmM6OnVwY2FzdF9ub25fc3RyaWN0Ojo8Qm9zdGljRXh0IGZvciBSZXNvbHZlZFZjPFQ+CndoZXJlCiAgICBUOiBVcGNhc3Q8Qm94Ly8vIGBzbG93X3BlcmZfZXZlbnRgLCBvciBzb21ldGhpbmcgZWxzZS4gVGh0byBhbmFseXplLCBkaWFnbm9zZQovLy8gVHVyYm9wYWNrJ3MgYmVoYXZpb3IuCiNbdHRjaCBhX2tleS5jbXAoYl9rZXkpZm9yICgoYV9rZXksIGFfdmFsdWUpLCAoYl9rZXksIGJfdmFsdWUpKSBpbgogdXJjZSwgRnhJbmRleE1hcCwgUmVzb2x2ZWRWYywgVXBjYXN0LCBWYywgZW1pdH07CgpPcmQsIEhhc2gpXQpwdWIgc3RydWN0IFBhc3N0aHJvdWdoRGVidWc8J2E+KENvdzwgbXV0IGRlYnVnX3R1cGxlID0gZi5kZWJ1Z190dXBsZShuYW1lKTsKIG5fYWxsKGZpZWxkcykuYXdhaXQsCiAgICAgICAgfQogICAgfQp9CgppbXBsIHN0ZDpsZHM6IFZlYzxBc3luY0Zvcm1hdHRpbmdGaWVsZDwnYSwgaW1wbGVsZHMgKGUuZy4gYHN0cnVjdCBGb28geyBiYXI6IHUzMiB9YCkuCiAgICBOYW1lZCAgc3RyLAogICAgY29udGVudHM6IEZ1dCwKfQoKaW1wbDwnYSwgRnV0OnV0dXJlfTsKCnVzZSBmdXR1cmVzOjpmdXR1cmU6OmpvaW5fYWxsOwpwdWJyaXB0IGZyb20gZm9yZWlnbiBvcmlnaW46ICIgKyBjaHVua1VybC5vcmlnaW4pOwogZm9yICh2YXIgaSA9IDA7IGkgPCBjaHVua1VybHMubGVuZ3RoOyBpKyspIHt7CnNTdHJpbmcgJiYgdXJsLmhhc2guc3RhcnRzV2l0aCgiI3BhcmFtcz0iKSkge3sKICAgIHNlbGZbIldvcmtlckdsb2JhbFNjb3BlIl0gPT09ICJ1bmRlZmluZWQiIHx8CiAgICBoaXMgY29kZSBpcyBzbGlnaHRseSBwYXJhbm9pZCB0byBhdm9pZCBiZWluZyB1c2VmcmFtc1swXSA9IGNodW5rIFVSTHMsIHBhcmFtc1sxXSA9IEFTU0VUX1NVRkZJWCwgcGFlcmF0ZXMgdGhlIHdvcmtlciBib290c3RyYXAgY29kZSBhcyBpbmxpbmUgSmF2YS50b19yb3BlX3dpdGhfbWFnaWNfY29tbWVudHMofHwgc2VsZi5zb3VyY2VfbWFwKCkpbWFwKCkudG9fcmVzb2x2ZWQoKS5hd2FpdD8pLAogICAgICAgIF0pKSkKIHRyISgiRWNtYXNjcmlwdCBCcm93c2VyIFdvcmtlciBFbnRyeXB0ciEoInR1cmJvcGFjayB3b3JrZXIgZW50cnlwb2ludCIpKQogbGV0IE1pbmlmeVR5cGU6Ok1pbmlmeSB7IG1hbmdsZSB9ID0gKnRoaXMuY2h1bmxldCBzb3VyY2VfbWFwcyA9ICp0aGlzCiAgICAgICAgICAgIC5jaHVuIC8vLyBWYWx1ZXMgYXJlIHBhc3NlZCB2aWEgVVJMIHBhcmFtcyBhdCBpbmRpY2VzIDJyIHJlY2VpdmVzIGEgSlNPTiBhcnJheSB2aWEgVVJMIHBhcmFtcyBvZiB0aGUgZm9sbG1hcDo6e0dlbmVyYXRlU291cmNlTWFwLCBTb3VyY2VNYXBBc3NldH0sCn1lci5yZXBseShSZXNwb25zZTo6bmV3X29rKHJlcV9pZCwgVmFsdWU6Ok51bGwpKTsKIGxldCBkb2MgPSBob3Zlci5tZXRhZGF0YS5pdGVyKCkuZmluZF9tYXAofG18IG0uZG9jICAgZGVkdXAoJm11dCBhbm5vdGF0aW9ucyk7CgogICAgICAgIGxldCB0eSA9IGhvdmUgLy8gZG8gZ2l2ZSBzb21lIHNwZWNpYWwgYXR0ZW50aW9uIHRvIHRoZSBpbmZ0aGUgYHhgIGluIGBsZXQgeCA9IC4uLiBpbiB5YCkgYW5kIHNvIGl0IHdvdXdoZW4gaG92ZXJpbmcgb3ZlciBhIGBWYXJgLgogICAgLy8gSW4gZ2VuZXJhbCwgdGhlICAgcmVxX2lkOiBSZXF1ZXN0SWQsCiAgICBzZXJ2ZXI6ICZtdXQgU2VydmVyLAopIG9kZTo6UHJpbU9wQXBwIHsKICAgICAgICAgICAgb3A6IFByaW1ldCBwYXJlbnRzID0gcmVzb2x2ZXIucmVzb2x2ZV9wYXRoKHZhbHVlLCBwcmVvbWUoKGxhc3QsIHByZWZpeCkpID0gcGF0aC5zcGxpdF9sYXN0KF9hdF9wYXRoKHJlY29yZCwgcHJlZml4Lml0ZXIoKS5jbG9uZWQoKSwgKmxhc3QpCiAgbmRleCBpbnRvIHRoZSBjb3VzaW5zIG9mIHRoZSBwYXJlbnQgcmVjb3JkIG9mCiBlbnQsIHdvcmxkOiAmV29ybGQpIC0+IE9wdGlvbjxIb3ZlckRhdGE8J18+PiB7CnRpb24gcGllY2Ugd2l0aCBhIHBhdGggbG9uZ2VyIHRoYW4gMSwgYXMgYW55IGFubmRhdGEpOwogICAgICAgIGxlZnQudHkgPSBsZWZ0LnR5Lm9yKHJpZ2h0LnR5KTsKICBzdGluZ3Vpc2hlZCB0eXBlIG9mIHRoZSBob3ZlcmVkIHRlcm0sIGlmIGFueS4gVGhpZW5jZS4KICAgIHhzLnJldGFpbih8eHwgc2Vlbi5pbnNlcnQoeC5jbG9uZSgpKSk7Cn1vbXBhdCwKICAgIGZpZWxkX3dhbGtlcjo6e0RlZiwgRmllbGRSZXNvbHZlciwgUmVjb3Blczo6e0hvdmVyLCBIb3ZlckNvbnRlbnRzLCBIb3ZlclBhcmFtcywgTGFuZ3VhZ2VTOlJlZGlyZWN0IHsKICAgICAgICAgICAgICAgICAgICB0YXJnZXQ6IHRhcmdldC5jbG9xdWVyeShzZWxmLnF1ZXJ5LmNsb25jZWxsKEZpbGVTb3VyY2UgewogICAgICAgICAgICBwYXRoLAogIHF1ZXJ5OiBSY1N0ciwKICAgIGZyYWdtZW50OiBSY1N0ciwKfQoKaW1wbCBGaWxleV9qcygiXG5cclx1ezBjfSIpLCByIyIiXG5cclxmIiIjKTsgICAgICdcdXswY30nID0+IGVzY2FwZWQucHVzaF9zdHIociJcZiIpLAogcmNlbC90dXJiby9wdWxsLzI1OTgjZGlzY3Vzc2lvbl9yMTAyMjYyNTkwOQogICBlbWVudDsKcHViIHVzZSBtZWFzdXJlX3J1bnRpbWU7CnB1YiB1c2Ugc2FtcGxlOwpwdWNzOjpoaXN0b2dyYW0hKCRjb3VudGVyKS5yZWNvcmQoJHZhbHVlKQogICAgfTsKfQoKICAgICAkY3JhdGU6Om1ldHJpY3M6OmluY3JlbWVudCEoJGNvdW50ZXIsIDEpCiAgICAgZGVwZW5kZW5jaWVzOiBwCiAgICAgICAgICAgICAgICAuZGVwZW5kZW5jaWVzCiAgIGtleXdvcmRzOiBwLmtleXdvcmRzLAogICAgICAgICAgICBsaWNlbnNlOiBwLmxpYyAgICB2OiB1MzIsCn0KCmltcGwgRnJvbTxQYWNrYWdlPiBmb3IgUGFja2FnZUZvcm1hZVBhdGgsCiAgICB9LAp9CgppbXBsIEZyb208aW5kZXg6OklkPiBmb3IgSWRGb2VyZGUoZGVmYXVsdCwgc2tpcF9zZXJpYWxpemluZ19pZiA9ICJSZWxhdGl2ZVBhdGg6cHViIGlkOiBJZEZvcm1hdCwKICAgIHB1YiByZXE6IFZlcnNpb25SZXEsCn0KCmthZ2UgaW5kZXguCgp1c2Ugc3RkOjpjb2xsZWN0aW9uczo6QlRyZWVNYXA7Cgp1c19zdHIoCiAgICAgICAgICAgICAgICAmQm94OjpwaW4oY2F1c2UucHJpbnQoCiAgbWUgPSBmcmFtZS51bm1hbmdsZV9pZGVudGlmaWVycyhtYWdpYyk7CiBhdGljPj4sCiAgICBjYXVzZTogT3B0aW9uPEJveDxTdHJ1Y3R1cmVkRXJyb3I+PiwKfXVsdDo6Tm90Rm91bmQgPT4gT2soUmVzb2x2ZWRTb3VyY2VNYXBwaW5nOjpVbm1hcGVzID0gZnNfcGF0aC5yZWFkKCkubGluZXMoKS5hX21hcChzbSwgbGluZSwgY29sdW1uLCBuYW1lLm1hcCh8c3wgJioqcykpOwogbmdfbG9zc3koKTsKICAgIGxldCBmaWxlID0gaWYgTUFJTl9TRVBBUkFUT1IgIT0gJy9waW5nOiBWYzxBc3NldHNGb3JTb3VyY2VNYXBwaW5nPiwKICAgIHJvb3Q6IEZpbG5lczogUmVhZFJlZjxGaWxlTGluZXNDb250ZWluZXMgPSBsaW5lcy5pdGVyKCkubWFwKHxsfCBsLmNvbnRlbnQuYXNfc3RyKCkpOyAgJiYgKnZpc2libGVfY29kZV9mcmFtZXMgPCBNQVhfQ09ERV9GUkFNRVMKICAgIG1vZGUuaGlnaGxpZ2h0KCZmcmFtZS53aXRoX25hbWUoTm9uZSkud2l0cmdzISgKICAgICAgICAgICAgICAgICAgICAiYXQge30gW3t9XSIsCiAgamVjdCBkaXJlY3RvcnksIGJ1dCB0byBsaWJyYXJ5IGNvZGUKICB0IChlLiBnLiBwbHVnaW5zLAogICAgICAgICAgICAvLyBpbnRlcm5hbCBjb2RlKQppdGUhKHdyaXRhYmxlLCAie1BBRERJTkd9YXQge29yaWdpbmFsX2ZyYW1lfSIpPzsmbXV0IGltcGwgV3JpdGUsCiAgICByZXNvbHZlZDogUmVzdWx0PFJlc29sdmVkU291cmxldCBmcmFtZSA9IFN0YWNrRnJhbWUgewogICAgICAgICAgICBuYW1lOiBuYW1lLm1hIG11dCBuZXcgPSBTdHJpbmc6OndpdGhfY2FwYWNpdHkodGV4dC5sZW4oKSAqIDIpOwp0IGl0ID0gU1RBQ0tfVFJBQ0VfTElORS5jYXB0dXJlc19pdGVyKHRleHQpLnBlZWthYiBQUk9KRUNUX0ZJTEVTWVNURU1fTkFNRSwgU09VUkNFX1VSTF9QUk9UT0NPTCwKICAgOkNvdywKICAgIGZtdDo6V3JpdGUsCiAgICBwYXRoOjp7TUFJTl9TRVBBUkFUT1IsIFBldCByb3BlID0gaWYgc2VsZi5lbmNvZGluZyA9PSAiYmFzZTY0IiB7CiBlbGYubG9va3VwX3BhdGguam9pbigmZmlsZW5hbWUpPykKICB1cmNlIGZvciBEYXRhVXJpU291cmNUaGUgcmF3IFtTb3VyY2VdLiBJdCByZXByZXNlbnRzIHJhdyBjb250ZTo6Um9wZX07CnVzZSB0dXJib190YXNrc19oYXNoOjp7ZW5jb2RlX2hleCwgaGFzaF8gICAgTEFTVF9FUlJPUl9MT0NBVElPTi53aXRoX2JvcnJvdyh8bG9jfCBUdXJia3NFeGVjdXRpb25FcnJvck1lc3NhZ2U6OlBJSVNhZmUoQ293OjpCb3Jyb3dlZChzKSl0eXBlIE91dHB1dCA9IFJlc3VsdDxULCBUdXJib1Rhc2tzUGFuaWM+OwoKIHV0ID0gVD4+IENhcHR1cmVGdXR1cmU8VCwgRj4gewogICAgcHViIGZuIG5ldyhmdXR1cGFuaWNfaG9va3M6OkxBU1RfRVJST1JfTE9DQVRJT059OwoKcGluX3Byb2plY3QhIHt0X2NvbW1vbl9qc19leHBvcnRzLCAiZXhwb3J0cy5mb28gPSAnYSciKTsKIGFyc2VyIHN1cHBvcnRzIGl0CgogICAgICAgIC8vIE51bGxpc2ggY29hbGVzY2luZyB3ICAgICB5aWVsZCAxOwogICAgICAgICAgICB5aWVsZCAyOwogIHN1cGVyLnBhcmVudE1ldGhvZDsKIGx0ID0gTWF0aC5tYXgoLi4uZ2V0QXJyYXkoKSk7IgogVGhpcyBiaW5kaW5nIGlzIHB1cm4gdGhpcy4jcHJpdmF0ZUZpZWxkOwogIGwgPSA8ZGl2PkhlbGxvPC9kaXY+OyIpOwoKICAgICAgICAvLyBKU1ggZnJhZ21lbnQgdXJlIChvbmx5IHZhbGlkIGluc2lkZSBmdW5jdGlvbnMvY29uc3RydWN0b3JzKQogICBtb2QgYWRkaXRpb25hbF9lZGdlX2Nhc2VzX3Rlb3AgPSAxOwoKICAgICAgICAgICAgQG1ldGhvZERlY29yLy8gUHJvcGVydHkgZGVjb29vID0gLyojX19QVVJFX18qLyBjb21wdXRlKCkgfSBvbyA9IGluaXQoKSB9ID0gICAgIGI6IHsgYyA9IHNpZGVFZmZlY3QoKSB9LAogICAgICAgICAgICBkID0gWzFbYSwgYiA9IGdldERlZmF1bHQoKV0gPSBhcnI7IgogIC8vIE5lc3RlZCBkZXN0cnVjdHVyaW5nIHdpdGggZGVmYXVsdCB0aGF0IGhhc3R1cmVfZGVmYXVsdF9wdXJlLCAiY29uc3QgeyBmb28gPSA0MiB9ID0gICAgIFsnbWV0aG9kJ10oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gNDI7CmF0aWMgdmFsdWUgPSBNYXRoLmFicygtNSk7CiAgLy8gTXVsdGlwbGUgc3RhdGljIHByb3BlcnRpZXMsIHNvbWUgcHVyZSwgc29tZSBub29ydCBjbGFzcyB3aXRob3V0IHNpZGUgZWZmZWN0cwogcHJvcCA9IGluaXRWYWx1ZSgpOwpsb2coIm1ldGhvZCIpOwogbGFzc19jb25zdHJ1Y3Rvcl93aXRoX3NpZGVfZWZmZWN0cywKIGxvZygiaGVsbG8iKTsKIGF0aWMgZm9vID0gNDI7CiAgZW5kcyAoQmFyIHx8IEJheigpKSB7fSIKICAgbGFzc19ub19leHRlbmRzX25vX3N0YXRpYywgImNsYXNzIEZvbyB7fSIpbnRpbCBydW50aW1lLCBzbyB0aGlzIGlzIHNpZGUtZWZmZWN0IGZyZWUgYXQgbG9hZGx0ID0gLyhcZCspL2cuZXhlYygidGVzdDEyMyIpOyIjCmdleCwgYnV0IHRoYXQgaXMgZmluZSB3aGVuCiAgICAgICAgLy8gY2FsbGVkIG9uIGFzdF9udW1iZXJfbGl0ZXJhbF90b19leHBvbmVudGlhbCwKICAyLCAzXS5tYXAoeCA9PiB7Z2xvYmFsVGhpcy5zb21ldGhpbmcucHVzaCh4KX0pOyIjCnQgPSAiYSxiLGMiLnNwbGl0KCcsJyk7IiNybGQiLnNsaWNlKDAsIDUpOyIjCiBtb2QgbGl0ZXJhbF9yZWNlaXZlcl9tZXRob2RzX3Rlc3RoZXkgaGF2ZSBzaGFkb3dlZCBwYXJhbWV0ZXJzLiBUaGUgc2lkZSBlZmZlY3Qgb25scnQgeyBNYXRoIH0gZnJvbSAnLi9jdXN0b20tbWF0aCc7CiAgIGtleXMoeyBhOiAxLCBiOiAyIH0pOwovIE1hcCBpcyBzaGFkb3dlZCBpbiBhIGJsb2NrIHNjb3BlCiAgIHJyYXkgPSBjbGFzcyB7IGNvbnN0cnVjdG9yKCkgeyBzaWRlRWZmZWN0KCk7IH0gfTsKTWF0aCA9IHsgYWJzOiAoKSA9PiBjb25zb2xlLmxvZygnc2lkZSBlZmZlY3QnKSB9OwogbW9kIHNoYWRvd2luZ19kZXRlY3Rpb25fdGVzdHcgTWFwKCk7XG5jb25zdCByZSA9IG5ldyBSZWdFeHAoJ3Rlc3QnKTsiCl9uZXdfdXJsLCAiY29uc3QgdXJsID0gbmV3IFVSTCgnaHR0cHM6Ly9leGFtcGxlLmNvX25ld193ZWFrc2V0LCAiY29uc3Qgd3MgPSBuZXcgV2Vha1NldCgpOyIpdGVzdF9leHBvcnRfZGVmYXVsdF9jbGFzcywgImV4cG9ydCBkZWZhdWx0IGNsYXJlZSEoCiAgICAgICAgICAgIHRlc3RfZHluYW1pY19pbXBvcnRfd2l0aF9hd2Fpb3J0KCkgaXMgYSBmdW5jdGlvbi1saWtlIGV4cHJlc3Npb24sIHdlIGFsbG93IGl0CiBzdF9yZWdleF9saXRlcmFsLCAiY29uc3QgcmUgPSAvcGF0dGVybi9nOyIpOwplc3RfZ2VuZXJhdG9yX2Z1bmN0aW9uLCAiZnVuY3Rpb24qIGZvbygpIHsgeWllbHN0X2RlbGV0ZV9leHByZXNzaW9uLCAiZGVsZXRlIG9iai5wcm9wOyIpOwplc3RfbnVsbGlzaF9jb2FsZXNjaW5nLCAiY29uc3QgeCA9IGEgPz8gYjsiKTsKZXN0X3NwcmVhZF9pbl9vYmplY3QsICJjb25zdCBvYmogPSB7IC4uLm90aGVyIH07IillX2FyZywKICAgICAgICAgICAgImNvbnN0IHJlc3VsdCA9IGlzTmFOKGZvbygpKTsib2JhbF9ib29sZWFuX2NvbnN0cnVjdG9yX2FzX2Z1bmN0aW9uLHBhcnNlRmxvYXQoJzMuMTQnKTsiKTtycmF5X2Zyb20sICJjb25zdCBhcnIgPSBBcnJheS5mcm9tKGl0ZXJhYmxlKTsiKTt0ZXN0X3Vua25vd25fbWF0aF9wcm9wZXJ0eSwgImNvbnN0IHggPSBNYXRoLnJhbmRzdCBjaGFyID0gU3RyaW5nLmZyb21DaGFyQ29kZSg2NSk7IgogZXN0X29iamVjdF9rZXlzLCAiY29uc3Qga2V5cyA9IE9iamVjdC5rZXlzKG9iaik7Iillc3RfbXVsdGlwbGVfcHVyZV9jYWxscywKICAgICAgICAgICAgImNvbnN0IHggPSAvKnVyZV9hcmdzLAogICAgICAgICAgICAiLyojX19QVVJFX18qLyBmb28oYmFyKCkpOyIKbl9jb25zdHJ1Y3RvciwgIi8qI19fUFVSRV9fKi8gbmV3IEZvbygpOyIpX3B1cmUsCiAgICAgICAgICAgICJjb25zdCB4ID0gMTtcbmNvbnN0IHkgPSAyO1xuY29lc3RfY2FsbF9pbl9hcnJheSwgImNvbnN0IGFyciA9IFsxLCBmb28oKSwgM107Iik7ciA9IFtbMSwgMl0sIFszLCA0XV07Iik7CiAgICB9CgogICAgbW9kIGltcG9ydF9leHBlc3RfdGVtcGxhdGVfbGl0ZXJhbCwgImNvbnN0IHggPSBgaGVsbG8gJHt3b3JsZH1gO2VzdF9tZXRob2RfY2FsbCwgIm9iai5tZXRob2QoKTsiKTsKZXN0X3NpbXBsZV9sZXRfZGVjbGFyYXRpb24sICJsZXQgeSA9ICdzdHJpbmcnOyIpOwpzZXJ0X3NpZGVfZWZmZWN0cyEoJG5hbWUsICRjb2RlLCBNb2R1IC8vLyBHZW5lcmF0ZSBhIHRlc3QgdGhhdCBhc3NlcnRzIHRoZSBnaXZlbiBjb2RlIGhfZXEhKGFjdHVhbCwgZXhwZWN0ZWQsICJ7fTpcbnt9IiwgU29tZSgmY29tbWVudHMpLAogICAgICAgICAgICAgICAgJm11dCBlcnJvcnMsCiAgdCBjb21tZW50cyA9IFNpbmdsZVRocmVhZGVkQ29tbWVudHM6OmRlZm4gcGFyc2VfYW5kX2NoZWNrX2Zvcl9zaWRlX2VmZmVjdHMoY29kZTogJnN0ciwgZXhwZWZ0IHNpZGUgcGF0dGVybgogICAgICAgICAgICAgICAgYXNzaWduX3BhdC5sZWZ0LnYvIFJlc3QgcGF0dGVybnMgYXJlIHB1cmUsIGJ1dCBjaGVjayB0aGUgbmVzdGVkIHB1ZSkgPSAmYXNzaWduLnZhbHVzaXRfcGF0KCZtdXQgc2VsZiwgcGF0OiAmUGF0KSB7CiBUeXBlU2NyaXB0IGluZGV4IHNpZ25hdHVyZXMgYXIgaW4gJmF1dG9fYWNjZXNzb3IuZGVjby8gU3RhdGljIGF1dG8gYWNjZXNzb3JzIGV4aXZhdGVQcm9wKHByaXZhdGVfcHJvcCkgPT4gLy8gTWV0aG9kIGJvZGllcyBkb25iZXI6OlByaXZhdGVNZXRob2QocHJpdmFyb3AudmFsdWUgewogICAgICAgICAgICAgICAgICAgIHZhbHVlLnZpc2loZSBpbml0aWFsaXplciAtIHN0YXRpYyBwcm9wZXJ0eSBpbml0aWFsaXplcnMgZXhldGhlIGJsb2NrCiAgICAgICAgICAgICAgICBmb3Igc3RtdCBpbiAmYmxvY2suYm9keS5vbWUoc3VwZXJfY2xhc3MpID0gJmNsYXNzLnN1cGVyX2NsYXNzIHsKICwgY2xhc3M6ICZDbGFzcykgewogICAgICAgIGNoZWNrX3NpZGVfZWZmZWN0cyEoc2VsdGllcyAodXNlZCBpbiBvYmplY3QgcmVzdC9zcHJlYWQgcGF0dGVybnMpCiAgcm9wOjpLZXlWYWx1ZShrdikgPT4gewogICAgICAgICAgICAgICAga3Yua2V5LnZpc2lwcm9wX29yX3NwcmVhZCgmbXV0IHNlbGYsIHByb3A6ICZQcm9wT3JTcHJlYWQpIHsKeXBlcyBhbmQganVzdCBhc3N1bWUgdGhleSBhcmUgZWZmZWN0ZnVsCiAgIC8vIHJlYWN0IChjb3VsZCBiZSBzb2xpZCBvciBxd2lrIG9yIHhwcjo6SlNYTWVtYmVyKF8pIHwgRXhwcjo6SlNYTmFtZXNwYWNlZE5hbWUoXykgeHByOjpTZXEoc2VxKSA9PiB7CiAgICAgICAgICAgICAgICAvLyBTZXF1ZW5jZSBleHBvciBhcmcgaW4gJnRhZ2dlZF90cGwudHBsLmV4cHI6OkF3YWl0KGUpID0+IHsKICAgICAgICAgICAgICAgIGUuYXJnLnZpc2l0X3dpdHhwcjo6VXBkYXRlKF8pID0+IHsKICAgICAgICAgICAgICAgIC8vIFVwZHB1cmVfY29uc3RydWN0b3IoJm5ldy5jYWxsZWUpIHsKIEl0IHdvdWxkIGJlIHdlaXJkIHRvIGhhdmUgYSBzaWRlIGVmZmVjdCBpbiBhIHJlLyAxLiBUaGUgcmVjZWl2ZXIgKGUuZy4sIHRoZSBhcnJheSBpbiBbZm9vKCksIDIsIGZvciBleHByIGluICZ0cGwuZXhwcnMgewogIC8vIDIuIFdlYnBhY2sgYW5kIHJvbGxkb3duIHRyZWF0IG1lbWIgIC8vIE1lbWJlciBhY2Nlc3MgaXMgcHVyZSAtIGp1c3QgcmVhZGluZyBhIHByb3AgVE9ETzogYWxsb3cgZGVsZXRlcyB0byBtb2R1IHByb3AgaW4gJm9iai5wcm9wcyB7CiAgICAgICAgICAgICAgICAgICAgcHJvcC52aXMgIGV4cHIudmlzaXRfY2hpbGRyZW5fd2l0aCh0aGlzKTsKIHVyZSAoZG9uJ3QgZXhlY3V0ZSB1bnRpbCBjYWxsZWQpCiAgaXNpdF92YXJfZGVjbGFyYXRvcigmbXV0IHNlbGYsIHZhcl9kZWNsOiAmVmFyRGVjbGF5cGVzIChpZiwgZm9yLCB3aGlsZSwgZXRjLikgYXQgdG9wIGxldmVsCiAgICAgLy8gVmFyaWFibGUgZGVjbGFyYXRpb25zIG5lZWQgY2hlY2tpbmcgKGluaXQgICAgVHNNb2R1bGVSZWY6OlRzRXh0ZXJuYWxNb2R1bGVSZWYoXykgPVRoZSBSSFMgb2YgYSB0cyBpbXBvcnQgZXF1YWxzIGV4cHJlc3Npb24gaXMgdHlwaWNheHBvcnROYW1lZChlKSA9PiB7CiAgICAgICAgICAgICAgICBpZiBlLnNyYy5pc19zdERlY2w6OlRzSW50ZXJmYWNlRGVjbChfKSA9IC8vIE90aGVyIGRlY2xhcmF0aW9ucyBzaG91bGQgYmUgY2hlY2tlZAogIGNsLmRlY2wgewogICAgICAgICAgICAgICAgICAgIERlY2w6OkZuKF8pID0vLyBSZWNvcmQgdGhhdCB0byBkZWNpZGUgaWYgd2UgY2FuIHVwZ3JhZGUgTW9kdXNpdF9tb2R1bGVfZGVjbCgmbXV0IHNlbGYsIGRlY2w6ICZNb2R1bGVEZWNsKSB7CiAgIG5vb3BfdmlzaXRfdHlwZSEoKTsKICAgIC8vIElmIHdlJ3ZlIGFscmVhZHkgZm91ciBpcyB1bnJlc29sdmVkIChnbG9iYWwgc2NvcGUpLgogIE9CQUxfRlVOQ1RJT05TLmNvbnRhaW5zKGlkZW50LnN5bS5hc19yZWYoKSkKICBmb3IgZ2xvYmFsIHB1cmUgZnVuY3Rpb25zIGxpa2UgaXNOYU4sIHBhcnNlSW50LCBleHByOjpPYmplY3QoXyksIE1lbmRsZSBhcnJheSBsaXRlcmFsIG1ldGhvZHMgbGlrZSBbMSwyLDNdLm1hcCgpCiAgICAgS05PV05fUFVSRV9OVU1CRVJfUFJPVCAgICAoRXhwcjo6TGl0KGxpdCksIE1lbWJlclByb3A6OklkZW50KHByb3ApKSA9PmFwKHxtZXRob2RzfCBtZXRob2RzLmNvbnRhaW5zKHByb3Auc3ltLmFzX3JlZigpKSkKdGNoIChyZWNlaXZlciwgJm1lbWJlci5wcm9wKSB7CmlrZSBgImhlbGxvIi50b0xvd2VyQ2FzZSgpYCwgYFsxLDIsM10ubWFwKClgLCBldGNlY2tzIGZvcjoKICAgIC8vLyAtIE1lbWJlciBleHByZXNzaW9ucyBsaWtlIGBNYXRoLm50ZXh0YCBvciBgaW1wb3J0Lm1ldGFgIGFwaXMKICAgIGZuIGlzX3JlcXVpcmVfb3JfbGYuY29tbWVudHMuaGFzX2ZsYWcoc3Bhbi5sbywgIlBVUkUiKQogIHMgaXMgdXNlZnVsIHdoZW4gYW5hbHl6aW5nIGNvZGUgdGhhdCBtYXkgaW52b2tlIGZ1ZnVydGhlciBhbmFseXNpcy4KICAgIGZuIG1hcmtfc2lkZV9lZmZlY3QoJm11Om5ldyhjb21tZW50cywgdW5yZXNvbHZlZF9tYXJrKTsKICAgIHByb2dyYW0udmlzaSAgInRlc3QiLCAiZXhlYyIsCn07CgovLy8gQW5hbHl6ZXMgYSBwcm9ncmFtIHRvIGRudGlhbCIsICJ0b0ZpeGVkIiwgInRvUHJlY2lzaW9uIiwgInRvTG9jYWxlU3RyaW4gICAiZmluZExhc3RJbmRleCIsCiAgICAic29tZSIsCiAgICAiZXZlcnkiLAogICAgICJyZXBsYWNlQWxsIiwKICAgICJub3JtYWxpemUiLAogICAgImxvY2FsZUNvbXBhICAgImNoYXJDb2RlQXQiLAogICAgImNvZGVQb2ludEF0IiwKICAgICJzbGljZSIsCiAgICAgIkFycmF5QnVmZmVyIiwKICAgICJEYXRhVmlldyIsCiAgICAiVVJMIiwKICAgICAgIk9iamVjdCIsCiAgICAvLyBUeXBlZCBhcnJheXMKICAgICJJbnQ4QXJyYXkiLHJpbmciLAogICAgIk51bWJlciIsCiAgICAiU3ltYm9sIiwKICAgICJCb29sZWFuIiwKICJnZXRPd25Qcm9wZXJ0eURlc2NyaXB0b3JzIiwgImdldFByb3RvdHlwZU9mIiwgImkgICAgImlzRmluaXRlIiwgImlzSW50ZWdlciIsICJpc05hTiIsICJpc1NhZmVJbnRlZyAiZXhwbTEiLCAiZmxvb3IiLCAiZnJvdW5kIiwgImh5cG90IiwgImltdWwiLCAibG9nb2JhbCBzdGF0ZQovLy8gMi4gRG9uJ3QgcGVyZm9ybSBJL08KLy8vIDMuIEFyZSBkZXRtb246OntNYXJrLCBjb21tZW50czo6Q29tbWVudHN9LAogICAgZWNtYTo6ewogb25maWdbJ2EnXSA9ICdhJzsKLy8hIGNvbmZpZ1snYiddID0gJ2InOwovLyEgZXhwb3R1cmUgRW5oYW5jZW1lbnQ6IExvY2FsIFZhcmlhYmxlIE11dGF0aW9uIFRyYWNraW5mb3IgdHJlZS1zaGFraW5nIGFuZCBkZWFkIGNvZGUgZWxpbWluYXRpb24uCi8vIWVzRXhwb3NlZD4sCiAgICAgICAgZW50cnlfcG9pbnRzOiBWYzxNZXJnZWFjYWRlQ2h1bmtJdGVtIHsKICAgICAgICAgICAgICAgIG1vZHVsZTogc2VsbGYuYXN5bmNfbW9kdWxlKCkudG9fcmVzb2x2ZWQoKS5hd2FpdD8pKSkKIF8gPT4gYmFpbCEoIlVuZXhwZWN0ZWQgTW9kY2UgeyBleHBvcnQgfSA9dmVkKCkKICBvcnQ6OkVycm9yID0+IHtlcnQobmFtZSwgRXNtRXhwb3J0OjpJbXBvcnRlZE5hbWVzcGFjZSgqcmVmZWFtZWQobmFtZS5jbG9kaW5nKAogICBtdXN0IG9ubHkgYmUgdXNlZCBvbiBtb2R1bGVzIHdpdGggRXNtRXhwb3J0cyIKICAgbWFwOiBOb25lLAogICAgICAgICAgICBleHBvcnRzOiBzZWxmLmdldF9leHBvcnRzKClUaGUgZmFjYWRlIG1vZHVsZSBjYW5ub3QgZ2VuZXJhdGUgc291cmNlIG1hcHMsIGJlY25jZXMsIGVzbV9yZWZlcmVuY2VzKSA9IHNlbGYuYXdhaXQ/LnNwZWNpZmljX3JlZmVjIGZuIG1vZHVsZV9jb250ZW50X29wdGlvbnMoCiAgIGZuIGFuYWx5emUoJnNlbGYpIC0+IFJlc3VsdDxWYzxBbmFseXplRWNtYXMgICAuaXNfc2VsZl9hc3luYyhyZWZlcmVuY2VzLnJlc29sdmUoKS5hd2FpdD8pCiAgIGhhaW4oZXNtX3JlZmVyZW5jZXMuYXdhaXQ/Lml0ZXIoKS5tYXAofHJ8IFJlc29kIE1vZHVsZVBhcnQgZm9yIEVjbWFzY3JpcHRNb2R1bGVGYWNhZGVNb2R1bGUiKTsKIGFtZWRFeHBvcnQgewogICAgICAgICAgICAgICAgb3JpZ2luYWxfZXhwb3J0LCAuLgogc3VsdC5lc21fcmVleHBvcnRfcmVmZXJlbmNlcywKIGFydDo6bG9jYWxzKCksCiA8ZHluIEVjbWFzY3JpcHRBbmFseXphYmxlPj4oc2VsZi5tb2R1bGUpCiAgICAgKGZhbHNlLCBmYWxzZSkKICAgICAgICAgICAgfTsKICAgICAgICBPayhBc3luY2xldCAoaW1wb3J0X2V4dGVybmFscywgaGFzX3RvcF9sZXZlbF9hd2FpdCkgPQogY2FkZSByZXByZXNlbnRzLgogICAgLy8vIE1vZHVsZVBhcnQ6OkZhY2FkZSB8IE1vZHUgICBlc206OntFc21FeHBvcnQsIEVzbUV4cG9ydHMsIGJhc2U6OkVzbUFzc2V0UmVmZWR1bGVDb250ZW50T3B0aW9ucywgRWNtYXNjcmlwdE9wdGlvbnMsIE1lcmdlZEVjbWFzdWxlLCBDaHVua2luZ0NvbnRleHQsIEV2YWx1YXRhYmxlQXNzZXQsIE1lcmdlYWJsZU12ZWMhW0xhYmVsb3R0b20sCiAgICAgICAgICAgICAgICAgICAgICAgIG5vdF9leHBvcnRlZDogdHJ1ICAgLnR5cGVzKFR5cGVGOjpOdW1iZXIpCiAgICAgICAgICAgIC5vcHRpb25hbCgpCiB2ZWMhWygKICAgICBwcmlvcml0eTogTWVyZ2VQcmlvcml0eTo6VG9wLAogZm4gcHJpb19tZXRhZGF0YSgpIHsKIGZuIG9wZW5fcmVjb3JkKCkgeyAgICJ0ZXJyZm9ybSIuaW50bygpLCAicmVxdWlyZWRfcHJvdmlkZXJzIi5pbnRvKCldLAogIGZuIG92ZXJyaWRpbmcoKSB7CiAgICAgICAgbGV0IHY6IE5pY2FyIikub3B0aW9uYWwoKS5ub19lbGRzKFsKICAgICAgICAgICAgICAgIEZpZWxkOjpuYW1lKCJmb28iKS5vcHRpb29tZSgiYmF6Ii5pbnQgICBkb2M6IFNvbWUoImZvbyIuaW50YW1lKCJmb28iKS5zb21lX2RvYyhTb21lKCJmb28iKSkubm9fbGV0IHQ6IE5pY2tlbFZhbHVlID0gUmVjb3JkOjpmcm9tKFsKICAgST4oZmllbGRzOiBJLCBhdHRyczogUmVjb3JkQXR0cnMpIC0+IE5pY2tlbFZhbHVlCnR5cDo6e1R5cGUsIFR5cGVGfSwKICAgIH07CgogICAgdXNlIHByZXR0eV9hc3NldXJpemUoYnVpbGRfcmVjb3JkKGVsYWJvcmF0ZWQsIHNlbGYuYXR0cnMpKSkKICBvZiBgb3BlbmAKICAgIHB1YiBmbiBzZXRfb3BlbihtdXQgc2VsZiwgb3BlbjogYm9vYW4gYmUKICAgIC8vIHNvbWV3aGF0IGZ1dHVyZXByb29mIGluIGNhc2UgbmV3IGZpZWwvIENsaXBweSBjb3JyZWN0bHkgb2JzZXJ2ZXMgdGhhdCBgb3BlbmAgaXMgdGhlIG9ubEludG88RmllbGQ8Q29tcGxldGU+PiwKICAgICAgICBJdDogSW50Y2FudCh2YWNhbnQpID0+IHsKICAgICAgICAgICAgICAgIHZhY2FudC5pbnNlcnQodCl0IHByZXYgPSBvY2N1cGllZC5pbnNlcnQocmVjb3JkOjpGaWVsZDo6ZGVmICAgIChmc3QuaW50bygpLCBjb250ZW50KQp9CgpmbiBidWlsZF9yZWNvcmQ8ST4oZmltID0gSWRlbnQ+LAogICAgSTo6SW50b0l0ZXI6IERvdWJsZUVuZGVkSXRlcmF0b3IsCiAgICkpOwogICAgICAgIHNlbGYucmVjb3JkCiAgICB9Cn0KCi8vLyBBIE5pY2s9PiBmLnZhbHVlKHYpLAogICAgICAgICAgICBDb21wbGV0ZShOb25lKSA9PiBmLm5vX3RhY2ggYSBmaW5hbGl6ZWQgW2BGaWVsZGBdIHRvIGEgW2BSZWNvcmRgXQogICBlbGY6OnBhdGgoW25hbWVdKQogICAgfQoKICAgIC8vLyBGaW5hbGl6ZSB0aGUgW2BGbXBsIEZpZWxkPEluY29tcGxldGU+IHsKICAgIC8vLyBDb25zdHJ1Y3QgYW4gaW5jb21kYXRhLnByaW9yaXR5ID0gcHJpb3JpdHk7CiAgLmNvbnRyYWN0cwogICAgICAgICAgICAuZXh0ZW5kKGNvbnRyYWN0cy5pbnJhY3QobXV0IHNlbGYsIGNvbnRyYWN0OiBpbXBsIEludG88VHlwZT4pIC1hLmRvYyA9IHNvbWVfZG9jLm1hcCh8ZHwgUmM6OmZyb20oZC5hc19yZWYoKSkpO2RlbnQ+OwoKLy8vIFR5cGVzdGF0ZSBzdHlsZSB0YWcgZm9yIGBGaWVsZGBzIHRoYWllcjo6e0lkZW50LCBMb2NJZGVudH0sCiAgICBsYWJlbDo6TGFiZWwsCiBha2U6OmJ1aWxkZXI6OlJlY29yZH0sCi8vISAjIH07Ci8vIQovLyEgbGV0IGIgPSBSZXRodWIuaW8vYXBpLWd1aWRlbGluZXMvZnV0dXJlLXByb29maW5nLmh0bWwKbW9kIHByLy8vIENhc3RzIGFuIGFyYml0cmFyeSBjZWxsIGNvbnRlbnQgaW50byBhIFtgVHJhaXR0ZTo6UmVhZFJhd1ZjRnV0dXJlXS4gU2VlIFtgVmNWYWx1ZVR5cGVDYXN0YF0gYW5kCm9uY2UoZmlyc3QudG9fc3RyaW5nKCkpIC8vIGtlZXAgIkM6IiBpbnRhY3QKIHBsaXQoJy8nKQogICAgICAgICAgICAubWFwKHxzfCB1cmxlbmNvZGluZzo6ZW5jb2QgZm4gdXJpX2Zyb21fcGF0aF9idWYoc3lzX3BhdGg6IFBhdGhCdWYpIC0+IFN0cmlUPj4sIHdoZXJlIGEgTm90Rm91bmQKLy8vIGVycm9yIHJlc3VsdHMgaW4gYSBOb25lc2tzOjpSZXNvbHZlZFZjOwoKdXNlIGNyYXRlOjp7RGlza0ZpbGVTeXN0ZW0sIEZpbHYxOiAmRW52aXJvbm1lbnQsCiAgICAgICAgICAgICAgICB1dHkyOiAmJlR5cGVlcm93c19hc19tYXAodXR5Mik7CgogICAgICAgICAgICBtYXAxLnppcChtYXAyKQogIG52MSwgdDIsIGVudjIpCiAgICAgICAgfQogICAgICAgIChUeXBlRjo6RW51bSh1dHkxZUY6OkRpY3QgewogICAgICAgICAgICAgICAgdHlwZV9maWVsZHM6IHV0eTIsCiAgdHlwLCAmdHkyLnR5cCkgewogICAgICAgIChUeXBlRjo6V2lsZGNhcmQoaWQxKSwgVAovLy8gUGVyZm9ybSBlcXVhbGl0eSBjb21wYXJpc29uIG9uIHR5cGVzLiBTdHJ1b3RzKCkKICAgICAgICAuemlwKGZpZWxkMi5tZXRhZGF0YS5pdGVyX2Fubm90cygpKQpxdWFsLiBbXmNvbnRyYWN0LWVxLWlnbm9yZS1sYWJlbF0gYXBwbGllcwogIGVscyBzZWVtIHJhdGhlciBjbHVtc3kgKGFzIGxhYmVscyBzdG9yZSBhIHdpZGUKICAgbGUsIHRha2UgYHsgZm9vIHwge2JhciB8IE51bWJlcn19YCBhbmQgYHtmb28gfAovLy8gZGVmaW5pdGlvbiwgb3IgYXJlIGJvdGggZGVmaW5lZCBhbmQgdGhlaXIgdmFsLy8gUmVxdWlyZSB0aGUgcm93cyB0byBiZSBjbG9zZWQgKGkuZS4gdGhlIGxhc3QgZWxvdywgb3IgaWYgaXQgaXMgYSBlbnVtIHJvdy4KZm4gcnJvd3NfYXNfbWFwKGVyb3dzOiBvciB0ZXJtcy4KZm4gbWFwX2VxPFYsIEY+KAogICAgbXV0IGY6IEYsCiAgIHB0eSgpCiAgICAgICAgICAgICAgICAmJiByZWNfZGF0YS5pbmNsdWRlcy5pc19saW5lZCksIGV2ZW4gaWYgZW1wdHkuIFNvCiAgICAgICAgICAgICAgICAvLyBgQ29udGh1bmsodGh1bmspKSA9PiB7CiAgICAgICAgICAgIGxldCBjbG9zdXJlID0gdGh1bmsuICAgICZjbG9zdXJlMS5lbnYsCiAgICAgICAgICAgICAgICAmY2xvc3VyZTIudmFsIHVzZSBvZiBgYm9ycm93X29yaWdgIGJ1aWx0IGZvciB0aGlzIHB1cnBvc2UsIHRvIGcgIGlmIFRodW5rOjpwdHJfZXEodGh1bmsxLCB0aHVuazIpID0+CiAgIG9ucywgbGV0LWJpbmRpbmdzIG5vciBwYWlycyBvZiB0ZXJtcwogIGF0YTEua2V5ID09IGRhdGEyLmtleQogZXQgdHlfZXEgPSBtYXRjaCAodHkxLCB0eTIpIHsKLy8gICBmdW5kYW1lbnRhbGx5IGFzIHBvd2VyZnVsIGFzIGZ1bmN0aW9uIGFwcGwgICAoVGVybTo6QW5ub3RhdGVkKGRhdGExKSwgVGVybTo6QW5ub3RhdGVkKGRhdGEyKSAgJiYgZGF0YTEucmVjb3JkLmF0dHJzLm9wZW4gPT0gZGF0YTIucmVjb2hvdXQgaW5jbHVkZSBleHByZXNzaW9ucywgd2hpY2ggYXJlIGEgYml0IHRyaWNreSB0dGUsICZkYXRhMS5oZWFkLCBlbnYxLCAmZGF0YTIuaGVhZGQgYXMgc3VjaC4gV2UgcmV0dXJuCiAgICAgICAgICAgICAgICAvLyBmYWxzZSBmb3JhdGUsIHQxLCBlbnYxLCAmY2xvc3VyZS52YWx1ZSwgJmNsb3N1cmUuZW52KQogICAmIGVudjEKICAgICAgICAgICAgICAgICAgICAuZ2V0KCZpZC5pZGVudCgpKQpsZXQgY2xvc3VyZTIgPSBpZHgyLmJvcnJvdygpOwoKdGNoIChlbnYxLmdldCgmaWQxLmlkZW50KCkpLCBlbnYyLmdldCgmaWQyLmlkZW50ZSwgJnR5cGVfZGF0YTEudHlwLCBlbnYxLCAmdHlwZV9kYXRhMi50eXAsLyBDb250cmFjdCBpcyBqdXN0IGEgY2FjaGluZyBtZWNoYW5pc20uIGB0eXBgIHNob3VyYXkuaXRlcigpKQogICAgICAgICAgICAgICAgICAgIC5hbGwofCh0MSwgdDIpfCBjbyBlbnYyLAogICAgICAgICAgICApICYmIHIxLmF0dHJzLm9wZW4gPT0gcjIuYXR0cjpTZWFsaW5nS2V5KHMxKSwgVmFsdWVDb250ZW50UmVmOjpTZWFsaW5nS2V5KHMyKSkgPT4gdGFnMSA9PSB0YWcyLAogICAgICAgICAgICAgICAgKAogIFJlZjo6TnVsbCwgVmFsdWVDb250ZW50UmVmOjpOdWxsKSA9PiB0cnVlcmVkIGVxdWFsLgpwdWIgZm4gdHlwZV9lcV9ub2Vudih0MTogJlR5cGUsIHQyOiAmVHlyYWN0cwovLy8gdGhhdCBhcmVuJ3QgYWN0dWFsbHkgdGhlIHNhbWUpLiBJdCBpcyB1IF8gPSBfIGluIF9gKQpwdWIgZm4gY29udHJhY3RfZXEoCiAgICB0MTogJk5pY2tlIG5ldygpIC0+IFNlbGYgewogICAgICAgIFN0YXRlIHsgZ2FzOiBNQVhfR0FTIH0KICBlYXNlIHJlYXNvbmFibHkgaWYgaXQgdHVybnMgb3V0Ci8vLyBsZWdpdGltYXRlIHR5cCB0eXBlCi8vISBlcXVhbGl0eSBvdWdodCB0byBzdGF5IHJlYXNvbmFibHkgY2hlYXAuCi8vISAjIyBSZWN1cnNpb24KLy8hCi8vISBXZSBtdXN0IHJlZnJhaW4gZnJvbSBmb2xyIG9mIHRpbWVzLiBGb3IKLy8hIGFueXRoaW5nIG1vcmUgY29tcGxleCwgd2UgciBieXRlY29kZSB2aXJ0dWFsIG1hY2hpbmUgKFJGQzAwNykgaXMgb3BlcmF0aW9uYWwuaGVja2VyIG9wZXJhdGluZyBpbiB0aGUgbGVnYWN5Ci8vISBBU1QgKGBOaWNrZSZtdXQgcmVhZHlfZm9yX3VwZGF0ZSwKYWdlOjpBY2sgPT4ge2F0aDogVmVjOnN0YXJ0OiBUaW0gICAgcGVyc2lzdGVudF9hbGxvYXRoLnB1c2gocGFyZW50Lm5pY2VfbmFtZSgpLjEudG9fc3QgYXJncyA9IHNwYW4KICBsZXQgYWxsb2NhdGlvbnMgPSBzcGFuLnRvdGFsX2FsbG9jYXRpb25zKCk7CmFnZTo6UXVlcnkgeyBpZCB9IG1vZGUoaWQsIE5vbmUpOwogaWwhKCJ1bmtub3duIHZpZXcgbW9kZToge30iLCBtb2RlKQogIGRlOjpBZ2dyZWdhdGVkIHsgc29hdGNoIG1vZGUgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgInJhdy1zcGFuczpWaWV3TW9kZSB7IGlkLCBtb2RlLCBpbmhlcml0IH0gPT5yZWN0ID0gdmlld19yZWN0OwogICAgICAgICAgICAgICAgICAgICAgICBzZW5kY2tldC5yZWFkKCk/IHsKICAgICAgICAgICAgTWVzc2FnZTo6RnJhbWUoX2ZyYTpWaWV3TGluZXNDb3VudCB7IGNvdW50LCBtYXggfTsKICBpZiAhZm9yY2Vfc2VuZCAmJiBzdGF0ZS5sYXN0X3VwZGF0ZV9nZW5lcmF0aW9uID09b2RlOiAiZHVyYXRpb24iLnRvX3N0cmluZygpLAogICAgICAgICAgICBjb3VudF9maWwgbXV0IHdlYnNvY2tldDogdHVuZ3N0ZW5pdGU6OldlYlNvY2tldDxUY3BTdHJlYW0+LDpuZXQ6OklwdjRBZGRyOjpuZXcoMTI3LCAwLCAwLCAxKSwKICAgICAgICBwb3J0LAogIHB1YiBoZWlnaHQ6IHU2NCwKICAgIHB1YiBob3Jpem9udGFsX3BpeGVsczogdTZoZXJpdDogYm9vbCwKICAgIH0sCiAgICBSZXNldFZpZXdNb2RlIHtlcmRlKHdpdGggPSAidTY0X3N0cmluZyIpXQogICAgICAgIGlkOiBTcGFuSWQsCiAgcml2ZShTZXJpYWxpemUsIERlYnVnKV0KI1tzZXJkZSh0YWcgPSAidHlwZSIpXQojbG4hKCJXYWl0aW5nIGZvciBjb21wbGV0aW9uLi4uIik7CiAgICAgICAgd2hpbGUgY3QgY3R4LnRhc2tfYmFycmllcnNbKnRhc2sgYXMgdXNpemVdLjEud2FpdHRhcnQodGFzaywgY3B1KSA9PiBpZCBjb21wZXRpbmcgZm9yIHdvcmtlcnMKICAgICAgICBsZXQgY3R4X2Nsb25lID0gYyAvLyBBbmQgaW50ZXJsZWF2ZSB0aGUgQ1BVIG9uZXMgYSBiaXQKICBuaXNoKDQpLAogICAgICAgICAgICBBY3Rpb246OlN0YXJ0RmluaXNoKDE5KSwKICBsZSg5LCB0cnVlKSwKICAgICAgICAgICAgLy8gMTAuLjE5IGFyZSB3YWlkdWxlKDUsIHRydWUpLAoKICAgICAgICAgICAgLy8gTGV0IENQVS1ib3VuZCAwIGFuZCBhbmQgYmFycmllci1ydW5zLgogICAgICAgICNbcnVzdGZtdDo6c2tpcF0KICAgbWFwKHxffCAoQmFycmllcjo6bmV3KDIpLCBCYXJyaWVyOjpuZXcoMikpKQogYXJ0ZWQgdGFzayB7dGFza30iKTsKICAgICAgICAgICAgICAgICAgICBpZiAhY3B1IHtjaGVkIHRhc2sge3Rhc2t9Iik7CiAgICAgICAgICAgICAgICAgICAgY3R4LmRpc3BhbG4hKCJEaXNwYXRjaCBvcmRlcjogezo/fSIsIGRpc3BhdGNoX29yZGUgLy8gUHJpbnQgb3JkZXJpbmcgZm9yIGRlYnVnZ2luZyBwdXJwb3NlcyAoaW4gYm90aG9uc3QgTlVNX1RBU0tTOiB1c2l6ZSA9IDIwOwoKICAgICAgICBzdHJ1Y3QgVGVzdENvaW5pc2gpLiBUaGUgcmVsZWFzZSBzZXF1ZW5jZQogICAgLy8vIGNvbnRyb2xzIGV4ZWMhKCpyZXN1bHRzLCB2ZWMhWzAsIDEsIDIsIDMsIDQsIDUsIDYsIDcsIDgsIDldKTsKIGN1dG9yID0gRXhlY3V0b3JJbXBsOwoKICAgICAgICBsZXQgcnVubmVsZjo6RnV0dXJlIHsKICAgICAgICAgICAgICAgIGxldCBleGVpbnMoJjMpKTsKICAgIH0KCiAgICAjW3Rva2lvOjp0ZXN0KGZsYXZvciA9ICJoaWxlIHJlc3VsdHMubG9jaygpLmxlbigpIDwgMTAgewppbzo6dGFzazo6eWllbGRfbm93KCkuYXdhaXQ7CiAgdGV4dC5sb2NrKCkucHVzaCh0YXNrKWhlIGxvd2VzdCBwcmlvcml0eQogICAgICAgIGFzc2VydCEocmVzdWx0c1s4Li4xMF0uIHF1ZXVpbmcKICAgICAgICBhc3NlcnRfZXEhKCZyZXN1bHRzWzAuLjJdLCAmWzAsIDFsbiEoIkZpbmlzaGVkIHRhc2sge30uIiwgdGFzaylyZSA9IFBpbjxCb3g8ZHluIEZ1dHVyZTxPdXRwdXQgPSAoKT4gKyBTZW5kPj47Cgogb3VuZF90YXNrcygpIHsKICAgICAgICBzdHJ1Y3QgRXhlY3V0b3JJbXBsOwoKICB1Y3QgSm9pbkhhbmRsZSB7CiAgICByZWNlaXZlcjogUmVjZWl2ZXI8KCk+LAp9CnQgZnV0dXJlX3Nsb3Q6ICptdXQgRTo6RnV0dXJlID0gZnV0dXJlX3Nsb3Q7CiAgX3Nsb3QgPSB0aGlzLmZ1dHVyZS5hc19tdXQoKS5nZXRfdW5jaGVja2VkX211dCgpOwpvIHdlIGNhbiBjb250aW51ZSB3b3JraW5nIG9uIGEgbmV3IGZ1dHVyZSBpbiB0bmVyLmFjdGl2ZV93b3JrZXJzLmxvYWQoT3JkZXJpbmc6OlJlbGF4ZWQpOwpjaXR5IHdlIGNhbiBzcGF3biBhIG5ldyB3b3JrZXIgdG8gcGljawogICAgICBjeC53YWtlcigpLndha2VfYnlfcmVmKCk7CiBhdGU6OkNsb3NlZCA9PiByZXR1cm4gUG9sbDo6UmVhZHkoKCkpLAogaXQgYXMgYWN0aXZlIGFnYWluIHNpbmNlIGl0IGlzIGJlaW5nIHBvbGxlZCBub3cuCm5lcjogQXJjPFByaW9yaXR5UnVubmVyPEMsIFQsIFAsIEU+PiwKICAgICkgewogLCBQPiwKICAgICAgICBFOiAnc3RhdGljLAoKICAgIHsKICAgICAgICAjW3Bpbl0KICBsZXQgbmV3X2NhcGFjaXR5ID0gcXVldWUubGVuKCkubmV4dF9wb3dlcl9vZl90d28oKSAgICAgV29ya2VyRnV0dXJlOjpzcGF3bihuZXdfZnV0dXJlLCB0eCwgZXhlY2Ryb3AocXVldWUpOwogICAgICAgICAgICBsZXQgdHggPSBoZWFwX2l0ZW0udHg7CiAgU29tZShoZWFwX2l0ZW0pID0gcXVldWUucG9wKCkgewogICAgICAgICAgICBzaHJpIGlzIHdvcmsgYXZhaWxhYmxlLgogICAgICAgIGxldCBhY3RpdmVfd29ya2VycyA9IHMvLyBVbmRvIHRoZSBhZGRlZCBhY3RpdmUgd29ya2VyIHNpbmNlIHdlIGRpZG4ndCBzcHJrZXIgaXMgc3Bhd25lZCBpbnN0ZWFkLgogICAgZm4gcmV1c2Vfb3JfZGVjcmVzcGF3biBhIG5ldyB3b3JrZXIgdG8gZXhlY3V0ZSB0aGlzIHRhc2sgaW1tZWRpYXRlbC8gSXQgd2lsbCBiZSBwaWNrZWQgdXAgYnkgZXhpc3Rpbmcgd29ya2Vycy4KdWxlX3dpdGhfam9pbl9oYW5kbGUoCiAgICAgICAgc2VsZjogJkFyYzxTZWxmPiwKICBraW86OnJ1bnRpbWU6OkhhbmRsZTo6Y3VycmVudCgpLm1ldHJpY3MoKS5udW1fd29yeWV0LgogICAgcXVldWU6IE11dGV4PEJpbmFyeUhlYXA8SGVhcEl0ZW08UCwgVD4+PiwgICAgUDogT3JkICsgU2VuZCArICdzdGF0aWMsCiAgICBFOiBFeGVjdXRvcjxDLCBUYXNrOiBULAogICAgdHg6IE9wdGlvbjxTZW5kZXI8KCk+PiwKfQoKaW1wbDxQOiBFcSxjPEM+LCBULCBQKSAtPiBGdXQgKyBTZW5kICsgU3luYywKICAgIEZ1dDogRnV0dXBlID0gImVycm9yIi5yZWQoKSwKICAgICAgICAgICAgICAgIHBpZCA9IHBpZAogICAgICAgZXByaW50bG4hKAogICAgICAgICAgICAgICAgIntldmVudF90eXBlfSAtIGZhaW9uc3QgS0lMTF9ERUFETElORV9DSEVDS19TVEVQUzogdTMyID0gMTA7CgogIFtjZmcodW5peCldCmZuIHN0b3BfcHJvY2Vzcyhwcm9jOiAmbXV0IENoaWxkKSAtPiAgIFByZXBhcmVkRGlyOjpUZW1wRGlyKHJlZiBkaXIpID0+IGRpci5wYXRoKCksCiBzdXJlIG5vIHJ1bnRpbWUgZXJyb3JzIG9jY3VycmVkIHdoZW4gbG9hZGluZ3VhdGVkLCBidXQgdGhlIHBhZ2UgYWN0dWFsbHkgY2FuIHJlbmRlcmVkIGVhcmxpZXIgbGV0IGRlc3RpbmF0aW9uID0gVXJsOjpwYXJzZSgmc2VydmVyLjEpPy5qb2luKHNlZGluZ19ldmVudHMgPSBwYWdlCiAgICAgICAgICAgIC5ldmVudF9saXN0ZW5lcjo6PEVmLnNlcnZlciA9IFNvbWUoc2VsZi5idW5kbGVyLnN0YXJ0X3NlcnZlcihzZWxkaXIodGVtcGxhdGVfZGlyLCB0ZXN0X2Rpci5wYXRoKCkudG9fcGF0aF9idWYoKSkuYQp9CgplbnVtIFByZXBhcmVkRGlyIHsKICAgIFRlbXBEaXIodGVtcGZpbGU6OlRlbXBEeS5pc19maWxlKCkgewogICAgICAgICAgICAgICAgbGV0IHNlbWFwaG9yZSA9IHNlbWFuKGVudHJ5LmZpbGVfbmFtZSgpKTsKICAgICAgICAgICAgaWYgdHkuaXNfZGlyKCkge3lfZGlyYCdzIGBGdXR1cmVgIGNhbiBiZSBpbmZlcnJlZCBhcyBgU2VuZGA6Ci8vIGhyYW1zLCBFdmVudEJpbmRpbmdDYWxsZWQsIEV2ZW50RXhjZXB0aW9uVGhyb3dufSwKIGFyZSBvbmx5IHBvcHVsYXRlZCBhZnRlciB0aGUgdGFzayBoYXMgZmluYWxpemVkIGV4dGFrZShtYXApOwogICAgICAgICAgICBmb3IgKGssIHYpIGluIG9sZF9tYXAgewpza3MoKTsKICAgIHR0LnRhc2tfc3RhdGlzdGljcygpLmVuYWJsZSgpOwp9CgpmbiBzdHQ8VmM8U2VsZj4+IHsKICAgICAgICBsZXQgdmFsID0gc2VsZi4wOwogIGRVNjQ+PiB7CiAgICBPayhXcmFwcGVkVTY0KCp2YWwuYXdhaXQ/KS5jZWxudFRhc2tUeXBlYC4KI1t0dXJib190YXNrczo6ZnVuY3Rpb25dCmZuIGRvdWJsZSh2YXZjKGRvdWJsZV92Yyhkb3VibGUoMTIzKSkpCiAgICAgICAgICAgIC5kb3VibGUoKQogZXN0X25vX2V4ZWN1dGlvbigpIC0+IFJlc3VsdDwoKT4gewogICAgcnVuX3dpdCBfID0gd3ZjLmRvdWJsZV92YygpLmF3YWl0LnVud3Qgd3ZjOiBWYzxCb3g8ZHluIERvdWJsYWJsZT4+ID0gVmM6OnVwY2FzdCh3cmFwKHMiOiAxMCwKICAgICAgICAgICAgICAgICAgICAiY2FjaGVfaGl0IjogMTUsc29uISh7CiAgICAgICAgICAgICAgICAid3JhcCI6IHsKbGV0IHd2YyA9IHdyYXAoaSk7Cm4gMC4uNSB7CiAgICAgICAgICAgIGxldCBkdmMgPSBkb3VibGUoaSk7CiB0ZXN0X3ZjX3JlY2VpdmluZ190YXNrKCkgLT4gUmVzdWx0PCgpPiB7CiAgICBydW5fd2UoKSwgZHZjLmludG9fZnV0dXJlKCkpLnVud3JhcCgpOwogICAgICAgIGR2Yy5hd2FpICAgImRvdWJsZSI6IHsKICAgICAgICAgICAgICAgICAgICAiY2FjaGVfbWlzcyI6IDFzb246Ompzb247CnVzZSB0dXJib190YXNrczo6VmM7CnVzZWZyb20ocHJvY2Vzc2VkX2Nzcy5jc3MpOwogICAgICAgIGxldCBhc3NldHMgPSBlbWl0ICAgYWRkaXRpb25hbF9pbnZhbGlkYXRpb246IGNvbmZpZ19jaGFuZ2VkLAogbmZpZ192YWx1ZSA9IGV2YWx1YXRlX3dlYnBhY2tfbG9hZGVyKFdlYnBhY2tMb2FkZXIgLy8gcnVucyB3aXRoIHRoZSBwcm9qZWN0IGFzIHRoZSBjdXJyZW50IHdvcmtpbmcgZHJpZXMocG9zdGNzc19leGVjdXRvciwgKmV2YWx1YXRlX2NvbnRleHQsIE5vbmUpCiAgPSBjb25maWdfY2hhbmdlZCgqc2VsZi5jb25maWdfdHJhY2luZ19jb250ZXh0LCBjb25DU1MgdHJhbnNmb3JtIG9ubHkgc3VwcG9ydCB0cmFuc2Zvcm1pbmcgZmlsZXMiKTsKICAvLyAgLSBwYWNrYWdlcyAvLyByb290IG9mIHdvcmtzcGFjZSBwa2dzCiAgLSBub2RlX21vZHVsZXMKICAgICAgICAvLyAgICAgLSBzb21lcGtnLyhzb21lLm1vZHVjZXNzKCZzZWxmKSAtPiBSZXN1bHQ8VmM8UHJvY2Vzc1Bvc3RDc3NSZXN1bHQ+PiB7IF8pID0gJipmaW5kX2NvbnRleHRfZmlsZV9vcl9wYWNrYWdlX2tleSgKICB0ZXh0RmlsZVJlc3VsdDo6Rm91bmQoY29uZmlnX3BhdGgsIF8pID0KICAgICAgICAmKmU6OkVudHJ5KEVudHJ5UmVmZXJlbmNlU3ViVHlwZTo6VW5kZWZpbmVkKSwKIHJ0IGRlZmF1bHQgbW9kLmRlZmF1bHQgPz8gbW9kOwogICAgICAgICIjLAogICBuc3QgY29uZmlnVXJsID0gcGF0aFRvRmlsZVVSTChjb25maWdQYXRoKS50b1N0cmlCdW5kbGluZyB3b3VsZCBicmVhayB0aGUgYWJpbGl0eSB0byB1c2UgYHJlcXVpcmUucmx1ZS5wYXRoLmVuZHNfd2l0aCgiLmpzb24iKQogICAgICAgIHx8IHBvc3RfID0+IEVycihhbnlob3c6OmFueWhvdyEoIkluZW50OjpGaWxlKEZpbGVDb250ZW50OjpOb3RGb3VuZC5yZXNvbHZlZF9jZWxsKCkpLmN5cGU6OkZpbGUgPT4gewogICAgICAgICAgICAgICAgbGV0IGpzb24gPSBpZiBzdGguYXBwZW5kKCIuIik/LmFwcGVuZChrZXkpPy5hcHBlbmQoIi5qc29uIik/LAplZFZjPE9wdGlvbjxSY1N0cj4+LAogICAgcHViIGFsbG93X2pzb241OiBib28udHJ5X2ZsYXRfam9pbmggKmFzc2V0X2NvbnRleHQKICAgICAgICAgICAgICAgICAgICAgICAgLnByb2NhaWx3aW5kLmNvbmZpZy50cyIpPywKICAgIF07CgogICAgbGV0IGNvbmZpZ3MgPSBjbyAgYW55X3NvdXJjZV9jb250ZW50X2NoYW5nZWRfb2ZfbW9kdWxlKGNvbmZpZ19hc3NudD4sCiAgICBhc3NldHM6IFZlYzxSZXNvbHZlZFZjPFZpcnR1YWxTb3VyY29ybWVkQXNzZXQgewogICAgZXZhbHVhdGVfY29udGV4dDogUmVfbWFwcywKICAgICAgICAgICAgfQogICAgICAgICAgICAuY2VsbCgpLAogbXBsIFNvdXJjZVRyYW5zZm9ybSBmb2RWYzxFeGVjdXRpb25Db250ZXh0PiwKICAgIGNvbmZpZ19sb2NhdGlvbjogUG9zdHNzcmMubWpzIiwKICAgICAgICAgICAgIi5jb25maWcvcG9zdGNzc3JjLmNqcyIsCmNlbGwoCiAgICAgICAgWwogICAgICAgICAgICAiLnBvc3Rjc3NyYyIsCiAgcHViIHBsYWNlaG9sZGVyX2Zvcl9mdXR1cmVfZXh0ZW5zaW9uczogdTgsCn0KCmlsOjp7RW1pdHRlZEFzc2V0LCBlbWl0dGVkX2Fzc2V0c190b192aXJ0dWFsX3NvdXJpcHQ6OnJ1bnRpbWVfZnVuY3Rpb25zOjpUVVJCT1BBQ0tfRVhURVJOQUxfSU1QT1JUO3h0LCBQcm9jZXNzUmVzdWx0fSwKICAgIGZpbGVfc291cmNlOjpGaWxlU291cmNlLAogZWxmIHsgaW5kZXhfdXJsLCAuLnNlbGYgfQogICAgfQoKICAgIHB1YiBmbiB3aXRoX2dnaXRfcGFja2FnZV9kaXI6IGNhY2hlX2Rpci5qb2luKCJnaXQtcGFja2FnZXMiKSwKIGl0aHViX3BhY2thZ2VfdXJsOiBERUZBVUxUX0dJVEhVQl9QQUNLQUdFX1VSTC50cnlfZV9kaXIgPSBQcm9qZWN0RGlyczo6ZnJvbSgib3JnIiwgIm5pY2tlbC1sYW5nIiwgIi8vIGl0J3MgaW50ZW5kZWQgZm9yIHZlbmRvcmluZyBvciBtaXJyb3JpbmcsIG5vdGF1bHRzIHRvIGA8Y2FjaGVfZGlyPi9pbmRleGAKICAgIHB1YiBpbmRleF9kaXI6IFBhZXN1bHQpCn0KdXNlIHN0ZDo6cGF0aDo6UGF0aEJ1ZjsKCnVzZSBkaXJlY3RvcmllczpzaWRlID0gbGltaXRfbGVuKGluc2lkZSk7CiAgICAgICAgICAgICAgICBsZXQgYWZ0ZXQgKGJlZm9yZSwgdGVtcCkgPSBzYWZlX3NwbGl0X2F0KGwsIHJlYWxfc3RhcnQpOwogLyBzdGFydCBsaW5lCiAgICAgICAgICAgIChPcmRlcmluZzo6RXF1YWwsIE9ydGNoIChpLmNtcCgmc3RhcnRfbGluZSksIGkuY21wKCZlbmRfbGluZSkpIHsKbGV0IG4gPSBpICsgMTsKICAgICAgICBsZXQgaSA9IGkgYXMgdTMyOwogICBuZ2VzIGluIHRoZXNlIGxpbmVzLiAoTGluZXMgYXJlIDAtaW5kZXhlZCkKcHViIHRMaW5lczwnYT4ocHViIFZlYzxTb3VyY2VDb250ZXh0TGluZTwnYT4+KTsKc2lkZX17YWZ0ZXJ9Iik/OwogICAgICt7fV4iLCAiLSIucmVwZWF0KGluc2lkZS5sZW4oKSkpCiAgICAiICAgICAgIHwge312e30iLAogICAgICAgICAgICAgICAgICAgICIgIi4gICAgYmVmb3JlOiBDb3c8J2EsIHN0cj4sCiAgICAgICAgaW5zaWRlOiBDbyAgICBhZnRlcjogQ293PCdhLCBzdHI+LAogICAgfSwKICAgIFN0YXJ0QW5kRW5kIHsob2JqKSwgTWVtYmVyUHJvcDo6Q29tcHV0ZWQoLi4pKSA9ICgmKmUub2JqLCAmZS5wciA9ICYqKmNhbGxlZSB7CiAgICAgICAgICAgICAgICBpZiBpZGVudC5zeW0gPT0gKiJyb3VsZCBkcm9wIGl0LgogICAgICAgIG4ucmV0YWluKHx2fCAhdi5uYW1lLmlzX2ludmFhdGEuaW1wb3J0cy5pbnNlcnQoCiAgdCBrZXkgPSBuYW1lLnRvX2lhbGxlZTogQ2FsbGVlOjpFeHByKGNhbGxlZSksCiAgICAgICAgICAgIGFyZ3MsCiAgX211dF9zdG10KCZtdXQgc2VsZiwgbjogJm11dCBTdG10KSB7CiAgICAgICAgbi52aXMmbXV0IElkZW50UmVuYW1lcjo6bmV3KCZzZWxmLmRhdGEucmVuYW1lX21hcCkpOwogLmRhdGEsCiAgICAgICAgICAgIGluX21lbWJlcl9vcl92YXI6IGZhbCBzcGFuOiBEVU1NWV9TUCwKICAgICAgIHYuZGVjbHMuaXRlcigpLmFueSh8ZHwgZC5uYW1lID09IHZhci5uYW1lKSAgcHJvcDogTWVtYmVyUHJvcDo6SWRlbnQoSWRlbnROYW1lOjpuZSAuYXNfYXJnKCldLAogICAgIG9iajogQm94OjpuZXcoRXhwcjo6Q2FsbChDYWxsRXhwciBvbWUocmVuYW1lZCkgPSBtYXAuZ2V0KCZwcm9wLnN5bSkgewogaCh8fCBwcml2YXRlX2lkZW50IShwcm9wLnN5bS5jbG9uZSgpKS50b19pZCgpKQpsZXQgRXhwcjo6SWRlbnQob2JqKSA9ICYqbi5vYmogewogIGRhdGEuaXNfcHJlcGFzcyA9IHRydWU7CiAgICAgICAgc3RtdHMudmlzaWllcnMgZm9yIGBvYmpgIG9mIFtNZW1iZXJFeHByXS4KICAgIGlnbm9yZWQ6IEZ4SG5maWcgewogICAgcHViIHRyYW5zZm9ybXM6IEZ4SGFzaE1hcDxBdG9tLCBBdG9tPiwKQ2FsbGVlLCBEZWNsLCBFeHByLCBJZCwgSWRlbnQsIElkZW50TmFtZSwgTGl0LCBNZW1hbGl6ZTsKdXNlIHN3Y19jb3JlOjp7CiAgICBhdG9tczo6e2F0b20sIFd0ZjhBdG9tfWV0ID0gUmNTdHI6OmZyb20oZm9ybWF0ISgiLi4vX3RhcmdldHMve30iLCB0YXJhcCh8aXwgd3JpdGVfc3ltbGluayhzeW1saW5rc19kaXIuY2xvbmUoKSwgaSwgdGFyeXN0ZW0+KSAtPiBWYzxGaWxlU3lzdGVtUGF0aD4gewogICAgZnMucm9vdCgpCn1wbGV0ZWQge30gc3ltbGluayB3cml0ZXMgaW4gezouMn1zICh7Oi4wfSB3cml0ZXMvc2l0ZXMgYXMgZjY0IC8gaW50ZXJ2YWxfZHVyYXRpb24uYXNfc2Vjc19mNjQoKTsKIHJnZXRfaWR4ID0gcm5nLnJhbmRvbV9yYW5nZSgwLi50YXJnZXRfY291bnQpOwogIG11dCBsYXN0X3Byb2dyZXNzX3RpbWUgPSBzdGFydF90aW1lOwoKICAgICAic3RhcnRpbmcgc3RyZXNzIHRlc3Qgd2l0aCBwYXJhbGxlbGlzbT17fSBmb3IgdCA9IGRpc2tfZmlsZV9zeXN0ZW1fcm9vdF9vcGVyYXRpb24ocHJvamVjdF9mcykKICBfZGlyKT87CgogICAgbGV0IHR0ID0gdHVyYm9fdGFza3M6OlR1cmJvVGFza3M6Om5ld29vdC5jYW5vbmljYWxpemUoKT87CiAgICBsZXQgX2d1YXJkID0gRnNDbGVhbnVwIHsKdTY0LAp9CgpwdWIgYXN5bmMgZm4gcnVuKGFyZ3M6IFN5bWxpbmtTdHJlc3MpIC0+IGFpb24sIEluc3RhbnR9LAp9OwoKY29uc3QgUFJPR1JFU1NfSU5URVJWQUw6IER1cmEgLm1hcF9vcigwLCB8Y29udGVudHwgcm91bmRfY2h1bmtfaXRlbV9zaXplKGNvbnRkdWxlX2luZm86IE9wdGlvbjxWYzxBc3luY01vZHVsZUluZm8+PiwKIG91cDo6ZnJvbV9jaHVua19pdGVtX2JhdGNoX2dyb3VwKCpiYXRjaF9ncm91cCkKICBuIGlzX3N0eWxlKHNlbGY6IFZjPFNlbGY+KSAtPiBWYzxib29sPiB7CiAgZm4gdG9fc3RyaW5nKCZzZWxmKSAtPiBWYzxSY1N0cj4ge2V4dCwgcm91bmRfY2h1bmtfaXRlbV9zaXplLAp9OwoKdXNlIHN1cGVyOjp7RWNtYXM+IFZjPHUzMj4gewogICAgICAgIHByaW50bG4hKCJyZWFkX3NlbGYoKSIpO2lvbl0KYXN5bmMgZm4gY3JlYXRlX2lucHV0KCkgLT4gUmVzdWx0PFZjPENoYW5naXQ/LCA1KTsKICAgICAgICBhc3NlcnRfZXEhKCpzdGF0aWNfaW1tdXRhYmxlLnN0cm9lcSEoKnN0YXRpY19pbW11dGFibGVfc2VsZi5zdHJvYWJsZSA9IGltbXV0YWJsZV9mbihjaGFuZ2luZ192YWx1ZV9yZXNvbHZlZCk7CiBucHV0KTsKICAgICAgICBhc3NlcnRfZXEhKGNoYW5naW5nX3ZhbHVlLmF3YWl0Py52YSAvLy8gVW5zZXQgdGhlIGN1cnJlbnQgdmFsdWUuCiAgICBwdWIgZm4gdW5zZXQoJnNuLiBUaGUgYHVwZGF0ZWAKICAgIC8vLyBmdW5jdGlvbiBuZWVkIHRvIHJldHVpcyBzdXJlIHRoYXQgdGhlIHZhbHVlIGhhcyBjaGFuZ2VkLgogYiBmbiBnZXRfdW50cmFja2VkKCZzZWxmKSAtPiBTdGF0ZVJlZjwnXywgT3B0aXN0ZXJlZAogICAgLy8vIGFzIGRlcGVuZGVuY3kgb2YgdGhlIHN0YXRlIGFuZCBmbiB0cmFjZV9yYXdfdmNzKCZzZWxmLCB0cmFjZV9jb250ZXh0OiAmbXV0IGNyYXQgICAjW2JpbmNvZGUoc2tpcCwgZGVmYXVsdCA9ICJkZWZhdWx0X3RyYW5zaWVudF9zdWUuIGBUYCBtdXN0IGltcGxlbWVudCBbUGFydGlhbEVxXSBmb3IgdGhpcyB0byB3b3J1cm4gYHRydWVgIHdoZW4gdGhlIHZhbHVlIHdhcyBtb2RpZmllZC4gRXhwb3NpbmcKIHJlbnQgc3RhdGUgd2l0aG91dCBjb21wYXJpbmcgaXQgd2l0aCB0aGUgb2xkIHZhbG5uZXIuYWRkX2ludmFsaWRhdG9yKGludmFsaWRhdG9yKTsKICAgZmFsc2UKICAgIH0KfQppbXBsPFQ+IEVxIGZvciBTdGF0ZTxUPiB7fQoKdCB0byBlbnN1cmUgbWFya2luZyBhcyBzdGF0ZWZ1bC4KICAgICAgICBTZWxmOjpuZXcvLy8gW3N0cm9uZyBjb25zaXN0ZW5jeV06IGNyYXRlOjpPcGVyYXRpb25WYzo6cmVhb3JnL2Jvb2svY2gxNS0wNS1pbnRlcmlvci1tdXRhYmlsaXR5Lmh0bWwKLy8vIFtgVmN0byBbYFJlZkNlbGxgXVtzdGQ6OmNlbGw6OlJlZkNlbGxdIG9yIFtgTXV0ZXhgXSB0aC8vLyAqKlRoaXMgQVBJIHZpb2xhdGVzIGNvcmUgYXNzdW1wdGlvbiBvZiB0dXJiICAgZGU6OntCb3Jyb3dEZWNvZGVyLCBEZWNvZGVyfSwKICAgICAgICBlbmM6OkVuY29kYXRvcikgPSBzZWxmLnNlcmlhbGl6YXRpb25faW52YWxpZGF0b3IgewpNdXRleEd1YXJkPCdhLCBTdGF0ZUlubmVyPFQ+PiwKICAgIG11dGF0ZWQ6IGJvbl9pbnZhbGlkYXRvcjogT3B0aW9uPCYnYSBTZXJpYWxpemF0aW9uSW52YWwgdHJ1ZQogICAgfQp9CgppbXBsPFQ6IFBhcnRpYWxFcT4gU3RhdGVJbm5lcjxUPiAgaW52YWxpZGF0b3IuaW52YWxpZGF0ZSgmKip0dCk7CiBhbHVlIGNoYW5nZWQiLCB2YWx1ZV90eXBlID0gdHlwZV9uYW1lOjo8VD4oKSkuZW50ZTp0YWtlLAogICAgb3BzOjp7RGVyZWYsIERlcmVmTXV0fSwKfSBWYzo6PEVjbWFzY3JpcHRDaHVua1R5cGU+OjpkZWZhdWx0KCkucmVjZWxsKHZlYyFbUmVzb2x2ZWRWYzo6dXBjYXN0KHNlbGYud2FzbV9hc3NldCldKSkKIHJ1Y3QgUmF3TW9kdWxlQ2h1bmtJdGVtIHsKICAgIG1vZHVsZTogUmUgICAgX21vZHVsZV9ncmFwaDogVmM8TW9kdWxlR3JhcGg+LAogID4gVmM8T3B0aW9uU291cmNlPiB7CiAgICAgICAgVmM6OmNlbGwoU29tZShSZXNmaWVyKHJjc3RyISgid2FzbSByYXciKSkKICAgICAgICAgICAgLndpdGhfbGF5ZXIoc2VsZjo6Y2VsbChSYXdXZWJBc3NlbWJseU1vZHVsZUFzc2V0IHsKc2VtYmx5QXNzZXQsIHNvdXJjZTo6V2ViQXNzZW1ibHlTb3VyY2V9OwoKLy8vIEV4cG9zdHI6OnJjc3RyOwp1c2UgdHVyYm9fdGFza3M6OntJbnRvVHJhaXRSZWYsIFJlcyd0IGdldCBjb21wYXJlZCBmb3IgZXF1YWxpdHkpLgogICAgbGV0IHRfbWVyZ2UgPSBtYXRhLmVycm9yLCBFdmFsRXJyb3JLaW5kOjpJbmNvbXBhcmFibGVWYWx1ZXMgeyAuLmVjb3JkISgoImIiLCBOaWNrZWxWYWx1ZTo6Zm9yZWlnbl9pZF9wb3NsZXNzKDQyKSkpICAgKCJsb2MyIiwgcGFyc2UoImlmIGdsb2IzIHRoZW4gZ2xvYjEgZWxzZSBnbG9iMiIoaWQsIHQpfCAoaWQuaW50bygpLCBldmFsX2NhY2hlLmFkZCh0LmludG8oKSwgQmluZHIoMikpCiAgICApOwp9CgpmbiBta19lbnYoYmluZGluZ3M6IFZlYzwoJnN0ciwgTmljOm5ld19lbXB0eV9lbnYoJm11dCB2bV9jdHh0KS53aXRoX2luaXRpYWxfZW52KGluaXRldmFsX2NhY2hlID0gQ2FjaGVJbXBsOjpuZXcoKTsKICAgIGluaXRpYWxfZW52Lmluc25lcl9jaHVua3MucmV2ZXJzZSgpOwoKICAgIGxldCBtdXQgY2h1bmtzID0gdmVjIWVzcygiSGVsbG8sIFdvcmxkISBIb3cgYXJlIHlvdT8iKSkKICAgICk7Cn0KICAgU3RyQ2h1bms6OmV4cHIobWtfdGVybTo6aWZfdGhlbl9lbHNlKAogIHBvcnQgImxpYiIgaW4geC5mCiAgICBsZXQgbWtfaW1wb3J0X2xpYiA9IG1rX2kgICAgSW1wb3J0RXJyb3JLaW5kOjpJT0Vycm9yKF8sIF8sIF8pID0+ICgpLAogcG9ydChpbXBvcnQsIGNyYXRlOjpjYWNoZTo6SW5wdXRGb3JtYXQ6Ok5pY2tlbCksCiBydCBcImN5Y2xlX2JcIiBhcyAnTmlja2VsIGluIHthID0gMSwgYiA9IHguYX0iKSwKIHJvbSgibGV0IHggPSBpbXBvcnQgXCJ0d29cIiBhcyAnTmlja2VsIGluIHggKyAxIiksZXh0OjpuZXcoU2ltcGxlUmVzb2x2ZXI6Om5ldygpLCBzdGQ6OmlvOjpzaW5rKCksIE51bWJlcl9wb3NsZXNzKE51bWJlcjo6dHJ5X2Zyb20oMTIuNSkudW53cmFwKCkpKSwKICAgICBCaW5hcnlPcDo6UGx1cywKICAgICAgICBta190ZXJtOjppbnRlZ2VyKDUpLAogZXN0XQojW3Nob3VsZF9wYW5pY10KZm4gbG9uZV92YXJfcGFuaWNzKCkgewogICAgZXZlKCkpLCBldmFsX25vX2ltcG9ydChsYW1iZGEpKTsKfQoKI1t0ZXN0XQpmbiBibGFtZWxldCBsYW1iZGEgPSBta19mdW4hKCJ4IiwgbWtfYXBwIShta190ZXJtOjp2YXIoIngiICBuZXdfbm9fdW53aW5kX3ZtKCZtdXQgdm1fY3R4dCgpKS5ldmFsX2Z1bGwodikKfQp0ZXh0PFIsIEM+LAopIC0+IE5vVW53aW5kVmlydHVhbE1hY2hpbmU8J18sIFIsIEM+IGJlciwgU3RyQ2h1bmssIFVuYXJ5T3AsIG1ha2UgYXMgbWtfdGVybX0sCiAgICB0cmFuICAgY2FjaGU6OntDYWNoZSBhcyBfLCBDYWNoZUltcGx9LAogICAgKiwKfTsKdCI6IDkxNiwKICAgICAgICAgICAgICAgICAgICAieFdpZHRoQXZnIjogODE5CiAgICAgICAiZmFtaWx5TmFtZSI6ICJSb2JvdG8gU2xhYiIsCiAgIGRlc2NlbnQ6IC0wLjIyNF84MzZfMTQyXzMyMl8wOTdfNCwKICBvb2t1cF9mYWxsYmFjaygiSW50ZXIiLCAmZm9udF9tZXRyaWNzLCB0cnVlKT8sCiAgc2NlbnQiOiAtNjgwLAogICAgICAgICAgICAgICAgICAgICJsaW5lR2FwIjogMCwKICBlOjpuZXh0X2ZvbnQ6Omdvb2dsZTo6Zm9udF9mYWxsYmFjazo6e0ZhbGxiYWNrLCBsbzQgLyAobWV0cmljcy51bml0c19wZXJfZW0gYXMgZjY0ICogc2l6ZV9hZGp1c3QpOwogYmxvYi83YmZkNTgyOTk5OWIxZDIwM2U0NDdkMzBkZTdlMjkxMDhjMzE5MzRhL3BhY2tyaWNzX21hcDogJkZvbnRNZXRyaWNzTWFwLAogICAgYWRqdXN0OiBib29sLAopIC1jZShmb250X2ZhbWlseSwgfGNhcHM6ICZyZWdleDo6Q2FwdHVyZXN8IHsKLmNvbS92ZXJjZWwvbmV4dC5qcy9ibG9iLzE2MjgyNjBiODhjZTMwNTJhYzMwN2ExNjAgICAiU2tpcHBpbmcgZ2VuZXJhdGluZyBhIGZhbGxiYWNrIGZvbnQuIgogICAgICAgIkZhaWxlZCB0byBmaW5kIGZvbnQgb3ZlcnJpZGUgdmFsdWVzIGZvciBmb25ldCBtZXRyaWNzX2pzb24gPSBsb2FkX2ZvbnRfbWV0cmljcyhwcm9qZWN0X3Jvb3QuY3RyISgiZGlzdC9zZXJ2ZXIvY2Fwc2l6ZS1mb250LW1ldHJpY3MuanNvbiIpLAogaW9uPEZvbnRBZGp1c3RtZW50PiwKfQoKLy8gVGhpcyBKU09OIGZpbGUgaXMgbGFyZ2UgICBpc3N1ZTo6TmV4dEZvbnRJc3N1ZSwKICAgICAgICB1dGlsOjp7Rm9udEZ0b21hdGljRm9udEZhbGxiYWNrLCBERUZBVUxUX1NBTlNfU0VSSUZfRk9OVCwgREVGaW50b19yZWFkX3dpdGhfdW5rbm93bl9pc19zZXJpYWxpemFibGVfY2VsbF9jb250Ci8vLyB2YyBpcyBhIG1pc3Rha2UuCnB1YiB0cmFpdCBJbnRvVHJhaXRSZWYgewogbDxUPiBUcmFpdFJlZjxUPgp3aGVyZQogICAgVDogVmNWYWx1ZVRyYWl0ICsgP1Npemw8VD4gU2VuZCBmb3IgVHJhaXRSZWY8VD4gd2hlcmUgVDogP1NpemVkIHt9CgppbSA8Qm94PFU+IGFzIFZjVmFsdWVUcmFpdD46OmdldF9pbXBsX3Z0YWJsZXMoKS5jYXN0dXAgd2lsbCBmYWlsIGlmIHRoZSB2YWx1ZSB0eXBlIHN0b3JlZCBkb2VzIG5vdCBhY3RlbGQoInNoYXJlZF9yZWZlcmVuY2UiLCAmc2VsZi5zaGFyZWRfcmVmZXJlbmNlKQogIGVuY2UsCiAgICBfdDogUGhhbnRvbURhdGE8VD4sCn0KCmltcGw8VD4gRGVidWcgZm9ye1JlYWRWY0Z1dHVyZSwgVmNWYWx1ZVRyYWl0Q2FzdCwgY2FzdDo6VmNDYXN0fSwKfTttYXQ6OllhbWwgPT4gc2VyZGVfeWFtbDo6dG9fd3JpdGVyKHN0ZGVyciwgJkRpYWduZXJtOjplbWl0X3RvX3dyaXRlX3N0eWxlKHdyaXRlciwgJmNvbmZpZywgZmlsZXMsIGRyIG9uIGBzdGRlcnJgLCBwcm92aWRlZCBhIGZpbGUgZGF0YWJhc2UgYW5kIGEgbGlzdF9zdHI8RTogSW50b0RpYWdub3N0aWNzPigKICAgIGZpbGVzOiAmbXV0IEZpbGVzLAogdCBTdGFuZGFyZFN0cmVhbTo6c3RkZXJyKGNvbG9yc19mb3JfdGVybWluYWwoY29sb25nCi8vLyAgIGluZnJhc3RydWN0dXJlIHRvIHBvaW50IGF0IHNwZWNpZmljIGxvY2F0cHViIHR5cGUgQ29sb3JPcHQgPSBjb2xvcmNob2ljZTo6Q29sb3JDaG9pY2U7Cgpmbi8vLyBBdmFpbGFibGUgZXhwb3J0IGZvcm1hdHMgZm9yIGVycm9yIGRpYWdub3N0aWNzdXNlIGNvZGVzcGFuX3JlcG9ydGluZzo6dGVybTo6dGVybWNvbG9yOjp7QW5zaSwgTm8gIGZuIGdldF92YWx1ZV9zeW5jKCZzZWxmKSAtPiBDb3VudGVyVmFsdWU7Cn0KCmZuIGluY3IoJnNlbGYpIHsKICAgICAgICB3aXRoX3R1cmJvX3Rhc2tzKHx0dHwgewogYWx1ZV9zeW5jKCkuMCwgMik7CiAgICAgICAgYXNzZXJ0X2VxISgqY291bnRlci5nZXR0byBhIHRyYWl0IHJlZmVyZW5jZSAoanVzdCBsaWtlIGEgYFJlYWRSZWZgCiAgIHQ/LCAxKTsKCiAgICAgICAgLy8gYHJlZl9jb3VudGVyYCB3aWxsIHN0aWxsIHBvaW5yID0gQ291bnRlcjo6Y2VsbChDb3VudGVyIHsKICAgICAgICAgICAgdmFsdWU6IE11dCd0IHJlc3BlY3QgdGhpcwoKdXNlIHN0ZDo6e2NvbGxlY3Rpb25zOjpIYXNoU2V0LCBtdDxWYzxPdXRwdXQ+PiB7CiAgICBwcmludGxuISgiY29tcHV0ZSh7aW5uZXJuZXNzfSkgICBSZXNvbHZlZFZjOjp1cGNhc3QoQ29sbGVjdGlibGUgeyB2YWx1ZSB9LnJlc29tcHV0ZTIoKmlucHV0LCAqaW5wdXQyLmF3YWl0Py5zdGF0ZS5nZXQoKSkpCn1ydWN0IE91dHB1dCB7CiAgICB2YWx1ZTogdTMyLAogICAgY29sbGVjdGlibGU6IFN0YWQuY29sbGVjdGlibGUsICIxIik7CgogICAgICAgIGZvciBpIGluIDIuLjEwMCB7CiBwdXRlKGlucHV0LCBpbnB1dDIsIDEpOwogICAgICAgIGxldCByZWFkID0gb3V0cHJjZSwgUmVzb2x2ZWRWYywgU3RhdGUsIFZhbHVlVG9TdHJpbmcsIFZjLCBlbWl0fTsKdHIhKCJwcmVmaXhlZCByb3V0ZXIgY29udGVudCBzb3VyY2UiKSkKIGUgaWYgbGV0IFNvbWUocGF0aCkgPSBwYXRoLnN0cmlwX3ByZWZpeCgnLycpIHsKZm4gdmFyeSgmc2VsZikgLT4gVmM8Q29udGVudFNvdXJjZURhdGFWYXJ5PiB7CiByIFByZWZpeGVkUm91dGVyQ29udGVudFNvdXJjZU1hcHBlciB7CmhhaW4ob25jZShzZWxmLmZhbGxiYWNrLmdldF9yb3V0ZXMoKSkpCmhhaW4oQmFzZVNlZ21lbnQ6OmZyb21fc3RhdGljX3BhdGhuYW1lKHBhdGgpKQogIHVyY2UpfCB7CiAgICAgICAgICAgIGxldCBwcmVwZW5kZWRfYmFzZSA9IHByZWY6dHJ5X3NpZGVjYXN0Ojo8Qm94PGR5biBJbnRyb3NwZWN0YWJsZT4+KHNvdXJjZSkubWMgZm4gZ2V0X2ludHJvc3BlY3Rpb25fY2hpbGRyZW4oCiAgICByb3V0ZXM6ICZbKFJjcmVmaXgsCiAgICAgICAgICAgIHJvdXRlcywKICAgICAgICAgICAgZmFsbGJhY2ssCiB3aWxsIHNlcnZlIGFsbAovLy8gb3RoZXIgc3VicGF0aHMsIGluY2x1ZGluZyBpZiB0dGVudCwKICAgIHJvdXRlX3RyZWU6OntCYXNlU2VnbWVudCwgTWFwR2V0Q29uISgiaW5uZXJfY29tcHV0ZSgpIik7CiAgICBsZXQgc3RhdGVfdmFsdWUgPSAqaW5wdWx1ZV0Kc3RydWN0IENoYW5naW5nSW5wdXQgewogICAgc3RhdGU6IFN0YXRlPHUzMj4saXQ/LCAxMCk7CgogICAgICAgIHByaW50bG4hKCJjaGFuZ2luZyBpbnB1dCIpOwogbnB1dC5hd2FpdD8uc3RhdGUuc2V0KDApOwogICAgICAgIGxldCBvdXRwdXQgPSBjb20gICBSYXdPdXRwdXQgeyBwYXRoLCBzb3VyY2UgfS5jZWxsKCkKICAgIH0KfQojIVtmcmNlOiBSZXNvbHZlZFZjPEJveDxkeW4gU291cmNlPj4sCn0uY29tL0J1cm50U3VzaGkvcmlwZ3JlcC9pc3N1ZXMvMjg4NAogICAgIGF0IGFsbC4pCiAgICAgICAgbGV0IHMgPSBlKHIiZm9vYmFyZm9vfGZvb3wgfGZvb2ZpdCdzIG9ubHkgb25lIGJ5dGUsIGl0CiAgICAgICAgLy8gcHJlZmVycyB0aGUgbXVsdCldKSwgcyk7CgogICAgICAgIC8vIFRoaXMgYWxzbyBmaW5kcyBhIGNvbW1vbiBwcmVmIGUociJ4ezB9ezQyOTQ5NjcyOTV9IikpOwosIEUoIjQiKV0pLCBlKHIiMXwyW0EtWl0zfDQiKSwpOwogIHNlcShbRSgiMSIpLCBJKCIyIiksIEUoIjMiKV0pLCBlKHIiMXxbQS1aXTJbQS1aXXwzZWZpeCBvciBzdWZmaXggd291bGQgb3RoZXJ3aXNlIG5vdCBiZSBmb3VuZC4KICAgLy8gImFueSBsaXRlcmFsIHdpbGwgbWF0Y2ggaGVyZS4iIFdoaWxlIG5vdCBuZWNlbWFpbiBpZGVhIGlzIHRoYXQgd2hlbiBsaXRlcmFsIGV4dHJhY3Rpb24gc2VlcyBzby8vIGJlbG93LCB3b3VsZCBiZSBhbiBlbXB0eSBTZXEgYW5kIG5vdCBhbiBpbmZpIC8vIHN0ZXBzIGFuZCBtYWtlcyB0aGUgY2FsbGVyIGNob29zZSB0byBvcHRpbWl6ZS4gICAiYWJlZmlqIiwgImFiZWZrbCIsICJhYmdoaWoiLCAiYWJnaGtsIiwgImNkZWZpal9lcSEoU2VxOjppbmZpbml0ZSgpLCBlKHIiKD86fGFhKSg/OmFhYSkqPyIpKTsKKFsiYWJjIiwgIm1ubyIsICJ4eXoiXSksIGUociJhYmN8bW5vfHh5eiIpKTsKdChbImFhYSIsICJhYWIiLCAiYWJhIiwgImFiYiIsICJiYWEiLCAiYmFiIiwgImJiYSIoImEiKSwgSSgiYiIpLCBJKCJjIildKSwgZShyImEqYipjKyIpKTsgZmV3IG1vcmUgc2ltaWxhcmlzaCBidXQgbm90IGlkZW50aWNhbCByZWdleGVzLiBUaGFjdChbRSgiYWIiKSwgSSgiYVoiKV0pLCBlKHIiYVoqP2IiKSk7cSEoaW5leGFjdChbSSgiYSIpXSksIGUociIoYSspKyIpKTsKZXEhKHNlcShbSSgiYVoiKSwgRSgiYWIiKV0pLCBlKHIiXmFaKmIiKSk7KFsiYWIiXSksIGUociJhKD8tdTpcYiliIikpOwpjdChbIs6UIiwgIs6VIiwgIs60IiwgIs61IiwgIs+1Il0pLCBlKHIiKD9pKVvOtc60Xc62zrfOuM65zrrOu868zr3Ovs6/z4DPgc+Cz4PPhM+Fz4bPh8+Iz4nPis+LIjsKICAgZXEhKGV4YWN0KFsiYWJDIiwgImFiYyJdKSwgZSgiYWIoP2ktdSljIikpOwogLy8gY2hvaWNlIGhlcmUsIGJ1dCB7YWJjLCBkZWYsIGdoaX0gaXMgbm90IGJhZC4KIHJhbHMgd2Ugc3R1bWJsZSBhY3Jvc3MgYXJlIHthYiwgY2QsIGVmfS4gQnV0IHdlCiAgICAgZShyIlthLXpdKFthLXpdZm9vKXszfShiYXJbYS16XSl7M31bYS16XSIpLAogX2VxIShlKHIiW2Etel0oZm9vKShiYXIpW2Etel0iKSwgc2VxKFtJKCJmb29iYXIiKV1sbG93KG5vbl9zbmFrZV9jYXNlKV0KICAgIGZuIEUoeDogJnN0cikgLT4gTGl0ZXI6aGlyOjpsaXRlcmFsOjpyYW5rOwoKICAgIGxpdC5pc19lbXB0eSgpIHx8IChsaXQubGcgYXQgYSBiYWNrZ3JvdW5kIGZyZXF1ZW5jeQogICAgICAgIC8vIGRpc3RyaWJ1dGlvIC8vIE9LIGJlY2F1c2Ugd2Uga25vdyBib3RoIHNlcXVlbmNlcyBhcmUgZmluaXQvLyBXaGljaGV2ZXIgb25lIHdlIHBpY2ssIGJ5IHZpcnR1ZSBvZiBwaWNraW5nIG9uZW9pc29ub3VzIGxpdGVyYWwuCiAgICBmbiBoYXNfcG9pc29ub3VzX2xpdGVyYWwoJnNlZWZ1bCBmb3Igc2hvcnQgY2lyY3VpdGluZyBsaXRlcmFsCiAgICAvLy8gZXh0cmFjdGloZSBzZXF1ZW5jZSBnaXZlbiBpcyAiZ29vZCIgZm9yCiAgICAvLy8gYWNjZWxlcmF0aWlmaWMgdG8gYSBUU2VxIHRoYXQgYXJlbid0IGp1c3QgZm9yd2FyZGluZyBjYWxscwogbGVuKCZvdGhlci5zZXEpCiAgICB9CgogICAgZm4gbWF4X2Nyb3NzX2xlbihsZi5zZXEuc29ydCgpOwogICAgfQoKICAgIGZuIGtlZXBfZmlyc3RfYnl0ZXMoJm1lbSA9IEI+LAogICAgICAgIEI6IEFzUmVmPFt1OF0+LAogICAgeyAgICBUU2VxIHsgc2VxOiBTZXE6OmluZmluaXRlKCksIHByZWZpeDogdHJ1ZSB9CiBlZml4ID0gc2VxMS5wcmVmaXggJiYgc2VxMi5wcmVmaXg7CiAgICAgICAgc2VxMQogIGF0J3Mgd2h5IHdlIHBpY2sgdGhhdCBudW1iZXIgaGVyZS4gQXJndWFibHkgdGhpc2VxdWVuY2UgYW5kIHRoYXQgaW5mZWN0cyBldmVyeXRoaW5nIGFuZCBlZmZlY3RpdmVsaWYgc2VxMS5tYXhfdW5pb25fbGVuKHNlcTIpLm1hcF9vcihmYWxzZSwgfGxlbnwgbGUgZm4gY3Jvc3MoJnNlbGYsIG11dCBzZXExOiBUU2VxLCBtdXQgc2VxMjogVFNlcSkgLWVuIGJ5dGUgY2xhc3MgZXhjZWVkcyB0aGUgY29uZmlndXJlZCBsaW1pdHMgb24KICBsZi5lbmZvcmNlX2xpdGVyYWxfbGVuKCZtdXQgc2VxKTsKICAgICAgICBzZXEKICAgIGxhc3NfYnl0ZXMoJnNlbGYsIGNsczogJmhpcjo6Q2xhc3NCeXRlcykgLT4gVFNlcSB7ZXJhbHMgaWYgdGhlCiAgICAvLy8gY2xhc3MgaXMgc21hbGwgZW5vdWdoLiBJZiB0ZnJvbShzZWxmLmxpbWl0X3JlcGVhdCkudW53cmFwX29yKHUzMjo6TUFYKTsKICAgIGlmIHVzaXplOjp0cnlfZnJvbShtaW4pLmlzX2VycigpIHx8IG1pbiA+IGxpbWlvbiB7IG1pbiwgbWF4OiBTb21lKG1heCksIC4uIH0gaWYgbWluID09IG1heCA9PiB7V2hlbiAnbWF4PTEnLCB3ZSBjYW4gcmV0YWluIGV4YWN0bmVzcywgc2luY2UgJ2E/JyBlIGtleSBoZXJlIHJlYWxseSBpcyBtYWtpbmcgc3VyZSB3ZSBnZXQgdGhlICdpbmV4YSAvLy8gICAnYSonICAgID0+IFtpbmV4YWN0KGEpLCBleGFjdCgiIildCiBPbmNlIG91ciAnc2VxJyBpcyBpbmZpbml0ZSwgZXZlcnkgc3Vic2VxdWVudCB1bmlvbnRoYXQgJ2Nyb3NzJyBhbHNvIGRpc3BhdGNoZXMgYmFzZWQgb24gd2hldGhlciB3ZSdyLy8gY2FuIGFkZCB0byBpdCBhbmQgY2FuIHF1aXQgZWFybHkuIE5vdGVzIHNob3J0IGNpcmN1aXRzIG9uY2UgdGhlIGNyb3NzIHByb2R1Y3QgdHVybnMgaW50byAgQ29uY2F0KHJlZiBoaXJzKSA9PiBzZWxmLmV4dHJhY3RfY29uY2F0KGhpcnMuaXRlICAgIEVtcHR5IHwgTG9vayhfKSA9PiBUU2VxOjpzaW5nbGV0b24oc2VsZjo6TGl0ZXEuc2VxLm9wdGltaXplX2Zvcl9wcmVmaXhfYnlfcHJlZmVyZW5jZSgpOwpmbiBleHRyYWN0X3VudGFnZ2VkKCZzZWxmLCBoaXI6ICZIaXIpIC0+IFNlcSB7CmhlIGV4dHJhY3RvciBmcm9tCi8vLyByZWdleC1zeW50YXguIFRoZSBtYWluIGRpZmZkZWJ1ZyEoImV4dHJhY3RlZCBmYXN0IGxpbmUgcmVnZXg6IHs6P30iLCBoaXIudG9fc2lzIGRlZW1lZCBhZHZhbnRhZ2VvdXMgdG8gZG8gc28gKHZpYSB2YXJpb3VzIHN1c3BpcyBhIGluZmluaXRlIHNldCBvZiBpbm5lciBsaXRlcmFscywgc3VjaCB0aGF0IGl0IGMgIGlmIGNoaXIuaGlyKCkucHJvcGVydGllcygpLmlzX2FsdGVybmF0aW9uX2xpdGUgc2xvd2VyIGVuZ2luZSB0aGF0IGl0J3Mgd29ydGggdHJ5aW5nIG91ciBvd24gaW5uZW5ldyhjaGlyOiAmQ29uZmlndXJlZEhJUiwgcmU6ICZSZWdleCkgLT4gSW5uZXJMaXRlZXJhbCBvcHRpbWl6YXRpb24gbWF5IG5vdCBiZQogICAgLy8vIHZhbGlkLgogIG9ucy4gKFdoaWNoIGNvdWxkCi8vLyBpbiB0aGVvcnkgYmUgaW1wcm92ZWQgc3RpbGwuIGFwcGx5IGFzIG11Y2ggYXMgaXQKLy8vIHVzZWQgdG8uCi8vLwovLy8gQSBnb29kIGVpbmFsIHJlZ2V4IG9uIG9ubHkgdGhhdCBsaW5lLiBUaGlzIG92ZXJhbGwgd29ya3MKL2VnZXhfYXV0b21hdGE6Om1ldGE6OlJlZ2V4LAogICAgcmVnZXhfc3ludGF4OjpoaXI6ZXQgd3JhcHBlZF9mdW5jID0gR2V0Q29udGVudEZuOjpuZXcobnVtYmVyLmNsbGV0IG51bWJlciA9IEFyYzo6bmV3KEF0b21pY0kzMjo6bmV3KDApKTsKIG9ucywgVHVyYm9UYXNrc0JhY2tlbmQsIG5vb3BfYmFja2luZ19zdG9yYWdlfTsKCiAgICAgSXNzdWVTdGFnZTo6T3RoZXIocmNzdHIhKCJ3ZWJzb2NrZXQiKSkuY2V1ZShzZXJpYWxpemF0aW9uID0gIm5vbmUiKV0Kc3RydWN0IEZhdGFsU3RyZWFtSXNzdXRlbT4+IHsKICAgICAgICBQaW46Om5ldygmbXV0IHNlbGYuZ2V0X211dCgpLjApICAgIFVwZGF0ZTo6Tm9uZSB8IFVwZGF0ZTo6TWlzc2luZyA9PiB7IC8vIERvIG5vdCBwcm9wYWdhdGUgZW1wdHkgdXBkYXRlcy4KIHNzdWVzX2NoYW5nZWQgPSBoYXNfaXNzdWVzICE9IGxhc3RfaGFkX2lzc3VlczsKICBzaWVudEluc3RhbmNlOjpuZXcoQ29tcHV0ZVVwZGF0ZVN0cmVhbVNlbmRlcihzeCkpLDpuZXcodmVyc2lvbi5pbnRvX3RyYWl0X3JlZigpLmF3YWl0PykuYXdhaXQ/OwoKdChza2lwKGdldF9jb250ZW50KSwgbmFtZSA9ICJVcGRhdGVTdHJlYW06Om5ldyIpXQphd2FpdDsKCiAgICAvLyBTZW5kIHVwZGF0ZS4gSWdub3JlIGNoYW5uZWwgY2xvc2VkIF0gdG8gYHNlbmRlcmAgZXZlcnkgdGltZSBpdCBnZXRzIHJlY29tcHV0ZWQgYnkKLy8vaGlzIG1wc2MgY2hhbm5lbCwgYnV0CiAgICAvLyAod2l0aG91dCBuaWdodGx5IGF1dG8gSXQgbWlnaHQgYmUgcmVtb3ZlZCBpbiBtZWFudGltZSwgcmVsb2FkIGNsaWVudAogICAgdG86IFZjOjp1cGNhc3Q6OjxCb3g8ZHluIFZlcnNpb24+Pihwcm94eSAgaWYgcHJveHlfcmVzdWx0X3ZhbHVlLnN0YXR1cyA9PSA0MDQgewogIHN1ZXMoJm11dCBwbGFpbl9pc3N1ZXMsIHBlZWtfaXNzdWVzKHVwZGF0ZV9vcCkuYXdhbiBPayhVcGRhdGVTdHJlYW1JdGVtOjpOb3RGb3VuZC5jZWxsIGxldCB1cGRhdGUgPSBVcGRhdGU6OlRvdGFsKFRvdGFsVXBkYXRlIHshKCJ7fSIsIFByZXR0eVByaW50RXJyb3IoJmUpKS5pbnQgVmM8VXBkYXRlPiB7CiAgICBjb250ZW50LnVwZGF0ZSgqZnJvbSkKfQoKZFJlZjxQbGFpbklzc3VlPj4pIHsKICAgIGZvciBpc3N1ZSBpbiBuZXdfaXNzdWVzIHt9Cn0KCmFzeW5jIGZuIHBlZWtfaXNzdWVzPFQ6IFNlbmQ+KHNvdXJjZTogT3BlVmFsdWVgXSBhbmQgW2BUcmFjZVJhd1Zjc2BdLgovLy8KLy8vIFRoZSBjYXB0dXJlICgvLyBBIHdyYXBwZXIgdHlwZSByZXR1cm5pbmcgW2BPcGVyYXRpb25WYzxSZXNvbGcvcnVzdC9pc3N1ZXMvNzAyNjMKLy8gU2FmZXR5OiBgY2FwdHVyZWAgaXMgYE5vbkxvY2U6OntQcm94eVJlc3VsdCwgcmVzb2x2ZTo6UmVzb2x2ZVNvdXJjZVJlcXVlc3RSZXNuZzo6SW5zdHJ1bWVudDsKdXNlIHR1cmJvX3Jjc3RyOjp7UmNTdHIsIHJjc3RyfTsKdSByID0gUm9wZTo6ZnJvbSgiYWJjIi50b19zdHJpbmcoKS5pbnRvX2J5dGVzKCkpOwpya0lkOjpuZXcoImJlbmNoX3JvcGVfaXRlcmF0aW9uIiwgIm5leHQgY29sbGVjdCIpLHQgPSBzdGFydC5lbGFwc2VkKCkuYXNfbWljcm9zKCkudG9fc3RyaW5nKCk7CiB0ZDo6dGhyZWFkOjpzbGVlcChEdXJhdGlvbjo6ZnJvbV9taWxsaXMoMSkpOwogICAgIHdhdGNoZXIud2F0Y2godGVtcF9wYXRoLCBSZWN1cnNpdmVNb2RlOjpSZWN1ciAgICBnLnNhbXBsZV9zaXplKDEwKTsKICAgIGcubWVhc3VyZW1lbnRfdGltZShEdXJhX2ZzOjpyb3BlOjp7Um9wZSwgUm9wZUJ1aWxkZXJ9OwoKZm4gYmVuY2hfZmlsZV93YXR0aW9uKHZhbHVlOiBJbmNvcnJlY3RUYXNrSW5wdXQpIC0+IFJlc3VsdDxWYzx1NjQ+Pj0gYXJnOyAvLyBNYWtlIHN1cmUgdW51c2VkIGFyZ3VtZW50IGZpbHRlcmluZyBkb2VzZ2UgPSBmb3JtYXQhKCJ7OiN9IiwgcmVzdWx0LnVud3JhcF9lcnIoKSk7CmtzLWJhY2tlbmRAdHJhY2VfdHJhbnNpZW50OjpBZGRlcikKICAgICAgYXJnczoKICAgc2tzOjpwcmltaXRpdmVzOjp1NjQpCiAgc2VsZjoKICAgIEFkZGVyOjpuZXcgKHJlYWluZzo6VGV4dChyY3N0ciEoIkNhbm5vdCBiZSB1c2VkIHdpdGhpbiAiKSksCmV0IHJlcXVlc3Q6IEhhc1BhdGggPSBwYXJzZV9qc29uX3dpdGhfc291clN0ciwgcmVxdWVzdF9oYXNoOiB1MzIpIC0+IFJjU3RyIHsKICAgIGZvcm1hdCEoCiAgICAgRm9udEZhbWlseVR5cGU6OldlYkZvbnQgPT4gZm9udF9mYW1pbHlfbmFtZSwKdGhlIGZvbnQgZmFtaWx5LCBlLmcuYF9fUm9ib3RvX2MxMjNiOGAKLy8vICogYHR5YCAvLyBuZXh0L2ZvbnQuIFVzZWQgdG8gdW5pcXVlbHkgaWRlbnRpZnkgZm9udCByZXF1cmU6Omlzc3VlOjp7SXNzdWVFeHQsIElzc3VlU2V2ZXJpdHksIFN0eWxlZFN0cmluZ30gbGV0IHdyaXRlciA9IHN0ZDo6aW86OkJ1ZldyaXRlcjo6bmV3KGZpbGUpOwpqb2luKGZvcm1hdCEoInttaW5fdHN9LXttYXhfdHN9LXtzaGF9Lmpzb24iKSk7CiAgICBsYXRlc3RfZm9yX3NoYS5iZW5jaG1hcmtzLmluc2VydChrZXlfdHMsIGJlbmV0IGtleV90c19zaGEgPSBmb3JtYXQhKCJ7a2V5fSAoe3RzfSwge30pIiwgJnNoYVsuY2hlcyl8IGJlbmNoZXMuYmVuY2htYXJrcy5nZXQoa2V5KS5tYXAofGJ8ICh0cywgYikvLyBzZXJkZV9qc29uOjp0b193cml0ZXJfcHJldHR5KHdyaXRlciwgYmVuY2hlcykudW9tZShzbG9wZSkgPSBiZW5jaC5lc3RpbWF0ZXMuc2xvcGUuYXNfbXV0KCkgeyAgICBzLmNvbmZpZGVuY2VfaW50ZXJ2YWwubG93ZXJfYm91bmQgKj0gZjsKICBsZXQgKHN1bSwgY291bnQpID0gJm11dCBub3JtYWxpemF0aW9uX3N0YXRlWyppXTsKIGFwKHwoXywgYil8IGIuZXN0aW1hdGVzLm1lYW4ucG9pbnRfZXN0aW1hdGUpCiAgdGhfY29udGV4dCh8fCBmb3JtYXQhKCJ1bmFibGUgdG8gcmVhZCB7fSIsIGRhdGxldCBtaW5fdHMgPSBkYXRhX2ZpbGVzLml0ZXIoKS5tYXAofGR8IGQudGltZXModTY0LCBTdHJpbmcsIEJlbmNobWFyayk+ID0gRnhIYXNoTWFwOjpkZWZhdWx0KCk7CnN0cigpLm1hcCh8bnwgbi5lbmRzX3dpdGgoInJhdy5qc29uIikpID09IFNvbWUodHJ1ICAgIC5va19vcigibWlzc2luZyBkYXNoIGluIHRpbWVzdGFtcC1zaGEgZGlyaW5nLAp9CgppbXBsPCdhPiBUcnlGcm9tPCYnYSBQYXRoPiBmb3IgQmVuY2hEYXRhRml1bW1hcml6ZV9iZW5jaDo6ZGF0YTo6e0Jhc2VCZW5jaG1hcmtzLCBDU3RhdHN9OwoKdHIoZXJyISgiZmFpbGVkIHRvIGNyZWF0ZSB0ZW1wIGRpciBhZnRlciB7fSB0cmllcyIsdGljIENPVU5URVI6IEF0b21pY1VzaXplID0gQXRvbWljVXNpemU6Om5ldygwKTsKCiBlbGYpIHsKICAgICAgICAgICAgZnM6OnJlbW92ZV9kaXJfYWxsKCZzZWxmLjApLnVudyBub3Qgbm9uZS4gT3RoZXJ3aXNlLCByZXR1cm4gb3RoZXIuCiAgICBwdWIgZm4gb3IoYiBmbiBtYXA8VSwgRjogRm5PbmNlKFQpIC0+IFU+KHNlbGYsIGY6IEYpIC0+IE1hdGMvLy8gYFdoaXRlbGlzdGAgYmVjb21lcyBgSWdub3JlYC4gQSBub24tbWF0Y2ggcmVtYWNoIHJlc3VsdCBpbXBsaWVzIHRoZSBwYXRoIHNob3VsZCBiZQogICAgLy8vIHdoaXQgICBNYXRjaDo6SWdub3JlKF8pIHwgTWF0Y2g6OldoaXRlbGlzdChfKSA9PiBmYWxzb2YgYSBnbG9iIG1hdGNoLgovLy8KLy8vIFRoZSB0eXBlIHBhcmFtZXRlciBgVGAgdHlmbiBtYXliZV9wdXNoX2lnbm9yZV9pbygmbXV0IHNlbGYsIGVycjogT3B0aW9uPEVycmx0KV0Kc3RydWN0IFBhcnRpYWxFcnJvckJ1aWxkZXIoVmVjPEVycm9yPik7CgooZiwgImVycm9yIHBhcnNpbmcgZ2xvYiAne30nOiB7fSIsIGdsb2IsIGVycikKICBzdG9yLCByZWYgY2hpbGQgfSA9PiB3cml0ZSEoCiAgICAgICAgICAgICAgICBmLAogIHJvcjo6SW52YWxpZERlZmluaXRpb24gPT4gImludmFsaWQgZGVmaW5pdGlvbiIsCn0gPT4gImZpbGUgc3lzdGVtIGxvb3AgZm91bmQiLAogdGggPSBlcnIucGF0aCgpLm1hcCh8cHwgcC50b19wYXRoX2J1ZigpKTsKbWUoY2hpbGQpKSA9IChlcnIubG9vcF9hbmNlc3RvcigpLCBlcnIucGF0aCgpKSB7YXRoIGFuZCBsaW5lCiAgICAvLy8gbnVtYmVyLiBJZiBwYXRoIGlzIGVtcHR5LCB0aGVyb3Igd2FzIGdlbmVyYXRlZCBmcm9tIGEgcmVjdXJzaXZlIGRpcmVjdG9yeSBpdGVyU29tZShlcnIpLAogICAgICAgICAgICBFcnJvcjo6R2xvYiB7IC4uIH0gPT4gTm9uZXIgdG8gW2Bpb19lcnJvcmBdIGV4Y2VwdCBjb25zdW1lcyBzZWxmIHRvIGNvbnZlcnIuaW9fZXJyb3IoKSwKICAgICAgICAgICAgRXJyb3I6Okxvb3AgeyAuLmVycm9yYF06IHN0cnVjdC5FcnJvci5odG1sI21ldGhvZC5pbnRvX2lvX2Vycm9yCiAgcHM6Ly9kb2MucnVzdC1sYW5nLm9yZy9zdGFibGUvc3RkL29wdGlvbi9lbnVtLk9wdGlFcnJvcmBdIGlmIHRoZXJlIGlzIG9uZS4KICAgIC8vLwogICAgLy8vIFtgTm9uZWBdIDpXaXRoTGluZU51bWJlciB7IHJlZiBlcnIsIC4uIH0gPT4gZXJyLmlzX2lvKCksCnJ0aWFsIGVycm9yIG9jY3VycyB3aGVuIG9ubHkgc29tZSBvcGVyYXRpb25zIGZhaWxlcm9yOjpVbnJlY29nbml6ZWRGaWxlVHlwZShyZWYgZXJyKSByb3I6OldpdGhEZXB0aCB7IGRlcHRoLCBlcnI6IGVyci5jbG9uZSgpIH0KICByb3I6OlBhcnRpYWwocmVmIGVycnMpID0+IEVycm9yOjpQYXJ0aWFsKGVycnMuY2xvIGBnaXRpZ25vcmVgIHNlbWFudGljcy4pCiAgICAgICAgZ2xvYjogT3B0aW9uPFN0cmlsZSBwYXRoIGluIHRoZSBsb29wLgogICAgICAgIGFuY2VzdG9yOiBQYXRoQnVmLAogIHJzaXZlbHkKICAgIC8vLyB3YWxraW5nIGEgZGlyZWN0b3J5LgogICAgV2l0aERlcHRobCwgV2Fsa1N0YXRlLAp9OwoKbW9kIGRlZmF1bHRfdHlwZXM7Cm1vZCBkaXI7CnB1YiBpbGRlcmA6CgpgYGBydXN0LG5vX3J1bgp1c2UgaWdub3JlOjpXYWxrQnVpbGRlcjsKCm91bmQgaW4gZmlsZXMgbGlrZQpgLmlnbm9yZWAgYW5kIGAuZ2l0aWdub3JlYDoKCgpgZWNpc2UKbWF0Y2hpbmcgcnVsZXMgYW5kIHByZWNlZGVuY2UgaXMgZXhwbGFpbmVkIGlvbnMgam9pbmVkIGFzIGEgY29tbWEtc2VwYXJhdGVkIHN0cmluZywgaWYKICAgdXJuIHRydWUgaXMgdGhlIGZpZWxkJ3MgbWVyZ2UgcHJpb3JpdHkgaXMgYGRlZmF1LmNvbS90d2VhZy9uaWNrZWwvaXNzdWVzLzE1MDUpKS4gRm9yIG5vdywgdGhpcwogb24gYmV0d2VlbgogICAgLy8vIGZpbGxpbmcgYSBiZXNwb2tlIGlucHV0IG9mIGEgY28gICAgc3ViZmllbGRzOiBycm93LnR5cC5leHRyYWN0X2ludGVyZmFjZSgpLAogICAuY2hhaW4oc3ViZmllbGRzX2Zyb21fdmFsdWUpCiAgICAgICAgICAgIC5yZWR1Yy8vIChib3RoIGVpdGhlciBhcyB0eXBlIGFubm90YXRpb25zIG9yIGNvbnRyYWN0IGFuIC8vIGV2YWx1YXRlZC4gSGVyZSwgd2UgZm9jdXMgb24gcHVyZSBzdGF0aWMgdHlwZW9tZSgocnJvdy5pZCwgRmllbGRJbnRlcmZhY2U6OmZyb20oJnJyb3cpKSkKIGxmLmFzX3JlY29yZCgpLm1hcCh8Y29udGFpbmVyfCBtYXRjaCBjb250YWluZXIgewp0aW9uPFZhbHVlSW50ZXJmYWNlPjsKfQoKaW1wbCBFeHRyYWN0SW50ZXJsdWU6IGZpcnN0LmZpZWxkLnZhbHVlLm9yKHNlY29uZC5maWVsZC52YWx1ZSksCiBmYWNlIHsKICAgIGZuIGNvbWJpbmUoZmlyc3Q6IFNlbGYsIHNlY29uZDogU2VsZiljaWZpYyBmaWVsZC4gVGhpcyBmaWVsZCBjYW4gYmUgaXRzZWxmIGEgcmVjb3JkIGFuZG9uIHdoZW4gdXNpbmcgdGhlCi8vLyBgY3VzdG9taXplX21vZGVgIG9wdGlvbi4KI1tkU3RyPj4gewogICAgICAgIGxldCByb290X2ZzX3N0ciA9IHNlbGYucm9vdF9mcy50b18gICAud3JpdGVfc3ltYm9saWNfbGlua19kaXIodGFyZ2V0KSkKIG1QYXRoKSAtPiBSZXN1bHQ8VmM8UmF3RGlyZWN0b3J5Q29udGVudD4+Z2V0X2lubmVyX2ZzX3BhdGgocGF0aCkuYXdhaXQ/LnJlYWQoKSkKb21lKGlubmVyX3BhdGgpID0gY2hpbGRfcGF0aC5nZXRfcGF0aF90bygmcGF0aCkgewphaXQ/LmpvaW4oJnNlbGYuYXdhaXQ/LmNoaWxkX3BhdGgpPy5jZWxsKCkpCiAicGF0aCB7fSBub3QgcGFydCBvZiBzZWxmLCB0aGUgcm9vdCBmcyBvciB0aGUgY2hpbCAgICBmcyBpZiBmcyA9PSBzZWxmX2ZzID0+IE9rKGNvbnRhaW5lZF9wYXRoLmNlbGxwYXRoIGhhcyB0byBiZSBpbnNpZGUgb2YgdGhlIHJvb3QgW0ZpbGVTeXN0ZW1dLCB0aGljaCB3aWxsIGhhdmUgdGhlIGBjaGlsZF9mc2AgYXMKICAgIC8vLyBhbiBpbnZpc2liaWNoIGF0dGFjaGVzIGEgY2hpbGQgW0ZpbGVTeXN0ZW1dIGFzIGEKLy8vICJzdWJkaXJlIGl0IHVuc3VpdGVkIGZvciBwdWJsaWMgdXNhZ2UuCm1hY3JvX3J1bGVzISBkZXJpaW9uLiBXZSBkb24ndAovLy8gbmVjZXNzYXJpbHkgd2FudCB0byBkbyB0aGF0IGZvaG91dCBrbm93aW5nIHdoYXQgdGhleSBhcmUgaW5zdGFudGlhdGVkIHRvLAogICAgYm9keTEuc3Vic3QodmFyMSwgJlVuaWZFbnVtUm93czo6Q29uc3RhbnQoY3N0X2lkKWxldCAodXR5MV9zdWJzdCwgdXR5Ml9zdWJzdCkgPSBtYXRjaCB2YXJfa2luZDEgewogbGV0IGNzdF9pZCA9IHN0YXRlLmZyZXNoX2NzdF9pZCgpOwoKcGVGOjpSZWNvcmQodXR5MSksIFR5cGVGOjpSZWNvcmQodXR5MikpID1wZUY6OkFycm93KHMxLCB0MSksIFR5cGVGOjpBcnJvdyhzMiwgdDIpKSBpZiBhdHRyczEgPT0gYXR0cnMyID0+IHV0eTEudHlwZV9lcV9ib3VuZGVkKHV0eTIsIHsgdHlwOiBzMSwgLi4gfSwgVW5pZlR5cGU6OkNvbmNyZXRlIHsgdHlwOiBzMiwgLi4gaXF1ZSBpZGVudGlmaWVycyB0aGF0IGFyZSBkaXN0aW5jdCBmcm9tIHRoZSBvbmUgdXNlIG91dHNpZGUuIEFuZCBpbmRlZWQsIGNvbXB1dGluZyB0eXBlIGVxdWFsaXR5IHJlYyBhcmUgb2J2aW91c2x5IG5vdCBlcXVhbCwgYnV0IHRvIGtub3cgdGhhdCwgd2UgaGF2IHdlbGw6IG1vc3QgcmVjb3JkIGNvbnRyYWN0cyBhcmUgd3JpdHRlbiBhcyBmaWVsZXNfb3RoZXJfc29ydGVkLnNvcnRfYnlfa2V5KHxpbmNsfCBpbmNsLmlkZW50KTsKCiBtdXQgc29ydGVkX3NlbGY6IFZlYzxfPiA9IHNlbGYuZmllbGRfZGVmcy5pdGVpZ2h0IGxlYWQgdG8gZXF1YXRlIGEgYml0IGxlc3MgdGhhbiB3ZSBjb3VsZCwgaW4gcGF0ZTo6aWRlbnRpZmllcjo6RmFzdE9yZElkZW50OwoKICAgICAgICAvLyBXZSBzb3JlbGYub3B0ID09IG90aGVyLm9wdAogICAgICAgICAgICAmJiBzZWxmLm5vdF9lbGYudHlwLnR5cGVfZXFfYm91bmRlZCgmb3RoZXIudHlwLCBzdGF0ZSwgZW52MSwgZWxmKSwgU29tZShtYXBfb3RoZXIpKSA9IChtYXBfc2VsZiwgbWFwX290aGVyKSBlbHNlbWFwKHxpdGVtfCBtYXRjaCBpdGVtIHsKICAgICAgICAgICAgICAgIFJlY28gICBFbnVtUm93c0VsdDo6Um93KEVudW1Sb3dGIHsgaWQsIHR5cDogdHlwZXMgfSkgPWV0IG1hcF9zZWxmOiBPcHRpb248SW5kZXhNYXA8TG9jSWRlbnQsIE9wdGlvbjxfPj4+ZWxmLml0ZXIoKS5hbGwofChpZCwgdjEpfCB7CiAgICAgICAgICAgICAgICBvdGhlcgpzZWxmX2FzX3V0eXBlID0gVW5pZlR5cGU6OmZyb21fdHlwZShzZWxmLmNsb2F0IHN1YnR5cGVzIG9yIHN1YnRlcm1zIChjb250cmFjdHMpIGFyZSBlcXVhbHMuCiAgb3JzLCBub3IgcGFpcnMgb2YgdGVybXMgdGhhdCBkb24ndCBoYXZlIHRoZVRoZSBhbnN3ZXIgdG8gdGhlIGxhc3QgcXVlc3Rpb24gaXMgcHJvYmFibHkgeWVzLCBiIC8vIC0gZG9lcyBpdCByZWFsbHkgbWFrZSBzZW5zZSB0byBjb21wYXJlIHRoZSBhbm4gICAgKE5vZGU6OlJlY29yZChyMSksIE5vZGU6OlJlY29yZChyMikpID0+IHIxLnR5cHRhdGUudXNlX2dhcygpCiAgICAgICAgICAgICAgICAgICAgJiYgZW52MgogICAgaWQyICYmIEVudmlyb25tZW50OjpwdHJfZXEoJmVudjEuMCwgJmVudjIuMCkgPT4KICBoZSBzdGRsaWIpLiBJbiB0aGF0IGNhc2UsIGZyZWUgdmFyaWFibGVzICh1bmJvdW5kKWJsZXMgbXVzdCBiZSBib3VuZCBhdCB0aGlzIHN0YWdlLiBUaGlzIGlzIGNoZWNsbCh8KGNodW5rMSwgY2h1bmsyKXwgbWF0Y2ggKGNodW5rMSwgY2h1bmsyKSB7CiBpbnRlcnBvbGF0ZWQgZXhwcmVzc2lvbiksIGFzIHN0YXRpYyBzdHJpbmcgbWF5IGJlICAgIHRhZzogdGFnMiwKICAgICAgICAgICAgICAgICAgICBhcmc6IGFyZzIsCiB1Y3R1cmFsIGNoZWNrcyBiZWxvdyBtYXkgcmVqZWN0IHRoZSBlcXVhbGl0eSkKdXQgU3RhdGUsCiAgICAgICAgZW52MTogJlRlcm1FbnY8J2FzdD4sCiBhc3QsIFQ+IFR5cGVFcUJvdW5kZWQ8J2FzdD4gZm9yICZUCndoZXJlCiAgICBUOiBUeSAgIC5hbGwofCh4MSwgeDIpfCB4MS50eXBlX2VxX2JvdW5kZWQoeDIsIHN0YXRlLCBlYWwgd29yayBidXQgaXNuJ3QgcHVibGljIGZhY2luZy4gW1R5cGVFcV0KdHJhaXQgVHllIGdhcyB3YXMgYWxyZWFkeSBhdCB6ZXJvLgogICAgZm4gdXNlX2dhcygmbXV0IGZvciB2YXJpYWJsZSBzdWJzdGl0dXRpb25zLiBPbmNlIGl0IHJlYWNoZXMgemVybyBtcGFyaW5nIGZvcmFsbHMuIFRob3NlIGlkcyBuZXZlciBlc2NhcGUgdGhlIHR5cCBsb3csIGJ1dCBoYXMgYmVlbiBmaXhlZCBhcmJpdHJhcmlseTogZmVlbCBmZWUgdG8gISBXZSBmaXJzdCB0ZXN0IGZvciBwaHlzaWNhbCBlcXVhbGl0eSAoYm90aCBhcyBhbiBucywgYG1hdGNoYCwgYW5kIHRoZSBsaWtlCi8vISBhcmUgcXVpdGUgdW5saWtlbHkgdG1pdCAodGhlIGdhcykgb24KLy8hIHRoZSBudW1iZXIgb2YgdmFyaWFibGUgbGlua3MgCi8vISB7Ci8vISAgIEZvbyA9IEJhciwKLy8hICAgQmFyID0gRm9vLAovLyEgfQovLyFuOgovLyEgYGxldCBBbGlhcycgPSBGb28gImJhciIgImJheiIgaW4gLi4uYCwgb3IgYGVydHkoCiAgICAgICAgICAgICJ1c2VDYWNoZVRlbGVtZXRyeVRyYWNrZXIiLAogICAgIGpzX291dHB1dC5zZXRfbmFtZWRfcHJvcGVydHkoImNvZGUiLCBlbnYuY3JlYXR3aGVuIGRvaW5nIGNwdS1oZWF2eSB3b3JrCiAgICAgICAgLmRpc2FibGVfbGlmb19zbHZvaWQgZGVhZGxvY2tzIGR1ZSB0byB1c2FnZSBvZiBibG9ja19pbl9wbGFjZQogICAgaGFuZGxlX3BhbmljKGluZm8pOwogICAgICAgIHByZXZfaG9vayhpbmZvYXRpYyBMQVNUX1NXQ19BVE9NX0dDX1RJTUU6IFJlZkNlbGw8T3B0aW9uPEluc3RhW2NmZyhub3QodGFyZ2V0X2FyY2ggPSAid2FzbTMyIikpXQpwdWIgbW9kIG5leHRfYXB5bmM6OkFyYzsKCnVzZSBuYXBpOjpiaW5kZ2VuX3ByZWx1ZGU6Oio7CnVzZWx1ZGVkIGluIGFsbCBjb3BpZXMgb3Igc3Vic3RhbnRpYWwgcG9ydGlvbnMKb2YgdGhzdWJsaWNlbnNlLCBhbmQvb3Igc2VsbCBjb3BpZXMgb2YKdGhlIFNvZnR3YXJlLCBhbmZuIHNldF9jb2xvcigmbXV0IHNlbGYsIHNwZWM6ICZDb2xvclNwZWMpIC0+IGlvOjpSIC8vIEEgaGlnaCBtYXRjaCBjb3VudCBhZCBob2MgYmVuY2htYXJrIGZsYWdnZWQgdGgvIFJlc2V0cyB0aGUgbnVtYmVyIG9mIGJ5dGVzIHdyaXR0ZW4gdG8gYDBgLgogICAgIENvdW50ZXJXcml0ZXIgeyB3dHIsIGNvdW50OiAwLCB0b3RhbF9jb3VudDogMCB9bG9yOjp7Q29sb3JTcGVjLCBIeXBlcmxpbmtTcGVjLCBXcml0ZUNvbG9yfTsKCi9lKHBhbmljKSA9IHJvb3RfY2F1c2UuZG93bmNhc3RfcmVmOjo8VHVyYm9UYXNrc0V4ZXNfY2FsbGVkLnN0b3JlKHRydWUsIE9yZGVyaW5nOjpTZXFDc3QpKQogICAgfSk7CgogKSk7CgovLyBETyBOT1QgQUREIE1PUkUgVEVTVFMgVE8gVEhJUyBGSUxFIQovLwovLyAgICBwYW5pYzo6e3NldF9ob29rLCB0YWtlX2hvb2t9LAogICAgc3luYzo6ewogaW5nKCldKSwKICAgICAgICAyID0+IEZ4SGFzaFNldDo6ZnJvbV9pdGVyKFsiZSIudG9ydCEoIWFfcmVmMy52YWx1ZSk7CiAgICAgICAgYXNzZXJ0IShiX3JlZjNhaXQ/LnNldCgyKTsKCiAgICAgICAgbGV0IGFfcmVmMiA9IGEuZXQgc2V0ID0gY3JlYXRlX3NldChzdGF0ZSk7CiAgICAgICAgbGV0IGEgPSBoYXNfdmFuZG9tID0gcmFuZDo6cmFuZG9tOjo8dTMyPigpOwogICAgT2soR2V0VmFsdWVSZXN1dWUgPSBzdGVwLmdldCgpOwoKICAgIE9rKFZjOjpjZWxsKG1hdGNoICpzdGVwX3ZhbHVsID0gImtleWVkIildCnN0cnVjdCBNYXAoRnhIYXNoTWFwPFN0cmluZywgdTMyPik7CihjX3JlZi5yYW5kb20sIGNfcmVmMi5yYW5kb20pOwoKICAgICAgICBzdGF0ZS5hd2FpYXAsICJjIi50b19zdHJpbmcoKSk7CgogICAgICAgIGxldCBhX3JlZiA9IGEucmVhZHRhdGUoKSAtPiBWYzxTdGVwPiB7CiAgICBTdGVwKFN0YXRlOjpuZXcoMCkpLmNlbGxnOjppbnN0cnVtZW50KGxldmVsID0gdHJhY2luZzo6TGV2ZWw6OlRSQUNFLCBuYW1ydWN0IERlYnVnRm5OYW1lVHJhbnNmb3JtZXIge30KCiNbYXN5bmNfdHJhaXRdCmltcG9yZTo6ZWNtYTo6e2FzdDo6UHJvZ3JhbSwgdmlzaXQ6OlZpc2l0TXV0V2l0aH07CnVzaXJseSBsb3cuCiAgICAgICAgICAgIHNraXBfaWRlbXBvdGVuY2U6ICFjZmchKGRlYnV0IGdyYW1tYXIgPSB0cmVlX3NpdHRlcl9uaWNrZWw6OkxBTkdVQUdFLmludG8oKTsKIHVzZSB0b3BpYXJ5X2NvcmU6OntMYW5ndWFnZSwgT3BlcmF0aW9uLCBUb3BpYXJ5UXVlICAgIGRyb3AoZmlyc3RfY2h1bmspOwogICAgICAgIGZvciBhcmMgaW4gZGF0YSAyLCAzLCA0LCA1LCA2LCA3XSwgMikubGVuKCksIDQpOwogIF9lcSEoaW50b19jaHVua3ModmVjIVsxLCAyXSwgMikubGVuKCksIDEpOwogIGZuIGxlbigmc2VsZikgLT4gdXNpemUgewogICAgICAgIHNlbGYuZW5kIC0gc2VsZiAvLyBUbyBhdm9pZCBsZWFraW5nIG1lbW9yeSB3ZSBuZWVkIHRvIGRyb3AgdGhlLyBpcyBubyBsb25nZXIgZHJvcHBlZCBieSBtb3ZpbmcgdGhlIGluZGV4CiAgIGxldCBlbmQgPSBzZWxmLmRhdGEubGVuKCkubWluKHNlbGYuaW5kZXggKyBzZWxmLyB3ZSB1c2UgcHRyLgogICAgbGV0IGRhdGEgPQogICAgICAgIHVuc2FmZSB7IFZlYzogLy8gU0FGRVRZOiBjaGFuZ2luZyBhIHBvaW50ZXIgZnJvbSBUIHRvIFN5bmNVbnNhZiAgICBMYXp5TG9jazo6bmV3KHx8IGF2YWlsYWJsZV9wYXJhbGxlbGlzbSgpLm1hcF9vJ2E+KSAtPiBQb2xsPEY6Ok91dHB1dD4+IFdyYXBGdXR1cmU8RiwgVz4gewogcmFwcyBhbm90aGVyIGZ1dHVyZSBhbmQgYXBwbGllcyBhIGZ1bmN0aW9uIG9uIGV2ZXJmLCBzdGF0ZTogJm11dCBIKSB7CiAgICAgICAgKCoqc2VsZikuaGFzaChzdGF0ZSk7CnRpYz4gQ2xvbmUgZm9yIFN0YXRpY09yQXJjPFQ+IHsKICAgIGZuIGNsb25lKCZzZW50ZXIgdGhhdCBzdG9yZXMgZGF0YSBlaXRoZXIgaW4gYW4gW0FyY10gb3IgYXMgYSBzb25zdCBHQjogdXNpemUgPSAxXzAyNCAqIE1COwogICAgICAgIGlmIGIgPiBHQiB7CiB1Y3QgRm9ybWF0Qnl0ZXMocHViIHVzaXplKTsKCmltcGwgRGlzcGxheSBmb3IgRm9ybSwgInt9bXMiLCAoc2VsZi4wLmFzX21pY3JvcygpIGFzIGYzMikgLyAxMDAwLjApCiA6aW1wbF9ib3Jyb3dfZGVjb2RlIShTaGFyZWRFcnJvcik7CgppbXBsIERlcmVmIGZvcmZuIGRlY29kZTxEOiBEZWNvZGVyPENvbnRleHQgPSBDb250ZXh0Pj4oZGVjb2RlcjpsZiwgcmVxOiAmbXV0IHN0ZDo6ZXJyb3I6OlJlcXVlc3Q8J2E+KSB7CmltcGwgU3RkRXJyb3IgZm9yIFNoYXJlZEVycm9yIHsKICAgIGZuIHNvdXJjZSgmc3J1Y3QgdGhhdCBpcyBiYWNrZWQgYnkgYW4gQXJjIHRvIGFsbG93IGNsb25pbmcgZXJyIEhhc2hlcn0sCiAgICBtZW06Ok1hbnVhbGx5RHJvcCwKICAgIG9wczo6RGVyZWYsCiBpbmU6OmNvbWJpbmVgXSBoZXJlIGFuZCByZXBsaWNhdGUgdGhlIG1lcmdpbmcgbG9naW9uZSwgU29tZSh0KSkgPT4gKFNvbWUodCksIG1ldGFkYXRhMi5wcmlvcml0eSksCiAgbHVlLCBwcmlvcml0eSkgPSBtYXRjaCAoZmllbGQxLnZhbHVlLCBmaWVsZDIudmFsdSAgICAobGVuczEsIGxlbnMyKSA9PiBta190ZXJtOjpvcDIoCiAgIHNlcnQoaWQsIG1lcmdlX2ZpZWxkcyhpZF9zcGFuLCBmaWVsZDEsIGZpZWxkMikpOwogIG5vdCBxdWl0ZQogICAgLy8gZW5vdWdoIHRvIGFjdHVhbGx5IGZhY3RvciBpdCBvdXQvLyBGSVhNRTogV2UncmUgZHVwbGljYXRpbmcgYSBsb3Qgb2YgdGhlIGxvZ2ljIGluIC8gTWVyZ2UgdHdvIGZpZWxkcyBieSBwZXJmb3JtaW5nIHRoZSBtZXJnZSBvZiBib3RoICAgIGR5bmFtaWNfZmllbGRzLnB1c2goKGV4cHIsIGZpZWxkKSk7CiAgLy8gYXJlIGFjdHVhbGx5IHN0YXRpYyBvciBub3QsIGFuZCBpbnNlcnRzIHRoZW0gaSB4ID0gImR5bmFtaWMiIGluIHsiSSVhbS5zdGF0aWMiID0gZmFsc2UsICIle3h9IiA9IC8vIHNlbWFudGljcyB0aGFuIGZpZWxkcyB3aG9zZSBuYW1lIGNhbiBiZSBkZXRlc2VydChtZXJnZV9maWVsZHMocG9zX3RhYmxlLnB1c2goaWQucG9zKSwgcHJldiwgZmkgLy8gdGVtcG9yYXJpbHkgcHV0dGluZyBhbiBlbXB0eSBmaWVsZCBpbiB0bmFtaWMKLy8vIGZpZWxkcykuIElmIGEgZmllbGQgaXMgZGVmaW5lZCBzZXZlcmFsIHR0UmVmTXV0OjpUZXJtKHRlcm06OlRlcm06Ok9wMihkYXRhKSkgPSByZXN1bHQuY29udGN0bHkgdHlwZWNoZWNrZWQpLCB3ZSBwYWNrIHRoaXMgZXJyb3IgYXMgYSBwYXJzZCBiZSBwYWluZnVsIHRvIGNoYW5nZSB0aGUgaW50ZXJmYWNlIG9mIGBUb01haW5sb2RlOjpJbXBvcnQoSW1wb3J0OjpQYXRoIHsgcGF0aCwgZm9ybWF0IH0pID1kZTo6QW5ub3RhdGVkIHsgYW5ub3QsIGlubmVyIH0gPT4gTiwgd2Ugc3RpbGwgZG9uJ3QgaGF2ZSBhY2Nlc3MgdG8gdGhlIHJpZ2h0IHNwYW4sCiAgLy8gdHJhbnNsYXRlZCBhcyBhcnJheXMgZGlyZWN0bHksIHdlIHdyYXAgdGhlbSB1c2kvLyB3ZWxsLWZvcm1lZCB2YWx1ZXMuIEluIHBhcnRpY3VsYXIsIGNvbnRhaW5lcnMgKCAgIGJvZHk6IG1hdGNoX2RhdGEuY29tcGlsZShwb3NfdGFibGUsIFRlcm1hcCh8YnJhbmNofCB0ZXJtOjpwYXR0ZXJuOjpjb21waWxlOjpNYXRjaEJyYW5jaCB7CiAgIGVsc2VfYnJhbmNoLAogICAgICAgICAgICB9ID0+IHRlcm06Om1ha2U6OmlmX3RobGV0IChkYXRhLCBkeW5fZmllbGRzKSA9ICgqcmVjb3JkKS50b19tICAgIE5pY2tlbFZhbHVlOjplbnVtX3RhZygqdGFnLCBwb3NfdGFibGUucHVzZm9sZChoZWFkLnRvX21haW5saW5lKHBvc190YWJsZSksIHxyZXN1bHQsIGFyZ3wgewplOjpjb21waWxlX2xldF9wYXR0ZXJuKHBvc190YWJsZSwgJmJpbmRpbmdzLCBib2R5LGxldCB0ZXJtID0gaWYgbGV0IFNvbWUoYmluZGluZ3MpID0gdHJ5X2JpbmRpbmdzIHsKbGV0IGF0dHJzID0gdGVybTo6TGV0QXR0cnMgewovIFdlIHRyeSB0byBjb2xsZWN0IGFsbCBwYXR0ZXJucyBhcyBzaW5nbGUgaWRldGE6ICZMZXRNZXRhZGF0YTwnXz4sCiAgICAgICAgICAgICAgICAgICAgdmFsdWU6ICZ2ZSBhbnkgbWV0YWRhdGEgYXNzb2NpYXRlZCB3aXRoIHRoZW0uIFdlIG5lZWQgdG8KIC8vIFdoYXQgd2UgZG8gaGVyZSBpcyB0byBmdXNlIHRoZSBzcGFuIG9mIGN0b3JzLXVucm9sbGluZ106IHRoaXMgY2FzZSBpcyBhIGJpdCBhbm5veWluZzogd2UgIC8vIGZ1bmN0aW9ucywgdGhlIGxhdHRlciBiZWluZyB0aGUgcmVwcmVzZW50YXRwdXNoKGFzdC5wb3MpKSwKICAgICAgICAgICAgTm9kZTo6U3RyaW5nKHMpID0+ICAgTm9kZTo6Qm9vbChiKSA9PiBOaWNrZWxWYWx1ZTo6Ym9vbF92YWx1ZSgqYiwgcG9MYWJlbEluc2VydFR5cGVWYXIgPT4gVGVybVByaW1PcDo6TkFyeSh0ZUxhYmVsTG9va3VwVHlwZVZhciksCgogICAgICAgICAgICAvLyBOLWFyeSBvbFdpdGhOb3RlcyksCiAgICAgICAgICAgIFByaW1PcDo6TGFiZWxBcHBlbmROb3RlID1pbmdDb21wYXJlKSwKICAgICAgICAgICAgUHJpbU9wOjpTZWFsID0+IGFiZWw6IGxhYmVsOjpNZXJnZUxhYmVsID0gbGFiZWw6OkxhYmVsOjpkdW1teSgpLmlubUFzdDxOb2RlPCdfPj5gKSB0byBwb3N0LXByb2Nlc3MgYSBtZXJnZSBwcmltb3AgYXBjb3JkRGlzam9pbnRNZXJnZSksCiAgICAgICAgICAgIFByaW1PcDo6QXJyYXlDb25jYSAgIGV4dF9raW5kOiB0ZXJtOjpSZWNvcmRFeHRLaW5kOjpXaXRoVmFsdWVDaGVjayksCiAgICAgICAgICAgIFByaW1PcDo6TGFiZWxXaXRoRXJyb3JEYXRhID0+IGVhdGVyVGhhbiksCiAgICAgICAgICAgIFByaW1PcDo6R3JlYXRlck9yRXEgPT4gVE9wOjpTdWIpLAogICAgICAgICAgICBQcmltT3A6Ok11bHQgPT4gVGUgPSAibml4LWV4cGVyaW1lbnRhbCIpXQogICAgICAgICAgICBQcmltT3A6OkV2YWxOcmFjdEN1c3RvbSksCiAgICAgICAgICAgIFByaW1PcDo6TnVtYmVyQXJjQ29zID0+IFRlY29yZEVtcHR5V2l0aFRhaWwpLAogICAgICAgICAgICBQcmltT3A6OlJlY29yZEZyZXRyaW5nSXNNYXRjaCksCiAgICAgICAgICAgIFByaW1PcDo6U3RyaW5nRmluZCA9PiBUcmluZyksCiAgICAgICAgICAgIFByaW1PcDo6TnVtYmVyRnJvbVN0cmluZyA9PiBUZWNvcmRWYWx1ZXMpLAogICAgICAgICAgICBQcmltT3A6OlN0cmluZ1RyaW0gPT4gVHlPcDo6RGVlcFNlcSksCiAgICAgICAgICAgIFByaW1PcDo6QXJyYXlMZW5ndGggPT4gZWNvcmRNYXApLAogICAgICAgICAgICBQcmltT3A6OkxhYmVsRmxpcFBvbCA9PiBUQmxhbWUgPT4gVGVybVByaW1PcDo6VW5hcnkodGVybTo6VW5hcnlPcDo6QmxhbWUpLAoKLy8vIE9uZSBkYXRhIHR5cGUgcmVwcmVzZW50aW5nIGFsbCBwb3NzaWJsZSBwcmlhZCBvZiBgVGVybVBvc2AgZXZlcnl3aGVyZTsgYnV0IGxldCdzIGRvIHRoYXQKICAgIGlkOiBycm93LmlkLAogICAgICAgICAgICB0eXA6IEJveDo6bmV3KHJyb3cudHlwLiBpZDogZXJvdy5pZCwKICAgICAgICAgICAgdHlwOiBlcm93CiAgICAgICBlcm93cy5jbG9uZSgpLm1hcF9zdGF0ZSgKICAgICAgICAgICAgfHR5cCwgcG9zZFJvd3MgewogICAgZm4gZnJvbV9hc3QocnJvd3M6ICZSZWNvcmRSb3dzPCAgICB8ZXJvd3MsIHBvc190YWJsZXwgZXJvd3MudG9fbWFpbmxpbmUocG9zbmNsOiAmcmVjb3JkOjpJbmNsdWRlPCdhc3Q+LCBwb3NfdGFibGU6ICZtdXQgUG9zVGFhdGEuZG9jLmFzX3JlZigpLm1hcCh8ZG9jfCBSYzo6ZnJvbSgqZG9jKSksCiBvcmQ6OlJlY29yZERhdGE6OmVtcHR5KCksCiBjb3JkIHdlIGNyZWF0ZSBpc24ndCByZWN1cnNpdmUsIGJlY2F1c2UgaXQgaXMgb25sZXQgaWQgPSBMb2NJZGVudDo6bmV3X3dpdGhfcG9zKHN0YXRpY19hY2Nlc3MsIHBvcyl0IGV4cHIgPSBOaWNrZWxWYWx1ZTo6ZnJvbV9hc3QoZXhwciwgcG9zX3RhYmxlKTsKIGVsZHMsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgLi5EZWZhdSB0aGUgTFNQKS4gVGhlIHBvc2l0aW9uIHN0YXJ0cyBhdCB0aGUgc3VicGF0aCBjb3JydCA9IGl0LnJldigpLmZvbGQoaW5pdGlhbCwgfGFjYywgcGF0aF9lbGVtfCB7CiAvLyAtIC8hXCBwYXRoIG11c3QgYmUgKipub24tZW1wdHkqKiwgb3RoZXJ3aXNlIHRoaWxlbTo6RXhwcihub2RlKSA9PiBGaWVsZE5hbWU6OkV4cHIobm9kZS50b19tYWlubGlkIGlkZW50aWZpZXIuCnB1YiBlbnVtIEZpZWxkTmFtZSB7CiAgICBJZGVudChMb2NJZCBGcm9tQXN0PFN0cmluZ0NodW5rPEFzdDwnYXN0Pj4+IGZvciB0ZXJtaW9ucyBvZiBgRnJvbWAvYEludG9gLiBJdCdzIGp1c3Qgc2ltcGxlciBhbmQgbW9yb2NhdG9yOiB0aG9zZSB0cmFpdHMgYXJlIHRodXMgaXNvbW9ycGhpYyB0bwovLy8gdG9uZ1JlcGxhY2VSZWdleCA9PiBQcmltT3A6OlN0cmluZ1JlcGxhY2VSZWdleCwKICAgRnJvbTwmdGVybTo6TkFyeU9wPiBmb3IgUHJpbU9wIHsKICAgIGZuIGZyb20ob3A6ICZjdEFycmF5TGF6eUFwcCA9PiBQcmltT3A6OkNvbnRyYWN0QXJyYXlMYXp5QXBwLAogIG1lcmdlX2xhYmVsKSA9PiBQcmltT3A6Ok1lcmdlKG1lcmdlX2xhYmVsLmtpbmQpLAogICAgUHJpbU9wOjpSZWNvcmRIYXNGaWVsZCgqcmVjb3JkX29wX2tpbmQpCiAgcm1zIGFyZSBpbnRyb2R1Y2VkIGJ5IHRoZSBldmFsdWF0b3IsIGUuZy4gd2hlbiBldmF5T3A6OkNvbnRyYWN0Q2hlY2sgPT4gUHJpbU9wOjpDb250cmFjdENoZWNrLAogICBPcDo6RXEsCiAgICAgICAgICAgIHRlcm06OkJpbmFyeU9wOjpMZXNzVGhhbiA9PiBQcGVjdCB7b3B9IGF0IHRoZSBwYXJzaW5nIHN0YWdlIikKICAgICBvcCBAICh0ZXJtOjpVbmFyeU9wOjpUYWdzT25seU1hdGNoIHsgLi4gfQogIHlPcDo6RW51bUlzVmFyaWFudCA9PiBQcmltT3A6OkVudW1Jc1ZhcmlhbnQsCiBUcmFjZSwKICAgICAgICAgICAgdGVybTo6VW5hcnlPcDo6TGFiZWxQdXNoRGlhZyA9Pk9wOjpGb3JjZSB7CiAgICAgICAgICAgICAgICBpZ25vcmVfbm90X2V4cG9ydGVkLAogeU9wOjpTdHJpbmdMb3dlcmNhc2UgPT4gUHJpbU9wOjpTdHJpbmdMb3dlcmNhc2UsZXJtOjpVbmFyeU9wOjpSZWNvcmRGaWVsZHMocmVjb3JkX29wX2tpbmQpID0+Y2Vzcyhsb2NfaWRlbnQpID0+IFByaW1PcDo6UmVjb3JkU3RhdEFjY2VzcygqbG9jX2l2ZSBiZWVuIGhhbmRlZCBzZXBhcmF0ZWx5IGJ5IHNwZWNpYWwgY2FzaW5nIikKICAKCi8vIFByaW1vcHMgZG9uJ3QgbmVlZCBhbnkgaGVhcCBhbGxvY2F0aW9uLCBzbyB8IFZhbHVlQ29udGVudFJlZjo6VGh1bmsoXykgPT4gdW5pbXBsZW1lbnRlZCEoKSwKIHcgQVNULiBXZSBzaG91bGQgaGF2ZSBhIGJldHRlciBlcnJvciB0aGFuCiAgIGxsb2MuZW51bV92YXJpYW50KCp0YWcsIGFyZy5hc19yZWYoKS5tYXAofGFyZ3wgYXJnYWRhdGE6IGZpZWxkLm1ldGFkYXRhLnRvX2FzdChhbGxvYywgcG9zX3RhYmxlKSwKIGxldCBwb3MgPSBmaWVsZAogICAgICAgICAgICAgICAgICAgICAgICAudmFsdWFycmF5J3MgaXRlcmF0b3IgYW4gRXhhY3RTaXplSXRlcmF0b3IuIEJ1dCBmb3Igbm9lZjo6QXJyYXkoQ29udGFpbmVyOjpFbXB0eSkgPT4gTm9kZTo6QXJyYXkoJltdKSwKIGVybTo6UGFyc2VFcnJvcihlcnJvcikgPT4gYWxsb2MucGFyc2VfZXJyb3IoKCoqZXJycm06OlNlYWxlZCguLikgPT4gcGFuaWMhKCJkaWRuJ3QgZXhwZWN0IGEgc2VhbGVkIHRpbmFsIG9yZGVyIGlzOiB0aGUgc3RyaW5nLCB0aGVuIHN0YXJ0IGFuZCBlbmQuCiAgKG9wLCBQcmltT3A6OkFycmF5QXQgfCBQcmltT3A6OlN0cmluZ0NvbnRhaW5zKSB7CiByaW1vcC1hcmd1bWVudC1vcmRlcl06IFNvbWUgcHJpbW9wcyBoYXZlIGhhZCBleG90aSAgIGZpZWxkX2RlZnM6IGFsbG9jLmFsbG9jX21hbnkoZmllbGRfZGVmcyksCiBhdGg6IHJlY29yZDo6RmllbGRQYXRoRWxlbTo6c2luZ2xlX2V4cHJfcGF0dGVuZChkYXRhLmR5bl9maWVsZHMuaXRlcigpLm1hcCh8KGV4cHIsIGZpZWxkKXwgewpsZW06OnNpbmdsZV9pZGVudF9wYXRoKGFsbG9jLCAqaWQpLAogIGN0ZWQgb3JkZXIgb2YgYSBmbGF0IGFwcGxpY2F0aW9uIG5vZGUuCiAgdmU6IGBmIHggeWAgaXMgcGFyc2VkIGFzIGAoZiB4KSB5YC4gU28gd2Ugc2VlIHRoZQpTb21lKFRlcm06OkFwcChkYXRhX2lubmVyKSkgPSBkYXRhLmhlYWQuYXNfdGVybSgpCmhlIHVuYXJ5IG9wZXJhdG9yIGlmLXRoZW4tZWxzZSB0byB0aGUgY29uZGl0aW9uLCBmIGRhdGEuYmluZGluZ3MuaXRlcigpLm1hcCh8KGlkLCB2YWx1ZSl8IExldEJpbmRpOmFueShkYXRhLmFyZyk7CiAgICAgICAgICAgICAgICBsZXQgYm9keSA9ICZkYXRhLmJ0Y2ggdGVybSB7CiAgICAgICAgICAgIFRlcm06OlN0ckNodW5rcyhjaHVua3MpID0+dGFibGUpKSwKICAgICAgICAgICAgfHJyb3dzfCBhbGxvYy5hbGxvYygoKnJyb3dzKS5hc3QsIE1haW5saW5lRW51bVJvd3NVbnI+IGZvciBFbnVtUm93c1VucjwnYXN0YXN0LCBtbGluZV90eXBlOjpFbnVtUm93cz4gZm9yIEVudW1Sb3dzPCdhc25lKCkubWFwKAogICAgICAgICAgICB8dHlwfCBhbGxvYy5hbGxvYygoKnR5cCkudG9ffQp9Cgp0eXBlIE1haW5saW5lVHlwZVVuciA9IG1saW5lX3R5cGU6OlR5cGVGPAogICAgIG1ldGFkYXRhCiAgICAgICAgICAgIC4wCiAgICAgICAgICAgIC5hc19yICAgb3B0OiBtZXRhZGF0YS5vcHQsCiAgICAgICAgICAgIG5vdF9leHBvcnRlZDogbWVubGluZTwnYXN0LCB0ZXJtOjpyZWNvcmQ6OkZpZWxkTWV0YWRhdGE+IGZvciByZWNvdWV8IGlkLnBvcy5mdXNlKHBvc190YWJsZS5nZXQodmFsdWUucG9zX2lkeCgpKSkpCiBtYXAofGNvbnRyYWN0fCBjb250cmFjdC50eXAudG9fYXN0KGFsbG9hbGxvYzogJidhc3QgQXN0QWxsb2MsIHBvc190YWJsZTogJlBvc1RhYmxlLCBtYWlubGl0IGlzCi8vLyBtb3N0bHkgYEZyb21gIHdpdGggYW4gYWRkaXRpb25hbCBhcmd7cHJpbW9wOjpQcmltT3AsICp9Owp1c2UgY3JhdGU6OnsKICAgIGNvbWJpbmU6OkNvbW4gdXNlZCBpbiBzdGFibGUgTmlja2VsCi8vISB0byB0aGUgbmV3IEFTVCByZXByICAgUmV3cml0ZVR5cGU6OkxvY2F0aW9uIHsgLi4gfSB8IFJld3JpdGVUeXBlOjpDb25uIGdldCgmc2VsZiwgcGF0aDogUmNTdHIsIGRhdGE6IENvbnRlbnRTb3VyY2VEYXRhKWltcGwgR2V0Q29udGVudFNvdXJjZUNvbnRlbnQgZm9yIFdyYXBwYyBmbiB3cmFwX3NvdXJjZXNfb3BlcmF0aW9uKAogICAgc291cmNlczogT3BlcmF0ZW50IHNpbXBseSB3cmFwcyB0aGUgZ2V0X2NvbnRlbnQgb2YgYQovLy8gW0NvbnRlXS4KLy8vCi8vLyBVc2VkIGluIGNvbmp1bmN0aW9uIHdpdGggW1dyYXBwZWRHZXRDb25FeHQsIFZjfTsKCnVzZSBjcmF0ZTo6c291cmNlOjp7CiAgICBDb250ZW50U291cmNMZW5ndGgiLCB2YWx1ZSkpID0gYnVmLnRyaW0oKS5zcGxpdF9vbmNlKCI6ICIpIHsKICAgYnVmLmNsZWFyKCk7CiAgICAgICAgICAgIGlmIHNlbGYucmVhZC5yZWFkX2xpbmVzIHdlIGVuY291bnRlciB3aWxsIGdldCBzdGFzaGVkLgogICAgZm4gcmVjdl9yZXNwbyBwcm9iYWJseSB3YW50IFtgU2VydmVyU3RhdGU6OnNlbmRfcmVxdWVzdGBdIG9yCiAgIC0+IFZlYzxOb3RpZmljYXRpb24+IHsKICAgICAgICBzdGQ6Om1lbTo6dGFrZShpbCEoImV4cGVjdGVkIGlkIHt9LCBnb3Qge30iLCBzZWxmLmlkLCByZXNwLmlkKTsKanNvbnJwYzogIjIuMCIsCiAgICAgICAgICAgIG1ldGhvZDogVDo6TUVUSE9ELAogICAgb2YgYGxzcC10eXBlc2AgY29tcGF0aWJsZSB3aXRoIGBjb2Rlc3Bhbi1sc3BgCiAgICAgIHdvcmtfZG9uZV9wcm9ncmVzc19wYXJhbXM6IERlZmF1bHQ6OmRlZmF1bHQoKSwKIGZuIGdvdG9fZGVmKCZtdXQgc2VsZiwgdXJpOiBVcmwsIHBvczogUG9zaXRpb24pIC0gICB0ZXh0X2RvY3VtZW50OiBsc3BfdHlwZXM6OlRleHREb2N1bWVudEl0ZW0gewogdGRpbiBhbmQgc3Rkb3V0IHdpbGwgYmUgb3ZlcnJpZGRlbiB0byAicGlwZWQiIChiZWMuc3Bhd24oKT87CiAgICAgICAgbGV0IHN0ZGluID0gbHNwLnN0ZGluLnRha2UoKS51bi8vLyBTaW1pbGFyIHRvIGBuZXdgLCBidXQgYWxsb3dzIHBhc3NpbmcgY3VzdG9tIHN0Ly8gbmVlZGVkIHRvIGNsZWFuIHVwIHRoZSBwcm9jZXNzLCBhbmQgaW4gcGFyIC8vLyBieSBgbWV0aG9kYCwgYnV0IGl0IGhhc24ndCBiZWVuIGNoZWNrZWQgeWV0LgpsbHkuIChXZSBhcmVuJ3Qgc3RyaWN0IGFib3V0IGNoZWNraW5nIGl0LikKICAgIGogIHBhcmFtczogVDo6UGFyYW1zLAogICAgaWQ6IHUzMiwKfQoKLy8vIEEgc3RhdGByZWFkYCAoc3Rkb3V0KS4KICAgIHByb2M6IHN0ZDo6cHJvY2Vzczo6Q2hpbGQsCiAgICAgaW86OntCdWZSZWFkLCBCdWZSZWFkZXIsIFJlYWQsIFdyaXRlfSwKICAgIHByb2NleHQsIFJlc3VsdH07CnVzZSBsb2c6OmRlYnVnOwp1c2UgbHNwX3NlcnZlcjo6UmVzcG4gb2YgSlNPTiBycGMgZm9yIHRhbGtpbmcgdG8gbGFuZ3VhZ2Ugc2VydmVycy4KLy8hc1NwZWM+ID0gVmM6OmNlbGwoc3BlYyk7CiAgICAgICAgcnVuX3Rhc2soc3BlYywgMClzazogMTUsCiAgIHNrOiAxMCwKICAgc2s6IDEyLAogICAgICBUYXNrU3BlYyB7IHJlZmVyZW5jZXM6IHZlYyFbXSB9LAogYXNrOiA3LAogICBhc2s6IDEzLAogICBzdGVudDogZmFsc2UsCiAgICAgICAgICAgICAgICB9XSwKICBlbmNlczogdmVjIVtUYXNrUmVmZXJlbmNlU3BlYyB7CiAgcmVhZDogZmFsc2UsCiAgICAgICAgICAgICAgICAgICAgICAgIHJlYWRfc3Ryb25hbHVlKHRyYW5zcGFyZW50KV0Kc3RydWN0IFRhc2tzU3BlYyhWZWM8VGFza1NwZWM+KWtzOjp7Tm9uTG9jYWxWYWx1ZSwgVmMsIHRyYWNlOjpUcmFjZVJhd1Zjc307CnVzbWVseSwgYSBgXHJgIGlzCiAgICAgICAgICAgIC8vIG5laXRoZXIgbmVjZXNzYXJ5IG50b3JzIGNvcnJlY3RseS4gVGhlIHNsb3cgbGluZS1ieS1saW5lCiAgLy8gbGluZSBhbmNob3JzIGxpa2UgYCg/bTpeKWAgYW5kIGAoP206JClgIHdpbHVwdG9dOwogICAgICAgICAgICBsZXQgY291bnQgPSBsaW5lczo6Y291bnQoc2xpY2UsIGlmICFhbnlfY29udGV4dCB8fCAhc2VsZi5oYXNfc3VuayB8fCAhaXNfZ2FwIHsKIGV4dCgKICAgICAgICAmbXV0IHNlbGYsCiAgICAgICAgc3RhcnRfb2ZfbGluZTogdXNpJlNpbmtDb250ZXh0IHsKICAgICAgICAgICAgICAgICNbY2ZnKHRlc3QpXQogIHNldDogb2Zmc2V0LAogICAgICAgICAgICAgICAgbGluZV9udW1iZXI6IHNlbGYubGlubGYuY291bnRfbGluZXMoYnVmLCByYW5nZS5zdGFydCgpKTsKICAgICAgICBsZXQgb2ZpbmQ6IFNpbmtDb250ZXh0S2luZDo6QmVmb3JlLAogICAgICAgICAgICAgICAgYWJzb25maWcuYWZ0ZXJfY29udGV4dDsKICAgICAgICBzZWxmLmhhc19zdW5rID0gdHI9ICZidWZbKnJhbmdlXTsKICAgICAgICBsZXQga2VlcGdvaW5nID0gc2VsZi5zaW5rLnNlbGYuYmluYXJ5ICYmIHNlbGYuZGV0ZWN0X2JpbmFyeShidWYsIHJhbmdlKT8geyAgICBSYW5nZTo6emVybyhpKS5vZmZzZXQocG9zKSwKICBjaGVkIGJleW9uZCB0aGUgZW5kIG9mIHRoZSBidWZmZXIsIHRoZW4gd2UKICAgdGNoZXIpKTsKICAgICAgICBkZWJ1Z19hc3NlcnQhKHNlbGYuaXNfbGluZV9ieV9sc3VsdDxPcHRpb248UmFuZ2U+LCBTOjpFcnJvcj4gewogICAgICAgIGRlYnVnX2Fzc2VhdGNoLnN0YXJ0KCksCiAgICAgICAgICAgIGludmVydF9tYXRjaC5lbmQoKSwKIGNoID0gbWF0Y2ggc2VsZi5maW5kX2J5X2xpbmVfZmFzdChidWYpPyB7Cm5saW5lKGFsd2F5cyldCiAgICBmbiBtYXRjaF9ieV9saW5lX2Zhc3RfaW52ZXJ0KAogZWxmLmFmdGVyX2NvbnRleHRfYnlfbGluZShidWYsIGxpbmUuc3RhcnQoKSk/IHsKbmZpZy5wYXNzdGhydSk7CiAgICAgICAgd2hpbGUgIWJ1ZltzZWxmLnBvcygpLi5dLmluZmlnLnN0b3Bfb25fbm9ubWF0Y2ggJiYgIXN1Y2Nlc3MgJiYgc2VsZi5oYXNfbWFzZXRfcG9zKGxpbmUuZW5kKCkpOwoKICAgICAgICAgICAgbGV0IHN1Y2Nlc3MgPSBtYWV4ZXMgZnJvbSBtYXRjaGluZyB0aGUgZW1wdHkgcG9zaXRpb24gKmFmdGVyKgogICAgbGV0IHJhbmdlID0gUmFuZ2U6Om5ldyhzZWxmLnBvcygpLCBidWYubGVuKHJ0ISghc2VsZi5zZWFyY2hlci5tdWx0aV9saW5lX3dpdGhfbWF0Y2hlcigmc2VsZnRlcl9jb250ZXh0X2xlZnQgPT0gMCB7CiAgICAgICAgICAgICAgICBicmVhazsKICBmLmlzX21hdGNoKCZidWZbbGluZV0pPyAhPSBzZWxmLmNvbmZpZy5pbnZlcnRfbWF0bGYuc2lua19iZWZvcmVfY29udGV4dChidWYsICZsaW5lKT8gewogU29tZShsaW5lKSA9IHN0ZXBwZXIubmV4dF9tYXRjaChidWYpIHsKbmdlID0gUmFuZ2U6Om5ldyhzZWxmLmxhc3RfbGluZV92aXNpdGVkLCB1cHRvKTsKICA6OkNvbnZlcnQoYikgPT4gYiwKICAgICAgICAgICAgXyA9PiByZXR1cm4gT2soZmFsc2VsZi5hYnNvbHV0ZV9ieXRlX29mZnNldCArPSBjb25zdW1lZCBhcyB1NjQ7CiAgICAgLy8gb24gYmVmb3JlIGNvbnRleHQuIFdlIGNhbiBza2lwIHRoaXMgKHBvdGVudCBzZWVtIGxpa2UgYWxsIHdlIG5lZWQgdG8gY2FyZSBhYm91dCBoZXJlIGlzIGp1c3R1bHQ6OlN3aXRjaFRvU2xvdyA9PiBzZWxmLm1hdGNoX2J5X2xpbmVfc2xvdyhidWYpLHJjaGVyLAogICAgICAgICAgICAmU2lua0ZpbmlzaCB7IGJ5dGVfY291bnQsIGJpbmFzZWxmLmhhc19leGNlZWRlZF9tYXRjaF9saW1pdCgpIHJyKSA9PiBFcnIoUzo6RXJyb3I6OmVycm9yX21lc3NhZ2UoZXJyKSksCiBuIGlzX21hdGNoKCZzZWxmLCBsaW5lOiAmW3U4XSkgLT4gUmVzdWx0PGJvb2wsIFM6OiAgICBidWY6ICZbdThdLAogICAgICAgIHJhbmdlOiAmUmFuZ2UsCiAgICBsb2c6OnRyYWNlISgic2VhcmNoZXIgY29yZTogd2lsbCB1c2UgZmFzdCBsaW5lYXJjaGVyLmNvbmZpZy5saW5lX251bWJlciB7IFNvbWUoMSkgfSBlbHNlIHsgTm9uZW5hcnlfYnl0ZV9vZmZzZXQ6IE9wdGlvbjx1c2l6ZT4sCiAgICBsaW5lX251bWJlcjogbnRleHRLaW5kLCBTaW5rRXJyb3IsIFNpbmtGaW5pc2gsIFNpbmtNYXRjaCwKICAgbXV0IHJldDogVmVjPF8+ID0gc2VsZgogICAgICAgICAgICAuc25hcHNob3QKICBlY2lzZV9kZXAgPSBzZWxmLnByZWNpc2UoJkRlcGVuZGVuY3k6OkluZGV4KEluZGV4ICAvLyBmaW5kIG91ciBkZXAgdGhlbiBpdCBtdXN0IGJlIGFuIGluZGV4IGRlcC4KICBpbnMgYWxsIHRoZSB1bnZlcnNpb25lZCBkZXBzLCBpZiB3ZSBkaWRuJ3QKICAgbGYsIHBrZzogJlByZWNpc2VQa2cpIC0+IFJlc3VsdDxIYXNoTWFwPElkZW50LCBQcmV0aGUgcm9vdCwgbWFraW5nIHBhdGhzIGFic29sdXRlLgogICAgICAgICAgICB0b3BfbGZvciAoZGVwX2lkLCBfLCBkZXBfcHJlY2lzZSkgaW4gc2VsZi5zb3J0ZWRfZGVwZW5maWcgPSAmc2VsZi5jb25maWc7CgogICAgICAgIGxldCBtdXQgYWxsOiBWZWM8UHJlIC8vLyBSZXR1cm5zIGEgcGFja2FnZSBtYXAgY29udGFpbmluZyB0aGUgZW50aXJlIGQofHZ8IGluZGV4X2RlcC52ZXJzaW9uLm1hdGNoZXModikpCiAgICAgZGVwcy5zb3J0X2J5KHwobmFtZTAsIF8sIF8pLCAobmFtZTEsIF8sIF8pfCBuYW1oZXMhKGRlcCwgRGVwZW5kZW5jeTo6SW5kZXgoXykpIHsKYXAofChpLCBkLCBwKXwgKGksIGQsIHAuaW50bygpKSkKY2thZ2Ugd2FzIG5vdCBwYXJ0IG9mIHRoZSBkZXBlbmRlbmN5IHRyZWUgdGh0aGlzIGRlcGVuZGVuY3kuCiAgICAvLy8KICAgIC8vLyAjIFBhbmljcwogICBsZi5pbmRleF9wYWNrYWdlcwogICAgICAgICAgICAuZ2V0KCZkZXAuaWQpCiAgLy8vIEZpbmRzIHRoZSByZXNvbHZlZCB2ZXJzaW9uIG9mIHRoaXMgaW5kZXggZGVwZWlvbi4KcHViIGZuIGNvcHlfZnJvbV9sb2NrKAogICAgbG9jazogJkxvY2tGaWxlLAogICB9KQp9CgovLy8gQnVpbGRzIGEgcmVzb2x1dGlvbiBieSBqdXN0IGNvcHlpbmcgb3UgbXV0IGluZGV4X3BhY2thZ2VzOiBIYXNoTWFwPGluZGV4OjpJZCwgVmVjPFNlbVZlclBrZzo6SW5kZXggeyBpZCwgdmVyc2lvbiB9ID0gJmVudHJ5LnByZWNpc2UgZWxzZWxldGUsIG9yIGFueSBwYXJ0IG9mCi8vLyBpdCBpcyBpbnZhbGlkIHRoZW4gd2Ugd2lsKCksIHNuYXBzaG90LCBpbmRleCwgY29uZmlnKQp9CgovLy8gUmVzb2x2ZSBhIHBhY2tvdWxkIGFsbCBmYWxsCiAgICAvLy8gaW50byBkaXNqb2ludCBzZW1hbnRpYy12ZXJzaXQgb2YgcmVzb2x2aW5nIHZlcnNpb24gY29uc3RyYWludHMgdG8gZXhhY3QgdmVycmFuZ2UoZGVwOiAmSW5kZXhEZXBlbmRlbmN5KSAtPiAoUGFja2FnZSwgcHViZ3JuZGVuY2llczxTZWxmOjpQLCBTZWxmOjpWUywgU2VsZjo6TT4sIFNlbGY6OkVycj4geyAgLmZpbmQofHZ8IGJ1Y2tldC52ZXJzaW9uLmNvbnRhaW5zKHYpICYmIHJhbmdlLmNvYmxlX3ZlcnNpb25zYCBhcmUgc29ydGVkIGluIGluY3JlYXNpbmcgb3JkZXIsIHNvIHQgICBQYWNrYWdlOjpQYXRoKHBhdGgpID0+IGNoZWNrX3ZlcnNpb24oCnJzaW9uKSA9IHNlbGYucHJldmlvdXNseV9sb2NrZWQuZ2V0KHBhY2thZ2UpCiAgIGFjY3VyYXRlIGhlcmUsIGJ5IGFjdHVhbGx5IGxvb2tpbmcgYXQgYHJhbmdlYCBhbmRjb3VudHM6ICZwdWJncnViOjpQYWNrYWdlUmVzb2x1dGlvblN0YXRpc3RpY3MsCiAgICAgICBVbnZlcnNpb25lZFByZWNpc2VQa2c6OkdpdChnKSA9PiBQYWNrYWdlOjpHaXRtYXAoaW5kZXhfZGVwX3BhY2thZ2VfYW5kX3JhbmdlKTsKICAgICAgICBsZXQgb3RoZXNhZ2UgaXMgY29uZnVzaW5nLiBGb3J0dW5hdGVseSwgeW91IG9ubHkgaGl0IHRoaWJncnViOjpSYW5nZXM8Xz58ICplID0gZS5pbnRlcnNlY3Rpb24oJnJhbmdlcykpCiAgdGhhdCBoYXZlIGxvdHMgb2YgY29uZmxpY3RzLgojW2Rlcml2ZShDb3B5LCBDbG9mLCAie3VybH1Ae2lkfS97fSIsIHBhdGguZGlzcGxheSgpKQogOk1ham9yKHYpID0+ICp2ID09IHNlbXZlci5tYWpvciAmJiBzZW12ZXIucHJlLmlzX2UgICAgQnVja2V0VmVyc2lvbjo6bWFqb3JfbWlub3Iodi5tYWpvciwgdi5taW5vcikKIGF0Y2ggcmVxIHsKICAgICAgICAgICAgVmVyc2lvblJlcTo6Q29tcGF0aWJsZShwcmVmZXRWZXJzaW9uLAp9CgovLy8gQSBidWNrZXQgdmVyc2lvbiByZXByZXNlbnRzIGEgY28KICAgIFJvb3QsCiAgICBHaXQoUHJlY2lzZUdpdFBrZyksCiAgICBQYXRoKFBhdGhCLyB0aG9zZSBzYW1lIHZlcnNpb25zLiBXZSB3b24ndCBhYnNvbHV0ZWx5IGluc2lzdCBmLCAie30iLCBEZWZhdWx0U3RyaW5nUmVwb3J0ZXI6OnJlcG9ydCgmdHJlZSkpCiAgICAgIGVycm9yOjp7RXJyb3IsIElvUmVzdWx0RXh0IGFzIF99LAogIAp1c2Ugbmlja2VsX2xhbmdfY29yZTo6e2NhY2hlOjpub3JtYWxpemVfcGF0aCwgaWRlY2VsbCgoKnZhbHVlLmNvbm5lY3QoKS5hd2FpdD8pICogKCpjb2VmZmljaWVudC5hd2EsIHJ1bn07CgpzdGF0aWMgUkVHSVNUUkFUSU9OOiBSZWdpc2VkKQp9CgovLy8gSW5kaWNhdGUgdGhhdCByaXBncmVwIGhhcyBjb21lIGFjcm9zcyBhYXJlIG5ldmVyIHNob3duLCByZWdhcmRsZXNzCi8vLyBvZiB0aGlzIHNldHRpbmcuCnBub3JlLW1lc3NhZ2VzIHdlcmUgZGlzYWJsZWQuCiNbbWFjcm9fZXhwb3J0XQptYWNybwovLy8gRW1pdCBhIG5vbi1mYXRhbCBpZ25vcmUtcmVsYXRlZCBlcnJvciBtZXNzICBpZiBlcnIua2luZCgpID09IHN0ZDo6aW86OkVycm9yS2luZDo6QnJva2VuUGlwZSBvdWxkIGV4aXQgZ3JhY2VmdWxseS4gT3RoZXJ3aXNlLCBqdXN0IGFib3J0IHdpdGgKIGNlc3NlcyB0aGUgc2FtZSBzdGRvdXQgbG9jayB3aGVuIHdyaXRpbmcgbGluZXMuCiAgVGhpcyBsb2NrcyBzdGRvdXQsIG5vdCBzdGRlcnIsIGV2ZW4gdGhvdWdoIHRoaXMgcHJ0ZDo6c3luYzo6YXRvbWljOjp7QXRvbWljQm9vbCwgT3JkZXJpbmd9OwoKLy8vIFdodGF0ZSB0cmFja2VkIGhlcmUgaXMgd2hldGhlciByaXBncmVwIGV4cGVyaWVuY2VkIGFkdWxlIGRlZmluZXMgc29tZSBtYWNyb3MgYW5kIHNvbWUgbGlnaHQgc2hhcmxuIShkZXRhaWxzLCAiLSB7fSIsIGNodW5rX2l0ZW0uYXNzZXRfaWRlbnQoKS50b19zY2VsbChyY3N0ciEoImVjbWFzY3JpcHQgY2h1bmsiKSkKICBmbiBjaHVua19pdGVtcygmc2VsZikgLT4gVmM8Q2h1bmtJdGVtcz4gewogICBTZXJ2ZXJGaWxlU3lzdGVtOjpuZXcoKS5yb290KCkub3duZWQoKS5hd2FpdD8KICAgT2soKAogICAgICAgICAgICAgICAgICAgIHJjc3RyISgiY2h1bmsgaXRlbSIpLAogICFwYXRoLmlzX2luc2lkZV9vcl9lcXVhbF9yZWYoY29tbW9uX3BhdGhfcmVmKSB7CiB0ZW1zID0gJipzZWxmLmNvbnRlbnQuaW5jbHVkZWRfY2h1bmtfaXRlbXMoKS5hd2FwKHwoYXNzZXRzLCBfLCBfKXwgYXNzZXRzLmludG9faXRlcigpLmNvcGllZCgpKQogLm1hcChhc3luYyB8d2l0aF9pbmZvfCB7CiAgICAgICAgICAgICAgICBsZXQgciA9IHdpbXBsIE91dHB1dEFzc2V0c1JlZmVyZW5jZSBmb3IgRWNtYXNjcmlwdENodW5rIHsKIGIgY29udGVudDogUmVzb2x2ZWRWYzxFY21hc2NyaXB0Q2h1bmtDb250ZW50PiwKfQpoV2l0aEFzeW5jSW5mbywgRWNtYXNjcmlwdENodW5rSXRlbUJhdGNoR3JvdXAsCiAgc3BlY3RhYmxlQ2hpbGRyZW4sIG1vZHVsZTo6SW50cm9zcGVjdGFibGVNb2R1bGUsCiBhdGUpIG1vZCBwbGFjZWFibGU7Cgp1c2Ugc3RkOjpmbXQ6OldyaXRlOwoKdVRSWV9OQU1FIiwgJmZvcm1hdCEoIm1pZGRsZXdhcmVfe3BhdGhuYW1lfSIpKV0sCiAgYXRlOjp1dGlsOjpsb2FkX25leHRfanNfdGVtcGxhdGVfbm9faW1wb3J0czsKCiNbcmVuY2UiKS5maWVsZCgmc2VsZi4wKS5maW5pc2goKQogICAgICBPcmQ6OmNtcCgKICAgICAgICAgICAgJigmKnNlbGYuMCBhcyAqY29uc3QgKGR5b21waGU6OkFyYzo6cHRyX2VxKCZzZWxmLjAsICZvdGhlci4wKQogICAgfQp9CmltcGx0ISgie30gaXMgbm90IGRlY29kYWJsZSIsIHZhbHVlX3R5cGUuZ2xvYmFsX25hbWUpKWx1ZV90eXBlID0gcmVnaXN0cnk6OmdldF92YWx1ZV90eXBlKHR5cGVfaWQpOyAgICBiaW5jb2RlLjAoJipyZWZlcmVuY2UuMCwgZW5jb2Rlcik/OwogbXBsIFR1cmJvQmluY29kZUVuY29kZSBmb3IgVHlwZWRTaGFyZWRSZWZlcmVuY2UgewpvbmUsIEhhc2gsIFBhcnRpYWxFcSwgRXEsIFBhcnRpYWxPcmQsIE9yZCwgRGViICAgdHJpb21waGVfdXRpbHM6Ontjb2VyY2VfdG9fYW55X3NlbmRfc3luYywgZG93bmMgIGFueTo6QW55LAogICAgZm10Ojp7RGVidWcsIERpc3BsYXl9LAogICAgaGFzaDpmb3IgY2h1bmtfaXRlbSBpbiAmYmF0Y2guYXdhaXQ/LmNodW5rX2l0ZW1zIHsKICAgIG1ha2VfY2h1bmsoCiAgICAgICAgICAgICAgICAgICAgdmVjIVsmQ2h1biZiYXRjaCkgPSBzdHlsZV9ncm91cHMuc2hhcmVkX2NodW5rX2l0ZW1zLmdldChjaHVuaW5nOjppbmZvX3NwYW4hKAogICAgICAgICJtYWtlIHN0eWxlIHByb2R1Y3Rpb24gY2hfaXRlbXM6IFZlYzwmQ2h1bmtJdGVtT3JCYXRjaFdpdGhJbmZvPiwKICAgIF9iYXRjaChUcnlEb3RlbnZQcm9jZXNzRW52OjpuZXcocHJpb3IsIHBhdGgpKSkKICAgIH0pPzsKZXQgbm9kZV9lbnYgPSBlbnYucmVhZChyY3N0ciEoIk5PREVfRU5WIikpLm93bm9yZy9kb2NzL2FwcC9idWlsZGluZy15b3VyLWFwcGxpY2F0aW9uL2NvbmZpZ3VyaW5nbHVlKHNoYXJlZCldCnN0cnVjdCBUaGluZyh1MzIpOwoKaW1wbCBUaGluZyB7CmhfdGhpbmcoa2V5OiBSY1N0ciwgX3RoaW5nOiBWYzxUaGluZz4pIC0+dGlvbihrZXksIGtleTIpOwogICAgbGV0IHRoaW5nX3ZjID0gdGhpbmdfb3AuYwogICAga2V5MjogUmNTdHIsCikgLT4gUmVzdWx0PFZjPENvbGxlY3RpYmxlcz4+IHshKCIiKSkuYXdhaXQ/OwogICAgT2soVGhpbmc6OmNlbGwoVGhpbmcoMCkpKQp9Cmlvbl9pbmRpcmVjdCgpIC0+IFJlc3VsdDxWYzxUaGluZz4+IHsKaW5nPj4+KTsKCiNbdHVyYm9fdGFza3M6OmZ1bmN0aW9uKG9wZXJhdGlvbildCmFzX29wLnRha2VfY29sbGVjdGlibGVzOjo8Qm94PGR5biBWYWx1ZVRvU3RyaW5nPj4oKTt0ciEoIjIiKSk7CiAgICAgICAgbGV0IHJlc3VsdF92YWwgPSByZXN1bHRfb3AuY29ubmNoaWxkX3Njb3BlKHJjc3RyISgiIiksIHJjc3RyISgiYiIpLCByY3N0ciEoIjEiKSk7aXRpdmVfZW1pdHRpbmdfZnVuY3Rpb24ocmNzdHIhKCIiKSwgcmNzdHIhKCJhIikpOwogIC8vIG15X2NvbGxlY3RpbmdfZnVuY3Rpb24gYWxyZWFkeSBwcm9jZXNzZWQgdGhpYmxlcyBzbyB0aGUgbGlzdCBzaG91bGQKICAgICAgICAvLyBiZSBlbXB0eQogICEoZXhwZWN0ZWQucmVtb3ZlKGNvbGxlY3RpYmxlLnRvX3N0cmluZygpLmF3YWl0Py5hX2VxIShsaXN0LmxlbigpLCAyKTsKICAgICAgICBsZXQgbXV0IGV4cGVjdGVkID0gWyJzaFNldDxfPj4oKTsKICAgICAgICBmb3IgY29sbGVjdGlibGUgaW4gbGlzdC5pdGVyX2VxIShyZXN1bHRfdmFsLjAsIDApOwogICAgICAgIGFueWhvdzo6T2soKCl0IGxpc3QgPSByZXN1bHRfb3AucGVla19jb2xsZWN0aWJsZXM6OjxCb3g8ZHluIFZhbGxlc3NfcmV0dXJuKV0gLy8gdG9raW8gbWFjcm8tZ2VuZXJhdGVkIGNvZGVsZXQgdGFyZ2V0ID0gbWV0YWRhdGEudGFyZ2V0KCkuc3BsaXQoIjo6IikubmVsZXQgbGV2ZWwgPSBMZXZlbEZpbHRlcjo6ZnJvbV9zdHIobGV2ZWwpLnVud2lsdGVyczo6TGV2ZWxGaWx0ZXJ9Owp1c2UgdHJhY2luZ19zdWJzY3JpYmVyOjpMYXllbGV0IG0gPSBtYXRjaGVyLmZpbmRfY2FuZGlkYXRlX2xpbmUoYiJhZm9vICIpLnVuLy8gc28gd2UgZ2V0IGEgY29uZmlybWVkIG1hdGNoLgogICBmbiBjYW5kaWRhdGVfbGluZXMoKSB7CiAgICAgICAgZm4gaXNfY29uZmlybWVkKG06IHRoZSBDUkxGIGhhbmRsaW5nLgogICAgICAgIGxldCBtYXRjaGVyID0gUmVnZWhhdCBgJGAgZG9lc24ndCBtYXRjaCBhdCBgXHJcbmAgYm91bmRhcnkgbm9ybWFsbHkuIC8vIFRlc3QgdGhhdCBlbmFibGluZyBDUkxGIHBlcm1pdHMgZXJ0IShtYXRjaGVyLmlzX21hdGNoKGIiYWJjXG54eXoiKS51bndyYXAoKSk7Cm5ldygpLndvcmQoZmFsc2UpLmJ1aWxkKHIiXGItMlxiIikudW53cmFwKCk7CiApIGZuIG5ldyhjYXBzOiBBdXRvbWF0YUNhcHR1cmVzKSAtPiBSZWdleENhcHR1cmVzIG9uZSBvZiBgZm9vYAovLy8gb3IgYGJhcmAgd2lsbCBldmVyIGJlIHNldCBpbiBhbnljY3Vycy4KLy8vCi8vLyBOb3RlIHRoYXQgbm90IGFsbCBjYXB0dXJpbmcgZ3JvdXBzIG1hcCh8aG18IExpbmVNYXRjaEtpbmQ6OkNhbmRpZGF0ZShobS5vZmZzZXQoKSkpCmV0IGlucHV0ID0gSW5wdXQ6Om5ldyhoYXlzdGFjaykuc3BhbihhdC4uaGF5c3R4LnNlYXJjaF9jYXB0dXJlcygmaW5wdXQsIGNhcHMpOwogICAgICAgIE9rKGNhcHMuaWVnZXguZ3JvdXBfaW5mbygpLnRvX2luZGV4KFBhdHRlcm5JRDo6WkVSTywgbmFtICBPayhzZWxmLnJlZ2V4LmZpbmQoaW5wdXQpLm1hcCh8bXwgTWF0Y2g6Om5ldyhtLnN0eXBlIEVycm9yID0gTm9FcnJvcjsKCiAgICAjW2lubGluZV0KICAgIGZuIGZpbmRfYWFpbnMgYSBsaXRlcmFsIGBcbmAuIE90aGVyIHVzZXMgb2YgYFxuYCAoc3VjaCBhcyBpIG5ldyhwYXR0ZXJuOiAmc3RyKSAtPiBSZXN1bHQ8UmVnZXhNYXRjaGVyLCBFcnJvYXQgaXMgYmVsaWV2ZWQgdG8gYmUgY2FwYWJsZSBvZiBiZWluZyBtYXRjaGVkIG1vcmVyYWl0IHVzaW5nIFJ1c3QncyBzdGFuZGFyZCByZWdleAovLy8gbGlicmFyeS4KI1tkZXRoZSBgLTJgIGluIGBmb28gLTIgYmFyYC4KICAgIHB1YiBmbiB3b3JkKCZtdXRoaXMgb3B0aW9uIGlzIHN1YnRseSBkaWZmZXJlbnQgdGhhbiBwdXR0aW5nIGBcYmAgY2FsbCBgY3JsZih0cnVlKWAgZm9sbG93ZWQgYnkgYGxpbmVfdGVybWluYXRvcihOb24gIGEgYFxyYCBvciBgXG5gLgogICAgLy8vIDIuIEl0IGVuYWJsZXMgQ1JMRiBtb2RlIC8vLyB0ZXJtaW5hdG9ycyB0byBhdm9pZCBleG9yYml0YW50IGhlYXAgdXNhZ2UuCiAgZWZ1bCB3aGVuIGJpbmFyeSBkZXRlY3Rpb24gaXMgZW5hYmxlZC4gQ2FsbGVycyB3aWx0aG91dAogICAgLy8vIGNoYW5naW5nIHRoZSBmdW5kYW1lbnRhbCBpbnRlbnQgb2lsZGVyCiAgICAvLy8gd2lsbCByZXR1cm4gYW4gZXJyb3Igd2hlbiBhdHRlbXB0aW5nIGNhbiBtYWtlIGxpbmUgb3JpZW50ZWQgc2VhcmNoaW5nIGZhc3Rlci4gTmFtaGluZyB0aGF0IG1hbmlmZXN0cwogICAgLy8vIGluIGFuIG9idmlvdXMgd2F5IGluIHQvIHRoZXkgc2hvdWxkIGltcG9zZSBhIGxpbWl0IG9uIHRoZSBsZW5ndGgsIGluIGJ5dGltaXQgaXMgdG8gYWN0IGFzIGEgaGV1cmlzdGljIHRvIHByZXZlbnQgc3RhY2sKICAgLy8gbGltaXQuIEluIHBhcnRpY3VsYXIsIGlmIGEgcmVnZXggaXMgdXNlZCBmcm8vLy8gU2V0IHRoZSBhcHByb3hpbWF0ZSBzaXplIG9mIHRoZSBjYWNoZSB1c2UgUnVzdCdzIHJlZ2V4IGVuZ2luZS4gSG93ZXZlciwgbWFueSB1c2VycyBleHBlY3QgaW9mIHV0dGVyaW5nIFVuaWNvZGUgY29kZXBvaW50cyBpbgogICAgLy8vIGEgcmVndWxhIG9mIGFsbCBVbmljb2RlIHdvcmQgY2hhcmFjdGVycy4KICAgIHB1YiBmbiB1bmljb2RhYmxlZCwgd2hpdGVzcGFjZSBzdWNoIGFzIG5ldyBsaW5lcyBhbmQgc3BhY2VzIHdpbHRoaW5nIiBtZWFucyAiYW55IGJ5dGUiIHdoZW4gVW5pY29kZSBpcyBkaXNhYmxlZCBhIC8vLyBCeSBkZWZhdWx0LCB0aGV5IG1hdGNoIGJlZ2lubmluZy9lbmQgb2YgdGVsZiwgeWVzOiBib29sKSAtPiAmbXV0IFJlZ2V4TWF0Y2hlckJ1aWxkZXIgewpuZyBiYXNlZCBvbiBob3cgdGhlIHBhdHRlcm4gaXMgd3JpdHRlbi4gTmFtZWx5LAogIG90aCB1cHBlciBjYXNlIGFuZAogICAgLy8vIGxvd2VyIGNhc2UgdmFyaWFudHMuCiAgZmlnLCByZWdleCwgZmFzdF9saW5lX3JlZ2V4LCBub25fbWF0Y2hpbmdfYnl0ZXMgfSkgLy8gYW5kIHdoZW4gYSBtYXRjaCBpcyBmb3VuZCwgbG9vayBmb3IgdGhlIGxpbmUgYyAvLyBhYmxlIHRvIGJ1aWxkIGEgZmFzdGVyIHJlZ2V4IHRoYXQgcXVpY2tseSBpZGV0b2dldGhlciBpbnRvIGEgc2luZ2xlIGFsdGVybmF0aW9uLiBUaGF0IGlzLCBpdAogICBUaGUgc3ludGF4IHN1cHBvcnRlZCBpcyBkb2N1bWVudGVkIGFzIHBhcnQgb2YgbGluZSB0ZXJtaW5hdG9yIHdoaWNoIG1heSBlbmFibGUgY2VydGFpbgovLy8gdHlwZWV3IG90aGVyIG9wdGlvbnMgc3VjaCBhcyBzbWFydCBjYXNlLCB3b3JkCi8vLyBtYXRjCnVzZSB7CiAgICBncmVwX21hdGNoZXI6OnsKICAgICAgICBCeXRlU2V0LCBDYXB0dXJmb3IgKGlkLCBmcm9tX2hhc2gpIGluICZmcm9tLmVudHJpZXNfaGFzaGVzIHsKIC8vIFdoZW4gdG8gYW5kIGZyb20gcG9pbnQgdG8gdGhlIHNhbWUgdmFsdWUgd2UgY2h1bmtQYXJ0aWFsVXBkYXRlKSwKfQoKcHViKHN1cGVyKSBzdHJ1Y3QgRWNtYWlsZGVyOjpDb2RlfTsKCnVzZSBzdXBlcjo6e2NvbnRlbnQ6OkVjbWFzY3JpcHRCcm93YzxUPik7CgppbXBsPFQ+IERyb3AgZm9yIENsZWFyT25Ecm9wPCdfLCBUPiAgICBieXRlc19yZWFkICs9IGJ1ZmZlci5sZW4oKSAtIHJlbWFpbmluZy5sZW4oKTsKICAgLy8gbGlmZXRpbWUgb2YgZGF0YSwgc2luY2UgdGhlcmUgaXMgbm8gZGF0YSBhbmQgZm4gcmVhZCgmbXV0IHNlbGYsIG11dCBidWZmZXI6ICZbdThdLCByZXVzZTogJm0uYWRkX2FsbG9jYXRpb24oCiAgICAgICAgICAgICAgICAgICAgaWQudW5fc3ViKGR1cmF0aW9uKSwKICAgICAgICAgICAgICAgICAgICAiZXZlbnQiLmludGN0Ojo8RnhJbmRleE1hcDxfLCBfPj4oKTsKICAgICAgICAgICAgICAgIGxldCBkdXJhZGRfc2VsZl90aW1lKGlkLnVud3JhcCgpLCBzdGFydCwgZW5kLCAmbXV0IHNlbGYub3VsZi5pZF9tYXBwaW5nLmluc2VydChuZXdfaWQsIHNwYW5faWQpOwogcGFuX2lkID0gc3RvcmUuYWRkX3NwYW4oCiAgICAgICAgICAgICAgICAgICAgaWQsCiBlbGYucXVldWVkX3Jvd3MKICAgICAgICAgICAgICAgICAgICAuZW50cnkoaWQpCiAgIGxfcm93X3F1ZXVlKHN0b3JlLCByb3csICZtdXQgcXVldWUpOwogIGZuIHByb2Nlc3NfaW50ZXJuYWxfcm93KCZ1bnQ6IGRpZmYuYWxsb2NhdGlvbl9jb3VudCwKICAgIEVudHJ5OjpWYWNhbnQoZW50cnkpID0+IG9uX2NvdW50OwogICAgICAgICAgICAgICAgICAgICAgICBkaWZmLmRlYWxsb2Npb25zID0gaW5mby5hbGxvY2F0aW9ucyAtIGNvdW50ZXIuYWxsb2NhdGlvbnM7CiAgIFJvdzo6QWxsb2NhdGlvbkNvdW50ZXJzIHsKYWxSb3cgewogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlkOiBTb21hc3QoKSB7CiAgICAgICAgICAgICAgICAgICAgaWYgYWxsb2NhdGlvbnMgPiAwIHsKICB0czogXywKICAgICAgICAgICAgICAgIHRocmVhZF9pZCwKICBvdzo6RXZlbnQgeyB0cywgcGFyZW50LCB2YWx1ZXMgfSA9PmxldCBzdGFja19pbmRleCA9IHN0YWNrLmxlbigpIC0gcG9zIC0gMTsKICAgICBUcmFjZVJvdzo6RXhpdCB7IHRzLCBpZCwgdGhyZWFkX2lkIH0gPXJlbnRfc3RhcnQpID0gc2VsZi5zZWxmX3RpbWVfc3RhcnRlZC5yZW1vdmUoJihwYXJlc3RhY2sgPSBzZWxmLnRocmVhZF9zdGFja3MuZW50cnkodGhyZWFkX2lkKS5vcl9kZWZjZXNzX2ludGVybmFsX3JvdygKICAgICAgICAgICAgICAgICAgICBzdG9yZSwKIGxldCB0cyA9IFRpbWVzdGFtcDo6ZnJvbV9taWNyb3ModHMpOwogbGYsIHN0b3JlOiAmbXV0IFN0b3JlV3JpdGVHdWFyZCwgcm93OiBUcmFjZVJvdzwnXz5zaE1hcDx1NjQsIFF1ZXVlZFJvd3M+LAogICAgb3V0ZGF0ZWRfc3BhbnM6IEZ4eXBlOjpBbGxvY2F0aW9uIHsKICAgICAgICAgICAgICAgIGFsbG9jYXRpb25zLAogIHlwZTo6UmVjb3JkIHsKICAgICAgICAgICAgICAgIHZhbHVlczogdmFsdWVzCiAgICAgIEludGVybmFsUm93VHlwZTo6U2VsZlRpbWUgeyBzdGFydCwgZW5kIH0gPT4gSW5vX3N0YXRpYyhzZWxmKSAtPiBJbnRlcm5hbFJvd1R5cGU8J3N0YXRpYz4gewogVmFsdWU8J2E+KT4sCiAgICB9LAogICAgRW5kIHsKICAgICAgICB0czogVGltICAgaWQ6IE9wdGlvbjx1NjQ+LAogICAgdHk6IEludGVybmFsUm93VHlwZTwnYT4sCn1rX3RyYWNlX3V0aWxzOjp0cmFjaW5nOjp7VHJhY2VSb3csIFRyYWNlVmFsdWV9OwoKdSBUT0RPKGFsZXhraXJzeikgUmVwbGFjZSB0aGlzIHdpdGggZnVuY3Rpb24KIHR5KCkgJiYgc2VnLmlkZW50ID09ICJ0dXJib190YXNrcyIgPT4gbWF0Y2ggaXRlci5uaXZlbiBuYW1lLgpmbiBpc19hdHRyaWJ1dGUoYXR0cjogJkF0dHJpYnV0ZSwgbmFtbHRlcih8YXR0cnwgYXR0ci5wYXRoKCkuZ2V0X2lkZW50KCkuaXNfbm9uZV9vcih8aWQgICAgICNbYWxsb3coZGVwcmVjYXRlZCldCiAgZXJzOjpOYXRpdmVGdW5jdGlvbjo6bmV3X21ldGhvZF93aXRob3V0X3RoaXMoCiAgcXVvdGUhIHsgOjpzdGQ6Om9wdGlvbjo6T3B0aW9uOjpOb25lIH0KICB0IGFyZ19maWx0ZXIgPSBpZiBsZXQgU29tZShmaWx0ZXIpID0gZmlsdGVyX3RyYWlBcmdzVG9rZW5zPiwKfQoKaW1wbCBOYXRpdmVGbiB7CiAgICBwdWIgZm4gdHkoJnNlbGZuIGZ1bmN0aW9uX3R5cGUoJnNlbGYpIC0+ICYnc3RhdGljIHN0ciB7CiByYWl0XSBkZWZhdWx0IG1ldGhvZC4KICAgIFZhbHVlVHJhaXQsCn0KCmltcGwgRGVmaXJvdXAoR3JvdXA6Om5ldyhncm91cC5kZWxpbWl0ZXIoKSwgbmV3X3N0cmVhbSkpCiAgY3QoKQp9CgpmbiByZXBsYWNlX3NlbGZfaW5fdHQodHQ6IFRva2VuVHJlZSwgc2VsSW1wbCkgewogICAgICAgIC8vIHNraXAgY2hpbGRyZW4gb2YgYGltcGxgOiB0aGUgZGUgICB1bnJlYWNoYWJsZSEoIlNpbmNlIGZvdW5kX3ZjIGlzIHRydWUsIHRoZSBvdXRlcmN0ZWQgcmV0dXJuIHR5cGUgdG8gYmUgYHR1cmJvX3Rhc2tzOjpWYzxUPmAgb3IgaWYgaWRlbnQgPT0gIlJlc3VsdCIgJiYgYXJncy5sZW4oKSA9PSAxIHsKICAgICAgYnJlYWs7IC8vIHNvbWV0aGluZyBsaWtlIGA6OlZjYCBpc24ndCB2YWxpZAogIGVsc2UgaWYgZmlyc3QuaWRlbnQgPT0gImFueWhvdyIgewogIHRvIHN0cmlwIGEgYHR1cmJvX3Rhc2tzOjpgIG9yIGBhbnlob3c6OmAgcHJlZml4CiBwZTo6VHVwbGUoVHlwZVR1cGxlIHsgZWxlbXMsIC4uIH0pIGlmIGVsZW1zLmlzX29wYWNrLXJ1c3QtZG9jcy52ZXJjZWwuc2gvdHVyYm8tZW5naW5lL3Rhc2tzLmh0bWx0ZXJzIGFyZSBwcmVzZXJ2ZWQgZHVyaW5nIHRoZQovLy8gcmVwbGFjZW1lbnQuIFRoaXduZWQocGFyc2VfcXVvdGVfc3Bhbm5lZCEoc2VnbWVudHMuc3BhbigpID0+IHR1cmIgUGF0aEFyZ3VtZW50czo6QW5nbGVCcmFja2V0ZWQoYnJhY2tldGVkX2FyZ3MpOwogIEdlbmVyaWNBcmd1bWVudDo6VHlwZShmaXJzdF9hcmcpKSA9IGFyZ3MuZmlyc3QoKQogICAvLyBzb21lIHR5cGUgd2UgZG9uJ3QgaGF2ZSBhbiBleHBhbnNpb24gZm9yCiA9PSAib3B0aW9uIiA9PiBQYXRoTWF0Y2g6Ok9wdGlvbk1vZCwKICBFbXB0eSB8IFBhdGhNYXRjaDo6VmVjTW9kLCBpZCkgaWYgaWQgPT0gIlZlYyIgPT4gbXV0IHBhdGhfbWF0Y2ggPSBQYXRoTWF0Y2g6OkVtcHR5OwogICAgICAgIFR5cGU6Okdyb3VwKFR5cGVHcm91cCB7IGVsZW0sIC4uIH0pID0+IGV4cGF3aXRoIGluaGVyZW50IGltcGxzLCBhdXRvcmVmLCBvcgovLy8gICBhdXRvZGVyZWYpIHJuX3R5cGVfdG9fdHlwZShyZXR1cm5fdHlwZTogJlJldHVyblR5cGUpIC0+IFR5cGUgZWRfYXJncy5pb19tYXJrZXJzLmluc2VydChJb01hcmtlcjo6RmlsZXN5c3RlbSk7CiBhdGVkID0gaW5wdXQucGFyc2VfdGVybWluYXRlZChNZXRhOjpwYXJzZSwgVG9rZW4hW291bGQgbm90IGJlIG1hbnVhbGx5IGFubm90YXRlZC4KICAgIGlvX21hcmtlcnM6IEZ4ICAgTWV0YTo6TmFtZVZhbHVlKG1ldGEpID0+IEVycihzeW46OkVycm9yOjpuZWVudW0gSW9NYXJrZXIgewogICAgRmlsZXN5c3RlbSwKICAgIE5ldHdvcmssCn0KCi8gbm90IGd1YXJhbnRlZWQgYnV0IHdlIGFyZSBoYXBweSB0byBqdXN0IGhhdmUKICA6OlBhdGgoVHlwZVBhdGggeyBxc2VsZjogTm9uZSwgcGF0aCB9KSBpZiBwYXRoLmlzXyAie30gY2Fubm90IHRha2Ugc2VsZiBieSBtdXRhYmxlIHJlZmVyZW5jZSwgdXNlICZzeXBlLCB0aGlzIGlzIG9wdGltaXN0aWMKICAgIFZjLAogICAgRXJyb3IsCn0KCnB1YiggYXJlICJyZXNvbHZlZCIgKHdoZXJlICJyZXNvbHZlZCIgaW4gdGhpcyBjYXNlCiAgIDpuZXcoKCMoI2lucHV0cywpKikpOwogICAgICAgICAgICAgICAgICAgIGxldCBwZXJzICAgIHR1cmJvX3Rhc2tzOjpkeW5hbWljX2NhbGwoCiAgYXNrOjpUYXNrT3V0cHV0Pjo6dHJ5X2Zyb21fcmF3X3ZjKAogICAgZm4gc3RhdGljX2Jsb2NrKCZzZWxmLCBuYXRpdmVfZnVuY3Rpb25faWRlbnQ6ICZJZHcofHwgI3RyYWl0X3R5cGVfaWRlbnQuZ2V0KHN0cmluZ2lmeSEoI2lkZW50KSkpOwogZW5jZSA9IHNlbGYucGVyc2lzdGVuY2Vfd2l0aF90aGlzKCk7CiAgICAgICAgcXVvdGVyczo6YXNzZXJ0X2FyZ3VtZW50X2lzX25vbl9sb2NhbF92YWx1ZTo6PCN0eT4oKTsKICAvLyBpcyBmaXhlZCBpbiBzeW4gMi54LCB3aGVyZSBgc2VsZmAgaXMgYWx3YXlzIGBGZWl2ZXIuc3BhbigpLnVud3JhcCgpLmVycm9yKFNFTEZfRVJST1IpLmVtaXQoKTtzZWxmLnRoaXMuYXNfcmVmKCkubWFwKHxJbnB1dCB7IHR5OiBfLCBpZGVudCB9fCB7CmxwZXJzOjpnZXRfcGVyc2lzdGVuY2VfZnJvbV9pbnB1dHNfYW5kX3RoaXModGhpcywgICAgYXMgOjpzdGQ6OmJveGVkOjpCb3g8ZHluIHR1cmJvX3Rhc2tzOjpNYWdpY0FueT5ucHV0X2lkZW50cywpKikgPSB0dXJib190YXNrczo6bWFjcm9faGVscGVycwogICAgICA6OmRvd25jYXN0X2FyZ3Nfb3duZWQ6OjwoIygjZXhwb3NlZF9pbnJhaXRfY2FsbF9hcmdzKCZzZWxmKSAtPiBPcHRpb248RmlsdGVyVHJhaXRDYWxsQXJnbHRlcihtb3ZlIHxpZHwgaW5saW5lX2lucHV0c19pZGVudGlmaWVyX2ZpbHRlcihpZCkgICAgKGlubGluZV9zaWduYXR1cmUsIGlubGluZV9ibG9jaykKICAgRXhwcigKICAgICAgICAgICAgICAgIEV4cHI6OkJsb2NrKEV4cHJCbG9jayB7CiAgbWVudCB1c2VzIFJlc29sdmVkVmMsIGRvbid0IHJld3JpdGUgYW55dGhpbmchCiAgIHZlcnQgYW4gYXJndW1lbnQgb2YgdHlwZSBgRnJvbVRhc2tJbnB1dDxUPjo6VGFza0kgIHBhdDogQm94OjpuZXcoUGF0OjpJZGVudChQYXRJZGVudCB7CiAgICAgQ293OjpCb3Jyb3dlZCgmcGF0X2lkLmlkZW50KQogIGxldCBzZWxmX2lkZW50ID0gQ293OjpPd25lZChJZGVudDo6bmV3KCJzZWxmIiwgc2VsICAgIFNwYW46Om1peGVkX3NpdGUoKS5sb2NhdGVkX2F0KHNlbGZfdG9rZW4uc3BhbmUgY2FuJ3Qgc2hhZG93IGBzZWxmYCB2YXJpYWJsZXMsIHNvIGlmIHRoaXMgYXJndSAgICkgPT4gewogICAgICAgICAgICAgICAgICAgICAgICBsZXQgYXJnID0gRm5BciAgICA8I3R5IGFzIHR1cmJvX3Rhc2tzOjp0YXNrOjpGcm9tVGFza0lucHV0Pjo6ZnJvIC8vIEhlbHBlciB0byBwcm9kdWNlIHRoZSB0cmFuc2Zvcm0gc3RhdGVtZW50CmxldCAoRm5Bcmc6OlJlY2VpdmVyKFJlY2VpdmVyIHsgdHksIC4uIH0pIHwgRm5BcnRtdHMpOiAoUHVuY3R1YXRlZDxfLCBfPiwgVmVjPE9wdGlvbjxfPj4pID0gc2VsZgogaGUgbmFtZSBnaXZlbiBieSBbYFNlbGY6OmlubGluZV9pZGVudGBdLgogICBhbmdlcyB0aGF0J3MgY2FsbGVkIGJ5IHRoZSB0dXJiby10YXNrcyBmcmFtZXdvcmsgZHBhbmRfdGFza19pbnB1dF90eXBlKCZpbnB1dC50eSkudG9fdG9rZW5fc3RyZWFtKCkKdHVyZSgmc2VsZikgLT4gVG9rZW5TdHJlYW0gewogICAgICAgIGxldCBleHBvc2VkX2kvLyBpbnN0ZWFkIHdlIGp1c3QgcGljayBhIGxvbmcsIHVuaXF1ZSBuYW1lCiAgOm5ldygmZm9ybWF0ISgiYXJne30iLCBpICsgMiksIHR5cGVkLnBhdC5zcGFuKCkpCiBUaGUgY29tcGlsZXIgd2lsbCBlbWl0IGFuIGVycm9yIG9uIGl0cyBvd24uCiAgcG9ydCBkZXN0cnVjdHVyaW5nIHBhdHRlcm5zIChvciBvdGhlciBraW5kcyBvZiBwYXQgInt9IG11c3QgYWNjZXB0ICZzZWxmIG9yIHNlbGY6IFZjPFNlbGY+IGFzIHRleHQ6Ok5ha2VkRm4gfCBEZWZpbml0aW9uQ29udGV4dDo6VmFsdWVJbmhlcmVudEltcCAgICBGbkFyZzo6VHlwZWQodHlwZWQpID0gIC8vIGhlcmUuIFdlJ2xsIHJlbHkgb24gdGhlIGNvbXBpbGVyIHRvIGVtaXQgYW4gZW5jZXMgYCZzZWxmYC4gV2UgbXVzdCB2YWxpZGF0ZSBhZ2FpbnN0IGFueQogICAgICAgInt9IGRvIG5vdCBzdXBwb3J0IGF0dHJpYnV0ZXMgb24gc2VsZiIsCiAgZWRfaW5wdXRzID0gVmVjOjp3aXRoX2NhcGFjaXR5KHJhd19pbnB1dHMubGVuKCkpOwogIGlmIG9yaWdfc2lnbmF0dXJlLmdlbmVyaWNzLndoZXJlX2NsYXVzZS5pc19zcmdzOiBGdW5jdGlvbkFyZ3VtZW50cywKICAgICAgICBpc19zZWxmX3VzZWQ6IGJvcHV0czogVmVjPElucHV0PiwKICAgIC8vLyBTaG91bGQgd2UgcmV0dXJuIGBPcGVyYXR1YXRlZDo6e1BhaXIsIFB1bmN0dWF0ZWR9LAogICAgc3Bhbm5lZDo6U3Bhbm5lZCwKIHNlIHByb2NfbWFjcm8yOjp7R3JvdXAsIElkZW50LCBTcGFuLCBUb2tlblN0cmVhbSwgImZvb1thLXpdIik7CiAgICAgICAgYXNzZXJ0ISgheC5hbnlfdXBwZXJjYXNlKTsKICB0ZXJhbCk7CgogICAgICAgIGxldCB4ID0gYW5hbHlzaXMociJmb29ccHtMbH0iKTsKICAgQXN0QW5hbHlzaXM6OmZyb21fcGF0dGVybihwYXR0ZXJuKS51bndyYXAoKQogIHkgaWYgdGhlIGF0dHJpYnV0ZXMgY2FuIG5ldmVyIGNoYW5nZSBubyBtYXR0ZXIKICBsZi5mcm9tX2FzdF9jbGFzc19zZXQoJngua2luZCk7CiAgYXRjaCAqYXN0IHsKICAgICAgICAgICAgYXN0OjpDbGFzc1NldEl0ZW06OkVtcHR5KF8gICBBc3Q6OkFsdGVybmF0aW9uKHJlZiBhbHQpID0+OkFzc2VydGlvbihfKQogICAgICAgICAgICB8IEFzdDo6Q2xhc3NVbmljb2RlKF8pCiB0cyBgZmFsc2VgLCBidXQgYSBwYXR0ZXJuIGxpa2UKICAgIC8vLyBgXHBMZm9vYCByZS8vIFJldHVybnMgdHJ1ZSBpZiBhbmQgb25seSBpZiBhIGxpdGVyYWwgdXBwZXJjYXNldGhlIEFTVC4KICAgIHB1YihjcmF0ZSkgZm4gZnJvbV9hc3QoYXN0OiAmQXN0KSAtPiB1ZyldCnB1YihjcmF0ZSkgc3RydWN0IEFzdEFuYWx5c2lzIHsKICAgIC8vLyBUcnVlICdhc3Q+LCAmUykgLT4gVHJhdmVyc2VDb250cm9sPFMsIFU+LAogICAgICAgIHNjb3BtYXAofHZ8IHYudHJhdmVyc2UoYWxsb2MsIGYsIG9yZGVyKSkKc3VsdDxTZWxmLCBFPgogICAgd2hlcmUKICAgICAgICBGOiBGbk11dChBc3Q8J2FwLmVudHJ5KGlkLmlkZW50KCkpLm9yX2luc2VydF93aXRoKFZlYzo6bmV3KS5wdXNoaCdzIGZpcnN0IGVsZW1lbnQgaXNuJ3QgYW4gaWRlbnQpIGFyZSBpZ25vcmVkLgogICBUaGlzIHJlcXVpcmVzIHRvCiAgICAvLy8gbWFrZSBhIGxpbmVhciBzZWFyY2ggb3Zlcm5hbWljYWxseSwgYW5kIGB0cnVlYCBvdGhlcndpc2UuCiAgICBwdWIgZm4gaGFzX3N0b25zLgogICAgcHViIGZpZWxkX2RlZnM6ICYnYXN0IFtGaWVsZERlZjwnYXN0Pl0sCiB1Y3QgUmVjb3JkPCdhc3Q+IHsKICAgIC8vLyBgaW5jbHVkZWAgZXhwcmVzc2lvbnMuCmltcGw8J2FzdD4gRnJvbTxBbm5vdGF0aW9uPCdhc3Q+PiBmb3IgRmllbEVxLCBDbG9uZSwgRGVmYXVsdCldCnB1YiBzdHJ1Y3QgRmllbGRNZXRhZGF0YTwnYXN0cGF0aC5sYXN0KCkuZXhwZWN0KCJlbXB0eSBmaWVsZCBwYXRoIikudHJ5X2FzX2lkZW4vLy8gb25lIGVsZW1lbnQgd2hpY2ggaXMgYSBzdGF0aWMgaWRlbnRpZmllci4gUmV0dXRzLCBjb21wb3NpbmcgdGhlIGxlZnQgaGFuZCBzaWRlICh3aXRoIHJlc3BlY3QgdG8gQSBmaWVsZCBpcyBkZWZpbmVkIGJ5IGEgZG90LXNlcGFyYXRlZCBwYXRoIG9mIGlkZW5maWVycy4gU28gdGhpcyBtZXRob2QgaXMgYSBzaW1wbGUgc2VsZWN0b3Igb3ZlciBbU29jLmFsbG9jX3NpbmdsZXRvbihGaWVsZFBhdGhFbGVtOjpJZGVudChpZGVudCkpCiAgbWUoaWQpID0gZXhwci5ub2RlLnRyeV9zdHJfY2h1bmtfYXNfc3RhdGljX3N0cigpIHtkIGJlIG1vcmUgcHJlY2lzZS4gSG93ZXZlciwgaXQncyB1c2VmdWwgdG8ga2VlcCBhIHVnLCBQYXJ0aWFsRXEsIEVxKV0KcHViIGVudW0gRmllbGRQYXRoRWxlbTwnYXN0PiB7ZSA9ICJzZXJkZSIpXQptb2QganNvbnQ7Cm1vZCBwYXRoOwptb2Qgc3RhbmRhcmQ7Cm12aWRlIGEgd2F5IHRvIHNlYXJjaAovLyBhIHN1YnN0cmluZyBvZiBzb21lIGlucHV0IDpFcnJvcj4+KCgpKQpgYGAKKi8KCiMhW2RlbnkobWlzc2luZ19kb2NzKV0KIyFbY2ZnIGEgdGVybWNvbG9yOjpOb0NvbG9yLiBUaHVzLCBhIHNlY29uZAovLyBpbnRvX2lubmUgV2F0c29ucyBvZiB0aGlzIHdvcmxkLCBhcyBvcHBvc2VkIHRvIHRoZSBTaGVybG9ja3RjaGVzLgoKIyBFeGFtcGxlCgpUaGlzIGV4YW1wbGUgc2hvd3MgaG93IHRvIGNyZWFlcm1pbmFsIGNvbG9yaW5nLCBzZWFyY2ggJiByZXBsYWNlLAptdWx0aS1saW5lIHJlc30KfQovKiEKVGhpcyBjcmF0ZSBwcm92aWRlcyBmZWF0dXJlZnVsIGFuZCBmYXN0IHByInNyYy9iYXIvYSIpKQogICAgICAgICAgICB9XQogICB0YW50KHJjc3RyISgic3JjL2Zvby8iKSksCiAgICAgICAgLy8gICAgIC8gaW1wbGVtZW50ZWQgY3VycmVudGx5CiAgICAgICAgLy8gYXNzZXF1ZXN0aW5nIGA8ZHluYW1pYz5iYXItYWAgZnJvbSBhbiBleHBvcnRzIG1hcCBjb250aXg6ICJoZWFkLyIuaW50bygpLAogICAgICAgICAgICAgICAga2V5OiAmc3VwZXJ2ZWMhW3N1cGVyOjpBbGlhc01hdGNoIHsKICAgICAgICAgICAgICAgIHByZWZpeDogInRyISgiIikgfSwKICAgICAgICAgICAgICAgIG91dHB1dDogUGF0dGVybjo6Q29uY2FjdDo6PFJlc3VsdDxWZWM8Xz4+PigpCiAgICAgICAgICAgIC51bndyYXAoKSwKIHJzZSgiY2FyZC8qIiksICJzcmMvY2FyZHMvKiIpOwogb2JheiIpLAogICAgICAgICAgICAvLyBUaGVuIHRoZSBsb25nZXIgc3VmZml4LgogICBoZXMhKAogICAgICAgICAgICBtYXAsCiAgICAgICAgICAgICJmb29mb29iYXJmb28iLCAiZm9vYmF6Zm9vIiwgcmVwbGFjZWRfb3duZWQoImJhcmJhemJhciIpdGVzdF93aWxkY2FyZF9yZXBsYWNlX2luZml4KCkgewpzZXJ0KEFsaWFzUGF0dGVybjo6cGFyc2UoIipmb29mb28iKSwgIipiYXJiYXIiKTsKCiBsb25nZXIgcHJlZml4IHNob3VsZCBjb21lIGZpcnN0LgogICAgICAgICAgICByZXBsZXJ0X2FsaWFzX21hdGNoZXMhKG1hcCwgImZvbyIsIHJlcGxhY2VkKCJiYXIiKSk7CiBlcm46OnBhcnNlKCJmb29iYXIiKSwgImJhcmZvbyIpOwoKICAgICAgICBhc3NlcnRfYSAgZm4gdGVzdF9vbmVfZXhhY3QoKSB7CiAgICAgICAgbGV0IG11dCBtYXAgPSBBbGlhICAgY2FwdHVyZS5zcHJlYWRfaW50b19zdGFyKHNlbGYpCiAgIHJ0X2FsaWFzX21hdGNoZXMhKEBuZXh0ICRsb29rdXAsICQoJHRhaWwpKik7KT8KICAgICAgIG0gPT4gcGFuaWMhKCJ1bmV4cGVjdGVkIG1hdGNoIHs6P30iLCBtKSwKICAgICAoJG1hcDpleHByLCAkcmVxdWVzdDpleHByJCgsICQoJHRhaWw6dHQpKik/KSA9PmZuIHJlcGxhY2U8J2E+KCYnYSBzZWxmLCBjYXB0dXJlOiAmUGF0dGVybikgLT4gbiBiZSB1c2VkIGFzIGEgdGVtcGxhdGUgZm9yIGFuIGFsaWFzLgpwdWIgdHJhaXQgQWxpeDogcl9zdWZmaXggfSkgPT4gewogICAgICAgICAgICAgICAgbF9zdWZmaXgKICAgIGVyaW5nPiB7CiAgICAgICAgU29tZShzZWxmLmNtcChvdGhlcikpCiAgdGNoLCBzZXF1ZW50aWFsbHk6CiAgICAvLy8gMS4gYSBwcmVmaXg7IHRoZW4KICBoYXQgd2lsbCBvbmx5IG1hdGNoIGV4YWN0bHkgd2hhdCB3YXMgcGFzc2VkIGluLgogIFNvbWUod2lsZGNhcmRfaW5kZXgpID0gcGF0dGVybi5maW5kKCcqJykgewogIC8vLyBXaWxsIG1hdGNoIGFuIGV4YWN0IHN0cmluZy4KICAgIEV4YWN0KFJjU3RyKSwgbGV0IG91dHB1dCA9IHRlbXBsYXRlLnJlcGxhY2UoJnJlbWFpbmluZyk7CiAgKGUpID0gcmVtYWluaW5nLnN0cmlwX3ByZWZpeF9sZW4ocHJlZml4LmxlbigpKSB7CiAgLy8gSXQgbWF5IG9yIG1heSBub3QgbWF0Y2gsIHRocm93IGFuIGVycm9yLgogIHJlZml4LnN0YXJ0c193aXRoKCYqKnByZWZpeCkgJiYgcmVxX3N1ZmZpeC5lbmRzX3JuOjptYXRjaF9hcHBseV90ZW1wbGF0ZSBjYW4gYWNoaWV2ZSBhcyB3ZWxsLgoKICAgICAgIFBhdHRlcm46OkR5bmFtaWMgfCBQYXR0ZXJuOjpEeW5hbWljTm9TbGFzaCwKICBvciBub3csIHRyeSB0byBzdXBwb3J0IGFzIG1hbnkgY2FzZXMgYXMgcG9zc2libGUgKHNlbGYucmVxdWVzdC5pc19tYXRjaChwcmVmaXgpIHsKIHNNYXBMb29rdXBJdGVyYXRvcjwnYSwgVD4Kd2hlcmUKICAgIFQ6IEFsaWFzVGVtcGxhVmVjPChDb3c8J2EsIHN0cj4sICYnYSBCVHJlZU1hcDxBbGw8VD4gRXh0ZW5kPChBbGlhc1BhdHRlcm4sIFQpPiBmb3IgQWxpYXNNYXA8VD4ge2VudF9wcmVmaXhfaXRlcmF0b3IgPSBOb25lOwogICAgICAgICAgICBjb250aW51ZTsKICBmbiBuZXh0KCZtdXQgc2VsZikgLT4gT3B0aW9uPFNlbGY6Okl0ZW0+IHsKICAgICBpdGVyOiBwYXRyaWNpYV90cmVlOjptYXA6Okl0ZXI8J2EsIFZlYzx1OD4sIEJUYXNNYXBgLgovLy8KLy8vIEJld2FyZTogVGhlIGl0ZW1zIGFyZSAqTk9UKiByZXR1ICAgIChBbGlhc0tleTo6V2lsZGNhcmQgeyBzdWZmaXggfSwgdmFsdWUpID0+bnRfcHJlZml4X2l0ZXJhdG9yLml0ZXJhdG9yLm5leHQoKTsKICAgICAgICBsb29wIHthdG9yIGZvciBBbGlhc01hcEludG9JdGVyPFQ+IHsKICAgIHR5cGUgSXRlbSA9IChBbGpzLm9yZy9hcGkvZXNtLmh0bWwjcmVzb2x2ZXItYWxnb3JpdGhtLXNwZWNpZmljYXRpLyBBbiBvd25pbmcgaXRlcmF0b3Igb3ZlciB0aGUgZW50cmllcyBvZiBhbiBgQWxpYXNvbWUobWFwKSA9IHNlbGYubWFwLmdldF9tdXQoJnByZWZpeF9rZXkpIHsKICAgICBBbGlhc1BhdHRlcm46OkV4YWN0KGV4YWN0KSA9PiAoZXhhY3QsIEFsaWFzS2V5LyBJZiB0aGUgbWFwIGRpZCBub3QgaGF2ZSB0aGlzIGFsaWFzIGFscmVhZHksIGBOb24gIC8vIGBwcmVmaXhlc19zdGFja2AgaXMgbm93IGEgcHJlZmlsdGVyZWQgbGlzdCAgLmZpbHRlcl9tYXAofChwLCB0cmVlKXwgewogdmUgdG8gY2hlY2sgZXZlcnkgZW50cnkKICAgICAgICAgICAgLy8gV2l0aCBhIGR5bmEgICAgRXJyKGUpID0+IHN0ZDo6c3RyOjpmcm9tX3V0ZjgoJnBbLi5lLnZhbGlkX3VwXy8gYWNjb3JkaW5nIHRvIFBBVFRFUk5fS0VZX0NPTVBBUkUuIFNpbmNlIHdlJ3JlIHVzdHRlcm4sCiAgICAgICAgbXV0IHByZWZpeF9wcmVkaWNhdGU6IGltcGwgRm5NdXQoJnMgLy8gaW50ZXJuYWxseSB3aWxsIHBlcmZvcm0gYSBmaW5hbCBjaGVjayBpZiBhbiBlIG5vdCBtYXRjaCB0aGUgZXhhY3QgbWFwIGVudHJ5ICIuL2V4cGxpY2l0LWEiIChpdCcvIENvbmNhdGVuYXRpb24oW0NvbnN0YW50KCIuL2V4cGxpY2l0LSIpLCBEeW5hbWljXWVzID0gc2VsZi5tYXAuY29tbW9uX3ByZWZpeGVzKHJlcXVlc3QuYXNfYnl0ZXMoKSk7IFJldHVybnMgYW4gaXRlcmF0b3IgdG8gYWxsIHRoZSBtYXRjaGluZyBhbGlhc2VzLgogLy8vIExvb2tzIHVwIGEgcmVxdWVzdCBpbiB0aGUgYWxpYXMgbWFwLgogICBmcm9tX3V0Zjgoa2V5KS5leHBlY3QoImludmFsaWQgVVRGLTgga2V5IGluIEFsaWFzTW11dCB2YWx1ZXNfc3RyaW5nID0gc3RkOjpjb2xsZWN0aW9uczo6SGFzaE1hcDo6Lm1hcChtb3ZlIHwoYWxpYXNfa2V5LCB2YWx1ZSl8IG1hdGNoIGFsaWFzX2tleSB7CiBhbHVlX2RlYnVnX2Zvcm1hdCgmc2VsZiwgZGVwdGg6IHVzaXplKSAtPiBWYWx1ZXIoKS56aXAob3RoZXIubWFwLml0ZXIoKSkuYWxsKHwoYSwgYil8IGEgPT0gYikKICAKICAgIGJvcnJvd19kZWNvZGVfYm91bmRzID0gIlQ6IERlc2VyaWFsaXplPCdfX2RlPmN0ZXJzLCBpbmNsdWRpbmcgcGF0aCBzZXBhcmF0b3JzLiBUaGUgcmVzdWx0IG9mIGVyZGU6OntEZXNlcmlhbGl6ZSwgU2VyaWFsaXplLCBkZTo6RGVzZXJpYWxpemVPd25lICBPayhtYXRjaCAmKm1vZHVsZS50cnlfaW50b19tb2R1bGUoKS5heHQgPSBzZWxmLnByb2Nlc3NfY29udGV4dChtb2R1bGVfYXNzZXRfY29udGV4dCk7CiBsaWVudChjbGllbnRfdHJhbnNpdGlvbjogUmVzb2x2ZWRWYzxCb3g8ZHluIFRyYW5zaWhhdCBvbmx5IGFkZCBhIG1hcmtlciBgTmV4dER5bmFtaWNFbnRyeU1vZHVsZWAuCiAgeXBlLAogICAgc291cmNlOjpTb3VyY2UsCn07CnVzZSB0dXJib3BhY2tfZWNtYXMgIGV4cGFuZF9vdXRwdXRfYXNzZXRzKHN0ZDo6aXRlcjo6b25jZShFeHBhbmRPdXRwdWFzc2V0IGdyYXBoIGZyb20gbXVsdGlwbGUgYXNzZXRzIGFuZCBjb2xsZWN0IGFsbCByICB9OwoKICAgICAgICAgICAgICAgIHJldHVybiBPayhTb21lKCgKICAgaWYgIWluY2x1ZGVfdHJhY2VkICYmIG1hdGNoZXMhKGNodW5raW5nX3R5cGUsIGxldCBtb2R1bGVzID0gbW9kdWxlCiAgICAgICAgLnJlZmVyZW5jZXMoKQogIG5kaW5nX3VzYWdlOiBCaW5kaW5nVXNhZ2UsCiAgICBwdWIgbW9kdWxlczogVmVjPFJlRXEsIFBhcnRpYWxFcSwgVmFsdWVEZWJ1Z0Zvcm1hdCwgVHJhY2VSYXdWY3MsIE5vbkxvbmx5IGluY2x1ZGVzCi8vLyBwcmltYXJ5IFtNb2R1bGVdcyByZWZlcmVuY2VkLgovL2NlbGwoU29tZShDaHVua2luZ1R5cGU6OlRyYWNlZCkpCiAgZXN1bHQ+IHsKICAgICAgICAqTW9kdWxlUmVzb2x2ZVJlc3VsdDo6bW9kdWxlKHNlbGR1bGVzOiBGeEluZGV4U2V0PF8+ID0gbW9kdWxlcy5pbnRvX2l0ZXIoKS5jb2xjIGZuIHJlZmVyZW5jZWRfbW9kdWxlc19hbmRfYWZmZWN0aW5nX3NvdXJjZXMoCiAgcmVuY2VdCi8vLyBUaGlzIGRvZXMgbm90IGluY2x1ZGUgdHJhbnNpdGl2ZWx5IHJlZmV2ZVJlc3VsdDo6b3V0cHV0X2Fzc2V0KFJlcXVlc3RLZXk6OmRlZmF1bHQoKSwgc2VsZmNlIHRoYXQgYWx3YXlzIHJlc29sdmVzIHRvIGEgc2luZ2xlIG1vZHVsZS4KI1t0dWdlOjpUb3BMZXZlbCwKICAgICAgICAgICAgZXhwb3J0OiBzZWxmLmV4cG9ydC5vd25leXBlOjpQYXJhbGxlbCB7CiAgICAgICAgICAgIGluaGVyaXRfYXN5bmM6IHRydWUsCiA+IFZjPEJveDxkeW4gTW9kdWxlPj4gewogICAgICAgICpzZWxmLmFzc2V0CiA8ZHluIEFzc2V0Pj5dIHRoYXQgdGhpcyByZWZlcmVuY2UgcmVzb2x2ZXMgdG8uCiAgICAgZm4gcmVzb2x2ZV9yZWZlcmVuY2UoJnNlbGYpIC0+IFZjPE1vZHVsZVJlc29sdmVSaW1wbCBNb2R1bGVSZWZlcmVuY2VzIHsKICAgIC8vLyBBbiBlbXB0eSBsaXN0IG9mIFsvLyBBIHJlZmVyZW5jZSB0byBvbmUgb3IgbXVsdGlwbGUgW01vZHVsZV1zLCBbT3V0cHlwZSwgQ2h1bmtpbmdUeXBlT3B0aW9ufSwKICAgIG1vZHVsZTo6e01vZHVsZSwgTW9kbHVlLCBSZXNvbHZlZFZjLCBUcnlGbGF0Sm9pbkl0ZXJFeHQsIFRyeUpvaW5JbGV0IHBpY2tlZF92YyA9IHVwY2FzdF92Y3NbKmlucHV0LmNlbGxfaWR4LmdldCgpXTsgICBpbnB1dDogVmM8Q2VsbElkU2VsZWN0b3I+LAogICAgbXV0IGNlbGxfZm46IGltcGFyZW50LCBjZWxsID0gImNvbXBhcmUiKV0Kc3RydWN0IFNoYXJlZFZhbHVlKHVzaXogLy8gdW5kZXJseWluZyBBcmMvU2hhcmVkUmVmcyAoYnkgaWRlbnRpdHkpCiAgIGxldCB0cmFpdF9yZWZfYSA9IGNvdW50ZXJfdmFsdWVfdmMuaW50b190cmFpdF9yZWYoY2VsbCA9ICJuZXciYCwgdGhlIGNlbGwgd2lsbCBpcyBuZXZlciByZS11c2VkLCBldmVlbGwodHJhaXRfcmVmLmNsb25lKCkpLmdldF92YWx1ZSgpLmF3YWl0PywgNDIpOwogIG1vZGUoKSB7CiAgICBydW5fb25jZSgmUkVHSVNUUkFUSU9OLCB8fCBhc3luYyB7CiBhc2tzX3Rlc3Rpbmc6OntSZWdpc3RyYXRpb24sIHJlZ2lzdGVyLCBydW5fb2FpdCBEaWFnbm9zdGljQ29udGV4dEV4dAp3aGVyZQogICAgU2VsZjogU2l6ZWQsCnsKICAgIGNhdGVnb3J5OiBzZWxmLmNhdGVnb3J5KCkub3duZWQoKS5vbmdseSB0eXBlZAogICAgLy8vIHRob3VnaDsgc2luY2UgY29uc3VtZXIgb3IgaW1wbG5jb2RlKHdpdGggPSAidHVyYm9fYmluY29kZTo6aW5kZXhtYXAiKV0gcHViIEZ4SW5kaW1wbCBQYXJ0aWFsT3JkIGZvciBQbGFpbkRpYWdub3N0aWMgewogICAgZm4gcGFydGkgICAudGhlbl93aXRoKHx8IHNlbGYucGF5bG9hZC5sZW4oKS5jbXAoJm90aGVyLnBheXRyYWl0Ojphc3luY190cmFpdDsKdXNlIGF1dG9faGFzaF9tYXA6OkF1dG9TZXQ7CnVzZW1lbnRhdGlvbiB0aGF0IHByaW50cyBhbiB1bnF1b3RlZCwgdW5lc2NhcGVkIHN0cmllYnVnX3N0cnVjdC5maWVsZChmaWVsZC5uYW1lLCAmUGFzc3Rocm91Z2hEZWJ1Zzo6bnV0ID0gU3RyaW5nPj4sCiAgICApIC0+IFNlbGYgewogICAgICAgIFNlbGY6OlVubmFtRm9vOjpCYXIodTMyKWApLgogICAgVW5uYW1lZCB7IG5hbWU6ICYnYSBzdHIsIGZpZWxtZSwgY29udGVudHMgfSA9IHNlbGY7CiAgICAgICAgRm9ybWF0dGluZ0ZpZWxkIHsKIGVkIGZpZWxkIG9mIGEgc3RydWN0dXJlIGZvciBmb3JtYXR0aW5nIHB1cnBvc2VzIG9mdWIgdXNlIHR1cmJvX3Rhc2tzX21hY3Jvczo6VmFsdWVEZWJ1ZzsKCi8vLyBSZXByZXMgLy8gQXMgc2NyaXB0cyBhcmUgbG9hZGVkLCBhbGxvdyB0aGVtIHRvIHBvcCBmcm9tICAgIHZhciBwYXJhbSA9IChuKSA9PiB0eXBlb2YgcGFyYW1zW25dID09PSAnc3RyaW4gLy8gVHJ5IHF1ZXJ5c3RyaW5nIGZpcnN0IChTaGFyZWRXb3JrZXIpLCB0aGVuIGhhc2lkYXRlcyB0eXBlcyBmb3IgYWxsIHBhcmFtZXRlcnMgdG8gcHJldmVudCB1bmV4cGVjLy8gRmlyc3QsIGl0IHZlcmlmaWVzIHRoYXQgaXQgaXMgcnVubmluZyBpbiBhIHdvcmtpLCBuYW1lKSBpbiBmb3J3YXJkZWRfZ2xvYmFscy5pdGVyKCkuZW51bWVyYXRlKCkge2N0dXJlOgovLy8gYFtUVVJCT1BBQ0tfTkVYVF9DSFVOS19VUkxTLCBBU1NFVF9TVUZGdDo6ZmlsZSgKICAgICAgICAgICAgRmlsZUNvbnRlbnQ6OkNvbnRlbnQoRmlsZTo6ZnJsZXQgaWRlbnQgPSBzZWxmLmlkZW50X2Zvcl9wYXRoKCk7CiAgICAgICAgT2sodGhpcyAgT2soT3V0cHV0QXNzZXRzV2l0aFJlZmVyZW5jZWQ6OmZyb21fYXNzZXRzKFZjOjpjICAgLndpdGhfbW9kaWZpZXIoZm9ybWF0ISgie2dsb2JhbHNfaGFzaDowOHh9IikuaW5kZW50Pj4gewogICAgICAgIGxldCBjaHVua19yb290X3BhdGggPSBzZWxmLmNodW5raSBtdXQgY29kZSA9IGdlbmVyYXRlX3dvcmtlcl9ib290c3RyYXBfY29kZSgmZm9yd2Fyc3NpZ25lZCB0byBgc2VsZmAgaW4gdGhlIHdvcmtlciBzY29wZSBiZWZvcmUgbG9hZGllY21hc2NyaXB0OjptaW5pZnk6Om1pbmlmeTsKCi8vLyBBIHByZS1jb21waWxlZCB3b2VudDo6QXNzZXRJZGVudCwKICAgIG91dHB1dDo6e091dHB1dEFzc2V0LCBPdXRwdSAgIC5hbmRfdGhlbih8c3wgUmFuZ2U6OmZyb21fc3Bhbigmcywgc2VydmVyLndvcmwgLy8gT25seSByZXBvcnQgYSBEeW4gdHlwZSBpZiB0aGVyZSdzIG5vIG1vcmUgdXNlZm9tZShpZHgpID0gYW5ub3RhdGlvbnMuaXRlcigpLnBvc2l0aW9uKHxhfCBhID09ICZ0ICAuZmxhdF9tYXAofG18IG0uYW5ub3RhdGlvbi5pdGVyKCkubWFwKHx0eXB8IHR5cC5lIGNvbmZ1c2luZyB0byBjb21iaW5lIHRoZW0uCiAgICBsZXQgaG92ZXJfZGF0YSA9IHRoZSB0ZXJtICh3aGljaCBjYW4gaGF2ZSBiZXR0ZXIgdHlwZSBpbmZvcm1hdGlvbillcnZlcgogICAgICAgIC53b3JsZAogICAgICAgIC5wb3NpdGlvbigmcGFyYW1zLnRleHNwYW4gPSBhc3QucG9zLmludG9fb3B0KCk7CgogICAgbWF0Y2ggJmFzdC5ub2RlIHtsZXQgKHZhbHVlcywgbWV0YWRhdGEpID0gdmFsdWVzX2FuZF9tZXRhZGF0YV9mcm9tc3BvbmRzIHRvIGEgcGF0dGVybiBjYXNlIHdoZXJlIHRoZSBpZGVudCBpbmRleGVzIGkgLy8gMX1gLCB3ZSB3YW50IHRvIGluZGV4IGF0IGZpZWxkIGByYCBpbiB0aGUgcG90ZVNvbWUoZGVmKSA9IHdvcmxkLmFuYWx5c2lzX3JlZy5nZXRfZGVmKCZpZGVudCkgIC8vIGNhcmUgb2YgZm9yIHVzIGJ5IGB2YWx1ZSgpYCBhbmQgYG1ldGFkYXRhKClgIGlkZW50OiBJZGVudCwKKSAtPiAoVmVjPCZBc3Q8J18+PiwgVmVjPENvdzwnXywgRmllbm90YXRlZF9jb250cmFjdHM8J2FzdD4oYXN0OiAmJ2FzdCBBc3Q8J2FzdD4pIC0+aW9uPCYnYXN0IFR5cGU8J2FzdD4+LAp9CgppbXBsIENvbWJpbmUgZm9yIEhvdmVyRGFzdGQ6Omhhc2g6Okhhc2ggKyBFcSArIENsb25lPih4czogJm11dCBWZWM8VD4pIHsKIGhlIG9yZGVyLiBUaGUgZmlyc3QgaW5zdGFuY2Ugb2YgZWFjaCB1bmlxdWUgZWxlbXBfc2VydmVyOjp7UmVxdWVzdElkLCBSZXNwb25zZSwgUmVzcG9uc2VFcnJvcn07CnVzICAgICBMaW5rQ29udGVudDo6TGluayB7IHRhcmdldCwgbGlua190eXBlIH0gPT4gT2lkZW50ID0gaWRlbnQud2l0aF9mcmFnbWVudChzZWxmLmZyYWdtZW50LmNsbzpuZXdfd2l0aF9xdWVyeV9hbmRfZnJhZ21lbnQocGF0aCwgcXVlcnksIFJjU3RyOjpkcm9tIGEgcGF0aCB3aXRob3V0IGFueQovLy8gcmVmZXJlbmNlcyB0byBvdGhlciBbU29hc2tzX2ZzOjp7RmlsZUNvbnRlbnQsIEZpbGVTeXN0ZW1FbnRyeVR5cGUsIEZpbF9lcSEoc3RyaW5naWZ5X2pzKHIjIiIiIiMpLCByIyIiXCJcIiIiIyk7CiAgIG5vdCByZXByZXNlbnRhYmxlIGFzIFxmIGluIFJ1c3Qgc3RyaW5ncywgc28KICAgIHdpbmcgY2hhcmFjdGVycyByZXF1aXJlZCBmb3Igc3RyaW5ncyBieSB0aGUgQ1NTIHNzISBzYW1wbGUgewogICAgKCAkY291bnRlcjpleHByLCAkdmFsdWU6ZXhwciApID0+ICBpcyBlbmFibGVkLgoKI1tjZmcoZmVhdHVyZSA9ICJtZXRyaWNzIildCiNbbWFjcm8gfQp9Ci8vISBUaGlzIG1vZHVsZSBvbmx5IGNvbnRhaW5zIG1hY3JvcyB3cmFwcHNpb246IHAudmVyc2lvbiwKICAgICAgICAgICAgbWluaW1hbF9uaWNrZWxfdmVyc2lhdD4sCgogICAgYXV0aG9yczogVmVjPFN0cmluZz4sCiAgICBkZXNjcmlwdGlvbjogU2RleDo6SWQ6OkdpdGh1YiB7IG9yZywgbmFtZSwgcGF0aCB9ID0+IElkRm9ybWF0OjpHCi8vLyBEZWZpbmVzIHRoZSBzZXJpYWxpemF0aW9uIGZvcm1hdCBmb3IgYElkYCBpbiBydWN0IEluZGV4RGVwZW5kZW5jeUZvcm1hdCB7CiAgICAjW3NlcmRlKGZsYXR0ZW4pXWluZGV4Ojp7c2VsZiwgcGF0aDo6UmVsYXRpdmVQYXRofSwKICAgIHZlcnNpb246OntTICAgbWVzc2FnZS53cml0ZV9zdHIoIlxuQ2F1c2VkIGJ5OiAiKT87CiAgIHVubWFuZ2xlX2lkZW50aWZpZXJzKCZzZWxmLm1lc3NhZ2UsIG1hZ2ljKQogICB0YXNrcyh0cmFjZV9pZ25vcmUpXQogICAgc3RhY2s6IFZlYzxTdGFja0ZyYW1lPCdzdHplKV0KcHViIHN0cnVjdCBTdHJ1Y3R1cmVkRXJyb3IgewogICAgcHViIG5hbWU6IFN0IGlmIGxpYl9jb2RlIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gT2soUmVzb21lKHNtKSA9ICYqU291cmNlTWFwOjpuZXdfZnJvbV9yb3BlX2NhY2hlZChzbSkuYXdhaWxlKSA9IFBhdGg6Om5ldyhmaWxlLmFzX3JlZigpKS5zdHJpcF9wcmVmaXgocm9vdC5maWxlOwogICAgbGV0IFNvbWUocm9vdCkgPSB0b19zeXNfcGF0aChyb290KS5hd2FuZyB7CiAgICBOb1NvdXJjZU1hcCwKICAgIFVubWFwcGVkLAogICAgTWFwcGVkIHsKIGxldCBjdHggPSBnZXRfc291cmNlX2NvbnRleHQobGluZXMsIGxpbmUsIGNvbHVtbiwgZXQgY29sdW1uID0gY29sdW1uLnNhdHVyYXRpbmdfc3ViKDEpOwogIFNvbWUobmFtZSkgPSBmcmFtZS5uYW1lLmFzX3JlZigpIHsKZnJhbWUud2l0aF9wYXRoKCZwcm9qZWN0X3BhdGgucGF0aCksCiAgY2VNYXBwaW5nOjpNYXBwZWRMaWJyYXJ5IHsKICAgICAgICAgICAgZnJhbWUsCiAgICBmb3JtYXR0aW5nX21vZGUubG93bGlnaHQoJmZvcm1hdF9hcmdzISgiW2F0IHtvcmlibGUsICJ7UEFERElOR30oZXJyb3IgcmVzb2x2aW5nIHNvdXJjZSBtYXA6IHtlcnJ9KQogICAgbmV3LnB1c2hfc3RyKCZ0ZXh0W2xhc3RfbWF0Y2guLl0pOwogICAgT2soQ293YXAofHN8IHMuaW50bygpKSwKICAgICAgICAgICAgZmlsZTogZmlsZS5pbnRvKCksCiByYXAoKS5hc19zdHIoKTsKICAgICAgICBsZXQgbGluZSA9IGxpbmUucGFyc2U6Ojx1MyBtdXQgZmlyc3RfZXJyb3IgPSB0cnVlOwogICAgbGV0IG11dCB2aXNpYmxlX2NvZGVfZV9tYXA6OnRyYWNlOjp7U3RhY2tGcmFtZSwgVHJhY2VSZXN1bHQsIHRyYWNlX3NvdWNwOwp1c2Ugb25jZV9jZWxsOjpzeW5jOjpMYXp5Owp1c2UgcmVnZXg6OlJlZ2V4Owp1bGQgcmVhZCBzZWxmLm1lZGlhX3R5cGUgYW5kIHBvdGVudGlhbGx5IHVzZSBhIGRpZmYgICAgJmVuY29kZV9oZXgoaGFzaF94eGgzX2hhc2g2NCgoCiAgIG50ZW50X3R5cGUgPSBzZWxmLm1lZGlhX3R5cGUuc3BsaXQoIjsiKS5uZXh0KCkudW53ICAgZW5jb2Rpbmc6IFJjU3RyLAogICAgZGF0YTogUmVzb2x2ZWRWYzxSY1N0cj4sCiBzdHI6OlJjU3RyOwp1c2UgdHVyYm9fdGFza3M6OntSZXNvbHZlZFZjLCBWY307CnVzYXBfb3JfZWxzZSh8fCBTdHJpbmc6OmZyb20oIjx1bmtub3duIHBhbmljPiIpKTsKCmluZFNhZmUofHwgdGhpcy5mdXR1cmUucG9sbChjeCkpKS5tYXBfZXJyKHxlcnJ8IHsKbXBsIERpc3BsYXkgZm9yIFR1cmJvVGFza3NQYW5pYyB7CiAgICBmbiBmbXQoJmIgZm4gaW50b19wYW5pYyhzZWxmKSAtPiBCb3g8ZHluIHN0ZDo6YW55OjpBbnkgKyBTYXNrOjp7Q29udGV4dCwgUG9sbH0sCn07Cgp1c2UgYW55aG93OjpSZXN1bHQ7CnVzZSAgbW9kIGNvbW1vbl9qc19tb2R1bGVzX3Rlc3RzLy8gVXNpbmcgZGVjbGFyYXRpb24gKFRDMzkgcHJvcG9zYWwpIC0gaWYgc3VwcG9ydGV0aW9uIGZvbygpIHsKICAgICAgICAgICAgcmV0dXJuIGF3YWl0IHNvbWV0aGluZzsKIGN0cyEoCiAgICAgICAgICAgIHRlc3Rfc3VwZXJfY29tcGxleF9hY2Nlc3MsCiAgLy8gU3ByZWFkIGluIGNhbGwgYXJndW1lbnRzICh3aXRoIHB1cmUgZXhwcmVzc2lvbilzdF9zdGF0aWNfYmxvY2tfd2l0aF9zaWRlX2VmZmVjdF9pbnNpZGUsCiBkKCkgewogICAgICAgICAgICAgICAgcmV0dXJuIHN1cGVyWydwcm9wJ107CiAgIHRlc3RfanN4X2ZyYWdtZW50LCAiY29uc3QgZWwgPSA8PkhlbGxvPC8+OyIpOwp0ZXN0X2ltcG9ydF9tZXRhLCAiY29uc3QgdXJsID0gaW1wb3J0Lm1ldGEudXJsOyIpO2N0cyAoYnV0IG9ubHkgd2hlbiBpbnZva2VkLCBub3QgYXQgZGVmaW5pdGlvbikKICAvLyBEZWNvcmF0b3Igd2l0aCBhcmd1bWVudHMKICAgICAgIEBkZWNvcmF0b3IKICAgICAgICAgICAgbWV0aG9kKCkge30KIGxhc3MgZGVjb3JhdG9yIGhhcyBzaWRlIGVmZmVjdHMgKGV4ZWN1dGVzIGF0IGQvLyBEZWZhdWx0IHZhbHVlIHdpdGgga25vd24gcHVyZSBidWlsdC1pbgogICB7IGZvbywgLi4ucmVzdCB9ID0gb2JqOyIpOwoKICAgICAgICAvLyBDb21wbGV4IGRlc3BsZSB2YXJpYWJsZXMsIG9uZSB3aXRoIHNpZGUgZWZmZWN0IGluIGRlZmF1bHQKICAgb28gPSB7IGJhcjogJ2JheicgfSB9ID0gb2JqOyIKICAgLy8gRGVzdHJ1Y3R1cmluZyB3aXRoIG9iamVjdCBsaXRlcmFsIGRlZmF1bHQgaXMgcHRlc3RfZGVzdHJ1Y3R1cmVfc2ltcGxlLCAiY29uc3QgeyBmb28gfSA9IG9iajsiKTsKICAgICBbY29tcHV0ZU5hbWUoKV0oKSB7CiAgICAgICAgICAgICAgICByZXR1cm4gNDJhdGljIGEgPSAxOwogICAgICAgICAgICBzdGF0aWMgYiA9IGltcHVyZUNhbGwoKTthdGljIHsgY29uc29sZS5sb2coImluaXQiKTsgfQogIHNzIGV4cHJlc3Npb24gd2l0aCBwdXJlIHN0YXRpYyBwcm9wZXJ0eQogICBvbnN0IEZvbyA9IGNsYXNzIGV4dGVuZHMgZ2V0TWl4aW4oKSB7fTsiCiAgICAgY2xhc3MgRm9vIHsKICAgICAgICAgICAgY29uc3RydWN0b3IoKSB7CnMhKAogICAgICAgICAgICB0ZXN0X2NsYXNzX3N0YXRpY19ibG9ja19lbXB0eSwKICAgaXRoIHN0YXRpYyBwcm9wZXJ0eSB3aXRoIGFycmF5IGxpdGVyYWwgaXMgcHVyZQpsYXNzX2V4dGVuZHNfd2l0aF9jb21wbGV4X2V4cHIsCiAgYXNzX3B1cmVfZXh0ZW5kcywgImNsYXNzIEZvbyBleHRlbmRzIEJhciB7fSIpOwogLy8gQ2xhc3Mgd2l0aCBubyBleHRlbmRzIGFuZCBubyBzdGF0aWMgbWVtYmVycyBpc2F1c2UgZm9vKCkgaXMgY2FsbGVkIHdoZW4gY3JlYXRpbmcgdGhlIGFycmF5CiAgIGU6IHRlc3QoKSBhbmQgZXhlYygpIHRlY2huaWNhbGx5IG1vZGlmeSBmbGFncyBvbiB0ICByIyJjb25zdCByZXN1bHQgPSAoMTIzLjQ1NikudG9FeHBvbmVudGlhbCgyKTsiIwpob2RzIC0gbmVlZCBwYXJlbnRoZXNlcyBmb3IgbnVtYmVyIGxpdGVyYWxzCiAgIGx0ID0gImhlbGxvIHdvcmxkIi5pbmNsdWRlcygnd29ybGQnKTsiIwogIHRlc3Rfc3RyaW5nX2xpdGVyYWxfdG9fdXBwZXJfY2FzZSwKIG5zdCBjaGVjayA9IE51bWJlci5pc05hTigxMjMpOwogICAgICAgICAgICAiIwogICAgaGlzIHRlc3Qgc2hvd3MgdGhhdCBmdW5jdGlvbiBkZWNsYXJhdGlvbnMgYXJlYXMgYSBub24tZW1wdHkgY3R4dCksIGl0J3Mgbm90IHRoZSBnbG9iYWwKICAgIC8vIEFycmF5IGlzIE5PVCBzaGFkb3dlZCwgc28gbmV3IEFycmF5KCkgaXMgdGF0aCBpcyBOT1Qgc2hhZG93ZWQgaGVyZSwgc28gTWF0aC5hYnMgaXMgdGhlIGJ1aWx0c3Rfc2hhZG93ZWRfYXJyYXlfY29uc3RydWN0b3IsCiAgICAgICAgICAgIHIjIgogICAgIGNvbnN0IE9iamVjdCA9IHsga2V5czogKCkgPT4gc2lkZUVmZmVjdCgpIH07CiBuc3QgY3VzdG9tID0gbmV3IEN1c3RvbUNsYXNzKCk7XG5jb25zdCBtID0gbmV3IE1hcG5zdCBwYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCk7Igogb25zdCBwID0gbmV3IFByb21pc2UoKCkgPT4ge2NvbnNvbGUubG9nKCdoZWxsbycpfSl0ZXN0X25ld19lcnJvciwgImNvbnN0IGUgPSBuZXcgRXJyb3IoJ21lc3NhZ2UnKTsiKVxuZXhwb3J0IGNvbnN0IGIgPSBmb28oKTtcbmV4cG9ydCBjb25zdCBjID0gMzsiCiAgb25zdCBtb2QgPSBhd2FpdCBpbXBvcnQoJy4vbW9kdWxlJyk7IgpfZnJlZSEodGVzdF9yZWV4cG9ydCwgImV4cG9ydCB7IGZvbyB9IGZyb20gJ2Jhcic7IiAvLyBPcHRpb25hbCBjaGFpbmluZyB3aXRoIGEgY2FsbCBpcyBzdGlsbCBhIGNhbGwKIHlpZWxkIDE7IH0iKTsKCiAgICAgICAgLy8gVGFnZ2VkIHRlbXBsYXRlcyBhcmUgZnUgZGVsZXRlIGlzIGltcHVyZSAobW9kaWZpZXMgb2JqZWN0KQogICAgICAgIHNpZGVzdGVkX3Rlcm5hcnksICJjb25zdCB4ID0gYSA/IChiID8gMSA6IDIpIDogMzsiKTsKZXN0X2NvbXB1dGVkX3Byb3BlcnR5X3dpdGhfY2FsbCwKICBvbnN0IHN5bSA9IFN5bWJvbCgnZGVzY3JpcHRpb24nKTsiCiAvLyBCb29sZWFuKCkgYXMgYSBmdW5jdGlvbiAobm90IGNvbnN0cnVjdG9yKSBpcyBwb25zdCBkZWNvZGVkID0gZGVjb2RlVVJJQ29tcG9uZW50KGVuY29kZWQpOyIKIHRlc3RfZ2xvYmFsX3BhcnNlX2ludCwgImNvbnN0IG51bSA9IHBhcnNlSW50KCc0MicsY2Vzc2luZyB1bmtub3duIE1hdGggcHJvcGVydGllcyBpcyBub3QgaW4gb3VyIGxpc3Q9IE1hdGguZmxvb3IoMy4xNCk7XG5jb25zdCB6ID0gTWF0aC5tYXgoeCwgeSk7IgogIHJyYXlfaXNfYXJyYXksICJjb25zdCByZXN1bHQgPSBBcnJheS5pc0FycmF5KFtdKTsicGVyOjoqOwoKICAgICAgICBub19zaWRlX2VmZmVjdHMhKHRlc3RfbWF0aF9hYnMsICJpdGggUFVSRSBhbm5vdGF0aW9uLCBpbXB1cmUgYXJndW1lbnRzIG1ha2UgaXQgaW1wdXRlc3RfcHVyZV9hbm5vdGF0aW9uX3dpdGhfYXQsICIvKkBfX1BVUkVfXyovIGZvbygpdGVzdF9jbGFzc193aXRoX21ldGhvZHMsCiAgICAgICAgICAgICJjbGFzcyBGb28geyBwb3J0X2NvbnN0X3dpdGhfc2lkZV9lZmZlY3QsCiAgICAgICAgICAgICJleHBvcnQgY2VzdGVkX29iamVjdCwgImNvbnN0IG9iaiA9IHsgYTogeyBiOiB7IGM6IDEgfSB9IH07dGVzdF9iaW5hcnlfZXhwcmVzc2lvbiwgImNvbnN0IHggPSAxICsgMjsiKTsKCiAgICAiY29uc3QgZm9vID0gZnVuY3Rpb24oKSB7IHJldHVybiAxOyB9OyIKICAgIGZlY3RzISh0ZXN0X2FycmF5X2xpdGVyYWwsICJjb25zdCBhcnIgPSBbMSwgMiwgM107ZmZlY3RfZnJlZSB7CiAgICAgICAgKCRuYW1lOmlkZW50LCAkY29kZTpleHByKSA9PmUgZXhwZWN0ZWQgc2lkZSBlZmZlY3Qgc3RhdHVzCiAgICBtYWNyb19ydWxlcyEgYXNzY3RzOjpNb2R1bGVFdmFsdWF0aW9uSXNTaWRlRWZmZWN0RnJlZSA9PiB7ICAgKQogICAgICAgICAgICAuZXhwZWN0KCJGYWlsZWQgdG8gcGFyc2UiKTsKCiBld19zb3VyY2VfZmlsZShMcmM6Om5ldyhGaWxlTmFtZTo6QW5vbiksIGNvZGUudG9fcyAgcGFyc2VyOjp7RXNTeW50YXgsIFN5bnRheCwgcGFyc2VfZmlsZV9hc19wcm9nciAtIHRoaXMgaXMgZXZhbHVhdGVkIGlmIHRoZSB2YWx1ZSBpcyB1bmRlZmluZWQKICBmb3IgZWxlbSBpbiBhcnJheV9wYXQuZWxlbXMuaXRlcigpLmZsYXR0ZW4oKSB7CiAgICBPYmplY3RQYXRQcm9wOjpBc3NpZ24oYXNzaWduKSA9PiBAZGVjb3JhdG9yIGlzIGVxdWl2YWxlbnQgdG8gY2FsbGluZyBkZWNvcmF0b3IoKSkKIHMvbWVtYmVyIGRlZmluaXRpb24gdGltZSwgZXZlbiBpZiB0aGV5J3JlIGp1c3QKICAgIC8vIENoZWNrIGRlY29yYXRvcnMgLSB0aGV5IGV4ZWN1dGUgYXQgZGJlcjo6QXV0b0FjY2Vzc29yKGF1dG9fYWNjZXNzb3IpIGlmIGF1dG9fYWNjZXNzb3IuIC8vIEluc3RhbmNlIHByb3BlcnR5IGluaXRpYWxpemVycyBkb24ndCBleGVjdXRlIGEgRm9yIG5vbi1zdGF0aWMgcHJvcGVydGllcywgb25seSBjaGVjayB0aGUga2V5CiAgICBmb3IgZGVjb3JhdG9yIGluICZwcml2YXRlX21ldGhvZC5mdW5jdGlvbi5kZWNvaGVjayBjb21wdXRlZCBwcm9wZXJ0eSBrZXlzIGZvciBhbGwgbWVtYmVycwogICBiZXI6OkNsYXNzUHJvcChjbGFzc19wcm9wKSBpZiBjbGFzc19wcm9wLmlzX3N0YXRpICAgQ2xhc3NNZW1iZXI6OlN0YXRpY0Jsb2NrKGJsb2NrKSA9PiAgZGVjb3JhdG9yIGluICZjbGFzcy5kZWNvcmF0b3JzIHsKICAgICAgICAgICAgZGVjb2lzaXRfcHJvcF9uYW1lKCZtdXQgc2VsZiwgcHJvcF9uYW1lOiAmUHJvcE5hbWUpIHsKICAgICBQcm9wOjpNZXRob2QobWV0aG9kKSA9PiB7CiAgICAgICAgICAgICAgICBtZXQgLy8gQm9keSBpcyBub3QgZXhlY3V0ZWQgYXQgZGVmaW5pdGlvbiB0aW1lCiAgIC8gW10pPy5tYXAoLi4uKWAgYnV0IHRoaXMgc2VlbXMgcHJldHR5IHRoZW9yZXRpY2FsaXNpdF9vcHRfY2hhaW5fYmFzZSgmbXV0IHNlbGYsIGJhc2U6ICZPcHRDaGFpbkJhc2VrIG9yIG1pbGxpb25qcykuICBJbiBhbnkgY2FzZSBpdCBkb2Vzbid0IG1hdHRlciB0by8gVGhleSBqdXN0IHJlYWQgbWV0YWRhdGEsIGRvbid0IGNhdXNlIHNpZGVydHkgYWNjZXNzIGlzIHB1cmUgKHJlYWRpbmcgZnJvbSBwYXJlbnQgY2xhc3MpCiAgIEJ1dCBpZiBpdCdzIGFuIG9wdGlvbmFsIGNhbGwsIGl0IGhhcyBzaWRlICAvLyBCdXQgc29tZSBhcmUga25vd24gdG8gYmUgcHVyZSwgbGlrZSBTdHJpbmcucmEgIC8vIFVua25vd24gY29uc3RydWN0b3IgY2FsbHMgYXJlIGNvbnNpZGVyZWQgdG8gaCAgLy8gUHVyZSBjb25zdHJ1Y3RvciwgYnV0IHN0aWxsIG5lZWQgdG8gY2hlY2sgYXJnZW1lbnQsIGJ1dCBub3QKICAgICAgICAgICAgICAgICAgICAvLyBpbXBvc3NpYmxlLgpsLnNwYW4pIHx8IHNlbGYuaXNfa25vd25fcHVyZV9idWlsdGluKCZjYWxsLmNhbGxlZWhlY2sgZm9yIC8qI19fUFVSRV9fKi8gYW5ub3RhdGlvbiBvciBmb3IgYSB3ZWxsIGtudGl2ZSBoZXJlIHdvdWxkIG1hcmsgdG9vIG11Y2ggY29kZSBhcyBpbXB1cmUKICAgIC8vIDEuIE1vc3QgY29kZSBkb2Vzbid0IHVzZSBnZXR0ZXJzIHdpdGggc2lkZHVsZSBsZXZlbCB2YXJpYWJsZXMgb3IgcHJvcGVydGllcyBkZWZpbmVkIG9uIG1vZHUvLyBPYmplY3RzIGFyZSBwdXJlIGlmIHRoZWlyIHByb3BlcnR5IG5hbWVzIGFuZCBpbnNlbGYud2l0aF93aWxsX2ludm9rZV9mbl9leHBycyhmYWxzZSwgfHRoaXN8IHsKaGF0IGFueSBuZXN0ZWQgZnVuY3Rpb24gZXhwcmVzc2lvbnMgd2lsbCBub3RoZSBwYXR0ZXJuIChmb3IgZGVmYXVsdCB2YWx1ZXMgaW4gZGVzdHJ1Y3R1cmluZykgLy8gRm9yIG90aGVyIHN0YXRlbWVudCB0eXBlcywgYmUgY29uc2VydmF0aXZlCiAgIGZlY3RzKQogICAgICAgICAgICBTdG10OjpEZWNsKERlY2w6OlZhcih2YXJfZGVjbCkpdHMgbmVlZCBjaGVja2luZwogICAgICAgICAgICBTdG10OjpFeHByKGV4cHJfc3RtdClmaWVyIGJ1dCBpdCBtaWdodAogICAgICAgICAgICAgICAgLy8gYWxzbyBiZSBhIHJlcSB0aGUgZXhwcmVzc2lvbiBiZWluZyBleHBvcnRlZAogICAgICAgICAgICAgICAgZXhwcyBpbiBleHRlbmRzIGNsYXVzZSBhbmQgc3RhdGljCiAgICBsZURlY2w6OkV4cG9ydERlZmF1bHREZWNsKGV4cG9ydF9kZWZhdWx0X2RlY2wpID0+IGFuIGhhdmUgc2lkZSBlZmZlY3RzIGluIHN0YXRpYyBibG9ja3MsIGV4dGVuZHMgb3IKc3RhdGVtZW50cyBtYXkgaGF2ZSBzaWRlIGVmZmVjdHMsIHdoaWNoIGNvdWxkIHJlcXVpb25zIChpbXBvcnRzL2V4cG9ydHMpIG5lZWQgc3BlY2lhbCBoYW5kbGluZwogICAgIHRvcC1sZXZlbCBtb2R1bGUgaXRlbXMKICAgICAgICBmb3IgaXRlbSBpbiAmbW9kdWxpZmllcidzIGNvbnRleHQgbWF0Y2hlcyB0aGUgdW5yZXNvbHZlZCBtYXJrLgogICBvbHZlZCkuCiAgICAvLy8gSWYgaXQncyBzaGFkb3dlZCBieSBhIGxvY2FsIHZhcmkgIC8vIE8oMSkgbG9va3VwIGluIHRoZSBnbG9iYWwgZnVuY3Rpb25zIHNldAogICAgdGhhdCdzIGhhbmRsZWQgaW4gdmlzaXRfZXhwcgogICAvIE5vdGU6IFdlIGRvbid0IGNoZWNrIGFycmF5IGVsZW1lbnRzIGhlcmUgLSB0aGF0X09CSkVDVF9QUk9UT1RZUEVfTUVUSE9EUy5jb250YWlucyhtZXRob2RfbmFtZSkKICAgIC8vIEhhbmRsZSBsaXRlcmFsIHJlY2VpdmVyIG1ldGhvZHMgbGlrZSAiaGVsbG8iLiBUaGUgaWRlbnRpZmllciBpcyBpbiBhIGxvY2FsIHNjb3BlLCBtaWdodCBiZSBzaGFkamVjdCBtZXRob2RzIGxpa2UgTWF0aC5hYnMsIE9iamVjdC5rZXlzLCBldGMuCiAgICBmbiBpc19rbm93bl9wdXJlX2J1aWx0aW5fZnVuY3Rpb24oJnNlbGYsIGV4cHI6ICZFaWRlbnQuY3R4dC5vdXRlcigpID09IHNlbGYudW5yZXNvbHZlZF9tYXJrICYmIGlkZW5hdXNlIHdlIGRvbid0IHN1cHBvcnQgdGhpbmdzCiAgICAvLy8gbGlrZSBgcmVxdWkgLy8vIENoZWNrIGlmIGEgc3BhbiBoYXMgYSBgLyojX19QVVJFX18qL2Agb3IgYC8qQHVtZW50cyAoZS5nLiwgY2FsbGJhY2tzIHRvIHB1cmUgZnVuY3Rpb25zIGxpa2UgYGFyTWFyayB0aGF0IHdlJ3ZlIGZvdW5kIGEgc2lkZSBlZmZlY3QgYW5kIHN0b3AgZnVydGh0RnJlZQogICAgfQp9CgpzdHJ1Y3QgU2lkZUVmZmVjdFZpc2l0b3I8J2E+IHsKIGVjdHMoCiAgICBwcm9ncmFtOiAmUHJvZ3JhbSwKICAgIGNvbW1lbnRzOiAmZHluIENveSBmbGFncywKLy8vIGZvciBsaXRlcmFsIHJlZ2V4ZXMgdGhpcyBpcyBzYWZlIGJlY2EgICJ0b1NwbGljZWQiLAogICAgIndpdGgiLAp9OwoKc3RhdGljIEtOT1dOX1BVUkVfT1JFX0FSUkFZX1BST1RPVFlQRV9NRVRIT0RTOiBwaGY6OlNldDwmJ3N0YXRpYyBzdHI+ZXQhIHsKICAgIC8vIENhc2UgY29udmVyc2lvbgogICAgInRvTG93ZXJDYXNlIiwKICB0Ci8vIHJhdGhlciB0aGF0IHdlIGNhbiBzYWZlbHkgcmVhc29uIGFib3V0IHRoZWlyICAvLyBSZWd1bGFyIGV4cHJlc3Npb25zCiAgICAiUmVnRXhwIiwKICAgIC8vIERhdGEgUkkiLAogICAgImRlY29kZVVSSUNvbXBvbmVudCIsCn07CgovLy8gS25vd24gcHVyZSBwdXJlIGdsb2JhbCBmdW5jdGlvbnMgdGhhdCBjYW4gYmUgY2FsbGVkIGRpcmVjdGx5ICAgLy8gU3RyaW5nIHN0YXRpYyBtZXRob2RzCiAgICAiU3RyaW5nIiA9PiBwaGZfc2V0IE5vdGU6IFNvbWUgb2YgdGhlc2UgY2FuIHRocm93IGV4Y2VwdGlvbnMsIGJ1dCBmb3JnYW5pemVkIGJ5IG9iamVjdCAoZS5nLiwgTWF0aCwgT2JqZWN0LCBBcnJheSkuCi8vLyAgIHZpc2l0Ojp7VmlzaXQsIFZpc2l0V2l0aCwgbm9vcF92aXNpdF90eXBlfSwKICAKLy8hIGBgYAovLyEKLy8hIEEgc3BlY2lhbCBjYXNlIHRvIGNvbnNpZGVyIHdvdWxkIAovLyEgQ3VycmVudGx5LCBhbGwgYXNzaWdubWVudHMsIHVwZGF0ZXMsIGFuZCBwcm9wcyBhbnkgb2JzZXJ2YWJsZSBiZWhhdmlvciB0aGF0IG9jY3VycyB3aGVuIGNvZGUgaXN0byBkZXRlcm1pbmUgaWYgYSBqYXZhc2NyaXB0IHNjcmlwdC9tb2R1bGUgaGFzIHNpZG9yZTo6Y2h1bms6OkNodW5rSXRlbT4+PiB7CiAgICAgICAgT2soVmM6OnUgIGZuIGFzX2NodW5rX2l0ZW0oCiAgICAgICAgc2VsZjogUmVzb2x2ZWRWYzxTZSAgICAucmVzb2x2ZWRfY2VsbCgpOwogICAgICAgIE9rKEVjbWFzb3J0OjpJbXBvcnRlZE5hbWVzcGFjZShSZXNvbHZlZFZjOjp1cGNhc3QoCiAgICAgICBFY21hc2NyaXB0TW9kdWxlUGFydFJlZmVyZW5jZTo6bmV3X25vcm1hbCgKICAgdHMuZXh0ZW5kKGVzbV9leHBvcnRzLnN0YXJfZXhwb3J0cy5pdGVyKCkuY29waWVkKCl0OjpJbXBvcnRlZEJpbmRpbmcocmVmZXJlbmNlLCBpbXBvcnRlZF9uYW1lLCBtdXRhYiAgICAqbGl2ZW5lc3MgPT0gTGl2ZW5lc3M6Ok11dGFibGUsCiAgICAgIEVzbUV4cG9ydDo6TG9jYWxCaW5kaW5nKF8sIGxpdmVuZXNzKSA9PiAgZm9yIChuYW1lLCBleHBvcnQpIGluICZlc21fZXhwb3J0cy5leHBvcnRzIHsKdHM+PiB7CiAgICAgICAgbGV0IG11dCBleHBvcnRzID0gQlRyZWVNYXA6Om5ldygpOwphbCBtb2R1bGUncyBzd2NfY29tbW9uOjpTb3VyY2VNYXAgaW4gYHBhcnNlZGAuCiAgIGRfbW9kdWxlX3R5cGU6IFNwZWNpZmllZE1vZHVsZVR5cGU6OkVjbWFTY3JpcHQsCiAgb2R1bGVGYWNhZGVNb2R1bGU6OmFuYWx5emUgc2hvdWxkbid0IGJlIGNhbGxlZCIpOwpmZWN0czo6U2lkZUVmZmVjdEZyZWUuY2VsbCgpCiAgIHNpZGVfZWZmZWN0cygmc2VsZikgLT4gUmVzdWx0PFZjPE1vZHVsZVNpZGVFZmZlY3RldCByZWZlcmVuY2VzID0gcGFydF9yZWZlcmVuY2VzCiAgICAgICAgICAgIC5pdGVyZHVsZS5pZGVudCgpLndpdGhfcGFydChzZWxmLnBhcnQuY2xvbmUoKSkKICAgICAgRXhwb3J0VXNhZ2U6Om5hbWVkKG9yaWdpbmFsX2V4cG9ydC5jbG9uZSgpKSwKICAgIE1vZHVsZVBhcnQ6OlJlbmFtZWROYW1lc3BhY2UgeyAuLiB9ID0+ICgKICAgTyBza2lwIGlmIHNpZGUgZWZmZWN0IGZyZWUgYW5kIG5vIGxvY2FsIGV4cG9ydHMKICAgICAgIkV4cGVjdGVkIEVjbWFzY3JpcHRNb2R1bGVBc3NldCBmb3IgYSBFY21hICAgICBoYXNfdG9wX2xldmVsX2F3YWl0LAogICAgICAgICAgICBpbXBvcnRfZXh0ZXJTb21lKGFzeW5jX21vZHVsZSkgPSAqc2VsZi5tb2R1bGUuZ2V0X2FzeW5jIE1vZHVsZVBhcnQsCiAgICApIC0+IFZjPFNlbGY+IHsKICAgICAgICBkZWJ1Z19hc3NhdCBtb2R1bGUgYW5kIGFsc28gcmVleHBvcnRzIHRoZSBsb2NhbHMgZnJvbQovLy8gW0NodW5rUGxhY2VhYmxlLCBFY21hc2NyaXB0RXhwb3J0c30sCiAgICBjb2RlX2dlbjo6CiAgICBjaHVuazo6ewogICAgICAgIEFzeW5jTW9kdWxlSW5mbywgQ2h1bmthYmxlTW8gICB9KSwKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnRyYWN0czogdmUgICBhbm5vdGF0aW9uOiBUeXBlQW5ub3RhdGlvbiB7CiAgaXR5OjpCb3R0b20pCiAgICAgICAgICAgIC5kb2MoImZvbz8iKQogICAgICBwb3M6IFRlcm1Qb3M6Ok5vbmUKIHRyYWN0KFR5cGVGOjpTdHJpbmcpCiAgICAgICAgICAgIC5ub192YWx1ZSgpCiAgICAgLnByaW9yaXR5KE1lcmdlUHJpb3JpdHk6OlRvcCkKICAgICAgICAgICAgLm5vX3ZzKCJoZWxsbyB3b3JsZCEiKS5pbnRvKCkKICAgICAgICAgICAgICAgICAgICApLAogICAgICAoImJhciIuaW50bygpLCBOaWNrZWxWYWx1ZTo6bnVsbCgpLmludG8oKSkKICAgICBlbGFib3JhdGVfZmllbGRfcGF0aCgKICAgICAgIC5wYXRoKHZlYyFbInRlcnJhZm9ybSIsICJyZXF1aXJlZF9wcm92aWRlcnMiXSkgICByZWNvcmQ6OkZpZWxkOjpmcm9tKEZpZWxkTWV0YWRhdGEgewogICAgICBdLAogICAgICAgICAgICAgICAgRGVmYXVsdDo6ZGVmYXVsdCgpCiBsdWU6OnN0cmluZ19wb3NsZXNzKCJiYXIiKSksCiAgICAgICAgICAgIF0pCiAgIGJ1aWxkX2Nsb3N1cml6ZWRfcmVjb3JkKAogICAgICAgICAgICAgICAgdmVjIVsKICAgYXIiKS5zb21lX2RvYyhOb25lIGFzIE9wdGlvbjwmc3RyPikubm9fdmFsdWUoKSwKICAgICBGaWVsZDo6bmFtZSgiYmFyIikudmFsdWUoTmlja2VsVmFsdWU6Om51bGwoKSl1ZSA9IFJlY29yZDo6bmV3KCkKICAgICAgICAgICAgLmZpZWxkKCJmb28iKQogIG1wbCBGcm9tPFJlY29yZD4gZm9yIE5pY2tlbFZhbHVlIHsKICAgIGZuIGZyb20odmFsbG9zdXJpemVdIG9wZXJhdGlvbiwgYXMgYXJlIGFueSBzdWItcmVjb3JkcyBpbXBsaWMgIC8vLwogICAgLy8vIFtTZWxmOjpidWlsZF0gaXMgaW50ZW5kZWQgdG8gcHJvdmlkZSAgICNbYWxsb3coY2xpcHB5OjpuZWVkbGVzc191cGRhdGUpXQogICAgLy8vIE1hcmsgYXRoOiBwYXRoLmludG9faXRlcigpLm1hcCh8ZXwgSWRlbnQ6Om5ldyhlKSkuY29sbCAvLy8gU3RhcnQgY29uc3RydWN0aW5nIGEgZmllbGQgYXQgdGhlIGdpdmVjb3JkX3Bvc2xlc3MoUmVjb3JkRGF0YTo6bmV3KHN0YXRpY19maWVsZHMsIGF0dHJzLCAgIGluZGV4bWFwOjptYXA6OkVudHJ5OjpPY2N1cGllZChtdXQgb2NjdXBpZWQpID0+ICAgIChTb21lKHQxKSwgU29tZSh0MikpID0+IFNvbWUob3AyKEJpbmFyeU9wOjpNZXJGaWVsZDo6ZnJvbShOaWNrZWxWYWx1ZTo6dGVybV9wb3NsZXNzKFRlcm06OkNsb3N1cmF0aCwgcmVjb3JkOjpGaWVsZCk+LAogICAgYXR0cnM6IFJlY29yZEF0dHJzLAp9Cgpob3V0IHNldHRpbmcgYSB2YWx1ZQogICAgcHViIGZuIG5vX3ZhbHVlKG11dCBzZWxmKWIgZm4gd2l0aF9yZWNvcmQoc2VsZiwgcjogUmVjb3JkKSAtPiBSZWNvcmQgewogIGIgZm4gdmFsdWUoc2VsZiwgdmFsdWU6IGltcGwgSW50bzxOaWNrZWxWYWx1ZT4pIC0+bGV0ZSBbYEZpZWxkYF0gYXQgYSBnaXZlbiBwYXRoCiAgICBwdWIgZm4gcGF0aDxJLCBlbGYubWV0YWRhdGEuYW5ub3RhdGlvbi50eXAgPSBTb21lKExhYmVsZWRUeXBlIHsKICBTZWxmCiAgICB3aGVyZQogICAgICAgIEk6IEludG9JdGVyYXRvcjxJdGVtID0gVHlwYG5vdF9leHBvcnRlZGAgb3Igbm90LCBkZXBlbmRpbmcgb24gdGhlIGFyZ3VtZW50CiBlX2RvYyhtdXQgc2VsZiwgc29tZV9kb2M6IE9wdGlvbjxpbXBsIEFzUmVmPHN0cj4+KSAvLy8gQXR0YWNoIGRvY3VtZW50YXRpb24gbWV0YWRhdGEgdG8gdGhlIGZpZWxkCiAgICB0eXA6OlR5cGUsCn07Cgp1c2Ugc3RkOjpyYzo6UmM7Cgp0eXBlIFN0YXRpY1BhdGh9Ci8vISBBIGJ1aWxkZXIgaW50ZXJmYWNlIGZvciBwcm9kdWNpbmcgTmlja2VsIHJlY3JhaXQgcGF0dGVybiBmb3IgYFZjQ2FzdGAuCi8vIGh0dHBzOi8vcnVzdC1sYW5nLmdpdXQgPSBSZWFkUmVmPFQ+OwoKICAgIGZuIGNhc3QoY29udGVudDogVHlwZWRDZWxsQ28KLy8vIFRoaXMgdHJhaXQgaXMgc2VhbGVkIGFuZCBjYW5ub3QgYmUgaW1wbGVtZW50ZWU6OntSZWFkUmVmLCBUcmFpdFJlZiwgVmNWYWx1ZVRyYWl0LCBWY1ZhbHVlVHlwZSwgbGxlY3Q6OjxWZWM8Xz4+KCkKICAgICAgICAgICAgLmpvaW4oIi8iKQogICAgKQp9CgogbGV0IHBhdGggPSBtYXRjaCBwYXRoIHsKICAgICAgICBTb21lKHBhdGgpID0+IHJvb3MgaXMgcHVyZWx5IHRvIHJlZHVjZSBib2lsZXJwbGF0ZSBjb2RlCi8vLyBjb21wYXJpbVBhdGh9OwoKLy8vIENvbnZlcnRzIGEgZGlzayBhY2Nlc3MgUmVzdWx0PFQ+IGludG9ud3JhcF9vcihmYWxzZSkKICAgICAgICB9CiAgICAgICAgKFR5cGVGOjpDb250cmFhcCh8KG0xLCBtMil8IG1hcF9lcSh0eXBlX2VxX2JvdW5kZWRfd3JhcHBlciwgc3RhdCAgICB1dHkyOiAmT3B0aW9uPCZUeXBlPiwKICAgICAgICAgICAgICAgIGVudjI6ICZFIHR5cGVfZmllbGRzOiB1dHkxLAogICAgICAgICAgICAgICAgZmxhdm91cjogYXR0cnNlRjo6RHluLCBUeXBlRjo6RHluKQogICAgICAgIHwgKFR5cGVGOjpOdW1iZXIsIFR5cGFsbHkgcmVjdXJzZSBpbnRvIHR5cGUgY29uc3RydWN0b3JzIGFuZCB0ZXN0IHRoYXQKICAmJiBmaWVsZDEubWV0YWRhdGEubm90X2V4cG9ydGVkKCkgPT0gZmllbGQyLm1ldGF0aWMgYW5kIHJ1bnRpbWUgZGF0YSkgYW5kIG5vdCB2ZXJ5IG1lYW5pbmdmdWwuCiAgICB0aGUgbGFiZWwgaGVyZSwgd2hpY2ggZG9lc24ndCBpbXBhY3QgdGhlIGZhY3QKICAgLy8gbWV0YWRhdGEgYnV0IHdpdGhvdXQgZGVmaW5pdGlvbi4gRm9yIGV4YW1wbGUsIHRjb3JkIGZpZWxkcy4gRmllbGRzIGFyZSBlcXVhbCBpZiB0aGV5IGFyZSBib3RoIHdpdHJkUm93c0l0ZXJhdG9ySXRlbTo6Um93KFJlY29yZFJvd0YgeyBpZCwgdHlwIH0pID0+cm5lZC4gYE5vbmVgIGlzIHJldHVybmVkIGFzIHdlbGwgaWYgYSB0eXBlIGVuY291bnRsaXR5IGJldHdlZW4gdHdvIGhhc2htYXBzIGhvbGRpbmcgZWl0aGVyIHR5cGVzIG9yIGNfZGF0YS5yZWNvcmQuYXR0cnMub3BlbiA9PSByZWNvcmQuYXR0cnMub3BlbgogICAgbiBvcGVuIHJlY29yZCBpcyBhbHdheXMgcHJvcGVybHkgYWxsb2NhdGVkIChub3QgaW5lcm06OlJlY1JlY29yZChkYXRhKSksCiAgICAgICAgICAgIFZhbHVhdGUsICZjbG9zdXJlLnZhbHVlLCAmY2xvc3VyZS5lbnYsIHQyLCBlbnYyKQogICAgYQogICAgICAgICAgICAvLyByZWN1cnNpdmUgZmllbGQuIFdoZW4gZGVkdXBsaWNhdCAgLy8gSWYgd2UgZmluZCBhIGNsb3N1cmUgdGhhdCBpc24ndCBjb21pbmcgZnJvbSBhLyBXZSBkb24ndCB0cmVhdCBpbXBvcnRzLCBwYXJzZSBlcnJvcnMsIGZ1bmN0aW9ucywgICAgIG9wOiBVbmFyeU9wOjpSZWNvcmRBY2Nlc3MoaWQxKSwKICBsZXQgdHkyID0gZGF0YTIuYW5ub3QuZmlyc3QoKTsKdWxkIHRoZXkgYmUgZGVjbGFyZWQgdW5lcXVhbCBiZWNhdXNlIG9mIHRoYXQ/CiAgICBwcGVuIHRvIGhhdmUgY29udHJhY3RzIGhhdmluZyB0aGVtc2VsdmVzIHR5cGUgYW5ub2hlIGlubmVyIHZhbHVlcyBhcyB3ZWxsIGFzIHRoZSBjb3JyZXNwb25kaW5nIGNvbnQgd2hvc2UgZmllbGQgc3RydWN0dXJlIGlzIHN0YXRpY2FsbHkga25vd24gKGkuZS4gd2l0ZXJhbChzMSksIFN0ckNodW5rOjpMaXRlcmFsKHMyKSkgPT4gczEgPT0gczIsCiAgb25seSBjb21wYXJlIHN0cmluZyBjaHVua3Mgd2hlbiB0aGV5IHJlcHJlc2VudCBhIHAgICAgKF8sIFZhbHVlQ29udGVudFJlZjo6VGVybShUZXJtOjpWYXIoaWQpKSkgPT4gKE5vbmUsIE5vbmUpID0+IGlkMSA9PSBpZDIsCiAgICAgICAgICAgICAgICBfID0+IG5pdCBvZiBnYXMuIFRoaXMgaXMgYXJiaXRyYXJ5IGJ1dCB1bmltcG9ydGFudC4KICAgIGNvbnNpZGVyIHVud3JhcHBpbmcgdHdvIHRodW5rcyBhcyBvbmx5IG9uZSBvcGVyYS4gSG93ZXZlciwgd2UgbWF5IGFzc3VtZSB0aGF0IGBlbnZgIGlzIGEgbG9jYWwgZW52ICAvLyB3ZSBvbmx5IGVxdWF0ZSBhcnJheXMgd2l0aG91dCBhZGRpdGlvbmFsIGNvbnQgIGFycl9kYXRhMS5hcnJheS5sZW4oKSA9PSBhcnJfZGF0YTIuYXJyYXkubGVuKCkKIHkpLCBWYWx1ZUNvbnRlbnRSZWY6OlJlY29yZChDb250YWluZXI6OkVtcHR5KSkgPT4gcmFjdF9lcV9ib3VuZGVkKHN0YXRlLCBhcmcxLCBlbnYxLCBhcmcyLCBlbnYyKSwKICA9PiBiMSA9PSBiMiwKICAgICAgICAoVmFsdWVDb250ZW50UmVmOjpFbnVtVmFyaWFudHNhbWUgZGVmaW5pdGlvbiAod2hpbGUgdGhlIHB1cnBvc2VseSBsaW1pdGVkCiAgICAgYW5kIGdpdmVuIHRoZSByZW1haW5pbmcgZ2FzCi8vLyBpbiBgc3RhdGVgLgpmbiBjbyBhcmUgcHJpbnRlZCB0aGUgc2FtZSBvciBub3QuCi8vLwovLy8gQ29tcHV0ZSBlcXVhYXJhbWV0ZXJzCi8vLwovLy8gLSBgZW52YDogYW4gZW52aXJvbm1lbnQgbWFwcGluZyBlZCBpbiBwcmFjdGljZS4KcHViIGNvbnN0IE1BWF9HQVM6IHU4ID0gMTI7CgovLy8gUyAgICBpZGVudGlmaWVyOjpMb2NJZGVudCwKICAgIHRlcm06OntJbmRleE1hcCwgT3AxaGF2ZSB0bwovLyEgd29ycnkgYWJvdXQgbG9vcHMgYW55bW9yZS4KdXNlIHN1cGVyOjpoZXJlIGNvdWxkIGJlIGN5Y2xlcyBpbiB0aGUKLy8hIGdyYXBoIGxlYWRpbmcgdG8gYXRzIHRoYXQgbWF5IGFwcGVhciBpbmxpbmVkIGluc2lkZSBhbiBhbm5vdGF0aW9uCi8vb24sIHVuZm9sZGluZyBzaW1wbGUgZm9ybXMgYW5kIGZvbGxvd2luZyB2YXJpYWJsZXMvLyEgQ29tcHV0YXRpb24gb2YgY29udHJhY3QgZXF1YWxpdHkuCi8vIQovLyEgVGhpc2luYXJ5KF8pID0+IHsKICAgICAgICAgICAgICAgIC8vIFRoaXMgZG9lc24ndCBoYXBwICAgICZtdXQgc3RhdGUsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0cnVlLAogICAgd2Vic29ja2V0LnNlbmQoTWVzc2FnZTo6VGV4dChtZXNzYWdlKSk/OwogICAgZHVyYXRpb246IFRpbWVzdGFtcDo6WkVSTywKICAgICAgZW5kOiBzcGFuX2VuZCwKICBTb21lKHBhcmVudCkgPSBjdXJyZW50LnBhcmVudCgpIHttYXAofChrLCB2KXwgKGsudG9fc3RyaW5nKCksIHYudG9fc3RyaW5nKCkpKQpsZXQgc3Bhbl9zdGFydCA9IHNwYW4uc3RhcnQoKSAtIHJvb3Rfc3RhcnQ7CiAgb21lKChzcGFuLCBpc19ncmFwaCkpID0gc3RvcmUuc3BhbihpZCkgewogJm11dCB1cGRhdGVfc2tpcHBlZCwKICAgICAgICAgICAgICAgICAgICAgICAgKT87CiAgICAgImFnZ3JlZ2F0ZWQtYm90dG9tLXVwIiA9PiB7dGF0ZS52aWV3ZXIuc2V0X3ZpZXdfbW9kZSgKICAgU29tZSgoVmlld01vZGU6OlJhd1NwYW5zIHsgc29ydGVkIH0sIGluaGVyaXQpKSwKICAobW9kZSwgc29ydGVkKSA9IGlmIGxldCBTb21lKG1vZGUpID0gbW9kZS5zdHJpcF9zICAgICBDbGllbnRUb1NlcnZlck1lc3NhZ2U6OlZpZXdSZWN0IHsgdmlld19yZWN0IH0oX2ZyYW1lKSA9PiB7fQogICAgICAgICAgICBNZXNzYWdlOjpUZXh0KHRleHQpID0+IGxldCBtZXNzYWdlID0gc2VyZGVfanNvbjo6dG9fc3RyaW5nKCZtZXNzYWdlKS51bndyY3Rpb25TdGF0ZSwKICAgICAgICBmb3JjZV9zZW5kOiBib29sLAogICAgICAgIHJlYWR0IHJlYWR5X2Zvcl91cGRhdGUgPSB0cnVlOwoKICAgIGZuIHNlbmRfdXBkYXRlKAogICBsZXQgRXJyKGVycikgPSBoYW5kbGVfY29ubmVjdGlvbih3ZWJzb2NrZXQsIHN0b3JlYiBmbiBzZXJ2ZShzdG9yZTogQXJjPFN0b3JlQ29udGFpbmVyPiwgcG9ydDogdTE2KSBwdWIgdmFsdWVfbW9kZTogU3RyaW5nLAogICAgcHViIHZhbHVlX2ZpbHRlcjogT3B0aW1lX2FsbCA9ICJjYW1lbENhc2UiKV0KICAgIFZpZXdSZWN0IHsKICAgICAgICB2aWV3ICAgIGNwdTogVGltZXN0YW1wLAogICAgICAgIGFsbG9jYXRpb25zOiB1NjQsCiAgICAia2ViYWItY2FzZSIpXQpwdWIgZW51bSBTZXJ2ZXJUb0NsaWVudE1lc3NhZ2UgewogdEFkZHJWNCwgVGNwTGlzdGVuZXIsIFRjcFN0cmVhbX0sCiAgICBzeW5jOjp7QXJjLCBhaXQoKTsKICAgICAgICAgICAgICAgICAgICAgICAgZmluaXNoZWQgKz0gMTsKICAgbmVyLnNjaGVkdWxlKCZjdHgsICgqdGFzaywgKmNwdSksICp0YXNrKTsKICBpc2hlZCA9IDA7CiAgICAgICAgICAgIGZvciBhY3Rpb24gaW4gYWN0aW9ucyB7CiBpb246OkZpbmlzaCgzKSwKICAgICAgICBdOwoKICAgICAgICAvLyBSdW4gaW4gYSBibC8gVGhlbiBsZXQgdGhlIHJlc3Qgb2YgdGhlIHdhaXRpbmcgdGFza3MgdGhyb3VnaAogdGFza3MKICAgICAgICAgICAgQWN0aW9uOjpTY2hlZHVsZSgxMCwgZmFsc2UpLAogICBhbmQgMSByZWFjaCBjb21wbGV0ZSB3aGljaCBhbGxvd3MgNCBhbmQgNSB0byBzdGFyLyBUaGVzZSBzbmVhayBpbiBkdXJpbmcgYSB0aHJlYWQgcmFjZQogICBoZWR1bGVTdGFydCh1MzIsIGJvb2wpLCAvLyB0cnVlIGlmIGNwdSwgZmFsc2UgaWYgdyBUaGUgZW5kaW5nIGJhcnJpZXIgaXMgc3luYyEKICAgICAgICBjdHhfY2xvbmUudGFza19iYXJyaWVyc1t0YXNrIGFzIHVzaXplXS4wLndhaXQobiEoIkNvbXBsZXRpb24gb3JkZXI6IHs6P30iLCBjb21wbGV0aW9uX29yZGVyKTsKICByY2UgYSByZWFzb25hYmxlIG9yZGVyaW5nIGFuZCB0aGVyZSdzIGEgYml0IG9mIGEgciAgICB0ZXN0X21peGVkX2NwdV9ib3VuZF9hbmRfd2FpdGluZ190YXNrc19pbXBsKCksdXRpb24gb3JkZXIgZGV0ZXJtaW5pc3RpY2FsbHkuCiAgICAjW3Rlc3RdCiAgIFBVLWJvdW5kIChzaW11bGF0ZWQgdXNpbmcgYSBub24tdG9raW8gYmFycmllcikKICAgbG4hKCJTY2hlZHVsaW5nIHRhc2sge30uLi4iLCBpKTsKICAgICAgICAgICAgcnVubmUgICB0YXNrOiB1MzIsCiAgICAgICAgICAgICAgICBfcHJpb3JpdHk6IHUzMnN1bHRzWzIuLjRdLmNvbnRhaW5zKCY4KSk7CiAgICAgICAgLy8gVGhlIGxhc3QgdGFzVGhpcyBtZWFucyB0aGUgaGlnaGVzdCBwcmlvcml0eSB0YXNrcyBhcmUgZXhlY3V0ZWQzMiwgXz4+ID0KICAgICAgICAgICAgQXJjOjpuZXcoUHJpb3JpdHlSdW5uZXI6Om5ld3RleHQuY2xvbmUoKTsKICAgICAgICAgICAgICAgIEJveDo6cGluKGFzeW5jICBpbXBsIEV4ZWN1dG9yPE11dGV4PFZlYzx1MzI+PiwgdTMyLCB1MzI+IGZvciBFeGUgIC8vIEFsbCB0YXNrcyBhZnRlciB0aGF0IGFyZSBxdWV1ZWQgYW5kIHRoZXJlZm9yZWV0IHJlc3VsdHMgPSBBcmM6Om5ldyhNdXRleDo6bmV3KFZlYzo6bmV3KCkpKTsKCiAgICBzbGVlcChEdXJhdGlvbjo6ZnJvbV9taWxsaXMoKHRhc2sgYXMgdTY0ICsgMSkgbmcsCiAgICAgICAgfQogICAgfQp9CgojW2NmZyh0ZXN0KV0KbW9kIHRlc3RzIHsKICA8U2VsZjo6T3V0cHV0PiB7CiAgICAgICAgbGV0IHRoaXMgPSBzZWxmLmdldF9tdXQoKSAgICB0aGlzLnJ1bm5lci5kZWNyZWFzZV9hY3RpdmVfd29ya2Vycyh0aGlzLmV4ZWN1cmUgcmVwbGFjaW5nIHRoZSBmdXR1cmUgd2l0aCBhIG5ldyBvbmUsIGJ1dCB0aGVvbmUsIHdlIG5lZWQgdG8gY2hlY2sgdGhlIHF1ZXVlIGZvciBtb3JlIHRhc2tzLAogIC8gVGhlcmUgYXJlIG1vcmUgYWN0aXZlIHdvcmtlcnMgdGhhbiB0YXJnZXQsIHNvIHN0aWxsIHBlbmRpbmcsIHdlIG5lZWQgdG8gc3VzcGVuZCB0aGlzIHdvcmtlci4KICAgIC8vIE5vdGlmeSB0aGF0IHRoZSB0YXNrIGlzIGRvbmUKICAgICAgICAqdGhpcy5zdGF0ZSA9IFdvcmtlclN0YXRlOjpVbmZpbmlzaGVkRnV0dXJlOwpuIHBvbGwoc2VsZjogUGluPCZtdXQgU2VsZj4sIGN4OiAmbXV0IENvbnRleHQ8J18+KWljLAo+IFdvcmtlckZ1dHVyZTxDLCBULCBQLCBFPgp7CiAgICBmbiBzcGF3bigKICAgcGw8CiAgICBDOiBTZW5kICsgU3luYyArICdzdGF0aWMsCiAgICBUOiBTZW5kICsgJ3N9Cn0KCiNbZGVyaXZlKERlYnVnKV0KZW51bSBXb3JrZXJTdGF0ZSB7CiAgICBVbmZpbn0KfQoKZm4gc2hyaW5rX2Ftb3J0aXplZDxQLCBUPihxdWV1ZTogJm11dCBCaW5hcnlIdDogJkFyYzxDPiwKICAgICAgICB1bnVzZWRfYWN0aXZlX2NvdW50OiBib29sLAogICAgIGZuIHBvcF9mdXR1cmVfZnJvbV93b3JrZXIoCiAgICAgICAgJnNlbGYsCiAgIHNlbGYuYWN0aXZlX3dvcmtlcnMuZmV0Y2hfc3ViKDEsIE9yZGVyaW5nOjpSZWxheGVkcmtlcl9pZl93b3JrX2F2YWlsYWJsZShleGVjdXRlX2NvbnRleHQsIHRydWUpCiAgICAvLy8gVHJpZXMgdG8gZGVjcmVhc2UgdGhlIGFjdGl2ZSB3b3JrZXIgY291bnQgYnkgICAgcXVldWUucHVzaChIZWFwSXRlbSB7IHByaW9yaXR5LCB0YXNrLCB0eCB9KTsKICAgcXVldWUgaXMgZW1wdHksIHNvIHdlIG1pZ2h0IGhhdmUgZnJlZSBjYXBhY2l0eSB0byBsZXQgKHR4LCByeCkgPSB0b2tpbzo6c3luYzo6b25lc2hvdDo6Y2hhbm5lbCgpOwogICAgIHBoYW50b206IHN0ZDo6bWFya2VyOjpQaGFudG9tRGF0YSwKICAgcG9uZGVkIHdpdGggUG9sbDo6UGVuZGluZyBhcmUgbm90IGNvdW50ZWQgdW50aWwgdGh0aWFsX2NtcCgmc2VsZiwgb3RoZXI6ICZTZWxmKSAtPiBPcHRpb248c3RkOjpjbXA6OiA9ICgpPiArIFNlbmQsCnsKICAgIHR5cGUgRnV0dXJlID0gRnV0OwoKICAgIGZuIGV4dXNlIHBhcmtpbmdfbG90OjpNdXRleDsKdXNlIHBpbl9wcm9qZWN0X2xpdGU6OnBpbl8gIGZtdDo6RGVidWcsCiAgICBmdXR1cmU6OkZ1dHVyZSwKICAgIHBpbjo6UGluLAogIGQgdG8gc2VuZCBTSUdJTlQgdG8gcHJvY2VzcyB7cGlkfSwgc2VuZGluZyBTSUdLSUxMICAgIHdoaWxlIGxldCBPayhOb25lKSA9IHByb2MudHJ5X3dhaXQoKSB7CiAgICB1c2Ugc3RkOjp0aW1lOjpEdXJhdGlvbjsKCiAgICB1c2Ugbml4Ojp7CiBpbXBsIERyb3AgZm9yIFByZXBhcmVkQXBwPCdfPiB7CiAgICBmbiBkcm9wKCZtdXRzc2VydCEoZXJyb3JzLm5leHQoKS5ub3dfb3JfbmV2ZXIoKS5pc19ub25lKCkpOwoKICBKYXZhU2NyaXB0IGFuZCB3YWl0IG9ubHkgZm9yIHRoZSBIVE1MIHJlc3BvbnNlIHRvKSBoZXJlIHNpbmNlIHRoaXMgd2lsbCB3YWl0IGZvciB0aGUgbmF2aWF0aW9uIHRvIGJ0KCJGYWlsZWQgdG8gYWRkIGJpbmRpbmdzIHRvIHRoZSBicm93c2VyIHRhYiIpPzsKCnZlci5hc19yZWYoKS5jb250ZXh0KCJTZXJ2ZXIgbXVzdCBiZSBzdGFydGVkIik/OwogciA9IHRlbXBmaWxlOjp0ZW1wZGlyKCk/OwoKICAgICAgICB0b2tpbzo6ZnM6OmNyZSBwdWIgYXN5bmMgZm4gbmV3KGJ1bmRsZXI6ICYnYSBkeW4gQnVuZGxlciwgdGVtcGxhICAgY29weV9kaXJfaW5uZXJfc2VuZChlbnRyeS5wYXRoKCksIHRvLCBzZW1hcGhmczo6cmVhZF9kaXIoZnJvbSkpLmF3YWl0Pz87CiAgICAgICAgZm9yIGVudHJ5IGluIHBob3JlOiBBcmM8U2VtYXBob3JlPiwKKSAtPiBpbXBsIEZ1dHVyZTxPdXRwdXQgPSBhdGFzazo6c3Bhd25fYmxvY2tpbmd9Owp1c2UgdXJsOjpVcmw7Cgp1c2UgY3JhdGU6OnsgIG1hcC5pbnNlcnQoSEFTSF9SRS5yZXBsYWNlKCZrLCAiIikuaW50b19vd25lZCgpLCBzdGF0aWMgSEFTSF9SRTogTGF6eTxSZWdleD4gPSBMYXp5OjpuZXcofHwgUmVnZXg6aWZpZXJzIGNhbiBjb250YWluIHRoZSBjcmF0ZSBuYW1lLCByZW1vdmUgaXQgdG8gc2lhbHVlX3RyYWl0XQpwdWIgdHJhaXQgRG91YmxhYmxlIHsKIGlvbl0KZm4gd3JhcCh2YWw6IHU2NCkgLT4gVmM8V3JhcHBlZFU2ND4gewogICAgV3JhCgovLyBJbnRlcm5hbGx5LCB0aGlzIGZ1bmN0aW9uIHVzZXMgYFBlcnNpc3RlbnRUYXNfZXEhKAogICAgICAgICAgICBzdGF0c19qc29uKCksCiAgICAgICAgICAgIGpzb24hKH0KCi8vIGNyZWF0ZXMgVmNzLCBidXQgZG9lc24ndCBldmVyIGV4ZWN1dGUgdGhlbQojc3VsdHMgd2l0aG91dCBkeW5hbWljIGRpc3BhdGNoCiAgICAgbGV0IF8gPSB0b2tpbzo6dHJ5X2pvaW4hKHd2Yy5kb3VibGUoKS5yZXNvbHZlKCksICAgKTsKICAgICAgICBPaygoKSkKICAgIH0pCiAgICAuYXdhaXQKfQoKIyAgfSwKICAgICAgICAgICAgICAgICJXcmFwcGVkVTY0OjpEb3VibGFibGU6OmRvdWJsYyBmbiB0ZXN0X3RyYWl0X21ldGhvZHMoKSAtPiBSZXN1bHQ8KCk+IHsKICAgIHJ1bl8gIC8vIHVzZSBjYWNoZWQgcmVzdWx0cwogICAgICAgICAgICBkb3VibGVfdmMoZHZjKSAgICAgZW5hYmxlX3N0YXRzKCk7CiAgICAgICAgZm9yIGkgaW4gMC4uMTAgewogICAvLyB0aGlzIGlzIGF3YWl0ZWQgbXVsdGlwbGUgdGltZXMsIGJ1dCBvbmx5IHJlc29fd2l0aG91dF9jYWNoZV9jaGVjaygmUkVHSVNUUkFUSU9OLCBhc3luYyBtb3ZlIHsKIFJlZ2lzdHJhdGlvbiA9IHJlZ2lzdGVyISgpOwoKI1t0b2tpbzo6dGVzdChmbGF2b3IgICAvLyBUT0RPIGhhbmRsZSBTb3VyY2VNYXAKICAgICAgICBsZXQgZmlsZSA9IEZpbGVoaWNoIGhhcyBhbHJlYWR5IGJlZW4gY29udmVydGVkIGludG8gYW4gaXNzdWUuCiAgIGFwaCwKICAgICAgICAgICAgcmVzb2x2ZV9vcHRpb25zX2NvbnRleHQ6IE5vbmUsCiAgLy8gVGhpcyBzaG91bGRuJ3QgYmUgYW4gZXJyb3Igc2luY2UgaXQgY2FuIGhhcHBlbiBmYWxzZSwKICAgICAgICApKQogICAgICAgIC5jb25uZWN0KCkKICAgICAgICAudG9fcmxsKCkpOwogICAgICAgIH07CiAgICAgICAgbGV0IGNvbnRlbnQgPSBjb250ZW50LmNvZWxmLnNvdXJjZS5jb250ZW50KCkudG9fcmVzb2x2ZWQoKS5hd2FpdD8sCiAgIGlnLmpzKSAvLyBUaGUgYWN0dWFsIGNvbmZpZyB3ZSdyZSBsb29raW5nIGZvcgogICAgIHRoZXJlIGlzIG5vIGd1YXJhbnRlZSB0aGF0IGxvb2tpbmcgdXAgZm9yIHRoZQogICAgICBTb21lKHNvdXJjZSkgPT4gT2soc291cmNlLmdlbmVyYXRlX3NvdXJjZV9tYXAoKTo6UHJvamVjdFBhdGhPckxvY2FsUGF0aCkKICAgICAgICAmJiBsZXQgRmluZENvbnRlKGZ4aW5kZXhtYXAhIHsKICAgICAgICAgICAgcmNzdHIhKCJDT05GSUciKSA9PiBjb24gIE9rKGFzc2V0X2NvbnRleHQucHJvY2VzcygKICAgICAgICBWYzo6dXBjYXN0KEZpbGVyZGVfanNvbjo6dG9fc3RyaW5nKCZjb25maWdfcGF0aCkuZXhwZWN0KCJhIHN0cmluIC8vIGNvbnZlcnQgaXQgdG8gYSBmaWxlOi8vIFVSTCwgd2hpY2ggd29ya3Mgb24gYWwgICAgIGJhaWwhKCJVbmFibGUgdG8gZ2V0IHJlbGF0aXZlIHBhdGggdG8gcG9zdCAgLy8gV2UgY2FuIG9ubHkgbG9hZCBqcyBmaWxlcyB3aXRoIGBpbXBvcnQoKWAuCiAgaWxlbmFtZSA9IHBvc3Rjc3NfY29uZmlnX3BhdGhfdmFsdWUuZmlsZV9uYW1lKCk7CgogICAgYW55aG93OjpiYWlsISgiSW52YWxpZCBmaWxlIHR5cGUgezo/fSIsIGZpbGVfdCBsZXQgdmFsdWUgPSBtYXRjaCAmKnNlbGYua2V5LmF3YWl0PyB7CiAgICAgICBOb25lID0+IE9rKEFzc2V0SWRlbnQ6OmZyb21fcGF0aChzZWxmLnBhdGguYXBhbHVlXQpwdWIgc3RydWN0IEpzb25Tb3VyY2UgewogICAgcHViIHBhdGg6IEZpbGV0PzsKCiAgICBPayhWYzo6PENvbXBsZXRpb25zPjo6Y2VsbChjb25maWdzKS5jb21wbCAgaWYgbWF0Y2hlcyEoJipwYXRoLmdldF90eXBlKCkuYXdhaXQ/LCBGaWxlUyBsZXQgY29uZmlnX3BhdGhzID0gWwogICAgICAgIHBhcmVudF9wYXRoLmpvaW4oInRhICAgICBSZWZlcmVuY2VUeXBlOjpJbnRlcm5hbChJbm5lckFzc2V0czo6ZW1wdHkoKS4gICBhc3luYyBmbiBjb250ZW50KHNlbGY6IFZjPFNlbGY+KSAtPiBSZXN1bHQ8VmM8QWN0aW9uXQogICAgZm4gaWRlbnQoJnNlbGYpIC0+IFZjPEFzc2V0SWRlbnQ+IHsKIG50ZXh0LAogICAgICAgICAgICAgICAgY29uZmlnX2xvY2F0aW9uOiBzZWxmLmNvbmZybSBmb3IgUG9zdENzc1RyYW5zZm9ybSB7CiAgICAjW3R1cmJvX3Rhc2tzOjpmdW5jdFBvc3RDc3NDb25maWdMb2NhdGlvbiwKICAgIHNvdXJjZV9tYXBzOiBib29sLAp9Cgojc3MuY29uZmlnLm10cyIsCiAgICAgICAgICAgICJwb3N0Y3NzLmNvbmZpZy5jdHMiLApzc3JjLmpzb24iLAogICAgICAgICAgICAiLmNvbmZpZy9wb3N0Y3NzcmMueWFtbCIsCiBUYXNrSW5wdXQsCiAgICBOb25Mb2NhbFZhbHVlLAogICAgRW5jb2RlLAogICAgRGVjZ2V0X2V2YWx1YXRlX2VudHJpZXMsCiAgICBleGVjdXRpb25fY29udGV4dDo6RXhlY3VHcmFwaCwgU2luZ2xlTW9kdWxlR3JhcGh9LAogICAgcmVmZXJlbmNlX3R5cGU6OntFbnR1cmJvcGFja19jb3JlOjp7CiAgICBhc3NldDo6e0Fzc2V0LCBBc3NldENvbnRlbnR9CnVzZSBiaW5jb2RlOjp7RGVjb2RlLCBFbmNvZGV9Owp1c2UgaW5kb2M6OmZvcm1hdGRlIGRpcmVjdG9yeSwgYW5kIHJlY29uZmlndXJlcyB0aGUgdmFyaW91cyBkZXJpdmVkIHM6IHRoZXkgYXJlIGNvbnN0YW50cywgYW5kIHdlIGtub3cgdGhleSdyZSB2YWxpZCB1LyBDcmVhdGUgYSBuZXcgY29uZmlndXJhdGlvbiB3aXRoIGRlZmF1bHQgc2V0dGluZ3MgdGhlIG9yaWdpbmFsIHNvdXJjZSB3aWxsIGJlIHRyYW5zcGFyZW50bHkgZmV0Y2hlZGhlIGNvbnRlbnRzIG9mCiAgICAvLy8gdGhlIHBhY2thZ2VzIGluIHRoZSBpbmRleCkuRkFVTFRfSU5ERVhfVVJMOiAmc3RyID0gImh0dHBzOi8vZ2l0aHViLmNvbS9uaWNrZWwoaW5zaWRlLCBhZnRlcikgPSBzYWZlX3NwbGl0X2F0KGwsIGVuZF9jb2x1bW4pOwogICBsZXQgcmVhbF9zdGFydCA9IGwuZmxvb3JfY2hhcl9ib3VuZGFyeShzdGFydF9jb2x1ICAgcmVzdWx0LnB1c2goU291cmNlQ29udGV4dExpbmU6OlN0YXJ0IHsKICAoT3JkZXJpbmc6Okxlc3MsIF8pIHwgKF8sIE9yZGVyaW5nOjpHcmVhdGVyKSA9PiB7ICBmbiBsaW1pdF9sZW4oczogJnN0cikgLT4gQ293PCdfLCBzdHI+IHsKIGZuIGdldF9zb3VyY2VfY29udGV4dDwnYT4oCiAgICBsaW5lczogaW1wbCBJdGVyYXQgICAgIGZvciBsaW5lIGluICZzZWxmLjAgewogICAgICAgICAgICB3cml0ZSEoZiwgKGYsICIgICAgICAgfCB7fXYiLCAiICIucmVwZWF0KGJlZm9yZS5sZW4oKSkpPyAgIH0gPT4gewogICAgICAgICAgICAgICAgaWYgaW5zaWRlLmxlbigpID49IDIgewogICAgICB3cml0ZWxuIShmLCAie2xpbmU6PjZ9ICsge2JlZm9yZX17aW5zaWRlfSIpCiBmbXQ6OlJlc3VsdCB7CiAgICAgICAgbWF0Y2ggc2VsZiB7CiAgICAgICAgICAgIFNvdW9ycm93OjpDb3csIGNtcDo6T3JkZXJpbmcsIGZtdDo6RGlzcGxheX07CgpwdWIgZW51ICBmbiB2aXNpdF9pZGVudCgmbXV0IHNlbGYsIGk6ICZJZGVudCkgewogbm9yZSB0aGUgcmVxdWlyZSBpdHNlbGYgKGZvbyA9IHJlcXVpcmUoJ2ZvbycpKQogIERlY2xhcmF0b3IpIHsKICAgICAgICBsZXQgbXV0IHNhZmVfdG9faWdub3JlID0gZmFsICAgIG1vZHVsZV9zcGVjaWZpZXI6IHYudmFsdWUuY2xvbmUoKSwKIHNlbGYuc2hvdWxkX3Jld3JpdGUoJnYudmFsdWUpLmlzX3NvbWUoKSB7CiAgIC4uCiAgICAgICAgfSkpID0gbi5pbml0LmFzX2RlcmVmKCkKICAgICAgICB7CiAgZiB2LmRlY2xzLmlzX2VtcHR5KCkgewogICAgICAgICAgICAgICAgbi50YWtlKCk7CiBtdHMuZHJhaW4oLi4pLm1hcChNb2R1bGVJdGVtOjpTdG10KSwKICAgICAgICApOwoKIHdpdGgoJm11dCBBbmFseXplciB7CiAgICAgICAgICAgIGRhdGE6ICZtdSAgICAga2luZDogVmFyRGVjbEtpbmQ6OkNvbnN0LAogICAgICAgfSBlbHNlIHsKICAgIGlmICFzZWxmLmRhdGEuZXh0cmFfc3RtdHMuaXRlcigpLmFueSh8c3wgewogICAgICAgYXJnczogdmVjIVtFeHByOjpMaXQoTGl0OjpTdHIoCiAgICAgaW5pdDogU29tZShCb3g6Om5ldyhFeHByOjpNZW1iZXIoTWVtYmVyRXhwciB7CiAgICAgICBuYW1lOiBQYXQ6OklkZW50KG5ld19pZC5jbG9uZSgpLmludG8oKSksCiAgcmQubW9kdWxlX3NwZWNpZmllci5jbG9uZSgpLCBwcm9wLnN5bS5jbG9uZSgpKSkKICAgbGV0IE1lbWJlclByb3A6OklkZW50KHByb3ApID0gJm4ucHJvcCB7CiAgLnZpc2l0X211dF9jaGlsZHJlbl93aXRoKHNlbGYpOwogICAgICAgIHNlbGYuZGF0YS4gYChpZGVudGlmaWVyKTogKG1vZHVsZV9yZWNvcmQpYAogICAgaW1wb3J0czogRnhIYXJpdmUoQ2xvbmUsIERlYnVnLCBEZXNlcmlhbGl6ZSldCiNbc2VyZGUocmVuYW1lX2FsICAgIH0sCn07CgpwdWIgZm4gY2pzX29wdGltaXplcihjb25maWc6IENvbmZpZywgdW51c2UgcnVzdGNfaGFzaDo6e0Z4SGFzaE1hcCwgRnhIYXNoU2V0fTsKdXNlIHNlcmRlOmlua19pZHgsIHRhcmdldCkKICAgICAgICB9KQogICAgICAgIC50cnlfam9pbigpCiAgeXN0ZW1QYXRoLAogICAgdXBkYXRlczogVmVjPCh1c2l6ZSwgdXNpemUpPiwKKSAtPiB0ZW1fb3BlcmF0aW9uKGZzX3Jvb3Q6IFJjU3RyKSAtPiBWYzxEaXNrRmlsZVN5c3RlbSAgLy8gRmluYWwgc3VtbWFyeQogICAgICAgIGxldCBlbGFwc2VkID0gc3RhcnRfdGltU19JTlRFUlZBTAogICAgICAgICAgICBsZXQgbm93ID0gSW5zdGFudDo6bm93KCk7CiAgICAuY29sbGVjdCgpOwoKICAgICAgICAgICAgLy8gRXhlY3V0ZSB3cml0ZXMgaW4gcCAgLy8gR2VuZXJhdGUgcmFuZG9tIHN5bWxpbmsgdXBkYXRlcyBmb3IgdGhpcyBiYXRjX3BhdGguY2xvbmUoKSwgc3ltbGlua19jb3VudCwgaW5pdGlhbF90YXJnZXQpOwogICBsZXQgc3ltbGlua3NfcGF0aCA9IHByb2plY3Rfcm9vdC5qb2luKCJfc3ltbGlua3MiKFR1cmJvVGFza3NCYWNrZW5kOjpuZXcoCiAgICAgICAgQmFja2VuZE9wdGlvbnM6OmQ6OmNyZWF0ZV9kaXIodGFyZ2V0c19kaXIuam9pbihpLnRvX3N0cmluZygpKSk/OwogICAgICB0YXJnZXRfY291bnQ6IHVzaXplLAogICAgLy8vIE51bWJlciBvZiBzeW1saW5rYXRpb24gPSBEdXJhdGlvbjo6ZnJvbV9zZWNzKDEpOwoKdXNlIGNsYXA6OkFyZ3M7CnV1c2Ugc3RkOjp7CiAgICBwYXRoOjp7UGF0aCwgUGF0aEJ1Zn0sCiAgICB0aW1lOjp7RFNvbWUoY2h1bmtfaXRlbSkgPSBSZXNvbHZlZFZjOjp0cnlfZG93bmNhc3Q6OjxCb3g8ICAgIC5pbnRvX2l0ZXIoKQogICAgICAgICAgICAgICAgLm1hcCh8YmF0Y2hfZ3JvdXBodW5raW5nX2NvbnRleHQ6IFZjPEJveDxkeW4gQ2h1bmtpbmdDb250ZXh0Pj4sCiAgIHZhbHVlX2ltcGxdCmltcGwgVmFsdWVUb1N0cmluZyBmb3IgRWNtYXNjcmlwdENodW5rIH0KfQp1c2UgYW55aG93Ojp7UmVzdWx0LCBiYWlsfTsKdXNlIHR1cmJvX3Jjc3RyOjpwdXQ7CiAgICBwcmludGxuISgiaW1tdXRhYmxlX2ZuKCkiKTsKICAgIFZjOjpjZWxsKCAgICAgc3RhdGU6IFN0YXRlOjpuZXcoMCksCiAgICB9CiAgICAuY2VsbCgpKQp9CgojICAgIC5hd2FpdAogICAgLnVud3JhcCgpOwp9CgojW3R1cmJvX3Rhc2tzOjp2YWx1ZV0gICBhc3NlcnRfZXEhKCpyZWFkX2lucHV0LnN0cm9uZ2x5X2NvbnNpc3RlbnQoKS5hd3VlX3Jlc29sdmVkID0gY2hhbmdpbmdfdmFsdWUucmVzb2x2ZSgpLmF3YWl0PzsKICAgciA9ICJtdWx0aV90aHJlYWQiLCB3b3JrZXJfdGhyZWFkcyA9IDIpXQphc3luYyBmbiBdCiMhW2ZlYXR1cmUoYXJiaXRyYXJ5X3NlbGZfdHlwZXNfcG9pbnRlcnMpXQojIVthbG4gaW5jb3JyZWN0IGNhY2hlIGludmFsaWRhdGlvbi4KICAgIHB1YiBmbiB1cGRhdGVfbm5lci5zZXRfdW5jb25kaXRpb25hbGx5KFNvbWUodmFsdWUpKTsKICAsIE9wdGlvbjxUPj4gewogICAgICAgIG1hcmtfc2Vzc2lvbl9kZXBlbmRlbnQoKTsKIGwgYmUgaW52YWxpZGF0ZWQgd2hlbiB0aGUgc3RhdGUKICAgIC8vLyBjaGFuZ2VzLgogdWx0KCkgLT4gU2VsZiB7CiAgICAgICAgLy8gTmVlZCB0byBiZSBleHBsaWNpdCB0byAiKV0KICAgIGlubmVyOiBNdXRleDxTdGF0ZUlubmVyPE9wdGlvbjxUPj4+LAp9CgpmbmhlbiB0aGUgYHZhbHVlYCBpcyBkaWZmZXJlbnQgZnJvbSB0aGUgY3VycmVudAogICAgdGlvbiBpcyBub3QgYWxsb3dlZCBhbmQgd2lsbAogICAgLy8vIHJlc3VsdCBpbiBpbmN2YWx1ZS4gVGhpcwogICAgLy8vIHNob3VsZCBvbmx5IGJlIHVzZWQgaWYgb25lIGlzIHQgaW5uZXIgPSBzZWxmLmlubmVyLmxvY2soKTsKICAgICAgICBpZiBsZXQgU29tZShpYWx1ZSBvZiB0aGUgc3RhdGUuIFRoZSBjdXJyZW50IHRhc2sgd2lsbCBiZSByZWdpc3QoRGVmYXVsdDo6ZGVmYXVsdCgpKQogICAgfQp9CgppbXBsPFQ+IFBhcnRpYWxFcSBmb2ZtdCgmc2VsZiwgZjogJm11dCBzdGQ6OmZtdDo6Rm9ybWF0dGVyPCdfPikgLT4gc3RkZnVuY3Rpb24gY2FsbHMgYXJlIHJlY29ubmVjdGVkCi8vLyB3aXRoIHRoZSBwYXJlbnRvbGxlY3RpYmxlc1NvdXJjZV0gaW5zdGVhZCBvZgovLy8gc3RhdGUgd2hlcmUgYXQgYWV4OjpuZXcoVDo6Ym9ycm93X2RlY29kZShkZWNvZGVyKT8pKQogICAgfQp9CgovLy8gb2RlcjogJm11dCBFLAogICAgKSAtPiBSZXN1bHQ8KCksIEVuY29kZUVycm9yPiB7CiBudGVyZWQoKTsKICAgICAgICAgICAgbGV0IGludmFsaWRhdG9ycyA9IHRha2UoJm11dGV0ID0gVDsKCiAgICBmbiBkZXJlZigmc2VsZikgLT4gJlNlbGY6OlRhcmdldCB7CiAgfQoKcHViIHN0cnVjdCBTdGF0ZVJlZjwnYSwgVD4gewogICAgc2VyaWFsaXphdGlvbl8gc2VsZiwgdmFsdWU6IFQpIC0+IGJvb2wgewogICAgICAgIGlmIHNlbGYudmFsdWUgPSgmbXV0IHNlbGYudmFsdWUpIHsKICAgICAgICAgICAgcmV0dXJuIGZhbHNlOwogICAgOjpuZXcoKSwKICAgICAgICB9CiAgICB9CgogICAgcHViIGZuIGFkZF9pbnZhbGlkYXRUcmFjZVJhd1ZjcywKfTsKCiNbZGVyaXZlKEVuY29kZSwgRGVjb2RlKV0Kc3RydWN0IA==';

let cachedDictionary: Buffer | null = null;

export function getRustDictionary(): Buffer {
  if (!cachedDictionary) {
    cachedDictionary = Buffer.from(DICTIONARY_BASE64, 'base64');
  }
  return cachedDictionary;
}

export const RUST_DICTIONARY_META: DictionaryMeta = {
  name: 'Rust Dictionary',
  version: '2.0.0',
  description: 'Trained ZSTD dictionary optimized for Rust code compression',
  frameworks: ["rust","cargo"],
  sizeBytes: 379297,
  patternCount: 0, // Trained dictionary - patterns are internal
  trainedOn: ['sample rust files'],
};
