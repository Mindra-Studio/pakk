/**
 * PAKK Trained ZSTD Dictionary for React/Next.js
 *
 * This is a REAL trained ZSTD dictionary (not just text patterns).
 * Trained using: zstd --train on sample React/Next.js files.
 *
 * Size: 524288 bytes
 * Generated: 2026-01-31T16:08:29.409Z
 */

import type { DictionaryMeta } from '../core/types.js';

// Base64-encoded trained ZSTD dictionary
const DICTIONARY_BASE64 = 'N6Qw7F41uxM+EKiisQ4wMzMhoqqqqqqqqlA5yn/oL3gqSzEF6IXEilIAH5vR1VCN7w9HKPzxSy3+gV2yVTbhtsVRM8xkhzXDACgADIyH4/F4OBoQSUVlPgSgQIuPCaIalBEPpiKBMJgkQQ6jIAghY4wxBhljzNCMzAgDACSZFS2oDCEAAAAAAAAAAAAAAAABAAAABAAAAAgAAABzQ29kZSA9IDUwMDsKICAgICAgICB9LAogICAgICB9LAogICAgKTsKCiAgICBzZXRUaW1lb3V0KGFib3J0LCBBQk9SVF9ERUxBWSk7CiAgfSk7Cn0KaW1wb3J0IHsgUHJvdG9jb2xWZXJzaW9uIH0gZnJvbSAnQHVuaXN3YXAvY2xpZW50LWRhdGEtYXBpL2Rpc3QvZGF0YS92MS9wb29sVHlwZXNfcGInCmltcG9ydCB7IHVzZU1lbW8gfSBmcm9tICdyZWFjdCcKaW1wb3J0IHsgT25jaGFpbkl0ZW1MaXN0T3B0aW9uVHlwZSwgUG9vbE9wdGlvbiB9IGZyb20gJ3VuaXN3YXAvc3JjL2NvbXBvbmVudHMvbGlzdHMvaXRlbXMvdHlwZXMnCmltcG9ydCB7IFpFUk9fQUREUkVTUyB9IGZyb20gJ3VuaXN3YXAvc3JjL2NvbnN0YW50cy9taXNjJwppbXBvcnQgeyBWMl9ERUZBVUxUX0ZFRV9USUVSIH0gZnJvbSAndW5pc3dhcC9zcmMvY29uc3RhbnRzL3Bvb2xzJwppbXBvcnQgeyBub3JtYWxpemVDdXJyZW5jeUlkRm9yTWFwTG9va3VwIH0gZnJvbSAndW5pc3dhcC9zcmMvZGF0YS9jYWNoZScKaW1wb3J0IHsgUG9vbFNlYXJjaEhpc3RvcnlSZXN1bHQgfSBmcm9tICd1bmlzd2FwL3NyYy9mZWF0dXJlcy9zZWFyY2gvU2VhcmNoSGlzdG9yeVJlc3VsdCcKaW1wb3J0IHsgdXNlQ3VycmVuY3lJbmZvcyB9IGZyb20gJ3VuaXN3YXAvc3JjL2ZlYXR1cmVzL3Rva2Vucy91c2VDdXJyZW5jeUluZm8nCmltcG9ydCB7IEN1cnJlbmN5SWQgfSBmcm9tICd1bmlzd2FwL3NyYy90eXBlcy9jdXJyZW5jeScKCmV4cG9ydCBmdW5jdGlvbiB1c2VQb29sU2VhcmNoUmVzdWx0c1RvUG9vbE9wdGlvbnMoc2VhcmNoUmVzdWx0czogUG9vbFNlYXJjaEhpc3RvcnlSZXN1bHRbXSk6IFBvb2xPcHRpb25bXSB7CiAgLy8gY29tYmluZSBhbGwgcG9vbCBzZWFyY2ggcmVzdWx0cycgdG9rZW5zJyBjdXJyZW5jeUlkcyBpbiBhbiBhcnJheSBvZiBkZS1kdXBlZCBjdXJyZW5jeUlkcwogIC8vICYgdGhlbiBmZXRjaCBjdXJyZW5jeUluZm9zIGZvciBhbGwKICBjb25zdCBjdXJyZW5jeUlkczogQ3VycmVuY3lJZFtdID0gdXNlTWVtbygKICAgICgpID0+CiAgICAgIEFycmF5LmZyb20oCiAgICAgICAgbmV3IFNldCgKICAgICAgICAgIHNlYXJjaFJlc3VsdHMuZmxhdE1hcCgocmVzdWx0KSA9PiBbCiAgICAgICAgICAgIG5vcm1hbGl6ZUN1cnJlbmN5SWRGb3JNYXBMb29rdXAocmVzdWx0LnRva2VuMEN1cnJlbmN5SWQpLAogICAgICAgICAgICBub3JtYWxpemVDdXJyZW5jeUlkRm9yTWFwTG9va3VwKHJlc3VsdC50b2tlbjFDdXJyZW5jeUlkKSwKICAgICAgICAgIF0pLAogICAgICAgICksCiAgICAgICksCiAgICBbc2VhcmNoUmVzdWx0c10sCiAgKQoKICBjb25zdCBjdXJyZW5jeUluZm9zID0gdXNlQ3VycmVuY3lJbmZvICAgIEJyb3dzZS4uLgogICAgICAgICAgICAgICAgICAgICAgICAgIDwvRHJvcGRvd25NZW51SXRlbT4KICAgICAgICAgICAgICAgICAgICAgICAgPC9Ecm9wZG93bk1lbnVHcm91cD4KICAgICAgICAgICAgICAgICAgICAgIDwvRHJvcGRvd25NZW51U3ViQ29udGVudD4KICAgICAgICAgICAgICAgICAgICA8L0Ryb3Bkb3duTWVudVBvcnRhbD4KICAgICAgICAgICAgICAgICAgPC9Ecm9wZG93bk1lbnVTdWI+CiAgICAgICAgICAgICAgICAgIDxEcm9wZG93bk1lbnVTZXBhcmF0b3IgLz4KICAgICAgICAgICAgICAgICAgPERyb3Bkb3duTWVudUl0ZW0+CiAgICAgICAgICAgICAgICAgICAgPEljb25QbGFjZWhvbGRlcgogICAgICAgICAgICAgICAgICAgICAgbHVjaWRlPSJTYXZlSWNvbiIKICAgICAgICAgICAgICAgICAgICAgIHRhYmxlcj0iSWNvbkRldmljZUZsb3BweSIKICAgICAgICAgICAgICAgICAgICAgIGh1Z2VpY29ucz0iRmxvcHB5RGlza0ljb24iCiAgICAgICAgICAgICAgICAgICAgICBwaG9zcGhvcj0iRmxvcHB5RGlza0ljb24iCiAgICAgICAgICAgICAgICAgICAgICByZW1peGljb249IlJpU2F2ZUxpbmUiCiAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgICBTYXZlCiAgICAgICAgICAgICAgICAgICAgPERyb3Bkb3duTWVudVNob3J0Y3V0PuKMmFM8L0Ryb3Bkb3duTWVudVNob3J0Y3V0PgogICAgICAgICAgICAgICAgICA8L0Ryb3Bkb3duTWVudUl0ZW0+CiAgICAgICAgICAgICAgICAgIDxEcm9wZG93bk1lbnVJdGVtPgogICAgICAgICAgICAgICAgICAgIDxJY29uUGxhY2Vob2xkZXIKICAgICAgICAgICAgICAgICAgICAgIGx1Y2lkZT0iRG93bmxvYWRJY29uIgogICAgICAgICAgICAgICAgICAgICAgdGFibGVyPSJJY29uRG93bmxvYWQiCiAgICAgICAgICAgICAgICAgICAgICBodWdlaWNvbnM9IkRvd25sb2FkSWNvbiIKICAgICAgICAgICAgICAgICAgICAgIHBob3NwaG9yPSJEb3dubG9hZEljb24iCiAgICAgICAgICAgICAgICAgICAgICByZW1peGljb249IlJpRG93bmxvYWRMaW5lIgogICAgICAgICAgICAgICAgICAgIC8+CiAgICAgICAgICAgICAgICAgICAgRXhwb3J0CiAgICAgICAgICAgICAgICAgICAgPERyb3Bkb3duTWVudVNob3J0Y3V0PuKHp+KMmEU8L0Ryb3Bkb3duTWVudVNob3J0Y3V0PgogICAgICAgICAgICAgICAgICA8L0Ryb3Bkb3duTWVudUl0ZW0+CiAgICAgICAgICAgICAgICA8L0Ryb3Bkb3duTWVudUdyb3VwPgogICAgICAgICAgICAgICAgPERyb3Bkb3duTWVudVNlcGFyYXRvciAvPgogICAgICAgICAgICAgICAgPERyb3Bkb3duTWVudUdyb3VwPgogICAgICAgICAgICAgICAgICA8RHJvcGRvd25NZW51TGFiZWw+VmlldzwvRHJvcGRvd25NZW51TGFiZWw+CiAgICAgICAgICAgICAgICAgIDxEcm9wZG93bk1lbnVDaGVja2JveEl0ZW0KICAgICAgICAgICAgICAgICAgICBjaGVja2VkPXtub3RpZmljYXRpb25zLmVtYWlsfQogICAgICAgICAgICAgICAgICAgIG9uQ2hlY2tlZENoYW5nZT17KGNoZWNrZWQpID0+CiAgICAgICAgICAgICAgICAgICAgICBzZXROb3RpZmljYXRpb25zKHsKICAgICAgICAgICAgICAgICAgICAgICAgLi4ubm90aWZpY2F0aW9ucywKICAgICAgICAgICAgICAgICAgICAgICAgZW1haWw6IGNoZWNrZWQgPT09IHRydWUsCiAgICAgICAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgICAgIDxJY29uUGxhY2Vob2xkZXIKICAgICAgICAgICAgICAgICAgICAgIGx1Y2lkZT0iRXllSWNvbiIKICAgICAgICAgICAgICAgICAgICAgIHRhYmxlcj0iSWNvbkV5ZSIKICAgICAgICAgICAgICAgICAgICAgIGh1Z2VpY29ucz0iRXllSWNvbiIKICAgICAgICAgICAgICAgICAgICAgIHBob3NwaG9yPSJFeWVJY29uIgogICAgICAgICAgICAgICAgICAgICAgcmVtaXhpY29uPSJSaUV5ZUxpbmV1c2g6IHsKICAgICAgICAgIHF1YW50aXR5OiA0LAogICAgICAgIH0sCiAgICAgIH0sCiAgICB9LAogIH07CgogIHJldHVybiAoCiAgICA8UGFydGljbGVzCiAgICAgIGlkPSJwYXJ0aWNsZXMiCiAgICAgIGluaXQ9e3BhcnRpY2xlc0luaXR9CiAgICAgIGxvYWRlZD17cGFydGljbGVzTG9hZGVkfQogICAgICBvcHRpb25zPXtvcHRpb25zfQogICAgLz4KICApOwp9OwoKZXhwb3J0IGRlZmF1bHQgUGFydGljbGVzQ29tcG9uZW50OwppbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnCmltcG9ydCB0eXBlIHsgSW1hZ2VTb3VyY2VQcm9wVHlwZSB9IGZyb20gJ3JlYWN0LW5hdGl2ZScKaW1wb3J0IHsgRmxleCwgRmxleFByb3BzLCBJbWFnZSwgTG9hZGVyLCB1c2VTcG9yZUNvbG9ycyB9IGZyb20gJ3VpL3NyYycKaW1wb3J0IHsgQUxMX05FVFdPUktTX0xPR08gfSBmcm9tICd1aS9zcmMvYXNzZXRzJwppbXBvcnQgeyBpY29uU2l6ZXMsIHpJbmRleGVzIH0gZnJvbSAndWkvc3JjL3RoZW1lJwppbXBvcnQgeyBnZXRDaGFpbkluZm8gfSBmcm9tICd1bmlzd2FwL3NyYy9mZWF0dXJlcy9jaGFpbnMvY2hhaW5JbmZvJwppbXBvcnQgeyBVbml2ZXJzZUNoYWluSWQgfSBmcm9tICd1bmlzd2FwL3NyYy9mZWF0dXJlcy9jaGFpbnMvdHlwZXMnCmltcG9ydCB7IGlzTW9iaWxlV2ViIH0gZnJvbSAndXRpbGl0aWVzL3NyYy9wbGF0Zm9ybScKCmV4cG9ydCBjb25zdCBTUVVJUkNMRV9CT1JERVJfUkFESVVTX1JBVElPID0gMC4zCgp0eXBlIE5ldHdvcmtMb2dvUHJvcHMgPSBGbGV4UHJvcHMgJiB7CiAgY2hhaW5JZDogVW5pdmVyc2VDaGFpbklkIHwgbnVsbCAvLyBudWxsIHNpZ25pZmllcyB0aGlzIGlzIHRoZSBBbGxOZXR3b3JrcyBsb2dvCiAgc2l6ZT86IG51bWJlcgogIHNoYXBlPzogJ2NpcmNsZScgfCAnc3F1YXJlJwogIGJvcmRlcldpZHRoPzogbnVtYmVyCiAgYm9yZGVyUmFkaXVzPzogbnVtYmVyCiAgbG9hZGluZz86IGJvb2xlYW4KfQoKZXhwb3J0IGZ1bmN0aW9uIFRyYW5zYWN0aW9uU3VtbWFyeU5ldHdvcmtMb2dvKHsKICBjaGFpbklkLAogIHNpemUgPSBpY29uU2l6ZXMuaWNvbjIwLAp9OiBQaWNrPE5ldHdvcmtMb2dvUHJvcHMsICdjaGFpbklkJyB8ICdzaXplJz4pOiBKU1guRWxlbWVudCB7CiAgcmV0dXJuIDxOZXR3b3JrTG9nbyBib3JkZXJXaWR0aD17MS42fSBjaGFpbklkPXtjaGFpbklkfSBzaGFwZT0ic3F1YXJlIiBzaXplPXtzaXplfSAvPgp9CgpmdW5jdGlvbiBfTmV0d29ya0xvZ28oewogIGNoYWluSWQsCiAgc2hhcGUsCiAgc2l6ZTogc2l6ZVdpdGhvdXRCb3JkZXIgPSBpY29uU2l6ZXMuaWNvbjIwLAogIGJvcmRlcldpZHRoID0gMCwKICBib3JkZXJSYWRpdXMsCiAgbG9hZGluZywKICB0cmFuc2l0aW9uLAp9OiBOZXR3b3JrTG9nb1Byb3BzKTogSlNYLkVsZW1lbnQgfCBudWxsIHsKICBjb25zdCBzaXplID0gc2l6ZVdpdGhvdXRCb3JkZXIgKyAyICogYm9yZGVyV2lkdGgKICBjb25zdCBzaGFwZUJvcmRlclJhZGl1cyA9IHNoYXBlID09PSAnY2lyY2xlJyA/IHNpemUgLyAyIDogc2l6ZSAqIFNRVUlSQ0xFX0JPUkRFUl9SQURJVVNfUkFUSU8KICBjb25zdCBjb2xvcnMgPSB1c2VTcG9yZUNvbG9ycygpCgogIGNvbnN0IGltYWdlU3R5bGUgPSB7CiAgICB3aWR0aDogc2l6ZSwKICAgIGhlaWdodDogc2l6ZSwKICAgIGJvcmRlclJhZGl1czogYm9yZGVyUmFkaXVzID8/IHNoYXBlQm9yZGVyUmFkaXVzLAogICAgYm9yZGVyV2lkdGgsCiAgICBib3JkZXJDb2xvcjogY29sb3JzLnN1cmZhY2UxLnZhbCwKICB9CgogIGlmIChsb2FkaW5nKSB7CiAgICByZXR1cm4gPExvYWRlci5Cb3ggaGVpZ2h0PXtzaXplfSB3aWR0aD17c2l6ZX0gYm9yZGVyUmFkaXVzPXtib3JkZXJSYWRpdXMgPz8gc2hhcGVCb3JkZXJSYWRpdXN9IC8+CiAgfQoKICBpZiAoY2hhaW5JZCA9PT0gbnVsbCkgewogICAgcmV0dXJuICgKICAgICAgPEZsZXggdGVzdElEPSJhbGwtbmV0d29ya3MtbG9nbyI+CiBva2U9e0NPTE9SLk5PX1NIT1dfSE9TVH0KICAgICAgICAgICAgICAgIHN0cm9rZVdpZHRoPXsyfQogICAgICAgICAgICAgICAgZG90PXt7IHI6IDQgfX0KICAgICAgICAgICAgICAgIGFjdGl2ZURvdD17eyByOiA2IH19CiAgICAgICAgICAgICAgICBhbmltYXRpb25EdXJhdGlvbj17MTAwMH0KICAgICAgICAgICAgICAvPgogICAgICAgICAgICA8L0xpbmVDaGFydD4KICAgICAgICAgIDwvUmVzcG9uc2l2ZUNvbnRhaW5lcj4KICAgICAgICA8L2Rpdj4KICAgICAgKSA6IG51bGx9CiAgICA8L0NoYXJ0Q2FyZD4KICApOwp9OwoidXNlIGNsaWVudCIKCmltcG9ydCAqIGFzIFJlYWN0IGZyb20gInJlYWN0IgppbXBvcnQgewogIEJhZGdlQ2hlY2ssCiAgQmVsbCwKICBDaGVjaywKICBDaGV2cm9uUmlnaHQsCiAgQ2hldnJvbnNVcERvd24sCiAgQ3JlZGl0Q2FyZCwKICBMb2dPdXQsCiAgUGx1cywKICBTcGFya2xlcywKfSBmcm9tICJsdWNpZGUtcmVhY3QiCgppbXBvcnQgewogIEF2YXRhciwKICBBdmF0YXJGYWxsYmFjaywKICBBdmF0YXJJbWFnZSwKfSBmcm9tICJAL3JlZ2lzdHJ5L2RlZmF1bHQvdWkvYXZhdGFyIgppbXBvcnQgewogIEJyZWFkY3J1bWIsCiAgQnJlYWRjcnVtYkl0ZW0sCiAgQnJlYWRjcnVtYkxpc3QsCiAgQnJlYWRjcnVtYlBhZ2UsCn0gZnJvbSAiQC9yZWdpc3RyeS9kZWZhdWx0L3VpL2JyZWFkY3J1bWIiCmltcG9ydCB7IENhbGVuZGFyIH0gZnJvbSAiQC9yZWdpc3RyeS9kZWZhdWx0L3VpL2NhbGVuZGFyIgppbXBvcnQgewogIENvbGxhcHNpYmxlLAogIENvbGxhcHNpYmxlQ29udGVudCwKICBDb2xsYXBzaWJsZVRyaWdnZXIsCn0gZnJvbSAiQC9yZWdpc3RyeS9kZWZhdWx0L3VpL2NvbGxhcHNpYmxlIgppbXBvcnQgewogIERyb3Bkb3duTWVudSwKICBEcm9wZG93bk1lbnVDb250ZW50LAogIERyb3Bkb3duTWVudUdyb3VwLAogIERyb3Bkb3duTWVudUl0ZW0sCiAgRHJvcGRvd25NZW51TGFiZWwsCiAgRHJvcGRvd25NZW51U2VwYXJhdG9yLAogIERyb3Bkb3duTWVudVRyaWdnZXIsCn0gZnJvbSAiQC9yZWdpc3RyeS9kZWZhdWx0L3VpL2Ryb3Bkb3duLW1lbnUiCmltcG9ydCB7IFNlcGFyYXRvciB9IGZyb20gIkAvcmVnaXN0cnkvZGVmYXVsdC91aS9zZXBhcmF0b3IiCmltcG9ydCB7CiAgU2lkZWJhciwKICBTaWRlYmFyQ29udGVudCwKICBTaWRlYmFyRm9vdGVyLAogIFNpZGViYXJHcm91cCwKICBTaWRlYmFyR3JvdXBDb250ZW50LAogIFNpZGViYXJHcm91cExhYmVsLAogIFNpZGViYXJIZWFkZXIsCiAgU2lkZWJhckluc2V0LAogIFNpZGViYXJNZW51LAogIFNpZGViYXJNZW51QnV0dG9uLAogIFNpZGViYXJNZW51SXRlbSwKICBTaWRlYmFyUHJvdmlkZXIsCiAgU2lkZWJhclJhaWwsCiAgU2lkZWJhclNlcGFyYXRvciwKICBTaWRlYmFyVHJpZ2dlciwKICB1c2VTaWRlYmFyLAp9IGZyb20gIkAvcmVnaXN0cnkvZGVmYXVsdC91aS9zaWRlYmFyIgoKLy8gVGhpcyBpcyBzYW1wbGUgZGF0YS4KY29uc3QgZGF0YSA9IHsKICB1c2VyOiB7CiAgICBuYW1lOiAic2hhZGNuIiwKICAgIGVtYWlsOiAibUBleGFtcGxlLmNvbSIsCiAgICBhdmF0YXI6ICIvYXZhdGFycy9zaGFkY24uanBnIiwKICB9LAogIGNhbGVuZGFyczogWwogICAgewogICAgICBuYW1lOiAiTXkgQ2FsZW5kYXJzIiwKICAgICAgaXRlbXM6IFsiUGVyc29uYWwiLCAiV29yayIsICJGYW1pbHkiXSwKICAgIH0sCiAgICB7CiAgICAgIG5hbWU6ICJGYXZvcml0ZXMiLAogICAgICBpdGVtczogWyJIb2xpZGF5cyIsICJCaXJ0aGRheXMiXSwKICAgIH0sCiAgICB7CiAgICAgIG5hbWU6ICJPdGhlciIsCiAgICAgIGl0ZW1zOiBbIlRyYXZlbCIsICJSZW1pbmRlcnMiLCAiRGVhZGxpbmVzIl0sCiAgICB9LAogIF0sCn0KCmV4cG9ydCBjb25zdCBpZnJhbWVIZWlnaHQgPSAiODAwcHgiCgpleHBvcnQgY29uc3QgZGVzY3JpcHRpb24gPSAiQSBzaWRlYmFyIHdpdGggYSBjYWxlbmRhci4iCgpleExvY1R5cGU/LmRlZmF1bHRWYWx1ZVZhcmlhYmxlID09PSAiYWRkcmVzcyIgPyBpbnB1dFZhbHVlIDogdW5kZWZpbmVkOwogICAgY29uc3QgcGhvbmVOdW1iZXIgPSBldnRMb2NUeXBlPy5vcmdhbml6ZXJJbnB1dFR5cGUgPT09ICJwaG9uZSIgPyBpbnB1dFZhbHVlIDogdW5kZWZpbmVkOwoKICAgIG11dGF0aW9uLm11dGF0ZSgKICAgICAgeyBldmVudFR5cGVJZCwgbG9jYXRpb25UeXBlLCBsaW5rLCBhZGRyZXNzLCBwaG9uZU51bWJlciB9LAogICAgICB7CiAgICAgICAgb25TdWNjZXNzOiAocmVzdWx0KSA9PiB7CiAgICAgICAgICBjb25zdCB1cGRhdGVkSG9zdHMgPSBob3N0cy5tYXAoKGhvc3QpID0+ICh7CiAgICAgICAgICAgIC4uLmhvc3QsCiAgICAgICAgICAgIGxvY2F0aW9uOiB7CiAgICAgICAgICAgICAgdXNlcklkOiBob3N0LnVzZXJJZCwKICAgICAgICAgICAgICBldmVudFR5cGVJZCwKICAgICAgICAgICAgICB0eXBlOiBsb2NhdGlvblR5cGUsCiAgICAgICAgICAgICAgY3JlZGVudGlhbElkOiBudWxsLAogICAgICAgICAgICAgIGxpbms6IGxpbmsgPz8gbnVsbCwKICAgICAgICAgICAgICBhZGRyZXNzOiBhZGRyZXNzID8/IG51bGwsCiAgICAgICAgICAgICAgcGhvbmVOdW1iZXI6IHBob25lTnVtYmVyID8/IG51bGwsCiAgICAgICAgICAgIH0sCiAgICAgICAgICB9KSk7CiAgICAgICAgICBmb3JtTWV0aG9kcy5zZXRWYWx1ZSgiaG9zdHMiLCB1cGRhdGVkSG9zdHMsIHsgc2hvdWxkRGlydHk6IHRydWUgfSk7CgogICAgICAgICAgc2hvd1RvYXN0KHQoImxvY2F0aW9uX2FwcGxpZWRfdG9faG9zdHMiLCB7IGNvdW50OiByZXN1bHQudXBkYXRlZENvdW50IH0pLCAic3VjY2VzcyIpOwogICAgICAgICAgb25TdWNjZXNzKCk7CiAgICAgICAgICB1dGlscy52aWV3ZXIuZXZlbnRUeXBlcy5nZXRIb3N0c1dpdGhMb2NhdGlvbk9wdGlvbnMuaW52YWxpZGF0ZSh7IGV2ZW50VHlwZUlkIH0pOwogICAgICAgIH0sCiAgICAgIH0KICAgICk7CiAgfTsKCiAgcmV0dXJuIHsgaGFuZGxlTWFzc0FwcGx5LCBpc1BlbmRpbmc6IG11dGF0aW9uLmlzUGVuZGluZyB9Owp9OwoKY29uc3QgVXBncmFkZUJhZGdlID0gKCkgPT4gewogIGNvbnN0IHsgdCB9ID0gdXNlTG9jYWxlKCk7CiAgcmV0dXJuICgKICAgIDxhIGhyZWY9Ii9lbnRlcnByaXNlIiBjbGFzc05hbWU9ImhvdmVyOnVuZGVybGluZSI+CiAgICAgIDxCYWRnZSB2YXJpYW50PSJncmF5Ij57dCgidXBncmFkZSIpfTwvQmFkZ2U+CiAgICA8L2E+CiAgKTsKfTsKCmV4cG9ydCBjb25zdCBIb3N0TG9jYXRpb25zID0gKHsgZXZlbnRUeXBlSWQsIGxvY2F0aW9uT3B0aW9ucyB9OiBIb3N0TG9jYXRpb25zUHJvcHMpID0+IHsKICBjb25zdCB7IHQgfSA9IHVzZUxvY2FsZSgpOwogIGNvbnN0IHNlc3Npb24gPSB1c2VTZXNzaW9uKCk7CiAgY29uc3QgZm9ybU1ldGhvZHMgPSB1c2VGb3JtQ29udGV4dDxGb3JtVmFsdWVzPigpOwogIGNvbnN0IFtpc01hc3NBcHBseURpYWxvZ09wZW4sIHNldElzTWFzc0FwcGx5RGlhbG9nT3Blbl0gPSB1c2VTdGF0ZShmYWxzZSk7CgogIGNvbnN0IGlzT3JnID0gISFzZXNzaW9uLmRhdGE/LnVzZXI/Lm9yZz8uaWQ7CiAgY29uc3QgZW5hYmxlUGVySG9zdExvY2F0aW9ucyA9IGZvcm1NZXRob2RzLndhdGNoKCJlbmFibGVQZXJIb3N0TG9jYXRpb25zIik7CiAgY29uc3QgaG9zdHMgPSBmb3JtTWV0aG9kcy53YXRjaCgiaG9zdHMiKTsKCiAgY29uc3QgeyBob3N0RGF0YU1hcCwgbWVyZ2VkTG9jYXRpb25PcHRpb25zLCBjb250YWluZXJSZWYsIGlzTG9hZGluZywgaXNGZXRjaGluZ05leHRQYWdlIH0gPQogICAgdXNlSG9zdExvY2F0aW9uc0RhdGEoZXZlbnRUeXBlSWQsIGVuYWJsZVBlckhvc3RMb2NhdGlvbnMsIGxvY2F0aW9uT3B0aW9ucyk7CiAgY29uc3QgeyBoYW5kbGVUb2dnbGUsIGhhbmRsZUxvY2F0aW9uQ2hhbmdlIH0gPSB1c2VIb3N0TG9jYXRpb25IYW5kbGVycyhmb3JtTWV0aG9kcywgaG9zdHMpOwpnID0gKHsgaXNPcGVuLCBvbkNsb3NlLCBvbkFwcGx5LCBpc0FwcGx5aW5nIH06IE1hc3NBcHBseUxvY2F0aW9uRGlhbG9nUHJvcHMpID0+IHsKICBjb25zdCB7IHQgfSA9IHVzZUxvY2FsZSgpOwogIGNvbnN0IHsgc2VsZWN0ZWRUeXBlLCBzZXRTZWxlY3RlZFR5cGUsIGlucHV0VmFsdWUsIHNldElucHV0VmFsdWUsIHJlc2V0IH0gPSB1c2VNYXNzQXBwbHlEaWFsb2dTdGF0ZShpc09wZW4pOwogIGNvbnN0IGFsbExvY2F0aW9uT3B0aW9ucyA9IHVzZU1lbW8oKCkgPT4gewogICAgcmV0dXJuIGdldEFsbExvY2F0aW9uT3B0aW9ucygpLmZpbHRlcigob3B0KSA9PiB7CiAgICAgIGNvbnN0IGxvY2F0aW9uVHlwZSA9IGdldEV2ZW50TG9jYXRpb25UeXBlKG9wdC52YWx1ZSk7CiAgICAgIHJldHVybiAhbG9jYXRpb25UeXBlPy5hdHRlbmRlZUlucHV0VHlwZTsKICAgIH0pOwogIH0sIFtdKTsKCiAgY29uc3Qgc2VsZWN0ZWRPcHRpb24gPSBhbGxMb2NhdGlvbk9wdGlvbnMuZmluZCgobykgPT4gby52YWx1ZSA9PT0gc2VsZWN0ZWRUeXBlKTsKICBjb25zdCBldmVudExvY2F0aW9uVHlwZSA9IHNlbGVjdGVkVHlwZSA/IGdldEV2ZW50TG9jYXRpb25UeXBlKHNlbGVjdGVkVHlwZSkgOiBudWxsOwogIGNvbnN0IG5lZWRzSW5wdXQgPSBldmVudExvY2F0aW9uVHlwZT8ub3JnYW5pemVySW5wdXRUeXBlOwoKICBjb25zdCBoYW5kbGVDbG9zZSA9ICgpID0+IHsKICAgIHJlc2V0KCk7CiAgICBvbkNsb3NlKCk7CiAgfTsKCiAgY29uc3QgaGFuZGxlQXBwbHkgPSAoKSA9PiB7CiAgICBpZiAoIXNlbGVjdGVkVHlwZSkgcmV0dXJuOwogICAgb25BcHBseShzZWxlY3RlZFR5cGUsIGlucHV0VmFsdWUgfHwgdW5kZWZpbmVkKTsKICB9OwoKICBjb25zdCBnZXRUcmFuc2xhdGVkTGFiZWwgPSAob3B0OiBBbGxMb2NhdGlvbk9wdGlvbikgPT4gewogICAgY29uc3QgdHJhbnNsYXRlZCA9IHQob3B0LmxhYmVsKTsKICAgIHJldHVybiB0cmFuc2xhdGVkICE9PSBvcHQubGFiZWwgPyB0cmFuc2xhdGVkIDogb3B0LmxhYmVsOwogIH07CgogIGNvbnN0IHNlbGVjdE9wdGlvbnMgPSBhbGxMb2NhdGlvbk9wdGlvbnMubWFwKChvcHQpID0+ICh7CiAgICB2YWx1ZTogb3B0LnZhbHVlLAogICAgbGFiZWw6IGdldFRyYW5zbGF0ZWRMYWJlbChvcHQpLAogICAgaWNvbjogb3B0Lmljb24sCiAgfSkpOwogIGNvbnN0IHNlbGVjdGVkVHJhbnNsYXRlZExhYmVsID0gc2VsZWN0ZWRPcHRpb24gPyBnZXRUcmFuc2xhdGVkTGFiZWwoc2VsZWN0ZWRPcHRpb24pIDogbnVsbDsKICBjb25zdCBzZWxlY3RWYWx1ZSA9IHNlbGVjdGVkT3B0aW9uCiAgICA/IHsgdmFsdWU6IHNlbGVjdGVkT3B0aW9uLnZhbHVlLCBsYWJlbDogc2VsZWN0ZWRUcmFuc2xhdGVkTGFiZWwsIGljb246IHNlbGVjdGVkT3B0aW9uLmljb24gfQogICAgOiBudWxsOwoKICBjb25zdCBPcHRpb25XaXRoSWNvbiA9ICh7IGljb24sIGxhYmVsIH06IHsgaWNvbj86IHN0cmluZzsgbGFiZWw6IHN0cmluZyB8IG51bGwgfSkgPT4gKAogICAgPGRpdiBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0zIj4KICAgICAge2ljb24gJiYgPGltZyBzcmM9e2ljb259IGFsdD0iIiBjbGFzc05hbWU9e2BoLTQgdy00ICR7aW52ZXJ0TG9nb09uRGFyayhpY29uKX1gfSAvPn0KICAgICAgPHNwYW4+e2xhYmVsfTwvc3Bhbj4KICAgIDwvZGl2PgogICk7CgogIHJldHVybiAoCiAgICA8RGlhbG9nIG9wZW49e2lzT3Blbn0gb25PcGVuQ2hhbmdlPXsob3BlbikgPT4gIW9wZW4gJiYgaGFuZGxlQ2xvc2UoKX0+CiAgICAgIDxEaWFsb2dDb250ZW50PgogICAgICAgIDxEaWFsb2dIZWFkZXIgdGl0bGU9e3QoImFwcGx5X2xvY2F0aW9uX3RvX2FsbF9ob3N0cyIpfSAvPgogICAgICAgIDxkaXYgY2xhc3NOYW1lPSJzcGFjZS15LTQiPgogICAgICAgICAgPGRpdj4KICAgICAgICAgICAgPExhYmVsIGNsYXNzTmFtZT0ibWItMSI+e3QoInNlbGVjdF9sb2NhdGlvbl90eXBlIil9PGx1ZS50cmltKCkubGVuZ3RoID4gMCB8fCB0KCJtdXN0X2VudGVyX3RlYW1fbmFtZSIpLAogICAgICAgICAgICB9fQogICAgICAgICAgICByZW5kZXI9eyh7IGZpZWxkOiB7IHZhbHVlIH0gfSkgPT4gKAogICAgICAgICAgICAgIDw+CiAgICAgICAgICAgICAgICA8VGV4dEZpZWxkCiAgICAgICAgICAgICAgICAgIGRpc2FibGVkPXsKICAgICAgICAgICAgICAgICAgICAvKiBFMmUgaXMgdG9vIGZhc3QgYW5kIGl0IHRyaWVzIHRvIGZpbGwgdGhpcyB3YXkgYmVmb3JlIHRoZSBmb3JtIGlzIHJlYWR5ICovCiAgICAgICAgICAgICAgICAgICAgIWlzTG9jYWxlUmVhZHkgfHwgY3JlYXRlVGVhbU11dGF0aW9uLmlzUGVuZGluZwogICAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0ibXQtMiIKICAgICAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9IkFjbWUgSW5jLiIKICAgICAgICAgICAgICAgICAgbmFtZT0ibmFtZSIKICAgICAgICAgICAgICAgICAgbGFiZWw9e3QoInRlYW1fbmFtZSIpfQogICAgICAgICAgICAgICAgICBkZWZhdWx0VmFsdWU9e3ZhbHVlfQogICAgICAgICAgICAgICAgICBvbkNoYW5nZT17KGUpID0+IHsKICAgICAgICAgICAgICAgICAgICBuZXdUZWFtRm9ybU1ldGhvZHMuc2V0VmFsdWUoIm5hbWUiLCBlPy50YXJnZXQudmFsdWUpOwogICAgICAgICAgICAgICAgICAgIGlmIChuZXdUZWFtRm9ybU1ldGhvZHMuZm9ybVN0YXRlLnRvdWNoZWRGaWVsZHNbInNsdWciXSA9PT0gdW5kZWZpbmVkKSB7CiAgICAgICAgICAgICAgICAgICAgICBuZXdUZWFtRm9ybU1ldGhvZHMuc2V0VmFsdWUoInNsdWciLCBzbHVnaWZ5KGU/LnRhcmdldC52YWx1ZSkpOwogICAgICAgICAgICAgICAgICAgIH0KICAgICAgICAgICAgICAgICAgfX0KICAgICAgICAgICAgICAgICAgYXV0b0NvbXBsZXRlPSJvZmYiCiAgICAgICAgICAgICAgICAgIGRhdGEtdGVzdGlkPSJ0ZWFtLW5hbWUiCiAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgIDwvPgogICAgICAgICAgICApfQogICAgICAgICAgLz4KICAgICAgICA8L2Rpdj4KCiAgICAgICAgPGRpdiBjbGFzc05hbWU9Im1iLTgiPgogICAgICAgICAgPENvbnRyb2xsZXIKICAgICAgICAgICAgbmFtZT0ic2x1ZyIKICAgICAgICAgICAgY29udHJvbD17bmV3VGVhbUZvcm1NZXRob2RzLmNvbnRyb2x9CiAgICAgICAgICAgIHJ1bGVzPXt7IHJlcXVpcmVkOiB0KCJ0ZWFtX3VybF9yZXF1aXJlZCIpIH19CiAgICAgICAgICAgIHJlbmRlcj17KHsgZmllbGQ6IHsgdmFsdWUgfSB9KSA9PiAoCiAgICAgICAgICAgICAgPFRleHRGaWVsZAogICAgICAgICAgICAgICAgbmFtZT0ic2x1ZyIKICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPSJhY21lIgogICAgICAgICAgICAgICAgbGFiZWw9e3QoInRlYW1fdXJsIil9CiAgICAgICAgICAgICAgICBhZGRPbkxlYWRpbmc9e2AkewogICAgICAgICAgICAgICAgICBvcmdCcmFuZGluZwogICAgICAgICAgICAgICAgICAgID8gYCR7b3JnQnJhbmRpbmcuZnVsbERvbWFpbi5yZXBsYWNlKCJodHRwczovLyIsICIiKS5yZXBsYWNlKCJodHRwOi8vIiwgIiIpfS9gCiAgICAgICAgICAgICAgICAgICAgOiBgJHtzdWJkb21haW5TdWZmaXgoKX0vdGVhbS9gCiAgICAgICAgICAgICAgICB9YH0KICAgICAgICAgICAgICAgIHZhbHVlPXt2YWx1ZX0KICAgICAgICAgICAgICAgIGRlZmF1bHRWYWx1ZT17dmFsdWV9CiAgICAgICAgICAgICAgICBvbkNoYW5nZT17KGUpID0+IHsKICAgICAgICAgICAgICAgICAgbmV3VGVhbUZvcm1NZXRob2RzLnNldFZhbHVlKCJzbHVnIiwgc2x1Z2lmeShlPy50YXJnZXQudmFsdWUsIHRydWUpLnJlcGxhY2UoL1wuL2csICIiKSwgewogICAgICAgICAgICAgICAgICAgIHNob3VsZFRvdWNoOiB0cnVlLAogICAgICAgICAgICAgICAgICB9KTsKICAgICAgICAgICAgICAgICAgbmV3VGVhbUZvcm1NZXRob2RzLmNsZWFyRXJyb3JzKCJzbHVnIik7CmxlY3QoY3VycmVuY3kpCiAgICAgIHNldFNlbGVjdGVkQ2hhaW5JZChjdXJyZW5jeS5jaGFpbklkKQogICAgICBzZXRJc1VzZXJTZWxlY3RlZFRva2VuKHRydWUpCiAgICAgIG9uRGlzbWlzcygpCiAgICB9LAogICAgW29uQ3VycmVuY3lTZWxlY3QsIG9uRGlzbWlzcywgc2V0U2VsZWN0ZWRDaGFpbklkLCBzZXRJc1VzZXJTZWxlY3RlZFRva2VuLCBzZWxlY3RDaGFpbiwgaXNNdWx0aWNoYWluQ29udGV4dF0sCiAgKQoKICB1c2VFZmZlY3QoKCkgPT4gewogICAgaWYgKChjdXJyZW50VGFiICE9PSBTd2FwVGFiLlN3YXAgJiYgY3VycmVudFRhYiAhPT0gU3dhcFRhYi5TZW5kKSB8fCAhaXNNdWx0aWNoYWluQ29udGV4dCkgewogICAgICByZXR1cm4KICAgIH0KCiAgICBzaG93U3dpdGNoTmV0d29ya05vdGlmaWNhdGlvbih7IGNoYWluSWQsIHByZXZDaGFpbklkLCBhY3Rpb246IHN3aXRjaE5ldHdvcmtBY3Rpb24gfSkKICB9LCBbY3VycmVudFRhYiwgY2hhaW5JZCwgcHJldkNoYWluSWQsIGlzTXVsdGljaGFpbkNvbnRleHQsIHN3aXRjaE5ldHdvcmtBY3Rpb25dKQoKICByZXR1cm4gKAogICAgPFRyYWNlIGxvZ0ltcHJlc3Npb24gZXZlbnRPblRyaWdnZXI9e0ludGVyZmFjZUV2ZW50TmFtZS5Ub2tlblNlbGVjdG9yT3BlbmVkfSBtb2RhbD17TW9kYWxOYW1lLlRva2VuU2VsZWN0b3JXZWJ9PgogICAgICA8RmxleCB3aWR0aD0iMTAwJSIgZmxleEdyb3c9ezF9IGZsZXhTaHJpbms9ezF9IGZsZXhCYXNpcz0iYXV0byI+CiAgICAgICAgPFRva2VuU2VsZWN0b3JDb250ZW50CiAgICAgICAgICByZW5kZXJlZEluTW9kYWw9e2ZhbHNlfQogICAgICAgICAgZXZtQWRkcmVzcz17d2FsbGV0LmV2bUFjY291bnQ/LmFkZHJlc3N9CiAgICAgICAgICBzdm1BZGRyZXNzPXt3YWxsZXQuc3ZtQWNjb3VudD8uYWRkcmVzc30KICAgICAgICAgIGlzTGltaXRzPXtjdXJyZW50VGFiID09PSBTd2FwVGFiLkxpbWl0fQogICAgICAgICAgY2hhaW5JZD17IWlzTXVsdGljaGFpbkNvbnRleHQgfHwgaXNVc2VyU2VsZWN0ZWRUb2tlbiA/IGNoYWluSWQgOiB1bmRlZmluZWR9CiAgICAgICAgICBjaGFpbklkcz17Y2hhaW5JZHMgPz8gY2hhaW5zfQogICAgICAgICAgY3VycmVuY3lGaWVsZD17Y3VycmVuY3lGaWVsZH0KICAgICAgICAgIGZsb3c9e1Rva2VuU2VsZWN0b3JGbG93LlN3YXB9CiAgICAgICAgICBpc1N1cmZhY2VSZWFkeT17dHJ1ZX0KICAgICAgICAgIHZhcmlhdGlvbj17CiAgICAgICAgICAgIHZhcmlhdGlvbiA/PwogICAgICAgICAgICAoY3VycmVuY3lGaWVsZCA9PT0gQ3VycmVuY3lGaWVsZC5JTlBVVAogICAgICAgICAgICAgID8gVG9rZW5TZWxlY3RvclZhcmlhdGlvbi5Td2FwSW5wdXQKICAgICAgICAgICAgICA6IFRva2VuU2VsZWN0b3JWYXJpYXRpb24uU3dhcE91dHB1dCkKICAgICAgICAgIH0KICAgICAgICAgIG9uQ2xvc2U9e29uRGlzbWlzc30KICAgICAgICAgIG9uU2VsZWN0Q3VycmVuY3k9e2hhbmRsZUN1cnJlbmN5U2VsZWN0VG9rZW5TZWxlY3RvckNhbGxiYWNrfQogICAgICAgIC8+CiAgICAgIDwvRmxleD4KICAgIDwvVHJhY2U+CiAgKQp9CiJ1c2UgY2xpZW50IgoKaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAicmVhY3QiCmltcG9ydCB7IERpYWxvZyBhcyBEaWFsb2dQcmltaXRpdmUgfSBmcm9tICJAYmFzZS11aS9yZWFjdC9kaWFsb2ciCgppbXBvcnQgeyBjbiB9IGZyb20gIkAvcmVnaXN0cnkvYmFzZXMvYmFzZS9saWIvdXRpbHMiCmltcG9ydCB7IEJ1dHRvbiB9IGZyb20gIkAvcmVnaXN0cnkvYmFzZXMvYmFzZS91aS9idXR0b24iCmltcG9ydCB7IEljb25QbGFjZWhvbGRlciB9IGZyb20gIkAvYXBwLyhjcmVhdGUpL2NvbXBvbmVudHMvaWNvbi1wbGFjZWhvbGRlciIKCmZ1bmN0aW9uIERpYWxvZyh7IC4uLnByb3BzIH06IERpYWxvZ1ByaW1pdGl2ZS5Sb290LlByb3BzKSB7CiAgcmV0dXJuIDxEaWFsb2dQcmltaXRpdmUuUm9vdCBkYXRhLXNsb3Q9ImRpYWxvZyIgey4uICghcHJldikgcmV0dXJuIHByZXY7CiAgICAgICAgaWYgKHByZXYuY2xpZW50SWQgIT09IGRhdGEuY2xpZW50SWQpIHJldHVybiBwcmV2OwogICAgICAgIHJldHVybiB7CiAgICAgICAgICAuLi5wcmV2LAogICAgICAgICAgbmFtZTogZGF0YS5uYW1lLAogICAgICAgICAgcHVycG9zZTogZGF0YS5wdXJwb3NlLAogICAgICAgICAgcmVkaXJlY3RVcmk6IGRhdGEucmVkaXJlY3RVcmksCiAgICAgICAgICB3ZWJzaXRlVXJsOiBkYXRhLndlYnNpdGVVcmwsCiAgICAgICAgICBsb2dvOiBkYXRhLmxvZ28sCiAgICAgICAgICBzdGF0dXM6IGRhdGEuc3RhdHVzLAogICAgICAgICAgcmVqZWN0aW9uUmVhc29uOiBkYXRhLnJlamVjdGlvblJlYXNvbiwKICAgICAgICB9OwogICAgICB9KTsKCiAgICAgIHV0aWxzLnZpZXdlci5vQXV0aC5saXN0VXNlckNsaWVudHMuaW52YWxpZGF0ZSgpOwogICAgfSwKICAgIG9uRXJyb3I6IChlcnJvcikgPT4gewogICAgICBzaG93VG9hc3QoYCR7dCgidXBkYXRpbmdfb2F1dGhfY2xpZW50X2Vycm9yIil9OiAke2Vycm9yLm1lc3NhZ2V9YCwgImVycm9yIik7CiAgICB9LAogIH0pOwoKICBjb25zdCBoYW5kbGVTdWJtaXQgPSAodmFsdWVzOiBPQXV0aENsaWVudENyZWF0ZUZvcm1WYWx1ZXMpID0+IHsKICAgIHN1Ym1pdEZvclJldmlld011dGF0aW9uLm11dGF0ZSh7CiAgICAgIG5hbWU6IHZhbHVlcy5uYW1lLAogICAgICBwdXJwb3NlOiB2YWx1ZXMucHVycG9zZSwKICAgICAgcmVkaXJlY3RVcmk6IHZhbHVlcy5yZWRpcmVjdFVyaSwKICAgICAgd2Vic2l0ZVVybDogdmFsdWVzLndlYnNpdGVVcmwsCiAgICAgIGxvZ286IHZhbHVlcy5sb2dvLAogICAgICBlbmFibGVQa2NlOiB2YWx1ZXMuZW5hYmxlUGtjZSwKICAgIH0pOwogIH07CgogIGNvbnN0IGhhbmRsZUNsb3NlQ3JlYXRlRGlhbG9nID0gKCkgPT4gewogICAgc2V0SXNDcmVhdGluZ0NsaWVudChmYWxzZSk7CiAgICBzZXRTdWJtaXR0ZWRDbGllbnQobnVsbCk7CiAgfTsKCiAgY29uc3QgaGFuZGxlQ2xvc2VEZXRhaWxzRGlhbG9nID0gKCkgPT4gewogICAgc2V0U2VsZWN0ZWRDbGllbnQobnVsbCk7CiAgfTsKCiAgaWYgKGlzTG9hZGluZykgewogICAgcmV0dXJuIDxPQXV0aENsaWVudHNTa2VsZXRvbiAvPjsKICB9CgogIGNvbnN0IG5ld09BdXRoQ2xpZW50QnV0dG9uID0gKAogICAgPE5ld09BdXRoQ2xpZW50QnV0dG9uIGRhdGFUZXN0SWQ9Im9wZW4tb2F1dGgtY2xpZW50LWNyZWF0ZS1kaWFsb2ciIG9uQ2xpY2s9eygpID0+IHNldElzQ3JlYXRpbmdDbGllbnQodHJ1ZSl9IC8+CiAgKTsKCiAgcmV0dXJuICgKICAgIDxTZXR0aW5nc0hlYWRlcgogICAgICB0aXRsZT17dCgib2F1dGhfY2xpZW50cyIpfQogICAgICBkZXNjcmlwdGlvbj17dCgib2F1dGhfY2xpZW50c19kZXNjcmlwdGlvbiIpfQogICAgICBDVEE9e25ld09BdXRoQ2xpZW50QnV0dG9ufT4KICAgICAge29BdXRoQ2xpZW50cyAmJiBvQXV0aENsaWVudHMubGVuZ3RoID4gMCA/ICgKICAgICAgICA8T0F1dGhDbGllbnRzTGlzdAogICAgICAgICAgY2xpZW50cz17b0F1dGhDbGllbnRzLm1hcCgoY2xpZW50KSA9PiAoewogICAgICAgICAgICBjbGllbnRJZDogY2xpZW50LmNsaWVudElkLAogICAgICAgICAgICBuYW1lOiBjbGllbnQubmFtZSwKICAgICAgICAgICAgcHVycG9zZTogY2xpZW50LnB1cnBvc2UsCiAgICAgICAgICAgIHJlZGlyZWN0VXJpOiBjbGllbnQucmVkaXJlY3RVcmksCiAgICAgICAgICAgIHdlYnNpdGVVcmw6IGNsaWVudC53ZWJzaXRlVXJsLAogICAgICAgICAgICBsb2dvOiBjbGllbnQubG9nbywKICAgICAgICAgICAgc3RhdHVzOiBjbGllbnQuc3RhdHVzLAogICAgICAgICAgICByZWplY3Rpb25SZWFzb246IGNsaWVudC5yZWplY3Rpb25SZWFzb24sCiAgICAgICAgICAgIGNsaWVudFR5cGU6IGNsaWVudC5jbGllbnRUeXBlLAogICAgICAgICAgfSkpfQogICAgICAgICAgb25TZWxlY3RDbGllbnQ9eyhjbGllb3gtY29sbGVjdGlvbiIgey4uLnByb3BzfSAvPgogICkKfQoKZnVuY3Rpb24gQ29tYm9ib3hFbXB0eSh7IGNsYXNzTmFtZSwgLi4ucHJvcHMgfTogQ29tYm9ib3hQcmltaXRpdmUuRW1wdHkuUHJvcHMpIHsKICByZXR1cm4gKAogICAgPENvbWJvYm94UHJpbWl0aXZlLkVtcHR5CiAgICAgIGRhdGEtc2xvdD0iY29tYm9ib3gtZW1wdHkiCiAgICAgIGNsYXNzTmFtZT17Y24oCiAgICAgICAgInRleHQtbXV0ZWQtZm9yZWdyb3VuZCBoaWRkZW4gdy1mdWxsIGp1c3RpZnktY2VudGVyIHB5LTIgdGV4dC1jZW50ZXIgdGV4dC1zbSBncm91cC1kYXRhLWVtcHR5L2NvbWJvYm94LWNvbnRlbnQ6ZmxleCIsCiAgICAgICAgY2xhc3NOYW1lCiAgICAgICl9CiAgICAgIHsuLi5wcm9wc30KICAgIC8+CiAgKQp9CgpmdW5jdGlvbiBDb21ib2JveFNlcGFyYXRvcih7CiAgY2xhc3NOYW1lLAogIC4uLnByb3BzCn06IENvbWJvYm94UHJpbWl0aXZlLlNlcGFyYXRvci5Qcm9wcykgewogIHJldHVybiAoCiAgICA8Q29tYm9ib3hQcmltaXRpdmUuU2VwYXJhdG9yCiAgICAgIGRhdGEtc2xvdD0iY29tYm9ib3gtc2VwYXJhdG9yIgogICAgICBjbGFzc05hbWU9e2NuKCJiZy1ib3JkZXIgLW14LTEgbXktMSBoLXB4IiwgY2xhc3NOYW1lKX0KICAgICAgey4uLnByb3BzfQogICAgLz4KICApCn0KCmZ1bmN0aW9uIENvbWJvYm94Q2hpcHMoewogIGNsYXNzTmFtZSwKICAuLi5wcm9wcwp9OiBSZWFjdC5Db21wb25lbnRQcm9wc1dpdGhSZWY8dHlwZW9mIENvbWJvYm94UHJpbWl0aXZlLkNoaXBzPiAmCiAgQ29tYm9ib3hQcmltaXRpdmUuQ2hpcHMuUHJvcHMpIHsKICByZXR1cm4gKAogICAgPENvbWJvYm94UHJpbWl0aXZlLkNoaXBzCiAgICAgIGRhdGEtc2xvdD0iY29tYm9ib3gtY2hpcHMiCiAgICAgIGNsYXNzTmFtZT17Y24oCiAgICAgICAgImRhcms6YmctaW5wdXQvMzAgYm9yZGVyLWlucHV0IGZvY3VzLXdpdGhpbjpib3JkZXItcmluZyBmb2N1cy13aXRoaW46cmluZy1yaW5nLzUwIGhhcy1hcmlhLWludmFsaWQ6cmluZy1kZXN0cnVjdGl2ZS8yMCBkYXJrOmhhcy1hcmlhLWludmFsaWQ6cmluZy1kZXN0cnVjdGl2ZS80MCBoYXMtYXJpYS1pbnZhbGlkOmJvcmRlci1kZXN0cnVjdGl2ZSBkYXJrOmhhcy1hcmlhLWludmFsaWQ6Ym9yZGVyLWRlc3RydWN0aXZlLzUwIGZsZXggbWluLWgtOCBmbGV4LXdyYXAgaXRlbXMtY2VudGVyIGdhcC0xIHJvdW5kZWQtbGcgYm9yZGVyIGJnLXRyYW5zcGFyZW50IGJnLWNsaXAtcGFkZGluZyBweC0yLjUgcHktMSB0ZXh0LXNtIHRyYW5zaXRpb24tY29sb3JzIGZvY3VzLXdpdGhpbjpyaW5nLVszcHhdIGhhcy1hcmlhLWludmFsaWQ6cmluZy1bM3B4XSBoYXMtZGF0YS1bc2xvdD1jb21ib2JveC1jaGlwXTpweC0xIiwKICAgICAgICBjbGFzc05hbWUKICAgICAgKX0KICAgICAgey4uLnByb3BzfQogICAgLz4KICApCn0KCmZ1bmN0aW9uIENvbWJvYm94Q2hpcCh7CiAgY2xhc3NOYW1lLAogIGNoaWxkcmVuLAogIHNob3dSZW1vdmUgPSB0cnVlLAogIC4uLnByb3BzCn06IENvbWJvYm94UHJpbWl0aXZlLkNoaXAuUHJvcHMgJiB7CiAgc2hvd1JlbW92ZT86IGJvb2xlYW4KfSkgewogIHJldHVybiAoCiAgICA8Q29tYm9ib3hQcmltaXRpdmUuQ2hpcAogICAgICBkYXRhLXNsb3Q9ImNvbWJvYm94LWNoaXAiCiAgICAgIGNsYXNzTmFtZT17Y24oCiAgICAgICAgImJnLW11dGVkIHRleHQtZm9yZWdyb3VuZCBmbGV4IGgtW2NhbGMoLS1zcGFjaW5nKDUuMjUpKV0gdy1maXQgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGdhcC0xIHJvdW5kZWQtc20gcHgtMS41IHRleHQteHMgZm9udC1tZWRpdW0gd2hpdGVzcGFjZS1ub3dyYXAgaGFzLWRpc2FibGVkOnBvaW50ZXItZXZlbnRzLW5vbmUgaGFzLWRpc2FibGVkOmN1cnNvci1ub3QtYWxsb3dlZCBoYXMtZGlzYWJsZWQ6b3BhY2l0eS01MCBoYXMtZGF0YS1bc2xvdD1jb21ib2JveC1jaGlwLXJlbW92ZV06cHItMCIsCm9uQ2hldnJvbkRvd24iCiAgICAgICAgaHVnZWljb25zPSJBcnJvd0Rvd24wMUljb24iCiAgICAgICAgcGhvc3Bob3I9IkNhcmV0RG93bkljb24iCiAgICAgICAgcmVtaXhpY29uPSJSaUFycm93RG93blNMaW5lIgogICAgICAgIGNsYXNzTmFtZT0idGV4dC1tdXRlZC1mb3JlZ3JvdW5kIHBvaW50ZXItZXZlbnRzLW5vbmUgc2l6ZS00IgogICAgICAvPgogICAgPC9Db21ib2JveFByaW1pdGl2ZS5UcmlnZ2VyPgogICkKfQoKZnVuY3Rpb24gQ29tYm9ib3hDbGVhcih7IGNsYXNzTmFtZSwgLi4ucHJvcHMgfTogQ29tYm9ib3hQcmltaXRpdmUuQ2xlYXIuUHJvcHMpIHsKICByZXR1cm4gKAogICAgPENvbWJvYm94UHJpbWl0aXZlLkNsZWFyCiAgICAgIGRhdGEtc2xvdD0iY29tYm9ib3gtY2xlYXIiCiAgICAgIHJlbmRlcj17PElucHV0R3JvdXBCdXR0b24gdmFyaWFudD0iZ2hvc3QiIHNpemU9Imljb24teHMiIC8+fQogICAgICBjbGFzc05hbWU9e2NuKGNsYXNzTmFtZSl9CiAgICAgIHsuLi5wcm9wc30KICAgID4KICAgICAgPEljb25QbGFjZWhvbGRlcgogICAgICAgIGx1Y2lkZT0iWEljb24iCiAgICAgICAgdGFibGVyPSJJY29uWCIKICAgICAgICBodWdlaWNvbnM9IkNhbmNlbDAxSWNvbiIKICAgICAgICBwaG9zcGhvcj0iWEljb24iCiAgICAgICAgcmVtaXhpY29uPSJSaUNsb3NlTGluZSIKICAgICAgICBjbGFzc05hbWU9InBvaW50ZXItZXZlbnRzLW5vbmUiCiAgICAgIC8+CiAgICA8L0NvbWJvYm94UHJpbWl0aXZlLkNsZWFyPgogICkKfQoKZnVuY3Rpb24gQ29tYm9ib3hJbnB1dCh7CiAgY2xhc3NOYW1lLAogIGNoaWxkcmVuLAogIGRpc2FibGVkID0gZmFsc2UsCiAgc2hvd1RyaWdnZXIgPSB0cnVlLAogIHNob3dDbGVhciA9IGZhbHNlLAogIC4uLnByb3BzCn06IENvbWJvYm94UHJpbWl0aXZlLklucHV0LlByb3BzICYgewogIHNob3dUcmlnZ2VyPzogYm9vbGVhbgogIHNob3dDbGVhcj86IGJvb2xlYW4KfSkgewogIHJldHVybiAoCiAgICA8SW5wdXRHcm91cCBjbGFzc05hbWU9e2NuKCJ3LWF1dG8iLCBjbGFzc05hbWUpfT4KICAgICAgPENvbWJvYm94UHJpbWl0aXZlLklucHV0CiAgICAgICAgcmVuZGVyPXs8SW5wdXRHcm91cElucHV0IGRpc2FibGVkPXtkaXNhYmxlZH0gLz59CiAgICAgICAgey4uLnByb3BzfQogICAgICAvPgogICAgICA8SW5wdXRHcm91cEFkZG9uIGFsaWduPSJpbmxpbmUtZW5kIj4KICAgICAgICB7c2hvd1RyaWdnZXIgJiYgKAogICAgICAgICAgPElucHV0R3JvdXBCdXR0b24KICAgICAgICAgICAgc2l6ZT0iaWNvbi14cyIKICAgICAgICAgICAgdmFyaWFudD0iZ2hvc3QiCiAgICAgICAgICAgIGFzQ2hpbGQKICAgICAgICAgICAgZGF0YS1zbG90PSJpbnB1dC1ncm91cC1idXR0b24iCiAgICAgICAgICAgIGNsYXNzTmFtZT0iZ3JvdXAtaGFzLWRhdGEtW3Nsb3Q9Y29tYm9ib3gtY2xlYXJdL2lucHV0LWdyb3VwOmhpZGRlbiBkYXRhLXByZXNzZWQ6YmctdHJhbnNwYXJlbnQiCiAgICAgICAgICAgIGRpc2FibGVkPXtkaXNhYmxlZH0KICAgICAgICAgID4KICAgICAgICAgICAgPENvbWJvYm94VHJpZ2dlciAvPgogICAgICAgICAgPC9JbnB1dEdyb3VwQnV0dG9uPgogICAgICAgICl9CiAgICAgICAge3Nob3dDbGVhciAmJiA8Q29tYm9ib3hDbGVhciBkaXNhYmxlZD17ZGlzYWJsZWR9IC8+fQogICAgICA8L0lucHV0R3JvdXBBZGRvbj4KICAgICAge2NoaWxkcmVufQogICAgPC9JbnB1dEdyb3VwPgogICkKfQoKZnVuY3Rpb24gQ29tYm9ib3hDb250ZW50KHsKICBjbGFzc05hbWUsCiAgc2lkZSA9ICJib3R0b20iLAogIHNpZGVPZmZzZXQgPSA2LAogIGFsaWduID0gInN0YXJ0IiwKICBhbGlnbk9mZnNldCA9IDAsCiAgYW5jaG9yLAogIC4uLnByb3BzCn06IENvbWJvYm94UHJpbWl0aXZlLlBvcHVwLlByb3BzICYKICBQaWNrPAogICAgQ29tYm9ib3hQcmltaXRpdmUuUG9zaXRpb25lci5Qcm9wcywKICAgICJzaWRlIiB8ICJhbGlnbiIgfCAic2lkZU8gPENvbW1hbmQgY2xhc3NOYW1lPSJzaXplLTQiIC8+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8U2VwYXJhdG9yIG9yaWVudGF0aW9uPSJ2ZXJ0aWNhbCIgY2xhc3NOYW1lPSJtbC00IGgtNCIgLz4KICAgICAgICAgICAgPE5hdmlnYXRpb25NZW51PgogICAgICAgICAgICAgIDxOYXZpZ2F0aW9uTWVudUxpc3Q+CiAgICAgICAgICAgICAgICA8TmF2aWdhdGlvbk1lbnVJdGVtPgogICAgICAgICAgICAgICAgICA8TmF2aWdhdGlvbk1lbnVUcmlnZ2VyIGNsYXNzTmFtZT0iYmctc2lkZWJhciI+CiAgICAgICAgICAgICAgICAgICAgR2V0dGluZyBzdGFydGVkCiAgICAgICAgICAgICAgICAgIDwvTmF2aWdhdGlvbk1lbnVUcmlnZ2VyPgogICAgICAgICAgICAgICAgICA8TmF2aWdhdGlvbk1lbnVDb250ZW50PgogICAgICAgICAgICAgICAgICAgIDx1bCBjbGFzc05hbWU9ImdyaWQgZ2FwLTMgcC00IG1kOnctWzQwMHB4XSBsZzp3LVs1MDBweF0gbGc6Z3JpZC1jb2xzLVsuNzVmcl8xZnJdIj4KICAgICAgICAgICAgICAgICAgICAgIDxsaSBjbGFzc05hbWU9InJvdy1zcGFuLTMiPgogICAgICAgICAgICAgICAgICAgICAgICA8TmF2aWdhdGlvbk1lbnVMaW5rIGFzQ2hpbGQ+CiAgICAgICAgICAgICAgICAgICAgICAgICAgPGEKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0iZmxleCBoLWZ1bGwgdy1mdWxsIHNlbGVjdC1ub25lIGZsZXgtY29sIGp1c3RpZnktZW5kIHJvdW5kZWQtbWQgYmctZ3JhZGllbnQtdG8tYiBmcm9tLW11dGVkLzUwIHRvLW11dGVkIHAtNiBuby11bmRlcmxpbmUgb3V0bGluZS1ub25lIGZvY3VzOnNoYWRvdy1tZCIKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGhyZWY9Ii8iCiAgICAgICAgICAgICAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPEljb25zLmxvZ28gY2xhc3NOYW1lPSJoLTYgdy02IiAvPgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9Im1iLTIgbXQtNCB0ZXh0LWxnIGZvbnQtbWVkaXVtIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2hhZGNuL3VpCiAgICAgICAgICAgICAgICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT0idGV4dC1zbSBsZWFkaW5nLXRpZ2h0IHRleHQtbXV0ZWQtZm9yZWdyb3VuZCI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEJlYXV0aWZ1bGx5IGRlc2lnbmVkIGNvbXBvbmVudHMgYnVpbHQgd2l0aCBSYWRpeAogICAgICAgICAgICAgICAgICAgICAgICAgICAgICBVSSBhbmQgVGFpbHdpbmQgQ1NTLgogICAgICAgICAgICAgICAgICAgICAgICAgICAgPC9wPgogICAgICAgICAgICAgICAgICAgICAgICAgIDwvYT4KICAgICAgICAgICAgICAgICAgICAgICAgPC9OYXZpZ2F0aW9uTWVudUxpbms+CiAgICAgICAgICAgICAgICAgICAgICA8L2xpPgoKICAgICAgICAgICAgICAgICAgICAgIDxsaT4KICAgICAgICAgICAgICAgICAgICAgICAgPE5hdmlnYXRpb25NZW51TGluayBhc0NoaWxkPgogICAgICAgICAgICAgICAgICAgICAgICAgIDxhIGNsYXNzTmFtZT0iYmxvY2sgc2VsZWN0LW5vbmUgc3BhY2UteS0xIHJvdW5kZWQtbWQgcC0zIGxlYWRpbmctbm9uZSBuby11bmRlcmxpbmUgb3V0bGluZS1ub25lIHRyYW5zaXRpb24tY29sb3JzIGhvdmVyOmJnLWFjY2VudCBob3Zlcjp0ZXh0LWFjY2VudC1mb3JlZ3JvdW5kIGZvY3VzOmJnLWFjY2VudCBmb2N1czp0ZXh0LWFjY2VudC1mb3JlZ3JvdW5kIj4KICAgICAgICAgICAgICAgICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LXNtIGZvbnQtbWVkaXVtIGxlYWRpbmctbm9uZSI+CiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIEludHIgPT4gKCFpdGVtLm1vcmVPbk1vYmlsZSAmJiAhaXRlbS5vbmx5RGVza3RvcCkgfHwgaXRlbS5uYW1lID09PSBNT1JFX1NFUEFSQVRPUl9OQU1FCiAgICApOwogICAgY29uc3QgbW9iaWxlTmF2aWdhdGlvbk1vcmVJdGVtcyA9IGl0ZW1zLmZpbHRlcigKICAgICAgKGl0ZW0pID0+IGl0ZW0ubW9yZU9uTW9iaWxlICYmICFpdGVtLm9ubHlEZXNrdG9wICYmIGl0ZW0ubmFtZSAhPT0gTU9SRV9TRVBBUkFUT1JfTkFNRQogICAgKTsKCiAgICByZXR1cm4geyBkZXNrdG9wTmF2aWdhdGlvbkl0ZW1zLCBtb2JpbGVOYXZpZ2F0aW9uQm90dG9tSXRlbXMsIG1vYmlsZU5hdmlnYXRpb25Nb3JlSXRlbXMgfTsKICB9LCBbaGFzUGFpZFBsYW4sIGlzUGVuZGluZywgaXNQbGF0Zm9ybU5hdmlnYXRpb24sIG9yZ0JyYW5kaW5nXSk7Cn07CgpleHBvcnQgY29uc3QgTmF2aWdhdGlvbiA9ICh7IGlzUGxhdGZvcm1OYXZpZ2F0aW9uID0gZmFsc2UgfTogeyBpc1BsYXRmb3JtTmF2aWdhdGlvbj86IGJvb2xlYW4gfSkgPT4gewogIGNvbnN0IHsgZGVza3RvcE5hdmlnYXRpb25JdGVtcyB9ID0gdXNlTmF2aWdhdGlvbkl0ZW1zKGlzUGxhdGZvcm1OYXZpZ2F0aW9uKTsKCiAgcmV0dXJuICgKICAgIDxuYXYgY2xhc3NOYW1lPSJtdC0yIGZsZXgtMSBtZDpweC0yIGxnOm10LTQgbGc6cHgtMCI+CiAgICAgIHtkZXNrdG9wTmF2aWdhdGlvbkl0ZW1zLm1hcCgoaXRlbSkgPT4gKAogICAgICAgIDxOYXZpZ2F0aW9uSXRlbSBrZXk9e2l0ZW0ubmFtZX0gaXRlbT17aXRlbX0gLz4KICAgICAgKSl9CiAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LXN1YnRsZSBtdC0wLjUgbGc6aGlkZGVuIj4KICAgICAgICA8S0JhclRyaWdnZXIgLz4KICAgICAgPC9kaXY+CiAgICA8L25hdj4KICApOwp9OwoKZXhwb3J0IGZ1bmN0aW9uIE1vYmlsZU5hdmlnYXRpb25Db250YWluZXIoewogIGlzUGxhdGZvcm1OYXZpZ2F0aW9uID0gZmFsc2UsCn06IHsKICBpc1BsYXRmb3JtTmF2aWdhdGlvbj86IGJvb2xlYW47Cn0pIHsKICBjb25zdCB7IHN0YXR1cyB9ID0gdXNlU2Vzc2lvbigpOwogIGNvbnN0IGlzU3RhbmRhbG9uZSA9IHVzZUlzU3RhbmRhbG9uZSgpOwogIGlmIChzdGF0dXMgIT09ICJhdXRoZW50aWNhdGVkIiB8fCBpc1N0YW5kYWxvbmUpIHJldHVybiBudWxsOwogIHJldHVybiA8TW9iaWxlTmF2aWdhdGlvbiBpc1BsYXRmb3JtTmF2aWdhdGlvbj17aXNQbGF0Zm9ybU5hdmlnYXRpb259IC8+Owp9Cgpjb25zdCBNb2JpbGVOYXZpZ2F0aW9uID0gKHsgaXNQbGF0Zm9ybU5hdmlnYXRpb24gPSBmYWxzZSB9OiB7IGlzUGxhdGZvcm1OYXZpZ2F0aW9uPzogYm9vbGVhbiB9KSA9PiB7CiAgY29uc3QgaXNFbWJlZCA9IHVzZUlzRW1iZWQoKTsKICBjb25zdCB7IG1vYmlsZU5hdmlnYXRpb25Cb3R0b21JdGVtcyB9ID0gdXNlTmF2aWdhdGlvbkl0ZW1zKGlzUGxhdGZvcm1OYXZpZ2F0aW9uKTsKCiAgcmV0dXJuICgKICAgIDw+CiAgICAgIDxuYXYKICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZXMoCiAgICAgICAgICAicHdhOnBiLVttYXgoMC4yNXJlbSxlbnYoc2FmZS1hcmVhLWluc2V0LWJvdHRvbSkpXSBwd2E6LW14LTIgYmctY2FsLW11dGVkLzQwIGJvcmRlci1zdWJ0bGUgZml4ZWQgYm90dG9tLTAgbGVmdC0wIHotMzAgZmxleCB3LWZ1bGwgYm9yZGVyLXQgcHgtMSBzaGFkb3cgYmFja2Ryb3AtYmx1ci1tZCBtZDpoaWRkZW4iLAogICAgICAgICAgaXNFbWJlZCAmJiAiaGlkZGVuIgogICAgICAgICl9PgogICAgICAgIHttb2JpbGVOYXZpZ2F0aW9uQm90dG9tSXRlbXMubWFwKChpdGVtKSA9PiAoCiAgICAgICAgICA8TW9iaWxlTmF2aWdhdGlvbkl0ZW0ga2V5PXtpdGVtLm5hbWV9IGl0ZW09e2l0ZW19IC8+CiAgICAgICAgKSl9CiAgICAgIDwvbmF2PgogICAgICB7LyogYWRkIHBhZGRpbmcgdG8gY29udGVudCBmb3IgbW9iaWxlIG5hdmlnYXRpb24qL30KICAgICAgPGRpdiBjbGFzc05hbWU9ImJsb2NrIHB0LTEyIG1kOmhfc2Vwb2xpYV92MyA9ICdwcm90b19iYXNlX3NlcG9saWFfdjMnLAogIC8vIHYzIG1haW5uZXRzCiAgcHJvdG9fbWFpbm5ldF92MyA9ICdwcm90b19tYWlubmV0X3YzJywKICBwcm90b19vcHRpbWlzbV92MyA9ICdwcm90b19vcHRpbWlzbV92MycsCiAgcHJvdG9fYXZhbGFuY2hlX3YzID0gJ3Byb3RvX2F2YWxhbmNoZV92MycsCiAgcHJvdG9fcG9seWdvbl92MyA9ICdwcm90b19wb2x5Z29uX3YzJywKICBwcm90b19hcmJpdHJ1bV92MyA9ICdwcm90b19hcmJpdHJ1bV92MycsCiAgcHJvdG9fbWV0aXNfdjMgPSAncHJvdG9fbWV0aXNfdjMnLAogIHByb3RvX2Jhc2VfdjMgPSAncHJvdG9fYmFzZV92MycsCiAgcHJvdG9fZ25vc2lzX3YzID0gJ3Byb3RvX2dub3Npc192MycsCiAgcHJvdG9fYm5iX3YzID0gJ3Byb3RvX2JuYl92MycsCiAgcHJvdG9fc2Nyb2xsX3YzID0gJ3Byb3RvX3Njcm9sbF92MycsCiAgcHJvdG9fbGlkb192MyA9ICdwcm90b19saWRvX3YzJywKICBwcm90b196a3N5bmNfdjMgPSAncHJvdG9femtzeW5jX3YzJywKICBwcm90b19ldGhlcmZpX3YzID0gJ3Byb3RvX2V0aGVyZmlfdjMnLAogIHByb3RvX2xpbmVhX3YzID0gJ3Byb3RvX2xpbmVhX3YzJywKICBwcm90b19zb25pY192MyA9ICdwcm90b19zb25pY192MycsCiAgcHJvdG9fY2Vsb192MyA9ICdwcm90b19jZWxvX3YzJywKICBwcm90b19zb25laXVtX3YzID0gJ3Byb3RvX3NvbmVpdW1fdjMnLAogIHByb3RvX2hvcml6b25fdjMgPSAncHJvdG9faG9yaXpvbl92MycsCiAgcHJvdG9fYXB0b3NfdjMgPSAncHJvdG9fYXB0b3NfdjMnLAogIHByb3RvX3BsYXNtYV92MyA9ICdwcm90b19wbGFzbWFfdjMnLAogIHByb3RvX2lua192MyA9ICdwcm90b19pbmtfdjMnLAogIC8vIHYyCiAgcHJvdG9fbWFpbm5ldCA9ICdwcm90b19tYWlubmV0JywKICBwcm90b19hdmFsYW5jaGUgPSAncHJvdG9fYXZhbGFuY2hlJywKICBwcm90b19mdWppID0gJ3Byb3RvX2Z1amknLAogIHByb3RvX3BvbHlnb24gPSAncHJvdG9fcG9seWdvbicsCgogIC8vIGV4dGVybmFsCiAgLy8gcGVybWlzc2lvbmVkX21hcmtldCA9ICdwZXJtaXNzaW9uZWRfbWFya2V0JywKfQoKZXhwb3J0IGNvbnN0IG1hcmtldHNEYXRhOiB7CiAgW2tleSBpbiBrZXlvZiB0eXBlb2YgQ3VzdG9tTWFya2V0XTogTWFya2V0RGF0YVR5cGU7Cn0gPSB7CiAgW0N1c3RvbU1hcmtldC5wcm90b19tYWlubmV0X3YzXTogewogICAgbWFya2V0VGl0bGU6ICdDb3JlJywKICAgIG1hcmtldDogQ3VzdG9tTWFya2V0LnByb3RvX21haW5uZXRfdjMsCiAgICBjaGFpbklkOiBDaGFpbklkLm1haW5uZXQsCiAgICB2MzogdHJ1ZSwKICAgIGVuYWJsZWRGZWF0dXJlczogewogICAgICBnb3Zlcm5hbmNlOiB0cnVlLAogICAgICBzdGFraW5nOiB0cnVlLAogICAgICBsaXF1aWRpdHlTd2FwOiB0cnVlLAogICAgICBjb2xsYXRlcmFsUmVwYXk6IHRydWUsCiAgICAgIGluY2VudGl2ZXM6IHRydWUsCiAgICAgIHdpdGhkcmF3QW5kU3dpdGNoOiB0cnVlLAogICAgICBkZWJ0U3dpdGNoOiB0cnVlLAogICAgICBzd2l0Y2g6IHRydWUsCiAgICAgIGxpbWl0OiB0cnVlLAogICAgfSwKICAgIGFkZHJlc3NlczogewogICAgICBMRU5ESU5HX1BPT0xfQUREUkVTU19QUk9WSURFUjogQWF2ZVYzRXRoZXJldW0uUE9PTF9BRERSRVNTRVNfUFJPVklERVIsCiAgICAgIExFTkRJTkdfUE9PTDogQWF2ZVYzRXRoZXJldW0uUE9PTCwKICAgICAgV0VUSF9HQVRFV0FZOiBBYXZlVjNFdGhlcmV1bS5XRVRIX0dBVEVXQVksCiAgICAgIFJFUEFZX1dJVEhfQ09MTEFURVJBTF9BREFQVEVSOiBBYXZlVjNFdGhlcmV1bS5SRVBBWV9XSVRIX0NPTExBVEVSQUxfQURBUFRFUiwKICAgICAgU1dBUF9DT0xMQVRFUkFMX0FEQVBURVI6IEFhdmVWM0V0aGVyZXVtLlNXQVBfQ09MTEFURVJBTF9BREFQVEVSLAogICAgICBXQUxMRVRfQkFMQU5DRV9QUk9WSURFUjogQWF2ZVYzRXRoZXJldW0uV0FMTHsKICBBdmF0YXIsCiAgQXZhdGFyRmFsbGJhY2ssCiAgQXZhdGFySW1hZ2UsCn0gZnJvbSAiQC9leGFtcGxlcy9iYXNlL3VpLXJ0bC9hdmF0YXIiCmltcG9ydCB7IEJhZGdlIH0gZnJvbSAiQC9leGFtcGxlcy9iYXNlL3VpLXJ0bC9iYWRnZSIKaW1wb3J0IHsKICBDb21tYW5kLAogIENvbW1hbmRFbXB0eSwKICBDb21tYW5kR3JvdXAsCiAgQ29tbWFuZElucHV0LAogIENvbW1hbmRJdGVtLAogIENvbW1hbmRMaXN0LAp9IGZyb20gIkAvZXhhbXBsZXMvYmFzZS91aS1ydGwvY29tbWFuZCIKaW1wb3J0IHsKICBEcm9wZG93bk1lbnUsCiAgRHJvcGRvd25NZW51Q2hlY2tib3hJdGVtLAogIERyb3Bkb3duTWVudUNvbnRlbnQsCiAgRHJvcGRvd25NZW51R3JvdXAsCiAgRHJvcGRvd25NZW51SXRlbSwKICBEcm9wZG93bk1lbnVMYWJlbCwKICBEcm9wZG93bk1lbnVTZXBhcmF0b3IsCiAgRHJvcGRvd25NZW51U3ViLAogIERyb3Bkb3duTWVudVN1YkNvbnRlbnQsCiAgRHJvcGRvd25NZW51U3ViVHJpZ2dlciwKICBEcm9wZG93bk1lbnVUcmlnZ2VyLAp9IGZyb20gIkAvZXhhbXBsZXMvYmFzZS91aS1ydGwvZHJvcGRvd24tbWVudSIKaW1wb3J0IHsgRmllbGQsIEZpZWxkTGFiZWwgfSBmcm9tICJAL2V4YW1wbGVzL2Jhc2UvdWktcnRsL2ZpZWxkIgppbXBvcnQgewogIElucHV0R3JvdXAsCiAgSW5wdXRHcm91cEFkZG9uLAogIElucHV0R3JvdXBCdXR0b24sCiAgSW5wdXRHcm91cFRleHRhcmVhLAp9IGZyb20gIkAvZXhhbXBsZXMvYmFzZS91aS1ydGwvaW5wdXQtZ3JvdXAiCmltcG9ydCB7IFBvcG92ZXIsIFBvcG92ZXJDb250ZW50IH0gZnJvbSAiQC9leGFtcGxlcy9iYXNlL3VpLXJ0bC9wb3BvdmVyIgppbXBvcnQgeyBTd2l0Y2ggfSBmcm9tICJAL2V4YW1wbGVzL2Jhc2UvdWktcnRsL3N3aXRjaCIKaW1wb3J0IHsKICBUb29sdGlwLAogIFRvb2x0aXBDb250ZW50LAogIFRvb2x0aXBUcmlnZ2VyLAp9IGZyb20gIkAvZXhhbXBsZXMvYmFzZS91aS1ydGwvdG9vbHRpcCIKaW1wb3J0IHsKICBJY29uQXBwcywKICBJY29uQXJyb3dVcCwKICBJY29uQXQsCiAgSWNvbkJvb2ssCiAgSWNvbkNpcmNsZURhc2hlZFBsdXMsCiAgSWNvblBhcGVyY2xpcCwKICBJY29uUGx1cywKICBJY29uV29ybGQsCiAgSWNvblgsCn0gZnJvbSAiQHRhYmxlci9pY29ucy1yZWFjdCIKCmltcG9ydCB7IHVzZUxhbmd1YWdlQ29udGV4dCB9IGZyb20gIkAvY29tcG9uZW50cy9sYW5ndWFnZS1zZWxlY3RvciIKCmNvbnN0IHRyYW5zbGF0aW9ucyA9IHsKICBhcjogewogICAgZGlyOiAicnRsIiBhcyBjb25zdCwKICAgIHByb21wdDogItin2YTYo9mF2LEiLAogICAgcGxhY2Vob2xkZXI6ICLYp9iz2KPZhNiMINin2KjYrdir2Iwg2KPZiCDYo9mG2LTYpiDYo9mKINi02YrYoS4uLiIsCiAgICBhZGRDb250ZXh0OiAi2KPYttmBINiz2YrYp9mCIiwKICAgIG1lbnRpb25Ub29sdGlwOiAi2KfYsNmD2LEg2LTYrti12YvYpyDYo9mIINi12YHYrdipINij2Ygg2KrYp9ix2YrYrtmL2KciLAogICAgc2VhcmNoUGFnZXM6ICLYp9mE2KjYrdirINmB2Yog2KfZhNi12YHYrdin2KouLi4iLAogICAgbm9QYWdlc0ZvdW5kOiAi2YTZhSDZitiq2YUg2KfZhNi52KvZiNixINi52YTZiSDYtdmB2K3Yp9iqIiwKICAgIHBhZ2VzOiAi2KfZhNi12YHYrdin2KoiLAogICAgdXNlcnM6ICLYp9mE2YXYs9iq2K7Yr9mF2YjZhiIsCiAgICBhdHRhY2hGaWxlOiAi2KXYsdmB2KfZgiDZhdmE2YEiLAogICAgc2VsZWN0TW9kZWw6ICLYp9iu2KrYsSDZhtmF2YjYsNisINin2YTYsNmD2KfYoSDYp9mE2KfYtdi32YbYp9i52YoiLAogICAgc2VsZWN0QWdlbnRNb2RlOiAi2KfYrtiq2LEg2YjYtti5INin2YTZiNmD2YrZhCIsCiAgICB3ZWJTZWFyY2g6ICLYp9mE2KjYrdirINi52YTZiSDYp9mE2YjZitioIiwKICAgIGFwcHNJbnRlZ3JhdGlvbnM6ICLYp9mE2KrYt9io2YrZgtin2Kog2YjYp9mE2KrZg9in2YXZhNhlbnQsIERpYWxvZ0Zvb3RlciwgRGlhbG9nSGVhZGVyLCBEaWFsb2dDbG9zZSB9IGZyb20gIkBjYWxjb20vdWkvY29tcG9uZW50cy9kaWFsb2ciOwppbXBvcnQgeyBzaG93VG9hc3QgfSBmcm9tICJAY2FsY29tL3VpL2NvbXBvbmVudHMvdG9hc3QiOwoKZnVuY3Rpb24gaGlkZURpYWxvZ0ZvcihoaWRlRm9yOiBbbnVtYmVyLCBEYXlqc01hbmlwdWxhdGVUeXBlXSwgdG9hc3RDb250ZW50OiBzdHJpbmcpIHsKICBkb2N1bWVudC5jb29raWUgPSBgY2FsY29tLXRpbWV6b25lLWRpYWxvZz0xO21heC1hZ2U9JHsKICAgIGRheWpzKCkuYWRkKGhpZGVGb3JbMF0sIGhpZGVGb3JbMV0pLnVuaXgoKSAtIGRheWpzKCkudW5peCgpCiAgfWA7CiAgaWYgKHRvYXN0Q29udGVudCkgc2hvd1RvYXN0KHRvYXN0Q29udGVudCwgInN1Y2Nlc3MiKTsKfQoKY29uc3QgVGltZXpvbmVDaGFuZ2VEaWFsb2dDb250ZW50ID0gKCkgPT4gewogIGNvbnN0IHsgdCwgaXNMb2NhbGVSZWFkeSB9ID0gdXNlTG9jYWxlKCk7CiAgaWYgKCFpc0xvY2FsZVJlYWR5KSByZXR1cm4gbnVsbDsKCiAgY29uc3QgdXRpbHMgPSB0cnBjLnVzZVV0aWxzKCk7CgogIGNvbnN0IGZvcm1hdHRlZEN1cnJlbnRUeiA9IENVUlJFTlRfVElNRVpPTkUucmVwbGFjZSgiXyIsICIgIik7CgogIGNvbnN0IG9uTXV0YXRpb25TdWNjZXNzID0gYXN5bmMgKCkgPT4gewogICAgc2hvd1RvYXN0KAogICAgICB0KCJ1cGRhdGVkX3RpbWV6b25lX3RvIiwgeyBmb3JtYXR0ZWRDdXJyZW50VHosIGludGVycG9sYXRpb246IHsgZXNjYXBlVmFsdWU6IGZhbHNlIH0gfSksCiAgICAgICJzdWNjZXNzIgogICAgKTsKICAgIGF3YWl0IHV0aWxzLnZpZXdlci5tZS5pbnZhbGlkYXRlKCk7CiAgfTsKCiAgY29uc3Qgb25NdXRhdGlvbkVycm9yID0gKCkgPT4gewogICAgc2hvd1RvYXN0KHQoImNvdWxkbnRfdXBkYXRlX3RpbWV6b25lIiksICJlcnJvciIpOwogIH07CgogIC8vIHVwZGF0ZSB0aW1lem9uZSBpbiBkYgogIGNvbnN0IG11dGF0aW9uID0gdHJwYy52aWV3ZXIubWUudXBkYXRlUHJvZmlsZS51c2VNdXRhdGlvbih7CiAgICBvblN1Y2Nlc3M6IG9uTXV0YXRpb25TdWNjZXNzLAogICAgb25FcnJvcjogb25NdXRhdGlvbkVycm9yLAogIH0pOwoKICBjb25zdCB1cGRhdGVUaW1lem9uZSA9ICgpID0+IHsKICAgIG11dGF0aW9uLm11dGF0ZSh7CiAgICAgIHRpbWVab25lOiBDVVJSRU5UX1RJTUVaT05FLAogICAgfSk7CiAgfTsKCiAgcmV0dXJuICgKICAgIDw+CiAgICAgIDxEaWFsb2dIZWFkZXIKICAgICAgICB0aXRsZT17dCgidXBkYXRlX3RpbWV6b25lX3F1ZXN0aW9uIil9CiAgICAgICAgc3VidGl0bGU9e3QoInVwZGF0ZV90aW1lem9uZV9kZXNjcmlwdGlvbiIsIHsKICAgICAgICAgIGZvcm1hdHRlZEN1cnJlbnRUeiwKICAgICAgICAgIGludGVycG9sYXRpb246IHsgZXNjYXBlVmFsdWU6IGZhbHNlIH0sCiAgICAgICAgfSl9CiAgICAgIC8+CiAgICAgIHsvKiB0b2RvOiBzYXZlIHRoaXMgaW4gZGIgYW5kIGF1dG8tdXBkYXRlIHdoZW4gdGltZXpvbmUgY2hhbmdlcyAoYmUgYWJsZSB0byBkaXNhYmxlPz8/IGlmIHllcywgL3NldHRpbmdzKQogICAgICAgIDxDaGVja2JveCBkZXNjcmlwdGlvbj0iQWx3YXlzIHVwZGF0ZSB0aW1lem9uZSIgLz4KICAgICAgICAqL30KICAgICAgPGRpdiBjbGFzc05hbWU9Im1iLTgiIC8+CiAgICAgIDxEaWFsb2dGb290ZXIgc2hvd0RpdmlkZXI+CiAgICAgICAgPERpYWxvZ0Nsb3NlIG9uQ2xpY2s9eygpID0+IGhpZGVEaWFsb2dGb3IoWzMsICJtb250aHMiXSwgdCgid2Vfd29udF9zaG93X2FnYWluIikpfSBjb2xvcj0ic2Vjb25kYXJ5Ij4KICAgICAgICAgIHt0KCJkb250X3VwZGF0ZSIpfQogICAgICAgIDwvRGlhbG9nQ2xvc2U+CiAgICAgICAgPERpYWxvZ0Nsb3NlIG9uQ2xpY2s9eygpID0+IHVwZGF0ZVRpbWV6b25lKCl9IGNvbG9yPSJwcmltYXJ5Ij4KICAgICAgICAgIHt0KCJ1cGRhdGVfdGltZXpvbmUiKX0KOTgzIDAuMDAxNzIyNzlDOS40OTgzIDAuMDAxNzIyNzkgMTUuMDk4NSAtMC4yNTM0NDkgMTguMDY3MyA1LjQ0NzI0SDkuMDIxOTRDOS4wMjE5NCA1LjQ0NzI0IDcuMzE1MzMgNS4zOTIwNyA1Ljg1NzA4IDcuNDg4NjJDNS40Mzg0MSA4LjM2ODYyIDQuOTg4NTEgOS4yNzU1MiA1LjQ5MzM3IDExLjA2MjRDNC43NjUyNiA5LjgxNDE0IDEuNjI4OTEgNC4yODMxIDEuNjI4OTEgNC4yODMxQzEuNjI4OTEgNC4yODMxIDMuODQxMDUgMC4yMjcyNCA5LjQ5ODMgMC4wMDE3MjI3OVoiCiAgICAgICAgICBmaWxsPSIjRUYzRjM2IgogICAgICAgIC8+CiAgICAgICAgPHBhdGgKICAgICAgICAgIGQ9Ik0xNy43NzY4IDE0LjQ3MTVDMTcuNzc2OCAxNC40NzE1IDE1LjE5MjggMTkuNTExNSA4LjgzNTk0IDE5LjI2MThDOS42MjE3MiAxNy44ODU5IDEzLjM2IDExLjMyOTQgMTMuMzYgMTEuMzI5NEMxMy4zNiAxMS4zMjk0IDE0LjI2MzIgOS44NjA0MiAxMy4xOTcxIDcuNTMyODNDMTIuNjU1NiA2LjcyNDU2IDEyLjEwMzMgNS44NzgzNSAxMC4zMjM0IDUuNDI4MDFDMTEuNzU1MiA1LjQxNDIxIDE4LjA1MTYgNS40MjgwMSAxOC4wNTE2IDUuNDI4MDFDMTguMDUxNiA1LjQyODAxIDIwLjQxMDMgOS4zOTY5NyAxNy43NzYxIDE0LjQ3MTUiCiAgICAgICAgICBmaWxsPSIjRkNEOTAwIgogICAgICAgIC8+CiAgICAgICAgPHBhdGgKICAgICAgICAgIGQ9Ik0xLjI2MDkyIDE0LjUxMzJDMS4yNjA5MiAxNC41MTMyIC0xLjc1ODA1IDkuNzI4MzggMS42MzQ4MSA0LjI3NzM0QzIuNDE3ODggNS42NTMyMSA2LjE1NjEzIDEyLjIwOTggNi4xNTYxMyAxMi4yMDk4QzYuMTU2MTMgMTIuMjA5OCA2Ljk2MjI4IDEzLjczNjcgOS40ODMxNyAxMy45NjQyQzEwLjQ0NCAxMy44OTMyIDExLjQ0NDIgMTMuODMxOCAxMi43MjIgMTIuNDk4N0MxMi4wMTc2IDEzLjc2MDggOC44NTc1MyAxOS4yNzUzIDguODU3NTMgMTkuMjc1M0M4Ljg1NzUzIDE5LjI3NTMgNC4yODEyNCAxOS4zNjAxIDEuMjYwMjQgMTQuNTEzMiIKICAgICAgICAgIGZpbGw9IiM2MUJDNUIiCiAgICAgICAgLz4KICAgICAgICA8cGF0aAogICAgICAgICAgZD0iTTguODM1OTQgMTkuMzA5MkwxMC4xMDg5IDEzLjkzMjZDMTAuMTA4OSAxMy45MzI2IDExLjUwNjggMTMuODIxNiAxMi42Nzk0IDEyLjUxOTVDMTEuOTUxMyAxMy44MTYxIDguODM1OTQgMTkuMzA5MiA4LjgzNTk0IDE5LjMwOTJaIgogICAgICAgICAgZmlsbD0iIzVBQjA1NSIKICAgICAgICAvPgogICAgICAgIDxwYXRoCiAgICAgICAgICBkPSJNNS4yMzgyOCA5LjcxODJDNS4yMzgyOCA3LjM0Nzg1IDcuMTM2MjUgNS40MjU3OCA5LjQ3NjY0IDUuNDI1NzhDMTEuODE3IDUuNDI1NzggMTMuNzE1IDcuMzQ3ODUgMTMuNzE1IDkuNzE4MkMxMy43MTUgMTIuMDg4NSAxMS44MTcgMTQuMDEwNiA5LjQ3NjY0IDE0LjAxMDZDNy4xMzU1NyAxNC4wMDc5IDUuMjM4MjggMTIuMDg4NSA1LjIzODI4IDkuNzE4MloiCiAgICAgICAgICBmaWxsPSJ3aGl0ZSIKICAgICAgICAvPgogICAgICAgIDxwYXRoCiAgICAgICAgICBkPSJNNS45NDkyMiA5LjcxOTAxQzUuOTQ5MjIgNy43NDU5MSA3LjUyNzU4IDYuMTQ0NTMgOS40Nzc3OSA2LjE0NDUzQzExLjQyNTMgNi4xNDQ1MyAxMy4wMDY0IDcuNzQzMTUgMTMuMDA2NCA5LjcxODMyQzEzLjAwNjQgMTEuNjkwNyAxMS40Mjg3IDEzLjI5MjEgOS40Nzc3OSAxMy4yOTIxQzcuNTMwMjkgMTMuMjkyMSA1Ljk0OTIyIDExLjY5MDcgNS45NDkyMiA5LjcxODMyIgogICAgICAgICAgZmlsbD0idXJsKCNwYWludDBfbGluZWFyX2Nocm9tZSkiCiAgICAgICAgLz4KICAgICAgICA8cGF0aAogICAgICAgICAgZD0iTTE4LjA1MTggNS40MzMzN0wxMi44MTMyIDYuOTg5MjNDMTIuODEzMiA2Ljk4OTIzIDEyLjAyMzQgNS44MTQ3NCAxMC4zMjQyIDUuNDMzMzdDMTEuNzk4MSA1LjQyNTA5IDE4LjA1MTggNS40MzMzNyAxOC4wNTE4IDUuNDMzMzdaIgogICAgICAgICAgZmlsbD0iI0VBQ0EwNSIKIGZpbGUudXNlcm5hbWUgPz8gIiJ9YCwKICAgICAgICAgIG5hbWU6IGAke3Byb2ZpbGUubmFtZSA/PyAiIn1gLAogICAgICAgIH0sCiAgICAgIF0sCiAgICB9OwogICAgY29uc3QgaXNPcmcgPSAhIXByb2ZpbGU/Lm9yZ2FuaXphdGlvbjsKICAgIGNvbnN0IGFsbG93U0VPSW5kZXhpbmcgPQogICAgICAoIWlzT3JnICYmIHByb2ZpbGUuYWxsb3dTRU9JbmRleGluZykgfHwgKGlzT3JnICYmIGlzT3JnU0VPSW5kZXhhYmxlICYmIHByb2ZpbGUuYWxsb3dTRU9JbmRleGluZyk7CiAgICByZXR1cm4gewogICAgICAuLi4oYXdhaXQgZ2VuZXJhdGVNZWV0aW5nTWV0YWRhdGEoCiAgICAgICAgbWVldGluZywKICAgICAgICAoKSA9PiBwcm9maWxlLm5hbWUsCiAgICAgICAgKCkgPT4gbWFya2Rvd25TdHJpcHBlZEJpbywKICAgICAgICBmYWxzZSwKICAgICAgICBnZXRPcmdGdWxsT3JpZ2luKGVudGl0eS5vcmdTbHVnID8/IG51bGwpLAogICAgICAgIGAvJHtkZWNvZGVkUGFyYW1zLnVzZXJ9YAogICAgICApKSwKICAgICAgcm9ib3RzOiB7CiAgICAgICAgaW5kZXg6IGFsbG93U0VPSW5kZXhpbmcsCiAgICAgICAgZm9sbG93OiBhbGxvd1NFT0luZGV4aW5nLAogICAgICB9LAogICAgfTsKICB9Cn07Cgpjb25zdCBTZXJ2ZXJQYWdlID0gYXN5bmMgKHsgcGFyYW1zLCBzZWFyY2hQYXJhbXMgfTogUGFnZVByb3BzKSA9PiB7CiAgY29uc3QgcHJvcHMgPSBhd2FpdCBnZXREYXRhKAogICAgYnVpbGRMZWdhY3lDdHgoYXdhaXQgaGVhZGVycygpLCBhd2FpdCBjb29raWVzKCksIGF3YWl0IHBhcmFtcywgYXdhaXQgc2VhcmNoUGFyYW1zKQogICk7CiAgaWYgKChwcm9wcyBhcyBUZWFtUGFnZVByb3BzKT8udGVhbSkgewogICAgcmV0dXJuIDxUZWFtUGFnZSB7Li4uKHByb3BzIGFzIFRlYW1QYWdlUHJvcHMpfSAvPjsKICB9CiAgcmV0dXJuIDxVc2VyUGFnZSB7Li4uKHByb3BzIGFzIFVzZXJQYWdlUHJvcHMpfSAvPjsKfTsKCmV4cG9ydCBkZWZhdWx0IFNlcnZlclBhZ2U7CmltcG9ydCB7CiAgRXhhbXBsZSwKICBFeGFtcGxlV3JhcHBlciwKfSBmcm9tICJAL3JlZ2lzdHJ5L2Jhc2VzL2Jhc2UvY29tcG9uZW50cy9leGFtcGxlIgppbXBvcnQgeyBCYWRnZSB9IGZyb20gIkAvcmVnaXN0cnkvYmFzZXMvYmFzZS91aS9iYWRnZSIKaW1wb3J0IHsgU3Bpbm5lciB9IGZyb20gIkAvcmVnaXN0cnkvYmFzZXMvYmFzZS91aS9zcGlubmVyIgppbXBvcnQgeyBJY29uUGxhY2Vob2xkZXIgfSBmcm9tICJAL2FwcC8oY3JlYXRlKS9jb21wb25lbnRzL2ljb24tcGxhY2Vob2xkZXIiCgpleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBCYWRnZUV4YW1wbGUoKSB7CiAgcmV0dXJuICgKICAgIDxFeGFtcGxlV3JhcHBlciBjbGFzc05hbWU9ImxnOmdyaWQtY29scy0xIj4KICAgICAgPEJhZGdlVmFyaWFudHMgLz4KICAgICAgPEJhZGdlV2l0aEljb25MZWZ0IC8+CiAgICAgIDxCYWRnZVdpdGhJY29uUmlnaHQgLz4KICAgICAgPEJhZGdlV2l0aFNwaW5uZXIgLz4KICAgICAgPEJhZGdlQXNMaW5rIC8+CiAgICAgIDxCYWRnZUxvbmdUZXh0IC8+CiAgICAgIDxCYWRnZUN1c3RvbUNvbG9ycyAvPgogICAgPC9FeGFtcGxlV3JhcHBlcj4KICApCn0KCmZ1bmN0aW9uIEJhZGdlVmFyaWFudHMoKSB7CiAgcmV0dXJuICgKICAgIDxFeGFtcGxlIHRpdGxlPSJWYXJpYW50cyI+CiAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGZsZXgtd3JhcCBnYXAtMiI+CiAgICAgICAgPEJhZGdlPkRlZmF1bHQ8L0JhZGdlPgogICAgICAgIDxCYWRnZSB2YXJpYW50PSJzZWNvbmRhcnkiPlNlY29uZGFyeTwvQmFkZ2U+CiAgICAgICAgPEJhZGdlIHZhcmlhbnQ9ImRlc3RydWN0aXZlIj5EZXN0cnVjdGl2ZTwvQmFkZ2U+CiAgICAgICAgPEJhZGdlIHZhcmlhbnQ9Im91dGxpbmUiPk91dGxpbmU8L0JhZGdlPgogICAgICAgIDxCYWRnZSB2YXJpYW50PSJnaG9zdCI+R2hvc3Q8L0JhZGdlPgogICAgICAgIDxCYWRnZSB2YXJpYW50PSJsaW5rIj5MaW5rPC9CYWR1c3RvbVNsaXBwYWdlID0gY3VzdG9tU2xpcHBhZ2VUb2xlcmFuY2UgJiYgIWlzWmVyb1NsaXBwYWdlCgogIGNvbnN0IG1lZXRzUGxhdGZvcm1Db25kaXRpb25zID0gKGlzV2ViQXBwIHx8IGlzRXh0ZW5zaW9uQXBwKSAmJiAhaXNNb2JpbGVXZWIKICBjb25zdCBleGNlZWRzU2xpcHBhZ2VUb2xlcmFuY2UgPSAhIWN1c3RvbVNsaXBwYWdlVG9sZXJhbmNlICYmIGN1c3RvbVNsaXBwYWdlVG9sZXJhbmNlID4gYXV0b1NsaXBwYWdlVG9sZXJhbmNlCgogIGNvbnN0IHNob3VsZFNob3dTZXR0aW5nc0ljb25Ub29sdGlwID0gbWVldHNQbGF0Zm9ybUNvbmRpdGlvbnMgJiYgZXhjZWVkc1NsaXBwYWdlVG9sZXJhbmNlCgogIGNvbnN0IHsgYmFja2dyb3VuZENvbG9yLCBjb250ZW50Q29sb3IsIEljb25Db21wb25lbnQgfSA9IHVzZU1lbW8oKCkgPT4gewogICAgY29uc3QgaWNvbkJhY2tncm91bmRDb2xvciA9IGdldFNldHRpbmdzSWNvbkJhY2tncm91bmRDb2xvcihhdXRvU2xpcHBhZ2VUb2xlcmFuY2UsIGN1c3RvbVNsaXBwYWdlVG9sZXJhbmNlKQogICAgY29uc3QgZmlsbENvbG9yID0gZ2V0U2xpcHBhZ2VXYXJuaW5nQ29sb3IoewogICAgICBjdXN0b21TbGlwcGFnZVZhbHVlOiBjdXN0b21TbGlwcGFnZVRvbGVyYW5jZSA/PyAwLAogICAgICBhdXRvU2xpcHBhZ2VUb2xlcmFuY2UsCiAgICAgIGZhbGxiYWNrQ29sb3JWYWx1ZTogaWNvbkNvbG9yLAogICAgfSkKICAgIGNvbnN0IFNldHRpbmdzSWNvbkNvbXBvbmVudCA9CiAgICAgIGN1c3RvbVNsaXBwYWdlVG9sZXJhbmNlICYmIGN1c3RvbVNsaXBwYWdlVG9sZXJhbmNlID4gU0xJUFBBR0VfQ1JJVElDQUxfVE9MRVJBTkNFID8gU2V0dGluZ3NXYXJuaW5nIDogU2V0dGluZ3MKCiAgICByZXR1cm4geyBiYWNrZ3JvdW5kQ29sb3I6IGljb25CYWNrZ3JvdW5kQ29sb3IsIGNvbnRlbnRDb2xvcjogZmlsbENvbG9yLCBJY29uQ29tcG9uZW50OiBTZXR0aW5nc0ljb25Db21wb25lbnQgfQogIH0sIFtjdXN0b21TbGlwcGFnZVRvbGVyYW5jZSwgaWNvbkNvbG9yLCBhdXRvU2xpcHBhZ2VUb2xlcmFuY2VdKQoKICByZXR1cm4gKAogICAgPFRyYW5zYWN0aW9uU2V0dGluZ3NCdXR0b25XaXRoVG9vbHRpcAogICAgICBpY29uU2l6ZT17aWNvblNpemV9CiAgICAgIGNvbnRlbnRDb2xvcj17Y29udGVudENvbG9yfQogICAgICBiYWNrZ3JvdW5kQ29sb3I9e2JhY2tncm91bmRDb2xvcn0KICAgICAgQ3VzdG9tSWNvbkNvbXBvbmVudD17SWNvbkNvbXBvbmVudH0KICAgICAgVG9vbHRpcD17CiAgICAgICAgc2hvdWxkU2hvd1NldHRpbmdzSWNvblRvb2x0aXAgJiYgPFRleHQgdmFyaWFudD0iYm9keTQiPnt0KCdzd2FwLnNldHRpbmdzLnNsaXBwYWdlLndhcm5pbmcuaG92ZXInKX08L1RleHQ+CiAgICAgIH0KICAgICAgSWNvbkxhYmVsPXsKICAgICAgICBzaG91bGRTaG93Q3VzdG9tU2xpcHBhZ2UgJiYgKAogICAgICAgICAgPFRleHQgY29sb3I9e2NvbnRlbnRDb2xvcn0gdmFyaWFudD0iYnV0dG9uTGFiZWwzIj4KICAgICAgICAgICAge2Zvcm1hdFBlcmNlbnQoY3VzdG9tU2xpcHBhZ2VUb2xlcmFuY2UpfQogICAgICAgICAgPC9UZXh0PgogICAgICAgICkKICAgICAgfQogICAgLz4KICApCn0KaW1wb3J0IHsgbWVtbywgdXNlRWZmZWN0LCB1c2VSZWYsIHVzZVN0YXRlIH0gZnJvbSAncmVhY3QnCmltcG9ydCB7IEZsZXgsIFRleHQsIFRvdWNoYWJsZUFyZWEgfSBmcm9tICd1aS9zcmMvJwppbXBvcnQgeyBUb2tlbkNhcmQgfSBmcm9tICd1bmlzd2FwL3NyYy9jb21wb25lbnRzL1Rva2VuU2VsZWN0b3IvaXRlbXMvdG9rZW5zL1Rva2VuQ2FyZCcKaW1wb3J0IHsgSG9yaXpvbnRhbFRva2VuTGlzdFByb3BzIH0gZnJvbSAndW5pc3dhcC9zcmMvY29tcG9uZW50cy9Ub2tlblNlbGVjdG9yL2xpc3RzL0hvcml6b250YWxUb2tlbkxpc3QvSG9yaXpvbnRhbFRva2VuTGlzdCcKCmNvbnN0IE1BWF9DQVJEU19QRVJfUk9XID0gNQoKZXhwb3J0IGNvbnN0IEhvcml0dG9tLTQgcmlnaHQtNCB6LTUwICoqOmRhdGEtcmFkaXgtcG9wcGVyLWNvbnRlbnQtd3JhcHBlcjpib3R0b20tNCEiPgogICAgICA8UG9wb3ZlciBvcGVuPXtpc09wZW59IG9uT3BlbkNoYW5nZT17c2V0SXNPcGVufT4KICAgICAgICA8UG9wb3ZlclRyaWdnZXIKICAgICAgICAgIGFzQ2hpbGQKICAgICAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lcygiZW5hYmxlZDpob3ZlcjpiZy1zdWJ0bGUgYmctc3VidGxlIHNoYWRvdy1ub25lIiwgIXNob3dUcmlnZ2VyICYmICJoaWRkZW4hIil9PgogICAgICAgICAgPEJ1dHRvbgogICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiBzZXRJc09wZW4odHJ1ZSl9CiAgICAgICAgICAgIGNsYXNzTmFtZT0iYmctc3VidGxlIHRleHQtZW1waGFzaXMgZmxleCBoLTEyIHctMTIgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHJvdW5kZWQtZnVsbCBib3JkZXItbm9uZSI+CiAgICAgICAgICAgIDxJY29uIG5hbWU9Im1lc3NhZ2UtY2lyY2xlIiBjbGFzc05hbWU9ImgtNiB3LTYiIC8+CiAgICAgICAgICA8L0J1dHRvbj4KICAgICAgICA8L1BvcG92ZXJUcmlnZ2VyPgoKICAgICAgICA8UG9wb3ZlckNvbnRlbnQKICAgICAgICAgIHJlZj17Y29udGVudFJlZn0KICAgICAgICAgIHN0eWxlPXt7IG1heFdpZHRoOiAiNDUwcHgiLCBtYXhIZWlnaHQ6ICI2NTBweCIgfX0KICAgICAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lcygKICAgICAgICAgICAgIiFiZy1jYWwtbXV0ZWQgbm8tc2Nyb2xsYmFyIG1iLTIgdy1zY3JlZW4gb3ZlcmZsb3ctaGlkZGVuIG92ZXJmbG93LXktc2Nyb2xsIHB4LTYgcHktNCBtZDp3LVs0NTBweF0iLAogICAgICAgICAgICBzaG93VHJpZ2dlciA/ICJtci04IiA6ICJtci0wIgogICAgICAgICAgKX0+CiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCB3LWZ1bGwganVzdGlmeS1iZXR3ZWVuIj4KICAgICAgICAgICAgPHAgY2xhc3NOYW1lPSJtYi01IHRleHQtbGcgZm9udC1zZW1pYm9sZCI+e3QoImNvbnRhY3Rfc3VwcG9ydCIpfTwvcD4KICAgICAgICAgICAgPEJ1dHRvbgogICAgICAgICAgICAgIGNvbG9yPSJtaW5pbWFsIgogICAgICAgICAgICAgIHZhcmlhbnQ9ImJ1dHRvbiIKICAgICAgICAgICAgICBTdGFydEljb249IngiCiAgICAgICAgICAgICAgc2l6ZT0ic20iCiAgICAgICAgICAgICAgb25DbGljaz17KCkgPT4gc2V0SXNPcGVuKGZhbHNlKX0KICAgICAgICAgICAgLz4KICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgIDxkaXY+CiAgICAgICAgICAgIHtpc1N1Ym1pdHRlZCA/ICgKICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0icHktNCB0ZXh0LWNlbnRlciI+CiAgICAgICAgICAgICAgICA8aDQgY2xhc3NOYW1lPSJtYi0yIHRleHQtbGcgZm9udC1tZWRpdW0gIj57dCgibWVzc2FnZV9zZW50Iil9PC9oND4KICAgICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT0idGV4dC1zdWJ0bGUgbWItNCB0ZXh0LXNtIj57dCgic3VwcG9ydF9tZXNzYWdlX3NlbnRfZGVzY3JpcHRpb24iKX08L3A+CiAgICAgICAgICAgICAgICA8QnV0dG9uIGNvbG9yPSJwcmltYXJ5IiBjbGFzc05hbWU9Im15LTIiIG9uQ2xpY2s9e3Jlc2V0Rm9ybX0gdmFyaWFudD0iYnV0dG9uIiBzaXplPSJiYXNlIj4KICAgICAgICAgICAgICAgICAge3QoInNlbmRfYW5vdGhlcl9tZXNzYWdlIil9CiAgICAgICAgICAgICAgICA8L0J1dHRvbj4KICAgICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgKSA6ICgKICAgICAgICAgICAgICA8Zm9ybSBvblN1Ym1pdD17b25TdWJtaXR9IGNsYXNzTmFtZT0iZmxleCBmbGV4LWNvbCBnYXAtNCI+CiAgICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgICA8TGFiZWwgaHRtbEZvcj0ibWVzc2FnZSI+e3QoImRlc2NyaWJlX3RoZV9pc3N1ZSIpfTwvTGFiZWw+CiAgICAgICAgICAgICAgICAgIDxUZXh0QXJlYQogICAgICAgICAgICAgICAgICAgIGlkPSJtZXNzYWdlIgpyZ2V0ICE9PSBudWxsICYmICFpc1N1cHBvcnRlZEZvcm1UYXJnZXQoZm9ybVRhcmdldCkpIHsKICAgIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViA9PT0gJ2RldmVsb3BtZW50JykgewogICAgICBjb25zb2xlLmVycm9yKAogICAgICAgIGA8Rm9ybT4ncyBcYHRhcmdldFxgIHdhcyBzZXQgdG8gYW4gdW5zdXBwb3J0ZWQgdmFsdWUgdmlhIFxgZm9ybVRhcmdldD0iJHtmb3JtVGFyZ2V0fSJcYC4gYCArCiAgICAgICAgICBgVGhpcyB3aWxsIGRpc2FibGUgPEZvcm0+J3MgbmF2aWdhdGlvbiBmdW5jdGlvbmFsaXR5LiBJZiB5b3UgbmVlZCB0aGlzLCB1c2UgYSBuYXRpdmUgPGZvcm0+IGVsZW1lbnQgaW5zdGVhZC5gCiAgICAgICkKICAgIH0KICAgIHJldHVybiB0cnVlCiAgfQoKICByZXR1cm4gZmFsc2UKfQoKZXhwb3J0IGZ1bmN0aW9uIGhhc1JlYWN0Q2xpZW50QWN0aW9uQXR0cmlidXRlcyhzdWJtaXR0ZXI6IEhUTUxFbGVtZW50KSB7CiAgLy8gQ1NSOiBodHRwczovL2dpdGh1Yi5jb20vZmFjZWJvb2svcmVhY3QvYmxvYi85NDJlYjgwMzgxYjk2Zjg0MTBlYWIxYmVmMWM1MzliZWQxYWIwZWIxL3BhY2thZ2VzL3JlYWN0LWRvbS1iaW5kaW5ncy9zcmMvY2xpZW50L1JlYWN0RE9NQ29tcG9uZW50LmpzI0w0ODItTDQ4NwogIC8vIFNTUjogaHR0cHM6Ly9naXRodWIuY29tL2ZhY2Vib29rL3JlYWN0L2Jsb2IvOTQyZWI4MDM4MWI5NmY4NDEwZWFiMWJlZjFjNTM5YmVkMWFiMGViMS9wYWNrYWdlcy9yZWFjdC1kb20tYmluZGluZ3Mvc3JjL2NsaWVudC9SZWFjdERPTUNvbXBvbmVudC5qcyNMMjQwMQogIGNvbnN0IGFjdGlvbiA9IHN1Ym1pdHRlci5nZXRBdHRyaWJ1dGUoJ2Zvcm1BY3Rpb24nKQogIHJldHVybiBhY3Rpb24gJiYgL1xzKmphdmFzY3JpcHQ6L2kudGVzdChhY3Rpb24pCn0KaW1wb3J0IHsgdXNlVHJhbnNsYXRpb24gfSBmcm9tICdyZWFjdC1pMThuZXh0JwppbXBvcnQgeyBGbGV4IH0gZnJvbSAndWkvc3JjJwppbXBvcnQgeyBTd2FwIH0gZnJvbSAndWkvc3JjL2NvbXBvbmVudHMvaWNvbnMvU3dhcCcKaW1wb3J0IHsgU3RlcFJvd1Byb3BzLCBTdGVwUm93U2tlbGV0b24gfSBmcm9tICd1bmlzd2FwL3NyYy9jb21wb25lbnRzL0NvbmZpcm1Td2FwTW9kYWwvc3RlcHMvU3RlcFJvd1NrZWxldG9uJwppbXBvcnQgeyBTdGVwU3RhdHVzIH0gZnJvbSAndW5pc3dhcC9zcmMvY29tcG9uZW50cy9Db25maXJtU3dhcE1vZGFsL3R5cGVzJwppbXBvcnQgeyB1c2VTZWNvbmRzVW50aWxEZWFkbGluZSB9IGZyb20gJ3VuaXN3YXAvc3JjL2NvbXBvbmVudHMvQ29uZmlybVN3YXBNb2RhbC91c2VTZWNvbmRzVW50aWxEZWFkbGluZScKaW1wb3J0IHsgdW5pc3dhcFVybHMgfSBmcm9tICd1bmlzd2FwL3NyYy9jb25zdGFudHMvdXJscycKaW1wb3J0IHsgVHJhbnNhY3Rpb25TdGVwVHlwZSB9IGZyb20gJ3VuaXN3YXAvc3JjL2ZlYXR1cmVzL3RyYW5zYWN0aW9ucy9zdGVwcy90eXBlcycKaW1wb3J0IHsKICBVbmlzd2FwWFBsYW5TaWduYXR1cmVTdGVwLAogIFVuaXN3YXBYU2lnbmF0dXJlU3RlcCwKfSBmcm9tICd1bmlzd2FwL3NyYy9mZWF0dXJlcy90cmFuc2FjdGlvbnMvc3dhcC9zdGVwcy9zaWduT3JkZXInCmltcG9ydCB7CiAgU3dhcFRyYW5zYWN0aW9uU3RlcCwKICBTd2FwVHJhbnNhY3Rpb25TdGVwQXN5bmMsCiAgU3dhcFRyYW5zYWN0aW9uU3RlcEJhdGNoZWQsCn0gZnJvbSAndW5pc3dhcC9zcmMvZmVhdHVyZXMvdHJhbnNhY3Rpb25zL3N3YXAvc3RlcHMvc3dhcCcKCmNvbnN0IFN3YXBJY29uID0gKCk6IEpTWC5FbGVtZW50ID0+ICgKICA8RmxleCBjZW50ZXJlZCB3aWR0aD0iJHNwYWNpbmcyNCIgaGVpZ2h0PSIkc3BhY2luZzI0IiBib3JkZXJSYWRpdXM9IiRyb3VuZGVkRnVsbCIgYmFja2dyb3VuZENvbG9yPSIkREVQX2JsdWU0MDAiPgogICAgPFN3YXAgY29sb3I9IiR3aGl0ZSIgc2l6ZT0iJGljb24uMTIiIC8+CiAgPC9GbGV4PgopCgp0eXBlIFN3YXBTdGVwcyA9CiAgfCBTd2FweyBQcmV2aWV3U3RhdGUgfSBmcm9tICIuLi90eXBlcyI7CmltcG9ydCB7IGVtYmVkTGliVXJsIH0gZnJvbSAiLi9jb25zdGFudHMiOwppbXBvcnQgeyBnZXRBcGlOYW1lRm9yUmVhY3RTbmlwcGV0LCBnZXRBcGlOYW1lRm9yVmFuaWxsYUpzU25pcHBldCB9IGZyb20gIi4vZ2V0QXBpTmFtZSI7CmltcG9ydCB7IGdldERpbWVuc2lvbiB9IGZyb20gIi4vZ2V0RGltZW5zaW9uIjsKCmV4cG9ydCBjb25zdCBkb1dlTmVlZENhbE9yaWdpblByb3AgPSAoZW1iZWRDYWxPcmlnaW46IHN0cmluZykgPT4gewogIC8vIElmIHdlIGFyZSBzZWxmIGhvc3RlZCwgY2FsT3JpZ2luIHdvbid0IGJlIGFwcC5jYWwuY29tIHNvIHdlIG5lZWQgdG8gcGFzcyBpdAogIC8vIElmIHdlIGFyZSBub3Qgc2VsZiBob3N0ZWQgYnV0IGl0J3Mgc3RpbGwgZGlmZmVyZW50IGZyb20gV0VCQVBQX1VSTCBhbmQgV0VCU0lURV9VUkwsIHdlIG5lZWQgdG8gcGFzcyBpdCAtPiBJdCBoYXBwZW5zIGZvciBvcmdhbml6YXRpb24gYm9va2luZyBVUkwgYXQgdGhlIG1vbWVudAogIHJldHVybiBJU19TRUxGX0hPU1RFRCB8fCAoZW1iZWRDYWxPcmlnaW4gIT09IFdFQkFQUF9VUkwgJiYgZW1iZWRDYWxPcmlnaW4gIT09IFdFQlNJVEVfVVJMKTsKfTsKCi8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55CmV4cG9ydCBjb25zdCBDb2RlcyA9IHsKICByZWFjdDogewogICAgaW5saW5lOiAoewogICAgICBjYWxMaW5rLAogICAgICB1aUluc3RydWN0aW9uQ29kZSwKICAgICAgcHJldmlld1N0YXRlLAogICAgICBlbWJlZENhbE9yaWdpbiwKICAgICAgbmFtZXNwYWNlLAogICAgfTogewogICAgICBjYWxMaW5rOiBzdHJpbmc7CiAgICAgIHVpSW5zdHJ1Y3Rpb25Db2RlOiBzdHJpbmc7CiAgICAgIHByZXZpZXdTdGF0ZTogUHJldmlld1N0YXRlWyJpbmxpbmUiXTsKICAgICAgZW1iZWRDYWxPcmlnaW46IHN0cmluZzsKICAgICAgbmFtZXNwYWNlOiBzdHJpbmc7CiAgICB9KSA9PiB7CiAgICAgIGNvbnN0IHdpZHRoID0gZ2V0RGltZW5zaW9uKHByZXZpZXdTdGF0ZS53aWR0aCk7CiAgICAgIGNvbnN0IGhlaWdodCA9IGdldERpbWVuc2lvbihwcmV2aWV3U3RhdGUuaGVpZ2h0KTsKICAgICAgY29uc3QgbmFtZXNwYWNlUHJvcCA9IGAke25hbWVzcGFjZSA/IGBuYW1lc3BhY2U9IiR7bmFtZXNwYWNlfSJgIDogIiJ9YDsKICAgICAgY29uc3QgYXJndW1lbnRGb3JHZXRDYWxBcGkgPSBnZXRBcmd1bWVudEZvckdldENhbEFwaShuYW1lc3BhY2UpOwogICAgICByZXR1cm4gY29kZWAKaW1wb3J0IENhbCwgeyBnZXRDYWxBcGkgfSBmcm9tICJAY2FsY29tL2VtYmVkLXJlYWN0IjsKaW1wb3J0IHsgdXNlRWZmZWN0IH0gZnJvbSAicmVhY3QiOwpleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBNeUFwcCgpIHsKICB1c2VFZmZlY3QoKCkgPT4gewogICAgKGFzeW5jIGZ1bmN0aW9uICgpIHsKICAgICAgY29uc3QgY2FsID0gYXdhaXQgZ2V0Q2FsQXBpKCR7YXJndW1lbnRGb3JHZXRDYWxBcGkgPyBKU09OLnN0cmluZ2lmeShhcmd1bWVudEZvckdldENhbEFwaSkgOiAiIn0pOwogICAgICAke3VpSW5zdHJ1Y3Rpb25Db2RlfQogICAgfSkoKTsKICB9LCBbXSkKICByZXR1cm4gPENhbCAke25hbWVzcGFjZVByb3B9CiAgICBjYWxMaW5rPSIke2NhbExpbmt9IgogICAgc3R5bGU9e3t3aWR0aDoiJHt3aWR0aH0iLGhlaWdodDoiJHtoZWlnaHR9IixvdmVyZmxvdzoic2Nyb2xsIn19CiAgICBjb25maWc9eyR7SlNPTi5zdHJpbmdpZnkocHJldmlld1N0YXRlLmNvbmZpZyl9fQogICAgJHtkb1dlTmVlZENhbE9yaWdpblByb3AoZW1iZWRDYWxPcmlnaW4pID8gYGNhbE9yaWdpbj0iJHtlbWJlZENhbE9yaWdpbn0iYCA6ICIifQogICAgJHtJU19TRUxGX0hPU1RFRCA/IGBlbWJlZEpzVXJsPSIke2VtYmVkTGliVXJsfSJgIDogIiJ9CiAgLz47Cn07YDsKICAgIH0sCiAgICAiZmxvYXRpbmctcG9wdXAiOiAoeyAgICAkZ3JvdXAtaG92ZXI9e3sgYmFja2dyb3VuZENvbG9yOiAnJHN1cmZhY2UxSG92ZXJlZCcgfX0KICAgICAgICAgICAgICBjb2xvcj0iJG5ldXRyYWwxIgogICAgICAgICAgICAgIGVkaXRhYmxlPXt0cnVlfQogICAgICAgICAgICAgIGZvbnRGYW1pbHk9IiRzdWJIZWFkaW5nIgogICAgICAgICAgICAgIGZvbnRXZWlnaHQ9Im5vcm1hbCIKICAgICAgICAgICAgICBmb250U2l6ZT0iJHNtYWxsIgogICAgICAgICAgICAgIGhlaWdodD0iMTAwJSIKICAgICAgICAgICAgICBrZXlib2FyZFR5cGU9Im51bWVyaWMiCiAgICAgICAgICAgICAgb3V0bGluZUNvbG9yPSIkdHJhbnNwYXJlbnQiCiAgICAgICAgICAgICAgcD0iJG5vbmUiCiAgICAgICAgICAgICAgdGV4dEFsaWduPSJyaWdodCIKICAgICAgICAgICAgICB2YWx1ZT17aW5wdXRWYWx1ZX0KICAgICAgICAgICAgICB3aWR0aD17aW5wdXRXaWR0aH0KICAgICAgICAgICAgICBvbkJsdXI9e29uQmx1ckRlYWRsaW5lSW5wdXR9CiAgICAgICAgICAgICAgb25DaGFuZ2VUZXh0PXtvbkNoYW5nZURlYWRsaW5lSW5wdXR9CiAgICAgICAgICAgICAgb25Gb2N1cz17b25Gb2N1c0RlYWRsaW5lSW5wdXR9CiAgICAgICAgICAgIC8+CiAgICAgICAgICAgIDxUZXh0CiAgICAgICAgICAgICAgbWluV2lkdGg9e0lOUFVUX01JTl9XSURUSH0KICAgICAgICAgICAgICBvcGFjaXR5PXswfQogICAgICAgICAgICAgIHB4PSIkc3BhY2luZzQiCiAgICAgICAgICAgICAgc3R5bGU9e3sgcG9zaXRpb246ICdhYnNvbHV0ZScgfX0KICAgICAgICAgICAgICB2YXJpYW50PSJzdWJoZWFkaW5nMiIKICAgICAgICAgICAgICB6SW5kZXg9ey0xfQogICAgICAgICAgICA+CiAgICAgICAgICAgICAge2lucHV0VmFsdWV9CiAgICAgICAgICAgIDwvVGV4dD4KICAgICAgICAgIDwvRmxleD4KICAgICAgICAgIDxUZXh0IGNvbG9yPSIkbmV1dHJhbDIiIHZhcmlhbnQ9InN1YmhlYWRpbmcyIj4KICAgICAgICAgICAgbWludXRlcwogICAgICAgICAgPC9UZXh0PgogICAgICAgIDwvRmxleD4KICAgICAgPC9GbGV4PgogICAgPC9GbGV4PgogICkKfQppbXBvcnQgewogIEJsb2NrUXVvdGUsCiAgQnVsbGV0TGlzdCwKICBDb2RlQmxvY2ssCiAgRG90SW1hZ2UsCiAgSGVhZGluZywKICBMaXN0SXRlbSwKICBPcmRlcmVkTGlzdCwKICBQYXJhZ3JhcGgsCiAgVGV4dE5vZGUsCn0gZnJvbSAiLi9ibG9ja3MiOwoKLyoKICBkb3RDTVMgQmxvY2sgRWRpdG9yIGlzIGEgbmV3IHJpY2ggY29udGVudCBlZGl0b3IgdGhhdCBhbGxvd3MgeW91IHRvIGNyZWF0ZSB5b3VyIGNvbnRlbnQgYXMgYnVpbGRpbmcgYmxvY2tzLgoKICBNb3JlIGluZm86IGh0dHBzOi8vZG90Y21zLmNvbS9kb2NzL2xhdGVzdC9ibG9jay1lZGl0b3IKKi8KCmV4cG9ydCBjb25zdCBDb250ZW50QmxvY2tzID0gKHsgY29udGVudCB9KSA9PiB7CiAgcmV0dXJuICgKICAgIDw+CiAgICAgIHtjb250ZW50Py5tYXAoKGRhdGEsIGluZGV4KSA9PiB7CiAgICAgICAgc3dpdGNoIChkYXRhLnR5cGUpIHsKICAgICAgICAgIGNhc2UgInBhcmFncmFwaCI6CiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgPFBhcmFncmFwaCBrZXk9e2luZGV4fT4KICAgICAgICAgICAgICAgIDxDb250ZW50QmxvY2tzIGNvbnRlbnQ9e2RhdGEuY29udGVudH0gLz4KICAgICAgICAgICAgICA8L1BhcmFncmFwaD4KICAgICAgICAgICAgKTsKICAgICAgICAgIGNhc2UgImhlYWRpbmciOgogICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgIDxIZWFkaW5nIGtleT17aW5kZXh9IGxldmVsPXtkYXRhLmF0dHJzLmxldmVsfT4KICAgICAgICAgICAgICAgIDxDb250ZW50QmxvY2tzIGNvbnRlbnQ9e2RhdGEuY29udGVudH0gLz4KICAgICAgICAgICAgICA8L0hlYWRpbmc+CiAgICAgICAgICAgICk7CgogICAgICAgICAgY2FzZSAiYnVsbGV0TGlzdCI6CiAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgPEJ1bGxjbG9zZU1vZGFsOiAoKSA9PiB2b2lkCiAgZGFwcEluZm8/OiBEYXBwSW5mbwogIHNldERhcHBJbmZvOiAoaW5mbz86IERhcHBJbmZvKSA9PiB2b2lkCn0KCmNvbnN0IFNtYXJ0V2FsbGV0TnVkZ2VzQ29udGV4dCA9IGNyZWF0ZUNvbnRleHQ8U21hcnRXYWxsZXROdWRnZXNDb250ZXh0U3RhdGUgfCB1bmRlZmluZWQ+KHVuZGVmaW5lZCkKCmV4cG9ydCBmdW5jdGlvbiBTbWFydFdhbGxldE51ZGdlc1Byb3ZpZGVyKHsgY2hpbGRyZW4gfTogeyBjaGlsZHJlbjogUmVhY3ROb2RlIH0pOiBKU1guRWxlbWVudCB7CiAgY29uc3QgZGlzcGF0Y2ggPSB1c2VEaXNwYXRjaCgpCgogIGNvbnN0IFthY3RpdmVNb2RhbCwgc2V0QWN0aXZlTW9kYWxdID0gdXNlU3RhdGU8TW9kYWxOYW1lVHlwZSB8IG51bGw+KG51bGwpCiAgY29uc3QgW2RhcHBJbmZvLCBzZXREYXBwSW5mb10gPSB1c2VTdGF0ZTx7CiAgICBpY29uPzogc3RyaW5nCiAgICBuYW1lPzogc3RyaW5nCiAgfT4oKQoKICBjb25zdCBvcGVuTW9kYWwgPSB1c2VDYWxsYmFjaygobW9kYWw6IE1vZGFsTmFtZVR5cGUpOiB2b2lkID0+IHsKICAgIHNldEFjdGl2ZU1vZGFsKG1vZGFsKQogIH0sIFtdKQoKICBjb25zdCBjbG9zZU1vZGFsID0gdXNlQ2FsbGJhY2soKCk6IHZvaWQgPT4gewogICAgc2V0QWN0aXZlTW9kYWwobnVsbCkKICB9LCBbXSkKCiAgY29uc3QgbGFzdDU3OTJEYXBwSW5mbyA9IHVzZUdldDU3OTJEYXBwSW5mbygpCiAgY29uc3QgZGVsZWdhdGlvblN0YXR1cyA9IHVzZVNtYXJ0V2FsbGV0RGVsZWdhdGlvblN0YXR1cyh7IG92ZXJyaWRlQWRkcmVzczogbGFzdDU3OTJEYXBwSW5mbz8uYWN0aXZlQ29ubmVjdGVkQWRkcmVzcyB9KQogIGNvbnN0IGhhc1Nob3duTnVkZ2UgPSB1c2VTZWxlY3Rvcigoc3RhdGU6IFdhbGxldFN0YXRlKSA9PgogICAgbGFzdDU3OTJEYXBwSW5mbwogICAgICA/IHNlbGVjdEhhc1Nob3duRWlwNTc5Mk51ZGdlKHN0YXRlLCBsYXN0NTc5MkRhcHBJbmZvLmFjdGl2ZUNvbm5lY3RlZEFkZHJlc3MsIGxhc3Q1NzkyRGFwcEluZm8udXJsKQogICAgICA6IGZhbHNlLAogICkKICAvLyBDaGVjayBpZiBob21lIHNjcmVlbiBudWRnZSB3YXMgcmVjZW50bHkgc2hvd24gKDI0IGhvdXIgY29vbGRvd24pCiAgY29uc3QgbGFzdEhvbWVTY3JlZW5TaG93biA9IHVzZVNlbGVjdG9yKChzdGF0ZTogV2FsbGV0U3RhdGUpID0+CiAgICBsYXN0NTc5MkRhcHBJbmZvCiAgICAgID8gc3RhdGUuYmVoYXZpb3JIaXN0b3J5LnNtYXJ0V2FsbGV0TnVkZ2U/LltsYXN0NTc5MkRhcHBJbmZvLmFjdGl2ZUNvbm5lY3RlZEFkZHJlc3NdPy5sYXN0SG9tZVNjcmVlbk51ZGdlU2hvd24KICAgICAgOiB1bmRlZmluZWQsCiAgKQoKICBjb25zdCBoYXNSZWNlbnRIb21lU2NyZWVuU2hvd24gPSBsYXN0SG9tZVNjcmVlblNob3duID8gRGF0ZS5ub3coKSAtIGxhc3RIb21lU2NyZWVuU2hvd24gPCBPTkVfREFZX01TIDogZmFsc2UKCiAgY29uc3Qgc2hvdWxkU2hvd051ZGdlID0KICAgICFoYXNTaG93bk51ZGdlICYmCiAgICAhaGFzUmVjZW50SG9tZVNjcmVlblNob3duICYmCiAgICBkZWxlZ2F0aW9uU3RhdHVzLnN0YXR1cyA9PT0gU21hcnRXYWxsZXREZWxlZ2F0aW9uQWN0aW9uLlByb21wdFVwZ3JhZGUgJiYKICAgICFkZWxlZ2F0aW9uU3RhdHVzLmxvYWRpbmcKCiAgLy8gYmlvbWUtaWdub3JlIGxpbnQvY29ycmVjdG5lc3MvdXNlRXhoYXVzdGl2ZURlcGVuZGVuY2llczogZGVsZWdhdGlvblN0YXR1cyBpcyB1c2VkIGluIHNob3VsZFNob3dOdWRnZSBjYWxjdWxhdGlvbiBhYm92ZQogIHVzZUVmZmVjdCgoKSA9PiB7CiAgICBpZiAobGFzdDU3OTJEYXBwSW5mbyAmJiBzaG91bGRTaG93TnVkZ2UpIHsKICAgICAgc2V0RGFwcEluZm8oewogICAgICAgIGljb246IGxhc3Q1NzkyRGFwcEluZm8uaWNvblVybCwKICAgICAgICBuYW1lOiBsYXN0NTc5MkRhcHBJbmZvLmRpc3BsYXlOYW1lIHx8IGV4dHJhY3RVcmxIb3N0KGxhc3QsCiAgRGlhbG9nRGVzY3JpcHRpb24sCiAgRGlhbG9nRm9vdGVyLAogIERpYWxvZ0hlYWRlciwKICBEaWFsb2dUaXRsZSwKICBEaWFsb2dUcmlnZ2VyLAp9IGZyb20gIkAvcmVnaXN0cnkvYmFzZXMvYmFzZS91aS9kaWFsb2ciCmltcG9ydCB7CiAgRmllbGQsCiAgRmllbGRDb250ZW50LAogIEZpZWxkRGVzY3JpcHRpb24sCiAgRmllbGRHcm91cCwKICBGaWVsZExhYmVsLAogIEZpZWxkU2VwYXJhdG9yLAogIEZpZWxkU2V0LAogIEZpZWxkVGl0bGUsCn0gZnJvbSAiQC9yZWdpc3RyeS9iYXNlcy9iYXNlL3VpL2ZpZWxkIgppbXBvcnQgeyBJbnB1dCB9IGZyb20gIkAvcmVnaXN0cnkvYmFzZXMvYmFzZS91aS9pbnB1dCIKaW1wb3J0IHsKICBJbnB1dEdyb3VwLAogIElucHV0R3JvdXBBZGRvbiwKICBJbnB1dEdyb3VwQnV0dG9uLAogIElucHV0R3JvdXBJbnB1dCwKfSBmcm9tICJAL3JlZ2lzdHJ5L2Jhc2VzL2Jhc2UvdWkvaW5wdXQtZ3JvdXAiCmltcG9ydCB7IEtiZCB9IGZyb20gIkAvcmVnaXN0cnkvYmFzZXMvYmFzZS91aS9rYmQiCmltcG9ydCB7CiAgTmF0aXZlU2VsZWN0LAogIE5hdGl2ZVNlbGVjdE9wdGlvbiwKfSBmcm9tICJAL3JlZ2lzdHJ5L2Jhc2VzL2Jhc2UvdWkvbmF0aXZlLXNlbGVjdCIKaW1wb3J0IHsKICBTZWxlY3QsCiAgU2VsZWN0Q29udGVudCwKICBTZWxlY3RHcm91cCwKICBTZWxlY3RJdGVtLAogIFNlbGVjdFNlcGFyYXRvciwKICBTZWxlY3RUcmlnZ2VyLAogIFNlbGVjdFZhbHVlLAp9IGZyb20gIkAvcmVnaXN0cnkvYmFzZXMvYmFzZS91aS9zZWxlY3QiCmltcG9ydCB7IFN3aXRjaCB9IGZyb20gIkAvcmVnaXN0cnkvYmFzZXMvYmFzZS91aS9zd2l0Y2giCmltcG9ydCB7CiAgVGFicywKICBUYWJzQ29udGVudCwKICBUYWJzTGlzdCwKICBUYWJzVHJpZ2dlciwKfSBmcm9tICJAL3JlZ2lzdHJ5L2Jhc2VzL2Jhc2UvdWkvdGFicyIKaW1wb3J0IHsgVGV4dGFyZWEgfSBmcm9tICJAL3JlZ2lzdHJ5L2Jhc2VzL2Jhc2UvdWkvdGV4dGFyZWEiCmltcG9ydCB7CiAgVG9vbHRpcCwKICBUb29sdGlwQ29udGVudCwKICBUb29sdGlwVHJpZ2dlciwKfSBmcm9tICJAL3JlZ2lzdHJ5L2Jhc2VzL2Jhc2UvdWkvdG9vbHRpcCIKaW1wb3J0IHsgSWNvblBsYWNlaG9sZGVyIH0gZnJvbSAiQC9hcHAvKGNyZWF0ZSkvY29tcG9uZW50cy9pY29uLXBsYWNlaG9sZGVyIgoKZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gRGlhbG9nRXhhbXBsZSgpIHsKICByZXR1cm4gKAogICAgPEV4YW1wbGVXcmFwcGVyPgogICAgICA8RGlhbG9nV2l0aEZvcm0gLz4KICAgICAgPERpYWxvZ1Njcm9sbGFibGVDb250ZW50IC8+CiAgICAgIDxEaWFsb2dXaXRoU3RpY2t5Rm9vdGVyIC8+CiAgICAgIDxEaWFsb2dOb0Nsb3NlQnV0dG9uIC8+CiAgICAgIDxEaWFsb2dDaGF0U2V0dGluZ3MgLz4KICAgIDwvRXhhbXBsZVdyYXBwZXI+CiAgKQp9CgpmdW5jdGlvbiBEaWFsb2dXaXRoRm9ybSgpIHsKICByZXR1cm4gKAogICAgPEV4YW1wbGUgdGl0bGU9IldpdGggRm9ybSIgY2xhc3NOYW1lPSJpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIiPgogICAgICA8RGlhbG9nPgogICAgICAgIDxmb3JtPgogICAgICAgICAgPERpYWxvZ1RyaWdnZXIgcmVuZGVyPXs8QnV0dG9uIHZhcmlhbnQ9Im91dGxpbmUiIC8+fT4KICAgICAgICAgICAgRWRpdCBQcm9maWxlCiAgICAgICAgICA8L0RpYWxvZ1RyaWdnZXI+CiAgICAgICAgICA8RGlhbG9nQ29udGVudD4KICAgICAgICAgICAgPERpYWxvZ0hlYWRlcj4KICAgICAgICAgICAgICA8RGlhbG9nVGl0bGU+RWRpdCBwcm9maWxlPC9EaWFsb2dUaXRsZT4KICAgICAgICAgICAgICA8RGlhbG9nRGVzY3JpcHRpb24+CiAgICAgICAgICAgICAgICBNYWtlIGNoYW5nZXMgdG8geW91ciBwcm9maWxlIGhlcmUuIENsaWNrIHNhdmUgd2hlbiB5b3UmYXBvcztyZQogICAgICAgICAgICAgICAgZG9uZS4gWW91ciBwcm9maWxlIHdpbGwgYmUgdXBkYXRlZCBpbW1lZGlhdGVseS4KICBvbHRpcFRyaWdnZXIsCn0gZnJvbSAiQC9yZWdpc3RyeS9iYXNlcy9yYWRpeC91aS90b29sdGlwIgppbXBvcnQgeyBJY29uUGxhY2Vob2xkZXIgfSBmcm9tICJAL2FwcC8oY3JlYXRlKS9jb21wb25lbnRzL2ljb24tcGxhY2Vob2xkZXIiCgpleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBJbnB1dEdyb3VwRXhhbXBsZSgpIHsKICBjb25zdCBbY291bnRyeSwgc2V0Q291bnRyeV0gPSB1c2VTdGF0ZSgiKzEiKQoKICByZXR1cm4gKAogICAgPEV4YW1wbGVXcmFwcGVyIGNsYXNzTmFtZT0ibWluLXctMCI+CiAgICAgIDxJbnB1dEdyb3VwQmFzaWMgLz4KICAgICAgPElucHV0R3JvdXBXaXRoQWRkb25zIC8+CiAgICAgIDxJbnB1dEdyb3VwV2l0aEJ1dHRvbnMgLz4KICAgICAgPElucHV0R3JvdXBXaXRoVG9vbHRpcCBjb3VudHJ5PXtjb3VudHJ5fSBzZXRDb3VudHJ5PXtzZXRDb3VudHJ5fSAvPgogICAgICA8SW5wdXRHcm91cFdpdGhLYmQgLz4KICAgICAgPElucHV0R3JvdXBJbkNhcmQgLz4KICAgICAgPElucHV0R3JvdXBUZXh0YXJlYUV4YW1wbGVzIC8+CiAgICA8L0V4YW1wbGVXcmFwcGVyPgogICkKfQoKZnVuY3Rpb24gSW5wdXRHcm91cEJhc2ljKCkgewogIHJldHVybiAoCiAgICA8RXhhbXBsZSB0aXRsZT0iQmFzaWMiPgogICAgICA8RmllbGRHcm91cD4KICAgICAgICA8RmllbGQ+CiAgICAgICAgICA8RmllbGRMYWJlbCBodG1sRm9yPSJpbnB1dC1kZWZhdWx0LTAxIj4KICAgICAgICAgICAgRGVmYXVsdCAoTm8gSW5wdXQgR3JvdXApCiAgICAgICAgICA8L0ZpZWxkTGFiZWw+CiAgICAgICAgICA8SW5wdXQgcGxhY2Vob2xkZXI9IlBsYWNlaG9sZGVyIiBpZD0iaW5wdXQtZGVmYXVsdC0wMSIgLz4KICAgICAgICA8L0ZpZWxkPgogICAgICAgIDxGaWVsZD4KICAgICAgICAgIDxGaWVsZExhYmVsIGh0bWxGb3I9ImlucHV0LWdyb3VwLTAyIj5JbnB1dCBHcm91cDwvRmllbGRMYWJlbD4KICAgICAgICAgIDxJbnB1dEdyb3VwPgogICAgICAgICAgICA8SW5wdXRHcm91cElucHV0IGlkPSJpbnB1dC1ncm91cC0wMiIgcGxhY2Vob2xkZXI9IlBsYWNlaG9sZGVyIiAvPgogICAgICAgICAgPC9JbnB1dEdyb3VwPgogICAgICAgIDwvRmllbGQ+CiAgICAgICAgPEZpZWxkIGRhdGEtZGlzYWJsZWQ9InRydWUiPgogICAgICAgICAgPEZpZWxkTGFiZWwgaHRtbEZvcj0iaW5wdXQtZGlzYWJsZWQtMDMiPkRpc2FibGVkPC9GaWVsZExhYmVsPgogICAgICAgICAgPElucHV0R3JvdXA+CiAgICAgICAgICAgIDxJbnB1dEdyb3VwSW5wdXQKICAgICAgICAgICAgICBpZD0iaW5wdXQtZGlzYWJsZWQtMDMiCiAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9IlRoaXMgZmllbGQgaXMgZGlzYWJsZWQiCiAgICAgICAgICAgICAgZGlzYWJsZWQKICAgICAgICAgICAgLz4KICAgICAgICAgIDwvSW5wdXRHcm91cD4KICAgICAgICA8L0ZpZWxkPgogICAgICAgIDxGaWVsZCBkYXRhLWludmFsaWQ9InRydWUiPgogICAgICAgICAgPEZpZWxkTGFiZWwgaHRtbEZvcj0iaW5wdXQtaW52YWxpZC0wNCI+SW52YWxpZDwvRmllbGRMYWJlbD4KICAgICAgICAgIDxJbnB1dEdyb3VwPgogICAgICAgICAgICA8SW5wdXRHcm91cElucHV0CiAgICAgICAgICAgICAgaWQ9ImlucHV0LWludmFsaWQtMDQiCiAgICAgICAgICAgICAgcGxhY2Vob2xkZXI9IlRoaXMgZmllbGQgaXMgaW52YWxpZCIKICAgICAgICAgICAgICBhcmlhLWludmFsaWQ9InRydWUiCiAgICAgICAgICAgIC8+CiAgICAgICAgICA8L0lucHV0R3JvdXA+CiAgICAgICAgPC9GaWVsZD4KICAgICAgPC9GaWVsZEdyb3VwPgogICAgPC9FeGFtcGxlPgogICkKfQoKZnVuY3Rpb24gSW5wdXRHcm91cFdpdGhBZGRvbnMoKSB7CiAgcmV0dXJuICgKICAgIDxFeGFtcGxlIHRpdGxlPSJXaXRoIEFkZG9ucyI+CiAgICAgIDxGaWVsZEdyb3VwPgogICAgICAgIDxGaWVsZD4KICAgICAgICAgIDxGaWVsZExhYmVsIGh0bWxGb3I9ImlucHV0LWljb24tbGVmdC0wNSI+CiBjaW5nNicsIGdhcDogJyRzcGFjaW5nNicgfX0KICAgICAgICAgICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcj0iJGFjY2VudDIiCiAgICAgICAgICAgICAgICAgICAgICBib3JkZXJCb3R0b21MZWZ0UmFkaXVzPSIkcm91bmRlZDEyIgogICAgICAgICAgICAgICAgICAgICAgYm9yZGVyQm90dG9tUmlnaHRSYWRpdXM9IiRyb3VuZGVkMTIiCiAgICAgICAgICAgICAgICAgICAgICB3aWR0aD0iMTAwJSIKICAgICAgICAgICAgICAgICAgICA+CiAgICAgICAgICAgICAgICAgICAgICA8SW5mb0NpcmNsZUZpbGxlZCBjb2xvcj0iJGFjY2VudDEiIHNpemU9IiRpY29uLjE2IiAvPgogICAgICAgICAgICAgICAgICAgICAgPFRleHQgdmFyaWFudD0iYm9keTMiIGNvbG9yPSIkYWNjZW50MSIgbXQ9IiRzcGFjaW5nMiIgJHNtPXt7IHZhcmlhbnQ6ICdib2R5NCcsIG10OiAnJHNwYWNpbmcxJyB9fT4KICAgICAgICAgICAgICAgICAgICAgICAge3QoJ3Bvb2wuaW5jZW50aXZlcy5zaW1pbGFyUG9vbEhhc1Jld2FyZHMnKX0KICAgICAgICAgICAgICAgICAgICAgIDwvVGV4dD4KICAgICAgICAgICAgICAgICAgICAgIDxUZXh0CiAgICAgICAgICAgICAgICAgICAgICAgIG10PSIkc3BhY2luZzIiCiAgICAgICAgICAgICAgICAgICAgICAgIHZhcmlhbnQ9ImJvZHkzIgogICAgICAgICAgICAgICAgICAgICAgICBjb2xvcj0iJG5ldXRyYWwxIgogICAgICAgICAgICAgICAgICAgICAgICAkc209e3sgdmFyaWFudDogJ2JvZHk0JywgbXQ6ICckc3BhY2luZzEnIH19CiAgICAgICAgICAgICAgICAgICAgICAgIHsuLi5DbGlja2FibGVUYW1hZ3VpU3R5bGV9CiAgICAgICAgICAgICAgICAgICAgICAgIG9uUHJlc3M9e3RvZ2dsZVNob3dNb3JlRmVlVGllcnNFbmFibGVkfQogICAgICAgICAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgICAgICAgICB7dCgncG9vbC5pbmNlbnRpdmVzLnN3aXRjaFBvb2xzJyl9CiAgICAgICAgICAgICAgICAgICAgICA8L1RleHQ+CiAgICAgICAgICAgICAgICAgICAgPC9GbGV4PgogICAgICAgICAgICAgICAgICApfQogICAgICAgICAgICAgICAgPC9GbGV4PgogICAgICAgICAgICAgICAgPEhlaWdodEFuaW1hdG9yIG9wZW49e2lzU2hvd01vcmVGZWVUaWVyc0VuYWJsZWR9PgogICAgICAgICAgICAgICAgICA8RmxleCBmbGV4RGlyZWN0aW9uPSJjb2x1bW4iIGRpc3BsYXk9ImZsZXgiIGdhcD0iJGdhcDEyIj4KICAgICAgICAgICAgICAgICAgICA8RmxleAogICAgICAgICAgICAgICAgICAgICAgJHBsYXRmb3JtLXdlYj17ewogICAgICAgICAgICAgICAgICAgICAgICBkaXNwbGF5OiAnZ3JpZCcsCiAgICAgICAgICAgICAgICAgICAgICB9fQogICAgICAgICAgICAgICAgICAgICAgZ3JpZFRlbXBsYXRlQ29sdW1ucz17ZmVlVGllckhhc0xwUmV3YXJkcyA/ICdyZXBlYXQoMiwgMWZyKScgOiAncmVwZWF0KDQsIDFmciknfQogICAgICAgICAgICAgICAgICAgICAgJG1kPXt7CiAgICAgICAgICAgICAgICAgICAgICAgIGdyaWRUZW1wbGF0ZUNvbHVtbnM6IGZlZVRpZXJIYXNMcFJld2FyZHMgPyAncmVwZWF0KDEsIDFmciknIDogJ3JlcGVhdCgyLCAxZnIpJywKICAgICAgICAgICAgICAgICAgICAgIH19CiAgICAgICAgICAgICAgICAgICAgICBnYXA9ezEwfQogICAgICAgICAgICAgICAgICAgID4KICAgICAgICAgICAgICAgICAgICAgIHtkZWZhdWx0RmVlVGllcnMubWFwKChmZWVUaWVyKSA9PiAoCiAgICAgICAgICAgICAgICAgICAgICAgIDxGZWVUaWVyCiAgICAgICAgICAgICAgICAgICAgICAgICAga2V5PXtnZXRGZWVUaWVyS2V5KHsKICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZlZVRpZXI6IGZlZVRpZXIudmFsdWUuZmVlQW1vdW50LAogICAgICAgICAgICAgICAgICAgICAgICAgICAgdGlja1NwYWNpbmc6IGZlZVRpZXIudmFsdWUudGlja1NwYWNpbmcsCiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpc0R5bmFtaWNGZWU6IGZpbWFscwogICkudG9TdHJpbmcoKTsKCiAgY29uc3QgaXNNYXhTZWxlY3RlZCA9IGFtb3VudCA9PT0gJy0xJzsKICBjb25zdCBhbW91bnRUb1JlZGVlbSA9IGlzTWF4U2VsZWN0ZWQgPyByZWRlZW1hYmxlQW1vdW50IDogYW1vdW50OwoKICBjb25zdCBoYW5kbGVDaGFuZ2UgPSAodmFsdWU6IHN0cmluZykgPT4gewogICAgY29uc3QgbWF4U2VsZWN0ZWQgPSB2YWx1ZSA9PT0gJy0xJzsKICAgIGNvbnN0IGFtb3VudCA9IG1heFNlbGVjdGVkID8gcmVkZWVtYWJsZUFtb3VudCA6IHZhbHVlOwogICAgYW1vdW50UmVmLmN1cnJlbnQgPSBhbW91bnQ7CiAgICBzZXRBbW91bnQoYW1vdW50KTsKICB9OwoKICBjb25zdCBhbW91bnRUb1JlZGVlbVVzZCA9IG5ldyBCaWdOdW1iZXIoYW1vdW50VG9SZWRlZW0gfHwgJzAnKQogICAgLm11bHRpcGxpZWRCeShzdGFrZURhdGEucHJpY2UpCiAgICAuc2hpZnRlZEJ5KC04KTsKCiAgLy8gY291bGQgYmUgZGlmZmVyZW50IGluIHRoZSBjYXNlIG9mIHdhVG9rZW5zLCBzaW5jZSB0aGUgZXhjaGFuZ2UgcmF0ZSB3aWxsIHRha2UgaW50byBhY2NvdW50CiAgLy8gdGhlIHlpZWxkIGdlbmVyYXRlZCBieSB0aGUgYVRva2VuCiAgY29uc3QgcmVkZWVtZWRBbW91bnRVc2QgPSBuZXcgQmlnTnVtYmVyKHJlZGVlbWVkQW1vdW50IHx8ICcwJykubXVsdGlwbGllZEJ5KAogICAgcG9vbFJlc2VydmUucHJpY2VJblVTRAogICk7CgogIC8vIGVycm9yIGhhbmRsZXIKICAvLyBsZXQgYmxvY2tpbmdFcnJvcjogRXJyb3JUeXBlIHwgdW5kZWZpbmVkID0gdW5kZWZpbmVkOwogIC8vIGlmICh2YWx1ZVRvQmlnTnVtYmVyKGFtb3VudFRvUmVkZWVtKS5ndChyZWRlZW1hYmxlQW1vdW50KSkgewogIC8vICAgYmxvY2tpbmdFcnJvciA9IEVycm9yVHlwZS5OT1RfRU5PVUdIX0JBTEFOQ0U7CiAgLy8gfQoKICAvLyBjb25zdCBoYW5kbGVCbG9ja2VkID0gKCkgPT4gewogIC8vICAgc3dpdGNoIChibG9ja2luZ0Vycm9yKSB7CiAgLy8gICAgIGNhc2UgRXJyb3JUeXBlLk5PVF9FTk9VR0hfQkFMQU5DRToKICAvLyAgICAgICByZXR1cm4gPFRyYW5zPk5vdCBlbm91Z2ggc3Rha2VkIGJhbGFuY2U8L1RyYW5zPjsKICAvLyAgICAgZGVmYXVsdDoKICAvLyAgICAgICByZXR1cm4gbnVsbDsKICAvLyAgIH0KICAvLyB9OwoKICBjb25zdCBzZXRSZWRlZW1BVG9rZW5zID0gKHZhbHVlOiBib29sZWFuKSA9PiB7CiAgICBzZXRSZWRlZW1UeXBlKHZhbHVlID8gUmVkZWVtVHlwZS5BVE9LRU4gOiBSZWRlZW1UeXBlLk5PUk1BTCk7CiAgfTsKCiAgY29uc3Qgc3ltYm9sRm9ybWF0dGVkID0gc3Rha2VEYXRhLnVuZGVybHlpbmdJc1N0YXRhVG9rZW4KICAgID8gc3Rha2VEYXRhLnN0YXRhVG9rZW5EYXRhLmFzc2V0U3ltYm9sCiAgICA6IHN0YWtlRGF0YS51bmRlcmx5aW5nVG9rZW5TeW1ib2w7CgogIGNvbnN0IGlzV3JvbmdOZXR3b3JrID0gY3VycmVudENoYWluSWQgIT09IGNvbm5lY3RlZENoYWluSWQ7CgogIGxldCBoZkFmdGVyUmVkZWVtID0gJy0xJzsKICBpZiAodXNlciAmJiBzdGFrZURhdGEudW5kZXJseWluZ0lzU3RhdGFUb2tlbiAmJiByZWRlZW1UeXBlID09PSBSZWRlZW1UeXBlLkFUT0tFTikgewogICAgY29uc3QgYW1vdW50SW5FdGggPSBuZXcgQmlnTnVtYmVyKGFtb3VudCkubXVsdGlwbGllZEJ5KAogICAgICBwb29sUmVzZXJ2ZS5mb3JtYXR0ZWRQcmljZUluTWFya2V0UmVmZXJlbmNlQ3VycmVuY3kKICAgICk7CgogICAgaGZBZnRlclJlZGVlbSA9IGNhbGN1bGF0ZUhGQWZ0ZXJTdXBwbHkodXNlciwgcG9vbFJlc2VydmUsIGFtb3VudEluRXRoKS50b1N0cmluZygpOwogIH0KCiAgaWYgKHR4RXJyb3IgJiYgdHhFcnJvci5ibG9ja2luZykgewogICAgcmV0dXJuIDxUeEVycm9yVmlldyB0eEVycm9yPXt0eEVycm9yfSAvPjsKICB9CgogIGlmICh0eFN0YXRlLnN1Y2Nlc3MpCiAgICByZXR1cm4gKAogICAgICA8VHhTdWNjZXNzVmlldwogICAgICAgIGFjdGlvbj17PFRyYW5zPlVuYWRpeC9saWIvdXRpbHMiCmltcG9ydCB7IExhYmVsIH0gZnJvbSAiQC9leGFtcGxlcy9yYWRpeC91aS1ydGwvbGFiZWwiCmltcG9ydCB7IFNlcGFyYXRvciB9IGZyb20gIkAvZXhhbXBsZXMvcmFkaXgvdWktcnRsL3NlcGFyYXRvciIKaW1wb3J0IHsgY3ZhLCB0eXBlIFZhcmlhbnRQcm9wcyB9IGZyb20gImNsYXNzLXZhcmlhbmNlLWF1dGhvcml0eSIKCmZ1bmN0aW9uIEZpZWxkU2V0KHsgY2xhc3NOYW1lLCAuLi5wcm9wcyB9OiBSZWFjdC5Db21wb25lbnRQcm9wczwiZmllbGRzZXQiPikgewogIHJldHVybiAoCiAgICA8ZmllbGRzZXQKICAgICAgZGF0YS1zbG90PSJmaWVsZC1zZXQiCiAgICAgIGNsYXNzTmFtZT17Y24oCiAgICAgICAgImZsZXggZmxleC1jb2wgZ2FwLTQgaGFzLVs+W2RhdGEtc2xvdD1jaGVja2JveC1ncm91cF1dOmdhcC0zIGhhcy1bPltkYXRhLXNsb3Q9cmFkaW8tZ3JvdXBdXTpnYXAtMyIsCiAgICAgICAgY2xhc3NOYW1lCiAgICAgICl9CiAgICAgIHsuLi5wcm9wc30KICAgIC8+CiAgKQp9CgpmdW5jdGlvbiBGaWVsZExlZ2VuZCh7CiAgY2xhc3NOYW1lLAogIHZhcmlhbnQgPSAibGVnZW5kIiwKICAuLi5wcm9wcwp9OiBSZWFjdC5Db21wb25lbnRQcm9wczwibGVnZW5kIj4gJiB7IHZhcmlhbnQ/OiAibGVnZW5kIiB8ICJsYWJlbCIgfSkgewogIHJldHVybiAoCiAgICA8bGVnZW5kCiAgICAgIGRhdGEtc2xvdD0iZmllbGQtbGVnZW5kIgogICAgICBkYXRhLXZhcmlhbnQ9e3ZhcmlhbnR9CiAgICAgIGNsYXNzTmFtZT17Y24oCiAgICAgICAgIm1iLTEuNSBmb250LW1lZGl1bSBkYXRhLVt2YXJpYW50PWxhYmVsXTp0ZXh0LXNtIGRhdGEtW3ZhcmlhbnQ9bGVnZW5kXTp0ZXh0LWJhc2UiLAogICAgICAgIGNsYXNzTmFtZQogICAgICApfQogICAgICB7Li4ucHJvcHN9CiAgICAvPgogICkKfQoKZnVuY3Rpb24gRmllbGRHcm91cCh7IGNsYXNzTmFtZSwgLi4ucHJvcHMgfTogUmVhY3QuQ29tcG9uZW50UHJvcHM8ImRpdiI+KSB7CiAgcmV0dXJuICgKICAgIDxkaXYKICAgICAgZGF0YS1zbG90PSJmaWVsZC1ncm91cCIKICAgICAgY2xhc3NOYW1lPXtjbigKICAgICAgICAiZ3JvdXAvZmllbGQtZ3JvdXAgQGNvbnRhaW5lci9maWVsZC1ncm91cCBmbGV4IHctZnVsbCBmbGV4LWNvbCBnYXAtNSBkYXRhLVtzbG90PWNoZWNrYm94LWdyb3VwXTpnYXAtMyBbJj5bZGF0YS1zbG90PWZpZWxkLWdyb3VwXV06Z2FwLTQiLAogICAgICAgIGNsYXNzTmFtZQogICAgICApfQogICAgICB7Li4ucHJvcHN9CiAgICAvPgogICkKfQoKY29uc3QgZmllbGRWYXJpYW50cyA9IGN2YSgKICAiZGF0YS1baW52YWxpZD10cnVlXTp0ZXh0LWRlc3RydWN0aXZlIGdhcC0yIGdyb3VwL2ZpZWxkIGZsZXggdy1mdWxsIiwKICB7CiAgICB2YXJpYW50czogewogICAgICBvcmllbnRhdGlvbjogewogICAgICAgIHZlcnRpY2FsOiAiZmxleC1jb2wgWyY+Kl06dy1mdWxsIFsmPi5zci1vbmx5XTp3LWF1dG8iLAogICAgICAgIGhvcml6b250YWw6CiAgICAgICAgICAiZmxleC1yb3cgaXRlbXMtY2VudGVyIFsmPltkYXRhLXNsb3Q9ZmllbGQtbGFiZWxdXTpmbGV4LWF1dG8gaGFzLVs+W2RhdGEtc2xvdD1maWVsZC1jb250ZW50XV06aXRlbXMtc3RhcnQgaGFzLVs+W2RhdGEtc2xvdD1maWVsZC1jb250ZW50XV06WyY+W3JvbGU9Y2hlY2tib3hdLFtyb2xlPXJhZGlvXV06bXQtcHgiLAogICAgICAgIHJlc3BvbnNpdmU6CiAgICAgICAgICAiZmxleC1jb2wgWyY+Kl06dy1mdWxsIFsmPi5zci1vbmx5XTp3LWF1dG8gQG1kL2ZpZWxkLWdyb3VwOmZsZXgtcm93IEBtZC9maWVsZC1ncm91cDppdGVtcy1jZW50ZXIgQG1kL2ZpZWxkLWdyb3VwOlsmPipdOnctYXV0byBAbWQvZmllbGQtZ3JvdXA6WyY+W2RhdGEtc2xvdD1maWVsZC1sYWJlbF1dOmZsZXgtYXV0byBAbWQvZmllbGQtZ3JvdXA6aGFzLVs+W2RhdGEtc2xvdD1maWVsZC1jb250ZW50XV06aXRlbXMtc3RhcnQgQG1kL3V0ZSgneScsIDI1KTsKICAgICAgICBpbm5lci5zZXRBdHRyaWJ1dGUoJ2hlaWdodCcsIDIwNik7CiAgICAgICAgaWYgKCF2YikgewogICAgICAgICAgaW5uZXIuc2V0QXR0cmlidXRlKCd2aWV3Qm94JywgYDAgMCAke29sZFdpZHRofSAke29sZEhlaWdodH1gKTsKICAgICAgICB9CgogICAgICAgIHRva2VuUmVmLmN1cnJlbnQ/LmFwcGVuZENoaWxkKGlubmVyKTsKICAgICAgICBjb25zdCBzID0gbmV3IFhNTFNlcmlhbGl6ZXIoKS5zZXJpYWxpemVUb1N0cmluZyh0b2tlblJlZi5jdXJyZW50IGFzIHVua25vd24gYXMgTm9kZSk7CgogICAgICAgIG9uSW1hZ2VHZW5lcmF0ZWQoCiAgICAgICAgICBgZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCwke3dpbmRvdy5idG9hKHVuZXNjYXBlKGVuY29kZVVSSUNvbXBvbmVudChzKSkpfWAKICAgICAgICApOwogICAgICB9IGVsc2UgewogICAgICAgIGNvbnN0IHMgPSBuZXcgWE1MU2VyaWFsaXplcigpLnNlcmlhbGl6ZVRvU3RyaW5nKHJlZi5jdXJyZW50Py5jb250ZW50RG9jdW1lbnQpOwogICAgICAgIG9uSW1hZ2VHZW5lcmF0ZWQoCiAgICAgICAgICBgZGF0YTppbWFnZS9zdmcreG1sO2Jhc2U2NCwke3dpbmRvdy5idG9hKHVuZXNjYXBlKGVuY29kZVVSSUNvbXBvbmVudChzKSkpfWAKICAgICAgICApOwogICAgICB9CiAgICB9CiAgfSwgW2xvYWRpbmcsIGFUb2tlbiwgd2FUb2tlbl0pOwogIHJldHVybiAoCiAgICA8ZGl2CiAgICAgIHN0eWxlPXt7CiAgICAgICAgdmlzaWJpbGl0eTogJ2hpZGRlbicsCiAgICAgICAgaGVpZ2h0OiAwLAogICAgICAgIHdpZHRoOiAwLAogICAgICAgIG92ZXJmbG93OiAnaGlkZGVuJywKICAgICAgfX0KICAgID4KICAgICAgPG9iamVjdAogICAgICAgIHN0eWxlPXt7IG9wYWNpdHk6IDEgfX0KICAgICAgICByZWY9e3JlZn0KICAgICAgICBpZD0ic3ZnIgogICAgICAgIGRhdGE9e2AvaWNvbnMvdG9rZW5zLyR7c3ltYm9sLnRvTG93ZXJDYXNlKCl9LnN2Z2B9CiAgICAgICAgb25Mb2FkPXsoKSA9PiBzZXRMb2FkaW5nKGZhbHNlKX0KICAgICAgLz4KICAgICAgeyhhVG9rZW4gfHwgd2FUb2tlbikgJiYgPFRva2VuUmluZyByZWY9e3Rva2VuUmVmfSB3YVRva2VuPXt3YVRva2VufSAvPn0KICAgIDwvZGl2PgogICk7Cn0KCi8vIFJlbmFtZWQgZnJvbSBBVG9rZW5JY29uIHRvIFRva2VuUmluZyB0byBiZXR0ZXIgcmVmbGVjdCBpdHMgcHVycG9zZQpleHBvcnQgY29uc3QgVG9rZW5SaW5nID0gZm9yd2FyZFJlZjxTVkdTVkdFbGVtZW50LCBBVG9rZW5JY29uUHJvcHM+KCh7IHN5bWJvbCwgd2FUb2tlbiB9LCByZWYpID0+IHsKICByZXR1cm4gKAogICAgPHN2ZwogICAgICBzdHlsZT17ewogICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLAogICAgICAgIHRvcDogMCwKICAgICAgICBsZWZ0OiAwLAogICAgICAgIHdpZHRoOiAnMTAwJScsCiAgICAgICAgaGVpZ2h0OiAnMTAwJScsCiAgICAgIH19CiAgICAgIHJlZj17cmVmfQogICAgICBpZD0iR3JvdXBfMzA5NTIiCiAgICAgIHdpZHRoPSIyNTYiCiAgICAgIGhlaWdodD0iMjU2IgogICAgICB2aWV3Qm94PSIwIDAgMjU2IDI1NiIKICAgID4KICAgICAgPGRlZnMgaWQ9ImRlZnMxMCI+CiAgICAgICAgPGxpbmVhckdyYWRpZW50CiAgICAgICAgICBpZD0ibGluZWFyLWdyYWRpZW50IgogICAgICAgICAgeDE9Ii44NDMiCiAgICAgICAgICB4Mj0iLjIwNiIKICAgICAgICAgIHkxPSIuMTM1IgogICAgICAgICAgeTI9Ii44ODYiCiAgICAgICAgICBncmFkaWVudFVuaXRzPSJvYmplY3RCb3VuZGluZ0JveCIKICAgICAgICA+CiAgICAgICAgICA8c3RvcCBvZmZzZXQ9IjAiIHN0b3BDb2xvcj0iI2I2NTA5ZSIgaWQ9InN0b3AyIiAvPgogICAgICAgICAgPHN0b3Agb2Zmc2V0PSIxIiBzdG9wQ29sb3I9IiMyZWJhYzYiIGlkPSJzdG9wNCIgLz4KICAgICAgICA8L2xpbmVhckdyYWRpZW50PgogICAgICA8L2RlZnM+CiAgICAgIDxnIGlkPSJHcm91cF8yOTEwOSI+Ck9mKCkgPiBnZXREYXRlKGQxKS52YWx1ZU9mKCkgLSB4MC52YWx1ZU9mKCkgPyBkMSA6IGQwOwogICAgICAgIH0KICAgICAgICBzaG93VG9vbHRpcCh7CiAgICAgICAgICB0b29sdGlwRGF0YTogZCwKICAgICAgICAgIHRvb2x0aXBMZWZ0OiB4LAogICAgICAgIH0pOwogICAgICB9LAogICAgICBbc2hvd1Rvb2x0aXAsIGRhdGVTY2FsZSwgZGF0YSwgbWFyZ2luXQogICAgKTsKCiAgICAvLyBDYWxjdWxhdGUgYXZlcmFnZSBsaW5lIGlmIGVuYWJsZWQKICAgIGNvbnN0IGF2ZXJhZ2VMaW5lID0gdXNlTWVtbygoKSA9PiB7CiAgICAgIGlmICghc2hvd0F2ZXJhZ2UgfHwgZGF0YS5sZW5ndGggPT09IDApIHJldHVybiBudWxsOwoKICAgICAgY29uc3QgYXZnID0gZGF0YS5yZWR1Y2UoKGFjYywgY3VyKSA9PiBhY2MgKyBjdXIubWVyaXRfYXB5LCAwKSAvIGRhdGEubGVuZ3RoOwogICAgICBpZiAoYXZnIDw9IDApIHJldHVybiBudWxsOwoKICAgICAgY29uc3QgYXZnRm9ybWF0dGVkID0gKGF2ZyAqIDEwMCkudG9GaXhlZCgyKTsKICAgICAgY29uc3QgYXZnQXJyYXkgPSBkYXRhLm1hcCgoZCkgPT4gKHsKICAgICAgICAuLi5kLAogICAgICAgIG1lcml0X2FweTogYXZnLAogICAgICB9KSk7CgogICAgICBjb25zdCBhbm5vdGF0aW9uWCA9IChkYXRlU2NhbGUoZ2V0RGF0ZShhdmdBcnJheVswXSkpID8/IDApICsgNzA7CiAgICAgIGNvbnN0IGFubm90YXRpb25ZID0gKHlWYWx1ZVNjYWxlKGF2ZyAqIDEwMCkgPz8gMCkgLSA4OwoKICAgICAgcmV0dXJuIHsKICAgICAgICBhdmdBcnJheSwKICAgICAgICBhdmdGb3JtYXR0ZWQsCiAgICAgICAgYW5ub3RhdGlvblgsCiAgICAgICAgYW5ub3RhdGlvblksCiAgICAgIH07CiAgICB9LCBbZGF0YSwgc2hvd0F2ZXJhZ2UsIGRhdGVTY2FsZSwgeVZhbHVlU2NhbGVdKTsKCiAgICByZXR1cm4gKAogICAgICA8PgogICAgICAgIDxzdmcgd2lkdGg9e3dpZHRofSBoZWlnaHQ9e2hlaWdodH0+CiAgICAgICAgICA8R3JvdXAgbGVmdD17bWFyZ2luLmxlZnR9IHRvcD17bWFyZ2luLnRvcH0+CiAgICAgICAgICAgIHsvKiBIb3Jpem9udGFsIEJhY2tncm91bmQgTGluZXMgKi99CiAgICAgICAgICAgIDxHcmlkUm93cwogICAgICAgICAgICAgIHNjYWxlPXt5VmFsdWVTY2FsZX0KICAgICAgICAgICAgICB3aWR0aD17aW5uZXJXaWR0aH0KICAgICAgICAgICAgICBzdHJva2VEYXNoYXJyYXk9IjMsMyIKICAgICAgICAgICAgICBzdHJva2U9e3RoZW1lLnBhbGV0dGUuZGl2aWRlcn0KICAgICAgICAgICAgICBwb2ludGVyRXZlbnRzPSJub25lIgogICAgICAgICAgICAgIG51bVRpY2tzPXszfQogICAgICAgICAgICAvPgoKICAgICAgICAgICAgey8qIE1lcml0IEFQWSBMaW5lICovfQogICAgICAgICAgICA8TGluZVBhdGgKICAgICAgICAgICAgICBrZXk9Im1lcml0LWFweSIKcmRlckxpZ2h0OiBpc0RhcmsgPyAiIzJDMkMyRSIgOiAiI0YzRjRGNiIsCiAgICAgIHBpbGw6IGlzRGFyayA/ICIjNEQ0RDREIiA6ICIjRThFOEVEIiwKICAgICAgcGlsbFRyYW5zcGFyZW50OiBpc0RhcmsgPyAicmdiYSg1NiwgNTYsIDU4LCAwLjUpIiA6ICJyZ2JhKDIzMiwgMjMyLCAyMzcsIDAuNSkiLAogICAgICBpbnB1dEJvcmRlcjogaXNEYXJrID8gInJnYmEoNTYsIDU2LCA1OCwgMC40KSIgOiAicmdiYSgyMDksIDIxMywgMjE5LCAwLjQpIiwKICAgICAgaW5wdXRCYWNrZ3JvdW5kOiBpc0RhcmsgPyAicmdiYSgyOCwgMjgsIDMwLCAwLjYpIiA6ICJyZ2JhKDI1NSwgMjU1LCAyNTUsIDAuNikiLAogICAgICBzZWxlY3RlZEJnOiBpc0RhcmsgPyAiIzFDM0E1RiIgOiAiI0U4RjRGRCIsCiAgICAgIGFjY2VudDogIiMwMDdBRkYiLAogICAgfTsKCiAgICBjb25zdCBbc2VsZWN0ZWREYXRlVGltZSwgc2V0U2VsZWN0ZWREYXRlVGltZV0gPSB1c2VTdGF0ZTxEYXRlPihuZXcgRGF0ZSgpKTsKICAgIGNvbnN0IFtzaG93RGF0ZVBpY2tlciwgc2V0U2hvd0RhdGVQaWNrZXJdID0gdXNlU3RhdGUoZmFsc2UpOwogICAgY29uc3QgW3Nob3dUaW1lUGlja2VyLCBzZXRTaG93VGltZVBpY2tlcl0gPSB1c2VTdGF0ZShmYWxzZSk7CiAgICBjb25zdCBbcmVhc29uLCBzZXRSZWFzb25dID0gdXNlU3RhdGUoIiIpOwoKICAgIC8vIFVzZSBSZWFjdCBRdWVyeSBtdXRhdGlvbiBmb3IgYXV0b21hdGljIGNhY2hlIGludmFsaWRhdGlvbgogICAgY29uc3QgeyBtdXRhdGU6IHJlc2NoZWR1bGVCb29raW5nLCBpc1BlbmRpbmc6IGlzU2F2aW5nIH0gPSB1c2VSZXNjaGVkdWxlQm9va2luZygpOwoKICAgIC8vIFByZS1maWxsIHdpdGggY3VycmVudCBib29raW5nIGRhdGUvdGltZQogICAgdXNlRWZmZWN0KCgpID0+IHsKICAgICAgaWYgKGJvb2tpbmc/LnN0YXJ0VGltZSkgewogICAgICAgIGNvbnN0IGJvb2tpbmdEYXRlID0gbmV3IERhdGUoYm9va2luZy5zdGFydFRpbWUpOwogICAgICAgIGlmICghTnVtYmVyLmlzTmFOKGJvb2tpbmdEYXRlLmdldFRpbWUoKSkpIHsKICAgICAgICAgIHNldFNlbGVjdGVkRGF0ZVRpbWUoYm9va2luZ0RhdGUpOwogICAgICAgICAgc2V0UmVhc29uKCIiKTsKICAgICAgICB9CiAgICAgIH0KICAgIH0sIFtib29raW5nPy5zdGFydFRpbWVdKTsKCiAgICAvLyBOb3RpZnkgcGFyZW50IG9mIHNhdmluZyBzdGF0ZSBjaGFuZ2VzCiAgICB1c2VFZmZlY3QoKCkgPT4gewogICAgICBvblNhdmluZ0NoYW5nZT8uKGlzU2F2aW5nKTsKICAgIH0sIFtpc1NhdmluZywgb25TYXZpbmdDaGFuZ2VdKTsKCiAgICBjb25zdCBoYW5kbGVTdWJtaXQgPSB1c2VDYWxsYmFjaygoKSA9PiB7CiAgICAgIGlmICghYm9va2luZyB8fCBpc1NhdmluZykgcmV0dXJuOwoKICAgICAgLy8gVmFsaWRhdGUgdGhlIGRhdGUgaXMgaW4gdGhlIGZ1dHVyZQogICAgICBpZiAoc2VsZWN0ZWREYXRlVGltZSA8PSBuZXcgRGF0ZSgpKSB7CiAgICAgICAgc2hvd0Vycm9yQWxlcnQoIkVycm9yIiwgIlBsZWFzZSBzZWxlY3QgYSBmdXR1cmUgZGF0ZSBhbmQgdGltZSIpOwogICAgICAgIHJldHVybjsKICAgICAgfQoKICAgICAgLy8gRXh0cmFjdCBjb25kaXRpb25hbCB2YWx1ZXMgZm9yIFJlYWN0IENvbXBpbGVyIG9wdGltaXphdGlvbgogICAgICBjb25zdCB0cmltbWVkUmVhc29uID0gcmVhc29uLnRyaW0oKTsKICAgICAgY29uc3QgcmVzY2hlZHVsaW5nUmVhc29uID0gdHJpbW1lZFJlYXNvbi5sZW5ndGggPiAwID8gdHJpbW1lZFJlYXNvbiA6IHVuZGVmaW5lZDsKICAgICAgY29uc3Qgc3RhcnRUaW1lID0gc2VsZWN0ZWREYXRlVGltZS50b0lTT1N0cmluZygpOwoKICAgICAgcmVzY2hlZHVsZUJvb2tpbmcoCiAgICAgICAgewogICAgICAgICAgdWlkOiBib29raW5nLnVpZCwKIG50cy9za2VsZXRvbiI7DQoNCnR5cGUgQWRkb25Qcm9wcyA9IHsNCiAgY2hpbGRyZW46IFJlYWN0LlJlYWN0Tm9kZTsNCiAgY2xhc3NOYW1lPzogc3RyaW5nOw0KICBlcnJvcj86IGJvb2xlYW47DQogIG9uQ2xpY2tBZGRvbj86ICgpID0+IHZvaWQ7DQp9Ow0KDQpjb25zdCBBZGRvbiA9ICh7IGNoaWxkcmVuLCBjbGFzc05hbWUsIGVycm9yIH06IEFkZG9uUHJvcHMpID0+ICgNCiAgPGRpdg0KICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lcygNCiAgICAgICJhZGRvbi13cmFwcGVyIGJvcmRlci1kZWZhdWx0IFtpbnB1dDpob3Zlcl8rXyZdOmJvcmRlci1lbXBoYXNpcyBbaW5wdXQ6aG92ZXJfK18mXTpib3JkZXItbC1kZWZhdWx0IFsmOmhhcygrX2lucHV0OmhvdmVyKV06Ym9yZGVyLWVtcGhhc2lzIFsmOmhhcygrX2lucHV0OmhvdmVyKV06Ym9yZGVyLXItZGVmYXVsdCBoLTkgYm9yZGVyIHB4LTMgdHJhbnNpdGlvbiBkaXNhYmxlZDpob3ZlcjpjdXJzb3Itbm90LWFsbG93ZWQiLA0KICAgICAgY2xhc3NOYW1lDQogICAgKX0+DQogICAgPGRpdg0KICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzKA0KICAgICAgICAibWluLWgtOSBmbGV4IGZsZXgtY29sIGp1c3RpZnktY2VudGVyIHRleHQtc20gbGVhZGluZy03IiwNCiAgICAgICAgZXJyb3IgPyAidGV4dC1lcnJvciIgOiAidGV4dC1kZWZhdWx0Ig0KICAgICAgKX0+DQogICAgICA8c3Bhbg0KICAgICAgICBjbGFzc05hbWU9ImZsZXggbWF4LXctMnhsIG92ZXJmbG93LXktYXV0byB3aGl0ZXNwYWNlLW5vd3JhcCINCiAgICAgICAgc3R5bGU9e3sNCiAgICAgICAgICBXZWJraXRPdmVyZmxvd1Njcm9sbGluZzogInRvdWNoIiwNCiAgICAgICAgICBzY3JvbGxiYXJXaWR0aDogIm5vbmUiLA0KICAgICAgICAgIG92ZXJmbG93OiAiLW1zLXNjcm9sbC1jaGFpbmluZyIsDQogICAgICAgICAgbXNPdmVyZmxvd1N0eWxlOiAiLW1zLWF1dG9oaWRpbmctc2Nyb2xsYmFyIiwNCiAgICAgICAgfX0+DQogICAgICAgIHtjaGlsZHJlbn0NCiAgICAgIDwvc3Bhbj4NCiAgICA8L2Rpdj4NCiAgPC9kaXY+DQopOw0KDQpleHBvcnQgY29uc3QgS2V5RmllbGQ6IFJlYWN0LkZDPElucHV0RmllbGRQcm9wcyAmIHsgZGVmYXVsdFZhbHVlOiBzdHJpbmcgfT4gPSBmb3J3YXJkUmVmPA0KICBIVE1MSW5wdXRFbGVtZW50LA0KICBJbnB1dEZpZWxkUHJvcHMgJiB7IGRlZmF1bHRWYWx1ZTogc3RyaW5nIH0NCj4oZnVuY3Rpb24gS2V5RmllbGQocHJvcHMsIHJlZikgew0KICBjb25zdCBpZCA9IHVzZUlkKCk7DQogIGNvbnN0IFtpc1Bhc3N3b3JkVmlzaWJsZSwgc2V0SXNQYXNzd29yZFZpc2libGVdID0gdXNlU3RhdGUoZmFsc2UpOw0KICBjb25zdCBbY3VycmVudFZhbHVlLCBzZXRDdXJyZW50VmFsdWVdID0gdXNlU3RhdGU8c3RyaW5nPigiIik7DQogIGNvbnN0IHRvZ2dsZUlzUGFzc3dvcmRWaXNpYmxlID0gdXNlQ2FsbGJhY2soDQogICAgKCkgPT4gc2V0SXNQYXNzd29yZFZpc2libGUoIWlzUGFzc3dvcmRWaXNpYmxlKSwNCiAgICBbaXNQYXNzd29yZFZpc2libGUsIHNldElzUGFzc3dvcmRWaXNpYmxlXQ0KICApOw0KDQogIGNvbnN0IHsgdDogX3QsIGlzTG9jYWxlUmVhZHksIGkxOG4gfSA9IHVzZUxvY2FsZSgpOw0KICBjb25zdCB0ID0gcHJvcHMudCB8fCBfdDsNCiAgY29uc3QgbmFtZSA9IHByb3BzLm5hbWUgfHwgIiI7DQogIGNvbnN0IHsNCiAgICBsYWJlbCA9IHQobmFtZSksDQogICAgbGFiZWxQcm9wcywNCiAgICBsYWJlbENsYXNzTmFtZSwNCiAgICBMb2NrZWRJY29uLA0KICAgIHBsYWNlaG9sZGVyID0gaXNMb2NhbGVSZWFkeSAmJiBpMThuLmV4aXN0cyhgJHtuYW1lfV9wbGFjZWhvbGRlcmApID8gdChgJHtuYW1lfV9wbGFjZWhvbGRlcmApIDogIiIsDQogICAgY2xhc3NOYW1lLA0KICAgIGFkZE9uTGVhZGluZywNCiAgICBhZGRPbkNsYXNzbmFtZSwNCiAgICBpbnB1dElzRnVsbFdpZHRoLA0KICAgIGxhYmVsU3JPbmx5LA0KICAgIG5vTGFiaWR0aH0KICAgICAgPgogICAgICAgIDxTdmdJbWFnZSBhdXRvcGxheT17YXV0b3BsYXl9IGZhbGxiYWNrPXtmYWxsYmFja30gc2l6ZT17c2l6ZX0gdXJpPXtpbWFnZUh0dHBVcmx9IC8+CiAgICAgIDwvRmxleD4KICAgICkKICB9CgogIC8vIEhhbmRsZSBhIHBsYWluIGltYWdlCiAgcmV0dXJuICgKICAgIDxQbGFpbkltYWdlCiAgICAgIGZhbGxiYWNrPXtmYWxsYmFja30KICAgICAgcmVzaXplTW9kZT17c2l6ZS5yZXNpemVNb2RlfQogICAgICBzaXplPXtjb21wdXRlZFNpemV9CiAgICAgIHN0eWxlPXtzdHlsZT8uaW1hZ2V9CiAgICAgIHRlc3RJRD17dGVzdElEID8gYGltZy0ke3Rlc3RJRH1gIDogdW5kZWZpbmVkfQogICAgICB1cmk9e2ltYWdlSHR0cFVybH0KICAgICAgb25Mb2FkPXtvbkxvYWR9CiAgICAvPgogICkKfQppbXBvcnQgKiBhcyBDaGVja2JveFByaW1pdGl2ZSBmcm9tICJAcmFkaXgtdWkvcmVhY3QtY2hlY2tib3giOwppbXBvcnQgeyB1c2VJZCB9IGZyb20gIkByYWRpeC11aS9yZWFjdC1pZCI7CmltcG9ydCB0eXBlIHsgSW5wdXRIVE1MQXR0cmlidXRlcyB9IGZyb20gInJlYWN0IjsKaW1wb3J0IFJlYWN0LCB7IGZvcndhcmRSZWYgfSBmcm9tICJyZWFjdCI7CmltcG9ydCBjbGFzc05hbWVzIGZyb20gIkBjYWxjb20vdWkvY2xhc3NOYW1lcyI7CgppbXBvcnQgeyBJY29uIH0gZnJvbSAiLi4vLi4vaWNvbiI7Cgp0eXBlIFByb3BzID0gSW5wdXRIVE1MQXR0cmlidXRlczxIVE1MSW5wdXRFbGVtZW50PiAmIHsKICBsYWJlbD86IFJlYWN0LlJlYWN0Tm9kZTsKICBkZXNjcmlwdGlvbj86IHN0cmluZzsKICBkZXNjcmlwdGlvbkFzTGFiZWw/OiBib29sZWFuOwogIGluZm9ybWF0aW9uSWNvblRleHQ/OiBzdHJpbmc7CiAgZXJyb3I/OiBib29sZWFuOwogIGNsYXNzTmFtZT86IHN0cmluZzsKICBkZXNjcmlwdGlvbkNsYXNzTmFtZT86IHN0cmluZzsKICAvKioKICAgKiBBY2NlcHRzIHRoaXMgc3BlY2lhbCBwcm9wZXJ0eSBpbnN0ZWFkIG9mIGFsbG93aW5nIGRlc2NyaXB0aW9uIGl0c2VsZiB0byBiZSBhY2NpZGVudGFsbHkgdXNlZCBpbiBkYW5nZXJvdXMgd2F5LgogICAqLwogIGRlc2NyaXB0aW9uQXNTYWZlSHRtbD86IHN0cmluZzsKfTsKCmNvbnN0IENoZWNrYm94ID0gUmVhY3QuZm9yd2FyZFJlZjwKICBSZWFjdC5FbGVtZW50UmVmPHR5cGVvZiBDaGVja2JveFByaW1pdGl2ZS5Sb290PiwKICBSZWFjdC5Db21wb25lbnRQcm9wc1dpdGhvdXRSZWY8dHlwZW9mIENoZWNrYm94UHJpbWl0aXZlLlJvb3Q+Cj4oKHsgY2xhc3NOYW1lLCAuLi5wcm9wcyB9LCByZWYpID0+ICgKICA8Q2hlY2tib3hQcmltaXRpdmUuUm9vdAogICAgcmVmPXtyZWZ9CiAgICBjbGFzc05hbWU9e2NsYXNzTmFtZXMoCiAgICAgICJib3JkZXItZGVmYXVsdCBkYXRhLVtzdGF0ZT1jaGVja2VkXTpiZy1icmFuZC1kZWZhdWx0IGRhdGEtW3N0YXRlPWNoZWNrZWRdOnRleHQtYnJhbmQgcGVlciBoLTQgdy00IHNocmluay0wIHJvdW5kZWQtWzRweF0gYm9yZGVyIHJpbmctb2Zmc2V0LTIgZm9jdXMtdmlzaWJsZTpvdXRsaW5lLW5vbmUgZm9jdXMtdmlzaWJsZTpyaW5nLTIgZm9jdXMtdmlzaWJsZTpyaW5nLW9mZnNldC0yIGRpc2FibGVkOmN1cnNvci1ub3QtYWxsb3dlZCIsCiAgICAgIGNsYXNzTmFtZQogICAgKX0KICAgIHsuLi5wcm9wc30+CiAgICA8Q2hlY2tib3hQcmltaXRpdmUuSW5kaWNhdG9yIGNsYXNzTmFtZT17Y2xhc3NOYW1lcygiZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgdGV4dC1jdXJyZW50Iil9PgogICAgICA8SWNvbiBuYW1lPSJjaGVjayIgY2xhc3NOYW1lPSJoLTQgdy00IiAvPgogICAgPC9DaGVja2JveFByaW1pdGl2ZS5JbmRpY2F0b3I+CiAgPC9DaGVja2JveFByaW1pdGl2ZS5Sb290PgopKTsKQ2hlY2tib3guZGlzcGxheU5hbWUgPSBDaGVja2JveFByaW1pdGl2ZS5Sb290LmRpc3BsYXlOYW1lOwoKY29uc3QgQ2hlY2tib3hGaWVsZCA9IGZvcndhcmRSZWY8SG5uZXIgPSBpc1dyYXBwZWRCYW5uZXJFbmFibGVkICYmICFoYXNEaXNtaXNzZWRXcmFwcGVkQmFubmVyCgogIGNvbnN0IHsgc2hvd0VtcHR5V2FsbGV0U3RhdGUsIGlzVGFic0RhdGFMb2FkZWQgfSA9IHVzZUhvbWVTY3JlZW5TdGF0ZSgpCgogIC8vIG9wZW5zIHRoZSB3YWxsZXQgcmVzdG9yZSBtb2RhbCBpZiByZWNvdmVyeSBwaHJhc2UgaXMgbWlzc2luZyBhZnRlciB0aGUgYXBwIGlzIG9wZW5lZAogIHVzZVdhbGxldFJlc3RvcmUoeyBvcGVuTW9kYWxJbW1lZGlhdGVseTogdHJ1ZSB9KQoKICBjb25zdCB7IHRyaWdnZXIgfSA9IHVzZUJpb21ldHJpY1Byb21wdCgpCgogIGNvbnN0IFtyb3V0ZVRhYkluZGV4LCBzZXRSb3V0ZVRhYkluZGV4XSA9IHVzZVN0YXRlKHByb3BzPy5yb3V0ZS5wYXJhbXM/LnRhYiA/PyBIb21lU2NyZWVuVGFiSW5kZXguVG9rZW5zKQogIC8vIEVuc3VyZXMgdGhhdCB0YWJJbmRleCBoYXMgdGhlIHByb3BlciB2YWx1ZSBiZXR3ZWVuIHRoZSBlbXB0eSBzdGF0ZSBhbmQgbm9uLWVtcHR5IHN0YXRlCiAgY29uc3QgdGFiSW5kZXggPSBzaG93RW1wdHlXYWxsZXRTdGF0ZSA/IEhvbWVTY3JlZW5UYWJJbmRleC5Ub2tlbnMgOiByb3V0ZVRhYkluZGV4CgogIHVzZUhvbWVTY3JlZW5DdXN0b21BbmRyb2lkQmFja0J1dHRvbihyb3V0ZVRhYkluZGV4LCBzZXRSb3V0ZVRhYkluZGV4KQoKICAvLyBOZWNlc3NhcnkgdG8gZGVjbGFyZSB0aGVzZSBhcyBkaXJlY3QgZGVwZW5kZW5jaWVzIGR1ZSB0byByYWNlIGNvbmRpdGlvbiB3aXRoIGluaXRpYWxpemluZyByZWFjdC1pMThuZXh0IGFuZCB1c2VNZW1vCiAgY29uc3QgdG9rZW5zVGl0bGUgPSB0KCdob21lLnRva2Vucy50aXRsZScpCiAgY29uc3QgbmZ0c1RpdGxlID0gdCgnaG9tZS5uZnRzLnRpdGxlJykKICBjb25zdCBhY3Rpdml0eVRpdGxlID0gdCgnaG9tZS5hY3Rpdml0eS50aXRsZScpCiAgY29uc3QgZXhwbG9yZVRpdGxlID0gdCgnaG9tZS5leHBsb3JlLnRpdGxlJykKCiAgY29uc3Qgcm91dGVzID0gdXNlTWVtbygoKTogSG9tZVJvdXRlW10gPT4gewogICAgaWYgKHNob3dFbXB0eVdhbGxldFN0YXRlKSB7CiAgICAgIHJldHVybiBbCiAgICAgICAgewogICAgICAgICAga2V5OiBTZWN0aW9uTmFtZS5Ib21lRXhwbG9yZVRhYiwKICAgICAgICAgIHRpdGxlOiBleHBsb3JlVGl0bGUsCiAgICAgICAgICB0ZXh0U3R5bGVUeXBlOiAnc2Vjb25kYXJ5JywKICAgICAgICB9LAogICAgICBdCiAgICB9CiAgICBjb25zdCB0YWJzOiBBcnJheTxIb21lUm91dGU+ID0gWwogICAgICB7IGtleTogU2VjdGlvbk5hbWUuSG9tZVRva2Vuc1RhYiwgdGl0bGU6IHRva2Vuc1RpdGxlIH0sCiAgICAgIHsga2V5OiBTZWN0aW9uTmFtZS5Ib21lTkZUc1RhYiwgdGl0bGU6IG5mdHNUaXRsZSB9LAogICAgICAuLi4oIWlzQm90dG9tVGFic0VuYWJsZWQKICAgICAgICA/IFt7IGtleTogU2VjdGlvbk5hbWUuSG9tZUFjdGl2aXR5VGFiLCB0aXRsZTogYWN0aXZpdHlUaXRsZSwgZW5hYmxlTm90aWZpY2F0aW9uQmFkZ2U6IHRydWUgfV0KICAgICAgICA6IFtdKSwKICAgIF0KCiAgICByZXR1cm4gdGFicwogIH0sIFtzaG93RW1wdHlXYWxsZXRTdGF0ZSwgdG9rZW5zVGl0bGUsIG5mdHNUaXRsZSwgaXNCb3R0b21UYWJzRW5hYmxlZCwgYWN0aXZpdHlUaXRsZSwgZXhwbG9yZVRpdGxlXSkKCiAgdXNlRWZmZWN0KAogICAgZnVuY3Rpb24gc3luY1RhYkluZGV4KCkgewogICAgICBjb25zdCBuZXdUYWJJbmRleCA9IHByb3BzPy5yb3V0ZS5wYXJhbXM/LnRhYgogICAgICBpZiAobmV3VGFiSW5kZXggPT09IHVuZGVmaW5lZCkgewogICAgICAgIHJldHVybgogICAgICB9CiAgICAgIHNldFJvdXRlVGFiSW5kZXgobmV3VGFiSW5kZXgpCiAgICB9LAogICAgW3Byb3BzPy5yb3V0ZS5wYXJhbXM/LnRhYl0sCiAgKQoKICBjb25zdCBbaXNMYXlvdXRSZWFkeSwgc2V0SXNMYXlvdXRSZWFkeV0gPSB1c2VTdGF0ZShmYWxzZSkKCiAgY29uc3QgW2hlYWRlZGluZykiLAogICAgZGVzY3JpcHRpb246ICJUaHJlZSBldmVudHMgdGhhdCBvdmVybGFwLCBjcmVhdGluZyBhIGNhc2NhZGluZyBlZmZlY3QiLAogICAgZXhwZWN0ZWQ6CiAgICAgICJFdmVudHMgc3ByZWFkIGFjcm9zcyBmdWxsIHdpZHRoIHdpdGggdmFyaWFibGUgd2lkdGhzICg1NSUsIH40MiUsIDMzJSkuIE9mZnNldHM6IDAlLCB+MzUlLCA2Ni41JSAobGFzdCBldmVudCBhbGlnbmVkIHRvIHJpZ2h0IGVkZ2UpLiBSaWdodCBlZGdlcyBldmVubHkgZGlzdHJpYnV0ZWQgZm9yIG1heGltdW0gc2NhdHRlci4gWi1pbmRleCBzaG91bGQgaW5jcmVtZW50LiBIb3ZlciBicmluZ3MgYW55IHRvIHRvcC4iLAogICAgc3RhcnRIb3VyOiA5LAogICAgZXZlbnRzOiBbCiAgICAgIHsKICAgICAgICBpZDogMywKICAgICAgICB0aXRsZTogIkxvbmcgTWVldGluZyIsCiAgICAgICAgc3RhcnQ6IG1ha2VEYXRlKDEsIDEwLCAwKSwKICAgICAgICBlbmQ6IG1ha2VEYXRlKDEsIDEyLCAwKSwKICAgICAgICBvcHRpb25zOiB7IHN0YXR1czogIkFDQ0VQVEVEIiwgY29sb3I6ICIjM2I4MmY2IiB9LAogICAgICB9LAogICAgICB7CiAgICAgICAgaWQ6IDQsCiAgICAgICAgdGl0bGU6ICJNaWQgTWVldGluZyIsCiAgICAgICAgc3RhcnQ6IG1ha2VEYXRlKDEsIDEwLCAzMCksCiAgICAgICAgZW5kOiBtYWtlRGF0ZSgxLCAxMSwgMzApLAogICAgICAgIG9wdGlvbnM6IHsgc3RhdHVzOiAiUEVORElORyIsIGNvbG9yOiAiI2Y1OWUwYiIgfSwKICAgICAgfSwKICAgICAgewogICAgICAgIGlkOiA1LAogICAgICAgIHRpdGxlOiAiTGF0ZSBNZWV0aW5nIiwKICAgICAgICBzdGFydDogbWFrZURhdGUoMSwgMTEsIDApLAogICAgICAgIGVuZDogbWFrZURhdGUoMSwgMTIsIDMwKSwKICAgICAgICBvcHRpb25zOiB7IHN0YXR1czogIkFDQ0VQVEVEIiwgY29sb3I6ICIjMTBiOTgxIiB9LAogICAgICB9LAogICAgXSwKICB9LAogIHsKICAgIGlkOiAibm9uLW92ZXJsYXBwaW5nIiwKICAgIHRpdGxlOiAiTm9uLU92ZXJsYXBwaW5nIEV2ZW50cyIsCiAgICBkZXNjcmlwdGlvbjogIkV2ZW50cyB0aGF0IGRvbid0IG92ZXJsYXAgc2hvdWxkIG5vdCBjYXNjYWRlIiwKICAgIGV4cGVjdGVkOiAiQm90aCBldmVudHMgYXQgMCUgb2Zmc2V0IChzZXBhcmF0ZSBncm91cHMpLCBubyBjYXNjYWRlLiBCb3RoIHNob3VsZCBiZSAxMDAlIHdpZHRoLiIsCiAgICBzdGFydEhvdXI6IDksCiAgICBldmVudHM6IFsKICAgICAgewogICAgICAgIGlkOiA2LAogICAgICAgIHRpdGxlOiAiTW9ybmluZyBNZWV0aW5nIiwKICAgICAgICBzdGFydDogbWFrZURhdGUoMiwgMTAsIDApLAogICAgICAgIGVuZDogbWFrZURhdGUoMiwgMTEsIDApLAogICAgICAgIG9wdGlvbnM6IHsgc3RhdHVzOiAiQUNDRVBURUQiLCBjb2xvcjogIiMzYjgyZjYiIH0sCiAgICAgIH0sCiAgICAgIHsKICAgICAgICBpZDogNywKICAgICAgICB0aXRsZTogIkFmdGVybm9vbiBNZWV0aW5nIiwKICAgICAgICBzdGFydDogbWFrZURhdGUoMiwgMTIsIDApLAogICAgICAgIGVuZDogbWFrZURhdGUoMiwgMTMsIDApLAogICAgICAgIG9wdGlvbnM6IHsgc3RhdHVzOiAiQUNDRVBURUQiLCBjb2xvcjogIiMxMGI5ODEiIH0sCiAgICAgIH0sCiAgICBdLAogIH0sCiAgewogICAgaWQ6ICJzYW1lLXN0YXJ0LXRpbWUiLAogICAgdGl0bGU6ICJTYW1lIFN0YXJ0IFRpbWUsIERpZmZlcmVudCBEdXJhdGlvbnMiLAogICAgZGVzY3JpcHRpb246ICJNdWx0aXBsZSBldmVudHMgc3RhcnRpbmcgYXQgdGhlIHNhbWUgdGltZSB3aXRoIHZhcnlpbmcgbGVuZ3RocyIsCiAgICBleHBlY3RlZDoKICAgICAgIkxvbmdlc3QgZXZlbnQgZmlyc3QgKGJhc2Ugb2YgY2FzY2FkZSksIHNwcmVhZCBhY3Jvc3MgZnVsbCB3aWR0aCB3aXRoIHZhcmlhYmxlIHdpZHRocyAoNTUlLCB+NDIlLCAzMyUpLiBMYXN0IGV2ZW50IGFsaWduZWQgdG8gcmlnaHQgZWRnZS4gQWxsIHN0YXJ0IGF0IDEwOjAwLiIsCiBuIFZlcmNlbEJsb2NrKCkgewogIHJldHVybiAoCiAgICA8RXhhbXBsZVdyYXBwZXI+CiAgICAgIDxEZXBsb3ltZW50RmlsdGVyIC8+CiAgICAgIDxVc2FnZUNhcmQgLz4KICAgICAgPE9ic2VydmFiaWxpdHlDYXJkIC8+CiAgICAgIDxCaWxsaW5nTGlzdCAvPgogICAgICA8QW5vbWFseUFsZXJ0IC8+CiAgICAgIDxBY3RpdmF0ZUFnZW50RGlhbG9nIC8+CiAgICAgIDxGZWVkYmFja0Zvcm0gLz4KICAgICAgPEFuYWx5dGljc0NhcmQgLz4KICAgIDwvRXhhbXBsZVdyYXBwZXI+CiAgKQp9Cgpjb25zdCBpdGVtcyA9IFsKICB7CiAgICBuYW1lOiAiRWRnZSBSZXF1ZXN0cyIsCiAgICB2YWx1ZTogIiQxLjgzSyIsCiAgICBwZXJjZW50YWdlOiA2Ny4zNCwKICB9LAogIHsKICAgIG5hbWU6ICJGYXN0IERhdGEgVHJhbnNmZXIiLAogICAgcGVyY2VudGFnZTogNTIuMTgsCiAgICB2YWx1ZTogIiQ5NTIuNTEiLAogIH0sCiAgewogICAgbmFtZTogIk1vbml0b3JpbmcgZGF0YSBwb2ludHMiLAogICAgcGVyY2VudGFnZTogODkuNDIsCiAgICB2YWx1ZTogIiQ5MDEuMjAiLAogIH0sCiAgewogICAgbmFtZTogIldlYiBBbmFseXRpY3MgRXZlbnRzIiwKICAgIHBlcmNlbnRhZ2U6IDQ1LjY3LAogICAgdmFsdWU6ICIkNjAzLjcxIiwKICB9LAogIHsKICAgIG5hbWU6ICJFZGdlIFJlcXVlc3QgQ1BVIER1cmF0aW9uIiwKICAgIHBlcmNlbnRhZ2U6IDIzLjkxLAogICAgdmFsdWU6ICIkNC42NSIsCiAgfSwKICB7CiAgICBuYW1lOiAiRmFzdCBPcmlnaW4gVHJhbnNmZXIiLAogICAgcGVyY2VudGFnZTogMzguNzUsCiAgICB2YWx1ZTogIiQzLjg1IiwKICB9LAogIHsKICAgIG5hbWU6ICJJU1IgUmVhZHMiLAogICAgcGVyY2VudGFnZTogNzEuMjQsCiAgICB2YWx1ZTogIiQyLjg2IiwKICB9LAogIHsKICAgIG5hbWU6ICJGdW5jdGlvbiBJbnZvY2F0aW9ucyIsCiAgICBwZXJjZW50YWdlOiAxNS44MywKICAgIHZhbHVlOiAiJDAuNjAiLAogIH0sCiAgewogICAgbmFtZTogIklTUiBXcml0ZXMiLAogICAgcGVyY2VudGFnZTogMjYuMjMsCiAgICB2YWx1ZTogIjUyNC41MksgLyAyTSIsCiAgfSwKICB7CiAgICBuYW1lOiAiRnVuY3Rpb24gRHVyYXRpb24iLAogICAgcGVyY2VudGFnZTogNS4xMSwKICAgIHZhbHVlOiAiNS4xMSBHQiBIcnMgLyAxSyBHQiBIcnMiLAogIH0sCl0KCmZ1bmN0aW9uIFVzYWdlQ2FyZCgpIHsKICByZXR1cm4gKAogICAgPEV4YW1wbGUgdGl0bGU9IlVzYWdlIiBjbGFzc05hbWU9Iml0ZW1zLWNlbnRlciI+CiAgICAgIDxDYXJkIGNsYXNzTmFtZT0idy1mdWxsIG1heC13LXNtIGdhcC00Ij4KICAgICAgICA8Q2FyZEhlYWRlcj4KICAgICAgICAgIDxDYXJkVGl0bGUgY2xhc3NOYW1lPSJweC0xIHRleHQtc20iPgogICAgICAgICAgICA1IGRheXMgcmVtYWluaW5nIGluIGN5Y2xlCiAgICAgICAgICA8L0NhcmRUaXRsZT4KICAgICAgICA8L0NhcmRIZWFkZXI+CiAgICAgICAgPENhcmRDb250ZW50PgogICAgICAgICAgPEl0ZW1Hcm91cCBjbGFzc05hbWU9ImdhcC0wIj4KICAgICAgICAgICAge2l0ZW1zLm1hcCgoaXRlbSkgPT4gKAogICAgICAgICAgICAgIDxJdGVtCiAgICAgICAgICAgICAgICBrZXk9e2l0ZW0ubmFtZX0KICAgICAgICAgICAgICAgIHNpemU9InhzIgogICAgICAgICAgICAgICAgYXNDaGlsZAogICAgICAgICAgICAgICAgY2xhc3NOYW1lPSJweC0wIGdyb3VwLWhvdmVyL2l0ZW0tZ3JvdXA6YmctdHJhbnNwYXJlbnQiCiAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgPGEgaHJlZj0iIyI+CiAgICAgICAgICAgICAgICAgIDxJdGVtTWVkaWEgdmFyaWFudD0iaWNvbiIgY2xhc3NOYW1lPSJ0ZXh0LXByaW1hcnkiPgogICAgICAgICAgICAgICAgICAgIDxDaXJjdWxhckdhdWdlIHBlcmNlbnRhZ2U9e2l0ZW0ucGVyY2VudGFnZX0gLz4KICAgICAgICAgICAgICAgICAgPC9JdGVtTWVkaWE+CiAgICAgICAgICAgICAgICAgIDxJdGVtQyAgPFNlZ21lbnRlZENvbnRyb2wKICAgICAgICAgICAgICAgIGRhdGE9e1t7IHZhbHVlOiAiaW5mbyIsIGxhYmVsOiB0KCJpbmZvIikgfSwgeyB2YWx1ZTogImhpc3RvcnkiLCBsYWJlbDogdCgiaGlzdG9yeSIpIH1dfQogICAgICAgICAgICAgICAgdmFsdWU9e2FjdGl2ZVNlZ21lbnR9CiAgICAgICAgICAgICAgICBvbkNoYW5nZT17KHZhbHVlKSA9PiBzZXRBY3RpdmVTZWdtZW50KHZhbHVlKX0KICAgICAgICAgICAgICAvPgogICAgICAgICAgICApfQoKICAgICAgICAgICAge2FjdGl2ZVNlZ21lbnQgPT09ICJpbmZvIiAmJiAoCiAgICAgICAgICAgICAgPD4KICAgICAgICAgICAgICAgIDxXaGVuU2VjdGlvbgogICAgICAgICAgICAgICAgICByZXNjaGVkdWxlZD17Ym9va2luZy5yZXNjaGVkdWxlZCB8fCBmYWxzZX0KICAgICAgICAgICAgICAgICAgc3RhcnRUaW1lPXtzdGFydFRpbWV9CiAgICAgICAgICAgICAgICAgIGVuZFRpbWU9e2VuZFRpbWV9CiAgICAgICAgICAgICAgICAgIHRpbWVab25lPXt1c2VyVGltZVpvbmV9CiAgICAgICAgICAgICAgICAgIHByZXZpb3VzQm9va2luZz17Ym9va2luZ0RldGFpbHM/LnByZXZpb3VzQm9va2luZ30KICAgICAgICAgICAgICAgIC8+CgogICAgICAgICAgICAgICAgPE9sZFJlc2NoZWR1bGVkQm9va2luZ0luZm8KICAgICAgICAgICAgICAgICAgYm9va2luZz17Ym9va2luZ30KICAgICAgICAgICAgICAgICAgcmVzY2hlZHVsZWRUb0Jvb2tpbmc9e2Jvb2tpbmdEZXRhaWxzPy5yZXNjaGVkdWxlZFRvQm9va2luZ30KICAgICAgICAgICAgICAgIC8+CgogICAgICAgICAgICAgICAgPE5ld1Jlc2NoZWR1bGVkQm9va2luZ0luZm8gYm9va2luZz17Ym9va2luZ30gLz4KCiAgICAgICAgICAgICAgICA8Q2FuY2VsbGVkQm9va2luZ0luZm8gYm9va2luZz17Ym9va2luZ30gLz4KCiAgICAgICAgICAgICAgICA8V2hvU2VjdGlvbiBib29raW5nPXtib29raW5nfSAvPgoKICAgICAgICAgICAgICAgIDxXaGVyZVNlY3Rpb24gYm9va2luZz17Ym9va2luZ30gbWV0YT17Ym9va2luZ01ldGFkYXRhfSAvPgoKICAgICAgICAgICAgICAgIDxSZWN1cnJpbmdJbmZvU2VjdGlvbiByZWN1cnJpbmdJbmZvPXtyZWN1cnJpbmdJbmZvfSAvPgoKICAgICAgICAgICAgICAgIDxBc3NpZ25tZW50UmVhc29uU2VjdGlvbiBib29raW5nPXtib29raW5nfSAvPgoKICAgICAgICAgICAgICAgIHtib29raW5nLnBheW1lbnQ/LlswXSAmJiA8UGF5bWVudFNlY3Rpb24gYm9va2luZz17Ym9va2luZ30gcGF5bWVudD17Ym9va2luZy5wYXltZW50WzBdfSAvPn0KCiAgICAgICAgICAgICAgICA8U2xvdHNTZWN0aW9uIGJvb2tpbmc9e2Jvb2tpbmd9IC8+CgogICAgICAgICAgICAgICAgPEFkZGl0aW9uYWxOb3Rlc1NlY3Rpb24gYm9va2luZz17Ym9va2luZ30gLz4KCiAgICAgICAgICAgICAgICA8Q3VzdG9tUXVlc3Rpb25zU2VjdGlvbgogICAgICAgICAgICAgICAgICBjdXN0b21SZXNwb25zZXM9e2N1c3RvbVJlc3BvbnNlc30KICAgICAgICAgICAgICAgICAgYm9va2luZ0ZpZWxkcz17Ym9va2luZy5ldmVudFR5cGU/LmJvb2tpbmdGaWVsZHN9CiAgICAgICAgICAgICAgICAvPgoKICAgICAgICAgICAgICAgIDxUcmFja2luZ1NlY3Rpb24gdHJhY2tpbmc9e2Jvb2tpbmdEZXRhaWxzPy50cmFja2luZ30gLz4KICAgICAgICAgICAgICA8Lz4KICAgICAgICAgICAgKX0KCiAgICAgICAgICAgIHtib29raW5nQXVkaXRFbmFibGVkICYmIGFjdGl2ZVNlZ21lbnQgPT09ICJoaXN0b3J5IiAmJiAoCiAgICAgICAgICAgICAgPEJvb2tpbmdIaXN0b3J5IGJvb2tpbmdVaWQ9e2Jvb2tpbmcudWlkfSAvPgogICAgICAgICAgICApfQogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9TaGVldEJvZHk+CgogICAgICAgIDxTaGVldEZvb3RlciBjbGFzc05hbWU9ImJnLW11dGVkIGJvcmRlci1zdWJ0bGUgLW14LTQgLW1iLTQgYm9yZGVyLXQgcHQtMCBzbTotbXgtNiBzbTotbXktNiJldGVyKHVybFBhcmFtOiBQYXJzZWRRc1tzdHJpbmddLCBwbGF0Zm9ybTogUGxhdGZvcm0pOiBzdHJpbmcgfCB1bmRlZmluZWQgewogIGlmICh0eXBlb2YgdXJsUGFyYW0gPT09ICdzdHJpbmcnKSB7CiAgICBjb25zdCB2YWxpZCA9IGdldFZhbGlkQWRkcmVzcyh7IGFkZHJlc3M6IHVybFBhcmFtLCBwbGF0Zm9ybSwgd2l0aEVWTUNoZWNrc3VtOiB0cnVlIH0pCiAgICBpZiAodmFsaWQpIHsKICAgICAgcmV0dXJuIHZhbGlkCiAgICB9CgogICAgY29uc3QgdXBwZXIgPSB1cmxQYXJhbS50b1VwcGVyQ2FzZSgpCiAgICBpZiAodXBwZXIgPT09ICdFVEgnKSB7CiAgICAgIHJldHVybiAnRVRIJwogICAgfQoKICAgIGlmICh1cmxQYXJhbSA9PT0gTkFUSVZFX0NIQUlOX0lEKSB7CiAgICAgIHJldHVybiBOQVRJVkVfQ0hBSU5fSUQKICAgIH0KICB9CiAgcmV0dXJuIHVuZGVmaW5lZAp9CgppbnRlcmZhY2UgQmFzZVN3YXBQYXJhbXMgewogIGNoYWluSWQ/OiBVbml2ZXJzZUNoYWluSWQKICBvdXRwdXRDaGFpbklkPzogVW5pdmVyc2VDaGFpbklkCiAgaW5wdXRDdXJyZW5jeT86IHN0cmluZwogIG91dHB1dEN1cnJlbmN5Pzogc3RyaW5nCiAgdHlwZWRWYWx1ZT86IHN0cmluZwogIGluZGVwZW5kZW50RmllbGQ/OiBDdXJyZW5jeUZpZWxkCn0KCmZ1bmN0aW9uIGNyZWF0ZUJhc2VTd2FwVVJMUGFyYW1zKHsKICBjaGFpbklkLAogIG91dHB1dENoYWluSWQsCiAgaW5wdXRDdXJyZW5jeSwKICBvdXRwdXRDdXJyZW5jeSwKICB0eXBlZFZhbHVlLAogIGluZGVwZW5kZW50RmllbGQsCn06IEJhc2VTd2FwUGFyYW1zKTogVVJMU2VhcmNoUGFyYW1zIHsKICBjb25zdCBwYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKCkKCiAgaWYgKGNoYWluSWQpIHsKICAgIHBhcmFtcy5zZXQoJ2NoYWluJywgZ2V0Q2hhaW5JbmZvKGNoYWluSWQpLmludGVyZmFjZU5hbWUpCiAgfQoKICBpZiAob3V0cHV0Q2hhaW5JZCAmJiBvdXRwdXRDaGFpbklkICE9PSBjaGFpbklkKSB7CiAgICBwYXJhbXMuc2V0KCdvdXRwdXRDaGFpbicsIGdldENoYWluSW5mbyhvdXRwdXRDaGFpbklkKS5pbnRlcmZhY2VOYW1lKQogIH0KCiAgaWYgKGlucHV0Q3VycmVuY3kpIHsKICAgIHBhcmFtcy5zZXQoJ2lucHV0Q3VycmVuY3knLCBpbnB1dEN1cnJlbmN5KQogIH0KCiAgaWYgKG91dHB1dEN1cnJlbmN5KSB7CiAgICBwYXJhbXMuc2V0KCdvdXRwdXRDdXJyZW5jeScsIG91dHB1dEN1cnJlbmN5KQogIH0KCiAgaWYgKHR5cGVkVmFsdWUpIHsKICAgIHBhcmFtcy5zZXQoJ3ZhbHVlJywgdHlwZWRWYWx1ZSkKICB9CgogIGlmIChpbmRlcGVuZGVudEZpZWxkKSB7CiAgICBwYXJhbXMuc2V0KCdmaWVsZCcsIGluZGVwZW5kZW50RmllbGQpCiAgfQoKICByZXR1cm4gcGFyYW1zCn0KCmV4cG9ydCBmdW5jdGlvbiBzZXJpYWxpemVTd2FwU3RhdGVUb1VSTFBhcmFtZXRlcnMoCiAgc3RhdGU6IEN1cnJlbmN5U3RhdGUgJiBQYXJ0aWFsPFN3YXBTdGF0ZT4gJiB7IGNoYWluSWQ6IFVuaXZlcnNlQ2hhaW5JZCB9LAopOiBzdHJpbmcgewogIGNvbnN0IHsgaW5wdXRDdXJyZW5jeSwgb3V0cHV0Q3VycmVuY3ksIHR5cGVkVmFsdWUsIGluZGVwZW5kZW50RmllbGQsIGNoYWluSWQgfSA9IHN0YXRlCiAgY29uc3QgaGFzVmFsaWRJbnB1dCA9IChpbnB1dEN1cnJlbmN5IHx8IG91dHB1dEN1cnJlbmN5KSAmJiB0eXBlZFZhbHVlCgogIHJldHVybiAoCiAgICAnPycgKwogICAgY3JlYXRlQmFzZVN3YXBVUkxQYXJhbXMoewogICAgICBjaGFpbklkLAogICAgICBvdXRwdXRDaGFpbklkOiBvdXRwdXRDdXJyZW5jeT8uY2hhaW5JZCAhPT0gaW5wdXRDdXJyZW5jeT8uY2hhaW5JZCA/IG91dHB1dEN1cnJlbmN5Py5jaGFpbklkIDogdW5kZWZpbmVkLAogICAgICBpbnB1dEN1cnJlbmN5OiBpbnB1dEN1cnJlbmN5ID8gKGlucHV0Q3VycmVuY3kuaXNOYXRpdmUgPyBOQVRJVkVfQ0hBSU5fSUQgOiBpbnB1dEN1cnJlbmN5LmFkZHJlc3MpIDogSEVSX0ZJRUxEX0lEID0gLTE7Cgpjb25zdCBJbnRlcm5hbE5vdGVQcmVzZXRzVmlldyA9ICh7IHRlYW0gfTogUHJvZmlsZVZpZXdQcm9wcykgPT4gewogIGNvbnN0IHsgdCB9ID0gdXNlTG9jYWxlKCk7CiAgY29uc3QgdXRpbHMgPSB0cnBjLnVzZVV0aWxzKCk7CiAgY29uc3QgeyBkYXRhOiBfbG9hZGVkUHJlc2V0cyB9ID0gdHJwYy52aWV3ZXIudGVhbXMuZ2V0SW50ZXJuYWxOb3Rlc1ByZXNldHMudXNlUXVlcnkoewogICAgdGVhbUlkOiB0ZWFtPy5pZCBhcyBudW1iZXIsCiAgfSk7CgogIGNvbnN0IGxvYWRlZFByZXNldHMgPSB1c2VNZW1vKCgpID0+IHsKICAgIHJldHVybiAoX2xvYWRlZFByZXNldHMgPz8gW10pLm1hcCgocHJlc2V0KSA9PiAoewogICAgICAuLi5wcmVzZXQsCiAgICAgIGNhbmNlbGxhdGlvblJlYXNvbjogcHJlc2V0LmNhbmNlbGxhdGlvblJlYXNvbiA/PyB1bmRlZmluZWQsCiAgICB9KSk7CiAgfSwgW19sb2FkZWRQcmVzZXRzXSk7CgogIGNvbnN0IGhhc0V4aXN0aW5nUHJlc2V0cyA9IGxvYWRlZFByZXNldHMubGVuZ3RoID4gMDsKCiAgdHlwZSBGb3JtVmFsdWVzID0gewogICAgcHJlc2V0czogeyBpZDogbnVtYmVyOyBuYW1lOiBzdHJpbmc7IGNhbmNlbGxhdGlvblJlYXNvbj86IHN0cmluZyB8IHVuZGVmaW5lZCB9W107CiAgfTsKCiAgY29uc3QgZm9ybSA9IHVzZUZvcm08Rm9ybVZhbHVlcz4oewogICAgdmFsdWVzOiB7CiAgICAgIHByZXNldHM6IGxvYWRlZFByZXNldHMsCiAgICB9LAogIH0pOwoKICBjb25zdCB7IGZpZWxkcywgYXBwZW5kLCByZW1vdmUsIHJlcGxhY2UgfSA9IHVzZUZpZWxkQXJyYXkoewogICAgY29udHJvbDogZm9ybS5jb250cm9sLAogICAgbmFtZTogInByZXNldHMiLAogIH0pOwoKICBjb25zdCBhZGROZXdQcmVzZXQgPSAoKSA9PiB7CiAgICBhcHBlbmQoeyBpZDogT1RIRVJfRklFTERfSUQsIG5hbWU6ICIiIH0pOwogIH07CgogIGNvbnN0IHVwZGF0ZVByZXNldHNNdXRhdGlvbiA9IHRycGMudmlld2VyLnRlYW1zLnVwZGF0ZUludGVybmFsTm90ZXNQcmVzZXRzLnVzZU11dGF0aW9uKHsKICAgIG9uU3VjY2VzczogKCkgPT4gewogICAgICBzaG93VG9hc3QodCgiaW50ZXJuYWxfbm90ZV9wcmVzZXRzX3VwZGF0ZWRfc3VjY2Vzc2Z1bGx5IiksICJzdWNjZXNzIik7CiAgICAgIHV0aWxzLnZpZXdlci50ZWFtcy5nZXRJbnRlcm5hbE5vdGVzUHJlc2V0cy5pbnZhbGlkYXRlKCk7CiAgICB9LAogICAgb25FcnJvcjogKGVycm9yKSA9PiB7CiAgICAgIHNob3dUb2FzdChlcnJvci5tZXNzYWdlIHx8IHQoInNvbWV0aGluZ193ZW50X3dyb25nIiksICJlcnJvciIpOwogICAgfSwKICB9KTsKCiAgY29uc3Qgb25TdWJtaXQgPSBhc3luYyAoZGF0YTogRm9ybVZhbHVlcykgPT4gewogICAgaWYgKCF0ZWFtPy5pZCkgcmV0dXJuOwoKICAgIHVwZGF0ZVByZXNldHNNdXRhdGlvbi5tdXRhdGUoewogICAgICB0ZWFtSWQ6IHRlYW0uaWQsCiAgICAgIHByZXNldHM6IGRhdGEucHJlc2V0cywKICAgIH0pOwogIH07CgogIGNvbnN0IFthbmltYXRlUmVmXSA9IHVzZUF1dG9BbmltYXRlPEhUTUxEaXZFbGVtZW50PigpOwoKICBjb25zdCBpc0FkbWluID0gdGVhbSAmJiBjaGVja0FkbWluT3JPd25lcih0ZWFtLm1lbWJlcnNoaXAucm9sZSk7CgogIGlmICghaXNBZG1pbikgewogICAgcmV0dXJuICgKICAgICAgPGRpdiBjbGFzc05hbWU9ImJvcmRlci1zdWJ0bGUgcm91bmRlZC1tZCBib3JkZXIgcC01Ij4KICAgICAgICA8c3BhbiBjbGFzc05hbWU9InRleHQtZGVmYXVsdCB0ZXh0LXNtIj57dCgib25seV9vd25lcl9jaGFuZ2UiKX08L3NwYW4+CiAgICAgIDwvZGl2PgogICAgKTsKICB9CgogIHJldHVybiAoCiAgICA8Rm9ybSBmb3JtPXtmb3JtfSBoYW5kbGVTdWJtaXQ9eyhlKSA9PiBvblN1Ym1pdChlKX0+CiAgICAgIDxDb250cm9sbGVyCiAgICAgICAgbmFtZT0icHJlc2V0cyIKICAgICAgICByZW5kZXI9eyh7IGZpZWxkOiB7IHZhbHVlIH0gfSkgPSBnZXREdXJhdGlvblJlbWFpbmluZ1N0cmluZyB9IGZyb20gJ3V0aWxpdGllcy9zcmMvdGltZS9kdXJhdGlvbicKCi8qKgogKiBUeXBlIGd1YXJkIHRvIGNoZWNrIGlmIG9yZGVyIGFtb3VudHMgYXJlIGZ1bGx5IGRlZmluZWQgd2l0aCBjdXJyZW5jaWVzLgogKiBUaGlzIGlzIGEgcnVudGltZSBjaGVjayBiZWNhdXNlIHVzZU9yZGVyQW1vdW50cyBjYW4gcmV0dXJuIHVuZGVmaW5lZCBpZjoKICogLSBDdXJyZW5jeSByZXNvbHV0aW9uIGZhaWxzIChuZXR3b3JrIGlzc3VlcywgbWlzc2luZyB0b2tlbiBkYXRhKQogKiAtIE9yZGVyIHR5cGVJbmZvIGlzIG1pc3Npbmcgb3IgbWFsZm9ybWVkCiAqIFdoaWxlIG9wZW4gb3JkZXJzIHNob3VsZCB0eXBpY2FsbHkgaGF2ZSB2YWxpZCBhbW91bnRzLCBjdXJyZW5jeSByZXNvbHV0aW9uCiAqIGNhbiBmYWlsIGF0IHJ1bnRpbWUsIHNvIHRoaXMgZ3VhcmQgaXMgbmVjZXNzYXJ5LgogKi8KZnVuY3Rpb24gaGFzVmFsaWRPcmRlckFtb3VudHMoYW1vdW50czogUmV0dXJuVHlwZTx0eXBlb2YgdXNlT3JkZXJBbW91bnRzPik6IGFtb3VudHMgaXMgewogIGlucHV0QW1vdW50OiBDdXJyZW5jeUFtb3VudDxDdXJyZW5jeT4KICBvdXRwdXRBbW91bnQ6IEN1cnJlbmN5QW1vdW50PEN1cnJlbmN5Pgp9IHsKICByZXR1cm4gISFhbW91bnRzPy5pbnB1dEFtb3VudC5jdXJyZW5jeSAmJiAhIWFtb3VudHMub3V0cHV0QW1vdW50LmN1cnJlbmN5Cn0KCmZ1bmN0aW9uIGdldEV4cGlyeVRleHQoZXhwaXJ5OiBudW1iZXIgfCB1bmRlZmluZWQsIHQ6IFRGdW5jdGlvbik6IHN0cmluZyB8IG51bGwgewogIGlmICghZXhwaXJ5KSB7CiAgICByZXR1cm4gbnVsbAogIH0KCiAgY29uc3QgZXhwaXJ5VGltZU1zID0gZXhwaXJ5ICogMTAwMAogIGNvbnN0IGR1cmF0aW9uU3RyaW5nID0gZ2V0RHVyYXRpb25SZW1haW5pbmdTdHJpbmcoZXhwaXJ5VGltZU1zKQoKICByZXR1cm4gdCgnY29tbW9uLmxpbWl0cy5leHBpcmVzSW4nLCB7IGR1cmF0aW9uOiBkdXJhdGlvblN0cmluZyB9KQp9CgppbnRlcmZhY2UgT3BlbkxpbWl0c1RhYmxlUHJvcHMgewogIGFjY291bnQ6IHN0cmluZwogIG1heExpbWl0cz86IG51bWJlcgp9CgovLyBMZWZ0IGNvbHVtbiBjZWxsIGNvbXBvbmVudApjb25zdCBMaW1pdEluZm9DZWxsID0gbWVtbyhmdW5jdGlvbiBMaW1pdEluZm9DZWxsKHsgb3JkZXIgfTogeyBvcmRlcjogVW5pc3dhcFhPcmRlckRldGFpbHMgfSkgewogIGNvbnN0IHsgdCB9ID0gdXNlVHJhbnNsYXRpb24oKQogIGNvbnN0IHsgZm9ybWF0Q3VycmVuY3lBbW91bnQgfSA9IHVzZUxvY2FsaXphdGlvbkNvbnRleHQoKQogIGNvbnN0IGFtb3VudHMgPSB1c2VPcmRlckFtb3VudHMob3JkZXIpCgogIGNvbnN0IGlucHV0Q3VycmVuY3lJbmZvID0gdXNlQ3VycmVuY3lJbmZvKAogICAgYW1vdW50cz8uaW5wdXRBbW91bnQuY3VycmVuY3kgPyBjdXJyZW5jeUlkKGFtb3VudHMuaW5wdXRBbW91bnQuY3VycmVuY3kpIDogdW5kZWZpbmVkLAogICkKICBjb25zdCBvdXRwdXRDdXJyZW5jeUluZm8gPSB1c2VDdXJyZW5jeUluZm8oCiAgICBhbW91bnRzPy5vdXRwdXRBbW91bnQuY3VycmVuY3kgPyBjdXJyZW5jeUlkKGFtb3VudHMub3V0cHV0QW1vdW50LmN1cnJlbmN5KSA6IHVuZGVmaW5lZCwKICApCgogIC8vIEVhcmx5IHJldHVybiBpZiBhbW91bnRzIGFyZSBub3QgZnVsbHkgZGVmaW5lZCB3aXRoIGN1cnJlbmNpZXMKICAvLyBUaGlzIGlzIGEgdmFsaWQgcnVudGltZSBjaGVjayAtIGN1cnJlbmN5IHJlc29sdXRpb24gY2FuIGZhaWwgZXZlbiBmb3IgdmFsaWQgb3JkZXJzCiAgaWYgKCFoYXNWYWxpZE9yZGVyQW1vdW50cyhhbW91bnRzKSkgewogICAgcmV0dXJuIG51bGwKICB9CgogIHJldHVybiAoCiAgICA8RmxleCByb3cgYWxpZ25JdGVtcz0iY2VudGVyIiBnYXA9IiRnYXA4Ij4KICAgICAgPFNwbGl0TG9nbwogICAgICAgIGNoYWluSWQ9e29yZGVyLmNoYWlnZVVybCwgY2hhaW5JZCwgYWRkcmVzcywgZXZlbnQsIGhpZGVEZWxheSwgZGFwcE5hbWUgfSA9IG5vdGlmaWNhdGlvbgogIGNvbnN0IGRpc3BhdGNoID0gdXNlRGlzcGF0Y2goKQogIGNvbnN0IHZhbGlkQ2hhaW5JZCA9IHRvU3VwcG9ydGVkQ2hhaW5JZChjaGFpbklkKQogIGNvbnN0IHRpdGxlID0gZm9ybVdDTm90aWZpY2F0aW9uVGl0bGUobm90aWZpY2F0aW9uKQoKICBjb25zdCBzbWFsbFRvYXN0RXZlbnRzID0gWwogICAgV2FsbGV0Q29ubmVjdEV2ZW50LkNvbm5lY3RlZCwKICAgIFdhbGxldENvbm5lY3RFdmVudC5EaXNjb25uZWN0ZWQsCiAgICBXYWxsZXRDb25uZWN0RXZlbnQuTmV0d29ya0NoYW5nZWQsCiAgXQogIGNvbnN0IHNtYWxsVG9hc3QgPSBzbWFsbFRvYXN0RXZlbnRzLmluY2x1ZGVzKGV2ZW50KQoKICBjb25zdCBpY29uID0gKAogICAgPERhcHBMb2dvV2l0aFR4U3RhdHVzCiAgICAgIGNoYWluSWQ9e3ZhbGlkQ2hhaW5JZH0KICAgICAgZGFwcEltYWdlVXJsPXtpbWFnZVVybH0KICAgICAgZGFwcE5hbWU9e2RhcHBOYW1lfQogICAgICBldmVudD17ZXZlbnR9CiAgICAgIHNpemU9e3NtYWxsVG9hc3QgPyBpY29uU2l6ZXMuaWNvbjI0IDogTk9USUZJQ0FUSU9OX0lDT05fU0laRX0KICAgIC8+CiAgKQoKICBjb25zdCBvblByZXNzTm90aWZpY2F0aW9uID0gKCk6IHZvaWQgPT4gewogICAgZGlzcGF0Y2goCiAgICAgIG9wZW5Nb2RhbCh7CiAgICAgICAgbmFtZTogTW9kYWxOYW1lLldhbGxldENvbm5lY3RTY2FuLAogICAgICAgIGluaXRpYWxTdGF0ZTogU2Nhbm5lck1vZGFsU3RhdGUuQ29ubmVjdGVkRGFwcHMsCiAgICAgIH0pLAogICAgKQogIH0KCiAgcmV0dXJuICgKICAgIDxOb3RpZmljYXRpb25Ub2FzdAogICAgICBhZGRyZXNzPXthZGRyZXNzfQogICAgICBoaWRlRGVsYXk9e2hpZGVEZWxheX0KICAgICAgaWNvbj17aWNvbn0KICAgICAgc21hbGxUb2FzdD17c21hbGxUb2FzdH0KICAgICAgdGl0bGU9e3RpdGxlfQogICAgICBvblByZXNzPXtvblByZXNzTm90aWZpY2F0aW9ufQogICAgLz4KICApCn0KaW1wb3J0IHsgQVBJX0VUSF9NT0NLX0FERFJFU1MgfSBmcm9tICdAYWF2ZS9jb250cmFjdC1oZWxwZXJzJzsKaW1wb3J0IFJlYWN0IGZyb20gJ3JlYWN0JzsKaW1wb3J0IHsgUmVhY3RFbGVtZW50IH0gZnJvbSAncmVhY3QtbWFya2Rvd24vbGliL3JlYWN0LW1hcmtkb3duJzsKaW1wb3J0IHsKICBDb21wdXRlZFJlc2VydmVEYXRhLAogIENvbXB1dGVkVXNlclJlc2VydmVEYXRhLAogIHVzZUFwcERhdGFDb250ZXh0LAp9IGZyb20gJ3NyYy9ob29rcy9hcHAtZGF0YS1wcm92aWRlci91c2VBcHBEYXRhUHJvdmlkZXInOwppbXBvcnQgeyB1c2VXYWxsZXRCYWxhbmNlcyB9IGZyb20gJ3NyYy9ob29rcy9hcHAtZGF0YS1wcm92aWRlci91c2VXYWxsZXRCYWxhbmNlcyc7CmltcG9ydCB7IEFzc2V0Q2Fwc1Byb3ZpZGVyIH0gZnJvbSAnc3JjL2hvb2tzL3VzZUFzc2V0Q2Fwcyc7CmltcG9ydCB7IHVzZUlzV3JvbmdOZXR3b3JrIH0gZnJvbSAnc3JjL2hvb2tzL3VzZUlzV3JvbmdOZXR3b3JrJzsKaW1wb3J0IHsgdXNlTW9kYWxDb250ZXh0IH0gZnJvbSAnc3JjL2hvb2tzL3VzZU1vZGFsJzsKaW1wb3J0IHsgdXNlV2ViM0NvbnRleHQgfSBmcm9tICdzcmMvbGlicy9ob29rcy91c2VXZWIzQ29udGV4dCc7CmltcG9ydCB7IHVzZVJvb3RTdG9yZSB9IGZyb20gJ3NyYy9zdG9yZS9yb290JzsKaW1wb3J0IHsgR0VORVJBTCB9IGZyb20gJ3NyYy91dGlscy9ldmVudHMnOwppbXBvcnQgeyBnZXROZXR3b3JrQ29uZmlnIH0gZnJvbSAnc3JjL3V0aWxzL21hcmtldHNBbmROZXR3b3Jrc0NvbmZpZyc7CgppbXBvcnQgeyBUeE1vZGFsVGl0bGUgfSBmcm9tICcuLi9GbG93Q29tbW9ucy9UeE1vZGFsVGl0bGUnOwppbXBvcnQgeyBDaGFuZ2VOZXR3b3JrV2FybmluZyB9IGZyb20gJy4uL1dhcm5pbmdzL0NoYW5nZU5ldHdvcmtXYXJuaW5nJzsKaW1wb3J0IHsgVHhFcnJvclZpZXcgZGVEcmF3ZXJXcmFwcGVyID0gc3R5bGVkKEZsZXgsIHsKICByb3c6IHRydWUsCiAgYW5pbWF0aW9uOiAnZmFzdEhlYXZ5JywKICBlbnRlclN0eWxlOiB7IHg6ICcxMDAlJyB9LAogIGV4aXRTdHlsZTogeyB4OiAnMTAwJScgfSwKfSkKCmNvbnN0IFNpZGVEcmF3ZXJDb250YWluZXIgPSBzdHlsZWQoRmxleCwgewogIC4uLnNoYXJlZENvbnRhaW5lclN0eWxlcywKICB3aWR0aDogRFJBV0VSX1NQRUNTLldJRFRIX1hMLAogIG1heFdpZHRoOiBEUkFXRVJfU1BFQ1MuV0lEVEhfWEwsCiAgJHhsOiB7CiAgICB3aWR0aDogRFJBV0VSX1NQRUNTLldJRFRILAogICAgbWF4V2lkdGg6IERSQVdFUl9TUEVDUy5XSURUSCwKICB9LAp9KQoKY29uc3QgQ2xvc2VEcmF3ZXIgPSBzdHlsZWQoRmxleCwgewogIGFuaW1hdGlvbjogJ2Zhc3QnLAogIG9wYWNpdHk6IDAuNiwKICBoZWlnaHQ6ICcxMDAlJywKICBwOiAnJHNwYWNpbmcyNCcsCiAgcGw6ICckc3BhY2luZzEyJywKICBwcjogYGNhbGMoMThweCArICR7RFJBV0VSX1NQRUNTLk9GRlNFVH0pYCwKICBib3JkZXJUb3BMZWZ0UmFkaXVzOiAnJHJvdW5kZWQyMCcsCiAgYm9yZGVyQm90dG9tTGVmdFJhZGl1czogJyRyb3VuZGVkMjAnLAogIGJvcmRlclRvcFJpZ2h0UmFkaXVzOiAnJG5vbmUnLAogIGJvcmRlckJvdHRvbVJpZ2h0UmFkaXVzOiAnJG5vbmUnLAogIGhvdmVyU3R5bGU6IHsKICAgIHg6ICckc3BhY2luZzgnLAogICAgYmFja2dyb3VuZENvbG9yOiAncmdiYSgxNTMsMTYxLDE4OSwwLjA4KScsCiAgfSwKfSkKCmNvbnN0IENoZXZyb25CYWNrZ3JvdW5kID0gc3R5bGVkKEZsZXgsIHsKICBjZW50ZXJlZDogdHJ1ZSwKICB3aWR0aDogJ21heC1jb250ZW50JywKICBhbmltYXRpb246ICdmYXN0SGVhdnknLAogIGVudGVyU3R5bGU6IHsgb3BhY2l0eTogMCB9LAogIGV4aXRTdHlsZTogeyBvcGFjaXR5OiAwIH0sCiAgdmFyaWFudHM6IHsKICAgIGJhY2tncm91bmRGaWxsZWQ6IHsKICAgICAgdHJ1ZTogewogICAgICAgIGJhY2tncm91bmRDb2xvcjogJ3JnYmEoMTI4LDEyOCwxMjgsMC4yKScsCiAgICAgICAgYm9yZGVyUmFkaXVzOiAnJHJvdW5kZWRGdWxsJywKICAgICAgICBwYWRkaW5nOiAnJHNwYWNpbmc0JywKICAgICAgfSwKICAgIH0sCiAgfSwKfSkKCnR5cGUgQWNjb3VudERyYXdlclByb3BzID0gewogIGlzT3BlbjogYm9vbGVhbgogIG9uQ2xvc2U6ICgpID0+IHZvaWQKICBjaGlsZHJlbjogSlNYLkVsZW1lbnQgfCBKU1guRWxlbWVudFtdCn0KCmZ1bmN0aW9uIEFjY291bnREcm9wZG93bih7IGlzT3Blbiwgb25DbG9zZSwgY2hpbGRyZW4gfTogQWNjb3VudERyYXdlclByb3BzKSB7CiAgY29uc3Qgc2hhZG93UHJvcHMgPSB1c2VTaGFkb3dQcm9wc01lZGl1bSgpCiAgY29uc3Qgc2Nyb2xsYmFyU3R5bGVzID0gdXNlU2Nyb2xsYmFyU3R5bGVzKCkKICBjb25zdCBtb2RhbFJlZiA9IHVzZVJlZjxIVE1MRGl2RWxlbWVudD4obnVsbCkKICBjb25zdCBbd2ViM1N0YXR1c1JlZl0gPSB1c2VBdG9tKFdlYjNTdGF0dXNSZWYpCgogIHVzZU9uQ2xpY2tPdXRzaWRlKHsKICAgIG5vZGU6IG1vZGFsUmVmLAogICAgaGFuZGxlcjogb25DbG9zZSwKICAgIC8vIFByZXZlbnRzIHF1aWNrIGNsb3NlICYgcmUtb3BlbiB3aGVuIHRhcHBpbmcgdGhlIFdlYjNTdGF0dXMKICAgIC8vIHN0b3BQcm9wYWdhdGlvbiBkb2VzIG5vdCB3b3JrIGhlcmUKICAgIGlnbm9yZWROb2Rlczogd2ViM1N0YXR1c1JlZiA/IFt3ZWIzU3RhdHVzUmVmXSA6IFtdLAogIH0pCiAgcmV0dXJuICgKICAgIDxBbmltYXRlUHJlc2VuY2U+CiAgICAgIHtpc09wZW4gJiYgKAogICAgICAgIDxEcm9wZG93bkNvbnRhaW5lcgogICAgICAgICAgcmVmPXttb2RhbFJlZn0KICAgICAgICAgIGFuaW1hdGlvbj0iZmFzdEhlYXZ5IgogICAgICAgICAgey4uLnNoYWRvd1Byb3BzfQogICAgICAgICAgc3R5bGU9e3Njcm9sbGJhclN0eWxlc30KICAgICAgICAgICRwbGF0Zm9ybS13ZWI9e3sgb3Zlcm9yOiAidmFyKC0tcHJpbWFyeSkiLAogIH0sCn0gc2F0aXNmaWVzIENoYXJ0Q29uZmlnCgpleHBvcnQgZnVuY3Rpb24gQ2hhcnRBcmVhSW50ZXJhY3RpdmUoKSB7CiAgY29uc3QgaXNNb2JpbGUgPSB1c2VJc01vYmlsZSgpCiAgY29uc3QgW3RpbWVSYW5nZSwgc2V0VGltZVJhbmdlXSA9IFJlYWN0LnVzZVN0YXRlKCI3ZCIpCgogIGNvbnN0IGZpbHRlcmVkRGF0YSA9IGNoYXJ0RGF0YS5maWx0ZXIoKGl0ZW0pID0+IHsKICAgIGNvbnN0IGRhdGUgPSBuZXcgRGF0ZShpdGVtLmRhdGUpCiAgICBjb25zdCByZWZlcmVuY2VEYXRlID0gbmV3IERhdGUoIjIwMjQtMDYtMzAiKQogICAgbGV0IGRheXNUb1N1YnRyYWN0ID0gOTAKICAgIGlmICh0aW1lUmFuZ2UgPT09ICIzMGQiKSB7CiAgICAgIGRheXNUb1N1YnRyYWN0ID0gMzAKICAgIH0gZWxzZSBpZiAodGltZVJhbmdlID09PSAiN2QiKSB7CiAgICAgIGRheXNUb1N1YnRyYWN0ID0gNwogICAgfQogICAgY29uc3Qgc3RhcnREYXRlID0gbmV3IERhdGUocmVmZXJlbmNlRGF0ZSkKICAgIHN0YXJ0RGF0ZS5zZXREYXRlKHN0YXJ0RGF0ZS5nZXREYXRlKCkgLSBkYXlzVG9TdWJ0cmFjdCkKICAgIHJldHVybiBkYXRlID49IHN0YXJ0RGF0ZQogIH0pCgogIHJldHVybiAoCiAgICA8Q2FyZCBjbGFzc05hbWU9IkBjb250YWluZXIvY2FyZCI+CiAgICAgIDxDYXJkSGVhZGVyPgogICAgICAgIDxDYXJkVGl0bGU+VG90YWwgVmlzaXRvcnM8L0NhcmRUaXRsZT4KICAgICAgICA8Q2FyZERlc2NyaXB0aW9uPgogICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSJoaWRkZW4gQFs1NDBweF0vY2FyZDpibG9jayI+CiAgICAgICAgICAgIFRvdGFsIGZvciB0aGUgbGFzdCAzIG1vbnRocwogICAgICAgICAgPC9zcGFuPgogICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSJAWzU0MHB4XS9jYXJkOmhpZGRlbiI+TGFzdCAzIG1vbnRoczwvc3Bhbj4KICAgICAgICA8L0NhcmREZXNjcmlwdGlvbj4KICAgICAgICA8Q2FyZEFjdGlvbj4KICAgICAgICAgIDxUb2dnbGVHcm91cAogICAgICAgICAgICB0eXBlPSJzaW5nbGUiCiAgICAgICAgICAgIHZhbHVlPXt0aW1lUmFuZ2V9CiAgICAgICAgICAgIG9uVmFsdWVDaGFuZ2U9e3NldFRpbWVSYW5nZX0KICAgICAgICAgICAgdmFyaWFudD0ib3V0bGluZSIKICAgICAgICAgICAgY2xhc3NOYW1lPSJoaWRkZW4gKjpkYXRhLVtzbG90PXRvZ2dsZS1ncm91cC1pdGVtXTohcHgtNCBAWzc2N3B4XS9jYXJkOmZsZXgiCiAgICAgICAgICA+CiAgICAgICAgICAgIDxUb2dnbGVHcm91cEl0ZW0gdmFsdWU9IjkwZCI+TGFzdCAzIG1vbnRoczwvVG9nZ2xlR3JvdXBJdGVtPgogICAgICAgICAgICA8VG9nZ2xlR3JvdXBJdGVtIHZhbHVlPSIzMGQiPkxhc3QgMzAgZGF5czwvVG9nZ2xlR3JvdXBJdGVtPgogICAgICAgICAgICA8VG9nZ2xlR3JvdXBJdGVtIHZhbHVlPSI3ZCI+TGFzdCA3IGRheXM8L1RvZ2dsZUdyb3VwSXRlbT4KICAgICAgICAgIDwvVG9nZ2xlR3JvdXA+CiAgICAgICAgICA8U2VsZWN0IHZhbHVlPXt0aW1lUmFuZ2V9IG9uVmFsdWVDaGFuZ2U9e3NldFRpbWVSYW5nZX0+CiAgICAgICAgICAgIDxTZWxlY3RUcmlnZ2VyCiAgICAgICAgICAgICAgY2xhc3NOYW1lPSJmbGV4IHctNDAgKio6ZGF0YS1bc2xvdD1zZWxlY3QtdmFsdWVdOmJsb2NrICoqOmRhdGEtW3Nsb3Q9c2VsZWN0LXZhbHVlXTp0cnVuY2F0ZSBAWzc2N3B4XS9jYXJkOmhpZGRlbiIKICAgICAgICAgICAgICBzaXplPSJzbSIKICAgICAgICAgICAgICBhcmlhLWxhYmVsPSJTZWxlY3QgYSB2YWx1ZSIKICAgICAgICAgICAgPgogICAgICAgICAgICAgIDxTZWxlY3RWYWx1ZSBwbGFjZWhvbGRlcj0iTGFzdCAzIG1vbnRocyIgLz4KICAgICAgICAgICAgPC9TZWxlY3RUcmlnZ2VyPgogICAgICAgICAgICA8U2VsZWN0Q29udGVudCBjbGFzc05hbWU9InJvdW5kZWQteGwiPgogICAgICAgICAgICAgIDxTZWxlY3RJdGVtIHZhbHVlPSI5MGQiIGNsck1vdmU6IGhhbmRsZUNyb3NzaGFpck1vdmUgfSksCiAgICBbZm9ybWF0LCBpc0xhcmdlU2NyZWVuLCBsb2NhbGUsIHBhcmFtcywgY29sb3JzLCBoYW5kbGVDcm9zc2hhaXJNb3ZlXSwKICApCgogIC8vIENyZWF0ZSBhIHN0YWJsZSBrZXkgdGhhdCBjaGFuZ2VzIHdoZW4gY2hhcnQgZGF0YSBjaGFuZ2VzIChlLmcuLCB0aW1lIHBlcmlvZCBjaGFuZ2UpCiAgY29uc3QgZGF0YUtleSA9IHVzZU1lbW8oKCkgPT4gewogICAgaWYgKHBhcmFtcy5kYXRhLmxlbmd0aCA9PT0gMCkgewogICAgICByZXR1cm4gdW5kZWZpbmVkCiAgICB9CiAgICBjb25zdCBsYXN0SXRlbSA9IHBhcmFtcy5kYXRhW3BhcmFtcy5kYXRhLmxlbmd0aCAtIDFdCiAgICByZXR1cm4gSlNPTi5zdHJpbmdpZnkobGFzdEl0ZW0pCiAgfSwgW3BhcmFtcy5kYXRhXSkKCiAgLy8gQ2hhcnQgbW9kZWwgc3RhdGUgc2hvdWxkIG5vdCBhZmZlY3QgUmVhY3QgcmVuZGVyIGN5Y2xlcyBzaW5jZSB0aGUgY2hhcnQgY2FudmFzIGlzIGRyYXduIG91dHNpZGUgb2YgUmVhY3QsIHNvIHdlIHN0b3JlIHZpYSByZWYKICBjb25zdCBjaGFydE1vZGVsUmVmID0gdXNlUmVmPENoYXJ0TW9kZWw8VERhdGFUeXBlPj4odW5kZWZpbmVkKQogIC8vIFRyYWNrIHdoZW4gY2hhcnQgbW9kZWwgaXMgcmVhZHkgdG8gdHJpZ2dlciByZS1yZW5kZXIgZm9yIExpdmVEb3RSZW5kZXJlcgogIGNvbnN0IFtpc0NoYXJ0TW9kZWxSZWFkeSwgc2V0SXNDaGFydE1vZGVsUmVhZHldID0gdXNlU3RhdGUoZmFsc2UpCgogIHVzZUFwcGx5Q2hhcnRUZXh0dXJlRWZmZWN0cyh7IGNoYXJ0RGl2RWxlbWVudCwgc2hvd0RvdHRlZEJhY2tncm91bmQsIHNob3dMZWZ0RmFkZU92ZXJsYXkgfSkKCiAgLy8gQ3JlYXRlcyB0aGUgY2hhcnQgYXMgc29vbiBhcyB0aGUgY2hhcnQgZGl2IHJlZiBpcyBkZWZpbmVkCiAgdXNlRWZmZWN0KCgpID0+IHsKICAgIGlmIChjaGFydERpdkVsZW1lbnQgJiYgY2hhcnRNb2RlbFJlZi5jdXJyZW50ID09PSB1bmRlZmluZWQpIHsKICAgICAgYXNzZXJ0V2ViRWxlbWVudChjaGFydERpdkVsZW1lbnQpCiAgICAgIGNoYXJ0TW9kZWxSZWYuY3VycmVudCA9IG5ldyBNb2RlbChjaGFydERpdkVsZW1lbnQsIG1vZGVsUGFyYW1zKQogICAgICAvLyBQcm92aWRlcnMgdGhlIHRpbWUgcGVyaW9kIHNlbGVjdG9yIHdpdGggYSBoYW5kbGUgdG8gcmVmaXQgdGhlIGNoYXJ0CiAgICAgIHNldFJlZml0Q2hhcnRDb250ZW50KCgpID0+ICgpID0+IGNoYXJ0TW9kZWxSZWYuY3VycmVudD8uZml0Q29udGVudCgpKQogICAgICAvLyBUcmlnZ2VyIHJlLXJlbmRlciBzbyBMaXZlRG90UmVuZGVyZXIgY2FuIGFjY2VzcyB0aGUgY2hhcnQgbW9kZWwKICAgICAgc2V0SXNDaGFydE1vZGVsUmVhZHkodHJ1ZSkKICAgIH0KICB9LCBbTW9kZWwsIGNoYXJ0RGl2RWxlbWVudCwgbW9kZWxQYXJhbXMsIHNldFJlZml0Q2hhcnRDb250ZW50XSkKCiAgLy8gS2VlcHMgdGhlIGNoYXJ0IHVwLXRvLWRhdGUgd2l0aCBsYXRlc3QgZGF0YS9wYXJhbXMsIHdpdGhvdXQgcmUtY3JlYXRpbmcgdGhlIGVudGlyZSBjaGFydAogIHVzZUVmZmVjdCgoKSA9PiB7CiAgICBjaGFydE1vZGVsUmVmLmN1cnJlbnQ/LnVwZGF0ZU9wdGlvbnMobW9kZWxQYXJhbXMpCiAgfSwgW21vZGVsUGFyYW1zXSkKCiAgLy8gSGFuZGxlcyBjaGFydCByZW1vdmFsIG9uIHVubW91bnQKICB1c2VFZmZlY3QoKCkgPT4gewogICAgcmV0dXJuICgpID0+IHsKICAgICAgY2hhcnRNb2RlbFJlZi5jdXJyZW50Py5yZW1vdmUoKQogICAgICAvLyBUaGlzIHJlZidzIHZhbHVlIHdpbGwgcGVyc2lzdCB3aGVuIGJlaW5nIGluaXRpYWxseSByZW1vdW50ZWQgaW4gUmVhY3QuU3RyaWN0TW9kZS4KICAgICAgLy8gVGhlIHBlcnNpc3RlZCBJQ2hhcnRBcGkgd291bGQgZXJyIGlmIHV0aWxpemVkIGFmdGVyIGNhbGxpbmcgcmVtb3ZlKCksIHNvIHdlIG1hbnVhbGx5IGNsZWFyIHRoZSByZWYgaGVyZS4KIGRlOwp9CgovKioKICogQ29udGV4dCBmb3IgZXhwb3NpbmcgcXVlcnkgdXRpbGl0aWVzCiAqLwppbnRlcmZhY2UgUXVlcnlDb250ZXh0VmFsdWUgewogIC8qKiBJbnZhbGlkYXRlIGFsbCBxdWVyaWVzIGFuZCByZWZldGNoICovCiAgaW52YWxpZGF0ZUFsbFF1ZXJpZXM6ICgpID0+IFByb21pc2U8dm9pZD47CiAgLyoqIENsZWFyIHRoZSBwZXJzaXN0ZWQgY2FjaGUgKi8KICBjbGVhckNhY2hlOiAoKSA9PiBQcm9taXNlPHZvaWQ+OwogIC8qKiBDaGVjayBpZiB0aGUgYXBwIGlzIG9ubGluZSAqLwogIGlzT25saW5lOiBib29sZWFuOwp9Cgpjb25zdCBRdWVyeUNvbnRleHQgPSBSZWFjdC5jcmVhdGVDb250ZXh0PFF1ZXJ5Q29udGV4dFZhbHVlIHwgdW5kZWZpbmVkPih1bmRlZmluZWQpOwoKLyoqCiAqIFF1ZXJ5UHJvdmlkZXIgY29tcG9uZW50IHRoYXQgd3JhcHMgdGhlIGFwcCB3aXRoIFJlYWN0IFF1ZXJ5IGZ1bmN0aW9uYWxpdHkKICoKICogRmVhdHVyZXM6CiAqIC0gQXV0b21hdGljIGNhY2hlIHBlcnNpc3RlbmNlIHRvIGRldmljZSBzdG9yYWdlCiAqIC0gT25saW5lL29mZmxpbmUgZGV0ZWN0aW9uCiAqIC0gQ29uZmlndXJhYmxlIGNhY2hlIGR1cmF0aW9ucyB2aWEgZW52aXJvbm1lbnQgdmFyaWFibGVzCiAqLwpleHBvcnQgZnVuY3Rpb24gUXVlcnlQcm92aWRlcih7IGNoaWxkcmVuIH06IFF1ZXJ5UHJvdmlkZXJQcm9wcykgewogIC8vIENyZWF0ZSBRdWVyeUNsaWVudCBpbnN0YW5jZSAoc3RhYmxlIHJlZmVyZW5jZSkKICBjb25zdCBbcXVlcnlDbGllbnRdID0gdXNlU3RhdGUoKCkgPT4gY3JlYXRlUXVlcnlDbGllbnQoKSk7CgogIC8vIENyZWF0ZSBwZXJzaXN0ZXIgaW5zdGFuY2UgKHN0YWJsZSByZWZlcmVuY2UpCiAgY29uc3QgW3BlcnNpc3Rlcl0gPSB1c2VTdGF0ZSgoKSA9PiBjcmVhdGVRdWVyeVBlcnNpc3RlcigpKTsKCiAgLy8gVHJhY2sgb25saW5lIHN0YXR1cwogIGNvbnN0IFtpc09ubGluZSwgc2V0SXNPbmxpbmVdID0gdXNlU3RhdGUodHJ1ZSk7CgogIC8vIFNldHVwIG9ubGluZS9vZmZsaW5lIGRldGVjdGlvbgogIHVzZUVmZmVjdCgoKSA9PiB7CiAgICAvLyBGb3Igd2ViL2V4dGVuc2lvbgogICAgaWYgKFBsYXRmb3JtLk9TID09PSAid2ViIikgewogICAgICBjb25zdCBoYW5kbGVPbmxpbmUgPSAoKSA9PiB7CiAgICAgICAgc2V0SXNPbmxpbmUodHJ1ZSk7CiAgICAgICAgb25saW5lTWFuYWdlci5zZXRPbmxpbmUodHJ1ZSk7CiAgICAgIH07CiAgICAgIGNvbnN0IGhhbmRsZU9mZmxpbmUgPSAoKSA9PiB7CiAgICAgICAgc2V0SXNPbmxpbmUoZmFsc2UpOwogICAgICAgIG9ubGluZU1hbmFnZXIuc2V0T25saW5lKGZhbHNlKTsKICAgICAgfTsKCiAgICAgIHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJvbmxpbmUiLCBoYW5kbGVPbmxpbmUpOwogICAgICB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigib2ZmbGluZSIsIGhhbmRsZU9mZmxpbmUpOwoKICAgICAgLy8gU2V0IGluaXRpYWwgc3RhdGUKICAgICAgc2V0SXNPbmxpbmUobmF2aWdhdG9yLm9uTGluZSk7CiAgICAgIG9ubGluZU1hbmFnZXIuc2V0T25saW5lKG5hdmlnYXRvci5vbkxpbmUpOwoKICAgICAgcmV0dXJuICgpID0+IHsKICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigib25saW5lIiwgaGFuZGxlT25saW5lKTsKICAgICAgICB3aW5kb3cucmVtb3ZlRXZlbnRMaXN0ZW5lcigib2ZmbGluZSIsIGhhbmRsZU9mZmxpbmUpOwogICAgICB9OwogICAgfQoKICAgIC8vIEZvciBSZWFjdCBOYXRpdmUsIHdlIGNvdWxkIHVzZSBOZXRJbmZvIGJ1dCBpdCByZXF1aXJlcyBhZGRpdGlvbmFsIHNldHVwCiAgICAvLyBGb3Igbm93LCBhc3N1bWUgb25saW5lIG9uIG1vYmlsZSAoUmVhY3QgUXVlcnkgaGFuZGxlcyBuZXR3b3JrIGVycm9ycyBncmFjZWZ1bGx5KQogICAgcmV0dXJuIHVuZGVmaW5lZDsKICB9LCBbXSk7CgogIC8vIExpc3RlbiBmb3IgcmVsb2FkIG1lc3NhZ2VzIGZyb20gZXh0ZXQgeyB1aWQgfSA9IHVzZUxvY2FsU2VhcmNoUGFyYW1zPHsgdWlkOiBzdHJpbmcgfT4oKTsKICBjb25zdCByb3V0ZXIgPSB1c2VSb3V0ZXIoKTsKICBjb25zdCBbYm9va2luZywgc2V0Qm9va2luZ10gPSB1c2VTdGF0ZTxCb29raW5nIHwgbnVsbD4obnVsbCk7CiAgY29uc3QgW2lzTG9hZGluZywgc2V0SXNMb2FkaW5nXSA9IHVzZVN0YXRlKHRydWUpOwogIGNvbnN0IFtpc1NhdmluZywgc2V0SXNTYXZpbmddID0gdXNlU3RhdGUoZmFsc2UpOwogIGNvbnN0IGNvbG9yU2NoZW1lID0gdXNlQ29sb3JTY2hlbWUoKTsKICBjb25zdCBpc0RhcmsgPSBjb2xvclNjaGVtZSA9PT0gImRhcmsiOwogIGNvbnN0IHRoZW1lID0gZ2V0Q29sb3JzKGlzRGFyayk7CgogIGNvbnN0IGFkZEd1ZXN0c1NjcmVlblJlZiA9IHVzZVJlZjxBZGRHdWVzdHNTY3JlZW5IYW5kbGU+KG51bGwpOwoKICB1c2VFZmZlY3QoKCkgPT4gewogICAgaWYgKHVpZCkgewogICAgICBzZXRJc0xvYWRpbmcodHJ1ZSk7CiAgICAgIENhbENvbUFQSVNlcnZpY2UuZ2V0Qm9va2luZ0J5VWlkKHVpZCkKICAgICAgICAudGhlbihzZXRCb29raW5nKQogICAgICAgIC5jYXRjaCgoKSA9PiB7CiAgICAgICAgICBzaG93RXJyb3JBbGVydCgiRXJyb3IiLCAiRmFpbGVkIHRvIGxvYWQgYm9va2luZyBkZXRhaWxzIik7CiAgICAgICAgICByb3V0ZXIuYmFjaygpOwogICAgICAgIH0pCiAgICAgICAgLmZpbmFsbHkoKCkgPT4gc2V0SXNMb2FkaW5nKGZhbHNlKSk7CiAgICB9IGVsc2UgewogICAgICBzZXRJc0xvYWRpbmcoZmFsc2UpOwogICAgICBzaG93RXJyb3JBbGVydCgiRXJyb3IiLCAiQm9va2luZyBJRCBpcyBtaXNzaW5nIik7CiAgICAgIHJvdXRlci5iYWNrKCk7CiAgICB9CiAgfSwgW3VpZCwgcm91dGVyXSk7CgogIGNvbnN0IGhhbmRsZVNhdmUgPSB1c2VDYWxsYmFjaygoKSA9PiB7CiAgICBhZGRHdWVzdHNTY3JlZW5SZWYuY3VycmVudD8uc3VibWl0KCk7CiAgfSwgW10pOwoKICBjb25zdCBoYW5kbGVBZGRHdWVzdHNTdWNjZXNzID0gdXNlQ2FsbGJhY2soKCkgPT4gewogICAgcm91dGVyLmJhY2soKTsKICB9LCBbcm91dGVyXSk7CgogIGNvbnN0IHJlbmRlckhlYWRlckxlZnQgPSB1c2VDYWxsYmFjaygKICAgICgpID0+ICgKICAgICAgPEhlYWRlckJ1dHRvbldyYXBwZXIgc2lkZT0ibGVmdCI+CiAgICAgICAgPEFwcFByZXNzYWJsZQogICAgICAgICAgb25QcmVzcz17KCkgPT4gcm91dGVyLmJhY2soKX0KICAgICAgICAgIGNsYXNzTmFtZT0iaC0xMCB3LTEwIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciByb3VuZGVkLWZ1bGwgYm9yZGVyIgogICAgICAgICAgc3R5bGU9e3sKICAgICAgICAgICAgYm9yZGVyQ29sb3I6IHRoZW1lLmJvcmRlciwKICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiB0aGVtZS5iYWNrZ3JvdW5kLAogICAgICAgICAgICBtYXJnaW5SaWdodDogOCwKICAgICAgICAgIH19CiAgICAgICAgPgogICAgICAgICAgPElvbmljb25zIG5hbWU9ImNsb3NlIiBzaXplPXsyMH0gY29sb3I9e3RoZW1lLnRleHR9IC8+CiAgICAgICAgPC9BcHBQcmVzc2FibGU+CiAgICAgIDwvSGVhZGVyQnV0dG9uV3JhcHBlcj4KICAgICksCiAgICBbcm91dGVyLCB0aGVtZS5ib3JkZXIsIHRoZW1lLmJhY2tncm91bmQsIHRoZW1lLnRleHRdCiAgKTsKCiAgY29uc3QgcmVuZGVySGVhZGVyUmlnaHQgPSB1c2VDYWxsYmFjaygKICAgICgpID0+ICgKICAgICAgPEhlYWRlckJ1dHRvbldyYXBwZXIgc2lkZT0icmlnaHQiPgogICAgICAgIDxBcHBQcmVzc2FibGUKICAgICAgICAgIG9uUHJlc3M9e2hhbmRsZVNhdmV9CiAgICAgICAgICBkaXNhYmxlZD17aXNTYXZpbmd9CiAgICAgICAgICBjbGFzc05hbWU9e2BoLTEwIHctMTAgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHJvdW5kZWQtZnVsbCBib3JkZXIgJHsKICAgICAgICAgICAgaXNTYXZpbmcgPyAib3BhY2l0eS01MCIgOiAiIgogICAgICAgICAgfWB9CiByIHBiLTQiPgogICAgICAgIDxDYXJkVGl0bGU+UmFkYXIgQ2hhcnQgLSBDdXN0b20gTGFiZWw8L0NhcmRUaXRsZT4KICAgICAgICA8Q2FyZERlc2NyaXB0aW9uPgogICAgICAgICAgU2hvd2luZyB0b3RhbCB2aXNpdG9ycyBmb3IgdGhlIGxhc3QgNiBtb250aHMKICAgICAgICA8L0NhcmREZXNjcmlwdGlvbj4KICAgICAgPC9DYXJkSGVhZGVyPgogICAgICA8Q2FyZENvbnRlbnQgY2xhc3NOYW1lPSJwYi0wIj4KICAgICAgICA8Q2hhcnRDb250YWluZXIKICAgICAgICAgIGNvbmZpZz17Y2hhcnRDb25maWd9CiAgICAgICAgICBjbGFzc05hbWU9Im14LWF1dG8gYXNwZWN0LXNxdWFyZSBtYXgtaC1bMjUwcHhdIgogICAgICAgID4KICAgICAgICAgIDxSYWRhckNoYXJ0CiAgICAgICAgICAgIGRhdGE9e2NoYXJ0RGF0YX0KICAgICAgICAgICAgbWFyZ2luPXt7CiAgICAgICAgICAgICAgdG9wOiAxMCwKICAgICAgICAgICAgICByaWdodDogMTAsCiAgICAgICAgICAgICAgYm90dG9tOiAxMCwKICAgICAgICAgICAgICBsZWZ0OiAxMCwKICAgICAgICAgICAgfX0KICAgICAgICAgID4KICAgICAgICAgICAgPENoYXJ0VG9vbHRpcAogICAgICAgICAgICAgIGN1cnNvcj17ZmFsc2V9CiAgICAgICAgICAgICAgY29udGVudD17PENoYXJ0VG9vbHRpcENvbnRlbnQgaW5kaWNhdG9yPSJsaW5lIiAvPn0KICAgICAgICAgICAgLz4KICAgICAgICAgICAgPFBvbGFyQW5nbGVBeGlzCiAgICAgICAgICAgICAgZGF0YUtleT0ibW9udGgiCiAgICAgICAgICAgICAgdGljaz17KHsgeCwgeSwgdGV4dEFuY2hvciwgdmFsdWUsIGluZGV4LCAuLi5wcm9wcyB9KSA9PiB7CiAgICAgICAgICAgICAgICBjb25zdCBkYXRhID0gY2hhcnREYXRhW2luZGV4XQoKICAgICAgICAgICAgICAgIHJldHVybiAoCiAgICAgICAgICAgICAgICAgIDx0ZXh0CiAgICAgICAgICAgICAgICAgICAgeD17eH0KICAgICAgICAgICAgICAgICAgICB5PXtpbmRleCA9PT0gMCA/IHkgLSAxMCA6IHl9CiAgICAgICAgICAgICAgICAgICAgdGV4dEFuY2hvcj17dGV4dEFuY2hvcn0KICAgICAgICAgICAgICAgICAgICBmb250U2l6ZT17MTN9CiAgICAgICAgICAgICAgICAgICAgZm9udFdlaWdodD17NTAwfQogICAgICAgICAgICAgICAgICAgIHsuLi5wcm9wc30KICAgICAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgICAgIDx0c3Bhbj57ZGF0YS5kZXNrdG9wfTwvdHNwYW4+CiAgICAgICAgICAgICAgICAgICAgPHRzcGFuIGNsYXNzTmFtZT0iZmlsbC1tdXRlZC1mb3JlZ3JvdW5kIj4vPC90c3Bhbj4KICAgICAgICAgICAgICAgICAgICA8dHNwYW4+e2RhdGEubW9iaWxlfTwvdHNwYW4+CiAgICAgICAgICAgICAgICAgICAgPHRzcGFuCiAgICAgICAgICAgICAgICAgICAgICB4PXt4fQogICAgICAgICAgICAgICAgICAgICAgZHk9eyIxcmVtIn0KICAgICAgICAgICAgICAgICAgICAgIGZvbnRTaXplPXsxMn0KICAgICAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0iZmlsbC1tdXRlZC1mb3JlZ3JvdW5kIgogICAgICAgICAgICAgICAgICAgID4KICAgICAgICAgICAgICAgICAgICAgIHtkYXRhLm1vbnRofQogICAgICAgICAgICAgICAgICAgIDwvdHNwYW4+CiAgICAgICAgICAgICAgICAgIDwvdGV4dD4KICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICB9fQogICAgICAgICAgICAvPgoKICAgICAgICAgICAgPFBvbGFyR3JpZCAvPgogICAgICAgICAgICA8UmFkYXIKICAgICAgICAgICAgICBkYXRhS2V5PSJkZXNrdG9wIgogICAgICAgICAgICAgIGZpbGw9InZhcigtLWNvbG9yLWRlc2t0b3ApIgogICAgICAgICAgICAgIGZpbGxPcGFjaXR5PXswLjZ9CiAgICAgICAgICAgIC8+CiAgICAgICAgICAgIDxSYWRhciBkYXRhS2V5PSJtb2JpbGUiIGZpbGw9InZhcigtLWNvbG9yLW1vYmlsZSkiIC8+CiAgICAgICAgICA8L1JhZGFyYW0gZmxpZ2h0U3RyZWFtIFRoZSBSU0MgcmVuZGVyIHN0cmVhbQogKiBAcGFyYW0gbm9uY2Ugb3B0aW9uYWxseSBhIG5vbmNlIHVzZWQgZHVyaW5nIHRoaXMgcGFydGljdWxhciByZW5kZXIKICogQHBhcmFtIGZvcm1TdGF0ZSBvcHRpb25hbGx5IHRoZSBmb3JtU3RhdGUgdXNlZCB3aXRoIHRoaXMgcGFydGljdWxhciByZW5kZXIKICogQHJldHVybnMgYSBSZWFkYWJsZVN0cmVhbSB3aXRob3V0IHRoZSBjb21wbGV0ZSBwcm9wZXJ0eS4gVGhpcyBzaWduaWZpZXMgYSBsYXp5IFJlYWRhYmxlU3RyZWFtCiAqLwpleHBvcnQgZnVuY3Rpb24gY3JlYXRlSW5saW5lZERhdGFSZWFkYWJsZVN0cmVhbSgKICBmbGlnaHRTdHJlYW06IFJlYWRhYmxlU3RyZWFtPFVpbnQ4QXJyYXk+LAogIG5vbmNlOiBzdHJpbmcgfCB1bmRlZmluZWQsCiAgZm9ybVN0YXRlOiB1bmtub3duIHwgbnVsbAopOiBSZWFkYWJsZVN0cmVhbTxVaW50OEFycmF5PiB7CiAgY29uc3Qgc3RhcnRTY3JpcHRUYWcgPSBub25jZQogICAgPyBgPHNjcmlwdCBub25jZT0ke0pTT04uc3RyaW5naWZ5KG5vbmNlKX0+YAogICAgOiAnPHNjcmlwdD4nCgogIGNvbnN0IGZsaWdodFJlYWRlciA9IGZsaWdodFN0cmVhbS5nZXRSZWFkZXIoKQogIGNvbnN0IGRlY29kZXIgPSBuZXcgVGV4dERlY29kZXIoJ3V0Zi04JywgeyBmYXRhbDogdHJ1ZSB9KQoKICBjb25zdCByZWFkYWJsZSA9IG5ldyBSZWFkYWJsZVN0cmVhbSh7CiAgICB0eXBlOiAnYnl0ZXMnLAogICAgc3RhcnQoY29udHJvbGxlcikgewogICAgICB0cnkgewogICAgICAgIHdyaXRlSW5pdGlhbEluc3RydWN0aW9ucyhjb250cm9sbGVyLCBzdGFydFNjcmlwdFRhZywgZm9ybVN0YXRlKQogICAgICB9IGNhdGNoIChlcnJvcikgewogICAgICAgIC8vIGR1cmluZyBlbmNvZGluZyBvciBlbnF1ZXVlaW5nIGZvcndhcmQgdGhlIGVycm9yIGRvd25zdHJlYW0KICAgICAgICBjb250cm9sbGVyLmVycm9yKGVycm9yKQogICAgICB9CiAgICB9LAogICAgYXN5bmMgcHVsbChjb250cm9sbGVyKSB7CiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgeyBkb25lLCB2YWx1ZSB9ID0gYXdhaXQgZmxpZ2h0UmVhZGVyLnJlYWQoKQoKICAgICAgICBpZiAodmFsdWUpIHsKICAgICAgICAgIHRyeSB7CiAgICAgICAgICAgIGNvbnN0IGRlY29kZWRTdHJpbmcgPSBkZWNvZGVyLmRlY29kZSh2YWx1ZSwgeyBzdHJlYW06ICFkb25lIH0pCgogICAgICAgICAgICAvLyBUaGUgY2h1bmsgY2Fubm90IGJlIGRlY29kZWQgYXMgdmFsaWQgVVRGLTggc3RyaW5nIGFzIGl0IG1pZ2h0CiAgICAgICAgICAgIC8vIGhhdmUgYXJiaXRyYXJ5IGJpbmFyeSBkYXRhLgogICAgICAgICAgICB3cml0ZUZsaWdodERhdGFJbnN0cnVjdGlvbigKICAgICAgICAgICAgICBjb250cm9sbGVyLAogICAgICAgICAgICAgIHN0YXJ0U2NyaXB0VGFnLAogICAgICAgICAgICAgIGRlY29kZWRTdHJpbmcKICAgICAgICAgICAgKQogICAgICAgICAgfSBjYXRjaCB7CiAgICAgICAgICAgIC8vIFRoZSBjaHVuayBjYW5ub3QgYmUgZGVjb2RlZCBhcyB2YWxpZCBVVEYtOCBzdHJpbmcuCiAgICAgICAgICAgIHdyaXRlRmxpZ2h0RGF0YUluc3RydWN0aW9uKGNvbnRyb2xsZXIsIHN0YXJ0U2NyaXB0VGFnLCB2YWx1ZSkKICAgICAgICAgIH0KICAgICAgICB9CgogICAgICAgIGlmIChkb25lKSB7CiAgICAgICAgICBjb250cm9sbGVyLmNsb3NlKCkKICAgICAgICB9CiAgICAgIH0gY2F0Y2ggKGVycm9yKSB7CiAgICAgICAgLy8gVGhlcmUgd2FzIGEgcHJvYmxlbSBpbiB0aGUgdXBzdHJlYW0gcmVhZGVyIG9yIGR1cmluZyBkZWNvZGluZyBvciBlbnF1ZXVpbmcKICAgICAgICAvLyBmb3J3YXJkIHRoZSBlcnJvciBkb3duc3RyZWFtCiAgICAgICAgY29udHJvbGxlci5lcnJvcihlcnJvcikKICAgICAgfQogICAgfSwKICB9KQoKICByZXR1cm4gcmVhZGFibGUKfQoKZnVuY3Rpb24gd3JpdGVJbml0aWFsSW5zdHJ1Y3Rpb25zKAogIGMnLCAyKQoKICByZXR1cm4gKAogICAgLy8gVE9ETzogd2h5IGlzIHRoaXMgY2FsbGVkIGEgdG9hc3QKICAgIDxUb2FzdAogICAgICBpZD0iZGV2dG9vbHMtaW5kaWNhdG9yIgogICAgICBkYXRhLW5leHRqcy10b2FzdAogICAgICBzdHlsZT17CiAgICAgICAgewogICAgICAgICAgJy0tYW5pbWF0ZS1vdXQtZHVyYXRpb24tbXMnOiBgJHtNRU5VX0RVUkFUSU9OX01TfW1zYCwKICAgICAgICAgICctLWFuaW1hdGUtb3V0LXRpbWluZy1mdW5jdGlvbic6IE1FTlVfQ1VSVkUsCiAgICAgICAgICBib3hTaGFkb3c6ICdub25lJywKICAgICAgICAgIFt2ZXJ0aWNhbF06IGAke0lORElDQVRPUl9QQURESU5HfXB4YCwKICAgICAgICAgIFtob3Jpem9udGFsXTogYCR7SU5ESUNBVE9SX1BBRERJTkd9cHhgLAogICAgICAgIH0gYXMgQ1NTUHJvcGVydGllcwogICAgICB9CiAgICA+CiAgICAgIDxEcmFnZ2FibGUKICAgICAgICAvLyBhdm9pZHMgYSBsb3Qgb2Ygd2VpcmQgZWRnZSBjYXNlcyB0aGF0IHdvdWxkIGNhdXNlIGphbmsgaWYgdGhlIGxvZ28gYW5kIHBhbmVsIHdlcmUgZGUtc3luY2VkCiAgICAgICAgZGlzYWJsZURyYWc9e3BhbmVsICE9PSBudWxsfQogICAgICAgIHBhZGRpbmc9e0lORElDQVRPUl9QQURESU5HfQogICAgICAgIHBvc2l0aW9uPXtzdGF0ZS5kZXZUb29sc1Bvc2l0aW9ufQogICAgICAgIHNldFBvc2l0aW9uPXsocCkgPT4gewogICAgICAgICAgZGlzcGF0Y2goewogICAgICAgICAgICB0eXBlOiBBQ1RJT05fREVWVE9PTFNfUE9TSVRJT04sCiAgICAgICAgICAgIGRldlRvb2xzUG9zaXRpb246IHAsCiAgICAgICAgICB9KQogICAgICAgICAgc2F2ZURldlRvb2xzQ29uZmlnKHsgZGV2VG9vbHNQb3NpdGlvbjogcCB9KQoKICAgICAgICAgIHVwZGF0ZUFsbFBhbmVsUG9zaXRpb25zKHApCiAgICAgICAgfX0KICAgICAgPgogICAgICAgIDxOZXh0TG9nbwogICAgICAgICAgb25UcmlnZ2VyQ2xpY2s9eygpID0+IHsKICAgICAgICAgICAgY29uc3QgbmV3UGFuZWwgPQogICAgICAgICAgICAgIHBhbmVsID09PSAncGFuZWwtc2VsZWN0b3InID8gbnVsbCA6ICdwYW5lbC1zZWxlY3RvcicKICAgICAgICAgICAgc2V0UGFuZWwobmV3UGFuZWwpCiAgICAgICAgICAgIGlmICghbmV3UGFuZWwpIHsKICAgICAgICAgICAgICBzZXRTZWxlY3RlZEluZGV4KC0xKQogICAgICAgICAgICAgIHJldHVybgogICAgICAgICAgICB9CiAgICAgICAgICB9fQogICAgICAgIC8+CiAgICAgIDwvRHJhZ2dhYmxlPgogICAgPC9Ub2FzdD4KICApCn0KCi8qKgogKiBtYWtlcyBzdXJlIHdlIGV2ZW50dWFsbHkgc3luYyB0aGUgcGFuZWwgdG8gdGhlIGxvZ28sIG90aGVyd2lzZQogKiBpdCB3aWxsIGJlIGphcnJpbmcgaWYgdGhlIHBhbmVscyBzdGFydCBhcHBlYXJpbmcgb24gdGhlIG90aGVyCiAqIHNpZGUgb2YgdGhlIGxvZ28uIFRoaXMgd29udCB0ZWxlcG9ydCB0aGUgcGFuZWwgYmVjYXVzZSB0aGUgaW5kaWNhdG9yCiAqIGNhbm5vdCBiZSBkcmFnZ2VkIHdoZW4gYW55IHBhbmVsIGlzIG9wZW4KICovCmV4cG9ydCBjb25zdCB1c2VVcGRhdGVBbGxQYW5lbFBvc2l0aW9ucyA9ICgpID0+IHsKICBjb25zdCB7IHN0YXRlLCBkaXNwYXRjaCB9ID0gdXNlRGV2T3ZlcmxheUNvbnRleHQoKQogIHJldHVybiAocG9zaXRpb246IERldlRvb2xzSW5kaWNhdG9yUG9zaXRpb24pID0+IHsKICAgIGRpc3BhdGNoKHsKICAgICAgdHlwZTogQUNUSU9OX0RFVlRPT0xTX1BBTkVMX1BPU0lUSU9OLAogICAgICBkZXZUb29sc1BhbmVsUG9zaXRpb246IHBvc2l0aW9uLAogICAgICBrZXk6IFNUT1JFX0tFWV9TSEFSRURfUEFORUxfTE9DQVRJT04sCiAgICB9KQoKICAgIGNvbnN0IHBhbmVsUG9zaXRpb25LZXlzID0gT2JqZWN0LmtleXMoc3RhdGUuZGV2VG9vbHNQYW5lbFBvc2l0aW9uKS5maWx0ZXIoCiAgICAgIChrZXkpID0+IGtleS5zdGFydHNXaXRoKFNUT1JBR0VfS0VZX1BBTkVMX1BPU0lUSU9OX1BSRUZJWCkKICAgLTA1LTE2IiwgZGVza3RvcDogMzM4LCBtb2JpbGU6IDQwMCB9LAogIHsgZGF0ZTogIjIwMjQtMDUtMTciLCBkZXNrdG9wOiA0OTksIG1vYmlsZTogNDIwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNS0xOCIsIGRlc2t0b3A6IDMxNSwgbW9iaWxlOiAzNTAgfSwKICB7IGRhdGU6ICIyMDI0LTA1LTE5IiwgZGVza3RvcDogMjM1LCBtb2JpbGU6IDE4MCB9LAogIHsgZGF0ZTogIjIwMjQtMDUtMjAiLCBkZXNrdG9wOiAxNzcsIG1vYmlsZTogMjMwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNS0yMSIsIGRlc2t0b3A6IDgyLCBtb2JpbGU6IDE0MCB9LAogIHsgZGF0ZTogIjIwMjQtMDUtMjIiLCBkZXNrdG9wOiA4MSwgbW9iaWxlOiAxMjAgfSwKICB7IGRhdGU6ICIyMDI0LTA1LTIzIiwgZGVza3RvcDogMjUyLCBtb2JpbGU6IDI5MCB9LAogIHsgZGF0ZTogIjIwMjQtMDUtMjQiLCBkZXNrdG9wOiAyOTQsIG1vYmlsZTogMjIwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNS0yNSIsIGRlc2t0b3A6IDIwMSwgbW9iaWxlOiAyNTAgfSwKICB7IGRhdGU6ICIyMDI0LTA1LTI2IiwgZGVza3RvcDogMjEzLCBtb2JpbGU6IDE3MCB9LAogIHsgZGF0ZTogIjIwMjQtMDUtMjciLCBkZXNrdG9wOiA0MjAsIG1vYmlsZTogNDYwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNS0yOCIsIGRlc2t0b3A6IDIzMywgbW9iaWxlOiAxOTAgfSwKICB7IGRhdGU6ICIyMDI0LTA1LTI5IiwgZGVza3RvcDogNzgsIG1vYmlsZTogMTMwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNS0zMCIsIGRlc2t0b3A6IDM0MCwgbW9iaWxlOiAyODAgfSwKICB7IGRhdGU6ICIyMDI0LTA1LTMxIiwgZGVza3RvcDogMTc4LCBtb2JpbGU6IDIzMCB9LAogIHsgZGF0ZTogIjIwMjQtMDYtMDEiLCBkZXNrdG9wOiAxNzgsIG1vYmlsZTogMjAwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNi0wMiIsIGRlc2t0b3A6IDQ3MCwgbW9iaWxlOiA0MTAgfSwKICB7IGRhdGU6ICIyMDI0LTA2LTAzIiwgZGVza3RvcDogMTAzLCBtb2JpbGU6IDE2MCB9LAogIHsgZGF0ZTogIjIwMjQtMDYtMDQiLCBkZXNrdG9wOiA0MzksIG1vYmlsZTogMzgwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNi0wNSIsIGRlc2t0b3A6IDg4LCBtb2JpbGU6IDE0MCB9LAogIHsgZGF0ZTogIjIwMjQtMDYtMDYiLCBkZXNrdG9wOiAyOTQsIG1vYmlsZTogMjUwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNi0wNyIsIGRlc2t0b3A6IDMyMywgbW9iaWxlOiAzNzAgfSwKICB7IGRhdGU6ICIyMDI0LTA2LTA4IiwgZGVza3RvcDogMzg1LCBtb2JpbGU6IDMyMCB9LAogIHsgZGF0ZTogIjIwMjQtMDYtMDkiLCBkZXNrdG9wOiA0MzgsIG1vYmlsZTogNDgwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNi0xMCIsIGRlc2t0b3A6IDE1NSwgbW9iaWxlOiAyMDAgfSwKICB7IGRhdGU6ICIyMDI0LTA2LTExIiwgZGVza3RvcDogOTIsIG1vYmlsZTogMTUwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNi0xMiIsIGRlc2t0b3A6IDQ5MiwgbW9iaWxlOiA0MjAgfSwKICB7IGRhdGU6ICIyMDI0LTA2LTEzIiwgZGVza3RvcDogODEsIG1vYmlsZTogMTMwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNi0xNCIsIGRlc2t0b3A6IDQyNiwgbW9iaWxlOiAzODAgfSwKICB7IGRhdGU6ICIyMDI0LTA2LTE1IiwgZGVza3RvcDogMzA3LCBtb2JpbGU6IDM1MCB9LAogIHsgZGF0ZTogIjIwMjQtMDYtMTYiLCBkZXNrdG9wOiAzNzEsIG1vYmlsZTogMzEwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNi0xNyIsIGRlc2t0b3A6IDQ3NSwgbW9iaWxlOiA1MjAgfSwKICB7IGRhdGU6ICIyMDI0LTA2LTE4IiwgZGVza3RvcDogMTA3LCBtb2JpbGU6IDE3MCB9LAogIHsgZGF0ZTogIjIwMjQtMDYtMTkiLCBkZXNrdG9wOiAzNDEsIG1vYmlsZTogMjkwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNi0yMCIsckRheXMsCiAgICAgICAgZGF0ZVBpY2tlcnNEYXRlczogY2xhc3NOYW1lcz8uZGF0ZVBpY2tlckRhdGUsCiAgICAgICAgZGF0ZVBpY2tlckRhdGVzQWN0aXZlOiBjbGFzc05hbWVzPy5kYXRlUGlja2VyRGF0ZXNBY3RpdmUsCiAgICAgICAgZGF0ZVBpY2tlclRvZ2dsZTogY2xhc3NOYW1lcz8uZGF0ZVBpY2tlclRvZ2dsZSwKICAgICAgfX0KICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzPy5kYXRlUGlja2VyQ29udGFpbmVyfQogICAgICBpc0xvYWRpbmc9e2lzTG9hZGluZ30KICAgICAgb25DaGFuZ2U9eyhkYXRlOiBEYXlqcyB8IG51bGwsIG9taXRVcGRhdGluZ1BhcmFtcz86IGJvb2xlYW4pID0+IHsKICAgICAgICBjb25zdCBuZXdEYXRlID0gZGF0ZSA9PT0gbnVsbCA/IG51bGwgOiBkYXRlLmZvcm1hdCgiWVlZWS1NTS1ERCIpOwogICAgICAgIGNvbnN0IHByZXZpb3VzRGF0ZSA9IHNlbGVjdGVkRGF0ZTsKICAgICAgICBjb25zdCBkYXRlQ2hhbmdlZCA9IG5ld0RhdGUgIT09IHByZXZpb3VzRGF0ZTsKCiAgICAgICAgc2V0U2VsZWN0ZWREYXRlKHsKICAgICAgICAgIGRhdGU6IGRhdGUgPT09IG51bGwgPyBudWxsIDogZGF0ZS5mb3JtYXQoIllZWVktTU0tREQiKSwKICAgICAgICAgIG9taXRVcGRhdGluZ1BhcmFtcywKICAgICAgICAgIHByZXZlbnRNb250aFN3aXRjaGluZzogIWlzQ29tcGFjdCwgLy8gUHJldmVudCBtb250aCBzd2l0Y2hpbmcgd2hlbiBpbiBtb250aGx5IHZpZXcKICAgICAgICB9KTsKCiAgICAgICAgaWYgKGRhdGVDaGFuZ2VkKSB7CiAgICAgICAgICBvbkRhdGVDaGFuZ2U/LigpOwogICAgICAgIH0KICAgICAgfX0KICAgICAgb25Nb250aENoYW5nZT17b25Nb250aENoYW5nZX0KICAgICAgaW5jbHVkZWREYXRlcz17bm9uRW1wdHlTY2hlZHVsZURheXN9CiAgICAgIGxvY2FsZT17aTE4bi5sYW5ndWFnZX0KICAgICAgYnJvd3NpbmdEYXRlPXttb250aCA/IGRheWpzKG1vbnRoKSA6IHVuZGVmaW5lZH0KICAgICAgc2VsZWN0ZWQ9e2RheWpzKHNlbGVjdGVkRGF0ZSl9CiAgICAgIHdlZWtTdGFydD17d2Vla2RheVRvV2Vla0luZGV4KGV2ZW50Py5kYXRhPy5zdWJzZXRPZlVzZXJzPy5bMF0/LndlZWtTdGFydCl9CiAgICAgIHNsb3RzPXtzbG90c30KICAgICAgc2Nyb2xsVG9UaW1lU2xvdHM9e3Njcm9sbFRvVGltZVNsb3RzfQogICAgICBwZXJpb2REYXRhPXtwZXJpb2REYXRhfQogICAgICBpc0NvbXBhY3Q9e2lzQ29tcGFjdH0KICAgICAgc2hvd05vQXZhaWxhYmlsaXR5RGlhbG9nPXtzaG93Tm9BdmFpbGFiaWxpdHlEaWFsb2d9CiAgICAvPgogICk7Cn07CiJ1c2UgY2xpZW50IgoKaW1wb3J0IHsgVHJlbmRpbmdVcCB9IGZyb20gImx1Y2lkZS1yZWFjdCIKaW1wb3J0IHsgUG9sYXJBbmdsZUF4aXMsIFBvbGFyR3JpZCwgUmFkYXIsIFJhZGFyQ2hhcnQgfSBmcm9tICJyZWNoYXJ0cyIKCmltcG9ydCB7CiAgQ2FyZCwKICBDYXJkQ29udGVudCwKICBDYXJkRGVzY3JpcHRpb24sCiAgQ2FyZEZvb3RlciwKICBDYXJkSGVhZGVyLAogIENhcmRUaXRsZSwKfSBmcm9tICJAL3JlZ2lzdHJ5L2RlZmF1bHQvdWkvY2FyZCIKaW1wb3J0IHsKICBDaGFydENvbmZpZywKICBDaGFydENvbnRhaW5lciwKICBDaGFydFRvb2x0aXAsCiAgQ2hhcnRUb29sdGlwQ29udGVudCwKfSBmcm9tICJAL3JlZ2lzdHJ5L2RlZmF1bHQvdWkvY2hhcnQiCgpleHBvcnQgY29uc3QgZGVzY3JpcHRpb24gPSAiQSByYWRhciBjaGFydCB3aXRoIGEgZ3JpZCBmaWxsZWQiCgpjb25zdCBjaGFydERhdGEgPSBbCiAgeyBtb250aDogIkphbnVhcnkiLCBkZXNrdG9wOiAxODYgfSwKICB7IG1vbnRoOiAiRmVicnVhcnkiLCBkZXNrdG9wOiAyODUgfSwKICB7IG1vbnRoOiAiTWFyY2giLCBkZXNrdG9wOiAyMzcgfSwKICB7IG1vbnRoOiAiQXByaWwiLCBkZXNrdG9wOiAyMDMgfSwKICB7IG1vbnRoOiAiTWF5IiwgZGVza3RvcDogMjA5IH0sCiAgeyBtb250aDogIkp1bmUiLCBkZXNrdG9wOiAyNjQgfSwKXXRjb25uZWN0LmRlc2NyaXB0aW9uLmNvbXBhY3QnKSwKICAgICAgICBsYWJlbDogaTE4bi50KCdjb25uZWN0LndhbGxldGNvbm5lY3Qub3Blbi5sYWJlbCcpLAogICAgICAgIG9uQ2xpY2s6ICgpID0+IHsKICAgICAgICAgIG9uQ2xvc2UoKTsKICAgICAgICAgIHNob3dXYWxsZXRDb25uZWN0TW9kYWwoKTsKICAgICAgICB9LAogICAgICB9CiAgICA6IGhhc1FyQ29kZQogICAgICA/IHsKICAgICAgICAgIGRlc2NyaXB0aW9uOiBpMThuLnQoJ2Nvbm5lY3Quc2Vjb25kYXJ5X2FjdGlvbi5nZXQuZGVzY3JpcHRpb24nLCB7CiAgICAgICAgICAgIHdhbGxldDogbmFtZSwKICAgICAgICAgIH0pLAogICAgICAgICAgbGFiZWw6IGkxOG4udCgnY29ubmVjdC5zZWNvbmRhcnlfYWN0aW9uLmdldC5sYWJlbCcpLAogICAgICAgICAgb25DbGljazogKCkgPT4KICAgICAgICAgICAgY2hhbmdlV2FsbGV0U3RlcCgKICAgICAgICAgICAgICBoYXNRckNvZGVBbmRFeHRlbnNpb24gfHwgaGFzUXJDb2RlQW5kRGVza3RvcAogICAgICAgICAgICAgICAgPyBXYWxsZXRTdGVwLkRvd25sb2FkT3B0aW9ucwogICAgICAgICAgICAgICAgOiBXYWxsZXRTdGVwLkRvd25sb2FkLAogICAgICAgICAgICApLAogICAgICAgIH0KICAgICAgOiBudWxsOwoKICBjb25zdCB7IHdpZHRoOiB3aW5kb3dXaWR0aCB9ID0gdXNlV2luZG93U2l6ZSgpOwogIGNvbnN0IHNtYWxsV2luZG93ID0gd2luZG93V2lkdGggJiYgd2luZG93V2lkdGggPCA3Njg7CgogIHVzZUVmZmVjdCgoKSA9PiB7CiAgICAvLyBQcmVsb2FkIGljb24gdXNlZCBvbiBuZXh0IHNjcmVlbgogICAgcHJlbG9hZEJyb3dzZXJJY29uKCk7CiAgICBwcmVsb2FkUGxhdGZvcm1JY29uKCk7CiAgfSwgW10pOwoKICByZXR1cm4gKAogICAgPEJveCBkaXNwbGF5PSJmbGV4IiBmbGV4RGlyZWN0aW9uPSJjb2x1bW4iIGhlaWdodD0iZnVsbCIgd2lkdGg9ImZ1bGwiPgogICAgICB7aGFzUXJDb2RlID8gKAogICAgICAgIDxCb3gKICAgICAgICAgIGFsaWduSXRlbXM9ImNlbnRlciIKICAgICAgICAgIGRpc3BsYXk9ImZsZXgiCiAgICAgICAgICBoZWlnaHQ9ImZ1bGwiCiAgICAgICAgICBqdXN0aWZ5Q29udGVudD0iY2VudGVyIgogICAgICAgID4KICAgICAgICAgIDxRUkNvZGUKICAgICAgICAgICAgbG9nb0JhY2tncm91bmQ9e2ljb25CYWNrZ3JvdW5kfQogICAgICAgICAgICBsb2dvU2l6ZT17Y29tcGFjdE1vZGVFbmFibGVkID8gNjAgOiA3Mn0KICAgICAgICAgICAgbG9nb1VybD17aWNvblVybH0KICAgICAgICAgICAgc2l6ZT17CiAgICAgICAgICAgICAgY29tcGFjdE1vZGVFbmFibGVkCiAgICAgICAgICAgICAgICA/IDMxOAogICAgICAgICAgICAgICAgOiBzbWFsbFdpbmRvdwogICAgICAgICAgICAgICAgICA/IE1hdGgubWF4KDI4MCwgTWF0aC5taW4od2luZG93V2lkdGggLSAzMDgsIDM4MikpCiAgICAgICAgICAgICAgICAgIDogMzgyCiAgICAgICAgICAgIH0KICAgICAgICAgICAgdXJpPXtxckNvZGVVcml9CiAgICAgICAgICAvPgogICAgICAgIDwvQm94PgogICAgICApIDogKAogICAgICAgIDxCb3gKICAgICAgICAgIGFsaWduSXRlbXM9ImNlbnRlciIKICAgICAgICAgIGRpc3BsYXk9ImZsZXgiCiAgICAgICAgICBqdXN0aWZ5Q29udGVudD0iY2VudGVyIgogICAgICAgICAgc3R5bGU9e3sgZmxleEdyb3c6IDEgfX0KICAgICAgICA+CiAgICAgICAgICA8Qm94CiAgICAgICAgICAgIGFsaWduSXRlbXM9ImNlbnRlciIKICAgICAgICAgICAgZGlzcGxheT0iZmxleCIKICAgICAgICAgICAgZmxleERpcmVjdGlvbj0iY29sdW1uIgogICAgICAgICAgICBnYXA9IjgiCiAgICAgICAgICA+CiAgICAgICAgICAgIDxCb3ggYm9yZGVyUmFkaXVzPSIxMCIgaGVpZ2h0PXtMT0dPX1NJWkV9IG92ZXJmbG93PSJoaWRkZW4iPgogICAgICAgICAgICAgIDxBc3luY0ltYWdlCiAgICAgICAgICAgICAgICB1c2VBc0ltYWdlPXshd2FsbGV0LmlzUmFpbmJvd0tpdENvbm4gICAgLgogICAgICA8L3A+CiAgICAgIDxwIGNsYXNzTmFtZT0iZGV2LXRvb2xzLWluZm8tcGFyYWdyYXBoIj4KICAgICAgICBTdGF0aWMgcmVuZGVyaW5nIGlzIHVzZWZ1bCB3aGVuIGEgcm91dGUgaGFzIGRhdGEgdGhhdCBpcyBub3QKICAgICAgICBwZXJzb25hbGl6ZWQgdG8gdGhlIHVzZXIgYW5kIGNhbiBiZSBrbm93biBhdCBidWlsZCB0aW1lLCBzdWNoIGFzIGEKICAgICAgICBzdGF0aWMgYmxvZyBwb3N0IG9yIGEgcHJvZHVjdCBwYWdlLgogICAgICA8L3A+CiAgICA8L2FydGljbGU+CiAgKQp9CgpmdW5jdGlvbiBEeW5hbWljUm91dGVDb250ZW50KHsKICByb3V0ZXJUeXBlLAogIC4uLnByb3BzCn06IHsgcm91dGVyVHlwZTogJ3BhZ2VzJyB8ICdhcHAnIH0gJiBDb21wb25lbnRQcm9wczwnZGl2Jz4pIHsKICByZXR1cm4gKAogICAgPGFydGljbGUgY2xhc3NOYW1lPSJkZXYtdG9vbHMtaW5mby1hcnRpY2xlIiB7Li4ucHJvcHN9PgogICAgICA8cCBjbGFzc05hbWU9ImRldi10b29scy1pbmZvLXBhcmFncmFwaCI+CiAgICAgICAgVGhlIHBhdGh7JyAnfQogICAgICAgIDxjb2RlIGNsYXNzTmFtZT0iZGV2LXRvb2xzLWluZm8tY29kZSI+e3dpbmRvdy5sb2NhdGlvbi5wYXRobmFtZX08L2NvZGU+eycgJ30KICAgICAgICBpcyBtYXJrZWQgYXMgImR5bmFtaWMiIHNpbmNlIGl0IHdpbGwgYmUgcmVuZGVyZWQgZm9yIGVhY2ggdXNlciBhdHsnICd9CiAgICAgICAgPHN0cm9uZz5yZXF1ZXN0IHRpbWU8L3N0cm9uZz4uCiAgICAgIDwvcD4KICAgICAgPHAgY2xhc3NOYW1lPSJkZXYtdG9vbHMtaW5mby1wYXJhZ3JhcGgiPgogICAgICAgIER5bmFtaWMgcmVuZGVyaW5nIGlzIHVzZWZ1bCB3aGVuIGEgcm91dGUgaGFzIGRhdGEgdGhhdCBpcyBwZXJzb25hbGl6ZWQKICAgICAgICB0byB0aGUgdXNlciBvciBoYXMgaW5mb3JtYXRpb24gdGhhdCBjYW4gb25seSBiZSBrbm93biBhdCByZXF1ZXN0IHRpbWUsCiAgICAgICAgc3VjaCBhcyBjb29raWVzIG9yIHRoZSBVUkwncyBzZWFyY2ggcGFyYW1zLgogICAgICA8L3A+CiAgICAgIHtyb3V0ZXJUeXBlID09PSAncGFnZXMnID8gKAogICAgICAgIDxwIGNsYXNzTmFtZT0iZGV2LXRvb2xzLWluZm8tcGFncmFwaCI+CiAgICAgICAgICBFeHBvcnRpbmcgdGhleycgJ30KICAgICAgICAgIDxhCiAgICAgICAgICAgIGNsYXNzTmFtZT0iZGV2LXRvb2xzLWluZm8tbGluayIKICAgICAgICAgICAgaHJlZj0iaHR0cHM6Ly9uZXh0anMub3JnL2RvY3MvcGFnZXMvYnVpbGRpbmcteW91ci1hcHBsaWNhdGlvbi9kYXRhLWZldGNoaW5nL2dldC1zZXJ2ZXItc2lkZS1wcm9wcyIKICAgICAgICAgICAgdGFyZ2V0PSJfYmxhbmsiCiAgICAgICAgICAgIHJlbD0ibm9vcGVuZXIgbm9yZWZlcnJlciIKICAgICAgICAgID4KICAgICAgICAgICAgZ2V0U2VydmVyU2lkZVByb3BzCiAgICAgICAgICA8L2E+eycgJ30KICAgICAgICAgIGZ1bmN0aW9uIHdpbGwgb3B0IHRoZSByb3V0ZSBpbnRvIGR5bmFtaWMgcmVuZGVyaW5nLiBUaGlzIGZ1bmN0aW9uIHdpbGwKICAgICAgICAgIGJlIGNhbGxlZCBieSB0aGUgc2VydmVyIG9uIGV2ZXJ5IHJlcXVlc3QuCiAgICAgICAgPC9wPgogICAgICApIDogKAogICAgICAgIDxwIGNsYXNzTmFtZT0iZGV2LXRvb2xzLWluZm8tcGFyYWdyYXBoIj4KICAgICAgICAgIER1cmluZyByZW5kZXJpbmcsIGlmIGF7JyAnfQogICAgICAgICAgPGEKICAgICAgICAgICAgY2xhc3NOYW1lPSJkZXYtdG9vbHMtaW5mby1saW5rIgogICAgICAgICAgICBocmVmPSJodHRwczovL25leHRqcy5vcmcvZG9jcy9hcHAvYnVpbGRpbmcteW91ci1hcHBsaWNhdGlvbi9yZW5kZXJpbmcvc2VydmVyLWNvbXBvbmVudHMjZHluYW1pYy1hcGlzIgogICAgICAgICAgICB0YXJnZXQ9Il9ibGFuayIKICAgICAgICAgICAgcmVsPSJub29wZW5lciBub3JlZmVycmVyIgogICAgICAgICAgPgogICAgICAgICAgICBEeW5hbWljIEFQSQonMCcsIHN0YWtlRGF0YS5kZWNpbWFscykudG9TdHJpbmcoKSwKICAgIG9uQXBwcm92YWxUeENvbmZpcm1lZDogZmV0Y2hBcHByb3ZlZEFtb3VudCwKICAgIHNpZ25hdHVyZUFtb3VudDogYW1vdW50LAogICAgb25TaWduVHhDb21wbGV0ZWQ6IChzaWduZWRQYXJhbXMpID0+IHNldFNpZ25hdHVyZVBhcmFtcyhzaWduZWRQYXJhbXMpLAogIH0pOwoKICBjb25zdCB7IGN1cnJlbnRBY2NvdW50LCBzZW5kVHggfSA9IHVzZVdlYjNDb250ZXh0KCk7CgogIHVzZUVmZmVjdCgoKSA9PiB7CiAgICBsZXQgc3Rha2VHYXNMaW1pdCA9IE51bWJlcihnYXNMaW1pdFJlY29tbWVuZGF0aW9uc1tQcm90b2NvbEFjdGlvbi51bWJyZWxsYVN0YWtlXS5yZWNvbW1lbmRlZCk7CiAgICBpZiAodXNlUGVybWl0KSB7CiAgICAgIHN0YWtlR2FzTGltaXQgPSBOdW1iZXIoCiAgICAgICAgZ2FzTGltaXRSZWNvbW1lbmRhdGlvbnNbUHJvdG9jb2xBY3Rpb24udW1icmVsbGFTdGFrZVdpdGhQZXJtaXRdLnJlY29tbWVuZGVkCiAgICAgICk7CiAgICB9IGVsc2UgewogICAgICBpZiAocmVxdWlyZXNBcHByb3ZhbCAmJiAhYXBwcm92YWxUeFN0YXRlLnN1Y2Nlc3MpIHsKICAgICAgICBzdGFrZUdhc0xpbWl0ICs9IE51bWJlcihBUFBST1ZBTF9HQVNfTElNSVQpOwogICAgICB9CiAgICB9CiAgICBzZXRHYXNMaW1pdChzdGFrZUdhc0xpbWl0LnRvU3RyaW5nKCkpOwogIH0sIFtyZXF1aXJlc0FwcHJvdmFsLCBhcHByb3ZhbFR4U3RhdGUsIHVzZVBlcm1pdCwgc2V0R2FzTGltaXRdKTsKCiAgY29uc3QgYWN0aW9uID0gYXN5bmMgKCkgPT4gewogICAgY29uc3QgcGFyc2VkQW1vdW50VG9TdGFrZSA9IHBhcnNlVW5pdHMoYW1vdW50LCBzdGFrZURhdGEuZGVjaW1hbHMpLnRvU3RyaW5nKCk7CgogICAgdHJ5IHsKICAgICAgbGV0IHN0YWtlVHhEYXRhOiBQb3B1bGF0ZWRUcmFuc2FjdGlvbjsKCiAgICAgIGlmICh1c2VTdGFrZUdhdGV3YXkpIHsKICAgICAgICBzdGFrZVR4RGF0YSA9IGdldFN0YWtlR2F0ZXdheVR4RGF0YShwYXJzZWRBbW91bnRUb1N0YWtlKTsKICAgICAgfSBlbHNlIHsKICAgICAgICBzdGFrZVR4RGF0YSA9IGdldFN0YWtlVG9rZW5UeERhdGEocGFyc2VkQW1vdW50VG9TdGFrZSk7CiAgICAgIH0KCiAgICAgIHN0YWtlVHhEYXRhID0gYXdhaXQgZXN0aW1hdGVHYXNMaW1pdChzdGFrZVR4RGF0YSk7CiAgICAgIGNvbnN0IHR4ID0gYXdhaXQgc2VuZFR4KHN0YWtlVHhEYXRhKTsKCiAgICAgIGF3YWl0IHR4LndhaXQoMSk7CgogICAgICBzZXRNYWluVHhTdGF0ZSh7CiAgICAgICAgdHhIYXNoOiB0eC5oYXNoLAogICAgICAgIGxvYWRpbmc6IGZhbHNlLAogICAgICAgIHN1Y2Nlc3M6IHRydWUsCiAgICAgIH0pOwoKICAgICAgLy8gdHJhbnNhY3Rpb24gdHJhY2tpbmcgZm9yIHVtYnJlbGxhIHN0YWtpbmcKICAgICAgYWRkVHJhbnNhY3Rpb24odHguaGFzaCwgewogICAgICAgIHR4U3RhdGU6ICdzdWNjZXNzJywKICAgICAgICBhY3Rpb246IFByb3RvY29sQWN0aW9uLnVtYnJlbGxhU3Rha2UsCiAgICAgICAgYW1vdW50OiBhbW91bnRUb1N0YWtlLAogICAgICAgIGFzc2V0TmFtZTogc2VsZWN0ZWRUb2tlbi5zeW1ib2wsCiAgICAgICAgYW1vdW50VXNkOiB2YWx1ZVRvQmlnTnVtYmVyKGFtb3VudFRvU3Rha2UpLm11bHRpcGxpZWRCeShyZXNlcnZlLnByaWNlSW5VU0QpLnRvU3RyaW5nKCksCiAgICAgIH0pOwoKICAgICAgcXVlcnlDbGllbnQuaW52YWxpZGF0ZVF1ZXJpZXMoeyBxdWVyeUtleTogcXVlcnlLZXlzRmFjdG9yeS51bWJyZWxsYSB9KTsKICAgICAgcXVlcnlDbGllbnQuaW52YWxpZGF0ZVF1ZXJpZXMoeyBxdWVyeUtleTogcXVlcnlLZXlzRmFjdG9yeS5wb29sIH0pOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgY29uc3QgcGFyc2VkRXJyb3IgPSBnZXRFcnJvclRleHRGcm9tRXJyb3IoZXJyb3IsIFR4QWN0aW9uLkdBU19FU1RJTUFUSU9OLCBmYWxzZSk7CiAgICAgIHNldFR4RXJyb3IocGFyIHsgQ29weVRvQ2xpcGJvYXJkIH0gZnJvbSAndGhlbWUvY29tcG9uZW50cy9Db3B5SGVscGVyJwppbXBvcnQgeyBGbGV4LCBHZW5lcmF0ZWRJY29uLCBJY29uQnV0dG9uLCBTZXBhcmF0b3IsIFRleHQsIFRvdWNoYWJsZUFyZWEgfSBmcm9tICd1aS9zcmMnCmltcG9ydCB7IENvcHlTaGVldHMgfSBmcm9tICd1aS9zcmMvY29tcG9uZW50cy9pY29ucy9Db3B5U2hlZXRzJwppbXBvcnQgeyBRckNvZGUgfSBmcm9tICd1aS9zcmMvY29tcG9uZW50cy9pY29ucy9RckNvZGUnCmltcG9ydCB7IHVzZVVuaXRhZ3NBZGRyZXNzUXVlcnkgfSBmcm9tICd1bmlzd2FwL3NyYy9kYXRhL2FwaUNsaWVudHMvdW5pdGFnc0FwaS91c2VVbml0YWdzQWRkcmVzc1F1ZXJ5JwppbXBvcnQgeyB1c2VFTlNOYW1lIH0gZnJvbSAndW5pc3dhcC9zcmMvZmVhdHVyZXMvZW5zL2FwaScKaW1wb3J0IHsgRk9SU2VydmljZVByb3ZpZGVyIH0gZnJvbSAndW5pc3dhcC9zcmMvZmVhdHVyZXMvZmlhdE9uUmFtcC90eXBlcycKaW1wb3J0IHsgdXNlQ2V4VHJhbnNmZXJQcm92aWRlcnMgfSBmcm9tICd1bmlzd2FwL3NyYy9mZWF0dXJlcy9maWF0T25SYW1wL3VzZUNleFRyYW5zZmVyUHJvdmlkZXJzJwoKZnVuY3Rpb24gQWN0aW9uSWNvbih7IEljb24gfTogeyBJY29uOiBHZW5lcmF0ZWRJY29uIH0pIHsKICByZXR1cm4gPEljb25CdXR0b24gZW1waGFzaXM9InNlY29uZGFyeSIgc2l6ZT0ieHhzbWFsbCIgaWNvbj17PEljb24gLz59IC8+Cn0KCmZ1bmN0aW9uIEFjY291bnRDYXJkSXRlbSh7IGFkZHJlc3MgfTogeyBhZGRyZXNzOiBBZGRyZXNzIH0pOiBKU1guRWxlbWVudCB7CiAgY29uc3QgeyBkYXRhOiB1bml0YWcgfSA9IHVzZVVuaXRhZ3NBZGRyZXNzUXVlcnkoewogICAgcGFyYW1zOiBhZGRyZXNzID8geyBhZGRyZXNzIH0gOiB1bmRlZmluZWQsCiAgfSkKICBjb25zdCB7IGRhdGE6IEVOU05hbWUgfSA9IHVzZUVOU05hbWUoYWRkcmVzcykKCiAgY29uc3Qgb25QcmVzc1Nob3dXYWxsZXRRciA9IHVzZU9wZW5SZWNlaXZlQ3J5cHRvTW9kYWwoewogICAgbW9kYWxTdGF0ZTogUmVjZWl2ZU1vZGFsU3RhdGUuUVJfQ09ERSwKICAgIHFyQ29kZUFkZHJlc3M6IGFkZHJlc3MsCiAgfSkKCiAgcmV0dXJuICgKICAgIDxGbGV4IHJvdyBhbGlnbkl0ZW1zPSJmbGV4LXN0YXJ0IiBnYXA9IiRzcGFjaW5nMTIiPgogICAgICA8RmxleAogICAgICAgIGZpbGwKICAgICAgICByb3cKICAgICAgICBib3JkZXJDb2xvcj0iJHN1cmZhY2UzIgogICAgICAgIGJvcmRlclJhZGl1cz0iJHJvdW5kZWQyMCIKICAgICAgICBib3JkZXJXaWR0aD0iJHNwYWNpbmcxIgogICAgICAgIGdhcD0iJHNwYWNpbmcxMiIKICAgICAgICBwPSIkc3BhY2luZzEyIgogICAgICA+CiAgICAgICAgPEZsZXggZmlsbD4KICAgICAgICAgIDxBY2NvdW50T3B0aW9uIGFjY291bnQ9e2FkZHJlc3N9IGVuc1VzZXJuYW1lPXtFTlNOYW1lfSB1bmlzd2FwVXNlcm5hbWU9e3VuaXRhZz8udXNlcm5hbWV9IC8+CiAgICAgICAgPC9GbGV4PgogICAgICAgIDxGbGV4IGNlbnRlcmVkIHJvdyBnYXA9IiRzcGFjaW5nMTIiIHB4PSIkc3BhY2luZzgiPgogICAgICAgICAgPENvcHlUb0NsaXBib2FyZCB0b0NvcHk9e2FkZHJlc3N9PgogICAgICAgICAgICA8QWN0aW9uSWNvbiBJY29uPXtDb3B5U2hlZXRzfSAvPgogICAgICAgICAgPC9Db3B5VG9DbGlwYm9hcmQ+CiAgICAgICAgICA8VG91Y2hhYmxlQXJlYSBvblByZXNzPXtvblByZXNzU2hvd1dhbGxldFFyfT4KICAgICAgICAgICAgPEFjdGlvbkljb24gSWNvbj17UXJDb2RlfSAvPgogICAgICAgICAgPC9Ub3VjaGFibGVBcmVhPgogICAgICAgIDwvRmxleD4KICAgICAgPC9GbGV4PgogICAgPC9GbGV4PgogICkKfQoKdHlwZSBDaG9vc2VQcm92aWRlclByb3BzID0gewogIHByb3ZpZGVyc09ubHk/OiBib29sZWFuCiAgZXJyb3JQcm92aWRlcj86IEZPUlNlcnZpY2VQcm92aWRlcgogIGNvbm5lY3RlZFByb3YsCiAgaW5pdGlhbERhdGEsCiAgaXNNdWx0aUNhbGVuZGFyID0gZmFsc2UsCiAgdG9vbHRpcCwKICB0b29sdGlwU2lkZSA9ICJib3R0b20iLAogIGlzQ2xpY2thYmxlLAogIG9uU3VjY2VzcywKICBpc0RyeVJ1biA9IGZhbHNlLAp9KSA9PiB7CiAgY29uc3QgeyB0IH0gPSB1c2VMb2NhbGUoKTsKICBjb25zdCBmb3JtID0gdXNlRm9ybSh7CiAgICBkZWZhdWx0VmFsdWVzOiB7CiAgICAgIHVzZXJuYW1lOiAiIiwKICAgICAgcGFzc3dvcmQ6ICIiLAogICAgfSwKICB9KTsKICBjb25zdCB7IHRvYXN0IH0gPSB1c2VUb2FzdCgpOwogIGNvbnN0IHsgYWxsb3dDb25uZWN0LCBjaGVja2VkLCByZWZldGNoIH0gPSB1c2VDaGVjayh7CiAgICBjYWxlbmRhcjogImFwcGxlIiwKICAgIGluaXRpYWxEYXRhLAogIH0pOwoKICBjb25zdCBbaXNEaWFsb2dPcGVuLCBzZXRJc0RpYWxvZ09wZW5dID0gdXNlU3RhdGUoZmFsc2UpOwogIGxldCBkaXNwbGF5ZWRMYWJlbCA9IGxhYmVsIHx8IHQoImFwcGxlX2Nvbm5lY3RfYXRvbV9sYWJlbCIpOwoKICBjb25zdCB7IG11dGF0ZTogc2F2ZUNyZWRlbnRpYWxzLCBpc1BlbmRpbmc6IGlzU2F2aW5nIH0gPSB1c2VTYXZlQ2FsZW5kYXJDcmVkZW50aWFscyh7CiAgICBvblN1Y2Nlc3M6IChyZXMpID0+IHsKICAgICAgaWYgKHJlcy5zdGF0dXMgPT09IFNVQ0NFU1NfU1RBVFVTKSB7CiAgICAgICAgZm9ybS5yZXNldCgpOwogICAgICAgIHNldElzRGlhbG9nT3BlbihmYWxzZSk7CiAgICAgICAgcmVmZXRjaCgpOwogICAgICAgIHRvYXN0KHsKICAgICAgICAgIGRlc2NyaXB0aW9uOiAiQ2FsZW5kYXIgY3JlZGVudGlhbHMgYWRkZWQgc3VjY2Vzc2Z1bGx5IiwKICAgICAgICB9KTsKICAgICAgICBvblN1Y2Nlc3M/LigpOwogICAgICB9CiAgICB9LAogICAgb25FcnJvcjogKGVycikgPT4gewogICAgICB0b2FzdCh7CiAgICAgICAgZGVzY3JpcHRpb246IGBFcnJvcjogJHtlcnJ9YCwKICAgICAgfSk7CiAgICB9LAogIH0pOwoKICBjb25zdCBpc0NoZWNraW5nID0gIWNoZWNrZWQ7CiAgY29uc3QgaXNEaXNhYmxlZCA9IGlzQ2hlY2tpbmcgfHwgIWFsbG93Q29ubmVjdDsKCiAgaWYgKGlzQ2hlY2tpbmcpIHsKICAgIGRpc3BsYXllZExhYmVsID0gbG9hZGluZ0xhYmVsIHx8IHQoImFwcGxlX2Nvbm5lY3RfYXRvbV9sb2FkaW5nX2xhYmVsIik7CiAgfSBlbHNlIGlmICghYWxsb3dDb25uZWN0KSB7CiAgICBkaXNwbGF5ZWRMYWJlbCA9IGFscmVhZHlDb25uZWN0ZWRMYWJlbCB8fCB0KCJhcHBsZV9jb25uZWN0X2F0b21fYWxyZWFkeV9jb25uZWN0ZWRfbGFiZWwiKTsKICB9CgogIHJldHVybiAoCiAgICA8QXRvbXNXcmFwcGVyPgogICAgICA8RGlhbG9nIG9wZW49e2lzRGlhbG9nT3Blbn0gb25PcGVuQ2hhbmdlPXtzZXRJc0RpYWxvZ09wZW59PgogICAgICAgIDxEaWFsb2dUcmlnZ2VyIGFzQ2hpbGQ+CiAgICAgICAgICA8PgogICAgICAgICAgICB7aXNNdWx0aUNhbGVuZGFyICYmICgKICAgICAgICAgICAgICA8QnV0dG9uCiAgICAgICAgICAgICAgICBTdGFydEljb249ImNhbGVuZGFyLWRheXMiCiAgICAgICAgICAgICAgICBjb2xvcj0icHJpbWFyeSIKICAgICAgICAgICAgICAgIGRpc2FibGVkPXtpc0NsaWNrYWJsZSA/IGZhbHNlIDogaXNDaGVja2luZ30KICAgICAgICAgICAgICAgIHRvb2x0aXA9e3Rvb2x0aXAgPyB0b29sdGlwIDogPENvbm5lY3RlZENhbGVuZGFyc1Rvb2x0aXAgY2FsZW5kYXJJbnN0YW5jZT0iYXBwbGUiIC8+fQogICAgICAgICAgICAgICAgdG9vbHRpcFNpZGU9e3Rvb2x0aXBTaWRlfQogICAgICAgICAgICAgICAgdG9vbHRpcE9mZnNldD17MTB9CiAgICAgICAgICAgICAgICB0b29sdGlwQ2xhc3NOYW1lPSJwLTAgdGV4dC1pbmhlcml0IGJnLWluaGVyaXQiCiAgICAgICAgICAgICAgICBjbGFzc05hbWU9e2NuKCIiLCAhaXNEaXNhYmxlZCAmJiAiY3Vyc29yLXBvaW50ZXIiLCAiYm9yZGVyLW5vbmUgbWQ6cm91bmRlZC1tZCIsIGN1cm4gY2hhcnREYXRhLnJlZHVjZSgoYWNjLCBjdXJyKSA9PiBhY2MgKyBjdXJyLnZpc2l0b3JzLCAwKQogIH0sIFtdKQoKICByZXR1cm4gKAogICAgPENhcmQgY2xhc3NOYW1lPSJmbGV4IGZsZXgtY29sIj4KICAgICAgPENhcmRIZWFkZXIgY2xhc3NOYW1lPSJpdGVtcy1jZW50ZXIgcGItMCI+CiAgICAgICAgPENhcmRUaXRsZT5QaWUgQ2hhcnQgLSBEb251dCB3aXRoIFRleHQ8L0NhcmRUaXRsZT4KICAgICAgICA8Q2FyZERlc2NyaXB0aW9uPkphbnVhcnkgLSBKdW5lIDIwMjQ8L0NhcmREZXNjcmlwdGlvbj4KICAgICAgPC9DYXJkSGVhZGVyPgogICAgICA8Q2FyZENvbnRlbnQgY2xhc3NOYW1lPSJmbGV4LTEgcGItMCI+CiAgICAgICAgPENoYXJ0Q29udGFpbmVyCiAgICAgICAgICBjb25maWc9e2NoYXJ0Q29uZmlnfQogICAgICAgICAgY2xhc3NOYW1lPSJteC1hdXRvIGFzcGVjdC1zcXVhcmUgbWF4LWgtWzI1MHB4XSIKICAgICAgICA+CiAgICAgICAgICA8UGllQ2hhcnQ+CiAgICAgICAgICAgIDxDaGFydFRvb2x0aXAKICAgICAgICAgICAgICBjdXJzb3I9e2ZhbHNlfQogICAgICAgICAgICAgIGNvbnRlbnQ9ezxDaGFydFRvb2x0aXBDb250ZW50IGhpZGVMYWJlbCAvPn0KICAgICAgICAgICAgLz4KICAgICAgICAgICAgPFBpZQogICAgICAgICAgICAgIGRhdGE9e2NoYXJ0RGF0YX0KICAgICAgICAgICAgICBkYXRhS2V5PSJ2aXNpdG9ycyIKICAgICAgICAgICAgICBuYW1lS2V5PSJicm93c2VyIgogICAgICAgICAgICAgIGlubmVyUmFkaXVzPXs2MH0KICAgICAgICAgICAgICBzdHJva2VXaWR0aD17NX0KICAgICAgICAgICAgPgogICAgICAgICAgICAgIDxMYWJlbAogICAgICAgICAgICAgICAgY29udGVudD17KHsgdmlld0JveCB9KSA9PiB7CiAgICAgICAgICAgICAgICAgIGlmICh2aWV3Qm94ICYmICJjeCIgaW4gdmlld0JveCAmJiAiY3kiIGluIHZpZXdCb3gpIHsKICAgICAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICAgICAgPHRleHQKICAgICAgICAgICAgICAgICAgICAgICAgeD17dmlld0JveC5jeH0KICAgICAgICAgICAgICAgICAgICAgICAgeT17dmlld0JveC5jeX0KICAgICAgICAgICAgICAgICAgICAgICAgdGV4dEFuY2hvcj0ibWlkZGxlIgogICAgICAgICAgICAgICAgICAgICAgICBkb21pbmFudEJhc2VsaW5lPSJtaWRkbGUiCiAgICAgICAgICAgICAgICAgICAgICA+CiAgICAgICAgICAgICAgICAgICAgICAgIDx0c3BhbgogICAgICAgICAgICAgICAgICAgICAgICAgIHg9e3ZpZXdCb3guY3h9CiAgICAgICAgICAgICAgICAgICAgICAgICAgeT17dmlld0JveC5jeX0KICAgICAgICAgICAgICAgICAgICAgICAgICBjbGFzc05hbWU9ImZpbGwtZm9yZWdyb3VuZCB0ZXh0LTN4bCBmb250LWJvbGQiCiAgICAgICAgICAgICAgICAgICAgICAgID4KICAgICAgICAgICAgICAgICAgICAgICAgICB7dG90YWxWaXNpdG9ycy50b0xvY2FsZVN0cmluZygpfQogICAgICAgICAgICAgICAgICAgICAgICA8L3RzcGFuPgogICAgICAgICAgICAgICAgICAgICAgICA8dHNwYW4KICAgICAgICAgICAgICAgICAgICAgICAgICB4PXt2aWV3Qm94LmN4fQogICAgICAgICAgICAgICAgICAgICAgICAgIHk9eyh2aWV3Qm94LmN5IHx8IDApICsgMjR9CiAgICAgICAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPSJmaWxsLW11dGVkLWZvcmVncm91bmQiCiAgICAgICAgICAgICAgICAgICAgICAgID4KICAgICAgICAgICAgICAgICAgICAgICAgICBWaXNpdG9ycwogICAgICAgICAgICAgICAgICAgICAgICA8L3RzcGFuPgogICAgICAgICAgICAgICAgICAgICAgPC90ZXh0PgogICAgICAgICAgICAgICAgICAgICkKICAgICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgICAgfX0KICAgICAgICAgICAgICAvPgogICAgICAgICAgICA8L1BpZT4KICAgICAgICAgIDwvUGllQ2hhZ2UgPQogICAgICAgICAgICBkdXBsaWNhdGVFcnJvciBpbnN0YW5jZW9mIEVycm9yID8gZHVwbGljYXRlRXJyb3IubWVzc2FnZSA6IFN0cmluZyhkdXBsaWNhdGVFcnJvcik7CiAgICAgICAgICBjb25zb2xlLmVycm9yKCJGYWlsZWQgdG8gZHVwbGljYXRlIGV2ZW50IHR5cGUiLCBtZXNzYWdlKTsKICAgICAgICAgIGlmIChfX0RFVl9fKSB7CiAgICAgICAgICAgIGNvbnN0IHN0YWNrID0gZHVwbGljYXRlRXJyb3IgaW5zdGFuY2VvZiBFcnJvciA/IGR1cGxpY2F0ZUVycm9yLnN0YWNrIDogdW5kZWZpbmVkOwogICAgICAgICAgICBjb25zb2xlLmRlYnVnKCJbRXZlbnRUeXBlc10gZHVwbGljYXRlRXZlbnRUeXBlIGZhaWxlZCIsIHsKICAgICAgICAgICAgICBtZXNzYWdlLAogICAgICAgICAgICAgIHN0YWNrLAogICAgICAgICAgICB9KTsKICAgICAgICAgIH0KICAgICAgICAgIHNob3dFcnJvckFsZXJ0KCJFcnJvciIsICJGYWlsZWQgdG8gZHVwbGljYXRlIGV2ZW50IHR5cGUuIFBsZWFzZSB0cnkgYWdhaW4uIik7CiAgICAgICAgfSwKICAgICAgfQogICAgKTsKICB9OwoKICBjb25zdCBoYW5kbGVQcmV2aWV3ID0gYXN5bmMgKGV2ZW50VHlwZTogRXZlbnRUeXBlKSA9PiB7CiAgICBpZiAoIWV2ZW50VHlwZS5ib29raW5nVXJsKSB7CiAgICAgIHNob3dFcnJvckFsZXJ0KCJFcnJvciIsICJCb29raW5nIFVSTCBub3QgYXZhaWxhYmxlIGZvciB0aGlzIGV2ZW50IHR5cGUuIik7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHRyeSB7CiAgICAgIGF3YWl0IG9wZW5JbkFwcEJyb3dzZXIoZXZlbnRUeXBlLmJvb2tpbmdVcmwsICJldmVudCB0eXBlIHByZXZpZXciKTsKICAgIH0gY2F0Y2ggewogICAgICBjb25zb2xlLmVycm9yKCJGYWlsZWQgdG8gb3BlbiBwcmV2aWV3Iik7CiAgICAgIHNob3dFcnJvckFsZXJ0KCJFcnJvciIsICJGYWlsZWQgdG8gb3BlbiBwcmV2aWV3LiBQbGVhc2UgdHJ5IGFnYWluLiIpOwogICAgfQogIH07CgogIGNvbnN0IGhhbmRsZU9wZW5DcmVhdGVNb2RhbCA9ICgpID0+IHsKICAgIEhhcHRpY3MuaW1wYWN0QXN5bmMoSGFwdGljcy5JbXBhY3RGZWVkYmFja1N0eWxlLkxpZ2h0KTsKICAgIC8vIFVzZSBuYXRpdmUgaU9TIEFsZXJ0LnByb21wdCBmb3IgYSBuYXRpdmUgbG9vawogICAgQWxlcnQucHJvbXB0KAogICAgICAiQWRkIGEgbmV3IGV2ZW50IHR5cGUiLAogICAgICAiU2V0IHVwIGV2ZW50IHR5cGVzIHRvIG9mZmVyIGRpZmZlcmVudCB0eXBlcyBvZiBtZWV0aW5ncy4iLAogICAgICBbCiAgICAgICAgeyB0ZXh0OiAiQ2FuY2VsIiwgc3R5bGU6ICJjYW5jZWwiIH0sCiAgICAgICAgewogICAgICAgICAgdGV4dDogIkNvbnRpbnVlIiwKICAgICAgICAgIG9uUHJlc3M6ICh0aXRsZT86IHN0cmluZykgPT4gewogICAgICAgICAgICBpZiAoIXRpdGxlPy50cmltKCkpIHsKICAgICAgICAgICAgICBzaG93RXJyb3JBbGVydCgiRXJyb3IiLCAiUGxlYXNlIGVudGVyIGEgdGl0bGUgZm9yIHlvdXIgZXZlbnQgdHlwZSIpOwogICAgICAgICAgICAgIHJldHVybjsKICAgICAgICAgICAgfQoKICAgICAgICAgICAgY29uc3QgYXV0b1NsdWcgPSBzbHVnaWZ5KHRpdGxlLnRyaW0oKSk7CiAgICAgICAgICAgIGlmICghYXV0b1NsdWcpIHsKICAgICAgICAgICAgICBzaG93RXJyb3JBbGVydCgiRXJyb3IiLCAiVGl0bGUgbXVzdCBjb250YWluIGF0IGxlYXN0IG9uZSBsZXR0ZXIgb3IgbnVtYmVyIik7CiAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICB9CgogICAgICAgICAgICBjcmVhdGVFdmVudFR5cGVNdXRhdGlvbigKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICB0aXRsZTogdGl0bGUudHJpbSgpLAogICAgICAgICAgICAgICAgc2x1ZzogYXV0b1NsdWcsCiAgICAgICAgICAgICAgICBsZW5ndGhJbk1pbnV0ZXM6IDE1LCAvLyBEZWZhdWx0IGR1cmF0aW9uCiAgICAgICAgICAgICAgICBkZXNjcmlwdGlvbjogdW5kZWZpbmVkLCAvLyBFbXB0eSBkZXNjPyB0KCJ5b3VyX3BheW1lbnRfZmFpbGVkIikKICAgICAgICAgICAgICA6IGlzUHJlbWl1bVVzZXJuYW1lCiAgICAgICAgICAgICAgPyB0KCJwYXltZW50X3N1Y2Nlc3NmdWwiKQogICAgICAgICAgICAgIDogdCgiY2hlY2tfeW91cl9pbmJveCIpfQogICAgICAgICAgPC9oMz4KICAgICAgICAgIHtoYXNQYXltZW50RmFpbGVkICYmIDxwIGNsYXNzTmFtZT0ibXktNiI+e3QoImFjY291bnRfY3JlYXRlZF9wcmVtaXVtX25vdF9yZXNlcnZlZCIpfTwvcD59CiAgICAgICAgICA8cCBjbGFzc05hbWU9InRleHQtbXV0ZWQgZGFyazp0ZXh0LXN1YnRsZSB0ZXh0LWJhc2UgZm9udC1ub3JtYWwiPgogICAgICAgICAgICB7dCgiZW1haWxfc2VudF93aXRoX2FjdGl2YXRpb25fbGluayIsIHsgZW1haWwgfSl9eyIgIn0KICAgICAgICAgICAge2hhc1BheW1lbnRGYWlsZWQgJiYgdCgiYWN0aXZhdGVfYWNjb3VudF90b19wdXJjaGFzZV91c2VybmFtZSIpfQogICAgICAgICAgPC9wPgogICAgICAgICAgPGRpdiBjbGFzc05hbWU9Im10LTciPgogICAgICAgICAgICA8QnV0dG9uCiAgICAgICAgICAgICAgY29sb3I9InNlY29uZGFyeSIKICAgICAgICAgICAgICBocmVmPXsKICAgICAgICAgICAgICAgIEVNQUlMX0ZST00KICAgICAgICAgICAgICAgICAgPyBlbmNvZGVVUklDb21wb25lbnQoYGh0dHBzOi8vbWFpbC5nb29nbGUuY29tL21haWwvdS8wLyNzZWFyY2gvZnJvbToke0VNQUlMX0ZST019YCkKICAgICAgICAgICAgICAgICAgOiAiaHR0cHM6Ly9tYWlsLmdvb2dsZS5jb20vbWFpbC91LzAvIgogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICB0YXJnZXQ9Il9ibGFuayIKICAgICAgICAgICAgICBFbmRJY29uPSJleHRlcm5hbC1saW5rIj4KICAgICAgICAgICAgICB7dCgib3Blbl9pbl9nbWFpbCIpfQogICAgICAgICAgICA8L0J1dHRvbj4KICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+CiAgICAgICAgICA8cCBjbGFzc05hbWU9InRleHQtc3VidGxlIHRleHQtYmFzZSBmb250LW5vcm1hbCAiPnt0KCJkb250X3NlZV9lbWFpbCIpfTwvcD4KICAgICAgICAgIDxidXR0b24KICAgICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzKAogICAgICAgICAgICAgICJmb250LWxpZ2h0IiwKICAgICAgICAgICAgICBzZWNvbmRzTGVmdCA+IDAgPyAidGV4dC1tdXRlZCIgOiAidW5kZXJsaW5lIHVuZGVybGluZS1vZmZzZXQtMiBob3Zlcjpmb250LW5vcm1hbCIKICAgICAgICAgICAgKX0KICAgICAgICAgICAgZGlzYWJsZWQ9e3NlY29uZHNMZWZ0ID4gMH0KICAgICAgICAgICAgb25DbGljaz17YXN5bmMgKGUpID0+IHsKICAgICAgICAgICAgICBpZiAoIWVtYWlsIHx8ICF1c2VybmFtZSkgewogICAgICAgICAgICAgICAgcmV0dXJuOwogICAgICAgICAgICAgIH0KICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgc2V0U2Vjb25kc0xlZnQoMzApOwogICAgICAgICAgICAgIC8vIFVwZGF0ZSBxdWVyeSBwYXJhbXMgd2l0aCB0OnRpbWVzdGFtcCwgc2hhbGxvdzogdHJ1ZSBkb2Vzbid0IHJlLXJlbmRlciB0aGUgcGFnZQogICAgICAgICAgICAgIGNvbnN0IF9zZWFyY2hQYXJhbXMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHNlYXJjaFBhcmFtcz8udG9TdHJpbmcoKSk7CiAgICAgICAgICAgICAgX3NlYXJjaFBhcmFtcy5zZXQoInQiLCBgJHtEYXRlLm5vdygpfWApOwogICAgICAgICAgICAgIHJvdXRlci5yZXBsYWNlKGAke3BhdGhuYW1lfT8ke19zZWFyY2hQYXJhbXMudG9TdHJpbmcoKX1gKTsKICAgICAgICAgICAgICByZXR1cm4gYXdhaXQgc2VuZFZlcmlmaWNhdGlvbkxvZ2luKGVtYWlsLCB1c2VybmFtZSwgdCk7CiAgICAgICAgICAgIH19PgogICAgICAgICAgICB7c2Vjb25kc0xlZnQgPiAwID8gdCgicmVzZW5kX2luX3NlY29uZHMiLCB7IHNlY29uZHM6IHNlYwogIG9uVW5oYW5kbGVkUmVqZWN0aW9uKHJlYXNvbjogRXJyb3IpOiB2b2lkCiAgb3BlbkVycm9yT3ZlcmxheSgpOiB2b2lkCiAgY2xvc2VFcnJvck92ZXJsYXkoKTogdm9pZAogIHRvZ2dsZUVycm9yT3ZlcmxheSgpOiB2b2lkCiAgYnVpbGRpbmdJbmRpY2F0b3JIaWRlKCk6IHZvaWQKICBidWlsZGluZ0luZGljYXRvclNob3coKTogdm9pZAogIHJlbmRlcmluZ0luZGljYXRvckhpZGUoKTogdm9pZAogIHJlbmRlcmluZ0luZGljYXRvclNob3coKTogdm9pZAogIHNlZ21lbnRFeHBsb3Jlck5vZGVBZGQobm9kZVN0YXRlOiBTZWdtZW50Tm9kZVN0YXRlKTogdm9pZAogIHNlZ21lbnRFeHBsb3Jlck5vZGVSZW1vdmUobm9kZVN0YXRlOiBTZWdtZW50Tm9kZVN0YXRlKTogdm9pZAogIHNlZ21lbnRFeHBsb3JlclVwZGF0ZVJvdXRlU3RhdGUocGFnZTogc3RyaW5nKTogdm9pZAp9Cgp0eXBlIERpc3BhdGNoID0gUmV0dXJuVHlwZTx0eXBlb2YgdXNlRXJyb3JPdmVybGF5UmVkdWNlcj5bMV0KbGV0IG1heWJlRGlzcGF0Y2g6IERpc3BhdGNoIHwgbnVsbCA9IG51bGwKY29uc3QgcXVldWU6IEFycmF5PChkaXNwYXRjaDogRGlzcGF0Y2gpID0+IHZvaWQ+ID0gW10KCi8vIEdsb2JhbCBzdGF0ZSBzdG9yZSBmb3IgYWNjZXNzaW5nIGN1cnJlbnQgb3ZlcmxheSBzdGF0ZSBmcm9tIG91dHNpZGUgUmVhY3QgY29udGV4dAp0eXBlIE92ZXJsYXlTdGF0ZVdpdGhSb3V0ZXIgPSBPdmVybGF5U3RhdGUgJiB7IHJvdXRlclR5cGU6ICdwYWdlcycgfCAnYXBwJyB9CgpsZXQgY3VycmVudE92ZXJsYXlTdGF0ZTogT3ZlcmxheVN0YXRlV2l0aFJvdXRlciB8IG51bGwgPSBudWxsCgpleHBvcnQgZnVuY3Rpb24gZ2V0U2VyaWFsaXplZE92ZXJsYXlTdGF0ZSgpOiBPdmVybGF5U3RhdGVXaXRoUm91dGVyIHwgbnVsbCB7CiAgLy8gU2VyaWFsaXplIGVycm9yIG9iamVjdHMgcHJvcGVybHkgc2luY2UgRXJyb3IgcHJvcGVydGllcyBhcmUgbm9uLWVudW1lcmFibGUKICAvLyBUaGlzIGlzIHVzZWQgd2hlbiBzZW5kaW5nIHN0YXRlIHZpYSBITVIvSlNPTi5zdHJpbmdpZnkKICBpZiAoIWN1cnJlbnRPdmVybGF5U3RhdGUpIHJldHVybiBudWxsCgogIHJldHVybiB7CiAgICAuLi5jdXJyZW50T3ZlcmxheVN0YXRlLAogICAgZXJyb3JzOiBjdXJyZW50T3ZlcmxheVN0YXRlLmVycm9ycy5tYXAoKGVycm9yRXZlbnQ6IGFueSkgPT4gKHsKICAgICAgLi4uZXJyb3JFdmVudCwKICAgICAgZXJyb3I6IGVycm9yRXZlbnQuZXJyb3IKICAgICAgICA/IHsKICAgICAgICAgICAgbmFtZTogZXJyb3JFdmVudC5lcnJvci5uYW1lLAogICAgICAgICAgICBtZXNzYWdlOiBlcnJvckV2ZW50LmVycm9yLm1lc3NhZ2UsCiAgICAgICAgICAgIHN0YWNrOiBlcnJvckV2ZW50LmVycm9yLnN0YWNrLAogICAgICAgICAgfQogICAgICAgIDogbnVsbCwKICAgIH0pKSwKICB9Cn0KCmV4cG9ydCBmdW5jdGlvbiBnZXRTZWdtZW50VHJpZURhdGEoKTogU2VnbWVudFRyaWVEYXRhIHwgbnVsbCB7CiAgaWYgKCFjdXJyZW50T3ZlcmxheVN0YXRlKSB7CiAgICByZXR1cm4gbnVsbAogIH0KICBjb25zdCB0cmllUm9vdCA9IGdldFNlZ21lbnRUcmllUm9vdCgpCiAgcmV0dXJuIHsKICAgIHNlZ21lbnRUcmllOiB0cmllUm9vdCwKICAgIHJvdXRlclR5cGU6IGN1cnJlbnRPdmVybGF5U3RhdGUucm91dGVyVHlwZSwKICB9Cn0KCi8vIEV2ZW50cyBtaWdodCBiZSBkaXNwYXRjaGVkIGJlZm9yZSB3ZSBnZXQgYSBgZGlzcGF0Y2hgIGZyb20gUmVhY3QgKGUuZy4gY29uc29sZS5lcnJvciBkdXJpbmcgbW9kdWxlIGV2YWwpLgovLyBXZSBuZWVkIHRvIHF1ZXVlIHRoZW0gdW50aWwgd2UgaGF2ZSBhIGBkaXNwYXRjaGAgZnVuY3Rpb24gYXZhaWxhYmxlLgpmdW5jdGlvbiBjcmVhdGVRdWV1YWJsZTxBcmdzIGV4dGVuZHMgYW55W10+KAogIHF1ZXVlYWJsZUZ1bmN0aW9uOiAoZGlzcGF0Y2g6IERpc3BhdGNoLCAuLi5hcmdzOiBBcmdzKSA9PiB2b2lkCikgewogPFBhZ2luYXRpb25OZXh0IGhyZWY9IiMiIC8+CiAgICAgICAgICAgIDwvUGFnaW5hdGlvbkl0ZW0+CiAgICAgICAgICA8L1BhZ2luYXRpb25Db250ZW50PgogICAgICAgIDwvUGFnaW5hdGlvbj4KICAgICAgPC9kaXY+CiAgICA8L2Rpdj4KICApCn0KaW1wb3J0IHsKICBBQ1RJT05fQkVGT1JFX1JFRlJFU0gsCiAgQUNUSU9OX0JVSUxEX0VSUk9SLAogIEFDVElPTl9CVUlMRF9PSywKICBBQ1RJT05fREVCVUdfSU5GTywKICBBQ1RJT05fREVWX0lORElDQVRPUiwKICBBQ1RJT05fUkVGUkVTSCwKICBBQ1RJT05fRVJST1JfT1ZFUkxBWV9DTE9TRSwKICBBQ1RJT05fRVJST1JfT1ZFUkxBWV9PUEVOLAogIEFDVElPTl9FUlJPUl9PVkVSTEFZX1RPR0dMRSwKICBBQ1RJT05fU1RBVElDX0lORElDQVRPUiwKICBBQ1RJT05fVU5IQU5ETEVEX0VSUk9SLAogIEFDVElPTl9VTkhBTkRMRURfUkVKRUNUSU9OLAogIEFDVElPTl9WRVJTSU9OX0lORk8sCiAgdXNlRXJyb3JPdmVybGF5UmVkdWNlciwKICBBQ1RJT05fQlVJTERJTkdfSU5ESUNBVE9SX0hJREUsCiAgQUNUSU9OX0JVSUxESU5HX0lORElDQVRPUl9TSE9XLAogIEFDVElPTl9SRU5ERVJJTkdfSU5ESUNBVE9SX0hJREUsCiAgQUNUSU9OX1JFTkRFUklOR19JTkRJQ0FUT1JfU0hPVywKICBBQ1RJT05fREVWVE9PTF9VUERBVEVfUk9VVEVfU1RBVEUsCiAgQUNUSU9OX0RFVlRPT0xTX0NPTkZJRywKICB0eXBlIE92ZXJsYXlTdGF0ZSwKICB0eXBlIERpc3BhdGNoZXJFdmVudCwKICBBQ1RJT05fQ0FDSEVfSU5ESUNBVE9SLAp9IGZyb20gJy4vZGV2LW92ZXJsYXkvc2hhcmVkJwoKaW1wb3J0IHsKICBjcmVhdGVDb250ZXh0LAogIHN0YXJ0VHJhbnNpdGlvbiwKICB1c2VDb250ZXh0LAogIHVzZUVmZmVjdCwKICB1c2VJbnNlcnRpb25FZmZlY3QsCiAgdXNlTGF5b3V0RWZmZWN0LAogIHR5cGUgQWN0aW9uRGlzcGF0Y2gsCn0gZnJvbSAncmVhY3QnCmltcG9ydCB7IGNyZWF0ZVJvb3QgfSBmcm9tICdyZWFjdC1kb20vY2xpZW50JwppbXBvcnQgdHlwZSB7IENhY2hlSW5kaWNhdG9yU3RhdGUgfSBmcm9tICcuL2Rldi1vdmVybGF5L2NhY2hlLWluZGljYXRvcicKaW1wb3J0IHsgRm9udFN0eWxlcyB9IGZyb20gJy4vZGV2LW92ZXJsYXkvZm9udC9mb250LXN0eWxlcycKaW1wb3J0IHR5cGUgeyBIeWRyYXRpb25FcnJvclN0YXRlIH0gZnJvbSAnLi9zaGFyZWQvaHlkcmF0aW9uLWVycm9yJwppbXBvcnQgdHlwZSB7IERlYnVnSW5mbyB9IGZyb20gJy4vc2hhcmVkL3R5cGVzJwppbXBvcnQgeyBEZXZPdmVybGF5IH0gZnJvbSAnLi9kZXYtb3ZlcmxheS9kZXYtb3ZlcmxheScKaW1wb3J0IHR5cGUgeyBEZXZJbmRpY2F0b3JTZXJ2ZXJTdGF0ZSB9IGZyb20gJy4uL3NlcnZlci9kZXYvZGV2LWluZGljYXRvci1zZXJ2ZXItc3RhdGUnCmltcG9ydCB0eXBlIHsgVmVyc2lvbkluZm8gfSBmcm9tICcuLi9zZXJ2ZXIvZGV2L3BhcnNlLXZlcnNpb24taW5mbycKaW1wb3J0IHsKICBpbnNlcnRTZWdtZW50Tm9kZSwKICByZW1vdmVTZWdtZW50Tm9kZSwKICBnZXRTZWdtZW50VHJpZVJvb3QsCn0gZnJvbSAnLi9kZXYtb3ZlcmxheS9zZWdtZW50LWV4cGxvcmVyLXRyaWUnCmltcG9ydCB0eXBlIHsgU2VnbWVudE5vZGVTdGF0ZSB9IGZyb20gJy4vdXNlcnNwYWNlL2FwcC9zZWdtZW50LWV4cGxvcmVyLW5vZGUnCmltcG9ydCB0eXBlIHsgRGV2VG9vbHNDb25maWcgfSBmcm9tICcuL2Rldi1vdmVybGF5L3NoYXJlZCcKaW1wb3J0IHR5cGUgeyBTZWdtZW50VHJpZURhdGEgfSBmcm9tICcuLi9zaGFyZWQvbGliL21jcC1wYWdlLW1ldGFkYXRhLXR5cGVzJwoKZXhwb3J0IGludGVyZmFjZSBEaXNwYXRjaGVyIHsKICBvbkJ1aWxkT2soKTogdm9pZAogIG9uQnVpbGRFcnJvcihtZXNzYWdlOiBzdHJpbmcpOiB2b2lkCiAgb25WZXJzaW9uSW5mbyh2ZXJzaW9uSW5mbzogVmVyc2lvbkluZm8pOiB2b2lkCiAgb25EZWJ1Z0luZm8oZGVidWdJbmZvOiBEZWJ1Z0luZm8pZ2dsZSBmcm9tICdzcmMvYXBwL2ZlYXR1cmVzL3NldHRpbmdzL1RoZW1lVG9nZ2xlJwppbXBvcnQgeyBBcHBSb3V0ZXMsIFNldHRpbmdzUm91dGVzIH0gZnJvbSAnc3JjL2FwcC9uYXZpZ2F0aW9uL2NvbnN0YW50cycKaW1wb3J0IHsgdXNlRXh0ZW5zaW9uTmF2aWdhdGlvbiB9IGZyb20gJ3NyYy9hcHAvbmF2aWdhdGlvbi91dGlscycKaW1wb3J0IHsgZ2V0SXNEZWZhdWx0UHJvdmlkZXJGcm9tU3RvcmFnZSwgc2V0SXNEZWZhdWx0UHJvdmlkZXJUb1N0b3JhZ2UgfSBmcm9tICdzcmMvYXBwL3V0aWxzL3Byb3ZpZGVyJwppbXBvcnQgeyBCdXR0b24sIEZsZXgsIFNjcm9sbFZpZXcsIFRleHQgfSBmcm9tICd1aS9zcmMnCmltcG9ydCB7CiAgQXJyb3dVcFJpZ2h0LAogIENoYXJ0LAogIENvaW5zLAogIEZpbGVMaXN0TG9jaywKICBHbG9iYWwsCiAgSGVscENlbnRlciwKICBMYW5ndWFnZSwKICBMaW5lQ2hhcnREb3RzLAogIExvY2ssCiAgUGFzc2tleSwKICBTZXR0aW5ncywKICBTbGlkZXJzLAogIFdyZW5jaCwKfSBmcm9tICd1aS9zcmMvY29tcG9uZW50cy9pY29ucycKaW1wb3J0IHsgdW5pc3dhcFVybHMgfSBmcm9tICd1bmlzd2FwL3NyYy9jb25zdGFudHMvdXJscycKaW1wb3J0IHsgcmVzZXRVbmlzd2FwQmVoYXZpb3JIaXN0b3J5IH0gZnJvbSAndW5pc3dhcC9zcmMvZmVhdHVyZXMvYmVoYXZpb3JIaXN0b3J5L3NsaWNlJwppbXBvcnQgeyB1c2VFbmFibGVkQ2hhaW5zIH0gZnJvbSAndW5pc3dhcC9zcmMvZmVhdHVyZXMvY2hhaW5zL2hvb2tzL3VzZUVuYWJsZWRDaGFpbnMnCmltcG9ydCB7IEZpYXRDdXJyZW5jeSwgT1JERVJFRF9DVVJSRU5DSUVTIH0gZnJvbSAndW5pc3dhcC9zcmMvZmVhdHVyZXMvZmlhdEN1cnJlbmN5L2NvbnN0YW50cycKaW1wb3J0IHsgZ2V0RmlhdEN1cnJlbmN5TmFtZSwgdXNlQXBwRmlhdEN1cnJlbmN5SW5mbyB9IGZyb20gJ3VuaXN3YXAvc3JjL2ZlYXR1cmVzL2ZpYXRDdXJyZW5jeS9ob29rcycKaW1wb3J0IHsgdXNlQ3VycmVudExhbmd1YWdlSW5mbyB9IGZyb20gJ3VuaXN3YXAvc3JjL2ZlYXR1cmVzL2xhbmd1YWdlL2hvb2tzJwppbXBvcnQgeyBQYXNza2V5TWFuYWdlbWVudE1vZGFsIH0gZnJvbSAndW5pc3dhcC9zcmMvZmVhdHVyZXMvcGFzc2tleS9QYXNza2V5TWFuYWdlbWVudE1vZGFsJwppbXBvcnQgeyBzZXRDdXJyZW50RmlhdEN1cnJlbmN5LCBzZXRJc1Rlc3RuZXRNb2RlRW5hYmxlZCB9IGZyb20gJ3VuaXN3YXAvc3JjL2ZlYXR1cmVzL3NldHRpbmdzL3NsaWNlJwppbXBvcnQgeyBXYWxsZXRFdmVudE5hbWUgfSBmcm9tICd1bmlzd2FwL3NyYy9mZWF0dXJlcy90ZWxlbWV0cnkvY29uc3RhbnRzJwppbXBvcnQgeyBzZW5kQW5hbHl0aWNzRXZlbnQgfSBmcm9tICd1bmlzd2FwL3NyYy9mZWF0dXJlcy90ZWxlbWV0cnkvc2VuZCcKaW1wb3J0IFRyYWNlIGZyb20gJ3VuaXN3YXAvc3JjL2ZlYXR1cmVzL3RlbGVtZXRyeS9UcmFjZScKaW1wb3J0IHsgQ29ubmVjdGlvbkNhcmRMb2dnaW5nTmFtZSB9IGZyb20gJ3VuaXN3YXAvc3JjL2ZlYXR1cmVzL3RlbGVtZXRyeS90eXBlcycKaW1wb3J0IHsgVGVzdG5ldE1vZGVNb2RhbCB9IGZyb20gJ3VuaXN3YXAvc3JjL2ZlYXR1cmVzL3Rlc3RuZXRzL1Rlc3RuZXRNb2RlTW9kYWwnCmltcG9ydCB7IEV4dGVuc2lvblNjcmVlbnMgfSBmcm9tICd1bmlzd2FwL3NyYy90eXBlcy9zY3JlZW5zL2V4dGVuc2lvbicKaW1wb3J0IHsgaXNEZXZFbnYgfSBmcm9tICd1dGlsaXRpZXMvc3JjL2Vudmlyb25tZW50L2VudicKaW1wb3J0IHsgbG9nZ2VyIH0gZnJvbSAndXRpbGl0aWVzL3NyYy9sb2dnZXIvbG9nZ2VyJwppbXBvcnQgeyBub29wIH0gZnJvbSAndXRpbGl0aWVzL3NyYy9yZWFjdC9ub29wJwppbXBvcnQgeyBDYXJkVHlwZSwgSW50cm9DYXJkLCBJbnRyb0NhcmRHcmFwaGljVHlwZSB9IGZyb20gJ3dhbGxldC9zcmMvY29tcG9uZW50cy9pbnRyb0NhcmRzL0ludHJvQ2FyZCcKaW1wb3J0IHsgU2V0dGluZ3NMYW5ndXQgYW55IGZpbGVzIHVuZGVyIGl0LAogICAgICAgIC8vIG1lcmdlIGl0IHdpdGggdGhlIHNlZ21lbnQgaW4gdGhlIG5leHQgbGV2ZWwuCiAgICAgICAgY29uc3QgbmV4dFNlZ21lbnQgPSBoYXNGaWxlc0NoaWxkcmVuCiAgICAgICAgICA/IGNoaWxkU2VnbWVudAogICAgICAgICAgOiBzZWdtZW50ICsgJyAvICcgKyBjaGlsZFNlZ21lbnQKICAgICAgICByZXR1cm4gKAogICAgICAgICAgPFBhZ2VTZWdtZW50VHJlZUxheWVyUHJlc2VudGF0aW9uCiAgICAgICAgICAgIGtleT17Y2hpbGRTZWdtZW50fQogICAgICAgICAgICBzZWdtZW50PXtuZXh0U2VnbWVudH0KICAgICAgICAgICAgbm9kZT17Y2hpbGR9CiAgICAgICAgICAgIGxldmVsPXtoYXNGaWxlc0NoaWxkcmVuID8gbGV2ZWwgKyAxIDogbGV2ZWx9CiAgICAgICAgICAvPgogICAgICAgICkKICAgICAgfSl9CiAgICA8Lz4KICApCn0KCmZ1bmN0aW9uIG9wZW5JbkVkaXRvcih7IGZpbGVQYXRoIH06IHsgZmlsZVBhdGg6IHN0cmluZyB9KSB7CiAgY29uc3QgcGFyYW1zID0gbmV3IFVSTFNlYXJjaFBhcmFtcyh7CiAgICBmaWxlOiBmaWxlUGF0aCwKICAgIC8vIE1hcmsgdGhlIGZpbGUgcGF0aCBpcyByZWxhdGl2ZSB0byB0aGUgYXBwIGRpcmVjdG9yeSwKICAgIC8vIFRoZSBlZGl0b3IgbGF1bmNoZXIgd2lsbCBjb21wbGV0ZSB0aGUgZnVsbCBwYXRoIGZvciBpdC4KICAgIGlzQXBwUmVsYXRpdmVQYXRoOiAnMScsCiAgfSkKICBmZXRjaCgKICAgIGAkewogICAgICBwcm9jZXNzLmVudi5fX05FWFRfUk9VVEVSX0JBU0VQQVRIIHx8ICcnCiAgICB9L19fbmV4dGpzX2xhdW5jaC1lZGl0b3I/JHtwYXJhbXMudG9TdHJpbmcoKX1gCiAgKQp9CgpleHBvcnQgZnVuY3Rpb24gSW5mb0ljb24ocHJvcHM6IFJlYWN0LlNWR1Byb3BzPFNWR1NWR0VsZW1lbnQ+KSB7CiAgcmV0dXJuICgKICAgIDxzdmcKICAgICAgd2lkdGg9IjE2IgogICAgICBoZWlnaHQ9IjE2IgogICAgICB2aWV3Qm94PSIwIDAgMTYgMTYiCiAgICAgIGZpbGw9Im5vbmUiCiAgICAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgICAgey4uLnByb3BzfQogICAgPgogICAgICA8cGF0aAogICAgICAgIGQ9Ik0xNCA4QzE0IDExLjMxMzcgMTEuMzEzNyAxNCA4IDE0QzQuNjg2MjkgMTQgMiAxMS4zMTM3IDIgOEMyIDQuNjg2MjkgNC42ODYyOSAyIDggMkMxMS4zMTM3IDIgMTQgNC42ODYyOSAxNCA4WiIKICAgICAgICBmaWxsPSJ2YXIoLS1jb2xvci1ncmF5LTQwMCkiCiAgICAgIC8+CiAgICAgIDxwYXRoCiAgICAgICAgZD0iTTcuNzUgN0M4LjMwMjI4IDcuMDAwMDEgOC43NSA3LjQ0NzcyIDguNzUgOFYxMS4yNUg3LjI1VjguNUg2LjI1VjdINy43NVpNOCA0QzguNTUyMjggNCA5IDQuNDQ3NzIgOSA1QzkgNS41NTIyOCA4LjU1MjI4IDYgOCA2QzcuNDQ3NzIgNiA3IDUuNTUyMjggNyA1QzcgNC40NDc3MiA3LjQ0NzcyIDQgOCA0WiIKICAgICAgICBmaWxsPSJ2YXIoLS1jb2xvci1ncmF5LTkwMCkiCiAgICAgIC8+CiAgICA8L3N2Zz4KICApCn0KCmZ1bmN0aW9uIEJhY2tBcnJvd0ljb24oKSB7CiAgcmV0dXJuICgKICAgIDxzdmcKICAgICAgd2lkdGg9IjIwIgogICAgICBoZWlnaHQ9IjIwIgogICAgICB2aWV3Qm94PSIwIDAgMjAgMjAiCiAgICAgIGZpbGw9InZhcigtLWNvbG9yLWdyYXktNjAwKSIKICAgICAgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIgogICAgPgogICAgICA8cGF0aCBkPSJNNC41IDExLjI1QzQuNSAxMS4zODgxIDQuNjExOTMgMTEuNSA0Ljc1IDExLjVIMTQuNDM5NUwxMS45Mzk1IDlMMTMgNy45Mzk0NUwxNi43ODAzIDExLjcxOTdMMTYuODMyIDExLjc3NjRDMTcuMDcyMyAxMi4wNzA5IDE3LjA1NDkgMTIuNTA1NyAxNi43ODAzIDEyLjc4MDNMMTMgMTYuNTYwNUwxMS45Mzk1IDE1LjVMMTQuNDM5NSAxM0g0Ljc1QzMuNzgzNSAxMyAzIDEyLjIxNjUgMyAxMS4yNVY0LjI1SDQuNVYxMS4yNVoiIC8+Cm5kYXJ5J30KICAgICAgICA+CiAgICAgICAgICAlCiAgICAgICAgPC9UeXBvZ3JhcGh5PgogICAgICApfQogICAgICB7c3ltYm9sPy50b0xvd2VyQ2FzZSgpICE9PSAndXNkJyAmJiB0eXBlb2Ygc3ltYm9sICE9PSAndW5kZWZpbmVkJyAmJiAoCiAgICAgICAgPFR5cG9ncmFwaHkKICAgICAgICAgIGNvbXBvbmVudD0ic3BhbiIKICAgICAgICAgIHN4PXt7IG1sOiAwLjUgfX0KICAgICAgICAgIHZhcmlhbnQ9e3N5bWJvbHNWYXJpYW50IHx8IHJlc3QudmFyaWFudH0KICAgICAgICAgIGNvbG9yPXtzeW1ib2xzQ29sb3IgfHwgJ3RleHQuc2Vjb25kYXJ5J30KICAgICAgICA+CiAgICAgICAgICB7c3ltYm9sfQogICAgICAgIDwvVHlwb2dyYXBoeT4KICAgICAgKX0KICAgIDwvVHlwb2dyYXBoeT4KICApOwp9CmltcG9ydCB0eXBlIHsgU2VhcmNoUGFyYW1zIH0gZnJvbSAiYXBwL190eXBlcyI7CmltcG9ydCB0eXBlIHsgU2Vzc2lvbiB9IGZyb20gIm5leHQtYXV0aCI7CmltcG9ydCB7IHVuc3RhYmxlX2NhY2hlIH0gZnJvbSAibmV4dC9jYWNoZSI7CgppbXBvcnQgeyBUZWFtUmVwb3NpdG9yeSB9IGZyb20gIkBjYWxjb20vZmVhdHVyZXMvZWUvdGVhbXMvcmVwb3NpdG9yaWVzL1RlYW1SZXBvc2l0b3J5IjsKaW1wb3J0IHsgVGVhbVNlcnZpY2UgfSBmcm9tICJAY2FsY29tL2ZlYXR1cmVzL2VlL3RlYW1zL3NlcnZpY2VzL3RlYW1TZXJ2aWNlIjsKaW1wb3J0IHsgUGVybWlzc2lvbkNoZWNrU2VydmljZSB9IGZyb20gIkBjYWxjb20vZmVhdHVyZXMvcGJhYy9zZXJ2aWNlcy9wZXJtaXNzaW9uLWNoZWNrLnNlcnZpY2UiOwppbXBvcnQgeyBFcnJvcldpdGhDb2RlIH0gZnJvbSAiQGNhbGNvbS9saWIvZXJyb3JzIjsKaW1wb3J0IHByaXNtYSBmcm9tICJAY2FsY29tL3ByaXNtYSI7CmltcG9ydCB7IE1lbWJlcnNoaXBSb2xlIH0gZnJvbSAiQGNhbGNvbS9wcmlzbWEvZW51bXMiOwoKaW1wb3J0IHsgVGVhbXNMaXN0aW5nIH0gZnJvbSAifi9lZS90ZWFtcy9jb21wb25lbnRzL1RlYW1zTGlzdGluZyI7CgppbXBvcnQgeyBUZWFtc0NUQSB9IGZyb20gIi4vQ1RBIjsKCmNvbnN0IGdldENhY2hlZFRlYW1zID0gdW5zdGFibGVfY2FjaGUoCiAgYXN5bmMgKHVzZXJJZDogbnVtYmVyKSA9PiB7CiAgICBjb25zdCB0ZWFtUmVwbyA9IG5ldyBUZWFtUmVwb3NpdG9yeShwcmlzbWEpOwogICAgcmV0dXJuIGF3YWl0IHRlYW1SZXBvLmZpbmRUZWFtc0J5VXNlcklkKHsKICAgICAgdXNlcklkLAogICAgICBpbmNsdWRlT3JnczogdHJ1ZSwKICAgIH0pOwogIH0sCiAgdW5kZWZpbmVkLAogIHsgcmV2YWxpZGF0ZTogMzYwMCwgdGFnczogWyJ2aWV3ZXIudGVhbXMubGlzdCJdIH0gLy8gQ2FjaGUgZm9yIDEgaG91cgopOwoKZXhwb3J0IGNvbnN0IFNlcnZlclRlYW1zTGlzdGluZyA9IGFzeW5jICh7CiAgc2VhcmNoUGFyYW1zLAogIHNlc3Npb24sCn06IHsKICBzZWFyY2hQYXJhbXM6IFNlYXJjaFBhcmFtczsKICBzZXNzaW9uOiBTZXNzaW9uOwp9KSA9PiB7CiAgY29uc3QgdG9rZW4gPSBBcnJheS5pc0FycmF5KHNlYXJjaFBhcmFtcz8udG9rZW4pID8gc2VhcmNoUGFyYW1zLnRva2VuWzBdIDogc2VhcmNoUGFyYW1zPy50b2tlbjsKICBjb25zdCBhdXRvQWNjZXB0ID0gQXJyYXkuaXNBcnJheShzZWFyY2hQYXJhbXM/LmF1dG9BY2NlcHQpCiAgICA/IHNlYXJjaFBhcmFtcy5hdXRvQWNjZXB0WzBdCiAgICA6IHNlYXJjaFBhcmFtcz8uYXV0b0FjY2VwdDsKICBjb25zdCB1c2VySWQgPSBzZXNzaW9uLnVzZXIuaWQ7CiAgbGV0IGludml0YXRpb25BY2NlcHRlZCA9IGZhbHNlOwoKICBsZXQgdGVhbU5hbWVGcm9tSW52aXRlLAogICAgZXJyb3JNc2dGcm9tSW52aXRlID0gbnVsbDsKCiAgaWYgKHRva2VuKSB7CiAgICB0cnkgewogICAgICBpZiAoYXV0b0FjY2VwdCA9PT0gInRydWUiKSB7CiAgICAgICAgYXdhaXQgVGVhbVNlcnZpY2UuYWNjZXB0SW52aXRhdGlvbkJ5VG9rZW4odG9rZW4sIHVzZXJJZCk7CmRhcnkiPgogICAgICAgICAgICBUb3RhbCBkZXBvc2l0ZWQ6eycgJ30KICAgICAgICAgICAgPEZvcm1hdHRlZE51bWJlcgogICAgICAgICAgICAgIHZhcmlhbnQ9ImNhcHRpb24iCiAgICAgICAgICAgICAgdmFsdWU9e3N0YWtlRGF0YS50b3RhbFN1cHBseUZvcm1hdHRlZH0KICAgICAgICAgICAgICB2aXNpYmxlRGVjaW1hbHM9ezJ9CiAgICAgICAgICAgIC8+CiAgICAgICAgICAgIHsnICgnfQogICAgICAgICAgICA8Rm9ybWF0dGVkTnVtYmVyCiAgICAgICAgICAgICAgdmFyaWFudD0iY2FwdGlvbiIKICAgICAgICAgICAgICB2YWx1ZT17c3Rha2VEYXRhLnRvdGFsU3VwcGx5VVNERm9ybWF0dGVkfQogICAgICAgICAgICAgIHZpc2libGVEZWNpbWFscz17Mn0KICAgICAgICAgICAgICBzeW1ib2w9InVzZCIKICAgICAgICAgICAgLz4KICAgICAgICAgICAgeycpJ30KICAgICAgICAgIDwvVHlwb2dyYXBoeT4KICAgICAgICA8L1N0YWNrPgogICAgICAgIHtoZWFkZXJBY3Rpb24gJiYgPEJveCBzeD17eyBtbDogMyB9fT57aGVhZGVyQWN0aW9ufTwvQm94Pn0KICAgICAgPC9Cb3g+CgogICAgICA8Qm94CiAgICAgICAgc3g9eyh0aGVtZSkgPT4gKHsKICAgICAgICAgIGRpc3BsYXk6ICdmbGV4JywKICAgICAgICAgIGp1c3RpZnlDb250ZW50OiAnc3BhY2UtYmV0d2VlbicsCiAgICAgICAgICBhbGlnbkl0ZW1zOiB7IHhzOiAnZmxleC1zdGFydCcsIHhzbTogJ2NlbnRlcicgfSwKICAgICAgICAgIGZsZXhEaXJlY3Rpb246IHsgeHM6ICdjb2x1bW4nLCB4c206ICdyb3cnIH0sCiAgICAgICAgICBnYXA6IHsgeHM6IDAsIHhzbTogMiB9LAogICAgICAgICAgYm9yZGVyUmFkaXVzOiB7IHhzOiAwLCB4c206ICc2cHgnIH0sCiAgICAgICAgICBib3JkZXI6IHsgeHM6ICd1bnNldCcsIHhzbTogYDFweCBzb2xpZCAke3RoZW1lLnBhbGV0dGUuZGl2aWRlcn1gIH0sCiAgICAgICAgICBwOiB7IHhzOiAwLCB4c206IDQgfSwKICAgICAgICAgIGJhY2tncm91bmQ6IHsKICAgICAgICAgICAgeHM6ICd1bnNldCcsCiAgICAgICAgICAgIHhzbTogdGhlbWUucGFsZXR0ZS5iYWNrZ3JvdW5kLnBhcGVyLAogICAgICAgICAgfSwKICAgICAgICAgIHBvc2l0aW9uOiAncmVsYXRpdmUnLAogICAgICAgICAgJyY6YWZ0ZXInOiB7CiAgICAgICAgICAgIGNvbnRlbnQ6ICInJyIsCiAgICAgICAgICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLAogICAgICAgICAgICBib3R0b206IDAsCiAgICAgICAgICAgIGxlZnQ6ICctMTZweCcsCiAgICAgICAgICAgIHdpZHRoOiAnY2FsYygxMDAlICsgMzJweCknLAogICAgICAgICAgICBoZWlnaHQ6ICcxcHgnLAogICAgICAgICAgICBiZ2NvbG9yOiB7IHhzOiAnZGl2aWRlcicsIHhzbTogJ3RyYW5zcGFyZW50JyB9LAogICAgICAgICAgfSwKICAgICAgICB9KX0KICAgICAgPgogICAgICAgIDxCb3gKICAgICAgICAgIHN4PXt7CiAgICAgICAgICAgIGRpc3BsYXk6ICdmbGV4JywKICAgICAgICAgICAgd2lkdGg6IHsgeHM6ICcxMDAlJywgeHNtOiAndW5zZXQnIH0sCiAgICAgICAgICAgIGp1c3RpZnlDb250ZW50OiAnc3BhY2UtYmV0d2VlbicsCiAgICAgICAgICAgIGFsaWduSXRlbXM6ICdjZW50ZXInLAogICAgICAgICAgICBtYjogeyB4czogMywgeHNtOiAwIH0sCiAgICAgICAgICB9fQogICAgICAgID4KICAgICAgICAgIDxTdGFjayBkaXJlY3Rpb249InJvdyI+CiAgICAgICAgICAgIDxUb2tlbkljb24gc3ltYm9sPXtpY29ufSBzeD17eyBmb250U2l6ZTogeyB4czogJzQwcHgnLCB4c206ICczMnB4JyB9IH19IC8+CiAgICAgICAgICAgIDxTdGFjayBkaXJlY3Rpb249ImNvbHVtbiIgbWw9ezJ9IGFsaWduSXRlbXM9InN0YXJ0IiBqdXN0aWZ5Q29udGVudD0iY2VudGVyIj4KICAgICAgICAgICAgICA8U3RhY2sgZGlyZWN0aW9uPSJyb3ciPgogICAgICAgICAgICAgICAgPFR5cG9ncmFwaHkgdmFyaWFudD17eHNtID8gJ3N1YmhlYWRlcjEnIDogJ2g0J30+c0dITzwvVHkqCiAqIFdlIGV4dGVuZCBub2RlOmNyeXB0byBBUElzIGR1cmluZyBidWlsZHMgYW5kIHJldmFsaWRhdGVzIHRvIGVuc3VyZSB0aGF0IHByZXJlbmRlcnMgZG9uJ3Qgb2JzZXJ2ZSByYW5kb20gYnl0ZXMKICogV2hlbiBjYWNoZUNvbXBvbmVudHMgaXMgZW5hYmxlZC4gUmFuZG9tIGJ5dGVzIGFyZSBhIGZvcm0gb2YgSU8gZXZlbiBpZiB0aGV5IHJlc29sdmUgc3luY2hyb25vdXNseS4gV2hlbiBjYWNoZUNvbXBvbmVudHMgaXMKICogZW5hYmxlZCB3ZSBuZWVkIHRvIGVuc3VyZSB0aGF0IHJhbmRvbSBieXRlcyBhcmUgZXhjbHVkZWQgZnJvbSBwcmVyZW5kZXJzIHVubGVzcyB0aGV5IGFyZSBjYWNoZWQuCiAqCiAqCiAqIFRoZSBleHRlbnNpb25zIGhlcmUgbmV2ZXIgZXJyb3Igbm9yIGFsdGVyIHRoZSB1bmRlcmx5aW5nIHJldHVybiB2YWx1ZXMgYW5kIHRodXMgc2hvdWxkIGJlIHRyYW5zcGFyZW50IHRvIGNhbGxlcnMuCiAqLwoKaW1wb3J0IHsgaW8gfSBmcm9tICcuL3V0aWxzJwoKaWYgKHByb2Nlc3MuZW52Lk5FWFRfUlVOVElNRSA9PT0gJ2VkZ2UnKSB7CiAgLy8gbm90aGluZyB0byBwYXRjaAp9IGVsc2UgewogIGNvbnN0IG5vZGVDcnlwdG8gPSByZXF1aXJlKCdub2RlOmNyeXB0bycpIGFzIHR5cGVvZiBpbXBvcnQoJ25vZGU6Y3J5cHRvJykKCiAgLy8gcmVxdWlyZSgnbm9kZTpjcnlwdG8nKS5nZXRSYW5kb21WYWx1ZXMgaXMgYW4gYWxpYXMgZm9yCiAgLy8gY3J5cHRvLmdldFJhbmRvbVZhbHVlcyB3aGljaCBpcyBleHRlbmRlZCBpbiB3ZWItY3J5cHRvLnRzeAoKICAvLyByZXF1aXJlKCdub2RlOmNyeXB0bycpLnJhbmRvbVVVSUQgaXMgbm90IGFuIGFsaWFzIGZvciBjcnlwdG8ucmFuZG9tVVVJRAoKICBjb25zdCByYW5kb21VVUlERXhwcmVzc2lvbiA9ICJgcmVxdWlyZSgnbm9kZTpjcnlwdG8nKS5yYW5kb21VVUlEKClgIgogIHRyeSB7CiAgICBjb25zdCBfcmFuZG9tVVVJRCA9IG5vZGVDcnlwdG8ucmFuZG9tVVVJRAogICAgbm9kZUNyeXB0by5yYW5kb21VVUlEID0gZnVuY3Rpb24gcmFuZG9tVVVJRCgpIHsKICAgICAgaW8ocmFuZG9tVVVJREV4cHJlc3Npb24sICdyYW5kb20nKQogICAgICByZXR1cm4gX3JhbmRvbVVVSUQuYXBwbHkodGhpcywgYXJndW1lbnRzIGFzIGFueSkKICAgIH0KICB9IGNhdGNoIHsKICAgIGNvbnNvbGUuZXJyb3IoCiAgICAgIGBGYWlsZWQgdG8gaW5zdGFsbCAke3JhbmRvbVVVSURFeHByZXNzaW9ufSBleHRlbnNpb24uIFdoZW4gdXNpbmcgXGBjYWNoZUNvbXBvbmVudHNcYCBjYWxsaW5nIHRoaXMgZnVuY3Rpb24gd2lsbCBub3QgY29ycmVjdGx5IHRyaWdnZXIgZHluYW1pYyBiZWhhdmlvci5gCiAgICApCiAgfQoKICBjb25zdCByYW5kb21CeXRlc0V4cHJlc3Npb24gPSAiYHJlcXVpcmUoJ25vZGU6Y3J5cHRvJykucmFuZG9tQnl0ZXMoc2l6ZSlgIgogIHRyeSB7CiAgICBjb25zdCBfcmFuZG9tQnl0ZXMgPSBub2RlQ3J5cHRvLnJhbmRvbUJ5dGVzCiAgICAvLyBAdHMtZXhwZWN0LWVycm9yIC0tIFRPRE86IHRlbGwgVFMgdGhlIG92ZXJsb2FkcyBhcmUgcHJlc2VydmVkCiAgICBub2RlQ3J5cHRvLnJhbmRvbUJ5dGVzID0gZnVuY3Rpb24gcmFuZG9tQnl0ZXMoKSB7CiAgICAgIGlmICh0eXBlb2YgYXJndW1lbnRzWzFdICE9PSAnZnVuY3Rpb24nKSB7CiAgICAgICAgLy8gcmFuZG9tQnl0ZXMgaXMgc3luYyBpZiB0aGUgc2Vjb25kIGFyZyBpcyB1bmRlZmluZWQKICAgICAgICBpbyhyYW5kb21CeXRlc0V4cHJlc3Npb24sICdyYW5kb20nKQogICAgICB9CiAgICAgIHJldHVybiBfcmFuZG9tQnl0ZXMuYXBwbHkodGhpcywgYXJndW1lbnRzIGFzIGFueSkKICAgIH0KICB9IGNhdGNoIHsKICAgIGNvbnNvbGUuZXJyb3IoCiAgICAgIGBGYWlsZWQgdG8gaW5zdGFsbCAke3JhbmRvbUJ5dGVzRXhwcmVzc2lvbn0gZXh0ZW5zaW9uLiBXaGVuIHVzaW5nIFxgY2FjaGVDb21wb25lbnRzXGAgY2FsbGluZyB0aGlzIGZ1bmN0aW9uIHdpdGhvdXQgYSBjaW9uIERlbW9Db29raWVTZXR0aW5ncygpIHsKICByZXR1cm4gKAogICAgPENhcmQ+CiAgICAgIDxDYXJkSGVhZGVyPgogICAgICAgIDxDYXJkVGl0bGU+Q29va2llIFNldHRpbmdzPC9DYXJkVGl0bGU+CiAgICAgICAgPENhcmREZXNjcmlwdGlvbj5NYW5hZ2UgeW91ciBjb29raWUgc2V0dGluZ3MgaGVyZS48L0NhcmREZXNjcmlwdGlvbj4KICAgICAgPC9DYXJkSGVhZGVyPgogICAgICA8Q2FyZENvbnRlbnQgY2xhc3NOYW1lPSJncmlkIGdhcC02Ij4KICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIHNwYWNlLXgtMiI+CiAgICAgICAgICA8TGFiZWwgaHRtbEZvcj0ibmVjZXNzYXJ5IiBjbGFzc05hbWU9ImZsZXggZmxleC1jb2wgc3BhY2UteS0xIj4KICAgICAgICAgICAgPHNwYW4+U3RyaWN0bHkgTmVjZXNzYXJ5PC9zcGFuPgogICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9ImZvbnQtbm9ybWFsIGxlYWRpbmctc251ZyB0ZXh0LW11dGVkLWZvcmVncm91bmQiPgogICAgICAgICAgICAgIFRoZXNlIGNvb2tpZXMgYXJlIGVzc2VudGlhbCBpbiBvcmRlciB0byB1c2UgdGhlIHdlYnNpdGUgYW5kIHVzZQogICAgICAgICAgICAgIGl0cyBmZWF0dXJlcy4KICAgICAgICAgICAgPC9zcGFuPgogICAgICAgICAgPC9MYWJlbD4KICAgICAgICAgIDxTd2l0Y2ggaWQ9Im5lY2Vzc2FyeSIgZGVmYXVsdENoZWNrZWQgLz4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIHNwYWNlLXgtMiI+CiAgICAgICAgICA8TGFiZWwgaHRtbEZvcj0iZnVuY3Rpb25hbCIgY2xhc3NOYW1lPSJmbGV4IGZsZXgtY29sIHNwYWNlLXktMSI+CiAgICAgICAgICAgIDxzcGFuPkZ1bmN0aW9uYWwgQ29va2llczwvc3Bhbj4KICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSJmb250LW5vcm1hbCBsZWFkaW5nLXNudWcgdGV4dC1tdXRlZC1mb3JlZ3JvdW5kIj4KICAgICAgICAgICAgICBUaGVzZSBjb29raWVzIGFsbG93IHRoZSB3ZWJzaXRlIHRvIHByb3ZpZGUgcGVyc29uYWxpemVkCiAgICAgICAgICAgICAgZnVuY3Rpb25hbGl0eS4KICAgICAgICAgICAgPC9zcGFuPgogICAgICAgICAgPC9MYWJlbD4KICAgICAgICAgIDxTd2l0Y2ggaWQ9ImZ1bmN0aW9uYWwiIC8+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIGp1c3RpZnktYmV0d2VlbiBzcGFjZS14LTIiPgogICAgICAgICAgPExhYmVsIGh0bWxGb3I9InBlcmZvcm1hbmNlIiBjbGFzc05hbWU9ImZsZXggZmxleC1jb2wgc3BhY2UteS0xIj4KICAgICAgICAgICAgPHNwYW4+UGVyZm9ybWFuY2UgQ29va2llczwvc3Bhbj4KICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSJmb250LW5vcm1hbCBsZWFkaW5nLXNudWcgdGV4dC1tdXRlZC1mb3JlZ3JvdW5kIj4KICAgICAgICAgICAgICBUaGVzZSBjb29raWVzIGhlbHAgdG8gaW1wcm92ZSB0aGUgcGVyZm9ybWFuY2Ugb2YgdGhlIHdlYnNpdGUuCiAgICAgICAgICAgIDwvc3Bhbj4KICAgICAgICAgIDwvTGFiZWw+CiAgICAgICAgICA8U3dpdGNoIGlkPSJwZXJmb3JtYW5jZSIgLz4KICAgICAgICA8L2Rpdj4KICAgICAgPC9DYXJkQ29udGVudD4KICAgICAgPENhcmRGb290ZXI+CiAgICAgICAgPEJ1dHRvbiB2YXJpYW50PSJvdXRsaW5lIiBjbGFzc05hbWU9InctZnVsbCI+CiAgICAgICAgICBTYXZlIHByZWZlcmVuY2VzCiAgICAgICAgPC9CdXR0b24+CiAgICAgIDwvQ2FyZEZvb3Rlcj4KICAgIDwvQ2FyZD4KICApCn0KInVzZSBjbGllbnQiCgppbXBvcnQgKiBhcyBSZWFjdCBmcm9tICJyZWFjdCIKCmltcG9ydCB7CiAgRXhhbXBsZSwKICBFeGFtcGxlV3JhcHBlciwKfSBmcm9tICJAL3JlZ2lzdHJ5L2Jhc2VzL3JhZGl4L2NvbXBvbmVudHMvZXhhbXBsZSIKaW1wb3J0IHsKICBBbGVydERpYWxvZywKICBBbGU6ICJIZWxwIiwKICAgICAgdXJsOiAiIyIsCiAgICAgIGljb246IE1lc3NhZ2VDaXJjbGVRdWVzdGlvbiwKICAgIH0sCiAgXSwKICBmYXZvcml0ZXM6IFsKICAgIHsKICAgICAgbmFtZTogIlByb2plY3QgTWFuYWdlbWVudCAmIFRhc2sgVHJhY2tpbmciLAogICAgICB1cmw6ICIjIiwKICAgICAgZW1vamk6ICLwn5OKIiwKICAgIH0sCiAgICB7CiAgICAgIG5hbWU6ICJGYW1pbHkgUmVjaXBlIENvbGxlY3Rpb24gJiBNZWFsIFBsYW5uaW5nIiwKICAgICAgdXJsOiAiIyIsCiAgICAgIGVtb2ppOiAi8J+NsyIsCiAgICB9LAogICAgewogICAgICBuYW1lOiAiRml0bmVzcyBUcmFja2VyICYgV29ya291dCBSb3V0aW5lcyIsCiAgICAgIHVybDogIiMiLAogICAgICBlbW9qaTogIvCfkqoiLAogICAgfSwKICAgIHsKICAgICAgbmFtZTogIkJvb2sgTm90ZXMgJiBSZWFkaW5nIExpc3QiLAogICAgICB1cmw6ICIjIiwKICAgICAgZW1vamk6ICLwn5OaIiwKICAgIH0sCiAgICB7CiAgICAgIG5hbWU6ICJTdXN0YWluYWJsZSBHYXJkZW5pbmcgVGlwcyAmIFBsYW50IENhcmUiLAogICAgICB1cmw6ICIjIiwKICAgICAgZW1vamk6ICLwn4yxIiwKICAgIH0sCiAgICB7CiAgICAgIG5hbWU6ICJMYW5ndWFnZSBMZWFybmluZyBQcm9ncmVzcyAmIFJlc291cmNlcyIsCiAgICAgIHVybDogIiMiLAogICAgICBlbW9qaTogIvCfl6PvuI8iLAogICAgfSwKICAgIHsKICAgICAgbmFtZTogIkhvbWUgUmVub3ZhdGlvbiBJZGVhcyAmIEJ1ZGdldCBUcmFja2VyIiwKICAgICAgdXJsOiAiIyIsCiAgICAgIGVtb2ppOiAi8J+PoCIsCiAgICB9LAogICAgewogICAgICBuYW1lOiAiUGVyc29uYWwgRmluYW5jZSAmIEludmVzdG1lbnQgUG9ydGZvbGlvIiwKICAgICAgdXJsOiAiIyIsCiAgICAgIGVtb2ppOiAi8J+SsCIsCiAgICB9LAogICAgewogICAgICBuYW1lOiAiTW92aWUgJiBUViBTaG93IFdhdGNobGlzdCB3aXRoIFJldmlld3MiLAogICAgICB1cmw6ICIjIiwKICAgICAgZW1vamk6ICLwn46sIiwKICAgIH0sCiAgICB7CiAgICAgIG5hbWU6ICJEYWlseSBIYWJpdCBUcmFja2VyICYgR29hbCBTZXR0aW5nIiwKICAgICAgdXJsOiAiIyIsCiAgICAgIGVtb2ppOiAi4pyFIiwKICAgIH0sCiAgXSwKICB3b3Jrc3BhY2VzOiBbCiAgICB7CiAgICAgIG5hbWU6ICJQZXJzb25hbCBMaWZlIE1hbmFnZW1lbnQiLAogICAgICBlbW9qaTogIvCfj6AiLAogICAgICBwYWdlczogWwogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICJEYWlseSBKb3VybmFsICYgUmVmbGVjdGlvbiIsCiAgICAgICAgICB1cmw6ICIjIiwKICAgICAgICAgIGVtb2ppOiAi8J+TlCIsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAiSGVhbHRoICYgV2VsbG5lc3MgVHJhY2tlciIsCiAgICAgICAgICB1cmw6ICIjIiwKICAgICAgICAgIGVtb2ppOiAi8J+NjyIsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAiUGVyc29uYWwgR3Jvd3RoICYgTGVhcm5pbmcgR29hbHMiLAogICAgICAgICAgdXJsOiAiIyIsCiAgICAgICAgICBlbW9qaTogIvCfjJ8iLAogICAgICAgIH0sCiAgICAgIF0sCiAgICB9LAogICAgewogICAgICBuYW1lOiAiUHJvZmVzc2lvbmFsIERldmVsb3BtZW50IiwKICAgICAgZW1vamk6ICLwn5K8IiwKICAgICAgcGFnZXM6IFsKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAiQ2FyZWVyIE9iamVjdGl2ZXMgJiBNaWxlc3RvbmVzIiwKICAgICAgICAgIHVybDogIiMiLAogICAgICAgICAgZW1vamk6ICLwn46vIiwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICJTa2lsbCBBY3F1aXNpdGlvbiAmIFRyYWluaW5nIExvZyIsCiAgICAgICAgICB1cmw6ICIjIiwKICAgICAgICAgIGVtb2ppOiAi8J+noCIsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICBuYW1lOiAiTmV0d29ya2luZyBDb250YWN0cyAmIEV2ZW4gY2FuU2F2ZVNlZ21lbnQsCiAgICBpc1NlZ21lbnRFbmFibGVkLAogICAgc2V0U2VnbWVudElkLAogICAgcGFnZVNpemUsCiAgICBzZWFyY2hUZXJtLAogIH0gPSB1c2VEYXRhVGFibGUoKTsKCiAgY29uc3QgW3NhdmVNb2RlLCBzZXRTYXZlTW9kZV0gPSB1c2VTdGF0ZTwiY3JlYXRlIiB8ICJ1cGRhdGUiPigoKSA9PgogICAgc2VsZWN0ZWRTZWdtZW50ICYmIHNlbGVjdGVkU2VnbWVudC50eXBlID09PSAidXNlciIgPyAidXBkYXRlIiA6ICJjcmVhdGUiCiAgKTsKCiAgLy8gV2hlbiB0aGUgZGlhbG9nIGlzIG5vdCBvcGVuLAogIC8vIHN3aXRjaCBgc2F2ZU1vZGVgIGFjY29yZGluZyB0byBgc2VsZWN0ZWRTZWdtZW50YAogIHVzZUVmZmVjdCgoKSA9PiB7CiAgICBpZiAoaXNPcGVuKSB7CiAgICAgIHJldHVybjsKICAgIH0KICAgIHNldFNhdmVNb2RlKHNlbGVjdGVkU2VnbWVudCAmJiBzZWxlY3RlZFNlZ21lbnQudHlwZSA9PT0gInVzZXIiID8gInVwZGF0ZSIgOiAiY3JlYXRlIik7CiAgfSwgW3NlbGVjdGVkU2VnbWVudCwgaXNPcGVuXSk7CgogIGNvbnN0IHsgZGF0YTogdGVhbXMgfSA9IHRycGMudmlld2VyLnRlYW1zLmxpc3QudXNlUXVlcnkoKTsKCiAgY29uc3QgeyBtdXRhdGU6IGNyZWF0ZVNlZ21lbnQgfSA9IHRycGMudmlld2VyLmZpbHRlclNlZ21lbnRzLmNyZWF0ZS51c2VNdXRhdGlvbih7CiAgICBvblN1Y2Nlc3M6IChzZWdtZW50KSA9PiB7CiAgICAgIHV0aWxzLnZpZXdlci5maWx0ZXJTZWdtZW50cy5saXN0LmludmFsaWRhdGUoKTsKICAgICAgc2hvd1RvYXN0KHQoImZpbHRlcl9zZWdtZW50X3NhdmVkIiksICJzdWNjZXNzIik7CiAgICAgIHNldFNlZ21lbnRJZCh7IGlkOiBzZWdtZW50LmlkLCB0eXBlOiAidXNlciIgfSwgeyB0eXBlOiAidXNlciIsIC4uLnNlZ21lbnQgfSk7CiAgICAgIHNldElzT3BlbihmYWxzZSk7CiAgICB9LAogICAgb25FcnJvcjogKCkgPT4gewogICAgICBzaG93VG9hc3QodCgiZXJyb3Jfc2F2aW5nX2ZpbHRlcl9zZWdtZW50IiksICJlcnJvciIpOwogICAgfSwKICB9KTsKCiAgY29uc3QgeyBtdXRhdGU6IHVwZGF0ZVNlZ21lbnQgfSA9IHRycGMudmlld2VyLmZpbHRlclNlZ21lbnRzLnVwZGF0ZS51c2VNdXRhdGlvbih7CiAgICBvblN1Y2Nlc3M6ICgpID0+IHsKICAgICAgdXRpbHMudmlld2VyLmZpbHRlclNlZ21lbnRzLmxpc3QuaW52YWxpZGF0ZSgpOwogICAgICBzaG93VG9hc3QodCgiZmlsdGVyX3NlZ21lbnRfdXBkYXRlZCIpLCAic3VjY2VzcyIpOwogICAgICBzZXRJc09wZW4oZmFsc2UpOwogICAgfSwKICAgIG9uRXJyb3I6ICgpID0+IHsKICAgICAgc2hvd1RvYXN0KHQoImVycm9yX3VwZGF0aW5nX2ZpbHRlcl9zZWdtZW50IiksICJlcnJvciIpOwogICAgfSwKICB9KTsKCiAgY29uc3Qgb25TdWJtaXQgPSAodmFsdWVzOiBGb3JtVmFsdWVzKSA9PiB7CiAgICBpZiAoaXNUZWFtU2VnbWVudCAmJiAhc2VsZWN0ZWRUZWFtSWQpIHsKICAgICAgc2hvd1RvYXN0KHQoInBsZWFzZV9zZWxlY3RfdGVhbSIpLCAiZXJyb3IiKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIGNvbnN0IHNlZ21lbnREYXRhID0gewogICAgICB0YWJsZUlkZW50aWZpZXIsCiAgICAgIGFjdGl2ZUZpbHRlcnMsCiAgICAgIHNvcnRpbmcsCiAgICAgIGNvbHVtblZpc2liaWxpdHksCiAgICAgIGNvbHVtblNpemluZywKICAgICAgcGVyUGFnZTogcGFnZVNpemUsCiAgICAgIHNlYXJjaFRlcm0sCiAgICB9OwoKICAgIGlmIChzYXZlTW9kZSA9PT0gInVwZGF0ZSIgJiYgc2VsZWN0ZWRTZWdtZW50ICYmIHNlbGVjdGVkU2VnbWVudC50eXBlID09PSAidXNlciIpIHsKICAgICAgY29uc3Qgc2NvcGUgPSBzZWxlY3RlZFNlZ21lbnQuc2NvcGU7CiAgICAgIGlmIChzY29wZSA9PT0gIlRFQU0iKSB7CiAgICAgICAgdXBkYXRlU2VnbWVudCh7CiAgICAgICAgICBpZDogc2VsZWN0ZWRTZWdtZW50LmlkLAogICAgICAgICAgc2NvcGUsCiAgICAgICAgICB0ZWFtSWQ6IHN2aWV3IHN0YXRlIHVwZGF0ZSAoZS5nLiwgcGFnZSBpbmRleCBjaGFuZ2UpLgogICAqIFRoZSBwYXJlbnQgY29tcG9uZW50IHdpbGwgaGFuZGxlIGZldGNoaW5nIGRhdGEgYW5kIHVwZGF0aW5nIGJvb2tpbmdzLgogICAqLwogIHJlcXVlc3ROZXh0UGVyaW9kOiAoKSA9PiB2b2lkOwp9CgppbnRlcmZhY2UgQm9va2luZ0RldGFpbHNTaGVldFN0b3JlIHsKICAvLyBDb3JlIHN0YXRlICh2aWV3LWFnbm9zdGljKQogIHNlbGVjdGVkQm9va2luZ1VpZDogc3RyaW5nIHwgbnVsbDsKICBhY3RpdmVTZWdtZW50OiAiaW5mbyIgfCAiaGlzdG9yeSIgfCBudWxsOwogIGJvb2tpbmdzOiBCb29raW5nT3V0cHV0W107CiAgaXNUcmFuc2l0aW9uaW5nOiBib29sZWFuOwogIHBlbmRpbmdTZWxlY3Rpb246IFBlbmRpbmdTZWxlY3Rpb25UeXBlOwoKICAvLyBJbmplY3RlZCBjYXBhYmlsaXRpZXMgKHByb3ZpZGVkIGJ5IGFkYXB0ZXJzKQogIGNhcGFiaWxpdGllczogTmF2aWdhdGlvbkNhcGFiaWxpdGllcyB8IG51bGw7CgogIC8vIENvcmUgYWN0aW9ucwogIHNldFNlbGVjdGVkQm9va2luZ1VpZDogKHVpZDogc3RyaW5nIHwgbnVsbCkgPT4gdm9pZDsKICBzZXRBY3RpdmVTZWdtZW50OiAoc2VnbWVudDogImluZm8iIHwgImhpc3RvcnkiIHwgbnVsbCkgPT4gdm9pZDsKICBzZXRCb29raW5nczogKGJvb2tpbmdzOiBCb29raW5nT3V0cHV0W10pID0+IHZvaWQ7CiAgc2V0Q2FwYWJpbGl0aWVzOiAoY2FwYWJpbGl0aWVzOiBOYXZpZ2F0aW9uQ2FwYWJpbGl0aWVzIHwgbnVsbCkgPT4gdm9pZDsKICBjbGVhclNlbGVjdGlvbjogKCkgPT4gdm9pZDsKICBjbGVhclBlbmRpbmdTZWxlY3Rpb246ICgpID0+IHZvaWQ7CiAgc2V0SXNUcmFuc2l0aW9uaW5nOiAoaXNUcmFuc2l0aW9uaW5nOiBib29sZWFuKSA9PiB2b2lkOwoKICAvLyBOYXZpZ2F0aW9uIG1ldGhvZHMgKGRlbGVnYXRlcyB0byBjYXBhYmlsaXRpZXMpCiAgbmF2aWdhdGVOZXh0OiAoKSA9PiBQcm9taXNlPHZvaWQ+OwogIG5hdmlnYXRlUHJldmlvdXM6ICgpID0+IFByb21pc2U8dm9pZD47CgogIC8vIFNpbXBsZSBnZXR0ZXJzIChubyB2aWV3LXNwZWNpZmljIGxvZ2ljKQogIGdldFNlbGVjdGVkQm9va2luZzogKCkgPT4gQm9va2luZ091dHB1dCB8IG51bGw7CiAgZ2V0Q3VycmVudEluZGV4OiAoKSA9PiBudW1iZXI7CiAgaGFzTmV4dEluQXJyYXk6ICgpID0+IGJvb2xlYW47CiAgaGFzUHJldmlvdXNJbkFycmF5OiAoKSA9PiBib29sZWFuOwogIGlzRmlyc3RJbkFycmF5OiAoKSA9PiBib29sZWFuOwogIGlzTGFzdEluQXJyYXk6ICgpID0+IGJvb2xlYW47Cn0KCnR5cGUgQm9va2luZ0RldGFpbHNTaGVldFN0b3JlVHlwZSA9IFJldHVyblR5cGU8dHlwZW9mIGNyZWF0ZUJvb2tpbmdEZXRhaWxzU2hlZXRTdG9yZT47Cgpjb25zdCBjcmVhdGVCb29raW5nRGV0YWlsc1NoZWV0U3RvcmUgPSAoaW5pdGlhbEJvb2tpbmdzOiBCb29raW5nT3V0cHV0W10gPSBbXSkgPT4gewogIHJldHVybiBjcmVhdGVTdG9yZTxCb29raW5nRGV0YWlsc1NoZWV0U3RvcmU+KChzZXQsIGdldCkgPT4gKHsKICAgIC8vIEluaXRpYWwgc3RhdGUKICAgIHNlbGVjdGVkQm9va2luZ1VpZDogbnVsbCwKICAgIGFjdGl2ZVNlZ21lbnQ6IG51bGwsCiAgICBib29raW5nczogaW5pdGlhbEJvb2tpbmdzLAogICAgaXNUcmFuc2l0aW9uaW5nOiBmYWxzZSwKICAgIHBlbmRpbmdTZWxlY3Rpb246IG51bGwsCiAgICBjYXBhYmlsaXRpZXM6IG51bGwsCgogICAgLy8gQWN0aW9ucwogICAgc2V0U2VsZWN0ZWRCb29raW5nVWlkOiAodWlkKSA9PiB7CiAgICAgIHNldCh7IHNlbGVjdGVkQm9va2luZ1VpZDogdWlkIH0pOwogICAgfSwKICAgIHNldEFjdGl2ZVNlZ21lbnQ6IChzZWdtZW50KSA9PiB7CiAgICAgIHNldCh7IGFjdGl2ZVNlZ21lbnQ6IHNlZ21lbnQgfSk7CiAgICB9LAogICAgc2V0Qm9va2luZ3M6IChib29raW5ncykgPT4gc2V0KHsgYm9va2luZ3MgfSksCnRQYWdlOiBib29sZWFuLAogIGZldGNoTmV4dFBhZ2U6ICgpID0+IHZvaWQKKSA9PiB7CiAgY29uc3QgaGFuZGxlU2Nyb2xsID0gdXNlQ2FsbGJhY2soKCkgPT4gewogICAgY29uc3QgY29udGFpbmVyID0gY29udGFpbmVyUmVmLmN1cnJlbnQ7CiAgICBpZiAoIWNvbnRhaW5lciB8fCAhaGFzTmV4dFBhZ2UgfHwgaXNGZXRjaGluZ05leHRQYWdlKSByZXR1cm47CgogICAgY29uc3QgeyBzY3JvbGxIZWlnaHQsIHNjcm9sbFRvcCwgY2xpZW50SGVpZ2h0IH0gPSBjb250YWluZXI7CiAgICBpZiAoc2Nyb2xsSGVpZ2h0IC0gc2Nyb2xsVG9wIC0gY2xpZW50SGVpZ2h0IDwgMTAwKSB7CiAgICAgIGZldGNoTmV4dFBhZ2UoKTsKICAgIH0KICB9LCBbY29udGFpbmVyUmVmLCBoYXNOZXh0UGFnZSwgaXNGZXRjaGluZ05leHRQYWdlLCBmZXRjaE5leHRQYWdlXSk7CgogIHVzZUVmZmVjdCgoKSA9PiB7CiAgICBjb25zdCBjb250YWluZXIgPSBjb250YWluZXJSZWYuY3VycmVudDsKICAgIGlmICghY29udGFpbmVyKSByZXR1cm47CgogICAgY29udGFpbmVyLmFkZEV2ZW50TGlzdGVuZXIoInNjcm9sbCIsIGhhbmRsZVNjcm9sbCk7CiAgICByZXR1cm4gKCkgPT4gY29udGFpbmVyLnJlbW92ZUV2ZW50TGlzdGVuZXIoInNjcm9sbCIsIGhhbmRsZVNjcm9sbCk7CiAgfSwgW2hhbmRsZVNjcm9sbCwgY29udGFpbmVyUmVmXSk7Cn07Cgpjb25zdCBtZXJnZUxvY2F0aW9uT3B0aW9uc1dpdGhIb3N0QXBwcyA9ICgKICBsb2NhdGlvbk9wdGlvbnM6IFRMb2NhdGlvbk9wdGlvbnMsCiAgaG9zdHNXaXRoQXBwczogSG9zdFdpdGhMb2NhdGlvbk9wdGlvbnNbXSwKICB0OiAoa2V5OiBzdHJpbmcpID0+IHN0cmluZwopOiBUTG9jYXRpb25PcHRpb25zID0+IHsKICBpZiAoaG9zdHNXaXRoQXBwcy5sZW5ndGggPT09IDApIHJldHVybiBsb2NhdGlvbk9wdGlvbnM7CgogIGNvbnN0IGV4aXN0aW5nVmFsdWVzID0gbmV3IFNldDxzdHJpbmc+KCk7CiAgbG9jYXRpb25PcHRpb25zLmZvckVhY2goKGdyb3VwKSA9PiB7CiAgICBncm91cC5vcHRpb25zLmZvckVhY2goKG9wdCkgPT4gZXhpc3RpbmdWYWx1ZXMuYWRkKG9wdC52YWx1ZSkpOwogIH0pOwoKICBjb25zdCBob3N0QXBwc09wdGlvbnM6IFRMb2NhdGlvbk9wdGlvbnNbbnVtYmVyXVsib3B0aW9ucyJdID0gW107CiAgaG9zdHNXaXRoQXBwcy5mb3JFYWNoKChob3N0KSA9PiB7CiAgICBob3N0Lmluc3RhbGxlZEFwcHMuZm9yRWFjaCgoYXBwKSA9PiB7CiAgICAgIGlmIChhcHAubG9jYXRpb25PcHRpb24gJiYgIWV4aXN0aW5nVmFsdWVzLmhhcyhhcHAubG9jYXRpb25PcHRpb24udmFsdWUpKSB7CiAgICAgICAgZXhpc3RpbmdWYWx1ZXMuYWRkKGFwcC5sb2NhdGlvbk9wdGlvbi52YWx1ZSk7CiAgICAgICAgaG9zdEFwcHNPcHRpb25zLnB1c2goewogICAgICAgICAgdmFsdWU6IGFwcC5sb2NhdGlvbk9wdGlvbi52YWx1ZSwKICAgICAgICAgIGxhYmVsOiBhcHAubG9jYXRpb25PcHRpb24ubGFiZWwsCiAgICAgICAgICBpY29uOiBhcHAubG9jYXRpb25PcHRpb24uaWNvbiwKICAgICAgICB9KTsKICAgICAgfQogICAgfSk7CiAgfSk7CgogIGlmIChob3N0QXBwc09wdGlvbnMubGVuZ3RoID09PSAwKSByZXR1cm4gbG9jYXRpb25PcHRpb25zOwoKICBjb25zdCBjb25mZXJlbmNpbmdHcm91cCA9IGxvY2F0aW9uT3B0aW9ucy5maW5kKAogICAgKGcpID0+IGcubGFiZWwudG9Mb3dlckNhc2UoKS5pbmNsdWRlcygiY29uZmVyZW5jaW5nIikgfHwgZy5sYWJlbC50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKCJ2aWRlbyIpCiAgKTsKCiAgaWYgKGNvbmZlcmVuY2luZ0dyb3VwKSB7CiAgICByZXR1cm4gbG9jYXRpb25PcHRpb25zLm1hcCgoZ3JvdXApID0+IHsKICAgICAgaWYgKGdyb3VwID09PSBjb25mZXJlbmNpbmdHcm91cCkgewogICAgICAgIHJldHVybiB7IC4uLmdyb3VwLCBvcHRpb25zOiBbLi4uZ3JvdXAub3B0aW9ucywgLi4uaG9zdEFwcHNPcHRpb25zXSB9Owogbm5lY3Qvd2FsbGV0Q29ubmVjdFNsaWNlJwppbXBvcnQgeyBUZXh0IH0gZnJvbSAndWkvc3JjJwppbXBvcnQgeyBFdGhNZXRob2QsIFdhbGxldENvbm5lY3RFdGhNZXRob2QgfSBmcm9tICd1bmlzd2FwL3NyYy9mZWF0dXJlcy9kYXBwUmVxdWVzdHMvdHlwZXMnCmltcG9ydCB7IGdldEN1cnJlbmN5QW1vdW50LCBWYWx1ZVR5cGUgfSBmcm9tICd1bmlzd2FwL3NyYy9mZWF0dXJlcy90b2tlbnMvZ2V0Q3VycmVuY3lBbW91bnQnCmltcG9ydCB7IFV3VUxpbmtNZXRob2QgfSBmcm9tICd1bmlzd2FwL3NyYy90eXBlcy93YWxsZXRDb25uZWN0JwoKZXhwb3J0IGZ1bmN0aW9uIEhlYWRlclRleHQoewogIHJlcXVlc3QsCiAgcGVybWl0QW1vdW50LAogIHBlcm1pdEN1cnJlbmN5LAp9OiB7CiAgcmVxdWVzdDogV2FsbGV0Q29ubmVjdFNpZ25pbmdSZXF1ZXN0CiAgcGVybWl0QW1vdW50PzogbnVtYmVyCiAgcGVybWl0Q3VycmVuY3k/OiBDdXJyZW5jeSB8IG51bGwKfSk6IEpTWC5FbGVtZW50IHsKICBjb25zdCB7IGRhcHBSZXF1ZXN0SW5mbywgdHlwZTogbWV0aG9kIH0gPSByZXF1ZXN0CgogIGlmIChwZXJtaXRDdXJyZW5jeSkgewogICAgY29uc3QgcmVhZGFibGVQZXJtaXRBbW91bnQgPSBnZXRDdXJyZW5jeUFtb3VudCh7CiAgICAgIHZhbHVlOiBwZXJtaXRBbW91bnQ/LnRvU3RyaW5nKCksCiAgICAgIHZhbHVlVHlwZTogVmFsdWVUeXBlLlJhdywKICAgICAgY3VycmVuY3k6IHBlcm1pdEN1cnJlbmN5LAogICAgfSk/LnRvRXhhY3QoKQoKICAgIHJldHVybiByZWFkYWJsZVBlcm1pdEFtb3VudCA/ICgKICAgICAgPFRleHQgdmFyaWFudD0iaGVhZGluZzMiPgogICAgICAgIDxUcmFucwogICAgICAgICAgLy8gYHZhcmlhbnRgIHByb3AgbXVzdCBiZSBmaXJzdAogICAgICAgICAgY29tcG9uZW50cz17eyBoaWdobGlnaHQ6IDxUZXh0IHZhcmlhbnQ9ImhlYWRpbmczIiBmb250V2VpZ2h0PSJib2xkIiAvPiB9fQogICAgICAgICAgaTE4bktleT0icXJTY2FubmVyLnJlcXVlc3Qud2l0aEFtb3VudCIKICAgICAgICAgIHZhbHVlcz17ewogICAgICAgICAgICBkYXBwTmFtZTogZGFwcFJlcXVlc3RJbmZvLm5hbWUsCiAgICAgICAgICAgIGN1cnJlbmN5U3ltYm9sOiBwZXJtaXRDdXJyZW5jeS5zeW1ib2wsCiAgICAgICAgICAgIGFtb3VudDogcmVhZGFibGVQZXJtaXRBbW91bnQsCiAgICAgICAgICB9fQogICAgICAgIC8+CiAgICAgIDwvVGV4dD4KICAgICkgOiAoCiAgICAgIDxUZXh0IHZhcmlhbnQ9ImhlYWRpbmczIj4KICAgICAgICA8VHJhbnMKICAgICAgICAgIC8vIGB2YXJpYW50YCBwcm9wIG11c3QgYmUgZmlyc3QKICAgICAgICAgIGNvbXBvbmVudHM9e3sgaGlnaGxpZ2h0OiA8VGV4dCB2YXJpYW50PSJoZWFkaW5nMyIgZm9udFdlaWdodD0iYm9sZCIgLz4gfX0KICAgICAgICAgIGkxOG5LZXk9InFyU2Nhbm5lci5yZXF1ZXN0LndpdGhvdXRBbW91bnQiCiAgICAgICAgICB2YWx1ZXM9e3sKICAgICAgICAgICAgZGFwcE5hbWU6IGRhcHBSZXF1ZXN0SW5mby5uYW1lLAogICAgICAgICAgICBjdXJyZW5jeVN5bWJvbDogcGVybWl0Q3VycmVuY3kuc3ltYm9sLAogICAgICAgICAgfX0KICAgICAgICAvPgogICAgICA8L1RleHQ+CiAgICApCiAgfQoKICBjb25zdCBnZXRSZWFkYWJsZU1ldGhvZE5hbWUgPSAoCiAgICBldGhNZXRob2Q6IFdhbGxldENvbm5lY3RFdGhNZXRob2QgfCBVd1VMaW5rTWV0aG9kLAogICAgZGFwcE5hbWVPclVybDogc3RyaW5nLAogICk6IEpTWC5FbGVtZW50ID0+IHsKICAgIHN3aXRjaCAoZXRoTWV0aG9kKSB7CiAgICAgIGNhc2UgRXRoTWV0aG9kLlBlcnNvbmFsU2lnbjoKICAgICAgY2FzZSBFdGhNZXRob2QuRXRoU2lnbjoKICAgICAgY2FzZSBFdGhNZXRob2QuU2lnblR5cGVkRGF0YToKICAgICAgICByZXR1cm4gPFRyYW5zIGkxOG5LZXk9InFyU2Nhbm5lci5yZXF1ZXN0Lm1ldGhvZC5zaWduYXR1cmUiIHZhbHVlcz17eyBkYXBwTmFtZU9yVXJsIH19IC9leDogMiwKICAgICAgICBhZGRyZXNzOiAnMHgyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyJywKICAgICAgfSkKICAgICAgY29uc3QgYWNjb3VudDMgPSBjcmVhdGVNbmVtb25pY0FjY291bnQoewogICAgICAgIGRlcml2YXRpb25JbmRleDogNSwKICAgICAgICBhZGRyZXNzOiAnMHgzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzJywKICAgICAgfSkKCiAgICAgIG1vY2tVc2VBY3RpdmVSZWR1eEFjY291bnQubW9ja1JldHVyblZhbHVlKGFjY291bnQyKSAvLyBBY3RpdmUgYWNjb3VudCBpcyBpbmRleCAyCiAgICAgIG1vY2tTZWxlY3RGaW5pc2hlZE9uYm9hcmRpbmcubW9ja1JldHVyblZhbHVlKHRydWUpCgogICAgICBjb25zdCB7IHJlc3VsdCB9ID0gcmVuZGVyV2l0aFByb3ZpZGVyKHsKICAgICAgICBhY2NvdW50czogewogICAgICAgICAgW2FjY291bnQxLmFkZHJlc3NdOiBhY2NvdW50MSwKICAgICAgICAgIFthY2NvdW50Mi5hZGRyZXNzXTogYWNjb3VudDIsCiAgICAgICAgICBbYWNjb3VudDMuYWRkcmVzc106IGFjY291bnQzLAogICAgICAgIH0sCiAgICAgIH0pCgogICAgICBjb25zdCB3YWxsZXQgPSByZXN1bHQuY3VycmVudC5nZXRTdGF0ZSgpLmdldEFjdGl2ZVdhbGxldChQbGF0Zm9ybS5FVk0pCiAgICAgIGV4cGVjdCh3YWxsZXQ/LmFkZHJlc3NlcykudG9IYXZlTGVuZ3RoKDYpIC8vIEFycmF5IGxlbmd0aCBzaG91bGQgYWNjb21tb2RhdGUgaGlnaGVzdCBpbmRleCArIDEKICAgICAgZXhwZWN0KHdhbGxldD8uYWRkcmVzc2VzWzBdPy5ldm0pLnRvQmUoJzB4MTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMScpCiAgICAgIGV4cGVjdCh3YWxsZXQ/LmFkZHJlc3Nlc1syXT8uZXZtKS50b0JlKCcweDIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjIyMjInKQogICAgICBleHBlY3Qod2FsbGV0Py5hZGRyZXNzZXNbNV0/LmV2bSkudG9CZSgnMHgzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzMzJykKICAgIH0pCgogICAgaXQoJ3Nob3VsZCBoYW5kbGUgbWl4ZWQgbW5lbW9uaWMgYW5kIHJlYWRvbmx5IGFjY291bnRzJywgKCkgPT4gewogICAgICBjb25zdCBtbmVtb25pY0FjY291bnQgPSBjcmVhdGVNbmVtb25pY0FjY291bnQoKQogICAgICBjb25zdCByZWFkb25seUFjY291bnQgPSBjcmVhdGVSZWFkb25seUFjY291bnQoKQoKICAgICAgbW9ja1VzZUFjdGl2ZVJlZHV4QWNjb3VudC5tb2NrUmV0dXJuVmFsdWUobW5lbW9uaWNBY2NvdW50KQogICAgICBtb2NrU2VsZWN0RmluaXNoZWRPbmJvYXJkaW5nLm1vY2tSZXR1cm5WYWx1ZSh0cnVlKQoKICAgICAgY29uc3QgeyByZXN1bHQgfSA9IHJlbmRlcldpdGhQcm92aWRlcih7CiAgICAgICAgYWNjb3VudHM6IHsKICAgICAgICAgIFttbmVtb25pY0FjY291bnQuYWRkcmVzc106IG1uZW1vbmljQWNjb3VudCwKICAgICAgICAgIFtyZWFkb25seUFjY291bnQuYWRkcmVzc106IHJlYWRvbmx5QWNjb3VudCwKICAgICAgICB9LAogICAgICB9KQoKICAgICAgLy8gU2hvdWxkIGhhdmUgYm90aCB3YWxsZXRzCiAgICAgIGNvbnN0IHdhbGxldHMgPSByZXN1bHQuY3VycmVudC5nZXRTdGF0ZSgpLndhbGxldHMKICAgICAgZXhwZWN0KE9iamVjdC5rZXlzKHdhbGxldHMpKS50b0hhdmVMZW5ndGgoMikKICAgICAgZXhwZWN0KHdhbGxldHMuc3RvcmVkX21uZW1vbmljX3dhbGxldCkudG9CZURlZmluZWQoKQogICAgICBleHBlY3Qod2FsbGV0c1sncmVhZG9ubHlfaW1wb3J0X3dhbGxldC0weGFiY2RlZmFiY2RlZmFiY2RlZmFiY2RlZmFiY2RlZmFiY2RlZmFiY2QnXSkudG9CZURlZmluZWQoKQogICAgfSkKICB9KQoKICBkZXNjcmliZSgnU1ZNIHBsYXRmb3JtIHN1cHBvcnQnLCAoKSA9PiB7CiAgICBpdCgnc2hvdWxkIHJldHVybiB1bmRlZmluZWQgZm9yIFNWTSBjb25uZWN0b3IgKG5vdCBpbXBsZW1lbnRlZCknLCAoKS91aS9zb25uZXIiCmltcG9ydCB7IFRvYXN0ZXIgYXMgTmV3WW9ya1RvYXN0ZXIgfSBmcm9tICJAL3JlZ2lzdHJ5L25ldy15b3JrL3VpL3RvYXN0ZXIiCgpleHBvcnQgY29uc3QgbWV0YWRhdGE6IE1ldGFkYXRhID0gewogIHRpdGxlOiB7CiAgICBkZWZhdWx0OiBzaXRlQ29uZmlnLm5hbWUsCiAgICB0ZW1wbGF0ZTogYCVzIC0gJHtzaXRlQ29uZmlnLm5hbWV9YCwKICB9LAogIG1ldGFkYXRhQmFzZTogbmV3IFVSTChzaXRlQ29uZmlnLnVybCksCiAgZGVzY3JpcHRpb246IHNpdGVDb25maWcuZGVzY3JpcHRpb24sCiAga2V5d29yZHM6IFsKICAgICJOZXh0LmpzIiwKICAgICJSZWFjdCIsCiAgICAiVGFpbHdpbmQgQ1NTIiwKICAgICJTZXJ2ZXIgQ29tcG9uZW50cyIsCiAgICAiUmFkaXggVUkiLAogIF0sCiAgYXV0aG9yczogWwogICAgewogICAgICBuYW1lOiAic2hhZGNuIiwKICAgICAgdXJsOiAiaHR0cHM6Ly9zaGFkY24uY29tIiwKICAgIH0sCiAgXSwKICBjcmVhdG9yOiAic2hhZGNuIiwKICBvcGVuR3JhcGg6IHsKICAgIHR5cGU6ICJ3ZWJzaXRlIiwKICAgIGxvY2FsZTogImVuX1VTIiwKICAgIHVybDogc2l0ZUNvbmZpZy51cmwsCiAgICB0aXRsZTogc2l0ZUNvbmZpZy5uYW1lLAogICAgZGVzY3JpcHRpb246IHNpdGVDb25maWcuZGVzY3JpcHRpb24sCiAgICBzaXRlTmFtZTogc2l0ZUNvbmZpZy5uYW1lLAogICAgaW1hZ2VzOiBbCiAgICAgIHsKICAgICAgICB1cmw6IHNpdGVDb25maWcub2dJbWFnZSwKICAgICAgICB3aWR0aDogMTIwMCwKICAgICAgICBoZWlnaHQ6IDYzMCwKICAgICAgICBhbHQ6IHNpdGVDb25maWcubmFtZSwKICAgICAgfSwKICAgIF0sCiAgfSwKICB0d2l0dGVyOiB7CiAgICBjYXJkOiAic3VtbWFyeV9sYXJnZV9pbWFnZSIsCiAgICB0aXRsZTogc2l0ZUNvbmZpZy5uYW1lLAogICAgZGVzY3JpcHRpb246IHNpdGVDb25maWcuZGVzY3JpcHRpb24sCiAgICBpbWFnZXM6IFtzaXRlQ29uZmlnLm9nSW1hZ2VdLAogICAgY3JlYXRvcjogIkBzaGFkY24iLAogIH0sCiAgaWNvbnM6IHsKICAgIGljb246ICIvZmF2aWNvbi5pY28iLAogICAgc2hvcnRjdXQ6ICIvZmF2aWNvbi0xNngxNi5wbmciLAogICAgYXBwbGU6ICIvYXBwbGUtdG91Y2gtaWNvbi5wbmciLAogIH0sCiAgbWFuaWZlc3Q6IGAke3NpdGVDb25maWcudXJsfS9zaXRlLndlYm1hbmlmZXN0YCwKfQoKZXhwb3J0IGNvbnN0IHZpZXdwb3J0OiBWaWV3cG9ydCA9IHsKICB0aGVtZUNvbG9yOiBNRVRBX1RIRU1FX0NPTE9SUy5saWdodCwKfQoKaW50ZXJmYWNlIFJvb3RMYXlvdXRQcm9wcyB7CiAgY2hpbGRyZW46IFJlYWN0LlJlYWN0Tm9kZQp9CgpleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBSb290TGF5b3V0KHsgY2hpbGRyZW4gfTogUm9vdExheW91dFByb3BzKSB7CiAgcmV0dXJuICgKICAgIDw+CiAgICAgIDxodG1sIGxhbmc9ImVuIiBzdXBwcmVzc0h5ZHJhdGlvbldhcm5pbmc+CiAgICAgICAgPGhlYWQ+CiAgICAgICAgICA8c2NyaXB0CiAgICAgICAgICAgIGRhbmdlcm91c2x5U2V0SW5uZXJIVE1MPXt7CiAgICAgICAgICAgICAgX19odG1sOiBgCiAgICAgICAgICAgICAgdHJ5IHsKICAgICAgICAgICAgICAgIGlmIChsb2NhbFN0b3JhZ2UudGhlbWUgPT09ICdkYXJrJyB8fCAoKCEoJ3RoZW1lJyBpbiBsb2NhbFN0b3JhZ2UpIHx8IGxvY2FsU3RvcmFnZS50aGVtZSA9PT0gJ3N5c3RlbScpICYmIHdpbmRvdy5tYXRjaE1lZGlhKCcocHJlZmVycy1jb2xvci1zY2hlbWU6IGRhcmspJykubWF0Y2hlcykpIHsKICAgICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcignbWV0YVtuYW1lPSJ0aGVtZS1jb2xvciJdJykuc2V0QXR0cmlidXRlKCdjb250ZW50JywgJyR7TUVUQV9USEVNRV9DT0xPUlMuZGFya30nKQogICAgICAgICAgICAgICAgfQogICAgICAgICAgICAgIH0gY2F0Y2ggKF8pIHt9CiAgICAgICAgICAgIGAsCiAgdCBhZGRpdGlvbmFsVG9rZW4xQW1vdW50ID0gQ3VycmVuY3lBbW91bnQuZnJvbVJhd0Ftb3VudCgKICAgICAgdXBkYXRlZEN1cnJlbmN5QW1vdW50cy5UT0tFTjEuY3VycmVuY3ksCiAgICAgIGN1cnJlbmN5MUFtb3VudC5xdW90aWVudCwKICAgICkKICAgIHJldHVybiB1cGRhdGVkQ3VycmVuY3lBbW91bnRzLlRPS0VOMS5hZGQoYWRkaXRpb25hbFRva2VuMUFtb3VudCkKICB9LCBbY3VycmVuY3kxQW1vdW50LCB1cGRhdGVkQ3VycmVuY3lBbW91bnRzPy5UT0tFTjFdKQogIGNvbnN0IG5ld1Rva2VuMUFtb3VudFVTRCA9IHVzZVVTRENWYWx1ZShuZXdUb2tlbjFBbW91bnQpCgogIGNvbnN0IG9uRmFpbHVyZSA9IChlPzogdW5rbm93bikgPT4gewogICAgaWYgKGUpIHsKICAgICAgc2V0VHJhbnNhY3Rpb25FcnJvcigKICAgICAgICBnZXRFcnJvck1lc3NhZ2VUb0Rpc3BsYXkoewogICAgICAgICAgY2FsbGRhdGFFcnJvcjogZSwKICAgICAgICB9KSwKICAgICAgKQogICAgfQogICAgc2V0U3RlcChJbmNyZWFzZUxpcXVpZGl0eVN0ZXAuSW5wdXQpCiAgICBzZXRDdXJyZW50VHJhbnNhY3Rpb25TdGVwKHVuZGVmaW5lZCkKICB9CgogIGNvbnN0IG9uU3VjY2VzcyA9ICgpID0+IHsKICAgIHNldFN0ZXBzKFtdKQogICAgc2V0Q3VycmVudFRyYW5zYWN0aW9uU3RlcCh1bmRlZmluZWQpCiAgICBvbkNsb3NlKCkKICB9CgogIGNvbnN0IG9uSW5jcmVhc2VMaXF1aWRpdHkgPSAoKSA9PiB7CiAgICBjb25zdCBpc1ZhbGlkVHggPSBpc1ZhbGlkTGlxdWlkaXR5VHhDb250ZXh0KHR4SW5mbykKICAgIGlmICgKICAgICAgIWFjY291bnQgfHwKICAgICAgIWlzU2lnbmVyTW5lbW9uaWNBY2NvdW50RGV0YWlscyhhY2NvdW50KSB8fAogICAgICAhaXNWYWxpZFR4IHx8CiAgICAgICFpbmNyZWFzZUxpcXVpZGl0eVN0YXRlLnBvc2l0aW9uIHx8CiAgICAgICFjdXJyZW5jeUFtb3VudHM/LlRPS0VOMCB8fAogICAgICAhY3VycmVuY3lBbW91bnRzLlRPS0VOMQogICAgKSB7CiAgICAgIHJldHVybgogICAgfQoKICAgIGRpc3BhdGNoKAogICAgICBsaXF1aWRpdHlTYWdhLmFjdGlvbnMudHJpZ2dlcih7CiAgICAgICAgc2VsZWN0Q2hhaW4sCiAgICAgICAgc3RhcnRDaGFpbklkLAogICAgICAgIGFjY291bnQsCiAgICAgICAgbGlxdWlkaXR5VHhDb250ZXh0OiB0eEluZm8sCiAgICAgICAgc2V0Q3VycmVudFN0ZXA6IHNldEN1cnJlbnRUcmFuc2FjdGlvblN0ZXAsCiAgICAgICAgc2V0U3RlcHMsCiAgICAgICAgb25TdWNjZXNzLAogICAgICAgIG9uRmFpbHVyZSwKICAgICAgICBkaXNhYmxlT25lQ2xpY2tTd2FwLAogICAgICAgIGFuYWx5dGljczogewogICAgICAgICAgLi4uZ2V0TFBCYXNlQW5hbHl0aWNzUHJvcGVydGllcyh7CiAgICAgICAgICAgIHRyYWNlLAogICAgICAgICAgICBmZWU6IGZlZVRpZXI/LmZlZUFtb3VudCwKICAgICAgICAgICAgdGlja1NwYWNpbmcsCiAgICAgICAgICAgIHRpY2tMb3dlciwKICAgICAgICAgICAgdGlja1VwcGVyLAogICAgICAgICAgICBob29rOiB2NGhvb2ssCiAgICAgICAgICAgIHZlcnNpb24sCiAgICAgICAgICAgIHBvb2xJZCwKICAgICAgICAgICAgY3VycmVuY3kwOiBjdXJyZW5jeUFtb3VudHMuVE9LRU4wLmN1cnJlbmN5LAogICAgICAgICAgICBjdXJyZW5jeTE6IGN1cnJlbmN5QW1vdW50cy5UT0tFTjEuY3VycmVuY3ksCiAgICAgICAgICAgIGN1cnJlbmN5MEFtb3VudFVzZDogdXBkYXRlZFVTREFtb3VudHM/LlRPS0VOMCwKICAgICAgICAgICAgY3VycmVuY3kxQW1vdW50VXNkOiB1cGRhdGVkVVNEQW1vdW50cz8uVE9LRU4xLAogICAgICAgICAgfSksCiAgICAgICAgICBleHBlY3RlZEFtb3VudEJhc2VSYXc6IHVwZGF0ZWRDdXJyZW5jeUFtb3VudHM/LlRPS0VOMD8ucXVvdGllbnQudG9TdHJpbmcoKSwKICAgICAgICAgIGV4cGVjdGVkQW1vdW50UXVvdGVSYXc6IHVwZGF0ZWRDdXJyZW5jeUFtb3VudHM/LlRPS0VOMT8ucXVvLXhsIGJnLW11dGVkLzUwIG1kOm1pbi1oLW1pbiIgLz4KICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvU2lkZWJhckluc2V0PgogICAgICA8L1NpZGViYXJQcm92aWRlcj4KICAgIDwvZGl2PgogICkKfQppbXBvcnQgeyBUb29sdGlwUHJvdmlkZXIgfSBmcm9tICJAcmFkaXgtdWkvcmVhY3QtdG9vbHRpcCI7CmltcG9ydCB7IHJlbmRlciwgcmVuZGVySG9vaywgc2NyZWVuIH0gZnJvbSAiQHRlc3RpbmctbGlicmFyeS9yZWFjdCI7Ci8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBuby1yZXN0cmljdGVkLWltcG9ydHMKaW1wb3J0IHsgbm9vcCB9IGZyb20gImxvZGFzaCI7CmltcG9ydCB7IHVzZUZpZWxkQXJyYXksIHVzZUZvcm0sIEZvcm1Qcm92aWRlciB9IGZyb20gInJlYWN0LWhvb2stZm9ybSI7CmltcG9ydCB7IHZpIH0gZnJvbSAidml0ZXN0IjsKCmltcG9ydCBkYXlqcyBmcm9tICJAY2FsY29tL2RheWpzIjsKaW1wb3J0IERhdGVPdmVycmlkZUxpc3QgZnJvbSAiQGNhbGNvbS9mZWF0dXJlcy9zY2hlZHVsZXMvY29tcG9uZW50cy9EYXRlT3ZlcnJpZGVMaXN0IjsKaW1wb3J0IHR5cGUgeyBUaW1lUmFuZ2UgfSBmcm9tICJAY2FsY29tL3R5cGVzL3NjaGVkdWxlIjsKCnZpLm1vY2soIm5leHQvbmF2aWdhdGlvbiIsIGFzeW5jIChpbXBvcnRPcmlnaW5hbCkgPT4gewogIGNvbnN0IGFjdHVhbCA9IGF3YWl0IGltcG9ydE9yaWdpbmFsPHR5cGVvZiBpbXBvcnQoIm5leHQvbmF2aWdhdGlvbiIpPigpOwogIHJldHVybiB7CiAgICAuLi5hY3R1YWwsCiAgICB1c2VSb3V0ZXI6IHZpLmZuKCgpID0+ICh7CiAgICAgIHB1c2g6IHZpLmZuKCgpID0+IHsKICAgICAgICByZXR1cm47CiAgICAgIH0pLAogICAgfSkpLAogIH07Cn0pOwoKdHlwZSBGb3JtVmFsdWVzID0gewogIGRhdGVPdmVycmlkZXM6IHsgcmFuZ2VzOiBUaW1lUmFuZ2VbXSB9W107Cn07CgpkZXNjcmliZSgiRGF0ZU92ZXJyaWRlTGlzdCIsICgpID0+IHsKICBpdCgicmVuZGVycyBEYXRlT3ZlcnJpZGVMaXN0IGNvbXBvbmVudCBpbiBtaWxpdGFyeSB0aW1lIiwgKCkgPT4gewogICAgY29uc3QgeyByZXN1bHQgfSA9IHJlbmRlckhvb2soKCkgPT4KICAgICAgdXNlRm9ybTxGb3JtVmFsdWVzPih7CiAgICAgICAgdmFsdWVzOiB7CiAgICAgICAgICBkYXRlT3ZlcnJpZGVzOiBbCiAgICAgICAgICAgIHsKICAgICAgICAgICAgICByYW5nZXM6IFsKICAgICAgICAgICAgICAgIHsKICAgICAgICAgICAgICAgICAgc3RhcnQ6IGRheWpzLnV0YygpLnN0YXJ0T2YoImRheSIpLmFkZCg1NDAsICJtaW51dGUiKS50b0RhdGUoKSwKICAgICAgICAgICAgICAgICAgZW5kOiBkYXlqcy51dGMoKS5zdGFydE9mKCJkYXkiKS5hZGQoMTAyMCwgIm1pbnV0ZSIpLnRvRGF0ZSgpLAogICAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgICBdLAogICAgICAgICAgICB9LAogICAgICAgICAgXSwKICAgICAgICB9LAogICAgICB9KQogICAgKTsKICAgIGNvbnN0IG1ldGhvZHMgPSByZXN1bHQuY3VycmVudDsKICAgIGNvbnN0IHsgY29udHJvbCB9ID0gbWV0aG9kczsKCiAgICBjb25zdCB7IHJlc3VsdDogZmllbGRBcnJheVJlc3VsdCB9ID0gcmVuZGVySG9vaygoKSA9PiB1c2VGaWVsZEFycmF5KHsgY29udHJvbCwgbmFtZTogImRhdGVPdmVycmlkZXMiIH0pKTsKICAgIHJlbmRlcigKICAgICAgPFRvb2x0aXBQcm92aWRlcj4KICAgICAgICA8Rm9ybVByb3ZpZGVyIHsuLi5tZXRob2RzfT4KICAgICAgICAgIDxEYXRlT3ZlcnJpZGVMaXN0CiAgICAgICAgICAgIGhvdXIxMj17ZmFsc2V9CiAgICAgICAgICAgIHVzZXJUaW1lRm9ybWF0PXsyNH0KICAgICAgICAgICAgZmllbGRzPXtmaWVsZEFycmF5UmVzdWx0LmN1cnJlbnQuZmllbGRzfQogICAgICAgICAgICByZXBsYWNlPXtmaWVsZEFycmF5UmVzdWx0LmN1cnJlbnQucmVwbGFjZX0KICAgICAgICAgICAgd29ya2luZ0hvdXJzPXtbXX0KICAgICAgICAgICAgaGFuZGxlQXZhaWxhYmlsaXR5VXBkYSB7CiAgSG92ZXJDYXJkLAogIEhvdmVyQ2FyZENvbnRlbnQsCiAgSG92ZXJDYXJkVHJpZ2dlciwKICBIb3ZlckNhcmRQb3J0YWwsCn0gZnJvbSAiQGNhbGNvbS91aS9jb21wb25lbnRzL2hvdmVyLWNhcmQiOwppbXBvcnQgeyBJY29uIH0gZnJvbSAiQGNhbGNvbS91aS9jb21wb25lbnRzL2ljb24iOwoKaW1wb3J0IHR5cGUgeyBSb3V0aW5nRm9ybVRhYmxlUm93IH0gZnJvbSAiQGNhbGNvbS93ZWIvbW9kdWxlcy9pbnNpZ2h0cy9saWIvdHlwZXMiOwppbXBvcnQgeyBCb29raW5nU3RhdHVzQmFkZ2UgfSBmcm9tICIuL0Jvb2tpbmdTdGF0dXNCYWRnZSI7CgpleHBvcnQgZnVuY3Rpb24gQm9va2luZ0F0Q2VsbCh7IHJvdywgcm93SWQgfTogeyByb3c6IFJvdXRpbmdGb3JtVGFibGVSb3c7IHJvd0lkOiBudW1iZXIgfSkgewogIGNvbnN0IGNlbGxJZCA9IHVzZUlkKCk7CiAgY29uc3QgeyBjb3B5VG9DbGlwYm9hcmQgfSA9IHVzZUNvcHkoKTsKCiAgaWYgKCFyb3cuYm9va2luZ1VzZXJJZCB8fCAhcm93LmJvb2tpbmdDcmVhdGVkQXQpIHsKICAgIHJldHVybiA8ZGl2IGNsYXNzTmFtZT0idy1bMjUwcHhdIiAvPjsKICB9CgogIHJldHVybiAoCiAgICA8SG92ZXJDYXJkPgogICAgICA8SG92ZXJDYXJkVHJpZ2dlciBhc0NoaWxkPgogICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiIga2V5PXtgJHtjZWxsSWR9LWJvb2tpbmctJHtyb3dJZH1gfT4KICAgICAgICAgIDxBdmF0YXIgc2l6ZT0ieHMiIGltYWdlU3JjPXtyb3cuYm9va2luZ1VzZXJBdmF0YXJVcmwgPz8gIiJ9IGFsdD17cm93LmJvb2tpbmdVc2VyTmFtZSA/PyAiIn0gLz4KICAgICAgICAgIDxMaW5rIGhyZWY9e2AvYm9va2luZy8ke3Jvdy5ib29raW5nVWlkfWB9PgogICAgICAgICAgICA8QmFkZ2UgdmFyaWFudD0iZ3JheSI+e2RheWpzKHJvdy5ib29raW5nQ3JlYXRlZEF0KS5mb3JtYXQoIk1NTSBELCBZWVlZIEhIOm1tIil9PC9CYWRnZT4KICAgICAgICAgIDwvTGluaz4KICAgICAgICA8L2Rpdj4KICAgICAgPC9Ib3ZlckNhcmRUcmlnZ2VyPgogICAgICA8SG92ZXJDYXJkUG9ydGFsPgogICAgICAgIDxIb3ZlckNhcmRDb250ZW50PgogICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggZmxleC1jb2wiPgogICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIiPgogICAgICAgICAgICAgIDxBdmF0YXIgc2l6ZT0ic20iIGltYWdlU3JjPXtyb3cuYm9va2luZ1VzZXJBdmF0YXJVcmwgPz8gIiJ9IGFsdD17cm93LmJvb2tpbmdVc2VyTmFtZSA/PyAiIn0gLz4KICAgICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgICAgPHAgY2xhc3NOYW1lPSJ0ZXh0LXNtIGZvbnQtbWVkaXVtIj57cm93LmJvb2tpbmdVc2VyTmFtZX08L3A+CiAgICAgICAgICAgICAgICA8cCBjbGFzc05hbWU9Imdyb3VwL2Jvb2tpbmdfc3RhdHVzX2VtYWlsIHRleHQtc3VidGxlIGZsZXggaXRlbXMtY2VudGVyIHRleHQteHMiPgogICAgICAgICAgICAgICAgICA8c3BhbiBjbGFzc05hbWU9InRydW5jYXRlIj57cm93LmJvb2tpbmdVc2VyRW1haWx9PC9zcGFuPgogICAgICAgICAgICAgICAgICA8YnV0dG9uCiAgICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPSJpbnZpc2libGUgbWwtMiBncm91cC1ob3Zlci9ib29raW5nX3N0YXR1c19lbWFpbDp2aXNpYmxlIgogICAgICAgICAgICAgICAgICAgIG9uQ2xpY2s9eyhlKSA9PiB7CiAgICAgICAgICAgICAgICAgICAgICBlLnByZXZlbnREZWZhdWx0KCk7CiAgICAgICAgICAgICAgICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpOwogICAgICAgICAgICAgICAgICAgICAgY29weVRvQ2xpcGJvYXJkKHJvdy5ib29raW5nVXNlckVtYWlsID8/ICIiKTsKICAgICAgICAgICAgICAgICAgICB9fT4KICAgICAgICAgICAgICAgICAgICA8SWNvbiBuYW1lPSJjb3B5IiAvPgpBUFRFUjogQWF2ZVYzT3B0aW1pc20uV0lUSERSQVdfU1dBUF9BREFQVEVSLAogICAgfSwKICB9LAogIFtDdXN0b21NYXJrZXQucHJvdG9faG9yaXpvbl92M106IHsKICAgIG1hcmtldFRpdGxlOiAnSG9yaXpvbiBSV0EnLAogICAgbWFya2V0OiBDdXN0b21NYXJrZXQucHJvdG9faG9yaXpvbl92MywKICAgIGNoYWluSWQ6IENoYWluSWQubWFpbm5ldCwKICAgIHYzOiB0cnVlLAogICAgbG9nbzogJy9pY29ucy9tYXJrZXRzL2hvcml6b24uc3ZnJywKICAgIGFkZHJlc3NlczogewogICAgICBMRU5ESU5HX1BPT0xfQUREUkVTU19QUk9WSURFUjogJzB4NUQzOUUwNmI4MjVDMUYyQjgwYmYyNzU2YTczZTI4ZUZBQTEyOGJhMCcsCiAgICAgIExFTkRJTkdfUE9PTDogJzB4QWUwNUNkMjJkZjgxODcxYmM3Y0MyYTA0QmVDZmI1MTZiRmUzMzJDOCcsCiAgICAgIFdFVEhfR0FURVdBWTogJzB4OTczMTk1ZkI4RjY3RjVCMGFmZTdiZURCMkEwMmNlYzgyOWQ4OTk5MScsCiAgICAgIC8vIFJFUEFZX1dJVEhfQ09MTEFURVJBTF9BREFQVEVSOiBBYXZlVjNFdGhlcmV1bUxpZG8uUkVQQVlfV0lUSF9DT0xMQVRFUkFMX0FEQVBURVIsCiAgICAgIC8vIFNXQVBfQ09MTEFURVJBTF9BREFQVEVSOiBBYXZlVjNFdGhlcmV1bUxpZG8uU1dBUF9DT0xMQVRFUkFMX0FEQVBURVIsCiAgICAgIFdBTExFVF9CQUxBTkNFX1BST1ZJREVSOiAnMHhkOEY3ODI5Y2VCMjY5MkM5MGU0MThlMDk2M2I1Q2JjYmFmYzI2MEJkJywKICAgICAgVUlfUE9PTF9EQVRBX1BST1ZJREVSOiBBYXZlVjNFdGhlcmV1bS5VSV9QT09MX0RBVEFfUFJPVklERVIsCiAgICAgIFVJX0lOQ0VOVElWRV9EQVRBX1BST1ZJREVSOiAnMHhDNUUxNzE3QkVhZkM2ODBFMDE0OERENTYxNTkxNDEwYjY5NjUwYTVGJywKICAgICAgQ09MTEVDVE9SOiAnMHg4YjhkNDQ3NTFhOTMzZjE5MGRkZTI1QTY5RThjQzZGOTEwMWI1NDM1JywKICAgICAgLy8gV0lUSERSQVdfU1dJVENIX0FEQVBURVI6IEFhdmVWM0V0aGVyZXVtTGlkby5XSVRIRFJBV19TV0FQX0FEQVBURVIsCiAgICAgIC8vIERFQlRfU1dJVENIX0FEQVBURVI6IEFhdmVWM0V0aGVyZXVtTGlkby5ERUJUX1NXQVBfQURBUFRFUiwKICAgIH0sCiAgfSwKICBbQ3VzdG9tTWFya2V0LnByb3RvX3BsYXNtYV92M106IHsKICAgIG1hcmtldFRpdGxlOiAnUGxhc21hJywKICAgIG1hcmtldDogQ3VzdG9tTWFya2V0LnByb3RvX3BsYXNtYV92MywKICAgIGNoYWluSWQ6IENoYWluSWQucGxhc21hLAogICAgdjM6IHRydWUsCiAgICBsb2dvOiAnL2ljb25zL25ldHdvcmtzL3BsYXNtYS5zdmcnLAogICAgYWRkcmVzc2VzOiB7CiAgICAgIExFTkRJTkdfUE9PTF9BRERSRVNTX1BST1ZJREVSOiBBYXZlVjNQbGFzbWEuUE9PTF9BRERSRVNTRVNfUFJPVklERVIsCiAgICAgIExFTkRJTkdfUE9PTDogQWF2ZVYzUGxhc21hLlBPT0wsCiAgICAgIFdFVEhfR0FURVdBWTogQWF2ZVYzUGxhc21hLldFVEhfR0FURVdBWSwKICAgICAgV0FMTEVUX0JBTEFOQ0VfUFJPVklERVI6IEFhdmVWM1BsYXNtYS5XQUxMRVRfQkFMQU5DRV9QUk9WSURFUiwKICAgICAgVUlfUE9PTF9EQVRBX1BST1ZJREVSOiBBYXZlVjNQbGFzbWEuVUlfUE9PTF9EQVRBX1BST1ZJREVSLAogICAgICBVSV9JTkNFTlRJVkVfREFUQV9QUk9WSURFUjogQWF2ZVYzUGxhc21hLlVJX0lOQ0VOVElWRV9EQVRBX1BST1ZJREVSLAogICAgICBDT0xMRUNUT1I6IEFhdmVWM1BsYXNtYS5DT0xMRUNUT1IsCiAgICB9LAogICAgZW5hYmxlZEZlYXR1cmVzOiB7CiAgICAgIC8vIGxpcXVpZGl0eVN3YXA6IHRydWUsCiAgICAgIC8vIHdpdGhkcmF3QW5kU3dpdGNoOiB0cnVlLAogICAgICAvLyBjb2xsYXRlcmFsUmVwYXk6IHRydWUsCiAgICAgIC8vIGRlYnRTd2l0Y2g6IHRydWUsCiAgICAgIC8vIHN3aXRjaDogdHJ1ZSwKICAgIH0sCiAgfSwKICBbQ3VzdG9tTWFya2V0LnByb3RvX3BvbHlnb25fdjNdOiB7CiAgICBtYXJrZXRUaXRsZTogJ1BvbHlnb24nLAogIGlzQ2FsZW5kYXJWaWV3PXt0cnVlfQogICAgICAgICAgaXNNeUxpbms9e3RydWV9CiAgICAgICAgICBldmVudFNsdWc9e3Byb3BzLmV2ZW50U2x1Z30KICAgICAgICAgIGVuYWJsZWRMYXlvdXRzPXtib29rZXJMYXlvdXQuYm9va2VyTGF5b3V0cy5lbmFibGVkTGF5b3V0c30KICAgICAgICAgIGV4dHJhRGF5cz17N30KICAgICAgICAgIGlzTW9iaWxlPXtmYWxzZX0KICAgICAgICAgIG5leHRTbG90cz17Nn0KICAgICAgICAvPgogICAgICA8L0Jvb2tlclNlY3Rpb24+CiAgICAgIDxCb29rZXJTZWN0aW9uCiAgICAgICAga2V5PSJsYXJnZS1jYWxlbmRhciIKICAgICAgICBhcmVhPSJtYWluIgogICAgICAgIHZpc2libGU9e3RydWV9CiAgICAgICAgY2xhc3NOYW1lPSJib3JkZXItc3VidGxlIHN0aWNreSB0b3AtMCBtbC1bLTFweF0gaC1mdWxsIG1kOmJvcmRlci1sIj4KICAgICAgICA8TGFyZ2VDYWxlbmRhcgogICAgICAgICAgZXh0cmFEYXlzPXs3fQogICAgICAgICAgYXZhaWxhYmxlVGltZXNsb3RzPXthdmFpbGFibGVUaW1lU2xvdHN9CiAgICAgICAgICBpc0xvYWRpbmc9e3NjaGVkdWxlLmlzUGVuZGluZ30KICAgICAgICAgIGV2ZW50PXtldmVudH0KICAgICAgICAvPgogICAgICA8L0Jvb2tlclNlY3Rpb24+CiAgICA8L0F0b21zV3JhcHBlcj4KICApOwp9OwppbXBvcnQgeyB1c2VDYWxsYmFjaywgdXNlU3RhdGUgfSBmcm9tICdyZWFjdCcKaW1wb3J0IHR5cGUgeyBMYXlvdXRDaGFuZ2VFdmVudCB9IGZyb20gJ3JlYWN0LW5hdGl2ZScKaW1wb3J0IHR5cGUgeyBZU3RhY2tQcm9wcyB9IGZyb20gJ3RhbWFndWknCmltcG9ydCB7IGlzTW9iaWxlQXBwIH0gZnJvbSAndXRpbGl0aWVzL3NyYy9wbGF0Zm9ybScKCnR5cGUgUG9zc2libHlOdW1iZXIgPSBQb3NzaWJseVVuZGVmaW5lZDxudW1iZXI+Cgp0eXBlIFVzZUF1dG9EaW1lbnNpb25zUmV0dXJuID0gewogIG9uTGF5b3V0OiAoZXZlbnQ6IExheW91dENoYW5nZUV2ZW50KSA9PiB2b2lkCiAgd2lkdGg6IFlTdGFja1Byb3BzWyd3aWR0aCddCiAgaGVpZ2h0OiBZU3RhY2tQcm9wc1snaGVpZ2h0J10KfQoKdHlwZSBVc2VBdXRvRGltZW5zaW9uc1BhcmFtcyA9IFBhcnRpYWw8VXNlQXV0b0RpbWVuc2lvbnNSZXR1cm4+ICYgewogIHNob3VsZENvbnNpZGVyTWluaW11bURpbWVuc2lvbnM/OiBib29sZWFuCn0KCi8vIGV4cG9ydGluZyBmb3IgdGVzdHMKZXhwb3J0IGNvbnN0IERFRkFVTFRfTUlOX1dJRFRIID0gaXNNb2JpbGVBcHAgPyA0MCA6IDI0CmV4cG9ydCBjb25zdCBERUZBVUxUX01JTl9IRUlHSFQgPSBERUZBVUxUX01JTl9XSURUSAoKLyoqCiAqIE1lYXN1cmVzIHRoZSBkaW1lbnNpb25zIG9mIGEgY29tcG9uZW50IHVzaW5nIG9uTGF5b3V0IGFuZCByZXR1cm5zIGEgc3R5bGUgb2JqZWN0CiAqIHRvIGVuZm9yY2UgbWluaW11bSBkaW1lbnNpb25zIGlmIHByb3ZpZGVkLgogKiBAcGFyYW0gb25MYXlvdXRQYXJhbSAtIE9wdGlvbmFsIGNhbGxiYWNrIGZ1bmN0aW9uIHRoYXQgd2lsbCBiZSBjYWxsZWQgYWxvbmcgd2l0aCB0aGUgaW50ZXJuYWwgbGF5b3V0IGhhbmRsZXIKICogQHJldHVybnMgQW4gb2JqZWN0IGNvbnRhaW5pbmcgdGhlIG9uTGF5b3V0IGhhbmRsZXIgYW5kIHRoZSBjYWxjdWxhdGVkIHN0eWxlLgogKi8KZXhwb3J0IGZ1bmN0aW9uIHVzZUF1dG9EaW1lbnNpb25zKHsKICBvbkxheW91dDogb25MYXlvdXRQYXJhbSwKICB3aWR0aDogd2lkdGhQYXJhbSwKICBoZWlnaHQ6IGhlaWdodFBhcmFtLAogIHNob3VsZENvbnNpZGVyTWluaW11bURpbWVuc2lvbnMgPSBmYWxzZSwKfTogVXNlQXV0b0RpbWVuc2lvbnNQYXJhbXMpOiBVc2VBdXRvRGltZW5zaW9uc1JldHVybiB7CiAgY29uc3QgW2RpbWVuc2lvbnMsIHNldERpbWVuc2lvbnNdID0gdXNlU3RhdGU8eyB3aWR0aDogUG9zc2libHlOdW1iZXI7IGhlaWdodDogUG9zc2libHlOdW1iZXIgfT4oewogICAgd2lkdGg6IHVuZGVmaW5lZCwKICAgIGhlaWdodDogdW5kZXRyeS91c2VyJwoKLy8gTW9jayB0aGUgaG9va3MKdmkubW9jaygnZmVhdHVyZXMvYWNjb3VudHMvc3RvcmUvaG9va3MnLCAoKSA9PiAoewogIHVzZUFjdGl2ZUFkZHJlc3NlczogdmkuZm4oKSwKICB1c2VBY3RpdmVXYWxsZXQ6IHZpLmZuKCksCiAgdXNlQ29ubmVjdGlvblN0YXR1czogdmkuZm4oKCkgPT4gKHsgaXNDb25uZWN0ZWQ6IHRydWUsIGlzQ29ubmVjdGluZzogZmFsc2UsIGlzRGlzY29ubmVjdGVkOiBmYWxzZSB9KSksCn0pKQp2aS5tb2NrKCdob29rcy91c2VBY2NvdW50JykKdmkubW9jaygnaG9va3MvdXNlRXRoZXJzUHJvdmlkZXInLCAoKSA9PiAoewogIHVzZUV0aGVyc1dlYjNQcm92aWRlcjogKCkgPT4gKHsKICAgIG9uOiB2aS5mbigpLAogICAgb2ZmOiB2aS5mbigpLAogICAgc2VuZDogdmkuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSgndjEnKSwKICB9KSwKfSkpCgpsZXQgbW9ja1dhZ21pQ2hhaW5JZCA9IDEKCnZpLm1vY2soJ3dhZ21pJywgYXN5bmMgKGltcG9ydE9yaWdpbmFsKSA9PiB7CiAgY29uc3QgYWN0dWFsID0gKGF3YWl0IGltcG9ydE9yaWdpbmFsKCkpIGFzIGFueQogIHJldHVybiB7CiAgICAuLi5hY3R1YWwsCiAgICB1c2VBY2NvdW50OiAoKSA9PiAoeyBjaGFpbklkOiBtb2NrV2FnbWlDaGFpbklkIH0pLAogIH0KfSkKCnZpLm1vY2soJ3VuaXN3YXAvc3JjL2ZlYXR1cmVzL3RlbGVtZXRyeS9zZW5kJywgKCkgPT4gKHsKICBzZW5kQW5hbHl0aWNzRXZlbnQ6IHZpLmZuKCksCn0pKQoKdmkubW9jaygndW5pc3dhcC9zcmMvZmVhdHVyZXMvdGVsZW1ldHJ5L3VzZXInLCBhc3luYyAoaW1wb3J0T3JpZ2luYWwpID0+IHsKICBjb25zdCBvcmlnaW5hbCA9IChhd2FpdCBpbXBvcnRPcmlnaW5hbCgpKSBhcyBhbnkKICByZXR1cm4gewogICAgLi4ub3JpZ2luYWwsCiAgICBzZXRVc2VyUHJvcGVydHk6IHZpLmZuKCksCiAgfQp9KQoKY29uc3QgQUNDT1VOVDEgPSAnMHgwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwJyBhcyBgMHgke3N0cmluZ31gCmNvbnN0IEFDQ09VTlQyID0gJzB4MDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMScgYXMgYDB4JHtzdHJpbmd9YApjb25zdCBTVk1fQUNDT1VOVDEgPSAnOVd6RFh3QmJta2c4WlRiTk1xVXh2UVJBeXJaekRzR1lkTFZMOXpZdEFXV00nCgpjb25zdCBjcmVhdGVNb2NrV2FsbGV0ID0gKG9wdGlvbnM6IHsgZXZtQWRkcmVzcz86IHN0cmluZzsgc3ZtQWRkcmVzcz86IHN0cmluZzsgbmFtZT86IHN0cmluZyB9KTogRXh0ZXJuYWxXYWxsZXQgPT4gewogIGNvbnN0IHsgZXZtQWRkcmVzcywgc3ZtQWRkcmVzcywgbmFtZSA9ICdNZXRhTWFzaycgfSA9IG9wdGlvbnMKICByZXR1cm4gewogICAgaWQ6IGV2bUFkZHJlc3MgfHwgc3ZtQWRkcmVzcyB8fCAnd2FsbGV0LWlkJywKICAgIG5hbWUsCiAgICBzaWduaW5nQ2FwYWJpbGl0eTogU2lnbmluZ0NhcGFiaWxpdHkuSW50ZXJhY3RpdmUsCiAgICBhZGRyZXNzZXM6IFsKICAgICAgewogICAgICAgIC4uLihldm1BZGRyZXNzID8geyBbUGxhdGZvcm0uRVZNXTogZXZtQWRkcmVzcyBhcyBgMHgke3N0cmluZ31gIH0gOiB7fSksCiAgICAgICAgLi4uKHN2bUFkZHJlc3MgPyB7IFtQbGF0Zm9ybS5TVk1dOiBzdm1BZGRyZXNzIH0gOiB7fSksCiAgICAgIH0sCiAgICBdLAogICAgY29ubmVjdG9ySWRzOiB7CiAgICAgIC4uLihldm1BZGRyZXNzID8geyBbUGxhdGZvcm0uRVZNXTogJ3Rlc3QtY29ubmVjdG9yLWV2bScgfSA6IHt9KSwKICAgICAgLi4uKHN2bUFkZHJlc3MgPyB7IFtQbGF0Zm9ybS5TVk1dOiAndGVzdC1jb25uZWN0b3Itc3ZtJyB9IDoge30pLAogICAgfSwKICAgIGFuYWx5dGljc1dhbGxldFR5cGU6ICdpbmplY3RlZCcsCiAgfQp9Cgpjb25zdCBtb2NrRGlzY29ubmVjdGVkQ29ubmVjdGlvblN0YXR1czogQ29ubmVjdGlvblN0YXR1c0luZm8gPSB7CiAgc3RhdHVzOiBDb25uZWN0b3JTdGF0dXMuRGlzY29yaWNlUHJvcHMgewogIHByaWNlOiBQcmljZTxDdXJyZW5jeSwgQ3VycmVuY3k+Cn0KCmNvbnN0IFN0eWxlZFByaWNlQ29udGFpbmVyID0gZGVwcmVjYXRlZFN0eWxlZC5idXR0b25gCiAgYmFja2dyb3VuZC1jb2xvcjogdHJhbnNwYXJlbnQ7CiAgYm9yZGVyOiBub25lOwogIGN1cnNvcjogcG9pbnRlcjsKICBhbGlnbi1pdGVtczogY2VudGVyOwogIGp1c3RpZnktY29udGVudDogZmxleC1zdGFydDsKICBwYWRkaW5nOiAwOwogIGdyaWQtdGVtcGxhdGUtY29sdW1uczogMWZyIGF1dG87CiAgZ3JpZC1nYXA6IDAuMjVyZW07CiAgZGlzcGxheTogZmxleDsKICBmbGV4LWRpcmVjdGlvbjogcm93OwogIHRleHQtYWxpZ246IGxlZnQ7CiAgZmxleC13cmFwOiB3cmFwOwogIHVzZXItc2VsZWN0OiB0ZXh0OwpgCgpleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBUcmFkZVByaWNlKHsgcHJpY2UgfTogVHJhZGVQcmljZVByb3BzKSB7CiAgY29uc3QgeyBmb3JtYXROdW1iZXJPclN0cmluZywgY29udmVydEZpYXRBbW91bnRGb3JtYXR0ZWQgfSA9IHVzZUxvY2FsaXphdGlvbkNvbnRleHQoKQoKICBjb25zdCBbc2hvd0ludmVydGVkLCBzZXRTaG93SW52ZXJ0ZWRdID0gdXNlU3RhdGU8Ym9vbGVhbj4oZmFsc2UpCgogIGNvbnN0IHsgYmFzZUN1cnJlbmN5LCBxdW90ZUN1cnJlbmN5IH0gPSBwcmljZQogIGNvbnN0IHsgZGF0YTogdXNkUHJpY2UgfSA9IHVzZVVTRFByaWNlKHRyeVBhcnNlQ3VycmVuY3lBbW91bnQoJzEnLCBzaG93SW52ZXJ0ZWQgPyBiYXNlQ3VycmVuY3kgOiBxdW90ZUN1cnJlbmN5KSkKCiAgY29uc3QgZm9ybWF0dGVkUHJpY2UgPSB1c2VNZW1vKCgpID0+IHsKICAgIHRyeSB7CiAgICAgIHJldHVybiBmb3JtYXROdW1iZXJPclN0cmluZyh7CiAgICAgICAgdmFsdWU6IChzaG93SW52ZXJ0ZWQgPyBwcmljZSA6IHByaWNlLmludmVydCgpKS50b1NpZ25pZmljYW50KCksCiAgICAgICAgdHlwZTogTnVtYmVyVHlwZS5Ub2tlblR4LAogICAgICB9KQogICAgfSBjYXRjaCB7CiAgICAgIHJldHVybiAnMCcKICAgIH0KICB9LCBbZm9ybWF0TnVtYmVyT3JTdHJpbmcsIHByaWNlLCBzaG93SW52ZXJ0ZWRdKQoKICBjb25zdCBsYWJlbCA9IHNob3dJbnZlcnRlZCA/IGAke3ByaWNlLnF1b3RlQ3VycmVuY3kuc3ltYm9sfWAgOiBgJHtwcmljZS5iYXNlQ3VycmVuY3kuc3ltYm9sfSBgCiAgY29uc3QgbGFiZWxJbnZlcnRlZCA9IHNob3dJbnZlcnRlZCA/IGAke3ByaWNlLmJhc2VDdXJyZW5jeS5zeW1ib2x9IGAgOiBgJHtwcmljZS5xdW90ZUN1cnJlbmN5LnN5bWJvbH1gCiAgY29uc3QgZmxpcFByaWNlID0gdXNlQ2FsbGJhY2soKCkgPT4gc2V0U2hvd0ludmVydGVkKCFzaG93SW52ZXJ0ZWQpLCBbc2hvd0ludmVydGVkXSkKCiAgY29uc3QgdGV4dCA9IGAkeycxICcgKyBsYWJlbEludmVydGVkICsgJyA9ICcgKyBmb3JtYXR0ZWRQcmljZX0gJHtsYWJlbH1gCgogIHJldHVybiAoCiAgICA8U3R5bGVkUHJpY2VDb250YWluZXIKICAgICAgb25DbGljaz17KGUpID0+IHsKICAgICAgICBlLnN0b3BQcm9wYWdhdGlvbigpIC8vIGRvbnQgd2FudCB0aGlzIGNsaWNrIHRvIGFmZmVjdCBkcm9wZG93bnMgLyBob3ZlcnMKICAgICAgICBmbGlwUHJpY2UoKQogICAgICB9fQogICAgICB0aXRsZT17dGV4dH0KICAgID4KICAgICAgPFRoZW1lZFRleHQuQm9keVNtYWxsPnt0ZXh0fTwvVGhlbWVkVGV4dC5Cb2R5U21hbGw+eycgJ30KICAgICAge3VzZFByaWNlICYmICgKICAgICAgICA8VGhlbWVkVGV4dC5Cb2R5U21hbGwgY29sb3I9Im5ldXRyYWwyIj4KICAgICAgICAgICh7Y29udmVydEZpYXRBbW91bnRGb3JtYXR0ZWQodXNkUHJpY2UsIE51bWJlclR5cGUuRmlhdFRva2VuUHJpY2UpfSkKICAgICAgICA8L1RoZW1lZFRleHQuQm9keVNtYWxsPgogICAgICApfQogICAgPC9TdHlsZWRQcmljZUNvbnRhaW5lcj4KICApCn0KaW1wb3J0IHsgdXNlQWN0aXZlQWRkcmVzc2VzLCB1c2VBY3RpdmVXYWxsZXQsIHVzTTEwLjAwMTMgMTguODQ2NEMxMS4xODI0IDE4Ljg0NjQgMTIuMzUxOCAxOC42MTM4IDEzLjQ0MyAxOC4xNjE4QzE0LjUzNDEgMTcuNzA5OCAxNS41MjU2IDE3LjA0NzQgMTYuMzYwNyAxNi4yMTIyQzE3LjE5NTggMTUuMzc3MSAxNy44NTgzIDE0LjM4NTcgMTguMzEwMiAxMy4yOTQ1QzE4Ljc2MjIgMTIuMjAzNCAxOC45OTQ4IDExLjAzMzkgMTguOTk0OCA5Ljg1Mjg3QzE4Ljk5NDggOC42NzE4MyAxOC43NjIyIDcuNTAyMzUgMTguMzEwMiA2LjQxMTIxQzE3Ljg1ODMgNS4zMjAwNyAxNy4xOTU4IDQuMzI4NjMgMTYuMzYwNyAzLjQ5MzUxQzE1LjUyNTYgMi42NTgzOSAxNC41MzQxIDEuOTk1OTMgMTMuNDQzIDEuNTQzOTZDMTIuMzUxOCAxLjA5MiAxMS4xODI0IDAuODU5Mzc1IDEwLjAwMTMgMC44NTkzNzVDNy42MTYwOSAwLjg1OTM3NSA1LjMyODU2IDEuODA2OSAzLjY0MTk1IDMuNDkzNTFDMS45NTUzNCA1LjE4MDEyIDEuMDA3ODEgNy40Njc2NSAxLjAwNzgxIDkuODUyODdDMS4wMDc4MSAxMi4yMzgxIDEuOTU1MzQgMTQuNTI1NiAzLjY0MTk1IDE2LjIxMjJDNS4zMjg1NiAxNy44OTg4IDcuNjE2MDkgMTguODQ2NCAxMC4wMDEzIDE4Ljg0NjRaIgogICAgICAgICAgZmlsbD0idXJsKCNwYWludDFfcmFkaWFsX3NhZmFyaSkiCiAgICAgICAgLz4KICAgICAgICA8cGF0aAogICAgICAgICAgZD0iTTEwLjA1NTUgMTguODM3NkMxMS4yMzY1IDE4LjgzNzYgMTIuNDA1OSAxOC42MDUgMTMuNDk3IDE4LjE1M0MxNC41ODgxIDE3LjcwMTEgMTUuNTc5NCAxNy4wMzg3IDE2LjQxNDUgMTYuMjAzNkMxNy4yNDk2IDE1LjM2ODUgMTcuOTEyIDE0LjM3NzEgMTguMzYzOSAxMy4yODZDMTguODE1OSAxMi4xOTUgMTkuMDQ4NSAxMS4wMjU1IDE5LjA0ODUgOS44NDQ1NkMxOS4wNDg1IDguNjYzNTggMTguODE1OSA3LjQ5NDE3IDE4LjM2MzkgNi40MDMwOUMxNy45MTIgNS4zMTIwMSAxNy4yNDk2IDQuMzIwNjMgMTYuNDE0NSAzLjQ4NTU1QzE1LjU3OTQgMi42NTA0NyAxNC41ODgxIDEuOTg4MDUgMTMuNDk3IDEuNTM2MTFDMTIuNDA1OSAxLjA4NDE3IDExLjIzNjUgMC44NTE1NjIgMTAuMDU1NSAwLjg1MTU2M0M3LjY3MDQxIDAuODUxNTYzIDUuMzgzIDEuNzk5MDQgMy42OTY0OSAzLjQ4NTU1QzIuMDA5OTcgNS4xNzIwNyAxLjA2MjUgNy40NTk0NyAxLjA2MjUgOS44NDQ1NkMxLjA2MjUgMTIuMjI5NyAyLjAwOTk3IDE0LjUxNzEgMy42OTY0OSAxNi4yMDM2QzUuMzgzIDE3Ljg5MDEgNy42NzA0MSAxOC44Mzc2IDEwLjA1NTUgMTguODM3NloiCiAgICAgICAgICBmaWxsPSJ1cmwoI3BhaW50Ml9saW5lYXJfc2FmYXJpKSIKICAgICAgICAgIGZpbGxPcGFjaXR5PSIwLjIiCiAgICAgICAgLz4KICAgICAgICA8cGF0aAogICAgICAgICAgZD0iTTE2LjI4MDQgNC4xNDA2Mkw5LjAyNjM4IDguNzkwNjNIOS4wMTkzOFY4Ljc5NzYzTDkuMDExMzcgOC44MDQ2M0w0LjQ4NDM4IDE2LjI3MTZMMTEuMTM4NCAxMC45MTY2TDExLjE0NjQgMTAuOTA4NlYxMC45MDE2TDE2LjI4MDQgNC4xNDA2MloiCiAgICAgICAgICBmaWxsPSJibGFjayIKICAgICAgICAgIGZpbGxPcGFjaXR5PSIwLjA1IgogICAgICAgIC8+CiAgICAgICAgPHBhdGggZD0iTTE2LjE0NjYgMy43MDcwM0w4Ljk3NjU2IDguODAzMDNMMTEuMTAyNiAxMC45MTVMMTYuMTQ2NiAzLjcwNzAzWiIgZmlsbD0iI0NEMTUxRSIgLz4KICAgICAgICA8cGF0aCBkPSJNOC45ODA0NyA4Ljc4OTAzTDEwLjA1MTUgOS44NDQwM0wxNi4xNDM1IDMuNzA3MDNMOC45ODA0NyA4Ljc4OTAzWiIgZmlsbD0iI0ZBNTE1MyIgLz4KICAgICAgICA8cGF0aCBkPSJNOC45ODA1IDguNzg5MDZMMTEuMTA3NSAxMC44OTkxTDMuOTM3NSAxNS45OTYxTDguOTgwNSA4Ljc4OTA2WiIgZmlsbD0iI0FDQUNBQyIgLz4KICAgICAgICA8cGF0aCBkPSJNMy45Mzc1IDE1Ljk5NzFMMTAuMDUyNSA5Ljg0NTA2TDguOTgxNSA4Ljc4OTA2TDMuOTM3NSAxNS45OTcxWiIgZmlsbD0iI0VFRUVFRSIgL3JpcGUgPSB1c2VTdHJpcGUoKTsKICBjb25zdCBlbGVtZW50cyA9IHVzZUVsZW1lbnRzKCk7CgogIGNvbnN0IFBheW1lbnRTdGF0dXMgPSAoeyBzdGF0dXMgfTogeyBzdGF0dXM6IHN0cmluZyB9KSA9PiB7CiAgICBzd2l0Y2ggKHN0YXR1cykgewogICAgICBjYXNlICJwcm9jZXNzaW5nIjoKICAgICAgY2FzZSAicmVxdWlyZXNfcGF5bWVudF9tZXRob2QiOgogICAgICBjYXNlICJyZXF1aXJlc19jb25maXJtYXRpb24iOgogICAgICAgIHJldHVybiA8aDI+UHJvY2Vzc2luZy4uLjwvaDI+OwoKICAgICAgY2FzZSAicmVxdWlyZXNfYWN0aW9uIjoKICAgICAgICByZXR1cm4gPGgyPkF1dGhlbnRpY2F0aW5nLi4uPC9oMj47CgogICAgICBjYXNlICJzdWNjZWVkZWQiOgogICAgICAgIHJldHVybiA8aDI+UGF5bWVudCBTdWNjZWVkZWQg8J+lszwvaDI+OwoKICAgICAgY2FzZSAiZXJyb3IiOgogICAgICAgIHJldHVybiAoCiAgICAgICAgICA8PgogICAgICAgICAgICA8aDI+RXJyb3Ig8J+YrTwvaDI+CiAgICAgICAgICAgIDxwIGNsYXNzTmFtZT0iZXJyb3ItbWVzc2FnZSI+e2Vycm9yTWVzc2FnZX08L3A+CiAgICAgICAgICA8Lz4KICAgICAgICApOwoKICAgICAgZGVmYXVsdDoKICAgICAgICByZXR1cm4gbnVsbDsKICAgIH0KICB9OwoKICBjb25zdCBoYW5kbGVJbnB1dENoYW5nZTogUmVhY3QuQ2hhbmdlRXZlbnRIYW5kbGVyPEhUTUxJbnB1dEVsZW1lbnQ+ID0gKGUpID0+IHsKICAgIHNldElucHV0KHsKICAgICAgLi4uaW5wdXQsCiAgICAgIFtlLmN1cnJlbnRUYXJnZXQubmFtZV06IGUuY3VycmVudFRhcmdldC52YWx1ZSwKICAgIH0pOwoKICAgIGVsZW1lbnRzPy51cGRhdGUoeyBhbW91bnQ6IGlucHV0LmN1c3RvbURvbmF0aW9uICogMTAwIH0pOwogIH07CgogIGNvbnN0IGhhbmRsZVN1Ym1pdDogUmVhY3QuRm9ybUV2ZW50SGFuZGxlcjxIVE1MRm9ybUVsZW1lbnQ+ID0gYXN5bmMgKGUpID0+IHsKICAgIHRyeSB7CiAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgLy8gQWJvcnQgaWYgZm9ybSBpc24ndCB2YWxpZAogICAgICBpZiAoIWUuY3VycmVudFRhcmdldC5yZXBvcnRWYWxpZGl0eSgpKSByZXR1cm47CiAgICAgIGlmICghZWxlbWVudHMgfHwgIXN0cmlwZSkgcmV0dXJuOwoKICAgICAgc2V0UGF5bWVudCh7IHN0YXR1czogInByb2Nlc3NpbmciIH0pOwoKICAgICAgY29uc3QgeyBlcnJvcjogc3VibWl0RXJyb3IgfSA9IGF3YWl0IGVsZW1lbnRzLnN1Ym1pdCgpOwoKICAgICAgaWYgKHN1Ym1pdEVycm9yKSB7CiAgICAgICAgc2V0UGF5bWVudCh7IHN0YXR1czogImVycm9yIiB9KTsKICAgICAgICBzZXRFcnJvck1lc3NhZ2Uoc3VibWl0RXJyb3IubWVzc2FnZSA/PyAiQW4gdW5rbm93biBlcnJvciBvY2N1cnJlZCIpOwoKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIC8vIENyZWF0ZSBhIFBheW1lbnRJbnRlbnQgd2l0aCB0aGUgc3BlY2lmaWVkIGFtb3VudC4KICAgICAgY29uc3QgeyBjbGllbnRfc2VjcmV0OiBjbGllbnRTZWNyZXQgfSA9IGF3YWl0IGNyZWF0ZVBheW1lbnRJbnRlbnQoCiAgICAgICAgbmV3IEZvcm1EYXRhKGUudGFyZ2V0IGFzIEhUTUxGb3JtRWxlbWVudCksCiAgICAgICk7CgogICAgICAvLyBVc2UgeW91ciBjYXJkIEVsZW1lbnQgd2l0aCBvdGhlciBTdHJpcGUuanMgQVBJcwogICAgICBjb25zdCB7IGVycm9yOiBjb25maXJtRXJyb3IgfSA9IGF3YWl0IHN0cmlwZSEuY29uZmlybVBheW1lbnQoewogICAgICAgIGVsZW1lbnRzLAogICAgICAgIGNsaWVudFNlY3JldCwKICAgICAgICBjb25maXJtUGFyYW1zOiB7CiAgICAgICAgICByZXR1cm5fdXJsOiBgJHt3aW5kb3cubG9jYXRpb24ub3JpZ2lufS9kb25hdGUtd2l0aC1lbGVtZW50cy9yZXN1bHRgLAogICAgICAgICAgcGF5bWVudF9tZXRob2RfZGF0YTogewogICAgICAgICAgICBiaWxsaW5nX2RldGFpbHM6IHsKICAgICAgICAgICAgICBuYW1lOiBpbnB1dC5jYXJkaG9sZGVyTmF7CiAgQXVkaW9XYXZlZm9ybSwKICBCb29rT3BlbiwKICBCb3QsCiAgQ29tbWFuZCwKICBGcmFtZSwKICBHYWxsZXJ5VmVydGljYWxFbmQsCiAgTWFwLAogIFBpZUNoYXJ0LAogIFNldHRpbmdzMiwKICBTcXVhcmVUZXJtaW5hbCwKfSBmcm9tICJsdWNpZGUtcmVhY3QiCgppbXBvcnQgeyBOYXZNYWluIH0gZnJvbSAiQC9yZWdpc3RyeS9kZWZhdWx0L2Jsb2Nrcy9zaWRlYmFyLTA3L2NvbXBvbmVudHMvbmF2LW1haW4iCmltcG9ydCB7IE5hdlByb2plY3RzIH0gZnJvbSAiQC9yZWdpc3RyeS9kZWZhdWx0L2Jsb2Nrcy9zaWRlYmFyLTA3L2NvbXBvbmVudHMvbmF2LXByb2plY3RzIgppbXBvcnQgeyBOYXZVc2VyIH0gZnJvbSAiQC9yZWdpc3RyeS9kZWZhdWx0L2Jsb2Nrcy9zaWRlYmFyLTA3L2NvbXBvbmVudHMvbmF2LXVzZXIiCmltcG9ydCB7IFRlYW1Td2l0Y2hlciB9IGZyb20gIkAvcmVnaXN0cnkvZGVmYXVsdC9ibG9ja3Mvc2lkZWJhci0wNy9jb21wb25lbnRzL3RlYW0tc3dpdGNoZXIiCmltcG9ydCB7CiAgU2lkZWJhciwKICBTaWRlYmFyQ29udGVudCwKICBTaWRlYmFyRm9vdGVyLAogIFNpZGViYXJIZWFkZXIsCiAgU2lkZWJhclJhaWwsCn0gZnJvbSAiQC9yZWdpc3RyeS9kZWZhdWx0L3VpL3NpZGViYXIiCgovLyBUaGlzIGlzIHNhbXBsZSBkYXRhLgpjb25zdCBkYXRhID0gewogIHVzZXI6IHsKICAgIG5hbWU6ICJzaGFkY24iLAogICAgZW1haWw6ICJtQGV4YW1wbGUuY29tIiwKICAgIGF2YXRhcjogIi9hdmF0YXJzL3NoYWRjbi5qcGciLAogIH0sCiAgdGVhbXM6IFsKICAgIHsKICAgICAgbmFtZTogIkFjbWUgSW5jIiwKICAgICAgbG9nbzogR2FsbGVyeVZlcnRpY2FsRW5kLAogICAgICBwbGFuOiAiRW50ZXJwcmlzZSIsCiAgICB9LAogICAgewogICAgICBuYW1lOiAiQWNtZSBDb3JwLiIsCiAgICAgIGxvZ286IEF1ZGlvV2F2ZWZvcm0sCiAgICAgIHBsYW46ICJTdGFydHVwIiwKICAgIH0sCiAgICB7CiAgICAgIG5hbWU6ICJFdmlsIENvcnAuIiwKICAgICAgbG9nbzogQ29tbWFuZCwKICAgICAgcGxhbjogIkZyZWUiLAogICAgfSwKICBdLAogIG5hdk1haW46IFsKICAgIHsKICAgICAgdGl0bGU6ICJQbGF5Z3JvdW5kIiwKICAgICAgdXJsOiAiIyIsCiAgICAgIGljb246IFNxdWFyZVRlcm1pbmFsLAogICAgICBpc0FjdGl2ZTogdHJ1ZSwKICAgICAgaXRlbXM6IFsKICAgICAgICB7CiAgICAgICAgICB0aXRsZTogIkhpc3RvcnkiLAogICAgICAgICAgdXJsOiAiIyIsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB0aXRsZTogIlN0YXJyZWQiLAogICAgICAgICAgdXJsOiAiIyIsCiAgICAgICAgfSwKICAgICAgICB7CiAgICAgICAgICB0aXRsZTogIlNldHRpbmdzIiwKICAgICAgICAgIHVybDogIiMiLAogICAgICAgIH0sCiAgICAgIF0sCiAgICB9LAogICAgewogICAgICB0aXRsZTogIk1vZGVscyIsCiAgICAgIHVybDogIiMiLAogICAgICBpY29uOiBCb3QsCiAgICAgIGl0ZW1zOiBbCiAgICAgICAgewogICAgICAgICAgdGl0bGU6ICJHZW5lc2lzIiwKICAgICAgICAgIHVybDogIiMiLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdGl0bGU6ICJFeHBsb3JlciIsCiAgICAgICAgICB1cmw6ICIjIiwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIHRpdGxlOiAiUXVhbnR1bSIsCiAgICAgICAgICB1cmw6ICIjIiwKICAgICAgICB9LAogICAgICBdLAogICAgfSwKICAgIHsKICAgICAgdGl0bGU6ICJEb2N1bWVudGF0aW9uIiwKICAgICAgdXJsOiAiIyIsCiAgICAgIGljb246IEJvb2tPcGVuLAogICAgICBpdGVtczogWwogICAgICAgIHsKICAgICAgICAgIHRpdGxlOiAiSW50cm9kdWN0aW9uIiwKICAgICAgICAgIHVybDogIiMiLAogICAgICAgIH0sCiAgICAgICAgewogICAgICAgICAgdGl0bGU6ICJHZXQgU3RhcnRlZCIsCiAgICAgICAgICB1cmw6ICIjIiwKICAgICAgICB9LAogICAgICAgIHsKICAgICAgICAgIHRpdGxlOiAiVHV0b3JpbnB1dCBiZy1iYWNrZ3JvdW5kIG5vdC1kYXJrOmJnLWNsaXAtcGFkZGluZyBweC1bY2FsYygtLXNwYWNpbmcoMyktMXB4KV0gdGV4dC1sZWZ0IHRleHQtYmFzZSBzaGFkb3cteHMvNSBvdXRsaW5lLW5vbmUgcmluZy1yaW5nLzI0IHRyYW5zaXRpb24tc2hhZG93IGJlZm9yZTpwb2ludGVyLWV2ZW50cy1ub25lIGJlZm9yZTphYnNvbHV0ZSBiZWZvcmU6aW5zZXQtMCBiZWZvcmU6cm91bmRlZC1bY2FsYyh2YXIoLS1yYWRpdXMtbGcpLTFweCldIG5vdC1kYXRhLWRpc2FibGVkOm5vdC1mb2N1cy12aXNpYmxlOm5vdC1hcmlhLWludmFsaWQ6bm90LWRhdGEtcHJlc3NlZDpiZWZvcmU6c2hhZG93LVswXzFweF8tLXRoZW1lKC0tY29sb3ItYmxhY2svNCUpXSBwb2ludGVyLWNvYXJzZTphZnRlcjphYnNvbHV0ZSBwb2ludGVyLWNvYXJzZTphZnRlcjpzaXplLWZ1bGwgcG9pbnRlci1jb2Fyc2U6YWZ0ZXI6bWluLWgtMTEgZm9jdXMtdmlzaWJsZTpib3JkZXItcmluZyBmb2N1cy12aXNpYmxlOnJpbmctWzNweF0gYXJpYS1pbnZhbGlkOmJvcmRlci1kZXN0cnVjdGl2ZS8zNiBmb2N1cy12aXNpYmxlOmFyaWEtaW52YWxpZDpib3JkZXItZGVzdHJ1Y3RpdmUvNjQgZm9jdXMtdmlzaWJsZTphcmlhLWludmFsaWQ6cmluZy1kZXN0cnVjdGl2ZS8xNiBkYXRhLWRpc2FibGVkOnBvaW50ZXItZXZlbnRzLW5vbmUgZGF0YS1kaXNhYmxlZDpvcGFjaXR5LTY0IHNtOm1pbi1oLTggc206dGV4dC1zbSBkYXJrOmJnLWlucHV0LzMyIGRhcms6YXJpYS1pbnZhbGlkOnJpbmctZGVzdHJ1Y3RpdmUvMjQgZGFyazpub3QtZGF0YS1kaXNhYmxlZDpub3QtZm9jdXMtdmlzaWJsZTpub3QtYXJpYS1pbnZhbGlkOm5vdC1kYXRhLXByZXNzZWQ6YmVmb3JlOnNoYWRvdy1bMF8tMXB4Xy0tdGhlbWUoLS1jb2xvci13aGl0ZS82JSldIFsmX3N2Zzpub3QoW2NsYXNzKj0nb3BhY2l0eS0nXSldOm9wYWNpdHktODAgWyZfc3ZnOm5vdChbY2xhc3MqPSdzaXplLSddKV06c2l6ZS00LjUgc206WyZfc3ZnOm5vdChbY2xhc3MqPSdzaXplLSddKV06c2l6ZS00IFsmX3N2Z106cG9pbnRlci1ldmVudHMtbm9uZSBbJl9zdmddOnNocmluay0wIFtbZGF0YS1kaXNhYmxlZF0sOmZvY3VzLXZpc2libGUsW2FyaWEtaW52YWxpZF0sW2RhdGEtcHJlc3NlZF1dOnNoYWRvdy1ub25lIiwKICAgICAgICBzaXplID09PSAic20iICYmCiAgICAgICAgICAibWluLWgtOCBnYXAtMS41IHB4LVtjYWxjKC0tc3BhY2luZygyLjUpLTFweCldIHNtOm1pbi1oLTciLAogICAgICAgIHNpemUgPT09ICJsZyIgJiYgIm1pbi1oLTEwIHNtOm1pbi1oLTkiLAogICAgICAgIGNsYXNzTmFtZSwKICAgICAgKX0KICAgICAgZGF0YS1zbG90PSJzZWxlY3QtdHJpZ2dlciIKICAgICAgey4uLnByb3BzfQogICAgPgogICAgICB7Y2hpbGRyZW59CiAgICAgIDxTZWxlY3RQcmltaXRpdmUuSWNvbiBkYXRhLXNsb3Q9InNlbGVjdC1pY29uIj4KICAgICAgICA8Q2hldnJvbnNVcERvd25JY29uIGNsYXNzTmFtZT0iLW1lLTEgc2l6ZS00LjUgb3BhY2l0eS04MCBzbTpzaXplLTQiIC8+CiAgICAgIDwvU2VsZWN0UHJpbWl0aXZlLkljb24+CiAgICA8L1NlbGVjdFByaW1pdGl2ZS5UcmlnZ2VyPgogICk7Cn0KCmZ1bmN0aW9uIFNlbGVjdFZhbHVlKHsgY2xhc3NOYW1lLCAuLi5wcm9wcyB9OiBTZWxlY3RQcmltaXRpdmUuVmFsdWUuUHJvcHMpIHsKICByZXR1cm4gKAogICAgPFNlbGVjdFByaW1pdGl2ZS5WYWx1ZQogICAgICBjbGFzc05hbWU9e2NuKAogICAgICAgICJmbGV4LTEgdHJ1bmNhdGUgZGF0YS1wbGFjZWhvbGRlcjp0ZXh0LW11dGVkLWZvcmVncm91bmQiLAogICAgICAgIGNsYXNzTmFtZSwKICAgICAgKX0KICAgICAgZGF0YS1zbG90PSJzZWxlY3QtdmFsdWUiCiAgICAgIHsuLi5wcm9wc30KICAgIC8+CiAgKTsKfQoKZnVuY3Rpb24gU2VsZWN0UG9wdXAoewogIGNsYXNzTmFtZSwKICBjaGlsZHJlbiwKICBzaWRlT2Zmc2V0ID0gNCwKICBhbGlnbkl0ZW1XaXRoVHJpZ2UuVW5pc3dhcFhQbGFuU2lnbmF0dXJlCiAgICAgID8gc3RlcC5kZWFkbGluZQogICAgICA6IHVuZGVmaW5lZAoKICBjb25zdCB7IHNlY29uZHNSZW1haW5pbmcsIHJhbk91dE9mVGltZVRpdGxlIH0gPSB1c2VTZWNvbmRzVW50aWxEZWFkbGluZShkZWFkbGluZSwgc3RhdHVzKQoKICBjb25zdCB0aXRsZSA9CiAgICByYW5PdXRPZlRpbWVUaXRsZSA/PwogICAgewogICAgICBbU3RlcFN0YXR1cy5QcmV2aWV3XTogdCgnc3dhcC5jb25maXJtU3dhcCcpLAogICAgICBbU3RlcFN0YXR1cy5BY3RpdmVdOiB0KCdjb21tb24uY29uZmlybVN3YXAnKSwKICAgICAgW1N0ZXBTdGF0dXMuSW5Qcm9ncmVzc106IHQoJ2NvbW1vbi5zd2FwUGVuZGluZycpLAogICAgICBbU3RlcFN0YXR1cy5Db21wbGV0ZV06IHQoJ3N3YXAuY29uZmlybVN3YXAnKSwKICAgIH1bc3RhdHVzXQoKICByZXR1cm4gKAogICAgPFN0ZXBSb3dTa2VsZXRvbgogICAgICB0aXRsZT17dGl0bGV9CiAgICAgIGljb249ezxTd2FwSWNvbiAvPn0KICAgICAgbGVhcm5Nb3JlPXt7CiAgICAgICAgdXJsOgogICAgICAgICAgc3RlcC50eXBlID09PSBUcmFuc2FjdGlvblN0ZXBUeXBlLlN3YXBUcmFuc2FjdGlvbkJhdGNoZWQKICAgICAgICAgICAgPyB1bmlzd2FwVXJscy5oZWxwQXJ0aWNsZVVybHMuYmF0Y2hlZFN3YXBzCiAgICAgICAgICAgIDogdW5pc3dhcFVybHMuaGVscEFydGljbGVVcmxzLmhvd1RvU3dhcFRva2VucywKICAgICAgICB0ZXh0OiB0KCdjb21tb24ubGVhcm5Nb3JlU3dhcCcpLAogICAgICB9fQogICAgICBzdGF0dXM9e3N0YXR1c30KICAgICAgc2Vjb25kc1JlbWFpbmluZz17c2Vjb25kc1JlbWFpbmluZ30KICAgICAgY3VycmVudFN0ZXBJbmRleD17Y3VycmVudFN0ZXBJbmRleH0KICAgICAgdG90YWxTdGVwc0NvdW50PXt0b3RhbFN0ZXBzQ291bnR9CiAgICAvPgogICkKfQppbXBvcnQgUmVhY3QgZnJvbSAicmVhY3QiOwppbXBvcnQgeyB2aSwgYWZ0ZXJFYWNoIH0gZnJvbSAidml0ZXN0IjsKCmltcG9ydCBkYXlqcyBmcm9tICJAY2FsY29tL2RheWpzIjsKaW1wb3J0IHsgRGF0ZVBpY2tlciBhcyBEYXRlUGlja2VyQ29tcG9uZW50IH0gZnJvbSAiQGNhbGNvbS9mZWF0dXJlcy9jYWxlbmRhcnMvY29tcG9uZW50cy9EYXRlUGlja2VyIjsKCmltcG9ydCB7IHJlbmRlciB9IGZyb20gIkBjYWxjb20vZmVhdHVyZXMvYm9va2luZ3MvQm9va2VyL19fdGVzdHNfXy90ZXN0LXV0aWxzIjsKaW1wb3J0IHsgRGF0ZVBpY2tlciB9IGZyb20gIi4vRGF0ZVBpY2tlciI7Cgp2aS5tb2NrKCJAY2FsY29tL2ZlYXR1cmVzL2NhbGVuZGFycy9jb21wb25lbnRzL0RhdGVQaWNrZXIiLCAoKSA9PiB7CiAgcmV0dXJuIHsKICAgIERhdGVQaWNrZXI6IHZpLmZuKCgpID0+IDxkaXYgZGF0YS10ZXN0aWQ9Im1vY2stZGF0ZS1waWNrZXIiIC8+KSwKICB9Owp9KTsKCmNvbnN0IG5vb3AgPSAoKSA9PiB7CiAgLyogbm9vcCAqLwp9OwoKZGVzY3JpYmUoIlRlc3RzIGZvciBEYXRlUGlja2VyIENvbXBvbmVudCIsICgpID0+IHsKICBhZnRlckVhY2goKCkgPT4gewogICAgdmkuY2xlYXJBbGxNb2NrcygpOwogIH0pOwoKICB0ZXN0KCJJdCBwYXNzZXMgdGhlIGxvYWRpbmcgcHJvcCB0byB0aGUgRGF0ZVBpY2tlciBjb21wb25lbnQiLCBhc3luYyAoKSA9PiB7CiAgICByZW5kZXIoPERhdGVQaWNrZXIgZXZlbnQ9e3t9fSBpc0xvYWRpbmc9e3RydWV9IC8+KTsKCiAgICBleHBlY3QoRGF0ZVBpY2tlckNvbXBvbmVudCkudG9IYXZlQmVlbkNhbGxlZFdpdGgoCiAgICAgIGV4cGVjdC5vYmplY3RDb250YWluaW5nKHsKICAgICAgICBpc0xvYWRpbmc6IHRydWUsCiAgICAgIH0pLAogICAgICBleHBlY3QuYW55dGhpbmcoKQogICAgKTsKICB9KTsKCiAgdGVzdCgiaGFwcHkgcGF0aCwgc2xvdHMgaW4gY3VycmVudCBtb250aCIsIGFzeW5jICgpID0+IHsKICAgIC8vIHRvZGF5IGN1cnJlbnQgdGltZS4KICAgIGNvbnN0IHRlc3REYXRlID0gZGF5anMoKTt0IHNldEV4cGlyYXRpb25UZXh0ID0gdXNlQ2FsbGJhY2soKCkgPT4gewogICAgY29uc3QgZXhwaXJhdGlvblN0cmluZyA9IGdldE90cER1cmF0aW9uU3RyaW5nKGV4cGlyYXRpb25UaW1lc3RhbXApCiAgICBzZXRFeHBpcnlUZXh0KGV4cGlyYXRpb25TdHJpbmcpCiAgfSwgW2V4cGlyYXRpb25UaW1lc3RhbXBdKQogIHVzZUludGVydmFsKHNldEV4cGlyYXRpb25UZXh0LCBPTkVfU0VDT05EX01TKQoKICBpZiAoIXNlc3Npb25VVUlEIHx8ICFwcml2YXRlS2V5KSB7CiAgICByZXNldEZsb3dBbmROYXZCYWNrKCkKICB9CgogIGNvbnN0IFtsb2FkaW5nLCBzZXRMb2FkaW5nXSA9IHVzZVN0YXRlKGZhbHNlKQogIGNvbnN0IFtlcnJvciwgc2V0RXJyb3JdID0gdXNlU3RhdGUoZmFsc2UpCiAgY29uc3QgW2ZhaWxlZEF0dGVtcHRDb3VudCwgc2V0RmFpbGVkQXR0ZW1wdENvdW50XSA9IHVzZVN0YXRlPG51bWJlcj4oMCkKICBjb25zdCBbY2hhcmFjdGVyU2VxdWVuY2UsIHNldENoYXJhY3RlclNlcXVlbmNlXSA9IHVzZVN0YXRlPENoYXJhY3RlclNlcXVlbmNlPihJTklUSUFMX0NIQVJBQ1RFUl9TRVFVRU5DRSkKCiAgY29uc3QgaW5wdXRSZWZzID0gdXNlUmVmPFJlZk9iamVjdDxUZXh0SW5wdXQgfCBudWxsPltdPihbXSkKICBpbnB1dFJlZnMuY3VycmVudCA9IG5ldyBBcnJheSg2KS5maWxsKG51bGwpLm1hcCgoXywgaSkgPT4gaW5wdXRSZWZzLmN1cnJlbnRbaV0gfHwgY3JlYXRlUmVmPFRleHRJbnB1dD4oKSkKCiAgLy8gQWRkIGFsbCBhY2NvdW50cyBmcm9tIG1uZW1vbmljLgogIGNvbnN0IG9uU3VibWl0ID0gdXNlQ2FsbGJhY2soCiAgICBhc3luYyAobW5lbW9uaWM6IHN0cmluZ1tdKSA9PiB7CiAgICAgIGFkZE9uYm9hcmRpbmdBY2NvdW50TW5lbW9uaWMobW5lbW9uaWMpCiAgICAgIGdvVG9OZXh0U3RlcCgpCiAgICB9LAogICAgW2dvVG9OZXh0U3RlcCwgYWRkT25ib2FyZGluZ0FjY291bnRNbmVtb25pY10sCiAgKQoKICB1c2VFZmZlY3QoKCkgPT4gewogICAgaWYgKGVycm9yICYmICFhcnJheXNBcmVFcXVhbChjaGFyYWN0ZXJTZXF1ZW5jZSwgSU5JVElBTF9DSEFSQUNURVJfU0VRVUVOQ0UpKSB7CiAgICAgIHNldENoYXJhY3RlclNlcXVlbmNlKElOSVRJQUxfQ0hBUkFDVEVSX1NFUVVFTkNFKQogICAgfQogIH0sIFtlcnJvciwgY2hhcmFjdGVyU2VxdWVuY2VdKQoKICBjb25zdCBzdWJtaXRPVFAgPSB1c2VDYWxsYmFjayhhc3luYyAoKTogUHJvbWlzZTx2b2lkPiA9PiB7CiAgICBpZiAoIXByaXZhdGVLZXkgfHwgIXNlc3Npb25VVUlEKSB7CiAgICAgIHJldHVybgogICAgfQogICAgc2V0RXJyb3IoZmFsc2UpCiAgICBzZXRMb2FkaW5nKHRydWUpCiAgICAvLyBzdWJtaXQgT1RQIHRvIHJlY2VpdmUgYmxvYgogICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaChgJHt1bmlzd2FwVXJscy5zY2FudGFzdGljQXBpVXJsfS9vdHBgLCB7CiAgICAgIG1ldGhvZDogJ1BPU1QnLAogICAgICBoZWFkZXJzOiB7CiAgICAgICAgQWNjZXB0OiAnYXBwbGljYXRpb24vanNvbicsCiAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgfSwKICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoewogICAgICAgIHV1aWQ6IHNlc3Npb25VVUlELAogICAgICAgIG90cDogY2hhcmFjdGVyU2VxdWVuY2Uuam9pbignJyksCiAgICAgIH0pLAogICAgfSkKCiAgICBpZiAoIXJlc3BvbnNlLm9rKSB7CiAgICAgIHNldENoYXJhY3RlclNlcXVlbmNlKElOSVRJQUxfQ0hBUkFDVEVSX1NFUVVFTkNFKQogICAgICB0aHJvdyBuZXcgRXJyb3IoYEZhaWxlZCB0byBzdWJtaXQgT1RQOiAke2F3YWl0IHJlc3BvbnNlLnRleHQoKX1gKQogICAgfQoKICAgIGNvbnN0IGRhdGEgPSAoYXdhaXQgcmVzcG9uc2UuanNvbigpKSBhcyB7IGVuY3J5cHRlZFNlZWQ/OiBzdHJpbmc7IE9UUEZhaWxlZEF0dGVtcHRzPzogbnVtYmVyIH0KICAgIGlmICghZGF0YS5lbmNyeXB0ZWRTZWVkKSB7Z2VWYWxpZGF0aW9uID8gYCR7c2xpcHBhZ2VWYWxpZGF0aW9uLnNldmVyaXR5fS5tYWluYCA6ICd0ZXh0LnByaW1hcnknfQogICAgICAgICAgdmFsdWU9e3NsaXBwYWdlfQogICAgICAgICAgdmlzaWJsZURlY2ltYWxzPXsyfQogICAgICAgICAgc3ltYm9sPSIlIgogICAgICAgIC8+CiAgICAgICAgPFN2Z0ljb24gY2xhc3NOYW1lPSJzcGluLW9uLWhvdmVyIiBzeD17eyBmb250U2l6ZTogJzE2cHgnIH19PgogICAgICAgICAgPENvZ0ljb24gLz4KICAgICAgICA8L1N2Z0ljb24+CiAgICAgIDwvQnV0dG9uPgogICAgPC9Cb3g+CiAgKTsKfTsKInVzZSBjbGllbnQiOw0KDQppbXBvcnQgeyB1c2VFZmZlY3QsIHVzZVN0YXRlIH0gZnJvbSAicmVhY3QiOw0KaW1wb3J0IHogZnJvbSAiem9kIjsNCg0KaW1wb3J0IHsgdXNlQm9va2luZ1N1Y2Nlc3NSZWRpcmVjdCB9IGZyb20gIkBjYWxjb20vZmVhdHVyZXMvYm9va2luZ3MvbGliL2Jvb2tpbmdTdWNjZXNzUmVkaXJlY3QiOw0KaW1wb3J0IHR5cGUgeyBQYXltZW50UGFnZVByb3BzIH0gZnJvbSAiQGNhbGNvbS9mZWF0dXJlcy9lZS9wYXltZW50cy9wYWdlcy9wYXltZW50IjsNCmltcG9ydCB7IHVzZUNvbXBhdFNlYXJjaFBhcmFtcyB9IGZyb20gIkBjYWxjb20vbGliL2hvb2tzL3VzZUNvbXBhdFNlYXJjaFBhcmFtcyI7DQppbXBvcnQgeyB1c2VDb3B5IH0gZnJvbSAiQGNhbGNvbS9saWIvaG9va3MvdXNlQ29weSI7DQppbXBvcnQgeyB1c2VMb2NhbGUgfSBmcm9tICJAY2FsY29tL2xpYi9ob29rcy91c2VMb2NhbGUiOw0KaW1wb3J0IHsgdHJwYyB9IGZyb20gIkBjYWxjb20vdHJwYy9yZWFjdCI7DQppbXBvcnQgeyBCdXR0b24gfSBmcm9tICJAY2FsY29tL3VpL2NvbXBvbmVudHMvYnV0dG9uIjsNCmltcG9ydCB7IFNwaW5uZXIgfSBmcm9tICJAY2FsY29tL3VpL2NvbXBvbmVudHMvaWNvbiI7DQppbXBvcnQgeyBzaG93VG9hc3QgfSBmcm9tICJAY2FsY29tL3VpL2NvbXBvbmVudHMvdG9hc3QiOw0KDQppbnRlcmZhY2UgSVBheW1lbnRDb21wb25lbnRQcm9wcyB7DQogIHBheW1lbnQ6IHsNCiAgICAvLyBXaWxsIGJlIHBhcnNlZCBvbiByZW5kZXINCiAgICBkYXRhOiB1bmtub3duOw0KICB9Ow0KICBwYXltZW50UGFnZVByb3BzOiBQYXltZW50UGFnZVByb3BzOw0KfQ0KDQovLyBDcmVhdGUgem9kIHNjaGVtYSBmb3IgZGF0YQ0KY29uc3QgUGF5bWVudEJUQ1BheURhdGFTY2hlbWEgPSB6Lm9iamVjdCh7DQogIGludm9pY2U6IHoub2JqZWN0KHsgY2hlY2tvdXRMaW5rOiB6LnN0cmluZygpIH0pLnJlcXVpcmVkKCksDQp9KTsNCg0KZXhwb3J0IGNvbnN0IEJ0Y3BheVBheW1lbnRDb21wb25lbnQgPSAocHJvcHM6IElQYXltZW50Q29tcG9uZW50UHJvcHMpID0+IHsNCiAgY29uc3QgeyBwYXltZW50IH0gPSBwcm9wczsNCiAgY29uc3QgeyBkYXRhIH0gPSBwYXltZW50Ow0KICBjb25zdCBbaWZyYW1lTG9hZGVkLCBzZXRJZnJhbWVMb2FkZWRdID0gdXNlU3RhdGUoZmFsc2UpOw0KICBjb25zdCB7IGNvcHlUb0NsaXBib2FyZCwgaXNDb3BpZWQgfSA9IHVzZUNvcHkoKTsNCiAgY29uc3Qgd3JvbmdVcmwgPSAoDQogICAgPD4NCiAgICAgIDxwIGNsYXNzTmFtZT0ibXQtMyB0ZXh0LWNlbnRlciI+Q291bGRuJmFwb3M7dCBvYnRhaW4gcGF5bWVudCBVUkw8L3A+DQogICAgPC8+DQogICk7DQoNCiAgY29uc3QgcGFyc2VkRGF0YSA9IFBheW1lbnRCVENQYXlEYXRhU2NoZW1hLnNhZmVQYXJzZShkYXRhKTsNCiAgaWYgKCFwYXJzZWREYXRhLnN1Y2Nlc3MgfHwgIXBhcnNlZERhdGEuZGF0YT8uaW52b2ljZT8uY2hlY2tvdXRMaW5rKSByZXR1cm4gd3JvbmdVcmw7DQogIGNvbnN0IGNoZWNrb3V0VXJsID0gcGFyc2VkRGF0YS5kYXRhLmludm9pY2UuY2hlY2tvdXRMaW5rOw0KICBjb25zdCBoYW5kbGVPcGVuSW5OZXdUYWIgPSAoKSA9PiB7DQogICAgd2luZG93Lm9wZW4oY2hlY2tvdXRVcmwsICJfYmxhbmsiLCAibm9vcGVuZXIsbm9yZWZlcnJlciIpOw0KIAogICAgIm9jY3VycmVuY2VzIiBpbiBpdGVtLnJlY3VycmVuY2UgJiYKICAgIGl0ZW0ucmVjdXJyZW5jZS5vY2N1cnJlbmNlczsKICBjb25zdCByZXF1aXJlc0NvbmZpcm1hdGlvbiA9CiAgICBpdGVtLmNvbmZpcm1hdGlvblBvbGljeSAmJgogICAgISgiZGlzYWJsZWQiIGluIGl0ZW0uY29uZmlybWF0aW9uUG9saWN5ICYmIGl0ZW0uY29uZmlybWF0aW9uUG9saWN5LmRpc2FibGVkKSAmJgogICAgInR5cGUiIGluIGl0ZW0uY29uZmlybWF0aW9uUG9saWN5ICYmCiAgICBpdGVtLmNvbmZpcm1hdGlvblBvbGljeS50eXBlID09PSAiYWx3YXlzIjsKCiAgY29uc3QgYmFkZ2VDb3VudCA9IFsKICAgIHRydWUsIC8vIGR1cmF0aW9uIGFsd2F5cyBwcmVzZW50CiAgICBpdGVtLmhpZGRlbiwKICAgIGhhc1NlYXRzLAogICAgaGFzUHJpY2UsCiAgICBoYXNSZWN1cnJlbmNlLAogICAgcmVxdWlyZXNDb25maXJtYXRpb24sCiAgXS5maWx0ZXIoQm9vbGVhbikubGVuZ3RoOwoKICB0eXBlIEJ1dHRvblN5c3RlbUltYWdlID0gUmVhY3QuQ29tcG9uZW50UHJvcHM8dHlwZW9mIEJ1dHRvbj5bInN5c3RlbUltYWdlIl07CiAgdHlwZSBFdmVudFR5cGVJY29uID0gRXhjbHVkZTxCdXR0b25TeXN0ZW1JbWFnZSwgdW5kZWZpbmVkPjsKCiAgY29uc3QgZXZlbnRUeXBlczogewogICAgbGFiZWw6IHN0cmluZzsKICAgIGljb246IEV2ZW50VHlwZUljb247CiAgICBvblByZXNzOiAoKSA9PiB2b2lkOwogICAgcm9sZTogImRlZmF1bHQiIHwgImRlc3RydWN0aXZlIjsKICB9W10gPSBbCiAgICB7CiAgICAgIGxhYmVsOiAiQ29weSBsaW5rIiwKICAgICAgaWNvbjogImxpbmsiLAogICAgICBvblByZXNzOiAoKSA9PiBoYW5kbGVDb3B5TGluayhpdGVtKSwKICAgICAgcm9sZTogImRlZmF1bHQiLAogICAgfSwKICAgIHsKICAgICAgbGFiZWw6ICJFZGl0IiwKICAgICAgaWNvbjogInBlbmNpbCIsCiAgICAgIG9uUHJlc3M6ICgpID0+IG9uRWRpdD8uKGl0ZW0pLAogICAgICByb2xlOiAiZGVmYXVsdCIsCiAgICB9LAogICAgewogICAgICBsYWJlbDogIkR1cGxpY2F0ZSIsCiAgICAgIGljb246ICJzcXVhcmUub24uc3F1YXJlIiwKICAgICAgb25QcmVzczogKCkgPT4gb25EdXBsaWNhdGU/LihpdGVtKSwKICAgICAgcm9sZTogImRlZmF1bHQiLAogICAgfSwKICAgIHsKICAgICAgbGFiZWw6ICJEZWxldGUiLAogICAgICBpY29uOiAidHJhc2giLAogICAgICBvblByZXNzOiAoKSA9PiBvbkRlbGV0ZT8uKGl0ZW0pLAogICAgICByb2xlOiAiZGVzdHJ1Y3RpdmUiLAogICAgfSwKICBdOwoKICAvLyBVc2UgbWluSGVpZ2h0IGJhc2VkIG9uIGJhZGdlIGNvdW50IHRvIGVuc3VyZSBwcm9wZXIgc3BhY2luZwogIC8vIFRoaXMgZml4ZXMgU3dpZnRVSSBIb3N0IGNhY2hpbmcgc3RhbGUgbGF5b3V0IG1lYXN1cmVtZW50cwogIHJldHVybiAoCiAgICA8VmlldwogICAgICBzdHlsZT17ewogICAgICAgIGJhY2tncm91bmRDb2xvcjogaXNEYXJrID8gIiMwMDAwMDAiIDogIiNGRkZGRkYiLAogICAgICAgIGJvcmRlckJvdHRvbVdpZHRoOiAhaXNMYXN0ID8gMSA6IDAsCiAgICAgICAgYm9yZGVyQm90dG9tQ29sb3I6IGlzRGFyayA/ICIjNEQ0RDREIiA6ICIjRTVFNUVBIiwKICAgICAgfX0KICAgID4KICAgICAgey8qIENhbGN1bGF0ZSBtaW5IZWlnaHQgYmFzZWQgb24gYmFkZ2Ugcm93cyB0byBlbnN1cmUgcHJvcGVyIHNwYWNpbmcgKi99CiAgICAgIHsvKiAxLTMgYmFkZ2VzID0gMSByb3csIDQtNSBiYWRnZXMgPSBsaWtlbHkgMiByb3dzLCA2IGJhZGdlcyA9IDIgcm93cyAqL30KICAgICAgPFZpZXcKICAgICAgICBjbGFzc05hbWU9ImZsZXgtcm93IGl0ZW1zLXN0YXJ0IGp1c3RpZnktYmV0d2VlbiIKICAgICAgICBzdHlsZT17ewogICAgICAgICAgcGFkZGluZ1ZlcnRpY2FsOiAxNiwKICAgICAgICAgIG1pbkhlaWdodDogYmFkZ2VDb3VudCA8PSAzID8gMTAwIDogYmFkZ2VDb3VudCA8PSA1ID8gMTIwIDogMTYwLAogICAgICBDaGF0IFNldHRpbmdzCiAgICAgICAgPC9EaWFsb2dUcmlnZ2VyPgogICAgICAgIDxEaWFsb2dDb250ZW50IGNsYXNzTmFtZT0ibWluLXctbWQiPgogICAgICAgICAgPERpYWxvZ0hlYWRlcj4KICAgICAgICAgICAgPERpYWxvZ1RpdGxlPkNoYXQgU2V0dGluZ3M8L0RpYWxvZ1RpdGxlPgogICAgICAgICAgICA8RGlhbG9nRGVzY3JpcHRpb24+CiAgICAgICAgICAgICAgQ3VzdG9taXplIHlvdXIgY2hhdCBzZXR0aW5nczogdGhlbWUsIGFjY2VudCBjb2xvciwgc3Bva2VuCiAgICAgICAgICAgICAgbGFuZ3VhZ2UsIHZvaWNlLCBwZXJzb25hbGl0eSwgYW5kIGN1c3RvbSBpbnN0cnVjdGlvbnMuCiAgICAgICAgICAgIDwvRGlhbG9nRGVzY3JpcHRpb24+CiAgICAgICAgICA8L0RpYWxvZ0hlYWRlcj4KICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGZsZXgtY29sIGdhcC00Ij4KICAgICAgICAgICAgPE5hdGl2ZVNlbGVjdAogICAgICAgICAgICAgIHZhbHVlPXt0YWJ9CiAgICAgICAgICAgICAgb25DaGFuZ2U9eyhlKSA9PiBzZXRUYWIoZS50YXJnZXQudmFsdWUpfQogICAgICAgICAgICAgIGNsYXNzTmFtZT0idy1mdWxsIG1kOmhpZGRlbiIKICAgICAgICAgICAgPgogICAgICAgICAgICAgIDxOYXRpdmVTZWxlY3RPcHRpb24gdmFsdWU9ImdlbmVyYWwiPkdlbmVyYWw8L05hdGl2ZVNlbGVjdE9wdGlvbj4KICAgICAgICAgICAgICA8TmF0aXZlU2VsZWN0T3B0aW9uIHZhbHVlPSJub3RpZmljYXRpb25zIj4KICAgICAgICAgICAgICAgIE5vdGlmaWNhdGlvbnMKICAgICAgICAgICAgICA8L05hdGl2ZVNlbGVjdE9wdGlvbj4KICAgICAgICAgICAgICA8TmF0aXZlU2VsZWN0T3B0aW9uIHZhbHVlPSJwZXJzb25hbGl6YXRpb24iPgogICAgICAgICAgICAgICAgUGVyc29uYWxpemF0aW9uCiAgICAgICAgICAgICAgPC9OYXRpdmVTZWxlY3RPcHRpb24+CiAgICAgICAgICAgICAgPE5hdGl2ZVNlbGVjdE9wdGlvbiB2YWx1ZT0ic2VjdXJpdHkiPlNlY3VyaXR5PC9OYXRpdmVTZWxlY3RPcHRpb24+CiAgICAgICAgICAgIDwvTmF0aXZlU2VsZWN0PgogICAgICAgICAgICA8VGFicyB2YWx1ZT17dGFifSBvblZhbHVlQ2hhbmdlPXtzZXRUYWJ9PgogICAgICAgICAgICAgIDxUYWJzTGlzdCBjbGFzc05hbWU9ImhpZGRlbiB3LWZ1bGwgbWQ6ZmxleCI+CiAgICAgICAgICAgICAgICA8VGFic1RyaWdnZXIgdmFsdWU9ImdlbmVyYWwiPkdlbmVyYWw8L1RhYnNUcmlnZ2VyPgogICAgICAgICAgICAgICAgPFRhYnNUcmlnZ2VyIHZhbHVlPSJub3RpZmljYXRpb25zIj5Ob3RpZmljYXRpb25zPC9UYWJzVHJpZ2dlcj4KICAgICAgICAgICAgICAgIDxUYWJzVHJpZ2dlciB2YWx1ZT0icGVyc29uYWxpemF0aW9uIj4KICAgICAgICAgICAgICAgICAgUGVyc29uYWxpemF0aW9uCiAgICAgICAgICAgICAgICA8L1RhYnNUcmlnZ2VyPgogICAgICAgICAgICAgICAgPFRhYnNUcmlnZ2VyIHZhbHVlPSJzZWN1cml0eSI+U2VjdXJpdHk8L1RhYnNUcmlnZ2VyPgogICAgICAgICAgICAgIDwvVGFic0xpc3Q+CiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InN0eWxlLW5vdmE6cC00IHN0eWxlLXZlZ2E6cC02IHN0eWxlLW1haWE6cC02IHN0eWxlLW1pcmE6cC00IHN0eWxlLWx5cmE6cC00IHN0eWxlLXZlZ2E6bWluLWgtWzU1MHB4XSBzdHlsZS1tYWlhOm1pbi1oLVs1NTBweF0gc3R5bGUtbWlyYTptaW4taC1bNDUwcHhdIHN0eWxlLWx5cmE6bWluLWgtWzQ1MHB4XSBzdHlsZS1ub3ZhOm1pbi1oLVs0NjBweF0gc3R5bGUtbm92YTpyb3VuZGVkLWxnIHN0eWxlLXZlZ2E6cm91bmRlZC1sZyBzdHlsZS1tYWlhOnJvdW5kZWQteGwgc3R5bGUtbWlyYTpyb3VuZGVkLW1kIHN0eWxlLWx5cmE6cm91bmRlZC1ub25lIGJvcmRlciBbJl9bZGF0YS1zbG90PXNlbGVjdC10cmlnZ2VyXV06bWluLXctWzEyNXB4XSI+CiAgICAgICAgICAgICAgICA8VGFic0NvbnRlbnQgdmFsdWU9ImdlbmVyYWwiPgpucHV0LWljb24tcmlnaHQtMDciIC8+CiAgICAgICAgICAgIDxJbnB1dEdyb3VwQWRkb24gYWxpZ249ImlubGluZS1lbmQiPgogICAgICAgICAgICAgIDxJY29uUGxhY2Vob2xkZXIKICAgICAgICAgICAgICAgIGx1Y2lkZT0iRXllT2ZmSWNvbiIKICAgICAgICAgICAgICAgIHRhYmxlcj0iSWNvbkV5ZUNsb3NlZCIKICAgICAgICAgICAgICAgIGh1Z2VpY29ucz0iVmlld09mZkljb24iCiAgICAgICAgICAgICAgICBwaG9zcGhvcj0iRXllU2xhc2hJY29uIgogICAgICAgICAgICAgICAgcmVtaXhpY29uPSJSaUV5ZU9mZkxpbmUiCiAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgPC9JbnB1dEdyb3VwQWRkb24+CiAgICAgICAgICA8L0lucHV0R3JvdXA+CiAgICAgICAgPC9GaWVsZD4KICAgICAgICA8RmllbGQ+CiAgICAgICAgICA8RmllbGRMYWJlbCBodG1sRm9yPSJpbnB1dC1pY29uLWJvdGgtMDkiPgogICAgICAgICAgICBBZGRvbiAoaW5saW5lLXN0YXJ0IGFuZCBpbmxpbmUtZW5kKQogICAgICAgICAgPC9GaWVsZExhYmVsPgogICAgICAgICAgPElucHV0R3JvdXA+CiAgICAgICAgICAgIDxJbnB1dEdyb3VwSW5wdXQgaWQ9ImlucHV0LWljb24tYm90aC0wOSIgLz4KICAgICAgICAgICAgPElucHV0R3JvdXBBZGRvbj4KICAgICAgICAgICAgICA8SWNvblBsYWNlaG9sZGVyCiAgICAgICAgICAgICAgICBsdWNpZGU9Ik1pY0ljb24iCiAgICAgICAgICAgICAgICB0YWJsZXI9Ikljb25NaWNyb3Bob25lIgogICAgICAgICAgICAgICAgaHVnZWljb25zPSJWb2ljZUljb24iCiAgICAgICAgICAgICAgICBwaG9zcGhvcj0iTWljcm9waG9uZUljb24iCiAgICAgICAgICAgICAgICByZW1peGljb249IlJpTWljTGluZSIKICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0idGV4dC1tdXRlZC1mb3JlZ3JvdW5kIgogICAgICAgICAgICAgIC8+CiAgICAgICAgICAgIDwvSW5wdXRHcm91cEFkZG9uPgogICAgICAgICAgICA8SW5wdXRHcm91cEFkZG9uIGFsaWduPSJpbmxpbmUtZW5kIj4KICAgICAgICAgICAgICA8SWNvblBsYWNlaG9sZGVyCiAgICAgICAgICAgICAgICBsdWNpZGU9IlJhZGlvSWNvbiIKICAgICAgICAgICAgICAgIHRhYmxlcj0iSWNvblBsYXllclJlY29yZEZpbGxlZCIKICAgICAgICAgICAgICAgIGh1Z2VpY29ucz0iUmVjb3JkSWNvbiIKICAgICAgICAgICAgICAgIHBob3NwaG9yPSJSZWNvcmRJY29uIgogICAgICAgICAgICAgICAgcmVtaXhpY29uPSJSaVJlY29yZENpcmNsZUxpbmUiCiAgICAgICAgICAgICAgICBjbGFzc05hbWU9ImFuaW1hdGUtcHVsc2UgdGV4dC1yZWQtNTAwIgogICAgICAgICAgICAgIC8+CiAgICAgICAgICAgIDwvSW5wdXRHcm91cEFkZG9uPgogICAgICAgICAgPC9JbnB1dEdyb3VwPgogICAgICAgIDwvRmllbGQ+CiAgICAgICAgPEZpZWxkPgogICAgICAgICAgPEZpZWxkTGFiZWwgaHRtbEZvcj0iaW5wdXQtYWRkb24tMjAiPkFkZG9uIChibG9jay1zdGFydCk8L0ZpZWxkTGFiZWw+CiAgICAgICAgICA8SW5wdXRHcm91cCBjbGFzc05hbWU9ImgtYXV0byI+CiAgICAgICAgICAgIDxJbnB1dEdyb3VwSW5wdXQgaWQ9ImlucHV0LWFkZG9uLTIwIiAvPgogICAgICAgICAgICA8SW5wdXRHcm91cEFkZG9uIGFsaWduPSJibG9jay1zdGFydCI+CiAgICAgICAgICAgICAgPElucHV0R3JvdXBUZXh0PkZpcnN0IE5hbWU8L0lucHV0R3JvdXBUZXh0PgogICAgICAgICAgICAgIDxJY29uUGxhY2Vob2xkZXIKICAgICAgICAgICAgICAgIGx1Y2lkZT0iSW5mb0ljb24iCiAgICAgICAgICAgICAgICB0YWJsZXI9Ikljb25JbmZvQ2lyY2xlIgogICAgICAgICAgICAgICAgaHVnZWljb25zPSJBbGVydENpcmNsZUljb24iCiAgICAgICAgICAgICAgICBwaG9zcGhvcj0iSW5mb0ljb24iCiAgICAgICAgICAgICAgICByZW1peGljb249IlJpSW5mb3JtYXRpb25MaW5lIng9ezF9IGZsZXhCYXNpcz17MH0gJG1kPXt7IGZsZXhCYXNpczogJ2F1dG8nIH19PgogICAgICAgICAgICAgICAgICAgIDxDdXJyZW5jeVNlbGVjdG9yCiAgICAgICAgICAgICAgICAgICAgICBsb2FkaW5nPXtsb2FkaW5nQn0KICAgICAgICAgICAgICAgICAgICAgIGN1cnJlbmN5SW5mbz17dG9rZW4xQ3VycmVuY3lJbmZvfQogICAgICAgICAgICAgICAgICAgICAgb25QcmVzcz17KCkgPT4gc2V0Q3VycmVuY3lTZWFyY2hJbnB1dFN0YXRlKCd0b2tlbkInKX0KICAgICAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgICA8L0ZsZXg+CiAgICAgICAgICAgICAgICA8L0ZsZXg+CiAgICAgICAgICAgICAgKX0KICAgICAgICAgICAgICA8U2VsZWN0U3RlcEVycm9yCiAgICAgICAgICAgICAgICBpc1Vuc3VwcG9ydGVkVG9rZW5TZWxlY3RlZD17aXNVbnN1cHBvcnRlZFRva2VuU2VsZWN0ZWR9CiAgICAgICAgICAgICAgICB1bnN1cHBvcnRlZENoYWluSWQ9e3Vuc3VwcG9ydGVkQ2hhaW5JZH0KICAgICAgICAgICAgICAgIHByb3RvY29sVmVyc2lvbj17cHJvdG9jb2xWZXJzaW9ufQogICAgICAgICAgICAgICAgd3JhcHBlZE5hdGl2ZVdhcm5pbmc9e3VuZGVmaW5lZH0KICAgICAgICAgICAgICAgIGZvdFRva2VuPXtmb3RFcnJvclRva2VufQogICAgICAgICAgICAgIC8+CiAgICAgICAgICAgICAgeyFoYXNFcnJvciAmJiBwcm90b2NvbFZlcnNpb24gPT09IFByb3RvY29sVmVyc2lvbi5WNCAmJiA8QWRkSG9vayAvPn0KICAgICAgICAgICAgPC9GbGV4PgogICAgICAgICAgPC9GbGV4PgogICAgICAgICAgPEZsZXggZ2FwPSIkc3BhY2luZzI0Ij4KICAgICAgICAgICAgPEZsZXg+CiAgICAgICAgICAgICAgPFRleHQgdmFyaWFudD0ic3ViaGVhZGluZzEiPgogICAgICAgICAgICAgICAgPFRyYW5zIGkxOG5LZXk9ImZlZS50aWVyIiAvPgogICAgICAgICAgICAgIDwvVGV4dD4KICAgICAgICAgICAgICA8VGV4dCB2YXJpYW50PSJib2R5MyIgY29sb3I9IiRuZXV0cmFsMiI+CiAgICAgICAgICAgICAgICB7cHJvdG9jb2xWZXJzaW9uID09PSBQcm90b2NvbFZlcnNpb24uVjIgPyB0KCdmZWUudGllci5kZXNjcmlwdGlvbi52MicpIDogdCgnZmVlLnRpZXIuZGVzY3JpcHRpb24nKX0KICAgICAgICAgICAgICA8L1RleHQ+CiAgICAgICAgICAgIDwvRmxleD4KCiAgICAgICAgICAgIHtwcm90b2NvbFZlcnNpb24gIT09IFByb3RvY29sVmVyc2lvbi5WMiAmJiAoCiAgICAgICAgICAgICAgPEZsZXggZ2FwPSIkc3BhY2luZzgiIHBvaW50ZXJFdmVudHM9e2hhc0Vycm9yID8gJ25vbmUnIDogJ2F1dG8nfSBvcGFjaXR5PXtoYXNFcnJvciA/IDAuNSA6IDF9PgogICAgICAgICAgICAgICAgPEZsZXggYm9yZGVyUmFkaXVzPSIkcm91bmRlZDEyIiBib3JkZXJXaWR0aD0iJHNwYWNpbmcxIiBib3JkZXJDb2xvcj0iJHN1cmZhY2UzIj4KICAgICAgICAgICAgICAgICAgPEZsZXgKICAgICAgICAgICAgICAgICAgICByb3cKICAgICAgICAgICAgICAgICAgICBnYXA9IiRzcGFjaW5nMjQiCiAgICAgICAgICAgICAgICAgICAganVzdGlmeUNvbnRlbnQ9InNwYWNlLWJldHdlZW4iCiAgICAgICAgICAgICAgICAgICAgYWxpZ25JdGVtcz0iY2VudGVyIgogICAgICAgICAgICAgICAgICAgIHB5PSIkc3BhY2luZzEyIgogICAgICAgICAgICAgICAgICAgIHB4PSIkc3BhY2luZzE2IgogICAgICAgICAgICAgICAgICA+CiAgICAgICAgICAgICAgICAgICAgPEZsZXggZ2FwPSIkZ2FwNCIgZmxleD17MX0gbWluV2lkdGg9ezB9PgogICAgICAgICAgICAgICAgICAgICAgPEZsZXggcm93IGdhcD0iJGdhcDgiIGFsaWduSXRlbXM9ImNlbnRlciI+CiAgICAgICAgICAgICAgICAgICAgICAgIDxUZXh0IHZhcmlhbnQ9InN1YmhlYWRpbmcyIiBjb2xvcj17ZmVlID8gJyRuZXV0cmFsMScgOiAnJG5ldXRyYWwyJ30+CiAgICAgICAgICAgICAgICAgICAgICAgICAgeyFmZWUgPyAoeyBnZXREZWZhdWx0RmVlVGllcnNXaXRoRGF0YSwgZ2V0RmVlVGllcktleSwgaXNEeW5hbWljRmVlVGllciB9IGZyb20gJ2NvbXBvbmVudHMvTGlxdWlkaXR5L3V0aWxzL2ZlZVRpZXJzJwppbXBvcnQgeyBoYXNMUEZvVFRyYW5zZmVyRXJyb3IgfSBmcm9tICdjb21wb25lbnRzL0xpcXVpZGl0eS91dGlscy9oYXNMUEZvVFRyYW5zZmVyRXJyb3InCmltcG9ydCB7IERvdWJsZUN1cnJlbmN5TG9nbyB9IGZyb20gJ2NvbXBvbmVudHMvTG9nby9Eb3VibGVMb2dvJwppbXBvcnQgeyBMcEluY2VudGl2ZXNBcHJEaXNwbGF5IH0gZnJvbSAnY29tcG9uZW50cy9McEluY2VudGl2ZXMvTHBJbmNlbnRpdmVzQXByRGlzcGxheScKaW1wb3J0IHsgU3dpdGNoTmV0d29ya0FjdGlvbiB9IGZyb20gJ2NvbXBvbmVudHMvUG9wdXBzL3R5cGVzJwppbXBvcnQgQ3VycmVuY3lTZWFyY2hNb2RhbCBmcm9tICdjb21wb25lbnRzL1NlYXJjaE1vZGFsL0N1cnJlbmN5U2VhcmNoTW9kYWwnCmltcG9ydCB7IE1vdXNlb3ZlclRvb2x0aXAgfSBmcm9tICdjb21wb25lbnRzL1Rvb2x0aXAnCmltcG9ydCB7IEJJUFNfQkFTRSB9IGZyb20gJ2NvbnN0YW50cy9taXNjJwppbXBvcnQgeyBTVVBQT1JURURfVjJQT09MX0NIQUlOX0lEUyB9IGZyb20gJ2hvb2tzL3VzZU5ldHdvcmtTdXBwb3J0c1YyJwppbXBvcnQgeyB1c2VDcmVhdGVMaXF1aWRpdHlDb250ZXh0IH0gZnJvbSAncGFnZXMvQ3JlYXRlUG9zaXRpb24vQ3JlYXRlTGlxdWlkaXR5Q29udGV4dFByb3ZpZGVyJwppbXBvcnQgdHlwZSB7IERpc3BhdGNoLCBTZXRTdGF0ZUFjdGlvbiB9IGZyb20gJ3JlYWN0JwppbXBvcnQgeyB1c2VDYWxsYmFjaywgdXNlRWZmZWN0LCB1c2VNZW1vLCB1c2VSZWR1Y2VyLCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JwppbXBvcnQgeyBUcmFucywgdXNlVHJhbnNsYXRpb24gfSBmcm9tICdyZWFjdC1pMThuZXh0JwppbXBvcnQgeyB1c2VOYXZpZ2F0ZSB9IGZyb20gJ3JlYWN0LXJvdXRlcicKaW1wb3J0IHsgdXNlTXVsdGljaGFpbkNvbnRleHQgfSBmcm9tICdzdGF0ZS9tdWx0aWNoYWluL3VzZU11bHRpY2hhaW5Db250ZXh0JwppbXBvcnQgeyBzZXJpYWxpemVTd2FwU3RhdGVUb1VSTFBhcmFtZXRlcnMgfSBmcm9tICdzdGF0ZS9zd2FwL2hvb2tzJwppbXBvcnQgeyBDbGlja2FibGVUYW1hZ3VpU3R5bGUgfSBmcm9tICd0aGVtZS9jb21wb25lbnRzL3N0eWxlcycKaW1wb3J0IHR5cGUgeyBGbGV4UHJvcHMgfSBmcm9tICd1aS9zcmMnCmltcG9ydCB7IEJ1dHRvbiwgRHJvcGRvd25CdXR0b24sIEZsZXgsIEhlaWdodEFuaW1hdG9yLCBTaGluZSwgc3R5bGVkLCBUZXh0IH0gZnJvbSAndWkvc3JjJwppbXBvcnQgeyBDaGVja0NpcmNsZUZpbGxlZCB9IGZyb20gJ3VpL3NyYy9jb21wb25lbnRzL2ljb25zL0NoZWNrQ2lyY2xlRmlsbGVkJwppbXBvcnQgeyBJbmZvQ2lyY2xlRmlsbGVkIH0gZnJvbSAndWkvc3JjL2NvbXBvbmVudHMvaWNvbnMvSW5mb0NpcmNsZUZpbGxlZCcKaW1wb3J0IHsgUm90YXRhYmxlQ2hldnJvbiB9IGZyb20gJ3VpL3NyYy9jb21wb25lbnRzL2ljb25zL1JvdGF0YWJsZUNoZXZyb24nCmltcG9ydCB7IFNlYXJjaCB9IGZyb20gJ3VpL3NyYy9jb21wb25lbnRzL2ljb25zL1NlYXJjaCcKaW1wb3J0IHsgaWNvblNpemVzIH0gZnJvbSAndWkvc3JjL3RoZW1lJwppbXBvcnQgeyBUb2tlbkxvZ28gfSBmcm9tICd1bmlzd2FwL3NyYy9jb21wb25lbnRzL0N1cnJlbmN5TG9nby9Ub2tlbkxvZ28nCmltcG9ydCB7IFpFUk9fQUREUkVTUyB9IGZyb20gJ3VuaXN3YXAvc3JjL2NvbnN0YW50cy9taXNjJwppbXBvcnQgeyBuYXRpdmVPbkNoYWluLCBXUkFQUEVEX05BVElWRV9DVVJSRU5DWSB9IGZyb20gJ3VuaXN3YXAvc3JjL2NvbnN0YW50cy90b2tlbnMnCmltcG9ydCB7IHVzZUVuYWJsZWRDaGFpbnMgfSBmcm9tICd1bmlzd2FwL3NyYy9mZWF0dXJlcy9jaGFpbnMvaG9va3MvdXNlRW5hYmxlZENoYWlucycKaW9vcCcKCnR5cGUgTWVudU9wdGlvbiA9IHsKICB0aXRsZTogc3RyaW5nCiAgYWN0aW9uOiAoKSA9PiBQcm9taXNlPHZvaWQ+Cn0KCmNvbnN0IElDT05fU0laRSA9IGljb25TaXplcy5pY29uMTYKY29uc3QgSUNPTl9QQURESU5HID0gc3BhY2luZy5zcGFjaW5nOAoKZXhwb3J0IGZ1bmN0aW9uIE5GVENvbGxlY3Rpb25Db250ZXh0TWVudSh7CiAgZGF0YSwKICBzaG93QnV0dG9uT3V0bGluZSA9IGZhbHNlLAogIGljb25Db2xvciA9ICckbmV1dHJhbDInLAp9OiB7CiAgZGF0YTogTWF5YmU8TkZUQ29sbGVjdGlvbkRhdGE+CiAgc2hvd0J1dHRvbk91dGxpbmU/OiBib29sZWFuCiAgaWNvbkNvbG9yPzogQ29sb3JUb2tlbnMKfSk6IE51bGxhYmxlPEpTWC5FbGVtZW50PiB7CiAgY29uc3QgeyB0IH0gPSB1c2VUcmFuc2xhdGlvbigpCgogIGNvbnN0IHR3aXR0ZXJVUkwgPSBkYXRhPy50d2l0dGVyTmFtZSA/IGdldFR3aXR0ZXJMaW5rKGRhdGEudHdpdHRlck5hbWUpIDogdW5kZWZpbmVkCiAgY29uc3QgaG9tZXBhZ2VVcmwgPSBkYXRhPy5ob21lcGFnZVVybAoKICBjb25zdCBvblNvY2lhbFByZXNzID0gYXN5bmMgKCk6IFByb21pc2U8dm9pZD4gPT4gewogICAgaWYgKCF0d2l0dGVyVVJMKSB7CiAgICAgIHJldHVybgogICAgfQogICAgYXdhaXQgb3BlblVyaSh7IHVyaTogdHdpdHRlclVSTCB9KQogIH0KCiAgY29uc3Qgb3BlbkV4cGxvcmVyTGluayA9IGFzeW5jICgpOiBQcm9taXNlPHZvaWQ+ID0+IHsKICAgIGlmICghaG9tZXBhZ2VVcmwpIHsKICAgICAgcmV0dXJuCiAgICB9CiAgICBhd2FpdCBvcGVuVXJpKHsgdXJpOiBob21lcGFnZVVybCB9KQogIH0KCiAgY29uc3QgbWVudUFjdGlvbnM6IE1lbnVPcHRpb25bXSA9IFsKICAgIHR3aXR0ZXJVUkwKICAgICAgPyB7CiAgICAgICAgICB0aXRsZTogJ1R3aXR0ZXInLAogICAgICAgICAgYWN0aW9uOiBvblNvY2lhbFByZXNzLAogICAgICAgIH0KICAgICAgOiB1bmRlZmluZWQsCiAgICBob21lcGFnZVVybAogICAgICA/IHsKICAgICAgICAgIHRpdGxlOiB0KCd0b2tlbnMubmZ0cy5saW5rLmNvbGxlY3Rpb24nKSwKICAgICAgICAgIGFjdGlvbjogb3BlbkV4cGxvcmVyTGluaywKICAgICAgICB9CiAgICAgIDogdW5kZWZpbmVkLAogIF0uZmlsdGVyKChvcHRpb24pOiBvcHRpb24gaXMgTWVudU9wdGlvbiA9PiAhIW9wdGlvbikKCiAgLy8gT25seSBkaXNwbGF5IG1lbnUgaWYgdmFsaWQgb3B0aW9ucyBmcm9tIGRhdGEgcmVzcG9uc2UsIG90aGVyd2lzZSByZXR1cm4gZW1wdHkKICAvLyBlbGVtZW50IGZvciBzcGFjaW5nIHB1cnBvc2VzCiAgaWYgKCFob21lcGFnZVVybCAmJiAhdHdpdHRlclVSTCkgewogICAgcmV0dXJuIDxGbGV4IHN0eWxlPXt7IHBhZGRpbmc6IElDT05fUEFERElORyB9fSB3aWR0aD17SUNPTl9TSVpFfSAvPgogIH0KCiAgcmV0dXJuICgKICAgIDxDb250ZXh0TWVudQogICAgICBhY3Rpb25zPXttZW51QWN0aW9uc30KICAgICAgZHJvcGRvd25NZW51TW9kZT17dHJ1ZX0KICAgICAgb25QcmVzcz17YXN5bmMgKGU6IE5hdGl2ZVN5bnRoZXRpY0V2ZW50PENvbnRleHRNZW51T25QcmVzc05hdGl2ZUV2ZW50Pik6IFByb21pc2U8dm9pZD4gPT4gewogICAgICAgIGF3YWl0IG1lbnVBY3Rpb25zW2UubmF0aXZlRXZlbnQuaW5kZXhdPy5hY3Rpb24oKQogICAgICB9fQogICAgPgogICAgICA8VG91Y2hhYmxlQXJlYQogICAgICAgIGJhY2tncm91bmRDb2xvcj17c2hvd0J1dHRvbk91dGxpbmUgPyAnJHNjcmltJyA6ICckdHJhbnNwYXJlbnQnfQogICAgICAgIGJvcmRlclJhZGl1cz0iJHJvdW5kZWRGdWxsIgogICAgICAgIHN0eWxlPXt7IHBhZGRpbmc6IElDT05fUEFERElORyB9fQogICAgICAgIG9uTG9uZ1ByZXNzPXtub29wfQogICAgICAgIG9uUHJlc3M9e25vb3B9CiAgICAgID4KICAgICAgICA8RmxleCBjZW50ZXJlZCBncm93PgogICAgICAgICAgPEVsbGlwc2lzIGNvbG9yPXtpY29uQ29sb3J9IHNpemU9e0lDT0lucHV0Lk1BWF06IGZhbHNlLAogIH0pCgogIGNvbnN0IHsgbWluUHJpY2UsIG1heFByaWNlLCBpc0Z1bGxSYW5nZSwgaW5wdXRNb2RlIH0gPSB1c2VDaGFydFByaWNlU3RhdGUoKQogIGNvbnN0IHByaWNlRGlmZmVyZW5jZXMgPSB1c2VMaXF1aWRpdHlDaGFydFN0b3JlUHJpY2VEaWZmZXJlbmNlcygpCiAgY29uc3QgeyBsaXF1aWRpdHlEYXRhLCBwcmljZURhdGEgfSA9IHVzZUxpcXVpZGl0eUNoYXJ0U3RvcmVSZW5kZXJpbmdDb250ZXh0KCkgPz8ge30KICBjb25zdCB7IHNldENoYXJ0U3RhdGUsIGRlY3JlbWVudE1pbiwgaW5jcmVtZW50TWluLCBkZWNyZW1lbnRNYXgsIGluY3JlbWVudE1heCwgdG9nZ2xlSW5wdXRNb2RlIH0gPQogICAgdXNlTGlxdWlkaXR5Q2hhcnRTdG9yZUFjdGlvbnMoKQoKICBjb25zdCBjdXJyZW50UHJpY2UgPSBwcmljZURhdGE/LltwcmljZURhdGEubGVuZ3RoIC0gMV0/LnZhbHVlCiAgY29uc3QgYWJzb2x1dGVNaW5QcmljZSA9IGxpcXVpZGl0eURhdGE/LlswXS5wcmljZTAKICBjb25zdCBhYnNvbHV0ZU1heFByaWNlID0gbGlxdWlkaXR5RGF0YT8uW2xpcXVpZGl0eURhdGEubGVuZ3RoIC0gMV0ucHJpY2UwCgogIC8vIE5hdmlnYXRpb24gcGFyYW1zIGZvciBpbmNyZW1lbnQvZGVjcmVtZW50IGFjdGlvbnMKICBjb25zdCB0aWNrTmF2aWdhdGlvblBhcmFtczogVGlja05hdmlnYXRpb25QYXJhbXMgfCB1bmRlZmluZWQgPSB1c2VNZW1vKCgpID0+IHsKICAgIGlmICghcG9zaXRpb25TdGF0ZS5mZWU/LnRpY2tTcGFjaW5nIHx8ICFjdXJyZW5jaWVzLmRpc3BsYXkuVE9LRU4wIHx8ICFjdXJyZW5jaWVzLmRpc3BsYXkuVE9LRU4xKSB7CiAgICAgIHJldHVybiB1bmRlZmluZWQKICAgIH0KCiAgICBjb25zdCB7IGJhc2VDdXJyZW5jeSwgcXVvdGVDdXJyZW5jeSB9ID0gZ2V0QmFzZUFuZFF1b3RlQ3VycmVuY2llcyhjdXJyZW5jaWVzLmRpc3BsYXksIHByaWNlUmFuZ2VTdGF0ZS5wcmljZUludmVydGVkKQoKICAgIHJldHVybiB7CiAgICAgIHRpY2tTcGFjaW5nOiBwb3NpdGlvblN0YXRlLmZlZS50aWNrU3BhY2luZywKICAgICAgYmFzZUN1cnJlbmN5LAogICAgICBxdW90ZUN1cnJlbmN5LAogICAgICBwcmljZUludmVydGVkOiBwcmljZVJhbmdlU3RhdGUucHJpY2VJbnZlcnRlZCwKICAgICAgcHJvdG9jb2xWZXJzaW9uOiBwb3NpdGlvblN0YXRlLnByb3RvY29sVmVyc2lvbiwKICAgIH0KICB9LCBbcG9zaXRpb25TdGF0ZS5mZWU/LnRpY2tTcGFjaW5nLCBjdXJyZW5jaWVzLmRpc3BsYXksIHByaWNlUmFuZ2VTdGF0ZS5wcmljZUludmVydGVkLCBwb3NpdGlvblN0YXRlLnByb3RvY29sVmVyc2lvbl0pCgogIC8vIEdldCBkaXNwbGF5IHZhbHVlIGJhc2VkIG9uIGlucHV0IG1vZGUKICBjb25zdCBnZXREaXNwbGF5VmFsdWUgPSB1c2VDYWxsYmFjaygKICAgIChpbnB1dDogUmFuZ2VTZWxlY3Rpb25JbnB1dCkgPT4gewogICAgICBpZiAoZGlzcGxheVVzZXJUeXBlZFZhbHVlW2lucHV0XSkgewogICAgICAgIHJldHVybiB0eXBlZFZhbHVlW2lucHV0XQogICAgICB9CgogICAgICBpZiAoaW5wdXRNb2RlID09PSBSYW5nZUFtb3VudElucHV0UHJpY2VNb2RlLlBFUkNFTlRBR0UpIHsKICAgICAgICBjb25zdCBwcmljZURpZmYgPQogICAgICAgICAgaW5wdXQgPT09IFJhbmdlU2VsZWN0aW9uSW5wdXQuTUlOID8gcHJpY2VEaWZmZXJlbmNlcz8ubWluUHJpY2VEaWZmIDogcHJpY2VEaWZmZXJlbmNlcz8ubWF4UHJpY2VEaWZmCiAgICAgICAgcmV0dXJuIHByaWNlRGlmZiAhPT0gdW5kZWZpbmVkID8gcHJpY2VEaWZmLnRvRml4ZWQoMikgOiAnJwogICAgICB9CgogICAgICBjb25zdCBwcmljZSA9IGlucHV0ID09PSBSYW5nZVNlbGVjdGlvbklucHV0Lk1JTiA/IG1pblByaWNlIDogbWF4UHJpY2UKCiAgICAgIGlmIChpbnB1dCA9PT0gUmFuZ2VTZWxlY3Rpb25JbnB1dC5NSU4gJiYgdGlja3NBdExpbWl0WzBdICYmICFwb3NpdGlvblN0YXRlLmluaXRpYWxQb3Npb25zOiBtb2NrRGF0YSwKICAgICAgbG9hZGluZzogZmFsc2UsCiAgICAgIGVycm9yOiB1bmRlZmluZWQsCiAgICAgIGxvYWRNb3JlOiB2aS5mbigpLAogICAgfSkKICAgIG1vY2tlZCh1c2VBYmJyZXZpYXRlZFRpbWVTdHJpbmcpLm1vY2tSZXR1cm5WYWx1ZSgnMW1vIGFnbycpCgogICAgY29uc3QgeyBhc0ZyYWdtZW50IH0gPSByZW5kZXIoPFBvb2xEZXRhaWxzVHJhbnNhY3Rpb25zVGFibGUgcG9vbEFkZHJlc3M9e3VzZGNXZXRoUG9vbEFkZHJlc3N9IC8+KQogICAgZXhwZWN0KHNjcmVlbi5nZXRCeVRlc3RJZCgncG9vbC1kZXRhaWxzLXRyYW5zYWN0aW9ucy10YWJsZScpKS5ub3QudG9CZU51bGwoKQogICAgZXhwZWN0KGFzRnJhZ21lbnQoKSkudG9NYXRjaFNuYXBzaG90KCkKICB9KQp9KQppbXBvcnQgeyByZW5kZXJIb29rIH0gZnJvbSAnQHRlc3RpbmctbGlicmFyeS9yZWFjdCcKaW1wb3J0IHsgdXNlRGVyaXZlZFNlbmRJbmZvIH0gZnJvbSAnc3RhdGUvc2VuZC9ob29rcycKaW1wb3J0IHsgU2VuZFN0YXRlIH0gZnJvbSAnc3RhdGUvc2VuZC9TZW5kQ29udGV4dCcKaW1wb3J0IHsgdXNlVW5pdGFnc0FkZHJlc3NRdWVyeSB9IGZyb20gJ3VuaXN3YXAvc3JjL2RhdGEvYXBpQ2xpZW50cy91bml0YWdzQXBpL3VzZVVuaXRhZ3NBZGRyZXNzUXVlcnknCmltcG9ydCB7IHVzZVVuaXRhZ3NVc2VybmFtZVF1ZXJ5IH0gZnJvbSAndW5pc3dhcC9zcmMvZGF0YS9hcGlDbGllbnRzL3VuaXRhZ3NBcGkvdXNlVW5pdGFnc1VzZXJuYW1lUXVlcnknCmltcG9ydCB7IHVzZUFkZHJlc3NGcm9tRW5zLCB1c2VFTlNOYW1lIH0gZnJvbSAndW5pc3dhcC9zcmMvZmVhdHVyZXMvZW5zL2FwaScKaW1wb3J0IHsgZ2V0QWRkcmVzcyB9IGZyb20gJ3ZpZW0nCmltcG9ydCB0eXBlIHsgTW9jayB9IGZyb20gJ3ZpdGVzdCcKCnZpLm1vY2soJ0B3ZWIzLXJlYWN0L2NvcmUnLCAoKSA9PiAoewogIHVzZVdlYjNSZWFjdDogKCkgPT4gKHsKICAgIGNoYWluSWQ6IDEsCiAgICBwcm92aWRlcjoge30sCiAgfSksCn0pKQp2aS5tb2NrKCdob29rcy91c2VBY2NvdW50JywgKCkgPT4gKHsKICB1c2VBY2NvdW50OiAoKSA9PiAnMHhZb3VyQWNjb3VudEFkZHJlc3MnLAp9KSkKdmkubW9jaygnc3RhdGUvbXVsdGljaGFpbi91c2VNdWx0aWNoYWluQ29udGV4dCcsIGFzeW5jICgpID0+IHsKICBjb25zdCBhY3R1YWwgPSBhd2FpdCB2aS5pbXBvcnRBY3R1YWwoJ3N0YXRlL211bHRpY2hhaW4vdXNlTXVsdGljaGFpbkNvbnRleHQnKQogIHJldHVybiB7CiAgICAuLi5hY3R1YWwsCiAgICB1c2VNdWx0aWNoYWluQ29udGV4dDogKCkgPT4gKHsKICAgICAgY2hhaW5JZDogMSwKICAgIH0pLAogIH0KfSkKdmkubW9jaygnaG9va3MvdXNlVHJhbnNhY3Rpb25HYXNGZWUnLCBhc3luYyAoKSA9PiB7CiAgY29uc3QgYWN0dWFsID0gYXdhaXQgdmkuaW1wb3J0QWN0dWFsKCdob29rcy91c2VUcmFuc2FjdGlvbkdhc0ZlZScpCiAgcmV0dXJuIHsKICAgIC4uLmFjdHVhbCwKICAgIHVzZVRyYW5zYWN0aW9uR2FzRmVlOiAoKSA9PiAoewogICAgICBnYXNGZWU6IHsKICAgICAgICB2YWx1ZTogJzEwMDAwMDAnLAogICAgICB9LAogICAgfSksCiAgICBHYXNTcGVlZDogewogICAgICBOb3JtYWw6ICdub3JtYWwnLAogICAgfSwKICB9Cn0pCnZpLm1vY2soJ2hvb2tzL1Rva2VucycsICgpID0+ICh7CiAgdXNlQ3VycmVuY3k6ICgpID0+IHVuZGVmaW5lZCwKfSkpCnZpLm1vY2soJ2hvb2tzL3VzZVVTRFRva2VuVXBkYXRlcicsICgpID0+ICh7CiAgdXNlVVNEVG9rZW5VcGRhdGVyOiAoKSA9PiAoeyBmb3JtYXR0ZWRBbW91bnQ6ICcxMDAnIH0pLAp9KSkKdmkubW9jaygnbGliL2hvb2tzL3VzZUN1cnJlbmN5QmFsYW5jZScsICgpID0+ICh7CiAgdXNlQ3VycmVuY3lCYWxhbmNlczogKCkgPT4gW3VuZGVmaW5lZCwgdW5kZWZpbmVkXSwKfSkpCnZpLm1vY2soJ3V0aWxzL3RyYW5zZmVyJywgKCkgPT4gKHsKICB1c2VDcmVhdGVUcmFuc2ZlclRyYW5uc3QgaWNvbiA9ICgKICAgIDxTcGxpdExvZ28KICAgICAgY2hhaW5JZD17Y2hhaW5JZH0KICAgICAgaW5wdXRDdXJyZW5jeUluZm89e2lucHV0Q3VycmVuY3lJbmZvfQogICAgICBvdXRwdXRDdXJyZW5jeUluZm89e291dHB1dEN1cnJlbmN5SW5mb30KICAgICAgc2l6ZT17Tk9USUZJQ0FUSU9OX0lDT05fU0laRX0KICAgIC8+CiAgKQoKICByZXR1cm4gKAogICAgPE5vdGlmaWNhdGlvblRvYXN0CiAgICAgIGFjdGlvbkJ1dHRvbj17cmV0cnlCdXR0b259CiAgICAgIGFkZHJlc3M9e2FkZHJlc3N9CiAgICAgIGhpZGVEZWxheT17aGlkZURlbGF5fQogICAgICBpY29uPXtpY29ufQogICAgICB0aXRsZT17dGl0bGV9CiAgICAgIG9uUHJlc3M9e25hdmlnYXRlVG9BY2NvdW50QWN0aXZpdHlMaXN0fQogICAgLz4KICApCn0KaW1wb3J0IHR5cGUgeyBPcmlnaW5hbFN0YWNrRnJhbWUgfSBmcm9tICcuLi8uLi8uLi9zaGFyZWQvc3RhY2stZnJhbWUnCgppbXBvcnQgeyBIb3RsaW5rZWRUZXh0IH0gZnJvbSAnLi4vaG90LWxpbmtlZC10ZXh0JwppbXBvcnQgeyBFeHRlcm5hbEljb24sIFNvdXJjZU1hcHBpbmdFcnJvckljb24gfSBmcm9tICcuLi8uLi9pY29ucy9leHRlcm5hbCcKaW1wb3J0IHsgZ2V0U3RhY2tGcmFtZUZpbGUgfSBmcm9tICcuLi8uLi8uLi9zaGFyZWQvc3RhY2stZnJhbWUnCmltcG9ydCB7IHVzZU9wZW5JbkVkaXRvciB9IGZyb20gJy4uLy4uL3V0aWxzL3VzZS1vcGVuLWluLWVkaXRvcicKCmV4cG9ydCBjb25zdCBDYWxsU3RhY2tGcmFtZTogUmVhY3QuRkM8ewogIGZyYW1lOiBPcmlnaW5hbFN0YWNrRnJhbWUKfT4gPSBmdW5jdGlvbiBDYWxsU3RhY2tGcmFtZSh7IGZyYW1lIH0pIHsKICAvLyBUT0RPOiBhYmlsaXR5IHRvIGV4cGFuZCByZXNvbHZlZCBmcmFtZXMKCiAgY29uc3QgZiA9IGZyYW1lLm9yaWdpbmFsU3RhY2tGcmFtZSA/PyBmcmFtZS5zb3VyY2VTdGFja0ZyYW1lCiAgY29uc3QgaGFzT3JpZ2luYWxDb2RlRnJhbWUgPSBCb29sZWFuKGZyYW1lLm9yaWdpbmFsQ29kZUZyYW1lKQogIGNvbnN0IG9wZW4gPSB1c2VPcGVuSW5FZGl0b3IoCiAgICBoYXNPcmlnaW5hbENvZGVGcmFtZQogICAgICA/IHsKICAgICAgICAgIGZpbGU6IGYuZmlsZSwKICAgICAgICAgIGxpbmUxOiBmLmxpbmUxID8/IDEsCiAgICAgICAgICBjb2x1bW4xOiBmLmNvbHVtbjEgPz8gMSwKICAgICAgICB9CiAgICAgIDogdW5kZWZpbmVkCiAgKQoKICAvLyBGb3JtYXR0ZWQgZmlsZSBzb3VyY2UgY291bGQgYmUgZW1wdHkuIGUuZy4gPGFub255bW91cz4gd2lsbCBiZSBmb3JtYXR0ZWQgdG8gZW1wdHkgc3RyaW5nLAogIC8vIHdlJ2xsIHNraXAgcmVuZGVyaW5nIHRoZSBmcmFtZSBpbiB0aGlzIGNhc2UuCiAgY29uc3Qgc3RhY2tGcmFtZUZpbGUgPSBnZXRTdGFja0ZyYW1lRmlsZShmKQoKICBpZiAoIXN0YWNrRnJhbWVGaWxlKSB7CiAgICByZXR1cm4gbnVsbAogIH0KCiAgcmV0dXJuICgKICAgIDxkaXYKICAgICAgZGF0YS1uZXh0anMtY2FsbC1zdGFjay1mcmFtZQogICAgICBkYXRhLW5leHRqcy1jYWxsLXN0YWNrLWZyYW1lLW5vLXNvdXJjZT17IWhhc09yaWdpbmFsQ29kZUZyYW1lfQogICAgICBkYXRhLW5leHRqcy1jYWxsLXN0YWNrLWZyYW1lLWlnbm9yZWQ9e2ZyYW1lLmlnbm9yZWR9CiAgICA+CiAgICAgIDxkaXYgY2xhc3NOYW1lPSJjYWxsLXN0YWNrLWZyYW1lLW1ldGhvZC1uYW1lIj4KICAgICAgICA8SG90bGlua2VkVGV4dCB0ZXh0PXtmLm1ldGhvZE5hbWV9IC8+CiAgICAgICAge2hhc09yaWdpbmFsQ29kZUZyYW1lICYmICgKICAgICAgICAgIDxidXR0b24KICAgICAgICAgICAgb25DbGljaz17b3Blbn0KICAgICAgICAgICAgY2xhc3NOYW1lPSJvcGVuLWluLWVkaXRvci1idXR0b24iCiAgICAgICAgICAgIGFyaWEtbGFiZWw9e2BPcGVuICR7Zi5tZXRob2ROYW1lfSBpbiBlZGl0b3JgfQogICAgICAgICAgPgogICAgICAgICAgICA8RXh0ZXJuYWxJY29uIHdpZHRoPXsxNn0gaGVpeXBlcy9DYWxlbmRhciI7CgppbXBvcnQgeyBCYXNlU2NoZWR1bGVkRW1haWwgfSBmcm9tICIuL0Jhc2VTY2hlZHVsZWRFbWFpbCI7CgpleHBvcnQgY29uc3QgT3JnYW5pemVyU2NoZWR1bGVkRW1haWwgPSAoCiAgcHJvcHM6IHsKICAgIGNhbEV2ZW50OiBDYWxlbmRhckV2ZW50OwogICAgYXR0ZW5kZWU6IFBlcnNvbjsKICAgIG5ld1NlYXQ/OiBib29sZWFuOwogICAgYXR0ZW5kZWVDYW5jZWxsZWQ/OiBib29sZWFuOwogICAgdGVhbU1lbWJlcj86IFBlcnNvbjsKICAgIHJlYXNzaWduZWQ/OiB7IG5hbWU6IHN0cmluZyB8IG51bGw7IGVtYWlsOiBzdHJpbmc7IHJlYXNvbj86IHN0cmluZzsgYnlVc2VyPzogc3RyaW5nIH07CiAgfSAmIFBhcnRpYWw8UmVhY3QuQ29tcG9uZW50UHJvcHM8dHlwZW9mIEJhc2VTY2hlZHVsZWRFbWFpbD4+CikgPT4gewogIGxldCBzdWJqZWN0OwogIGxldCB0aXRsZTsKCiAgaWYgKHByb3BzLm5ld1NlYXQpIHsKICAgIHN1YmplY3QgPSAibmV3X3NlYXRfc3ViamVjdCI7CiAgfSBlbHNlIHsKICAgIHN1YmplY3QgPSAiY29uZmlybWVkX2V2ZW50X3R5cGVfc3ViamVjdCI7CiAgfQoKICBpZiAocHJvcHMuY2FsRXZlbnQucmVjdXJyaW5nRXZlbnQ/LmNvdW50KSB7CiAgICB0aXRsZSA9ICJuZXdfZXZlbnRfc2NoZWR1bGVkX3JlY3VycmluZyI7CiAgfSBlbHNlIGlmIChwcm9wcy5uZXdTZWF0KSB7CiAgICB0aXRsZSA9ICJuZXdfc2VhdF90aXRsZSI7CiAgfSBlbHNlIHsKICAgIHRpdGxlID0gIm5ld19ldmVudF9zY2hlZHVsZWQiOwogIH0KCiAgY29uc3QgdCA9IHByb3BzLnRlYW1NZW1iZXI/Lmxhbmd1YWdlLnRyYW5zbGF0ZSB8fCBwcm9wcy5jYWxFdmVudC5vcmdhbml6ZXIubGFuZ3VhZ2UudHJhbnNsYXRlOwogIGNvbnN0IGxvY2FsZSA9IHByb3BzLnRlYW1NZW1iZXI/Lmxhbmd1YWdlLmxvY2FsZSB8fCBwcm9wcy5jYWxFdmVudC5vcmdhbml6ZXIubGFuZ3VhZ2UubG9jYWxlOwogIGNvbnN0IHRpbWVGb3JtYXQgPSBwcm9wcy50ZWFtTWVtYmVyPy50aW1lRm9ybWF0IHx8IHByb3BzLmNhbEV2ZW50Lm9yZ2FuaXplcj8udGltZUZvcm1hdDsKCiAgY29uc3QgaXNUZWFtRXZlbnQgPQogICAgcHJvcHMuY2FsRXZlbnQuc2NoZWR1bGluZ1R5cGUgPT09IFNjaGVkdWxpbmdUeXBlLlJPVU5EX1JPQklOIHx8CiAgICBwcm9wcy5jYWxFdmVudC5zY2hlZHVsaW5nVHlwZSA9PT0gU2NoZWR1bGluZ1R5cGUuQ09MTEVDVElWRTsKICBjb25zdCBhdHRlbmRlZSA9IGlzVGVhbUV2ZW50ICYmIHByb3BzLnRlYW1NZW1iZXIgPyBwcm9wcy50ZWFtTWVtYmVyIDogcHJvcHMuYXR0ZW5kZWU7CgogIHJldHVybiAoCiAgICA8QmFzZVNjaGVkdWxlZEVtYWlsCiAgICAgIGxvY2FsZT17bG9jYWxlfQogICAgICB0aW1lWm9uZT17cHJvcHMudGVhbU1lbWJlcj8udGltZVpvbmUgfHwgcHJvcHMuY2FsRXZlbnQub3JnYW5pemVyLnRpbWVab25lfQogICAgICB0PXt0fQogICAgICBzdWJqZWN0PXt0KHN1YmplY3QpfQogICAgICB0aXRsZT17dCh0aXRsZSl9CiAgICAgIGluY2x1ZGVBcHBzU3RhdHVzCiAgICAgIHRpbWVGb3JtYXQ9e3RpbWVGb3JtYXR9CiAgICAgIGlzT3JnYW5pemVyCiAgICAgIHN1YnRpdGxlPXsKICAgICAgICBwcm9wcy5zdWJ0aXRsZSA/ICgKICAgICAgICAgIHByb3BzLnN1YnRpdGxlCiAgICAgICAgKSA6ICgKICAgICAgICAgIDw+CiAgICAgICAgICAgIHtwcm9wcy5hdHRlbmRlZUNhbmNlbGxlZAogICAgICAgICAgICAgID8gdCgiYXR0ZW5kZWVfbm9fbG9uZ2VyX2F0dGVuZGluZ19zdWJ0aXRsZSIsIHsgbmFtZTogcHJvcHMuYXR0ZW5kZWUubmFtZSwgaW50ZXJwb2xhdGlvbjogeyBlc2NhcGVWYWx1ZTogZmFsc2UgfSB9KQogICAgICAgICAgICAgIDogIiJ9CiAgICAgICAgICA8Lz4KICAgICAgICApCiAgICAgIH0KICAgICAgcmVhc3NpZ25lZD17cHJvcHMucmVhc3NpZ25lZH0KICAgICAgey4uLnByb3BzfQogICAgICBhdHRlbmRlZT17YXR0ZW5kZWV9CiAgIGlzVGV4dEVkaXRvcj86IGJvb2xlYW47CiAgdmFyaWFibGVzOiBzdHJpbmdbXTsKICBhZGRWYXJpYWJsZUJ1dHRvblRvcD86IGJvb2xlYW47CiAgYWRkVmFyaWFibGVCdXR0b25DbGFzc05hbWU/OiBzdHJpbmc7Cn0KCmV4cG9ydCBjb25zdCBBZGRWYXJpYWJsZXNEcm9wZG93biA9IChwcm9wczogSUFkZFZhcmlhYmxlc0Ryb3Bkb3duKSA9PiB7CiAgY29uc3QgeyB0IH0gPSB1c2VMb2NhbGUoKTsKICBjb25zdCBbcXVlcnksIHNldFF1ZXJ5XSA9IHVzZVN0YXRlKCIiKTsKICBjb25zdCBpc01vYmlsZSA9IHVzZU1lZGlhUXVlcnkoIihtYXgtd2lkdGg6IDY0MHB4KSIpOwogIGNvbnN0IFtpc09wZW4sIHNldGlzT3Blbl0gPSB1c2VTdGF0ZShmYWxzZSk7CiAgY29uc3QgW3NlbGVjdGVkSW5kZXgsIHNldFNlbGVjdGVkSW5kZXhdID0gdXNlU3RhdGU8bnVtYmVyPigtMSk7CiAgY29uc3QgaXRlbVJlZnMgPSB1c2VSZWY8KEhUTUxCdXR0b25FbGVtZW50IHwgbnVsbClbXT4oW10pOwogIGNvbnN0IGRyb3Bkb3duQ29udGFpbmVyUmVmID0gdXNlUmVmPEhUTUxEaXZFbGVtZW50PihudWxsKTsKCiAgdXNlRWZmZWN0KCgpID0+IHsKICAgIGlmIChzZWxlY3RlZEluZGV4ID49IDAgJiYgZHJvcGRvd25Db250YWluZXJSZWYuY3VycmVudCAmJiBpdGVtUmVmcy5jdXJyZW50W3NlbGVjdGVkSW5kZXhdKSB7CiAgICAgIGNvbnN0IGNvbnRhaW5lciA9IGRyb3Bkb3duQ29udGFpbmVyUmVmLmN1cnJlbnQ7CiAgICAgIGNvbnN0IHNlbGVjdGVkSXRlbSA9IGl0ZW1SZWZzLmN1cnJlbnRbc2VsZWN0ZWRJbmRleF07CgogICAgICBpZiAoc2VsZWN0ZWRJdGVtKSB7CiAgICAgICAgY29uc3QgY29udGFpbmVyUmVjdCA9IGNvbnRhaW5lci5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKICAgICAgICBjb25zdCBpdGVtUmVjdCA9IHNlbGVjdGVkSXRlbS5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKTsKCiAgICAgICAgaWYgKGl0ZW1SZWN0LmJvdHRvbSA+IGNvbnRhaW5lclJlY3QuYm90dG9tKSB7CiAgICAgICAgICBjb250YWluZXIuc2Nyb2xsVG9wICs9IGl0ZW1SZWN0LmJvdHRvbSAtIGNvbnRhaW5lclJlY3QuYm90dG9tOwogICAgICAgIH0gZWxzZSBpZiAoaXRlbVJlY3QudG9wIDwgY29udGFpbmVyUmVjdC50b3ApIHsKICAgICAgICAgIGNvbnRhaW5lci5zY3JvbGxUb3AgLT0gY29udGFpbmVyUmVjdC50b3AgLSBpdGVtUmVjdC50b3A7CiAgICAgICAgfQogICAgICB9CiAgICB9CiAgfSwgW3NlbGVjdGVkSW5kZXhdKTsKCiAgY29uc3QgZmlsdGVyZWRWYXJpYWJsZXMgPSB1c2VNZW1vKCgpID0+IHsKICAgIGNvbnN0IHEgPSBxdWVyeS50cmltKCkudG9Mb3dlckNhc2UoKTsKICAgIGlmICghcSkgcmV0dXJuIHByb3BzLnZhcmlhYmxlczsKICAgIHJldHVybiBwcm9wcy52YXJpYWJsZXMuZmlsdGVyKCh2YXJpYWJsZSkgPT4gewogICAgICBjb25zdCBrZXkgPSB2YXJpYWJsZS50b0xvd2VyQ2FzZSgpOwogICAgICBjb25zdCBuYW1lID0gdChgJHt2YXJpYWJsZX1fdmFyaWFibGVgKS50b0xvd2VyQ2FzZSgpOwogICAgICBjb25zdCBpbmZvID0gdChgJHt2YXJpYWJsZX1faW5mb2ApLnRvTG93ZXJDYXNlKCk7CiAgICAgIHJldHVybiBrZXkuaW5jbHVkZXMocSkgfHwgbmFtZS5pbmNsdWRlcyhxKSB8fCBpbmZvLmluY2x1ZGVzKHEpOwogICAgfSk7CiAgfSwgW3Byb3BzLnZhcmlhYmxlcywgcXVlcnksIHRdKTsKCiAgY29uc3QgaGFuZGxlT25PcGVuID0gKG9wZW46IGJvb2xlYW4pID0+IHsKICAgIHNldGlzT3BlbihvcGVuKTsKICAgIGlmICghb3Blbikgc2V0UXVlcnkoIiIpOwogICAgc2V0U2VsZWN0ZWRJbmRleChvcGVuICYmIGZpbHRlcmVkVmFyaWFibGVzLmxlbmd0aCA+IDAgPyAwIDogLTEpOwogIH07CgogIGNvbnN0IGhhbmRsZUtleURvd24gPSAoZTogUmVhY3QuS2V5Ym9hcmRFdmVudCkgPT4gewogICAgaWYgKGZpbHRlcmVkVmFyaWFibGVzLmxlbmd0aCA9PT0gMCB8fCAhaXNPcGVuKSByZXRzaXMgbXQtMiB0ZXh0LXNtIHVuZGVybGluZSBob3Zlcjpuby11bmRlcmxpbmUiPgogICAgICAgIHtzaG93RGF0YSA/ICJIaWRlIiA6ICJTaG93In0gRXZlbnQgRGF0YQogICAgICA8L2J1dHRvbj4KCiAgICAgIHtzaG93RGF0YSAmJiAoCiAgICAgICAgPHByZSBjbGFzc05hbWU9ImJnLXN1YnRsZSBtdC0yIG92ZXJmbG93LWF1dG8gcm91bmRlZCBwLTIgdGV4dC14cyI+CiAgICAgICAgICB7SlNPTi5zdHJpbmdpZnkoc2NlbmFyaW8uZXZlbnRzLCBudWxsLCAyKX0KICAgICAgICA8L3ByZT4KICAgICAgKX0KICAgIDwvZGl2PgogICk7Cn0KCmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIFdlZWtseUNhbGVuZGFyUGxheWdyb3VuZCgpIHsKICByZXR1cm4gKAogICAgPGRpdiBjbGFzc05hbWU9InN0YWNrLXktOCBwLTYiPgogICAgICA8ZGl2PgogICAgICAgIDxoMSBjbGFzc05hbWU9InRleHQtM3hsIGZvbnQtYm9sZCI+V2Vla2x5IENhbGVuZGFyIFBsYXlncm91bmQ8L2gxPgogICAgICAgIDxwIGNsYXNzTmFtZT0idGV4dC1zdWJ0bGUgbXQtMiI+CiAgICAgICAgICBUZXN0IHRoZSBvdmVybGFwcGluZyBldmVudHMgY2FzY2FkaW5nIGxheW91dCB3aXRoIHZhcmlvdXMgc2NlbmFyaW9zLiBFdmVudHMgc2hvdWxkIGNhc2NhZGUgd2l0aCA4MCUKICAgICAgICAgIHdpZHRoIGFuZCA4JSBsZWZ0IG9mZnNldCBwZXIgb3ZlcmxhcCBsZXZlbC4gSG92ZXJpbmcgYW4gZXZlbnQgc2hvdWxkIGJyaW5nIGl0IHRvIHRoZSBmcm9udC4KICAgICAgICA8L3A+CiAgICAgIDwvZGl2PgoKICAgICAgey8qIEdyaWQgVmlldyBvZiBBbGwgU2NlbmFyaW9zICovfQogICAgICA8ZGl2IGNsYXNzTmFtZT0ic3RhY2steS04Ij4KICAgICAgICA8aDIgY2xhc3NOYW1lPSJtYi00IHRleHQtMnhsIGZvbnQtYm9sZCI+QWxsIFNjZW5hcmlvcyAoU2lkZS1ieS1TaWRlKTwvaDI+CiAgICAgICAge3NjZW5hcmlvcy5tYXAoKHNjZW5hcmlvLCBpbmRleCkgPT4gKAogICAgICAgICAgPFNjZW5hcmlvQ2FyZCBrZXk9e2luZGV4fSBzY2VuYXJpbz17c2NlbmFyaW99IC8+CiAgICAgICAgKSl9CiAgICAgIDwvZGl2PgoKICAgICAgey8qIFRlc3RpbmcgQ2hlY2tsaXN0ICovfQogICAgICA8ZGl2IGNsYXNzTmFtZT0iYm9yZGVyLXN1YnRsZSByb3VuZGVkLWxnIGJvcmRlciBwLTYiPgogICAgICAgIDxoMiBjbGFzc05hbWU9Im1iLTQgdGV4dC14bCBmb250LWJvbGQiPlRlc3RpbmcgQ2hlY2tsaXN0PC9oMj4KICAgICAgICA8dWwgY2xhc3NOYW1lPSJ0ZXh0LXN1YnRsZSBzdGFjay15LTIgdGV4dC1zbSI+CiAgICAgICAgICA8bGk+4pyTIFZpc3VhbCBhcHBlYXJhbmNlIG1hdGNoZXMgZXhwZWN0YXRpb25zICg4MCUgd2lkdGggd2l0aCA4JSBjYXNjYWRpbmcgb2Zmc2V0cyk8L2xpPgogICAgICAgICAgPGxpPuKckyBIb3ZlciBiZWhhdmlvciB3b3JrcyBzbW9vdGhseSAtIGhvdmVyZWQgZXZlbnQgYXBwZWFycyB0b3Btb3N0PC9saT4KICAgICAgICAgIDxsaT7inJMgTm8gdmlzdWFsIGdsaXRjaGVzIHdpdGggMysgb3ZlcmxhcHBpbmcgZXZlbnRzPC9saT4KICAgICAgICAgIDxsaT7inJMgUGVyZm9ybWFuY2UgaXMgYWNjZXB0YWJsZSB3aXRoIGRlbnNlIGV2ZW50IGRheXMgKDEwKyBldmVudHMpPC9saT4KICAgICAgICAgIDxsaT7inJMgRWRnZSBjYXNlOiBFdmVudHMgd2l0aCBpZGVudGljYWwgc3RhcnQgdGltZXMgcmVuZGVyIGNvcnJlY3RseTwvbGk+CiAgICAgICAgICA8bGk+4pyTIEVkZ2UgY2FzZTogRXZlbnRzIHRoYXQgdG91Y2ggZXhhY3RseSAoZW5kID0gbmV4dCBzdGFydCkgZG9uJmFwb3M7dCBpbmNvcnJlY3RseSBvdmVybGFwPC9saT4KICAgICAgICAgIDxsaT7inJMgRGlmZmVyZW50IGJvb2tpbmcgc3RhdHVzZXMgKEFDQ0VQVEVELCBQRU5ESU5HLCBDQU5DRUxMRUQpIGRpc3BsYXkgY29ycmVjdGx5PC9saT4KICAgICAgICAgIDxsaT7inJMgQ29sb3IgYmFycyBvbiB0aGUgbGVmdCBzaWRlIG9mIGV2ZW50cyBkaXNwclRlYW1NZW1iZXJzLnVzZUluZmluaXRlUXVlcnkoCiAgICB7IHRlYW1JZCwgbGltaXQgfSwKICAgIHsKICAgICAgZW5hYmxlZDogIU51bWJlci5pc05hTih0ZWFtSWQpLAogICAgICBnZXROZXh0UGFnZVBhcmFtOiAobGFzdFBhZ2UpID0+IGxhc3RQYWdlLm5leHRDdXJzb3IsCiAgICAgIHBsYWNlaG9sZGVyRGF0YToga2VlcFByZXZpb3VzRGF0YSwKICAgIH0KICApOwoKICB1c2VFZmZlY3QoCiAgICBmdW5jdGlvbiByZWZhY3Rvck1lV2l0aG91dEVmZmVjdCgpIHsKICAgICAgaWYgKG90aGVyTWVtYmVyc0Vycm9yIHx8IG90aGVyVGVhbUVycm9yKSB7CiAgICAgICAgcm91dGVyLnJlcGxhY2UoIi9lbnRlcnByaXNlIik7CiAgICAgIH0KICAgIH0sCiAgICBbcm91dGVyLCBvdGhlck1lbWJlcnNFcnJvciwgb3RoZXJUZWFtRXJyb3JdCiAgKTsKCiAgdXNlRWZmZWN0KCgpID0+IHsKICAgIG1lbWJlckludml0YXRpb25Nb2RhbFJlZi5jdXJyZW50ID0gc2V0U2hvd01lbWJlckludml0YXRpb25Nb2RhbDsKICAgIHJldHVybiAoKSA9PiB7CiAgICAgIG1lbWJlckludml0YXRpb25Nb2RhbFJlZi5jdXJyZW50ID0gbnVsbDsKICAgIH07CiAgfSwgW10pOwoKICBjb25zdCBpc1BlbmRpbmcgPSBpc1RlYW1Mb2FkaW5nIHx8IGlzT3JnTGlzdExvYWRpbmc7CiAgY29uc3QgaW52aXRlTWVtYmVyTXV0YXRpb24gPSB0cnBjLnZpZXdlci50ZWFtcy5pbnZpdGVNZW1iZXIudXNlTXV0YXRpb24oewogICAgb25TdWNjZXNzOiAoKSA9PiB7CiAgICAgIHV0aWxzLnZpZXdlci5vcmdhbml6YXRpb25zLmdldE1lbWJlcnMuaW52YWxpZGF0ZSgpOwogICAgICB1dGlscy52aWV3ZXIub3JnYW5pemF0aW9ucy5saXN0T3RoZXJUZWFtcy5pbnZhbGlkYXRlKCk7CiAgICAgIHV0aWxzLnZpZXdlci50ZWFtcy5saXN0LmludmFsaWRhdGUoKTsKICAgICAgcmV2YWxpZGF0ZVRlYW1zTGlzdCgpOwogICAgICB1dGlscy52aWV3ZXIub3JnYW5pemF0aW9ucy5saXN0T3RoZXJUZWFtTWVtYmVycy5pbnZhbGlkYXRlKCk7CiAgICB9LAogIH0pOwoKICByZXR1cm4gKAogICAgPD4KICAgICAgeyFpc1BlbmRpbmcgJiYgKAogICAgICAgIDw+CiAgICAgICAgICA8ZGl2PgogICAgICAgICAgICA8PgogICAgICAgICAgICAgIHsvKiBDdXJyZW50bHkgZmFpbGluZyBkdWUgdG8gcmUgcmVuZGVyIGFuZCBsb29zZSBmb2N1cyAqL30KICAgICAgICAgICAgICB7LyogPFRleHRGaWVsZAogICAgICAgICAgICAgICAgdHlwZT0ic2VhcmNoIgogICAgICAgICAgICAgICAgYXV0b0NvbXBsZXRlPSJmYWxzZSIKICAgICAgICAgICAgICAgIG9uQ2hhbmdlPXsoZSkgPT4gewogICAgICAgICAgICAgICAgICBzZXRRdWVyeShlLnRhcmdldC52YWx1ZSk7CiAgICAgICAgICAgICAgICAgIGRlYm91bmNlZEZ1bmN0aW9uKGUudGFyZ2V0LnZhbHVlKTsKICAgICAgICAgICAgICAgIH19CiAgICAgICAgICAgICAgICB2YWx1ZT17cXVlcnl9CiAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj17YCR7dCgic2VhcmNoIil9Li4uYH0KICAgICAgICAgICAgICAvPiAqL30KICAgICAgICAgICAgICA8TWVtYmVyc0xpc3QKICAgICAgICAgICAgICAgIG1lbWJlcnM9e2RhdGE/LnBhZ2VzPy5mbGF0TWFwKChwYWdlKSA9PiBwYWdlLnJvd3MpID8/IFtdfQogICAgICAgICAgICAgICAgdGVhbT17dGVhbX0KICAgICAgICAgICAgICAgIGZldGNoTmV4dFBhZ2U9e2ZldGNoTmV4dFBhZ2V9CiAgICAgICAgICAgICAgICBoYXNOZXh0UGFnZT17aGFzTmV4dFBhZ2V9CiAgICAgICAgICAgICAgICBpc0ZldGNoaW5nTmV4dFBhZ2U9e2lzRmV0Y2hpbmdOZXh0UGFnZX0KICAgICAgICAgICAgICAvPgogICAgICAgICAgICA8Lz4KCiAgICAgICAgICAgIHt0ZWFtICYmICgKICAgICAgICAgICAgICA8PgogICAgICAgICAgICAgICAgPGhyIGNsYXNzTmFtZT0iYm9yZGVyLXN1YnRsZSBteS04IG10LTYiIC8+CiAgICAgICAgICAgICAgICA8TWFrZVRlYW1Qcml2YXRlU3dpdHMvZWUvbWFuYWdlZC1ldmVudC10eXBlcy9ob29rcy91c2VMb2NrZWRGaWVsZHNNYW5hZ2VyIjsKaW1wb3J0IHR5cGUgeyBFdmVudFR5cGVTZXR1cCwgRm9ybVZhbHVlcyB9IGZyb20gIkBjYWxjb20vZmVhdHVyZXMvZXZlbnR0eXBlcy9saWIvdHlwZXMiOwppbXBvcnQgeyB1c2VMb2NhbGUgfSBmcm9tICJAY2FsY29tL2xpYi9ob29rcy91c2VMb2NhbGUiOwppbXBvcnQgdHlwZSB7IFJvdXRlck91dHB1dHMgfSBmcm9tICJAY2FsY29tL3RycGMvcmVhY3QiOwppbXBvcnQgeyB0cnBjIH0gZnJvbSAiQGNhbGNvbS90cnBjL3JlYWN0IjsKCmltcG9ydCB0eXBlIHsgVGVhbU1lbWJlcnMgfSBmcm9tICIuLi8uLi9FdmVudFR5cGUiOwppbXBvcnQgeyBFdmVudEF2YWlsYWJpbGl0eVRhYiB9IGZyb20gIi4vRXZlbnRBdmFpbGFiaWxpdHlUYWIiOwoKZXhwb3J0IHR5cGUgRXZlbnRBdmFpbGFiaWxpdHlUYWJXZWJXcmFwcGVyUHJvcHMgPSB7CiAgZXZlbnRUeXBlOiBFdmVudFR5cGVTZXR1cDsKICBpc1RlYW1FdmVudDogYm9vbGVhbjsKICB1c2VyPzogUm91dGVyT3V0cHV0c1sidmlld2VyIl1bIm1lIl1bImdldCJdOwogIHRlYW1NZW1iZXJzOiBUZWFtTWVtYmVyczsKfTsKCmV4cG9ydCB0eXBlIEdldEFsbFNjaGVkdWxlc0J5VXNlcklkUXVlcnlUeXBlID0KICB0eXBlb2YgdHJwYy52aWV3ZXIuYXZhaWxhYmlsaXR5LnNjaGVkdWxlLmdldEFsbFNjaGVkdWxlc0J5VXNlcklkLnVzZVF1ZXJ5OwoKY29uc3QgRXZlbnRBdmFpbGFiaWxpdHlUYWJXZWJXcmFwcGVyID0gKHByb3BzOiBFdmVudEF2YWlsYWJpbGl0eVRhYldlYldyYXBwZXJQcm9wcykgPT4gewogIGNvbnN0IHsgdCB9ID0gdXNlTG9jYWxlKCk7CiAgY29uc3QgZm9ybU1ldGhvZHMgPSB1c2VGb3JtQ29udGV4dDxGb3JtVmFsdWVzPigpOwogIGNvbnN0IHNjaGVkdWxlSWQgPSBmb3JtTWV0aG9kcy53YXRjaCgic2NoZWR1bGUiKTsKICBjb25zdCByZXN0cmljdGlvblNjaGVkdWxlSWQgPSBmb3JtTWV0aG9kcy53YXRjaCgicmVzdHJpY3Rpb25TY2hlZHVsZUlkIik7CgogIGNvbnN0IHsgaXNNYW5hZ2VkRXZlbnRUeXBlLCBpc0NoaWxkcmVuTWFuYWdlZEV2ZW50VHlwZSB9ID0gdXNlTG9ja2VkRmllbGRzTWFuYWdlcih7CiAgICBldmVudFR5cGU6IHByb3BzLmV2ZW50VHlwZSwKICAgIHRyYW5zbGF0ZTogdCwKICAgIGZvcm1NZXRob2RzLAogIH0pOwoKICAvLyBDaGVjayBpZiB0ZWFtIGhhcyByZXN0cmljdGlvbiBzY2hlZHVsZSBmZWF0dXJlIGVuYWJsZWQKICBjb25zdCB7IGRhdGE6IGlzUmVzdHJpY3Rpb25TY2hlZHVsZUVuYWJsZWQgPSBmYWxzZSB9ID0gdHJwYy52aWV3ZXIuZmVhdHVyZXMuY2hlY2tUZWFtRmVhdHVyZS51c2VRdWVyeSgKICAgIHsKICAgICAgdGVhbUlkOiBwcm9wcy5ldmVudFR5cGUudGVhbT8uaWQgfHwgMCwKICAgICAgZmVhdHVyZTogInJlc3RyaWN0aW9uLXNjaGVkdWxlIiwKICAgIH0sCiAgICB7CiAgICAgIGVuYWJsZWQ6ICEhcHJvcHMuZXZlbnRUeXBlLnRlYW0/LmlkLAogICAgICBzdGFsZVRpbWU6IDUgKiA2MCAqIDEwMDAsIC8vIENhY2hlIGZvciA1IG1pbnV0ZXMKICAgIH0KICApOwoKICBjb25zdCB7IGlzUGVuZGluZzogaXNTY2hlZHVsZVBlbmRpbmcsIGRhdGE6IHNjaGVkdWxlUXVlcnlEYXRhIH0gPQogICAgdHJwYy52aWV3ZXIuYXZhaWxhYmlsaXR5LnNjaGVkdWxlLmdldC51c2VRdWVyeSgKICAgICAgewogICAgICAgIHNjaGVkdWxlSWQ6CiAgICAgICAgICBzY2hlZHVsZUlkIHx8ICghcHJvcHMuaXNUZWFtRXZlbnQgPyBwcm9wcy51c2VyPy5kZWZhdWx0U2NoZWR1bGVJZCA6IHVuZGVmaW5lZCkgfHwgdW5kZWZpbmVkLAogICAgICAgIGlzTWFuYWdlZEV2ZW50VHlwZTogaXNNYW5hZ2VkRXZlbnRUeXBlIHx8IGlzQ2hpbGRyZW5NYW5hZ2VkRXZlbnRUeXBlLAogICAgICB9LAogICAgICB7IGVuYWJsZWQ6ICEhc2NoZWR1bGVJZCB8fCAoIXByb3BzLmlzVGVhbUV2ZW50ICYmICEhcHJ1bHQgZmxleCBmbGV4LWNvbCB0ZXh0LXNtIGxpbmUtdGhyb3VnaCBvcGFjaXR5LTYwIj4KICAgICAgICAgIDxEaXNwbGF5VGltZXN0YW1wCiAgICAgICAgICAgIHN0YXJ0VGltZT17cHJldmlvdXNCb29raW5nLnN0YXJ0VGltZX0KICAgICAgICAgICAgZW5kVGltZT17cHJldmlvdXNCb29raW5nLmVuZFRpbWV9CiAgICAgICAgICAgIHRpbWVab25lPXt0aW1lWm9uZX0KICAgICAgICAgIC8+CiAgICAgICAgPC9kaXY+CiAgICAgICl9CiAgICAgIDxkaXYKICAgICAgICBjbGFzc05hbWU9e2NsYXNzTmFtZXMoCiAgICAgICAgICAidGV4dC1lbXBoYXNpcyBmbGV4IGZsZXgtY29sIHRleHQtc20gZm9udC1tZWRpdW0iLAogICAgICAgICAgcmVzY2hlZHVsZWQgJiYgImxpbmUtdGhyb3VnaCIKICAgICAgICApfT4KICAgICAgICA8RGlzcGxheVRpbWVzdGFtcCBzdGFydFRpbWU9e3N0YXJ0VGltZX0gZW5kVGltZT17ZW5kVGltZX0gdGltZVpvbmU9e3RpbWVab25lfSAvPgogICAgICA8L2Rpdj4KICAgIDwvU2VjdGlvbj4KICApOwp9CgpmdW5jdGlvbiBEaXNwbGF5VGltZXN0YW1wKHsKICBzdGFydFRpbWUsCiAgZW5kVGltZSwKICB0aW1lWm9uZSwKfTogewogIHN0YXJ0VGltZTogRGF0ZSB8IGRheWpzLkRheWpzOwogIGVuZFRpbWU6IERhdGUgfCBkYXlqcy5EYXlqczsKICB0aW1lWm9uZT86IHN0cmluZzsKfSkgewogIGNvbnN0IHN0YXJ0ID0gc3RhcnRUaW1lIGluc3RhbmNlb2YgRGF0ZSA/IGRheWpzKHN0YXJ0VGltZSkudHoodGltZVpvbmUpIDogc3RhcnRUaW1lOwogIGNvbnN0IGVuZCA9IGVuZFRpbWUgaW5zdGFuY2VvZiBEYXRlID8gZGF5anMoZW5kVGltZSkudHoodGltZVpvbmUpIDogZW5kVGltZTsKCiAgcmV0dXJuICgKICAgIDw+CiAgICAgIDxzcGFuPntzdGFydC5mb3JtYXQoImRkZGQsIE1NTU0gRCwgWVlZWSIpfTwvc3Bhbj4KICAgICAgPHNwYW4+CiAgICAgICAge3N0YXJ0LmZvcm1hdCgiaDptbWEiKX0gLSB7ZW5kLmZvcm1hdCgiaDptbWEiKX0gKHt0aW1lWm9uZSB8fCBzdGFydC5mb3JtYXQoIloiKX0pCiAgICAgIDwvc3Bhbj4KICAgIDwvPgogICk7Cn0KCmZ1bmN0aW9uIFdob1NlY3Rpb24oeyBib29raW5nIH06IHsgYm9va2luZzogQm9va2luZ091dHB1dCB9KSB7CiAgY29uc3QgeyB0IH0gPSB1c2VMb2NhbGUoKTsKICByZXR1cm4gKAogICAgPFNlY3Rpb24gdGl0bGU9e3QoIndobyIpfT4KICAgICAgPGRpdiBjbGFzc05hbWU9Im10LTIgZmxleCBmbGV4LWNvbCBnYXAtMyI+CiAgICAgICAge2Jvb2tpbmcudXNlciAmJiAoCiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTQiPgogICAgICAgICAgICA8QXZhdGFyCiAgICAgICAgICAgICAgc2l6ZT0ibWQiCiAgICAgICAgICAgICAgaW1hZ2VTcmM9ewogICAgICAgICAgICAgICAgYm9va2luZy51c2VyLmF2YXRhclVybAogICAgICAgICAgICAgICAgICA/IGdldFVzZXJBdmF0YXJVcmwoYm9va2luZy51c2VyKQogICAgICAgICAgICAgICAgICA6IGdldFBsYWNlaG9sZGVyQXZhdGFyKG51bGwsIGJvb2tpbmcudXNlci5uYW1lIHx8IGJvb2tpbmcudXNlci5lbWFpbCkKICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgYWx0PXtib29raW5nLnVzZXIubmFtZSB8fCBib29raW5nLnVzZXIuZW1haWwgfHwgIiJ9CiAgICAgICAgICAgIC8+CiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJtaW4tdy0wIGZsZXgtMSI+CiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIj4KICAgICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT0idGV4dC1lbXBoYXNpcyB0cnVuY2F0ZSB0ZXh0LXNtIGxlYWRpbmctWzEuMl0iPgogICAgICAgICAgICAgICAgICB7Ym9va2luZy5ldmVudFR5cGU/LmhpZGVPcmdhbml6ZXJFbWFpbAogICAgICAgICAgICAgICAgICAgID8gYm9va2luZy51c2VyLm5hbWUgfHwgdCgib3JnYW5pemVyIikKICByb25nPkRldmVsb3BtZW50PC9zdHJvbmc+LiBUaGVuIGNsaWNrIDxzdHJvbmc+U2F2ZTwvc3Ryb25nPi4KICAgICAgICAgICAgICAgIChBdCB0aGlzIHN0YWdlLCB5b3UgY2FuIHRoZW9yZXRpY2FsbHkgY29ubmVjdCBkaWZmZXJlbnQgZGF0YWJhc2UKICAgICAgICAgICAgICAgIGluc3RhbmNlcyB0byB0aGUgZGlmZmVyZW50IGVudmlyb25tZW50cyBpbiBOZXRsaWZ5LiBGb3IgdGhlCiAgICAgICAgICAgICAgICBwdXJwb3NlIG9mIHRoaXMgZGVtbywgd2UgYXJlIGp1c3QgY29ubmVjdGluZyBib3RoIGVudmlyb25tZW50cwogICAgICAgICAgICAgICAgdG8gdGhlIDxzdHJvbmc+RGV2ZWxvcG1lbnQ8L3N0cm9uZz4gZGF0YWJhc2UgaW4gUHJpc21hIENvbnNvbGUpLgogICAgICAgICAgICAgIDwvbGk+CiAgICAgICAgICAgIDwvb2w+CiAgICAgICAgICA8L2Rpdj4KCiAgICAgICAgICB7LyogU3RlcCA0ICovfQogICAgICAgICAgPGRpdiBjbGFzc05hbWU9Im10LTYiPgogICAgICAgICAgICA8aDIgY2xhc3NOYW1lPSJ0ZXh0LTJ4bCBmb250LXNlbWlib2xkIHRleHQtZ3JheS05MDAiPgogICAgICAgICAgICAgIDQuIFJlLWRlcGxveSB0aGUgc2l0ZSBpbiBOZXRsaWZ5CiAgICAgICAgICAgIDwvaDI+CiAgICAgICAgICAgIDxwIGNsYXNzTmFtZT0idGV4dC1ncmF5LTcwMCBtdC0yIj4KICAgICAgICAgICAgICBZb3VyIHNpdGUgaXMgbm93IGZ1bGx5IGNvbmZpZ3VyZWQgdG8gbG9hZCBkYXRhIGZyb20gdGhlIFByaXNtYQogICAgICAgICAgICAgIFBvc3RncmVzIGRhdGFiYXNlIHlvdSBqdXN0IGNyZWF0ZWQsIHRoZSBsYXN0IHRoaW5nIHlvdSBuZWVkIHRvIGRvCiAgICAgICAgICAgICAgaXMgcmUtZGVwbG95IHRoZSBzaXRlIHZpYSB0aGUgTmV0bGlmeSBEYXNoYm9hcmQuCiAgICAgICAgICAgIDwvcD4KICAgICAgICAgICAgPG9sIGNsYXNzTmFtZT0ibGlzdC1kZWNpbWFsIHBsLTYgbXQtMiBzcGFjZS15LTEgdGV4dC1ncmF5LTcwMCI+CiAgICAgICAgICAgICAgPGxpPgogICAgICAgICAgICAgICAgSW4geW91ciBOZXRsaWZ5IERhc2hib2FyZCwgY2xpY2sgb24gdGhlIDxzdHJvbmc+U2l0ZXM8L3N0cm9uZz57IiAifQogICAgICAgICAgICAgICAgaXRlbSBpbiB0aGUgbGVmdC1oYW5kIHNpZGVuYXYgYW5kIGNsaWNrIG9uIHRoZSBzaXRlIHRoYXQgd2FzCiAgICAgICAgICAgICAgICBkZXBsb3llZCB3aXRoIHRoaXMgdGVtcGxhdGUuCiAgICAgICAgICAgICAgPC9saT4KICAgICAgICAgICAgICA8bGk+CiAgICAgICAgICAgICAgICBGaW5kIHRoZSA8c3Ryb25nPlByb2plY3Q8L3N0cm9uZz4gZHJvcGRvd24gYW5kIHNlbGVjdCB0aGUgb25lCiAgICAgICAgICAgICAgICBwcm9qZWN0IGNyZWF0ZWQgaW4gPHN0cm9uZz5TdGVwIDE8L3N0cm9uZz4gYmVmb3JlLgogICAgICAgICAgICAgIDwvbGk+CiAgICAgICAgICAgICAgPGxpPgogICAgICAgICAgICAgICAgQ2xpY2sgb24gdGhlIDxzdHJvbmc+RGVwbG95czwvc3Ryb25nPiB0YWIgb24gdGhlIGxlZnQsIGNsaWNrIHRoZXsiICJ9CiAgICAgICAgICAgICAgICA8c3Ryb25nPlRyaWdnZXIgZGVwbG95PC9zdHJvbmc+IGJ1dHRvbiwgYW5kIGZpbmFsbHkgY2xpY2t7IiAifQogICAgICAgICAgICAgICAgPHN0cm9uZz5DbGVhciBjYWNoZSBhbmQgZGVwbG95IHNpdGU8L3N0cm9uZz4uCiAgICAgICAgICAgICAgPC9saT4KICAgICAgICAgICAgPC9vbD4KICAgICAgICAgICAgPHAgY2xhc3NOYW1lPSJ0ZXh0LWdyYXktNzAwIG10LTIiPgogICAgICAgICAgICAgIHsiICJ9CiAgICAgICAgICAgICAgT25jZSB0aGUgZGVwbG95bWVudCBpcyByZWFkeSwgeW91IGNhbiBjbGljayBvbnsiICJ9CiAgICAgICAgICAgICAgPHN0cm9uZz5PcGVuIHByb2R1Y3Rpb24gZGVwbG95PC9zdHJvbmc+IGFuZCB1c2UgdGhlIGFwcCBieQogICAgICAgICAgICAgIGNyZWF0aW5nIHVzZXJzIGFuZCBwb3N0cyB2aWEgdGhlIFVJIPCfjol5b3V0L1NjcmVlbicKaW1wb3J0IHsgSG9yaXpvbnRhbEVkZ2VHZXN0dXJlVGFyZ2V0IH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvbGF5b3V0L3NjcmVlbnMvRWRnZUdlc3R1cmVUYXJnZXQnCmltcG9ydCB7IFNjcm9sbEhlYWRlciB9IGZyb20gJ3NyYy9jb21wb25lbnRzL2xheW91dC9zY3JlZW5zL1Njcm9sbEhlYWRlcicKaW1wb3J0IHsgVmlydHVhbGl6ZWRMaXN0IH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvbGF5b3V0L1ZpcnR1YWxpemVkTGlzdCcKaW1wb3J0IHsgQ29sb3JUb2tlbnMsIEZsZXgsIGZsZXhTdHlsZXMsIHVzZVNwb3JlQ29sb3JzIH0gZnJvbSAndWkvc3JjJwppbXBvcnQgeyBpY29uU2l6ZXMgfSBmcm9tICd1aS9zcmMvdGhlbWUnCmltcG9ydCB7IEhhbmRsZUJhciB9IGZyb20gJ3VuaXN3YXAvc3JjL2NvbXBvbmVudHMvbW9kYWxzL0hhbmRsZUJhcicKCi8vIERpc3RhbmNlIHRvIHNjcm9sbCB0byBzaG93IHNjcm9sbGVkIHN0YXRlIGhlYWRlciBlbGVtZW50cwpjb25zdCBTSE9XX0hFQURFUl9TQ1JPTExfWV9ESVNUQU5DRSA9IDUwCgpjb25zdCBFREdFUzogRWRnZVtdID0gWyd0b3AnLCAnbGVmdCcsICdyaWdodCddCgp0eXBlIEhlYWRlclNjcm9sbFNjcmVlblByb3BzID0gewogIGNlbnRlckVsZW1lbnQ/OiBKU1guRWxlbWVudAogIHJpZ2h0RWxlbWVudD86IEpTWC5FbGVtZW50CiAgcmVuZGVyZWRJbk1vZGFsPzogYm9vbGVhbiAvLyBBcHBseSBzdHlsaW5nIHRvIGRpc3BsYXkgd2l0aGluIGJvdHRvbSBzaGVldCBtb2RhbAogIHNob3dIYW5kbGVCYXI/OiBib29sZWFuIC8vIGFkZCBoYW5kbGViYXIgZWxlbWVudCB0byB0b3Agb2YgdmlldwogIGJhY2tncm91bmRDb2xvcj86IENvbG9yVG9rZW5zCiAgYmFja0J1dHRvbkNvbG9yPzogQ29sb3JUb2tlbnMKfQoKZXhwb3J0IGZ1bmN0aW9uIEhlYWRlclNjcm9sbFNjcmVlbih7CiAgY2VudGVyRWxlbWVudCwKICByaWdodEVsZW1lbnQgPSA8RmxleCB3aWR0aD17aWNvblNpemVzLmljb24yNH0gLz4sCiAgcmVuZGVyZWRJbk1vZGFsID0gZmFsc2UsCiAgc2hvd0hhbmRsZUJhciA9IGZhbHNlLAogIGJhY2tncm91bmRDb2xvciA9ICckc3VyZmFjZTEnLAogIGJhY2tCdXR0b25Db2xvciwKICBjaGlsZHJlbiwKfTogUHJvcHNXaXRoQ2hpbGRyZW48SGVhZGVyU2Nyb2xsU2NyZWVuUHJvcHM+KTogSlNYLkVsZW1lbnQgewogIGNvbnN0IGNvbG9ycyA9IHVzZVNwb3JlQ29sb3JzKCkKCiAgLy8gZGlmZmljdWx0IHRvIHByb3Blcmx5IHR5cGUKICAvLyBiaW9tZS1pZ25vcmUgbGludC9zdXNwaWNpb3VzL25vRXhwbGljaXRBbnk6IEZsYXRMaXN0IGdlbmVyaWMgdHlwZSBpcyBjb21wbGV4IGFuZCB2YXJpZXMgYnkgZGF0YQogIGNvbnN0IGxpc3RSZWYgPSB1c2VSZWY8RmxhdExpc3Q8YW55Pj4obnVsbCkKCiAgLy8gc2Nyb2xscyB0byB0b3Agd2hlbiB0YXBwaW5nIG9uIHRoZSBhY3RpdmUgdGFiCiAgdXNlU2Nyb2xsVG9Ub3AobGlzdFJlZikKCiAgY29uc3Qgc2Nyb2xsWSA9IHVzZVNoYXJlZFZhbHVlKDApCgogIC8vIE9uIHNjcm9sbCwgY2VudGVyRWxlbWVudCBhbmQgdGhlIGJvdHRvbSBib3JkZXIgZmFkZSBpbgogIGNvbnN0IHNjcm9sbEhhbmRsZXIgPSB1c2VBbmltYXRlZFNjcm9sbEhhbmRsZXIoCiAgICB7CiAgICAgIG9uU2Nyb2xsOiAoZXZlbnQpID0+IHsKICAgICAgICBzY3JvbGxZLnZhbHVlID0gZXZlbnQuY29udGVudE9mZnNldC55CiAgICAgIH0sCiAgICAgIG9uRW5kRHJhZzogKGV2ZW50KSA9PiB7CiAgICAgICAgc2Nyb2xsWS52YWx1ZSA9IHdpdGhUaW1pbmcoZXZlbnQuY29udGVudE9mZnNldC55ID4gMCA/IFNIT1dfSEVBREVSX1NDUk9MTF9ZX0RJU1RBTkNFIDogMCkKICAgICAgfSwKICAgIH0sCiAgICBbc2Nyb2xsWV0sCiAgKQoKICByZXR1cm4gKAogICAgPFNjcmVlbiBiYWNrZ3JvdW5kQ29sb3I9e2JhY2tncm91bmRDb2xvcn0gZWRnZXM9e0VER0VTfT4KICAgICAge3Nob3dIYW5kbGVCYXIgPyA8SGFub3V0ZXI6IHZpLmZuKCkubW9ja1JldHVyblZhbHVlKHsKICAgIHB1c2g6IHZpLmZuKCksCiAgfSksCiAgdXNlUGF0aG5hbWU6IHZpLmZuKCksCn0pKTsKCmRlc2NyaWJlKCJUZXN0cyBmb3IgQXBwQ2FyZCBjb21wb25lbnQiLCAoKSA9PiB7CiAgY29uc3QgbW9ja0FwcDogQXBwRnJvbnRlbmRQYXlsb2FkID0gewogICAgbG9nbzogIi9wYXRoL3RvL2xvZ28ucG5nIiwKICAgIG5hbWU6ICJUZXN0IEFwcCIsCiAgICBzbHVnOiAidGVzdC1hcHAiLAogICAgZGVzY3JpcHRpb246ICJUZXN0IGRlc2NyaXB0aW9uIGZvciB0aGUgYXBwLiIsCiAgICBjYXRlZ29yaWVzOiBbImNhbGVuZGFyIl0sCiAgICBjb25jdXJyZW50TWVldGluZ3M6IHRydWUsCiAgICB0ZWFtc1BsYW5SZXF1aXJlZDogeyB1cGdyYWRlVXJsOiAidGVzdCIgfSwKICAgIHR5cGU6ICJ0ZXN0X2NhbGVuZGFyIiwKICAgIHZhcmlhbnQ6ICJjYWxlbmRhciIsCiAgICBwdWJsaXNoZXI6ICJ0ZXN0IiwKICAgIHVybDogInRlc3QiLAogICAgZW1haWw6ICJ0ZXN0IiwKICB9OwoKICAvLyBBYnN0cmFjdGVkIHJlbmRlciBmdW5jdGlvbgogIGNvbnN0IHJlbmRlckFwcENhcmQgPSAoYXBwUHJvcHMgPSB7fSwgYXBwQ2FyZFByb3BzID0ge30pID0+IHsKICAgIGNvbnN0IGFwcERhdGEgPSB7IC4uLm1vY2tBcHAsIC4uLmFwcFByb3BzIH07CiAgICBjb25zdCBxdWVyeUNsaWVudCA9IG5ldyBRdWVyeUNsaWVudCgpOwogICAgcmVuZGVyKAogICAgICA8UXVlcnlDbGllbnRQcm92aWRlciBjbGllbnQ9e3F1ZXJ5Q2xpZW50fT4KICAgICAgICA8QXBwQ2FyZCBhcHA9e2FwcERhdGF9IHsuLi5hcHBDYXJkUHJvcHN9IC8+OwogICAgICA8L1F1ZXJ5Q2xpZW50UHJvdmlkZXI+CiAgICApOwogIH07CgogIGRlc2NyaWJlKCJUZXN0cyBmb3IgYXBwIGRlc2NyaXB0aW9uIiwgKCkgPT4gewogICAgaXQoIlNob3VsZCByZW5kZXIgdGhlIGFwcCBuYW1lIGNvcnJlY3RseSBhbmQgZGlzcGxheSBhcHAgbG9nbyB3aXRoIGNvcnJlY3QgYWx0IHRleHQiLCAoKSA9PiB7CiAgICAgIHJlbmRlckFwcENhcmQoKTsKICAgICAgY29uc3QgYXBwTG9nbyA9IHNjcmVlbi5nZXRCeUFsdFRleHQoIlRlc3QgQXBwIExvZ28iKTsKICAgICAgY29uc3QgYXBwTmFtZSA9IHNjcmVlbi5nZXRCeVRleHQoIlRlc3QgQXBwIik7CiAgICAgIGV4cGVjdChhcHBMb2dvKS50b0JlSW5UaGVEb2N1bWVudCgpOwogICAgICBleHBlY3QoYXBwTG9nby5nZXRBdHRyaWJ1dGUoInNyYyIpKS50b0JlKCIvcGF0aC90by9sb2dvLnBuZyIpOwogICAgICBleHBlY3QoYXBwTmFtZSkudG9CZUluVGhlRG9jdW1lbnQoKTsKICAgIH0pOwoKICAgIGl0KCJTaG91bGQgcmVuZGVyIGRldGFpbHMgYnV0dG9uIHdpdGggY29ycmVjdCBocmVmIiwgKCkgPT4gewogICAgICByZW5kZXJBcHBDYXJkKCk7CiAgICAgIGNvbnN0IGRldGFpbHNCdXR0b24gPSBzY3JlZW4uZ2V0QnlUZXh0KCJkZXRhaWxzIik7CiAgICAgIGV4cGVjdChkZXRhaWxzQnV0dG9uKS50b0JlSW5UaGVEb2N1bWVudCgpOwogICAgICBleHBlY3QoZGV0YWlsc0J1dHRvbi5jbG9zZXN0KCJhIikpLnRvSGF2ZUF0dHJpYnV0ZSgiaHJlZiIsICIvYXBwcy90ZXN0LWFwcCIpOwogICAgfSk7CgogICAgaXQoIlNob3VsZCBoaWdobGlnaHQgdGhlIGFwcCBuYW1lIGJhc2VkIG9uIHNlYXJjaFRleHQiLCAoKSA9PiB7CiAgICAgIHJlbmRlckFwcENhcmQoe30sIHsgc2VhcmNoVGV4dDogInRlc3QiIH0pOwogICAgICBjb25zdCBoaWdobGlnaHRlZFRleHQgPSBzY3JlZW4uZ2V0QnlUZXN0SWQoImhpZ2hsaWdodGVkLXRleHQiKTsKICAgICAgZXhwZWN0KGhpZ2hsaWdodGVkVGV4dCkudG9CZUluVGhlRG9jdW1lbnQoKTsKICAgIH0pOwogIH0pOwoKICBkZXNjcmliZSgiVGVzdHMgZm9yIGFwcCBjYXRlZ29yaWVzIiwgKCkgPT4gewogICAgaXQoIlNob3VsZCBzaG93ICdUZW1wbGF0ZScgYmFkZ2UgaWYgYXBwIGlzIGEgdGVtcGxhdGUiLCAoKWluSWQgfCBudWxsCiAgYWN0aXZlVGFiOiBTZWFyY2hUYWIKfSk6IEdxbFJlc3VsdDxPbmNoYWluSXRlbVNlY3Rpb248U2VhcmNoTW9kYWxPcHRpb24+W10+IHsKICBjb25zdCB2aWV3RXh0ZXJuYWxXYWxsZXRzRmVhdHVyZUVuYWJsZWQgPSB1c2VGZWF0dXJlRmxhZyhGZWF0dXJlRmxhZ3MuVmlld0V4dGVybmFsV2FsbGV0c09uV2ViKQogIGNvbnN0IHdhbGxldFNlYXJjaEVuYWJsZWRPbldlYiA9IGlzV2ViQXBwICYmIHZpZXdFeHRlcm5hbFdhbGxldHNGZWF0dXJlRW5hYmxlZAoKICBjb25zdCByZWNlbnRseVNlYXJjaGVkT3B0aW9uczogU2VhcmNoTW9kYWxPcHRpb25bXSA9IHVzZVJlY2VudGx5U2VhcmNoZWRPcHRpb25zKHsKICAgIGNoYWluRmlsdGVyLAogICAgYWN0aXZlVGFiLAogICAgbnVtYmVyT2ZSZWNlbnRTZWFyY2hSZXN1bHRzOiBOVU1CRVJfT0ZfUkVTVUxUU19TSE9SVCwKICB9KQoKICBjb25zdCByZWNlbnRTZWFyY2hTZWN0aW9uID0gdXNlT25jaGFpbkl0ZW1MaXN0U2VjdGlvbih7CiAgICBzZWN0aW9uS2V5OiBPbmNoYWluSXRlbVNlY3Rpb25OYW1lLlJlY2VudFNlYXJjaGVzLAogICAgb3B0aW9uczogcmVjZW50bHlTZWFyY2hlZE9wdGlvbnMsCiAgICBlbmRFbGVtZW50OiA8Q2xlYXJSZWNlbnRTZWFyY2hlc0J1dHRvbiAvPiwKICB9KQoKICBjb25zdCBudW1iZXJPZlRyZW5kaW5nVG9rZW5zID0KICAgIGFjdGl2ZVRhYiA9PT0gU2VhcmNoVGFiLkFsbAogICAgICA/IGlzTW9iaWxlQXBwCiAgICAgICAgPyBOVU1CRVJfT0ZfUkVTVUxUU19NRURJVU0KICAgICAgICA6IE5VTUJFUl9PRl9SRVNVTFRTX1NIT1JUCiAgICAgIDogTlVNQkVSX09GX1JFU1VMVFNfTE9ORwogIGNvbnN0IHNraXBUcmVuZGluZ1Rva2Vuc1F1ZXJ5ID0gYWN0aXZlVGFiICE9PSBTZWFyY2hUYWIuVG9rZW5zICYmIGFjdGl2ZVRhYiAhPT0gU2VhcmNoVGFiLkFsbAogIGNvbnN0IHsKICAgIGRhdGE6IHRva2VucywKICAgIGVycm9yOiB0b2tlbnNFcnJvciwKICAgIHJlZmV0Y2g6IHJlZmV0Y2hUb2tlbnMsCiAgICBsb2FkaW5nOiBsb2FkaW5nVG9rZW5zLAogIH0gPSB1c2VUcmVuZGluZ1Rva2Vuc0N1cnJlbmN5SW5mb3MoY2hhaW5GaWx0ZXIsIHNraXBUcmVuZGluZ1Rva2Vuc1F1ZXJ5KQogIGNvbnN0IHRyZW5kaW5nVG9rZW5PcHRpb25zID0gdXNlQ3VycmVuY3lJbmZvc1RvVG9rZW5PcHRpb25zKHsgY3VycmVuY3lJbmZvczogdG9rZW5zIH0pCiAgY29uc3QgdHJlbmRpbmdUb2tlblNlY3Rpb24gPSB1c2VPbmNoYWluSXRlbUxpc3RTZWN0aW9uKHsKICAgIHNlY3Rpb25LZXk6IE9uY2hhaW5JdGVtU2VjdGlvbk5hbWUuVHJlbmRpbmdUb2tlbnMsCiAgICBvcHRpb25zOiB0cmVuZGluZ1Rva2VuT3B0aW9ucz8uc2xpY2UoMCwgbnVtYmVyT2ZUcmVuZGluZ1Rva2VucyksCiAgfSkKCiAgLy8gTG9hZCB0cmVuZGluZyBwb29scyBieSAyNEggdm9sdW1lCiAgY29uc3QgbnVtYmVyT2ZUcmVuZGluZ1Bvb2xzID0gYWN0aXZlVGFiID09PSBTZWFyY2hUYWIuQWxsID8gTlVNQkVSX09GX1JFU1VMVFNfU0hPUlQgOiBOVU1CRVJfT0ZfUkVTVUxUU19MT05HCiAgY29uc3QgcG9vbFF1ZXJ5VmFyaWFibGVzID0gdXNlTWVtbygKICAgICgpID0+ICh7CiAgICAgIGlucHV0OiB7IGNoYWluSWQ6IGNoYWluRmlsdGVyID8gY2hhaW5GaWx0ZXIudG9TdHJpbmcoKSA6IEFMTF9ORVRXT1JLU19BUkcgfSwKICAgICAgZW5hYmxlZDogaXNXZWJQbGF0Zm9ybSAmJiAoYWN0aXZlVGFiID09PSBTZWFyY2hUYWIuQWxsIHx8IGFjdGl2ZVRhYiA9PT0gU2VhcmNoVGFiLlBvb2xzKSwKICAgICAgc2VsZWN0OiAoZGF0YTogRXhwbG9yZVN0YXRzUmVzcG9uc2UpOiBQb29sU3RhdHNbXSB8IHVuZGVmaW5lZCA9PgogICAgICAgIGRhdGEuc3RhdHM/LnBvb2xTdGF0cwogICAgICAgICAgLnNvcnQoKGEsIGIpID0+IChiLnZvbHVtZTFEYXk/LnZhbHVlID8/IDApIC0gKGEudm9sdW1lMURheT8udmFsdWUgPz8gMCkpIC8vIFNvcnRjYXRvci1saW5lIiwKICAgICAgY29tcG9uZW50OiBDaGFydFRvb2x0aXBJbmRpY2F0b3JMaW5lLAogICAgfSwKICAgIHsKICAgICAgaWQ6ICJjaGFydC10b29sdGlwLWluZGljYXRvci1ub25lIiwKICAgICAgY29tcG9uZW50OiBDaGFydFRvb2x0aXBJbmRpY2F0b3JOb25lLAogICAgfSwKICAgIHsgaWQ6ICJjaGFydC10b29sdGlwLWxhYmVsLWN1c3RvbSIsIGNvbXBvbmVudDogQ2hhcnRUb29sdGlwTGFiZWxDdXN0b20gfSwKICAgIHsKICAgICAgaWQ6ICJjaGFydC10b29sdGlwLWxhYmVsLWZvcm1hdHRlciIsCiAgICAgIGNvbXBvbmVudDogQ2hhcnRUb29sdGlwTGFiZWxGb3JtYXR0ZXIsCiAgICB9LAogICAgeyBpZDogImNoYXJ0LXRvb2x0aXAtbGFiZWwtbm9uZSIsIGNvbXBvbmVudDogQ2hhcnRUb29sdGlwTGFiZWxOb25lIH0sCiAgICB7IGlkOiAiY2hhcnQtdG9vbHRpcC1mb3JtYXR0ZXIiLCBjb21wb25lbnQ6IENoYXJ0VG9vbHRpcEZvcm1hdHRlciB9LAogICAgeyBpZDogImNoYXJ0LXRvb2x0aXAtaWNvbnMiLCBjb21wb25lbnQ6IENoYXJ0VG9vbHRpcEljb25zIH0sCiAgICB7IGlkOiAiY2hhcnQtdG9vbHRpcC1hZHZhbmNlZCIsIGNvbXBvbmVudDogQ2hhcnRUb29sdGlwQWR2YW5jZWQgfSwKICBdLAp9CgovLyBFeHBvcnQgaW5kaXZpZHVhbCBjb21wb25lbnRzIGZvciBiYWNrd2FyZCBjb21wYXRpYmlsaXR5CmV4cG9ydCB7CiAgQ2hhcnRBcmVhRGVmYXVsdCwKICBDaGFydEFyZWFMaW5lYXIsCiAgQ2hhcnRBcmVhU3RlcCwKICBDaGFydEFyZWFMZWdlbmQsCiAgQ2hhcnRBcmVhU3RhY2tlZCwKICBDaGFydEFyZWFTdGFja2VkRXhwYW5kLAogIENoYXJ0QXJlYUljb25zLAogIENoYXJ0QXJlYUdyYWRpZW50LAogIENoYXJ0QXJlYUF4ZXMsCiAgQ2hhcnRBcmVhSW50ZXJhY3RpdmUsCiAgQ2hhcnRCYXJEZWZhdWx0LAogIENoYXJ0QmFySG9yaXpvbnRhbCwKICBDaGFydEJhck11bHRpcGxlLAogIENoYXJ0QmFyU3RhY2tlZCwKICBDaGFydEJhckxhYmVsLAogIENoYXJ0QmFyTGFiZWxDdXN0b20sCiAgQ2hhcnRCYXJNaXhlZCwKICBDaGFydEJhckFjdGl2ZSwKICBDaGFydEJhck5lZ2F0aXZlLAogIENoYXJ0QmFySW50ZXJhY3RpdmUsCiAgQ2hhcnRMaW5lRGVmYXVsdCwKICBDaGFydExpbmVMaW5lYXIsCiAgQ2hhcnRMaW5lU3RlcCwKICBDaGFydExpbmVNdWx0aXBsZSwKICBDaGFydExpbmVEb3RzLAogIENoYXJ0TGluZURvdHNDdXN0b20sCiAgQ2hhcnRMaW5lRG90c0NvbG9ycywKICBDaGFydExpbmVMYWJlbCwKICBDaGFydExpbmVMYWJlbEN1c3RvbSwKICBDaGFydExpbmVJbnRlcmFjdGl2ZSwKICBDaGFydFBpZVNpbXBsZSwKICBDaGFydFBpZVNlcGFyYXRvck5vbmUsCiAgQ2hhcnRQaWVMYWJlbCwKICBDaGFydFBpZUxhYmVsQ3VzdG9tLAogIENoYXJ0UGllTGFiZWxMaXN0LAogIENoYXJ0UGllTGVnZW5kLAogIENoYXJ0UGllRG9udXQsCiAgQ2hhcnRQaWVEb251dEFjdGl2ZSwKICBDaGFydFBpZURvbnV0VGV4dCwKICBDaGFydFBpZVN0YWNrZWQsCiAgQ2hhcnRQaWVJbnRlcmFjdGl2ZSwKICBDaGFydFJhZGFyRGVmYXVsdCwKICBDaGFydFJhZGFyRG90cywKICBDaGFydFJhZGFyTGluZXNPbmx5LAogIENoYXJ0UmFkYXJMYWJlbEN1c3RvbSwKICBDaGFydFJhZGFyR3JpZEN1c3RvbSwKICBDaGFydFJhZGFyR3JpZE5vbmUsCiAgQ2hhcnRSYWRhckdyaWRDaXJjbGUsCiAgQ2hhcnRSYWRhckdyaWRDaXJjbGVOb0xpbmVzLAogIENoYXJ0UmFkYXJHcmlkQ2lyY2xlRmlsbCwKICBDaGFydFJhZGFyR3JpZEZpbGwsCiAgQ2hhcnRSYWRhck11bHRpcGxlLAogIENoYXJ0UmFkYXJMZWdlbmQsCiAgQ2hhcnRSYWRhckljb25zLAogIENoYXJ0UmFkYXJSYWRpdXMsCiAgQ2hhcnRSYWRpYWxTaW1wbGUsCiAgQ2hhcnRSYWRpYWxMYWJlbCwKICBDaGFydFJhZGlhbEdyaWQsCiAgQ2hhcnRSYWRpYWxUZXh0LAogIENoYXJ0UmFkaWFsU2hhcGUsCiAgQ2hhcnRSYWRpYWxTdGFja3BzOi8vd3d3Lmluc3RhZ3JhbS5jb20vYWF2ZS8nLAogICAgaWNvbjogPEluc3RhZ3JhbSAvPiwKICAgIHRpdGxlOiAnSW5zdGFncmFtJywKICB9LAogIHsKICAgIGhyZWY6ICdodHRwczovL3d3dy50aWt0b2suY29tL0BhYXZlbGFicycsCiAgICBpY29uOiA8VGlrVG9rIC8+LAogICAgdGl0bGU6ICdUaWtUb2snLAogIH0sCiAgewogICAgaHJlZjogJ2h0dHBzOi8vd3d3LmxpbmtlZGluLmNvbS9jb21wYW55L2FhdmVsYWJzLycsCiAgICBpY29uOiA8TGlua2VkSW4gLz4sCiAgICB0aXRsZTogJ0xpbmtlZGluJywKICB9LAogIHsKICAgIGhyZWY6ICdodHRwczovL2Rpc2NvcmQuY29tL2ludml0ZS9hYXZlJywKICAgIGljb246IDxEaXNjb3JkSWNvbiAvPiwKICAgIHRpdGxlOiAnRGlzY29yZCcsCiAgfSwKICB7CiAgICBocmVmOiAnaHR0cHM6Ly9kdW5lLmNvbS9hYXZlbGFicycsCiAgICBpY29uOiA8RHVuZUljb24gLz4sCiAgICB0aXRsZTogJ0R1bmUnLAogIH0sCiAgewogICAgaHJlZjogJ2h0dHBzOi8vZ2l0aHViLmNvbS9hYXZlJywKICAgIGljb246IDxHaXRIdWIgLz4sCiAgICB0aXRsZTogJ0dpdGh1YicsCiAgfSwKICB7CiAgICBocmVmOiAnaHR0cHM6Ly9oZXkueHl6L3UvYWF2ZScsCiAgICBpY29uOiA8TGVuc0xvZ29JY29uIC8+LAogICAgdGl0bGU6ICdBYXZlIG9uIExlbnMnLAogIH0sCl07CgpleHBvcnQgZnVuY3Rpb24gQXBwRm9vdGVyKCkgewogIGNvbnN0IFtzZXRBbmFseXRpY3NDb25maWdPcGVuLCBzZXRGZWVkYmFja09wZW5dID0gdXNlUm9vdFN0b3JlKAogICAgdXNlU2hhbGxvdygoc3RvcmUpID0+IFtzdG9yZS5zZXRBbmFseXRpY3NDb25maWdPcGVuLCBzdG9yZS5zZXRGZWVkYmFja09wZW5dKQogICk7CgogIGNvbnN0IEZPT1RFUl9MSU5LUyA9IFsKICAgIHsKICAgICAgaHJlZjogJ2h0dHBzOi8vYWF2ZS5jb20vdGVybXMtb2Ytc2VydmljZScsCiAgICAgIGxhYmVsOiA8VHJhbnM+VGVybXM8L1RyYW5zPiwKICAgICAga2V5OiAnVGVybXMnLAogICAgfSwKICAgIHsKICAgICAgaHJlZjogJ2h0dHBzOi8vYWF2ZS5jb20vcHJpdmFjeS1wb2xpY3kvJywKICAgICAgbGFiZWw6IDxUcmFucz5Qcml2YWN5PC9UcmFucz4sCiAgICAgIGtleTogJ1ByaXZhY3knLAogICAgfSwKICAgIHsKICAgICAgaHJlZjogJ2h0dHBzOi8vZG9jcy5hYXZlLmNvbS9odWIvJywKICAgICAgbGFiZWw6IDxUcmFucz5Eb2NzPC9UcmFucz4sCiAgICAgIGtleTogJ0RvY3MnLAogICAgfSwKICAgIHsKICAgICAgaHJlZjogJ2h0dHBzOi8vZG9jcy5hYXZlLmNvbS9mYXEvJywKICAgICAgbGFiZWw6IDxUcmFucz5GQVFTPC9UcmFucz4sCiAgICAgIGtleTogJ0ZBUVMnLAogICAgfSwKICAgIHsKICAgICAgaHJlZjogJ2h0dHBzOi8vZGlzY29yZC5jb20vaW52aXRlL2FhdmUnLAogICAgICBsYWJlbDogPFRyYW5zPkdldCBTdXBwb3J0PC9UcmFucz4sCiAgICAgIGtleTogJ0dldCBTdXBwb3J0JywKICAgICAgb25DbGljazogKGV2ZW50OiBSZWFjdC5Nb3VzZUV2ZW50KSA9PiB7CiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICBzZXRGZWVkYmFja09wZW4odHJ1ZSk7CiAgICAgIH0sCiAgICB9LAogICAgewogICAgICBocmVmOiAnLycsCiAgICAgIGxhYmVsOiA8VHJhbnM+TWFuYWdlIGFuYWx5dGljczwvVHJhbnM+LAogICAgICBrZXk6ICdNYW5hZ2UgYW5hbHl0aWNzJywKICAgICAgb25DbGljazogKGV2ZW50OiBSZWFjdC5Nb3VzZUV2ZW50KSA9PiB7CiAgICAgICAgZXZlbnQucHJldmVudERlZmF1bHQoKTsKICAgICAgICBzZXRBbmFseXRpY3NDb25maWdPcGVuKHRydWUpOwogICAgICB9LAogICAgfSwKICBdOwoKICByZXR1cm4gKAogICAgPEJveAogICAgICBzeD17KHRoZW1lKSA9PiAoewogICAgICAgIGRpc3BsYXk6ICdmbGV4JywKICAgICAgICBwYWRkaW5nOiBbJzIycHggMHB4IDQwcHggMHB4JywgJzAgMjJweCAwIDQwcHgnLCAnMjBweCAyMnB4J10sCiAgcCA9ICd1bnNldCcKICAgICAgfQogICAgICBjb25zdCB0cmFuc2Zvcm1PZmZzZXQgPSA2MAogICAgICBjb25zdCBtYXhYT2Zmc2V0ID0gdGhpcy5hcGkucGFuZVNpemUoKS53aWR0aCAtIDQwCiAgICAgIC8vIGtlZXBzIHRoZSBsZWdlbmQgY2VudGVyZWQgb24gbW91c2UgeCBheGlzIHdpdGhvdXQgZ2V0dGluZyBjdXQgb2ZmIGJ5IGNoYXJ0IGVkZ2VzCiAgICAgIGlmICh4IDwgdHJhbnNmb3JtT2Zmc2V0KSB7CiAgICAgICAgLy8gQWRkaXRpb25hbCA0cHggb2YgcGFkZGluZyBpcyBhZGRlZCB0byBwcmV2ZW50IGJveC1zaGFkb3cgZnJvbSBiZWluZyBjdXRvZmYKICAgICAgICBsZWdlbmQuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZVgoLSR7eCAtIDR9JSlgCiAgICAgIH0gZWxzZSBpZiAoeCA+IG1heFhPZmZzZXQpIHsKICAgICAgICBsZWdlbmQuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZVgoLSR7dHJhbnNmb3JtT2Zmc2V0ICsgKHggLSBtYXhYT2Zmc2V0KX0lKWAKICAgICAgfSBlbHNlIHsKICAgICAgICBsZWdlbmQuc3R5bGUudHJhbnNmb3JtID0gYHRyYW5zbGF0ZVgoLSR7dHJhbnNmb3JtT2Zmc2V0fSUpYAogICAgICB9CiAgICB9CiAgfQoKICAvKiogVXBkYXRlcyB0aGUgY2hhcnQgd2l0aG91dCByZS1jcmVhdGluZyBpdCBvciByZXNldHRpbmcgcGFuL3pvb20uICovCiAgcHVibGljIHVwZGF0ZU9wdGlvbnMoCiAgICB7IGxvY2FsZSwgY29sb3JzLCBmb3JtYXQsIGlzTGFyZ2VTY3JlZW4sIG9uQ3Jvc3NoYWlyTW92ZSB9OiBDaGFydE1vZGVsUGFyYW1zPFREYXRhVHlwZT4sCiAgICBub25EZWZhdWx0Q2hhcnRPcHRpb25zPzogRGVlcFBhcnRpYWw8VGltZUNoYXJ0T3B0aW9ucz4sCiAgKSB7CiAgICB0aGlzLm9uQ3Jvc3NoYWlyTW92ZSA9IG9uQ3Jvc3NoYWlyTW92ZQoKICAgIC8vIEJlbG93IGFyZSBkZWZhdWx0IG9wdGlvbnMgdGhhdCB3aWxsIGFwcGx5IHRvIGFsbCBDaGFydCBtb2RlbHMgdGhhdCBleHRlbmQgdGhpcyBjbGFzcyBhbmQgY2FsbCBzdXBlci51cGRhdGVPcHRpb25zKCkuCiAgICAvLyBTdWJjbGFzc2VzIGNhbiBvdmVycmlkZSAvIGV4dGVuZCB0aGVzZSBvcHRpb25zIGJ5IHBhc3NpbmcgaW4gbm9uRGVmYXVsdENoYXJ0T3B0aW9ucy4KICAgIGNvbnN0IGRlZmF1bHRPcHRpb25zOiBEZWVwUGFydGlhbDxUaW1lQ2hhcnRPcHRpb25zPiA9IHsKICAgICAgbG9jYWxpemF0aW9uOiB7CiAgICAgICAgbG9jYWxlLAogICAgICAgIHByaWNlRm9ybWF0dGVyOiAocHJpY2U6IEJhclByaWNlKSA9PiBmb3JtYXQuY29udmVydEZpYXRBbW91bnRGb3JtYXR0ZWQocHJpY2UsIE51bWJlclR5cGUuRmlhdFRva2VuUHJpY2UpLAogICAgICB9LAogICAgICBhdXRvU2l6ZTogdHJ1ZSwKICAgICAgbGF5b3V0OiB7IHRleHRDb2xvcjogY29sb3JzLm5ldXRyYWwyLnZhbCwgYmFja2dyb3VuZDogeyBjb2xvcjogJ3RyYW5zcGFyZW50JyB9IH0sCiAgICAgIHRpbWVTY2FsZTogewogICAgICAgIHRpY2tNYXJrRm9ybWF0dGVyOiBmb3JtYXRUaWNrTWFya3MsCiAgICAgICAgYm9yZGVyVmlzaWJsZTogZmFsc2UsCiAgICAgICAgdGlja3NWaXNpYmxlOiBmYWxzZSwKICAgICAgICB0aW1lVmlzaWJsZTogdHJ1ZSwKICAgICAgICBmaXhMZWZ0RWRnZTogdHJ1ZSwKICAgICAgICBmaXhSaWdodEVkZ2U6IHRydWUsCiAgICAgIH0sCiAgICAgIHJpZ2h0UHJpY2VTY2FsZTogewogICAgICAgIHZpc2libGU6IGlzTGFyZ2VTY3JlZW4sCiAgICAgICAgYm9yZGVyVmlzaWJsZTogZmFsc2UsCiAgICAgICAgc2NhbGVNYXJnaW5zOiB7CiAgICAgICAgICB0b3A6IERFRkFVTFRfVE9QX1BSSUNFX1NDQUxFX01BUkdJTiwKICAgICAgICAgIGJvdHRvbTogREVGQVVMVF9CT1RUT01fUFJJQ0VfU0NBTEVfTUFSR0lOLAogICAgICAgIH0sCiAgICAgICAgYXV0b1NjYWxlOiB0cnVlLAogICAgICB9LAogICAgICBncmlkOiB7CiAgICAgICAgdmVydExpbmVzOiB7ZyB8fCAhIXNob3dFcnJvciB8fCBzZWxlY3RlZEFkZHJlc3Nlcy5sZW5ndGggPT09IDAKCiAgY29uc3Qgc2hvd1NtYXJ0V2FsbGV0RGlzY2xhaW1lciA9IHNtYXJ0V2FsbGV0RW5hYmxlZCAmJiAhaXNDb250aW51ZUJ1dHRvbkRpc2FibGVkCgogIGNvbnN0IG9wYWNpdHlTdHlsZSA9IHVzZUFuaW1hdGVkU3R5bGUoCiAgICAoKSA9PiAoewogICAgICBvcGFjaXR5OiB3aXRoVGltaW5nKHNob3dTbWFydFdhbGxldERpc2NsYWltZXIgPyAxIDogMCwgeyBkdXJhdGlvbjogQU5JTUFUSU9OX0RVUkFUSU9OIH0pLAogICAgfSksCiAgICBbc2hvd1NtYXJ0V2FsbGV0RGlzY2xhaW1lcl0sCiAgKQoKICByZXR1cm4gKAogICAgPD4KICAgICAgPE9uYm9hcmRpbmdTY3JlZW4KICAgICAgICBpZ25vcmVDb250YWluZXJQYWRkaW5nWAogICAgICAgIGlnbm9yZVRleHRDb250YWluZXJNYXJnaW5Cb3R0b209eyFpc0xvYWRpbmd9CiAgICAgICAgSWNvbj17V2FsbGV0RmlsbGVkfQogICAgICAgIHN1YnRpdGxlPXshc2hvd0Vycm9yID8gc3VidGl0bGUgOiB1bmRlZmluZWR9CiAgICAgICAgdGl0bGU9eyFzaG93RXJyb3IgPyB0aXRsZSA6ICcnfQogICAgICA+CiAgICAgICAge3Nob3dFcnJvciA/ICgKICAgICAgICAgIDxCYXNlQ2FyZC5FcnJvclN0YXRlCiAgICAgICAgICAgIHJldHJ5QnV0dG9uTGFiZWw9e3QoJ2NvbW1vbi5idXR0b24ucmV0cnknKX0KICAgICAgICAgICAgdGl0bGU9e3QoJ2FjY291bnQud2FsbGV0LnNlbGVjdC5lcnJvcicpfQogICAgICAgICAgICBvblJldHJ5PXtyZWZldGNoQWNjb3VudHN9CiAgICAgICAgICAvPgogICAgICAgICkgOiBpc0xvYWRpbmcgPyAoCiAgICAgICAgICA8RmxleCBncm93IGp1c3RpZnlDb250ZW50PSJzcGFjZS1iZXR3ZWVuIiBweD0iJHNwYWNpbmcxNiI+CiAgICAgICAgICAgIDxMb2FkZXIuV2FsbGV0cyByZXBlYXQ9ezV9IC8+CiAgICAgICAgICA8L0ZsZXg+CiAgICAgICAgKSA6ICgKICAgICAgICAgIDxTY3JvbGxWaWV3IHRlc3RJRD17VGVzdElELlNlbGVjdFdhbGxldFNjcmVlbkxvYWRlZH0+CiAgICAgICAgICAgIDxGbGV4IGhlaWdodD0iJHNwYWNpbmcxMiIgLz4KICAgICAgICAgICAgPEZsZXggZ2FwPSIkZ2FwMTIiPgogICAgICAgICAgICAgIHtpbXBvcnRhYmxlQWNjb3VudHM/Lm1hcCgoYWNjb3VudCwgaSkgPT4gewogICAgICAgICAgICAgICAgY29uc3QgeyBhZGRyZXNzLCBiYWxhbmNlIH0gPSBhY2NvdW50CiAgICAgICAgICAgICAgICAvLyBwcmV2ZW50cyBmbGlja2VyaW5nIGFuZCBpbmNvcnJlY3Qgd2lkdGggY2FsY3VsYXRpb24gZm9yIGxvbmcgd2FsbGV0IG5hbWVzIG9uIEFuZHJvaWQKICAgICAgICAgICAgICAgIC8vIGl0J3Mgbm90IHBvc3NpYmxlIHRvIGRlc2VsZWN0IGxhc3Qgd2FsbGV0CiAgICAgICAgICAgICAgICBpZiAoc2VsZWN0ZWRBZGRyZXNzZXMubGVuZ3RoID09PSAwKSB7CiAgICAgICAgICAgICAgICAgIHJldHVybiBudWxsCiAgICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgICAgICA8RmxleCBrZXk9e2l9IHB4PSIkc3BhY2luZzE2Ij4KICAgICAgICAgICAgICAgICAgICA8V2FsbGV0UHJldmlld0NhcmQKICAgICAgICAgICAgICAgICAgICAgIGFkZHJlc3M9e2FkZHJlc3N9CiAgICAgICAgICAgICAgICAgICAgICBiYWxhbmNlPXtiYWxhbmNlfQogICAgICAgICAgICAgICAgICAgICAgaGlkZVNlbGVjdGlvbkNpcmNsZT17aXNPbmx5T25lQWNjb3VudH0KICAgICAgICAgICAgICAgICAgICAgIG5hbWU9e0VsZW1lbnROYW1lLldhbGxldENhcmR9CiAgICAgICAgICAgICAgICAgICAgICBzZWxlY3RlZD17c2VsZWN0ZWRBZGRyZXNzZXMuaW5jbHVkZXMoYWRkcmVzcyl9CiAgICAgICAgICAgICAgICAgICAgICB0ZXN0SUQ9e2Ake1Rlc3RJRC5XYWxsZXRDYXJkfS0ke2kgKyAxfWB9CiAgICAgICAgICAgICAgICAgICAgICBvblNlbGVjdD17dG9nZ2xlQWRkcm50cy9DdXJyZW5jeUxvZ28vTmV0d29ya0xvZ28nCmltcG9ydCB7IFRyYW5zYWN0aW9uRGV0YWlsc1Rvb2x0aXAgYXMgVG9vbHRpcCB9IGZyb20gJ3VuaXN3YXAvc3JjL2NvbXBvbmVudHMvVHJhbnNhY3Rpb25EZXRhaWxzVG9vbHRpcCcKaW1wb3J0IHsgdW5pc3dhcFVybHMgfSBmcm9tICd1bmlzd2FwL3NyYy9jb25zdGFudHMvdXJscycKaW1wb3J0IHsgZ2V0Q2hhaW5JbmZvIH0gZnJvbSAndW5pc3dhcC9zcmMvZmVhdHVyZXMvY2hhaW5zL2NoYWluSW5mbycKaW1wb3J0IHsgVW5pdmVyc2VDaGFpbklkIH0gZnJvbSAndW5pc3dhcC9zcmMvZmVhdHVyZXMvY2hhaW5zL3R5cGVzJwppbXBvcnQgeyBGb3JtYXR0ZWRVbmlzd2FwWEdhc0ZlZUluZm8gfSBmcm9tICd1bmlzd2FwL3NyYy9mZWF0dXJlcy9nYXMvdHlwZXMnCgpleHBvcnQgZnVuY3Rpb24gTmV0d29ya0Nvc3RUb29sdGlwQ2xhc3NpYyh7IGNoYWluSWQgfTogeyBjaGFpbklkOiBVbml2ZXJzZUNoYWluSWQgfSk6IEpTWC5FbGVtZW50IHsKICBjb25zdCB7IHQgfSA9IHVzZVRyYW5zbGF0aW9uKCkKCiAgcmV0dXJuICgKICAgIDxUb29sdGlwLk91dGVyPgogICAgICA8VG9vbHRpcC5IZWFkZXIKICAgICAgICB0aXRsZT17eyB0aXRsZTogdCgnY29tbW9uLmNoYWluLm5ldHdvcmtDb3N0JywgeyBjaGFpbjogZ2V0Q2hhaW5JbmZvKGNoYWluSWQpLm5hbWUgfSkgfX0KICAgICAgICBsb2dvPXs8TmV0d29ya0xvZ28gY2hhaW5JZD17Y2hhaW5JZH0gc2l6ZT17MTZ9IC8+fQogICAgICAvPgogICAgICA8VG9vbHRpcC5EZXNjcmlwdGlvbgogICAgICAgIGxlYXJuTW9yZVVybD17dW5pc3dhcFVybHMuaGVscEFydGljbGVVcmxzLm5ldHdvcmtGZWVJbmZvfQogICAgICAgIHRleHQ9e3QoJ3RyYW5zYWN0aW9uLm5ldHdvcmtDb3N0LmRlc2NyaXB0aW9uJyl9CiAgICAgIC8+CiAgICA8L1Rvb2x0aXAuT3V0ZXI+CiAgKQp9CgpleHBvcnQgZnVuY3Rpb24gTmV0d29ya0Nvc3RUb29sdGlwU21hcnRXYWxsZXQoKTogSlNYLkVsZW1lbnQgewogIGNvbnN0IHsgdCB9ID0gdXNlVHJhbnNsYXRpb24oKQoKICByZXR1cm4gKAogICAgPFRvb2x0aXAuT3V0ZXI+CiAgICAgIDxUb29sdGlwLkRlc2NyaXB0aW9uCiAgICAgICAgbGVhcm5Nb3JlUGlua0NvbG9yPXt0cnVlfQogICAgICAgIGxlYXJuTW9yZVVybD17dW5pc3dhcFVybHMuaGVscEFydGljbGVVcmxzLm5ldHdvcmtGZWVJbmZvfQogICAgICAgIHRleHQ9e3QoJ3N3YXAud2FybmluZy5uZXR3b3JrRmVlLm1lc3NhZ2UnKX0KICAgICAgLz4KICAgIDwvVG9vbHRpcC5PdXRlcj4KICApCn0KCmV4cG9ydCBmdW5jdGlvbiBOZXR3b3JrQ29zdFRvb2x0aXBVbmlzd2FwWCh7CiAgdW5pc3dhcFhHYXNGZWVJbmZvLAp9OiB7CiAgdW5pc3dhcFhHYXNGZWVJbmZvOiBGb3JtYXR0ZWRVbmlzd2FwWEdhc0ZlZUluZm8KfSk6IEpTWC5FbGVtZW50IHsKICBjb25zdCB7IHQgfSA9IHVzZVRyYW5zbGF0aW9uKCkKICBjb25zdCB7IGFwcHJvdmFsRmVlRm9ybWF0dGVkLCBzd2FwRmVlRm9ybWF0dGVkLCBpbnB1dFRva2VuU3ltYm9sIH0gPSB1bmlzd2FwWEdhc0ZlZUluZm8KCiAgcmV0dXJuICgKICAgIDxUb29sdGlwLk91dGVyPgogICAgICA8VG9vbHRpcC5IZWFkZXIKICAgICAgICB0aXRsZT17eyB0aXRsZTogdCgnc3dhcC53YXJuaW5nLm5ldHdvcmtGZWUubWVzc2FnZS51bmlzd2FwWC50aXRsZScpLCB1bmlzd2FwWDogdHJ1ZSB9fQogICAgICAgIEljb249e1VuaXN3YXBYfQogICAgICAvPgogICAgICA8VG9vbHRpcC5Db250ZW50PgogICAgICAgIDxUb29sdGlwLlJvdz4KICAgICAgICAgIDxUb29sdGlwLkxpbmVJdGVtTGFiZWwgbGFiZWw9e3QoJ3RyYW5zYWN0aW9uLmRldGFpbHMubmV0d29ya0ZlZS5zd2FwJyl9IC8+CiAgICAgICAgICA8RmxleCByb3cgZ2FwPSIkc3BhY2luZzYiPgogICAgICAgICAgICA8VGV4dCBjb2xvcj0iJG5ldXRyYWwyIiB0ZXh0RGVjb3JhdGlvbkxpbmU9ImxpbmUtdGhyb3VnaCJ0L3VpL2NoYXJ0IgoKZXhwb3J0IGNvbnN0IGRlc2NyaXB0aW9uID0gIkEgc3RhY2tlZCBiYXIgY2hhcnQgd2l0aCBhIGxlZ2VuZCIKCmNvbnN0IGNoYXJ0RGF0YSA9IFsKICB7IGRhdGU6ICIyMDI0LTA3LTE1IiwgcnVubmluZzogNDUwLCBzd2ltbWluZzogMzAwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNy0xNiIsIHJ1bm5pbmc6IDM4MCwgc3dpbW1pbmc6IDQyMCB9LAogIHsgZGF0ZTogIjIwMjQtMDctMTciLCBydW5uaW5nOiA1MjAsIHN3aW1taW5nOiAxMjAgfSwKICB7IGRhdGU6ICIyMDI0LTA3LTE4IiwgcnVubmluZzogMTQwLCBzd2ltbWluZzogNTUwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNy0xOSIsIHJ1bm5pbmc6IDYwMCwgc3dpbW1pbmc6IDM1MCB9LAogIHsgZGF0ZTogIjIwMjQtMDctMjAiLCBydW5uaW5nOiA0ODAsIHN3aW1taW5nOiA0MDAgfSwKXQoKY29uc3QgY2hhcnRDb25maWcgPSB7CiAgYWN0aXZpdGllczogewogICAgbGFiZWw6ICJBY3Rpdml0aWVzIiwKICB9LAogIHJ1bm5pbmc6IHsKICAgIGxhYmVsOiAiUnVubmluZyIsCiAgICBjb2xvcjogImhzbCh2YXIoLS1jaGFydC0xKSkiLAogIH0sCiAgc3dpbW1pbmc6IHsKICAgIGxhYmVsOiAiU3dpbW1pbmciLAogICAgY29sb3I6ICJoc2wodmFyKC0tY2hhcnQtMikpIiwKICB9LAp9IHNhdGlzZmllcyBDaGFydENvbmZpZwoKZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gQ29tcG9uZW50KCkgewogIHJldHVybiAoCiAgICA8Q2FyZD4KICAgICAgPENhcmRIZWFkZXI+CiAgICAgICAgPENhcmRUaXRsZT5Ub29sdGlwIC0gQ3VzdG9tIGxhYmVsPC9DYXJkVGl0bGU+CiAgICAgICAgPENhcmREZXNjcmlwdGlvbj4KICAgICAgICAgIFRvb2x0aXAgd2l0aCBjdXN0b20gbGFiZWwgZnJvbSBjaGFydENvbmZpZy4KICAgICAgICA8L0NhcmREZXNjcmlwdGlvbj4KICAgICAgPC9DYXJkSGVhZGVyPgogICAgICA8Q2FyZENvbnRlbnQ+CiAgICAgICAgPENoYXJ0Q29udGFpbmVyIGNvbmZpZz17Y2hhcnRDb25maWd9PgogICAgICAgICAgPEJhckNoYXJ0IGFjY2Vzc2liaWxpdHlMYXllciBkYXRhPXtjaGFydERhdGF9PgogICAgICAgICAgICA8WEF4aXMKICAgICAgICAgICAgICBkYXRhS2V5PSJkYXRlIgogICAgICAgICAgICAgIHRpY2tMaW5lPXtmYWxzZX0KICAgICAgICAgICAgICB0aWNrTWFyZ2luPXsxMH0KICAgICAgICAgICAgICBheGlzTGluZT17ZmFsc2V9CiAgICAgICAgICAgICAgdGlja0Zvcm1hdHRlcj17KHZhbHVlKSA9PiB7CiAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERhdGUodmFsdWUpLnRvTG9jYWxlRGF0ZVN0cmluZygiZW4tVVMiLCB7CiAgICAgICAgICAgICAgICAgIHdlZWtkYXk6ICJzaG9ydCIsCiAgICAgICAgICAgICAgICB9KQogICAgICAgICAgICAgIH19CiAgICAgICAgICAgIC8+CiAgICAgICAgICAgIDxCYXIKICAgICAgICAgICAgICBkYXRhS2V5PSJydW5uaW5nIgogICAgICAgICAgICAgIHN0YWNrSWQ9ImEiCiAgICAgICAgICAgICAgZmlsbD0idmFyKC0tY29sb3ItcnVubmluZykiCiAgICAgICAgICAgICAgcmFkaXVzPXtbMCwgMCwgNCwgNF19CiAgICAgICAgICAgIC8+CiAgICAgICAgICAgIDxCYXIKICAgICAgICAgICAgICBkYXRhS2V5PSJzd2ltbWluZyIKICAgICAgICAgICAgICBzdGFja0lkPSJhIgogICAgICAgICAgICAgIGZpbGw9InZhcigtLWNvbG9yLXN3aW1taW5nKSIKICAgICAgICAgICAgICByYWRpdXM9e1s0LCA0LCAwLCAwXX0KICAgICAgICAgICAgLz4KICAgICAgICAgICAgPENoYXJ0VG9vbHRpcAogICAgICAgICAgICAgIGNvbnRlbnQ9ewogICAgICAgICAgICAgICAgPENoYXJ0VG9vbHRpcENvbnRlbnQgbGFiZWxLZXk9ImFjdGl2aXRpZXMiIGluZGljYXRvcj0ibGluZSIgLz4KICAgICAgICAgICAgICB9CiAgICAgICAgICAgICAgY3Vyc29yPXtmYWxzZX0KICAgICAgICAgICAgICBkZWZhdWx0SW5kZXg9ezF9CiAgICAgICAgICAgIC8+CiAgICAgICAgICA8L0JhckNobGxlciwKICBzY3JpcHRTdGFydDogc3RyaW5nLAogIGZvcm1TdGF0ZTogdW5rbm93biB8IG51bGwKKSB7CiAgbGV0IHNjcmlwdENvbnRlbnRzID0gYChzZWxmLl9fbmV4dF9mPXNlbGYuX19uZXh0X2Z8fFtdKS5wdXNoKCR7aHRtbEVzY2FwZUpzb25TdHJpbmcoCiAgICBKU09OLnN0cmluZ2lmeShbSU5MSU5FX0ZMSUdIVF9QQVlMT0FEX0JPT1RTVFJBUF0pCiAgKX0pYAoKICBpZiAoZm9ybVN0YXRlICE9IG51bGwpIHsKICAgIHNjcmlwdENvbnRlbnRzICs9IGA7c2VsZi5fX25leHRfZi5wdXNoKCR7aHRtbEVzY2FwZUpzb25TdHJpbmcoCiAgICAgIEpTT04uc3RyaW5naWZ5KFtJTkxJTkVfRkxJR0hUX1BBWUxPQURfRk9STV9TVEFURSwgZm9ybVN0YXRlXSkKICAgICl9KWAKICB9CgogIGNvbnRyb2xsZXIuZW5xdWV1ZShlbmNvZGVyLmVuY29kZShgJHtzY3JpcHRTdGFydH0ke3NjcmlwdENvbnRlbnRzfTwvc2NyaXB0PmApKQp9CgpmdW5jdGlvbiB3cml0ZUZsaWdodERhdGFJbnN0cnVjdGlvbigKICBjb250cm9sbGVyOiBSZWFkYWJsZVN0cmVhbURlZmF1bHRDb250cm9sbGVyLAogIHNjcmlwdFN0YXJ0OiBzdHJpbmcsCiAgY2h1bms6IHN0cmluZyB8IFVpbnQ4QXJyYXkKKSB7CiAgbGV0IGh0bWxJbmxpbmVkRGF0YTogc3RyaW5nCgogIGlmICh0eXBlb2YgY2h1bmsgPT09ICdzdHJpbmcnKSB7CiAgICBodG1sSW5saW5lZERhdGEgPSBodG1sRXNjYXBlSnNvblN0cmluZygKICAgICAgSlNPTi5zdHJpbmdpZnkoW0lOTElORV9GTElHSFRfUEFZTE9BRF9EQVRBLCBjaHVua10pCiAgICApCiAgfSBlbHNlIHsKICAgIC8vIFRoZSBjaHVuayBjYW5ub3QgYmUgZW1iZWRkZWQgYXMgYSBVVEYtOCBzdHJpbmcgaW4gdGhlIHNjcmlwdCB0YWcuCiAgICAvLyBJbnN0ZWFkIGxldCdzIGlubGluZSBpdCBpbiBiYXNlNjQuCiAgICAvLyBDcmVkaXRzIHRvIERldm9uIEdvdmV0dCAoZGV2b25nb3ZldHQpIGZvciB0aGUgdGVjaG5pcXVlLgogICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL2Rldm9uZ292ZXR0L3JzYy1odG1sLXN0cmVhbQogICAgY29uc3QgYmFzZTY0ID0gYnRvYShTdHJpbmcuZnJvbUNvZGVQb2ludCguLi5jaHVuaykpCiAgICBodG1sSW5saW5lZERhdGEgPSBodG1sRXNjYXBlSnNvblN0cmluZygKICAgICAgSlNPTi5zdHJpbmdpZnkoW0lOTElORV9GTElHSFRfUEFZTE9BRF9CSU5BUlksIGJhc2U2NF0pCiAgICApCiAgfQoKICBjb250cm9sbGVyLmVucXVldWUoCiAgICBlbmNvZGVyLmVuY29kZSgKICAgICAgYCR7c2NyaXB0U3RhcnR9c2VsZi5fX25leHRfZi5wdXNoKCR7aHRtbElubGluZWREYXRhfSk8L3NjcmlwdD5gCiAgICApCiAgKQp9CiJ1c2UgY2xpZW50IgoKaW1wb3J0IHsgem9kUmVzb2x2ZXIgfSBmcm9tICJAaG9va2Zvcm0vcmVzb2x2ZXJzL3pvZCIKaW1wb3J0IHsgQ2hlY2ssIENoZXZyb25zVXBEb3duIH0gZnJvbSAibHVjaWRlLXJlYWN0IgppbXBvcnQgeyB1c2VGb3JtIH0gZnJvbSAicmVhY3QtaG9vay1mb3JtIgppbXBvcnQgeyB6IH0gZnJvbSAiem9kIgoKaW1wb3J0IHsgY24gfSBmcm9tICJAL2xpYi91dGlscyIKaW1wb3J0IHsgdG9hc3QgfSBmcm9tICJAL3JlZ2lzdHJ5L25ldy15b3JrL2hvb2tzL3VzZS10b2FzdCIKaW1wb3J0IHsgQnV0dG9uIH0gZnJvbSAiQC9yZWdpc3RyeS9uZXcteW9yay91aS9idXR0b24iCmltcG9ydCB7CiAgQ29tbWFuZCwKICBDb21tYW5kRW1wdHksCiAgQ29tbWFuZEdyb3VwLAogIENvbW1hbmRJbnB1dCwKICBDb21tYW5kSXRlbSwKICBDb21tYW5kTGlzdCwKfSBmcm9tICJAL3JlZ2lzdHJ5L25ldy15b3JrL3VpL2NvbW1hbmQiCmltcG9ydCB7CiAgRm9ybSwKICBGb3JtQ29udHJvbCwKICBGb3JtRGVzY3JpcHRpb24sCiAgRm9ybUZpZWxkLAogIEZvcm1JdGVtLAogIEZvcm1MYWJlbCwKICBGb3JtTWVzc2FnZSwKfSBmcm9tICJAL3JlZ2lzdHJ5L25ldy15b3JrL3VpL2Zvcm0iCmltcG9ydCB7CiAgUG9wb3ZlciwKICBQb29uUGF0Y2hba2V5XSA9IHBvc2l0aW9uCiAgICB9KQoKICAgIHNhdmVEZXZUb29sc0NvbmZpZyh7CiAgICAgIGRldlRvb2xzUGFuZWxQb3NpdGlvbjogcGFuZWxQb3NpdGlvblBhdGNoLAogICAgfSkKICB9Cn0KaW1wb3J0IHR5cGUgeyBCaW5hcnlTdHJlYW1PZiB9IGZyb20gJy4vYXBwLXJlbmRlcicKaW1wb3J0IHR5cGUgeyBSZWFkYWJsZSB9IGZyb20gJ25vZGU6c3RyZWFtJwoKaW1wb3J0IHsgaHRtbEVzY2FwZUpzb25TdHJpbmcgfSBmcm9tICcuLi9odG1sZXNjYXBlJwppbXBvcnQgeyB3b3JrVW5pdEFzeW5jU3RvcmFnZSB9IGZyb20gJy4vd29yay11bml0LWFzeW5jLXN0b3JhZ2UuZXh0ZXJuYWwnCmltcG9ydCB7IEludmFyaWFudEVycm9yIH0gZnJvbSAnLi4vLi4vc2hhcmVkL2xpYi9pbnZhcmlhbnQtZXJyb3InCmltcG9ydCB7IGdldENsaWVudFJlZmVyZW5jZU1hbmlmZXN0IH0gZnJvbSAnLi9tYW5pZmVzdHMtc2luZ2xldG9uJwoKY29uc3QgaXNFZGdlUnVudGltZSA9IHByb2Nlc3MuZW52Lk5FWFRfUlVOVElNRSA9PT0gJ2VkZ2UnCgpjb25zdCBJTkxJTkVfRkxJR0hUX1BBWUxPQURfQk9PVFNUUkFQID0gMApjb25zdCBJTkxJTkVfRkxJR0hUX1BBWUxPQURfREFUQSA9IDEKY29uc3QgSU5MSU5FX0ZMSUdIVF9QQVlMT0FEX0ZPUk1fU1RBVEUgPSAyCmNvbnN0IElOTElORV9GTElHSFRfUEFZTE9BRF9CSU5BUlkgPSAzCgpjb25zdCBmbGlnaHRSZXNwb25zZXMgPSBuZXcgV2Vha01hcDwKICBSZWFkYWJsZSB8IEJpbmFyeVN0cmVhbU9mPGFueT4sCiAgUHJvbWlzZTxhbnk+Cj4oKQpjb25zdCBlbmNvZGVyID0gbmV3IFRleHRFbmNvZGVyKCkKCmNvbnN0IGZpbmRTb3VyY2VNYXBVUkwgPQogIHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAncHJvZHVjdGlvbicKICAgID8gKHJlcXVpcmUoJy4uL2xpYi9zb3VyY2UtbWFwcycpIGFzIHR5cGVvZiBpbXBvcnQoJy4uL2xpYi9zb3VyY2UtbWFwcycpKQogICAgICAgIC5maW5kU291cmNlTWFwVVJMREVWCiAgICA6IHVuZGVmaW5lZAoKLyoqCiAqIFJlbmRlciBGbGlnaHQgc3RyZWFtLgogKiBUaGlzIGlzIG9ubHkgdXNlZCBmb3IgcmVuZGVyVG9IVE1MLCB0aGUgRmxpZ2h0IHJlc3BvbnNlIGRvZXMgbm90IG5lZWQgYWRkaXRpb25hbCB3cmFwcGVycy4KICovCmV4cG9ydCBmdW5jdGlvbiBnZXRGbGlnaHRTdHJlYW08VD4oCiAgZmxpZ2h0U3RyZWFtOiBSZWFkYWJsZSB8IEJpbmFyeVN0cmVhbU9mPFQ+LAogIGRlYnVnU3RyZWFtOiBSZWFkYWJsZSB8IFJlYWRhYmxlU3RyZWFtPFVpbnQ4QXJyYXk+IHwgdW5kZWZpbmVkLAogIGRlYnVnRW5kVGltZTogbnVtYmVyIHwgdW5kZWZpbmVkLAogIG5vbmNlOiBzdHJpbmcgfCB1bmRlZmluZWQKKTogUHJvbWlzZTxUPiB7CiAgY29uc3QgcmVzcG9uc2UgPSBmbGlnaHRSZXNwb25zZXMuZ2V0KGZsaWdodFN0cmVhbSkKCiAgaWYgKHJlc3BvbnNlKSB7CiAgICByZXR1cm4gcmVzcG9uc2UKICB9CgogIGNvbnN0IHsgbW9kdWxlTG9hZGluZywgZWRnZVNTUk1vZHVsZU1hcHBpbmcsIHNzck1vZHVsZU1hcHBpbmcgfSA9CiAgICBnZXRDbGllbnRSZWZlcmVuY2VNYW5pZmVzdCgpCgogIGxldCBuZXdSZXNwb25zZTogUHJvbWlzZTxUPgogIGlmIChmbGlnaHRTdHJlYW0gaW5zdGFuY2VvZiBSZWFkYWJsZVN0cmVhbSkgewogICAgLy8gVGhlIHR5cGVzIG9mIGZsaWdodFN0cmVhbSBhbmQgZGVidWdTdHJlYW0gc2hvdWxkIG1hdGNoLgogICAgaWYgKGRlYnVnU3RyZWFtICYmICEoZGVidWdTdHJlYW0gaW5zdGFuY2VvZiBSZWFkYWJsZVN0cmVhbSkpIHsKICAgICAgdGhyb3cgbmV3IEludmFyaWFudEVycm9yKCdFeHBlY3RlZCBkZWJ1ZyBzdHJlYW0gdG8gYmUgYSBSZWFkYWJsZVN0cmVhbScpCiAgICB9CgogICAgLy8gcmVhY3Qtc2VydmVyLWRvbS13ZWJwYWNrL2NsaWVudC5lZGdlIG11c3Qgbm90IGJlIGhvaXN0ZWQgZm9yIHJlcXVpcmUgY2FjaGUgY2xlYXJpbmcgdG8gd29yayBjb3JyZWN0bHkKICBlbGV0ZU11dGF0aW9uID0gdHJwYy52aWV3ZXIuZHN5bmMudGVhbUdyb3VwTWFwcGluZy5kZWxldGUudXNlTXV0YXRpb24oewogICAgb25TdWNjZXNzOiAoZGF0YSkgPT4gewogICAgICB1dGlscy52aWV3ZXIuZHN5bmMudGVhbUdyb3VwTWFwcGluZy5nZXQuc2V0RGF0YSh1bmRlZmluZWQsIChwcmV2KSA9PiB7CiAgICAgICAgaWYgKHByZXYpIHsKICAgICAgICAgIGNvbnN0IHRlYW1JbmRleCA9IHByZXYudGVhbUdyb3VwTWFwcGluZy5maW5kSW5kZXgoKHRlYW0pID0+IHRlYW0uaWQgPT09IHRlYW1JZCk7CiAgICAgICAgICBjb25zdCBpbmRleFRvUmVtb3ZlID0gcHJldi50ZWFtR3JvdXBNYXBwaW5nW3RlYW1JbmRleF0uZ3JvdXBOYW1lcy5pbmRleE9mKGRhdGEuZGVsZXRlZEdyb3VwTmFtZSk7CiAgICAgICAgICBwcmV2LnRlYW1Hcm91cE1hcHBpbmdbdGVhbUluZGV4XS5ncm91cE5hbWVzLnNwbGljZShpbmRleFRvUmVtb3ZlLCAxKTsKICAgICAgICB9CiAgICAgICAgcmV0dXJuIHByZXY7CiAgICAgIH0pOwogICAgICBzaG93VG9hc3QoYEdyb3VwIHJlbW92ZWRgLCAic3VjY2VzcyIpOwogICAgfSwKICAgIG9uRXJyb3I6IChlcnJvcikgPT4gewogICAgICBzaG93VG9hc3QoYEVycm9yIHJlbW92aW5nIGdyb3VwIG5hbWUke2Vycm9yLm1lc3NhZ2V9YCwgImVycm9yIik7CiAgICB9LAogIH0pOwoKICBjb25zdCBhZGRHcm91cE5hbWUgPSAoZ3JvdXBOYW1lOiBzdHJpbmcpID0+IHsKICAgIGlmIChncm91cE5hbWVzLnNvbWUoKG5hbWU6IHN0cmluZykgPT4gbmFtZSA9PT0gZ3JvdXBOYW1lKSkgewogICAgICBzaG93VG9hc3QoYEdyb3VwIG5hbWUgYWxyZWFkeSBhZGRlZGAsICJlcnJvciIpOwogICAgICByZXR1cm47CiAgICB9CgogICAgY3JlYXRlTXV0YXRpb24ubXV0YXRlKHsgdGVhbUlkOiB0ZWFtSWQsIG5hbWU6IGdyb3VwTmFtZSwgZGlyZWN0b3J5SWQ6IGRpcmVjdG9yeUlkIH0pOwogIH07CgogIGNvbnN0IHJlbW92ZUdyb3VwTmFtZSA9IChncm91cE5hbWU6IHN0cmluZykgPT4gewogICAgZGVsZXRlTXV0YXRpb24ubXV0YXRlKHsKICAgICAgdGVhbUlkOiB0ZWFtSWQsCiAgICAgIGdyb3VwTmFtZTogZ3JvdXBOYW1lLAogICAgfSk7CiAgfTsKCiAgcmV0dXJuICgKICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGZsZXgtd3JhcCBpdGVtcy1jZW50ZXIgZ2FwLTIgc3BhY2UteC00Ij4KICAgICAge2dyb3VwTmFtZXMubWFwKChuYW1lKSA9PiAoCiAgICAgICAgPEJhZGdlIHZhcmlhbnQ9ImdyYXkiIHNpemU9ImxnIiBrZXk9e25hbWV9IGNsYXNzTmFtZT0ibWluLWgtOCBoLWF1dG8gcHktMiI+CiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBtaW4tdy0wIGl0ZW1zLWNlbnRlciBnYXAtMiI+CiAgICAgICAgICAgIDxwIGNsYXNzTmFtZT0ibWluLXctMCB3cmFwLWJyZWFrLXdvcmQiPntuYW1lfTwvcD4KICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImhvdmVyOmJnLWVtcGhhc2lzIHNocmluay0wIHJvdW5kZWQgcC0xIj4KICAgICAgICAgICAgICA8SWNvbiBuYW1lPSJ4IiBjbGFzc05hbWU9ImgtNCB3LTQgc3Ryb2tlLVszcHhdIiBvbkNsaWNrPXsoKSA9PiByZW1vdmVHcm91cE5hbWUobmFtZSl9IC8+CiAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9CYWRnZT4KICAgICAgKSl9CiAgICAgIDxCYWRnZQogICAgICAgIHZhcmlhbnQ9ImdyYXkiCiAgICAgICAgc2l6ZT0ibGciCiAgICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzKCFzaG93VGV4dElucHV0ICYmICJob3ZlcjpiZy1lbXBoYXNpcyIsICJtaW4taC04IGgtYXV0byBweS0yIil9PgogICAgICAgIDxkaXYKICAgICAgICAgIGNsYXNzTmFtZT0iZmxleCBpdGVtcy1jZW50ZXIgc3BhY2UteC0xIgogICAgICAgICAgb25DbGljaz17KCkgPT4gewogICAgICAgICAgICBpZiAoIXNob3dUZXh0SW5wdXQpIHNldFNob3dUZXh0SW5wdXQodHJ1ZSAgImlubGluZS1zdGFydCI6CiAgICAgICAgICAib3JkZXItZmlyc3QgcGwtMyBoYXMtWz5idXR0b25dOm1sLVstMC40NXJlbV0gaGFzLVs+a2JkXTptbC1bLTAuMzVyZW1dIiwKICAgICAgICAiaW5saW5lLWVuZCI6CiAgICAgICAgICAib3JkZXItbGFzdCBwci0zIGhhcy1bPmJ1dHRvbl06bXItWy0wLjRyZW1dIGhhcy1bPmtiZF06bXItWy0wLjM1cmVtXSIsCiAgICAgICAgImJsb2NrLXN0YXJ0IjoKICAgICAgICAgICJbLmJvcmRlci1iXTpwYi0zIG9yZGVyLWZpcnN0IHctZnVsbCBqdXN0aWZ5LXN0YXJ0IHB4LTMgcHQtMyBncm91cC1oYXMtWz5pbnB1dF0vaW5wdXQtZ3JvdXA6cHQtMi41IiwKICAgICAgICAiYmxvY2stZW5kIjoKICAgICAgICAgICJbLmJvcmRlci10XTpwdC0zIG9yZGVyLWxhc3Qgdy1mdWxsIGp1c3RpZnktc3RhcnQgcHgtMyBwYi0zIGdyb3VwLWhhcy1bPmlucHV0XS9pbnB1dC1ncm91cDpwYi0yLjUiLAogICAgICB9LAogICAgfSwKICAgIGRlZmF1bHRWYXJpYW50czogewogICAgICBhbGlnbjogImlubGluZS1zdGFydCIsCiAgICB9LAogIH0KKQoKZnVuY3Rpb24gSW5wdXRHcm91cEFkZG9uKHsKICBjbGFzc05hbWUsCiAgYWxpZ24gPSAiaW5saW5lLXN0YXJ0IiwKICAuLi5wcm9wcwp9OiBSZWFjdC5Db21wb25lbnRQcm9wczwiZGl2Ij4gJiBWYXJpYW50UHJvcHM8dHlwZW9mIGlucHV0R3JvdXBBZGRvblZhcmlhbnRzPikgewogIHJldHVybiAoCiAgICA8ZGl2CiAgICAgIHJvbGU9Imdyb3VwIgogICAgICBkYXRhLXNsb3Q9ImlucHV0LWdyb3VwLWFkZG9uIgogICAgICBkYXRhLWFsaWduPXthbGlnbn0KICAgICAgY2xhc3NOYW1lPXtjbihpbnB1dEdyb3VwQWRkb25WYXJpYW50cyh7IGFsaWduIH0pLCBjbGFzc05hbWUpfQogICAgICBvbkNsaWNrPXsoZSkgPT4gewogICAgICAgIGlmICgoZS50YXJnZXQgYXMgSFRNTEVsZW1lbnQpLmNsb3Nlc3QoImJ1dHRvbiIpKSB7CiAgICAgICAgICByZXR1cm4KICAgICAgICB9CiAgICAgICAgZS5jdXJyZW50VGFyZ2V0LnBhcmVudEVsZW1lbnQ/LnF1ZXJ5U2VsZWN0b3IoImlucHV0Iik/LmZvY3VzKCkKICAgICAgfX0KICAgICAgey4uLnByb3BzfQogICAgLz4KICApCn0KCmNvbnN0IGlucHV0R3JvdXBCdXR0b25WYXJpYW50cyA9IGN2YSgKICAiZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgdGV4dC1zbSBzaGFkb3ctbm9uZSIsCiAgewogICAgdmFyaWFudHM6IHsKICAgICAgc2l6ZTogewogICAgICAgIHhzOiAiaC02IGdhcC0xIHJvdW5kZWQtW2NhbGModmFyKC0tcmFkaXVzKS01cHgpXSBweC0yIGhhcy1bPnN2Z106cHgtMiBbJj5zdmc6bm90KFtjbGFzcyo9J3NpemUtJ10pXTpzaXplLTMuNSIsCiAgICAgICAgc206ICJoLTggZ2FwLTEuNSByb3VuZGVkLW1kIHB4LTIuNSBoYXMtWz5zdmddOnB4LTIuNSIsCiAgICAgICAgImljb24teHMiOgogICAgICAgICAgInNpemUtNiByb3VuZGVkLVtjYWxjKHZhcigtLXJhZGl1cyktNXB4KV0gcC0wIGhhcy1bPnN2Z106cC0wIiwKICAgICAgICAiaWNvbi1zbSI6ICJzaXplLTggcC0wIGhhcy1bPnN2Z106cC0wIiwKICAgICAgfSwKICAgIH0sCiAgICBkZWZhdWx0VmFyaWFudHM6IHsKICAgICAgc2l6ZTogInhzIiwKICAgIH0sCiAgfQopCgpmdW5jdGlvbiBJbnB1dEdyb3VwQnV0dG9uKHsKICBjbGFzc05hbWUsCiAgdHlwZSA9ICJidXR0b24iLAogIHZhcmlhbnQgPSAiZ2hvc3QiLAogIHNpemUgPSAieHMiLAogIC4uLnByb3BzCn06IE9taXQ8UmVhY3QuQ29tcG9uZW50UHJvcHM8dHlwZW9mIEJ1dHRvbj4sICJzaXplIj4gJgogIFZhcmlhbnRQcm9wczx0eXBlb2YgaW5wdXRHcm91cEJ1dHRvblZhcmlhbnRzPikgewogIHJldHVybiAoCiAgICA8QnV0dG9uCiAgICAgIHR5cGU9e3R5cGV9CiAgICAgIGRhdGEtc2l6ZT17c2l6ZX0KICAgICAgdmFyaWFudD17dmFyaWFudH0KICAgICAgY2xhc3NOYW1lPXtjbihpbnB1dEdyb3VwQnV0dG9uVmFyaWFudHMoeyBzaXplIH0pLCBuPXtyb3V0aW5nUmVhc29ufQogICAgICAgICAgICAgICAgbm9Sb3V0aW5nUmVhc29uVGV4dD17dCgibm9fcm91dGluZ19yZWFzb24iKX0KICAgICAgICAgICAgICAgIHJvdXRpbmdSZWFzb25MYWJlbD17dCgicm91dGluZ19yZWFzb24iKX0KICAgICAgICAgICAgICAgIGd1ZXN0RW1haWw9e2d1ZXN0RW1haWx9CiAgICAgICAgICAgICAgICB3aG9Cb29rZWRJdExhYmVsPXt0KCJ3aG9fYm9va2VkX2l0Iil9CiAgICAgICAgICAgICAgICBob3N0RW1haWw9e2hvc3RFbWFpbH0KICAgICAgICAgICAgICAgIGhvc3ROYW1lPXtob3N0TmFtZX0KICAgICAgICAgICAgICAgIHdob1JlY2VpdmVkSXRMYWJlbD17dCgid2hvX3JlY2VpdmVkX2l0Iil9CiAgICAgICAgICAgICAgICBjb3B5VG9DbGlwYm9hcmQ9e2NvcHlUb0NsaXBib2FyZH0KICAgICAgICAgICAgICAgIGlzQ29waWVkPXtpc0NvcGllZH0KICAgICAgICAgICAgICAvPgoKICAgICAgICAgICAgICA8QXNzaWduZWVTZWN0aW9uCiAgICAgICAgICAgICAgICB0ZWFtSWQ9e3RlYW1JZH0KICAgICAgICAgICAgICAgIHRlYW1NZW1iZXJPcHRpb25zPXt0ZWFtTWVtYmVyT3B0aW9uc30KICAgICAgICAgICAgICAgIGNvbnRyb2w9e2NvbnRyb2x9CiAgICAgICAgICAgICAgICB3aG9TaG91bGRIYXZlUmVjZWl2ZWRJdExhYmVsPXt0KCJ3aG9fc2hvdWxkX2hhdmVfcmVjZWl2ZWRfaXQiKX0KICAgICAgICAgICAgICAgIG9wdGlvbmFsTGFiZWw9e3QoIm9wdGlvbmFsIil9CiAgICAgICAgICAgICAgICBzZWxlY3RUZWFtTWVtYmVyUGxhY2Vob2xkZXI9e3QoInNlbGVjdF90ZWFtX21lbWJlciIpfQogICAgICAgICAgICAgICAgZW50ZXJFbWFpbFBsYWNlaG9sZGVyPXt0KCJlbnRlcl9lbWFpbCIpfQogICAgICAgICAgICAgIC8+CgogICAgICAgICAgICAgIDxBZGRpdGlvbmFsTm90ZXNTZWN0aW9uCiAgICAgICAgICAgICAgICBjb250cm9sPXtjb250cm9sfQogICAgICAgICAgICAgICAgYWRkaXRpb25hbE5vdGVzTGFiZWw9e3QoImFkZGl0aW9uYWxfbm90ZXMiKX0KICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPXt0KCJ3cm9uZ19hc3NpZ25tZW50X25vdGVzX3BsYWNlaG9sZGVyIil9CiAgICAgICAgICAgICAgICBmaWVsZFJlcXVpcmVkVGV4dD17dCgiZmllbGRfcmVxdWlyZWQiKX0KICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZT17ZXJyb3JzLmFkZGl0aW9uYWxOb3Rlcz8ubWVzc2FnZX0KICAgICAgICAgICAgICAvPgoKICAgICAgICAgICAgICA8QWxlcnQgc2V2ZXJpdHk9ImluZm8iIHRpdGxlPXt0KCJkaWRfeW91X2tub3ciKX0gbWVzc2FnZT17dCgid3JvbmdfYXNzaWdubWVudF9jcm1faW5mbyIpfSAvPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDwvZGl2PgoKICAgICAgICAgIDxEaWFsb2dGb290ZXIgc2hvd0RpdmlkZXIgY2xhc3NOYW1lPSJtdC04Ij4KICAgICAgICAgICAgPEJ1dHRvbiB0eXBlPSJidXR0b24iIGNvbG9yPSJzZWNvbmRhcnkiIG9uQ2xpY2s9e2hhbmRsZUNsb3NlQ2xpY2t9IGRpc2FibGVkPXtpc1BlbmRpbmd9PgogICAgICAgICAgICAgIHt0KCJjbG9zZSIpfQogICAgICAgICAgICA8L0J1dHRvbj4KICAgICAgICAgICAgPEJ1dHRvbiB0eXBlPSJzdWJtaXQiIGNvbG9yPSJwcmltYXJ5IiBkaXNhYmxlZD17aXNQZW5kaW5nfSBsb2FkaW5nPXtpc1BlbmRpbmd9PgogICAgICAgICAgICAgIHt0KCJzdWJtaXQiKX0KICAgICAgICAgICAgPC9CdXR0b24+CiAgICAgICAgICA8L0RpYWxvZ0Zvb3Rlcj4KICAgICAgICA8L2Zvcm0+CiAgICAgIDwvRGlhbG9nQ29udGVudD4KICAgIDwvRGlhbG9nPgogICk7Cn0KaW1wb3J0IHsgR3JhcGhRTEFwaSB9IGZyb20gJ0B1bml2ZXJzZS9hcGknCmltcG9ydCB7IHVzZUNoYXJ0UHJpY2VTdGF0ZSB9IGZyb20gJ2NvbXBvbmVudHMvQ2hhcnRzL0QzTGlxdWlkaXR5UmFuZ2VJbnB1dC9EM0xpcXVpZGl0eVJhbmdlQ2hhcnQvc3RvcmUvc2VsZWN0b3JzL3ByaWNlU2VscDogNDA4LCBtb2JpbGU6IDQ1MCB9LAogIHsgZGF0ZTogIjIwMjQtMDYtMjEiLCBkZXNrdG9wOiAxNjksIG1vYmlsZTogMjEwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNi0yMiIsIGRlc2t0b3A6IDMxNywgbW9iaWxlOiAyNzAgfSwKICB7IGRhdGU6ICIyMDI0LTA2LTIzIiwgZGVza3RvcDogNDgwLCBtb2JpbGU6IDUzMCB9LAogIHsgZGF0ZTogIjIwMjQtMDYtMjQiLCBkZXNrdG9wOiAxMzIsIG1vYmlsZTogMTgwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNi0yNSIsIGRlc2t0b3A6IDE0MSwgbW9iaWxlOiAxOTAgfSwKICB7IGRhdGU6ICIyMDI0LTA2LTI2IiwgZGVza3RvcDogNDM0LCBtb2JpbGU6IDM4MCB9LAogIHsgZGF0ZTogIjIwMjQtMDYtMjciLCBkZXNrdG9wOiA0NDgsIG1vYmlsZTogNDkwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNi0yOCIsIGRlc2t0b3A6IDE0OSwgbW9iaWxlOiAyMDAgfSwKICB7IGRhdGU6ICIyMDI0LTA2LTI5IiwgZGVza3RvcDogMTAzLCBtb2JpbGU6IDE2MCB9LAogIHsgZGF0ZTogIjIwMjQtMDYtMzAiLCBkZXNrdG9wOiA0NDYsIG1vYmlsZTogNDAwIH0sCl0KCmNvbnN0IGNoYXJ0Q29uZmlnID0gewogIHZpZXdzOiB7CiAgICBsYWJlbDogIlBhZ2UgVmlld3MiLAogIH0sCiAgZGVza3RvcDogewogICAgbGFiZWw6ICJEZXNrdG9wIiwKICAgIGNvbG9yOiAiaHNsKHZhcigtLWNoYXJ0LTEpKSIsCiAgfSwKICBtb2JpbGU6IHsKICAgIGxhYmVsOiAiTW9iaWxlIiwKICAgIGNvbG9yOiAiaHNsKHZhcigtLWNoYXJ0LTIpKSIsCiAgfSwKfSBzYXRpc2ZpZXMgQ2hhcnRDb25maWcKCmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIENvbXBvbmVudCgpIHsKICBjb25zdCBbYWN0aXZlQ2hhcnQsIHNldEFjdGl2ZUNoYXJ0XSA9CiAgICBSZWFjdC51c2VTdGF0ZTxrZXlvZiB0eXBlb2YgY2hhcnRDb25maWc+KCJkZXNrdG9wIikKCiAgY29uc3QgdG90YWwgPSBSZWFjdC51c2VNZW1vKAogICAgKCkgPT4gKHsKICAgICAgZGVza3RvcDogY2hhcnREYXRhLnJlZHVjZSgoYWNjLCBjdXJyKSA9PiBhY2MgKyBjdXJyLmRlc2t0b3AsIDApLAogICAgICBtb2JpbGU6IGNoYXJ0RGF0YS5yZWR1Y2UoKGFjYywgY3VycikgPT4gYWNjICsgY3Vyci5tb2JpbGUsIDApLAogICAgfSksCiAgICBbXQogICkKCiAgcmV0dXJuICgKICAgIDxDYXJkPgogICAgICA8Q2FyZEhlYWRlciBjbGFzc05hbWU9ImZsZXggZmxleC1jb2wgaXRlbXMtc3RyZXRjaCBzcGFjZS15LTAgYm9yZGVyLWIgcC0wIHNtOmZsZXgtcm93Ij4KICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBmbGV4LTEgZmxleC1jb2wganVzdGlmeS1jZW50ZXIgZ2FwLTEgcHgtNiBweS01IHNtOnB5LTYiPgogICAgICAgICAgPENhcmRUaXRsZT5MaW5lIENoYXJ0IC0gSW50ZXJhY3RpdmU8L0NhcmRUaXRsZT4KICAgICAgICAgIDxDYXJkRGVzY3JpcHRpb24+CiAgICAgICAgICAgIFNob3dpbmcgdG90YWwgdmlzaXRvcnMgZm9yIHRoZSBsYXN0IDMgbW9udGhzCiAgICAgICAgICA8L0NhcmREZXNjcmlwdGlvbj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCI+CiAgICAgICAgICB7WyJkZXNrdG9wIiwgIm1vYmlsZSJdLm1hcCgoa2V5KSA9PiB7CiAgICAgICAgICAgIGNvbnN0IGNoYXJ0ID0ga2V5IGFzIGtleW9mIHR5cGVvZiBjaGFydENvbmZpZwogICAgICAgICAgICByZXR1cm4gKAogICAgICAgICAgICAgIDxidXR0b24KICAgICAgICAgICAgICAgIGtleT17Y2hhcnR9CiAgICAgICAgICAgICAgICBkYXRhLWFjdGl2ZT17YWN0aXZlQ2hhcnQgPT09IGNoYXJ0fQogICAgICAgICAgICAgICAgY2xhc3NOYW1lPSJmbGV4IGZsZXgtMSBmbGV4LWNvbCBqdXN0aWZ5LWNlbnRlciBnYXAtMSBib3JkZXItdCBweC02IHB5LTQgdGV4dC1sZWZ0IGV2ZW46Ym9yZGVyLWwgZGF0YS1bYWN0aXZlPXRydWVdOmJnLW11dGVkLzUwIHNtOmJvcmRlci1sIHNtOmJvcmRlci10LTAgc206cHgtOCBzbTpweS02Igoga2VuU2VydmljZS5kZXBvc2l0KHsgc2VuZGVyOiB1c2VyLCBhbW91bnQ6IGFtb3VudFRvU3Rha2UgfSk7CiAgICB9CgogICAgcmV0dXJuIHN0YWtlVHhEYXRhOwogIH07CgogIHJldHVybiAoCiAgICA8VHhBY3Rpb25zV3JhcHBlcgogICAgICByZXF1aXJlc0FwcHJvdmFsPXtyZXF1aXJlc0FwcHJvdmFsfQogICAgICBwcmVwYXJpbmdUcmFuc2FjdGlvbnM9e2xvYWRpbmdUeG5zfQogICAgICBtYWluVHhTdGF0ZT17bWFpblR4U3RhdGV9CiAgICAgIGFwcHJvdmFsVHhTdGF0ZT17YXBwcm92YWxUeFN0YXRlfQogICAgICBpc1dyb25nTmV0d29yaz17aXNXcm9uZ05ldHdvcmt9CiAgICAgIGFtb3VudD17YW1vdW50VG9TdGFrZX0KICAgICAgaGFuZGxlQWN0aW9uPXthY3Rpb259CiAgICAgIGhhbmRsZUFwcHJvdmFsPXthcHByb3ZhbH0KICAgICAgc3ltYm9sPXtzeW1ib2x9CiAgICAgIHJlcXVpcmVzQW1vdW50CiAgICAgIGFjdGlvblRleHQ9ezxUcmFucz5TdGFrZTwvVHJhbnM+fQogICAgICB0cnlQZXJtaXQ9e3Blcm1pdEF2YWlsYWJsZX0KICAgICAgYWN0aW9uSW5Qcm9ncmVzc1RleHQ9ezxUcmFucz5TdGFraW5nPC9UcmFucz59CiAgICAgIHN4PXtzeH0KICAgICAgYmxvY2tlZD17YmxvY2tlZH0KICAgICAgLy8gZXZlbnQ9e1NUQUtFLlNUQUtFX0JVVFRPTl9NT0RBTH0KICAgICAgey4uLnByb3BzfQogICAgLz4KICApOwp9OwoidXNlIGNsaWVudCIKCmltcG9ydCAqIGFzIFJlYWN0IGZyb20gInJlYWN0IgppbXBvcnQgdXNlRW1ibGFDYXJvdXNlbCwgewogIHR5cGUgVXNlRW1ibGFDYXJvdXNlbFR5cGUsCn0gZnJvbSAiZW1ibGEtY2Fyb3VzZWwtcmVhY3QiCmltcG9ydCB7IEFycm93TGVmdCwgQXJyb3dSaWdodCB9IGZyb20gImx1Y2lkZS1yZWFjdCIKCmltcG9ydCB7IGNuIH0gZnJvbSAiQC9saWIvdXRpbHMiCmltcG9ydCB7IEJ1dHRvbiB9IGZyb20gIkAvcmVnaXN0cnkvbmV3LXlvcmsvdWkvYnV0dG9uIgoKdHlwZSBDYXJvdXNlbEFwaSA9IFVzZUVtYmxhQ2Fyb3VzZWxUeXBlWzFdCnR5cGUgVXNlQ2Fyb3VzZWxQYXJhbWV0ZXJzID0gUGFyYW1ldGVyczx0eXBlb2YgdXNlRW1ibGFDYXJvdXNlbD4KdHlwZSBDYXJvdXNlbE9wdGlvbnMgPSBVc2VDYXJvdXNlbFBhcmFtZXRlcnNbMF0KdHlwZSBDYXJvdXNlbFBsdWdpbiA9IFVzZUNhcm91c2VsUGFyYW1ldGVyc1sxXQoKdHlwZSBDYXJvdXNlbFByb3BzID0gewogIG9wdHM/OiBDYXJvdXNlbE9wdGlvbnMKICBwbHVnaW5zPzogQ2Fyb3VzZWxQbHVnaW4KICBvcmllbnRhdGlvbj86ICJob3Jpem9udGFsIiB8ICJ2ZXJ0aWNhbCIKICBzZXRBcGk/OiAoYXBpOiBDYXJvdXNlbEFwaSkgPT4gdm9pZAp9Cgp0eXBlIENhcm91c2VsQ29udGV4dFByb3BzID0gewogIGNhcm91c2VsUmVmOiBSZXR1cm5UeXBlPHR5cGVvZiB1c2VFbWJsYUNhcm91c2VsPlswXQogIGFwaTogUmV0dXJuVHlwZTx0eXBlb2YgdXNlRW1ibGFDYXJvdXNlbD5bMV0KICBzY3JvbGxQcmV2OiAoKSA9PiB2b2lkCiAgc2Nyb2xsTmV4dDogKCkgPT4gdm9pZAogIGNhblNjcm9sbFByZXY6IGJvb2xlYW4KICBjYW5TY3JvbGxOZXh0OiBib29sZWFuCn0gJiBDYXJvdXNlbFByb3BzCgpjb25zdCBDYXJvdXNlbENvbnRleHQgPSBSZWFjdC5jcmVhdGVDb250ZXh0PENhcm91c2VsQ29udGV4dFByb3BzIHwgbnVsbD4obnVsbCkKCmZ1bmN0aW9uIHVzZUNhcm91c2VsKCkgewogIGNvbnN0IGNvbnRleHQgPSBSZWFjdC51c2VDb250ZXh0KENhcm91c2VsQ29udGV4dCkKCiAgaWYgKCFjb250ZXh0KSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoInVzZUNhcm91c2VsIG11c3QgYmUgdXNlZCB3aXRoaW4gYSA8Q2Fyb3VzZWwgLz4iKQogIH0KCiAgcmV0dXJuIGNvbnRleHQKfQoKY29uc3QgQ2Fyb3VzZWwgPSBSZWFjdC5mb3J3YXJkUmVmPAogIEhUTUxEaXZFbGVtZW50LAogIFJlYWN0LkhUTUxBdHRyaWJ1dGVzPEhUTUxEaXZFbGVtZW50PiAmIENhcm91c2VsUHJvcHMKPigKICAoCiAgZXJsYXlFdmVudHNGb3JEYXRlID0gdXNlTWVtbygoKSA9PiB7CiAgICBjb25zdCBhbGxCb29raW5ncyA9IGJvb2tpbmdzID8/IFtdOwogICAgLy8gc2luY2UgYnVzeSBkYXRlcyBjb21lcyBzdHJhaWdodCBmcm9tIHRoZSBjYWxlbmRhciwgaXQgY29udGFpbnMgc2xvdHMgaGF2ZSBib29raW5ncyBhbmQgYWxzbyBzbG90cyB0aGF0IGFyZSBtYXJrZWQgYXMgYnVzeSBieSB1c2VyIGJ1dCBhcmUgbm90IGJvb2tpbmdzCiAgICAvLyBoZW5jZSB3ZSBmaWx0ZXIgb3ZlcmxheUJ1c3lEYXRlcyB0byBleGNsdWRlIGFueXRoaW5nIHRoYXQgb3ZlcmxhcHMgd2l0aCBib29raW5ncwogICAgY29uc3QgYnVzeUV2ZW50cyA9IGZpbHRlcmVkQnVzeURhdGVzLm1hcCgoYnVzeURhdGEsIGluZGV4KSA9PiAoewogICAgICBpZDogaW5kZXgsCiAgICAgIHRpdGxlOiBgQnVzeWAsCiAgICAgIHN0YXJ0OiBuZXcgRGF0ZShidXN5RGF0YS5zdGFydCksCiAgICAgIGVuZDogbmV3IERhdGUoYnVzeURhdGEuZW5kKSwKICAgICAgb3B0aW9uczogewogICAgICAgIHN0YXR1czogIkFDQ0VQVEVEIiBhcyBCb29raW5nU3RhdHVzLAogICAgICAgICJkYXRhLXRlc3QtaWQiOiAidHJvdWJsZXNob290ZXItYnVzeS1ldmVudCIsCiAgICAgICAgY2xhc3NOYW1lOiAiYm9yZGVyLVsxLjVweF0iLAogICAgICB9LAogICAgfSkpOwoKICAgIGNvbnN0IGJvb2tpbmdFdmVudHMgPSBhbGxCb29raW5ncy5tYXAoKGJvb2tpbmcpID0+ICh7CiAgICAgIGlkOiBib29raW5nLmlkLAogICAgICB0aXRsZTogYm9va2luZy50aXRsZSA/PyBgQnVzeWAsCiAgICAgIHN0YXJ0OiBuZXcgRGF0ZShib29raW5nLnN0YXJ0KSwKICAgICAgZW5kOiBuZXcgRGF0ZShib29raW5nLmVuZCksCiAgICAgIG9wdGlvbnM6IHsKICAgICAgICBzdGF0dXM6IGJvb2tpbmcuc3RhdHVzLnRvVXBwZXJDYXNlKCkgYXMgQm9va2luZ1N0YXR1cywKICAgICAgICAiZGF0YS10ZXN0LWlkIjogInRyb3VibGVzaG9vdGVyLWJ1c3ktZXZlbnQiLAogICAgICAgIGNsYXNzTmFtZTogImJvcmRlci1bMS41cHhdIiwKICAgICAgfSwKICAgIH0pKTsKCiAgICByZXR1cm4gWy4uLmJvb2tpbmdFdmVudHMsIC4uLmJ1c3lFdmVudHNdOwogIH0sIFtib29raW5ncywgZmlsdGVyZWRCdXN5RGF0ZXNdKTsKCiAgcmV0dXJuICgKICAgIDxkaXYgY2xhc3NOYW1lPSJoLWZ1bGwgWy0tY2FsZW5kYXItZGF0ZXMtc3RpY2t5LW9mZnNldDo2NnB4XSI+CiAgICAgIDxDYWxlbmRhcgogICAgICAgIGlzUGVuZGluZz17aXNMb2FkaW5nfQogICAgICAgIGF2YWlsYWJsZVRpbWVzbG90cz17YXZhaWxhYmxlU2xvdHN9CiAgICAgICAgc3RhcnRIb3VyPXswfQogICAgICAgIGVuZEhvdXI9ezIzfQogICAgICAgIGV2ZW50cz17b3ZlcmxheUV2ZW50c0ZvckRhdGV9CiAgICAgICAgc3RhcnREYXRlPXtzdGFydERhdGV9CiAgICAgICAgZW5kRGF0ZT17ZW5kRGF0ZX0KICAgICAgICBncmlkQ2VsbHNQZXJIb3VyPXs2MCAvIGV2ZW50RHVyYXRpb259CiAgICAgICAgaG92ZXJFdmVudER1cmF0aW9uPXtldmVudER1cmF0aW9ufQogICAgICAgIGhpZGVIZWFkZXIKICAgICAgICB0aW1lem9uZT17dGltZXpvbmV9CiAgICAgIC8+CiAgICA8L2Rpdj4KICApOwp9OwoidXNlIGNsaWVudCI7CgppbXBvcnQgQWNjb3VudERpYWxvZyBmcm9tICJAY2FsY29tL2FwcC1zdG9yZS9vZmZpY2UzNjV2aWRlby9jb21wb25lbnRzL0FjY291bnREaWFsb2ciOwppbXBvcnQgeyB1c2VMb2NhbGUgfSBmcm9tICJAY2FsY29tL2xpYi9ob29rcy91c2VMb2NhbGUiOwppbXBvcnQgeyBHT09HTEVfTUVFVCwgT0ZGSUNFXzM2NV9WSURFTywgWk9PTSB9IGZyb20gIkBjYWxjb20vcGxhdGZvcm0tY29uc3RhbnRzIjsKaW1wb3J0IHsgUXVlcnlDZWxsIH0gZnJvbSAiQGNhbGNvbS90cnBjL2NvbXBvbmVudHMvUXVlcnlDZWxsIjsKaW1wb3J0IHR5cGUgeyBBcHAgfSBmcm9tICJAY2FsY29tL3R5cGVzL0FwcCI7CmltbGV4IHBvc2l0aW9uPSJhYnNvbHV0ZSIgbGVmdD0iNjAlIj4KICAgICAgPHN2ZyB3aWR0aD0iOCIgaGVpZ2h0PSI4IiB2aWV3Qm94PSIwIDAgOCA4IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICAgICAgIDxjaXJjbGUgY3g9IjQiIGN5PSI0IiByPSI0IiBmaWxsPXtjb2xvcnMuYWNjZW50MS52YWx9IHN0cm9rZT17Y29sb3JzLnN1cmZhY2UxLnZhbH0gc3Ryb2tlV2lkdGg9IjJweCIgLz4KICAgICAgPC9zdmc+CiAgICA8L0ZsZXg+CiAgKQp9Cgpjb25zdCBEZWVwTGlua0J1dHRvbiA9ICh7IEljb24sIExhYmVsLCBvblByZXNzIH06IHsgSWNvbjogSlNYLkVsZW1lbnQ7IExhYmVsOiBzdHJpbmc7IG9uUHJlc3M6ICgpID0+IHZvaWQgfSkgPT4gewogIHJldHVybiAoCiAgICA8QnV0dG9uIGp1c3RpZnlDb250ZW50PSJmbGV4LXN0YXJ0IiBmaWxsPXtmYWxzZX0gZW1waGFzaXM9InRlcnRpYXJ5IiBvblByZXNzPXtvblByZXNzfT4KICAgICAgPEZsZXggcm93IGFsaWduSXRlbXM9ImZsZXgtc3RhcnQiIGdhcD0iJHNwYWNpbmcxMiI+CiAgICAgICAgPEZsZXggcm93PntJY29ufTwvRmxleD4KICAgICAgICA8QnV0dG9uLlRleHQ+e0xhYmVsfTwvQnV0dG9uLlRleHQ+CiAgICAgIDwvRmxleD4KICAgICAgPEZsZXggcm93IGZsZXhHcm93PXsxfSBqdXN0aWZ5Q29udGVudD0iZmxleC1lbmQiPgogICAgICAgIDxCdXR0b24uSWNvbiB0eXBlT2ZCdXR0b249ImJ1dHRvbiIgZW1waGFzaXM9InRlcnRpYXJ5Ij4KICAgICAgICAgIDxSb3RhdGFibGVDaGV2cm9uIGRpcmVjdGlvbj0icmlnaHQiIC8+CiAgICAgICAgPC9CdXR0b24uSWNvbj4KICAgICAgPC9GbGV4PgogICAgPC9CdXR0b24+CiAgKQp9CgpleHBvcnQgZnVuY3Rpb24gRXh0ZW5zaW9uRGVlcGxpbmtzKHsgYWNjb3VudCB9OiB7IGFjY291bnQ6IHN0cmluZyB9KSB7CiAgY29uc3QgeyB0IH0gPSB1c2VUcmFuc2xhdGlvbigpCiAgY29uc3QgY29sb3JzID0gdXNlU3BvcmVDb2xvcnMoKQogIGNvbnN0IHVuaXN3YXBFeHRlbnNpb25SZXF1ZXN0ID0gdXNlVW5pc3dhcEV4dGVuc2lvblJlcXVlc3QoKQogIGNvbnN0IGFjY291bnREcmF3ZXIgPSB1c2VBY2NvdW50RHJhd2VyKCkKICBjb25zdCBzZXRNZW51ID0gdXNlU2V0TWVudSgpCiAgY29uc3QgeyBvcGVuTGltaXRPcmRlcnMgfSA9IHVzZU9wZW5MaW1pdE9yZGVycyhhY2NvdW50KQoKICBjb25zdCBbYWN0aXZpdHlVbnJlYWQsIHNldEFjdGl2aXR5VW5yZWFkXSA9IHVzZVN0YXRlKGZhbHNlKQogIGNvbnN0IHsgaGFzUGVuZGluZ0FjdGl2aXR5IH0gPSB1c2VQZW5kaW5nQWN0aXZpdHkoKQogIHVzZUVmZmVjdCgoKSA9PiB7CiAgICBpZiAoaGFzUGVuZGluZ0FjdGl2aXR5KSB7CiAgICAgIHNldEFjdGl2aXR5VW5yZWFkKHRydWUpCiAgICB9CiAgfSwgW2hhc1BlbmRpbmdBY3Rpdml0eV0pCgogIGNvbnN0IHsgZGF0YSB9ID0gdXNlR2V0UG9zaXRpb25zUXVlcnkoewogICAgYWRkcmVzczogYWNjb3VudCwKICAgIHBvc2l0aW9uU3RhdHVzZXM6IFtQb3NpdGlvblN0YXR1cy5JTl9SQU5HRSwgUG9zaXRpb25TdGF0dXMuT1VUX09GX1JBTkdFLCBQb3NpdGlvblN0YXR1cy5DTE9TRURdLAogIH0pCgogIGlmICghdW5pc3dhcEV4dGVuc2lvblJlcXVlc3QpIHsKICAgIHJldHVybiBudWxsCiAgfQoKICByZXR1cm4gKAogICAgPEZsZXggZ2FwPSIkc3BhY2luZzgiPgogICAgICA8RGVlcExpbmtCdXR0b24KICAgICAgICBJY29uPXs8SW1hZ2UgaGVpZ2h0PXtpY29uU2l6ZXMuaWNvbjIwfSBzb3VyY2U9e1VOSVNXQVBfTE9HT30gd2lkdGg9e2ljb25TaXplcy5pY29uMjB9IC8+fQogICAgICAgIExhYmVsPXt0KCdleHRlbnNpb24ub3BlbicpfQogICAgICAgIG9uUHJlc3M9eygpID0+IHsKICAgICAgICAgIHVuaXN3YXBFeHRlbnNpb25SZXF1ZXN0KEV4dGVuc2lvblJlcXVlc3RNZXRob2RzLk9QRU5fU0lERUJBUiwgJ1Rva2VucycpCiBydmU/LnN5bWJvbAogICAgICA6IHN0YXRlLmRlc3RpbmF0aW9uUmVzZXJ2ZT8ucmVzZXJ2ZT8uc3ltYm9sOwogICAgcmV0dXJuICgKICAgICAgPFN1cHBseUNhcEJsb2NraW5nRXJyb3Igc3ltYm9sPXtzeW1ib2x9IHN4PXt7IG1iOiAhaXNTd2FwRmxvd1NlbGVjdGVkID8gMCA6IDQsIC4uLnN4IH19IC8+CiAgICApOwogIH0KCiAgcmV0dXJuIG51bGw7Cn07CmltcG9ydCB7IEJlbGxSaW5nLCBDaGVjayB9IGZyb20gImx1Y2lkZS1yZWFjdCIKCmltcG9ydCB7IGNuIH0gZnJvbSAiQC9saWIvdXRpbHMiCmltcG9ydCB7IEJ1dHRvbiB9IGZyb20gIkAvcmVnaXN0cnkvbmV3LXlvcmsvdWkvYnV0dG9uIgppbXBvcnQgewogIENhcmQsCiAgQ2FyZENvbnRlbnQsCiAgQ2FyZERlc2NyaXB0aW9uLAogIENhcmRGb290ZXIsCiAgQ2FyZEhlYWRlciwKICBDYXJkVGl0bGUsCn0gZnJvbSAiQC9yZWdpc3RyeS9uZXcteW9yay91aS9jYXJkIgppbXBvcnQgeyBTd2l0Y2ggfSBmcm9tICJAL3JlZ2lzdHJ5L25ldy15b3JrL3VpL3N3aXRjaCIKCmNvbnN0IG5vdGlmaWNhdGlvbnMgPSBbCiAgewogICAgdGl0bGU6ICJZb3VyIGNhbGwgaGFzIGJlZW4gY29uZmlybWVkLiIsCiAgICBkZXNjcmlwdGlvbjogIjEgaG91ciBhZ28iLAogIH0sCiAgewogICAgdGl0bGU6ICJZb3UgaGF2ZSBhIG5ldyBtZXNzYWdlISIsCiAgICBkZXNjcmlwdGlvbjogIjEgaG91ciBhZ28iLAogIH0sCiAgewogICAgdGl0bGU6ICJZb3VyIHN1YnNjcmlwdGlvbiBpcyBleHBpcmluZyBzb29uISIsCiAgICBkZXNjcmlwdGlvbjogIjIgaG91cnMgYWdvIiwKICB9LApdCgp0eXBlIENhcmRQcm9wcyA9IFJlYWN0LkNvbXBvbmVudFByb3BzPHR5cGVvZiBDYXJkPgoKZXhwb3J0IGZ1bmN0aW9uIENhcmREZW1vKHsgY2xhc3NOYW1lLCAuLi5wcm9wcyB9OiBDYXJkUHJvcHMpIHsKICByZXR1cm4gKAogICAgPENhcmQgY2xhc3NOYW1lPXtjbigidy1bMzgwcHhdIiwgY2xhc3NOYW1lKX0gey4uLnByb3BzfT4KICAgICAgPENhcmRIZWFkZXI+CiAgICAgICAgPENhcmRUaXRsZT5Ob3RpZmljYXRpb25zPC9DYXJkVGl0bGU+CiAgICAgICAgPENhcmREZXNjcmlwdGlvbj5Zb3UgaGF2ZSAzIHVucmVhZCBtZXNzYWdlcy48L0NhcmREZXNjcmlwdGlvbj4KICAgICAgPC9DYXJkSGVhZGVyPgogICAgICA8Q2FyZENvbnRlbnQgY2xhc3NOYW1lPSJncmlkIGdhcC00Ij4KICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iIGZsZXggaXRlbXMtY2VudGVyIHNwYWNlLXgtNCByb3VuZGVkLW1kIGJvcmRlciBwLTQiPgogICAgICAgICAgPEJlbGxSaW5nIC8+CiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleC0xIHNwYWNlLXktMSI+CiAgICAgICAgICAgIDxwIGNsYXNzTmFtZT0idGV4dC1zbSBmb250LW1lZGl1bSBsZWFkaW5nLW5vbmUiPgogICAgICAgICAgICAgIFB1c2ggTm90aWZpY2F0aW9ucwogICAgICAgICAgICA8L3A+CiAgICAgICAgICAgIDxwIGNsYXNzTmFtZT0idGV4dC1zbSB0ZXh0LW11dGVkLWZvcmVncm91bmQiPgogICAgICAgICAgICAgIFNlbmQgbm90aWZpY2F0aW9ucyB0byBkZXZpY2UuCiAgICAgICAgICAgIDwvcD4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPFN3aXRjaCAvPgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXY+CiAgICAgICAgICB7bm90aWZpY2F0aW9ucy5tYXAoKG5vdGlmaWNhdGlvbiwgaW5kZXgpID0+ICgKICAgICAgICAgICAgPGRpdgogICAgICAgICAgICAgIGtleT17aW5kZXh9CiAgICAgICAgICAgICAgY2xhc3NOYW1lPSJtYi00IGdyaWQgZ3JpZC1jb2xzLVsyNXB4XzFmcl0gaXRlbXMtc3RhcnQgcGItNCBsYXN0Om1iLTAgbGFzdDpwYi0wIgogICAgICAgICAgICA+CiAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSJmbGV4IGgtMiB3LTIgdHJhbnNsYXRlLXktMSByb3VuZGVkLWZ1bGwgYmctc2t5LTUwMCIgLz4KICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ic3BhbGluZT0iQ3JlYXRlIHlvdXIgZmlyc3QgZXZlbnQgdHlwZSIKICAgICAgICAgICAgZGVzY3JpcHRpb249IkV2ZW50IHR5cGVzIGVuYWJsZSB5b3UgdG8gc2hhcmUgbGlua3MgdGhhdCBzaG93IGF2YWlsYWJsZSB0aW1lcyBvbiB5b3VyIGNhbGVuZGFyIGFuZCBhbGxvdyBwZW9wbGUgdG8gbWFrZSBib29raW5ncyB3aXRoIHlvdS4iCiAgICAgICAgICAgIGJ1dHRvblRleHQ9Ik5ldyIKICAgICAgICAgICAgb25CdXR0b25QcmVzcz17aGFuZGxlT3BlbkNyZWF0ZU1vZGFsfQogICAgICAgICAgLz4KICAgICAgICA8L1ZpZXc+CiAgICAgIDwvPgogICAgKTsKICB9CgogIHJldHVybiAoCiAgICA8PgogICAgICB7LyogaU9TIE5hdGl2ZSBIZWFkZXIgd2l0aCBHbGFzcyBVSSAqL30KICAgICAgPFN0YWNrLkhlYWRlcgogICAgICAgIHN0eWxlPXt7IGJhY2tncm91bmRDb2xvcjogInRyYW5zcGFyZW50Iiwgc2hhZG93Q29sb3I6ICJ0cmFuc3BhcmVudCIgfX0KICAgICAgICBibHVyRWZmZWN0PXtpc0xpcXVpZEdsYXNzQXZhaWxhYmxlKCkgPyB1bmRlZmluZWQgOiBpc0RhcmsgPyAiZGFyayIgOiAibGlnaHQifQogICAgICA+CiAgICAgICAgPFN0YWNrLkhlYWRlci5UaXRsZSBsYXJnZT5FdmVudCBUeXBlczwvU3RhY2suSGVhZGVyLlRpdGxlPgoKICAgICAgICA8U3RhY2suSGVhZGVyLlJpZ2h0PgogICAgICAgICAgey8qIEZpbHRlci9Tb3J0IE1lbnUgKi99CiAgICAgICAgICA8U3RhY2suSGVhZGVyLk1lbnU+CiAgICAgICAgICAgIDxTdGFjay5IZWFkZXIuSWNvbiBzZj0ibGluZS4zLmhvcml6b250YWwuZGVjcmVhc2UiIC8+CgogICAgICAgICAgICB7LyogU29ydCBieSBTdWJtZW51IC0gb3BlbnMgYXMgc2VwYXJhdGUgc3VibWVudSAqL30KICAgICAgICAgICAgPFN0YWNrLkhlYWRlci5NZW51IHRpdGxlPSJTb3J0IGJ5Ij4KICAgICAgICAgICAgICA8U3RhY2suSGVhZGVyLk1lbnVBY3Rpb24KICAgICAgICAgICAgICAgIGljb249e3NvcnRCeSA9PT0gImFscGhhYmV0aWNhbCIgPyAiY2hlY2ttYXJrLmNpcmNsZS5maWxsIiA6ICJ0ZXh0Zm9ybWF0LmFiYyJ9CiAgICAgICAgICAgICAgICBvblByZXNzPXsoKSA9PiBoYW5kbGVTb3J0QnlPcHRpb24oImFscGhhYmV0aWNhbCIpfQogICAgICAgICAgICAgID4KICAgICAgICAgICAgICAgIEFscGhhYmV0aWNhbAogICAgICAgICAgICAgIDwvU3RhY2suSGVhZGVyLk1lbnVBY3Rpb24+CiAgICAgICAgICAgICAgPFN0YWNrLkhlYWRlci5NZW51QWN0aW9uCiAgICAgICAgICAgICAgICBpY29uPXtzb3J0QnkgPT09ICJuZXdlc3QiID8gImNoZWNrbWFyay5jaXJjbGUuZmlsbCIgOiAiY2FsZW5kYXIuYmFkZ2UuY2xvY2sifQogICAgICAgICAgICAgICAgb25QcmVzcz17KCkgPT4gaGFuZGxlU29ydEJ5T3B0aW9uKCJuZXdlc3QiKX0KICAgICAgICAgICAgICA+CiAgICAgICAgICAgICAgICBOZXdlc3QgRmlyc3QKICAgICAgICAgICAgICA8L1N0YWNrLkhlYWRlci5NZW51QWN0aW9uPgogICAgICAgICAgICAgIDxTdGFjay5IZWFkZXIuTWVudUFjdGlvbgogICAgICAgICAgICAgICAgaWNvbj17c29ydEJ5ID09PSAiZHVyYXRpb24iID8gImNoZWNrbWFyay5jaXJjbGUuZmlsbCIgOiAiY2xvY2sifQogICAgICAgICAgICAgICAgb25QcmVzcz17KCkgPT4gaGFuZGxlU29ydEJ5T3B0aW9uKCJkdXJhdGlvbiIpfQogICAgICAgICAgICAgID4KICAgICAgICAgICAgICAgIEJ5IER1cmF0aW9uCiAgICAgICAgICAgICAgPC9TdGFjay5IZWFkZXIuTWVudUFjdGlvbj4KICAgICAgICAgICAgPC9TdGFjay5IZWFkZXIuTWVudT4KCiAgICAgICAgICAgIHsvKiBGaWx0ZXIgU3VibWVudSAtIG11bHRpLXNlbGVjdCB0b2dnbGVzICovfQogICAgICAgICAgICA8U3RhY2suSGVhZGVyLk1lbnUKICAgICAgICAgICAgICB0aXRsZT17YEZpbHRlciR7YWN0aXZlRmlsdGVyQ291bnQgPiAwID8gYCAoJHthY3RpdmVGaWx0ZXJDb3VudH0pYCA6ICIifWB9CiBvbGlkIHJnYmEoMCwgMCwgMCwgMC4wMikiLAogICAgICBiYWNrZ3JvdW5kOiAicmdiYSgxMjMsIDIwMywgMTk3LCAwLjEwKSIsCiAgICB9fT4KICAgIDxtb3Rpb24uZGl2CiAgICAgIGNsYXNzTmFtZT0icm91bmRlZC1mdWxsIgogICAgICBzdHlsZT17ewogICAgICAgIHBhZGRpbmc6ICI2cHgiLAogICAgICAgIGJvcmRlcjogIjAuNnB4IHNvbGlkIHJnYmEoMCwgMCwgMCwgMC4wNCkiLAogICAgICAgIGJhY2tncm91bmQ6ICJyZ2JhKDEyMywgMjAzLCAxOTcsIDAuMTYpIiwKICAgICAgfX0KICAgICAgYW5pbWF0ZT17eyBzY2FsZTogWzEsIDEuMSwgMV0gfX0gLy8gRGVmaW5lIHRoZSBwdWxzaW5nIGFuaW1hdGlvbiBmb3IgdGhlIHNlY29uZCByaW5nCiAgICAgIHRyYW5zaXRpb249e3sKICAgICAgICBkdXJhdGlvbjogMS41LAogICAgICAgIHJlcGVhdDogSW5maW5pdHksCiAgICAgICAgcmVwZWF0VHlwZTogInJldmVyc2UiLAogICAgICAgIGRlbGF5OiAwLjIsIC8vIERlbGF5IHRoZSBzdGFydCBvZiBhbmltYXRpb24gZm9yIHRoZSBzZWNvbmQgcmluZwogICAgICB9fT4KICAgICAgPG1vdGlvbi5kaXYKICAgICAgICBjbGFzc05hbWU9InJvdW5kZWQtZnVsbCBwLTMiCiAgICAgICAgc3R5bGU9e3sKICAgICAgICAgIGJvcmRlcjogIjFweCBzb2xpZCByZ2JhKDI1NSwgMjU1LCAyNTUsIDAuNDApIiwKICAgICAgICAgIGJhY2tncm91bmQ6ICJsaW5lYXItZ3JhZGllbnQoMTgwZGVnLCAjNjZDOUNGIDAlLCAjOUNDQ0IyIDEwMCUpIiwKICAgICAgICB9fT4KICAgICAgICA8c3ZnIHdpZHRoPSIyNCIgaGVpZ2h0PSIyNCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgogICAgICAgICAgPHBhdGgKICAgICAgICAgICAgZD0iTTIuNjkxODUgMTAuNjkxOUwyLjkyOTcgMTAuOTI5N0wyLjY5MTg1IDEwLjY5MTlDMS45NjkzOCAxMS40MTQzIDEuOTY5MzggMTIuNTg1NyAyLjY5MTg1IDEzLjMwODFMNy42OTE4NSAxOC4zMDgxQzguNDE0MzIgMTkuMDMwNiA5LjU4NTY4IDE5LjAzMDYgMTAuMzA4MSAxOC4zMDgxTDIxLjMwODEgNy4zMDgxNUMyMi4wMzA2IDYuNTg1NjggMjIuMDMwNiA1LjQxNDMyIDIxLjMwODEgNC42OTE4NUMyMC41ODU3IDMuOTY5MzggMTkuNDE0MyAzLjk2OTM4IDE4LjY5MTkgNC42OTE4NUw5IDE0LjM4MzdMNS4zMDgxNSAxMC42OTE5QzQuNTg1NjggOS45NjkzOCAzLjQxNDMyIDkuOTY5MzggMi42OTE4NSAxMC42OTE5WiIKICAgICAgICAgICAgZmlsbD0id2hpdGUiCiAgICAgICAgICAgIHN0cm9rZT0iIzQ4QkFBRSIKICAgICAgICAgICAgc3Ryb2tlV2lkdGg9IjAuNyIKICAgICAgICAgICAgc3Ryb2tlTGluZWNhcD0icm91bmQiCiAgICAgICAgICAgIHN0cm9rZUxpbmVqb2luPSJyb3VuZCIKICAgICAgICAgIC8+CiAgICAgICAgPC9zdmc+CiAgICAgIDwvbW90aW9uLmRpdj4KICAgIDwvbW90aW9uLmRpdj4KICA8L2Rpdj4KKTsKCmNvbnN0IE1haWxPcGVuSWNvbiA9ICgpID0+ICgKICA8ZGl2IGNsYXNzTmFtZT0iYmctZGVmYXVsdCByb3VuZGVkLWZ1bGwgcC0zIj4KICAgIDxJY29uIG5hbWU9Im1haWwtb3BlbiIgY2xhc3NOYW1lPSJ0ZXh0LWVtcGhhc2lzIGgtMTIgdy0xMiBzaHJpbmstMCBwLTAuNSBmb250LWV4dHJhbGlnaHQiIC8+CiAgPC9kaXY+Cik7CgpleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBWZXJpZnkoeyBFTUFJTF9GUk9NIH06IHsgRU1BSUxfRlJPTT86IHN0cmluZyB9KSB7CiAgY29uc3Qgc2VhcmNoUGFyYW1zID0gdXNlQ29tcGF0U2VhcmNoUGFyYW1zKCk7CiAgY29uc3QgcGF0aG5hbWUgPSB1c2VQYXRobmFtZSgpOwogIGNvbnN0IHJvdXRlciA9IHVzZVJvdXRlcigpOwogIGNvbnN0IHJvdXRlclF1ZXJ5ID0gdXNlUm91dGVyUXVlcnkoKTsKICBjb25zdCB7IGVtYWlsLCB1c2VybmFtZSwgcGF5bWVudFN0YXR1cyB9ID0gcXVlcnlTY2hlbWEucGFyc2Uocm91dGVyUXVlcnkpbWU6ICJPbGl2aWEgV2lsc29uIiwKICAgICAgZW1haWw6ICJvbGl2aWF3aWxzb25AZXhhbXBsZS5jb20iLAogICAgICBzdWJqZWN0OiAiVmFjYXRpb24gUGxhbnMiLAogICAgICBkYXRlOiAiMSB3ZWVrIGFnbyIsCiAgICAgIHRlYXNlcjoKICAgICAgICAiSnVzdCBhIGhlYWRzIHVwIHRoYXQgSSdsbCBiZSB0YWtpbmcgYSB0d28td2VlayB2YWNhdGlvbiBuZXh0IG1vbnRoLlxuSSdsbCBtYWtlIHN1cmUgYWxsIG15IHByb2plY3RzIGFyZSB1cCB0byBkYXRlIGJlZm9yZSBJIGxlYXZlLiIsCiAgICB9LAogICAgewogICAgICBuYW1lOiAiSmFtZXMgTWFydGluIiwKICAgICAgZW1haWw6ICJqYW1lc21hcnRpbkBleGFtcGxlLmNvbSIsCiAgICAgIHN1YmplY3Q6ICJSZTogQ29uZmVyZW5jZSBSZWdpc3RyYXRpb24iLAogICAgICBkYXRlOiAiMSB3ZWVrIGFnbyIsCiAgICAgIHRlYXNlcjoKICAgICAgICAiSSd2ZSBjb21wbGV0ZWQgdGhlIHJlZ2lzdHJhdGlvbiBmb3IgdGhlIHVwY29taW5nIHRlY2ggY29uZmVyZW5jZS5cbkxldCBtZSBrbm93IGlmIHlvdSBuZWVkIGFueSBhZGRpdGlvbmFsIGluZm9ybWF0aW9uIGZyb20gbXkgZW5kLiIsCiAgICB9LAogICAgewogICAgICBuYW1lOiAiU29waGlhIFdoaXRlIiwKICAgICAgZW1haWw6ICJzb3BoaWF3aGl0ZUBleGFtcGxlLmNvbSIsCiAgICAgIHN1YmplY3Q6ICJUZWFtIERpbm5lciIsCiAgICAgIGRhdGU6ICIxIHdlZWsgYWdvIiwKICAgICAgdGVhc2VyOgogICAgICAgICJUbyBjZWxlYnJhdGUgb3VyIHJlY2VudCBwcm9qZWN0IHN1Y2Nlc3MsIEknZCBsaWtlIHRvIG9yZ2FuaXplIGEgdGVhbSBkaW5uZXIuXG5BcmUgeW91IGF2YWlsYWJsZSBuZXh0IEZyaWRheSBldmVuaW5nPyBQbGVhc2UgbGV0IG1lIGtub3cgeW91ciBwcmVmZXJlbmNlcy4iLAogICAgfSwKICBdLAp9CgpleHBvcnQgZnVuY3Rpb24gQXBwU2lkZWJhcih7IC4uLnByb3BzIH06IFJlYWN0LkNvbXBvbmVudFByb3BzPHR5cGVvZiBTaWRlYmFyPikgewogIC8vIE5vdGU6IEknbSB1c2luZyBzdGF0ZSB0byBzaG93IGFjdGl2ZSBpdGVtLgogIC8vIElSTCB5b3Ugc2hvdWxkIHVzZSB0aGUgdXJsL3JvdXRlci4KICBjb25zdCBbYWN0aXZlSXRlbSwgc2V0QWN0aXZlSXRlbV0gPSBSZWFjdC51c2VTdGF0ZShkYXRhLm5hdk1haW5bMF0pCiAgY29uc3QgW21haWxzLCBzZXRNYWlsc10gPSBSZWFjdC51c2VTdGF0ZShkYXRhLm1haWxzKQogIGNvbnN0IHsgc2V0T3BlbiB9ID0gdXNlU2lkZWJhcigpCgogIHJldHVybiAoCiAgICA8U2lkZWJhcgogICAgICBjb2xsYXBzaWJsZT0iaWNvbiIKICAgICAgY2xhc3NOYW1lPSJvdmVyZmxvdy1oaWRkZW4gWyY+W2RhdGEtc2lkZWJhcj1zaWRlYmFyXV06ZmxleC1yb3ciCiAgICAgIHsuLi5wcm9wc30KICAgID4KICAgICAgey8qIFRoaXMgaXMgdGhlIGZpcnN0IHNpZGViYXIgKi99CiAgICAgIHsvKiBXZSBkaXNhYmxlIGNvbGxhcHNpYmxlIGFuZCBhZGp1c3Qgd2lkdGggdG8gaWNvbi4gKi99CiAgICAgIHsvKiBUaGlzIHdpbGwgbWFrZSB0aGUgc2lkZWJhciBhcHBlYXIgYXMgaWNvbnMuICovfQogICAgICA8U2lkZWJhcgogICAgICAgIGNvbGxhcHNpYmxlPSJub25lIgogICAgICAgIGNsYXNzTmFtZT0iIXctW2NhbGModmFyKC0tc2lkZWJhci13aWR0aC1pY29uKV8rXzFweCldIGJvcmRlci1yIgogICAgICA+CiAgICAgICAgPFNpZGViYXJIZWFkZXI+CiAgICAgICAgICA8U2lkZWJhck1lbnU+CiAgICAgICAgICAgIDxTaWRlYmFyTWVudUl0ZW0+CiAgICAgICAgICAgICAgPFNpZGViYXJNZW51QnV0dG9uIHNpemU9ImxnIiBhc0NoaWxkIGNsYXNzTmFtZT0ibWQ6aC04IG1kOnAtMCI+CiAgICAgICAgICAgICAgICA8YSBocmVmPSIjIj4KICAgaXQoJ25hdmlnYXRlcyB0byBub3QgZm91bmQgcGFnZSB3aGVuIG5vIGRhdGEgaXMgcmVjZWl2ZWQgZnJvbSBiYWNrZW5kJywgYXN5bmMgKCkgPT4gewogICAgbW9ja2VkKHVzZVBvb2xEYXRhKS5tb2NrUmV0dXJuVmFsdWUoewogICAgICBkYXRhOiB1bmRlZmluZWQsCiAgICAgIGxvYWRpbmc6IGZhbHNlLAogICAgICBlcnJvcjogZmFsc2UsCiAgICB9KQogICAgcmVuZGVyKDxQb29sRGV0YWlscyAvPikKCiAgICBhd2FpdCBhY3QoYXN5bmMgKCkgPT4gewogICAgICBhd2FpdCBuZXcgUHJvbWlzZSgocmVzb2x2ZSkgPT4gc2V0VGltZW91dChyZXNvbHZlLCAxKSkKICAgIH0pCgogICAgYXdhaXQgd2FpdEZvcigoKSA9PiB7CiAgICAgIGV4cGVjdChtb2NrTmF2aWdhdGUpLnRvSGF2ZUJlZW5DYWxsZWRXaXRoKCcvZXhwbG9yZS9wb29scz90eXBlPXBvb2xzJnJlc3VsdD1ub3QtZm91bmQnKQogICAgfSkKICB9KQp9KQoidXNlIGNsaWVudCIKCmltcG9ydCAqIGFzIFJlYWN0IGZyb20gInJlYWN0IgppbXBvcnQgeyBCdXR0b24gfSBmcm9tICJAL2V4YW1wbGVzL2Jhc2UvdWktcnRsL2J1dHRvbiIKaW1wb3J0IHsgQnV0dG9uR3JvdXAgfSBmcm9tICJAL2V4YW1wbGVzL2Jhc2UvdWktcnRsL2J1dHRvbi1ncm91cCIKaW1wb3J0IHsKICBEcm9wZG93bk1lbnUsCiAgRHJvcGRvd25NZW51Q29udGVudCwKICBEcm9wZG93bk1lbnVHcm91cCwKICBEcm9wZG93bk1lbnVJdGVtLAogIERyb3Bkb3duTWVudVJhZGlvR3JvdXAsCiAgRHJvcGRvd25NZW51UmFkaW9JdGVtLAogIERyb3Bkb3duTWVudVNlcGFyYXRvciwKICBEcm9wZG93bk1lbnVTdWIsCiAgRHJvcGRvd25NZW51U3ViQ29udGVudCwKICBEcm9wZG93bk1lbnVTdWJUcmlnZ2VyLAogIERyb3Bkb3duTWVudVRyaWdnZXIsCn0gZnJvbSAiQC9leGFtcGxlcy9iYXNlL3VpLXJ0bC9kcm9wZG93bi1tZW51IgppbXBvcnQgewogIEFyY2hpdmVJY29uLAogIEFycm93TGVmdEljb24sCiAgQ2FsZW5kYXJQbHVzSWNvbiwKICBDbG9ja0ljb24sCiAgTGlzdEZpbHRlckljb24sCiAgTWFpbENoZWNrSWNvbiwKICBNb3JlSG9yaXpvbnRhbEljb24sCiAgVGFnSWNvbiwKICBUcmFzaDJJY29uLAp9IGZyb20gImx1Y2lkZS1yZWFjdCIKCmltcG9ydCB7CiAgdXNlVHJhbnNsYXRpb24sCiAgdHlwZSBUcmFuc2xhdGlvbnMsCn0gZnJvbSAiQC9jb21wb25lbnRzL2xhbmd1YWdlLXNlbGVjdG9yIgoKY29uc3QgdHJhbnNsYXRpb25zOiBUcmFuc2xhdGlvbnMgPSB7CiAgZW46IHsKICAgIGRpcjogImx0ciIsCiAgICB2YWx1ZXM6IHsKICAgICAgYXJjaGl2ZTogIkFyY2hpdmUiLAogICAgICByZXBvcnQ6ICJSZXBvcnQiLAogICAgICBzbm9vemU6ICJTbm9vemUiLAogICAgICBtYXJrQXNSZWFkOiAiTWFyayBhcyBSZWFkIiwKICAgICAgYWRkVG9DYWxlbmRhcjogIkFkZCB0byBDYWxlbmRhciIsCiAgICAgIGFkZFRvTGlzdDogIkFkZCB0byBMaXN0IiwKICAgICAgbGFiZWxBczogIkxhYmVsIEFzLi4uIiwKICAgICAgcGVyc29uYWw6ICJQZXJzb25hbCIsCiAgICAgIHdvcms6ICJXb3JrIiwKICAgICAgb3RoZXI6ICJPdGhlciIsCiAgICAgIHRyYXNoOiAiVHJhc2giLAogICAgfSwKICB9LAogIGFyOiB7CiAgICBkaXI6ICJydGwiLAogICAgdmFsdWVzOiB7CiAgICAgIGFyY2hpdmU6ICLYo9ix2LTZgdipIiwKICAgICAgcmVwb3J0OiAi2KrZgtix2YrYsSIsCiAgICAgIHNub296ZTogItiq2KPYrNmK2YQiLAogICAgICBtYXJrQXNSZWFkOiAi2YjYtti5INi52YTYp9mF2Kkg2YPZhdmC2LHZiNihIiwKICAgICAgYWRkVG9DYWxlbmRhcjogItil2LbYp9mB2Kkg2KXZhNmJINin2YTYqtmC2YjZitmFIiwKICAgICAgYWRkVG9MaXN0OiAi2KXYttin2YHYqSDYpdmE2Ykg2KfZhNmC2KfYptmF2KkiLAogICAgICBsYWJlbEFzOiAi2KrYtdmG2YrZgSDZg9mALi4uIiwKICAgICAgcGVyc29uYWw6ICLYtNiu2LXZiiIsCiAgICAgIHdvcms6ICLYudmF2XRvcmVBcGksIHR5cGUgVXNlQm91bmRTdG9yZSB9IGZyb20gJ3p1c3RhbmQnCgovKioKICogUm91dGVzIGEgbm90aWZpY2F0aW9uIHRvIHRoZSBhcHByb3ByaWF0ZSByZW5kZXJlciBiYXNlZCBvbiBpdHMgc3R5bGUKICogTm90ZTogTE9XRVJfTEVGVF9CQU5ORVIgbm90aWZpY2F0aW9ucyBhcmUgaGFuZGxlZCBzZXBhcmF0ZWx5IGluIE5vdGlmaWNhdGlvbkNvbnRhaW5lcgogKi8KZnVuY3Rpb24gTm90aWZpY2F0aW9uUmVuZGVyZXIoewogIG5vdGlmaWNhdGlvbiwKICBvblJlbmRlckZhaWxlZCwKICBvbk5vdGlmaWNhdGlvbkNsaWNrLAogIG9uTm90aWZpY2F0aW9uU2hvd24sCn06IHsKICBub3RpZmljYXRpb246IEluQXBwTm90aWZpY2F0aW9uCiAgb25SZW5kZXJGYWlsZWQ/OiAoaWQ6IHN0cmluZykgPT4gdm9pZAogIG9uTm90aWZpY2F0aW9uQ2xpY2s/OiAobm90aWZpY2F0aW9uSWQ6IHN0cmluZywgdGFyZ2V0OiBOb3RpZmljYXRpb25DbGlja1RhcmdldCkgPT4gdm9pZAogIG9uTm90aWZpY2F0aW9uU2hvd24/OiAobm90aWZpY2F0aW9uSWQ6IHN0cmluZykgPT4gdm9pZAp9KSB7CiAgY29uc3Qgc3R5bGUgPSBub3RpZmljYXRpb24uY29udGVudD8uc3R5bGUKICBzd2l0Y2ggKHN0eWxlKSB7CiAgICBjYXNlIENvbnRlbnRTdHlsZS5NT0RBTDoKICAgICAgcmV0dXJuICgKICAgICAgICA8TW9kYWxOb3RpZmljYXRpb24KICAgICAgICAgIG5vdGlmaWNhdGlvbj17bm90aWZpY2F0aW9ufQogICAgICAgICAgb25Ob3RpZmljYXRpb25DbGljaz17b25Ob3RpZmljYXRpb25DbGlja30KICAgICAgICAgIG9uTm90aWZpY2F0aW9uU2hvd249e29uTm90aWZpY2F0aW9uU2hvd259CiAgICAgICAgLz4KICAgICAgKQogICAgY2FzZSBDb250ZW50U3R5bGUuTE9XRVJfTEVGVF9CQU5ORVI6CiAgICAgIC8vIExvd2VyIGxlZnQgYmFubmVycyBhcmUgaGFuZGxlZCBieSBTdGFja2VkTG93ZXJMZWZ0QmFubmVycyBpbiBOb3RpZmljYXRpb25Db250YWluZXIKICAgICAgcmV0dXJuIG51bGwKICAgIGRlZmF1bHQ6CiAgICAgIC8vIEhhbmRsZSB1bmtub3duL2ludmFsaWQgbm90aWZpY2F0aW9uIHN0eWxlcwogICAgICAvLyBUaGlzIGhhbmRsZXMgY2FzZXMgd2hlcmUgdGhlIHNlcnZlciBzZW5kcyBzdHJpbmcgZW51bXMgb24gZmlyc3QgcmVxdWVzdCBhbmQgbnVtZXJpYwogICAgICAvLyBlbnVtcyBvbiBzdWJzZXF1ZW50IHJlcXVlc3RzLiBDbGVhbiB1cCB3aXRob3V0IG1hcmtpbmcgYXMgcHJvY2Vzc2VkIHRvIGFsbG93IHJldHJ5LgogICAgICBnZXRMb2dnZXIoKS53YXJuKAogICAgICAgICdOb3RpZmljYXRpb25SZW5kZXJlcicsCiAgICAgICAgJ3JlbmRlck5vdGlmaWNhdGlvbicsCiAgICAgICAgYFVua25vd24gbm90aWZpY2F0aW9uIHN0eWxlOiAke3N0eWxlfSwgY2xlYW5pbmcgdXAgZmFpbGVkIHJlbmRlciB0byBhbGxvdyByZXRyeSB3aXRoIGNvcnJlY3QgZGF0YWAsCiAgICAgICAgewogICAgICAgICAgbm90aWZpY2F0aW9uLAogICAgICAgIH0sCiAgICAgICkKICAgICAgLy8gRGVsYXkgdGhlIGNsZWFudXAgdG8gYWxsb3cgdGhlIG5vdGlmaWNhdGlvbiB0byBiZSByZW5kZXJlZAogICAgICBzZXRUaW1lb3V0KCgpID0+IHsKICAgICAgICBvblJlbmRlckZhaWxlZD8uKG5vdGlmaWNhdGlvbi5pZCkKICAgICAgfSwgMSkKICAgICAgcmV0dXJuIG51bGwKICB9Cn0KCi8qKgogKiBOb3RpZmljYXRpb25Db250YWluZXIgY29tcG9uZW50CiAqIFN1YnNjcmliZXMgdG8gdGhlIG5vdGlmaWNhdGlvbiBzdG9yZSBhbmQgcmVuZGVycyBhY3RpdmUgbm90aWZpY2F0aW9ucwogKiBTaG91bGQgYmUgbW91bnRlZCBhdCB0aGUgYXBwIHJvb3QgbGV2ZWwKICovCmV4cG9ydCBmdW5jdGlvbiBOb3RpZmljYXRpb25Db250YWluZXIoewogIG9uUmVuZGVyRmFpbGVkLAogIG9uTm90aWZpY2F0aW9uU2hvd24sCiAgb25Ob3RpZmljYXRpb25DbGljaywKICBzdG9yZSA9IHVzZU5vdGlmaWNhdGlvblN0b3JlLAogICBmYWxsYmFja1JvbGVzOiBbTWVtYmVyc2hpcFJvbGUuQURNSU4sIE1lbWJlcnNoaXBSb2xlLk9XTkVSXSwKICAgICAgfSkKICAgIDogZmFsc2U7CgogIHJldHVybiB7CiAgICBNYWluOiAoCiAgICAgIDxUZWFtc0xpc3RpbmcKICAgICAgICBpbnZpdGF0aW9uQWNjZXB0ZWQ9e2ludml0YXRpb25BY2NlcHRlZH0KICAgICAgICB0ZWFtcz17dGVhbXN9CiAgICAgICAgb3JnSWQ9e29yZ0lkID8/IG51bGx9CiAgICAgICAgcGVybWlzc2lvbnM9e3sKICAgICAgICAgIGNhbkNyZWF0ZVRlYW06IGNhbkNyZWF0ZVRlYW0sCiAgICAgICAgfX0KICAgICAgICB0ZWFtTmFtZUZyb21JbnZpdGU9e3RlYW1OYW1lRnJvbUludml0ZSA/PyBudWxsfQogICAgICAgIGVycm9yTXNnRnJvbUludml0ZT17ZXJyb3JNc2dGcm9tSW52aXRlfQogICAgICAvPgogICAgKSwKICAgIENUQTogIW9yZ0lkIHx8IGNhbkNyZWF0ZVRlYW0gPyA8VGVhbXNDVEEgLz4gOiBudWxsLAogIH07Cn07CmltcG9ydCAnLi9zZWdtZW50LWV4cGxvcmVyLmNzcycKaW1wb3J0IHsKICB1c2VTZWdtZW50VHJlZSwKICB0eXBlIFNlZ21lbnRUcmllTm9kZSwKfSBmcm9tICcuLi8uLi9zZWdtZW50LWV4cGxvcmVyLXRyaWUnCmltcG9ydCB7IGN4IH0gZnJvbSAnLi4vLi4vdXRpbHMvY3gnCmltcG9ydCB7IFNlZ21lbnRCb3VuZGFyeVRyaWdnZXIgfSBmcm9tICcuL3NlZ21lbnQtYm91bmRhcnktdHJpZ2dlcicKaW1wb3J0IHsgVG9vbHRpcCB9IGZyb20gJy4uL3Rvb2x0aXAvdG9vbHRpcCcKaW1wb3J0IHsgdXNlQ2FsbGJhY2ssIHVzZU1lbW8gfSBmcm9tICdyZWFjdCcKaW1wb3J0IHsKICBCVUlMVElOX1BSRUZJWCwKICBnZXRCb3VuZGFyeU9yaWdpbkZpbGVUeXBlLAogIGlzQm91bmRhcnlGaWxlLAogIGlzQnVpbHRpbkJvdW5kYXJ5RmlsZSwKICBub3JtYWxpemVCb3VuZGFyeUZpbGVuYW1lLAp9IGZyb20gJy4uLy4uLy4uLy4uL3NlcnZlci9hcHAtcmVuZGVyL3NlZ21lbnQtZXhwbG9yZXItcGF0aCcKaW1wb3J0IHsgU2VnbWVudFN1Z2dlc3Rpb24gfSBmcm9tICcuL3NlZ21lbnQtc3VnZ2VzdGlvbicKaW1wb3J0IHR5cGUgeyBTZWdtZW50Qm91bmRhcnlUeXBlIH0gZnJvbSAnLi4vLi4vLi4vdXNlcnNwYWNlL2FwcC9zZWdtZW50LWV4cGxvcmVyLW5vZGUnCgpjb25zdCBpc0ZpbGVOb2RlID0gKG5vZGU6IFNlZ21lbnRUcmllTm9kZSkgPT4gewogIHJldHVybiAhIW5vZGUudmFsdWU/LnR5cGUgJiYgISFub2RlLnZhbHVlPy5wYWdlUGF0aAp9CgovLyBVdGlsaXR5IGZ1bmN0aW9ucyBmb3IgZ2xvYmFsIGJvdW5kYXJ5IG1hbmFnZW1lbnQKZnVuY3Rpb24gdHJhdmVyc2VUcmVlQW5kUmVzZXRCb3VuZGFyaWVzKG5vZGU6IFNlZ21lbnRUcmllTm9kZSkgewogIC8vIFJlc2V0IHRoaXMgbm9kZSdzIGJvdW5kYXJ5IGlmIGl0IGhhcyBzZXRCb3VuZGFyeVR5cGUgZnVuY3Rpb24KICBpZiAobm9kZS52YWx1ZT8uc2V0Qm91bmRhcnlUeXBlKSB7CiAgICBub2RlLnZhbHVlLnNldEJvdW5kYXJ5VHlwZShudWxsKQogIH0KCiAgLy8gUmVjdXJzaXZlbHkgdHJhdmVyc2UgY2hpbGRyZW4KICBPYmplY3QudmFsdWVzKG5vZGUuY2hpbGRyZW4pLmZvckVhY2goKGNoaWxkKSA9PiB7CiAgICBpZiAoY2hpbGQpIHsKICAgICAgdHJhdmVyc2VUcmVlQW5kUmVzZXRCb3VuZGFyaWVzKGNoaWxkKQogICAgfQogIH0pCn0KCmZ1bmN0aW9uIGNvdW50QWN0aXZlQm91bmRhcmllcyhub2RlOiBTZWdtZW50VHJpZU5vZGUpOiBudW1iZXIgewogIGxldCBjb3VudCA9IDAKCiAgLy8gQ291bnQgdGhpcyBub2RlJ3MgYm91bmRhcnkgb3ZlcnJpZGUgaWYgaXQncyBhY3RpdmUKICAvLyBPbmx5IGNvdW50IHdoZW4gdGhlcmUncyBhIG5vbiAiOmJvdW5kYXJ5IiB0eXBlIGFuZCBpdCBoYXMgYW4gYWN0aXZlIG92ZXJyaWRlIChib3VuZGFyeVR5cGUgaXMgbm90IG51bGwpCiAgLy8gVGhpcyBtZWFucyB0aGUgZmlsZSBpcyBzaG93aW5nIGFuIG92ZXJyaWRkZW4gYm91bi1zbSI+e3QoImxvYWRpbmciKX08L3NwYW4+Owp9OwoKdHlwZSBUaW1lem9uZVNlbGVjdFByb3BzID0gT21pdDwKICBUaW1lem9uZVNlbGVjdENvbXBvbmVudFByb3BzLAogICJkYXRhIiB8ICJpc1BlbmRpbmciIHwgImlzV2ViVGltZXpvbmVTZWxlY3QiCj4gJiB7CiAgdGltZVpvbmVzPzogVGltZXpvbmVbXTsKfTsKCmNvbnN0IFdlYlRpbWV6b25lU2VsZWN0OiBDb21wb25lbnRUeXBlPFRpbWV6b25lU2VsZWN0UHJvcHM+ID0gZHluYW1pYygKICAoKSA9PgogICAgaW1wb3J0KCJAY2FsY29tL3dlYi9tb2R1bGVzL3RpbWV6b25lL2NvbXBvbmVudHMvVGltZXpvbmVTZWxlY3QiKS50aGVuKAogICAgICAobW9kKSA9PiBtb2QuVGltZXpvbmVTZWxlY3QKICAgICksCiAgewogICAgc3NyOiBmYWxzZSwKICAgIGxvYWRpbmc6ICgpID0+IDxMb2FkaW5nU3RhdGUgLz4sCiAgfQopOwoKdHlwZSBTbG90U2VsZWN0aW9uTW9kYWxIZWFkZXJQcm9wcyA9IHsKICBvbkNsaWNrOiAoKSA9PiB2b2lkOwogIGV2ZW50PzogUGljazwKICAgIEJvb2tlckV2ZW50LAogICAgfCAibGVuZ3RoIgogICAgfCAibWV0YWRhdGEiCiAgICB8ICJsb2NrVGltZVpvbmVUb2dnbGVPbkJvb2tpbmdQYWdlIgogICAgfCAibG9ja2VkVGltZVpvbmUiCiAgICB8ICJpc0R5bmFtaWMiCiAgICB8ICJjdXJyZW5jeSIKICAgIHwgInByaWNlIgogICAgfCAibG9jYXRpb25zIgogICAgfCAicmVxdWlyZXNDb25maXJtYXRpb24iCiAgICB8ICJyZWN1cnJpbmdFdmVudCIKICAgIHwgImVuYWJsZVBlckhvc3RMb2NhdGlvbnMiCiAgPiB8IG51bGw7CiAgaXNQbGF0Zm9ybT86IGJvb2xlYW47CiAgdGltZVpvbmVzPzogVGltZXpvbmVbXTsKICBzZWxlY3RlZERhdGU6IHN0cmluZyB8IG51bGw7Cn07CgpleHBvcnQgY29uc3QgU2xvdFNlbGVjdGlvbk1vZGFsSGVhZGVyID0gKHsKICBvbkNsaWNrLAogIGV2ZW50LAogIGlzUGxhdGZvcm0gPSBmYWxzZSwKICB0aW1lWm9uZXMsCiAgc2VsZWN0ZWREYXRlLAp9OiBTbG90U2VsZWN0aW9uTW9kYWxIZWFkZXJQcm9wcyk6IEpTWC5FbGVtZW50ID0+IHsKICBjb25zdCB7IGkxOG4gfSA9IHVzZUxvY2FsZSgpOwogIGNvbnN0IFtzZXRUaW1lem9uZV0gPSB1c2VUaW1lUHJlZmVyZW5jZXMoKHN0YXRlKSA9PiBbc3RhdGUuc2V0VGltZXpvbmVdKTsKICBjb25zdCBbdGltZXpvbmUsIHNldEJvb2tlclN0b3JlVGltZXpvbmVdID0gdXNlQm9va2VyU3RvcmVDb250ZXh0KAogICAgKHN0YXRlKSA9PiBbc3RhdGUudGltZXpvbmUsIHN0YXRlLnNldFRpbWV6b25lXSwKICAgIHNoYWxsb3cKICApOwogIGNvbnN0IFtUaW1lem9uZVNlbGVjdF0gPSB1c2VNZW1vKAogICAgKCkgPT4gKGlzUGxhdGZvcm0gPyBbUGxhdGZvcm1UaW1lem9uZVNlbGVjdF0gOiBbV2ViVGltZXpvbmVTZWxlY3RdKSwKICAgIFtpc1BsYXRmb3JtXQogICk7CgogIGNvbnN0IGZvcm1hdHRlZERhdGUgPSB1c2VNZW1vKCgpID0+IHsKICAgIGlmICghc2VsZWN0ZWREYXRlKSByZXR1cm4geyBkYXlPZldlZWs6ICIiLCBmdWxsRGF0ZTogIiIgfTsKCiAgICBjb25zdCBkYXRlID0gZGF5anMoc2VsZWN0ZWREYXRlKTsKICAgIGNvbnN0IGRheU9mV2VlayA9IGRhdGUubG9jYWxlKGkxOG4ubGFuZ3VhZ2UpLmZvcm1hdCgiZGRkZCIpOwogICAgY29uc3QgZnVsbERhdGUgPSBkYXRlLmxvY2FsZShpMThuLmxhbmd1YWdlKS5mb3JtYXQoIk1NTU0gRCwgWVlZWSIpOwoKICAgIHJldHVybiB7IGRheU9mV2VlaywgZnVsbERhdGUgfTsKICB9LCBbc2VsZWN0ZWREYXRlLCBpMThuLmxhbmd1YWdlXSk7CgogIHJldHVybiAoCiAgICA8ZGl2IGNsYXNzTmFtZT0idHdvLXN0ZXAtc2xvdC1zZWxlY3Rpb24tbW9kYWwtaGVhZGVyIHN0aWNreSB0b3AtMCB6LTEwIC1teC00IG10LTAgbWItNCBmbGV4IGZsZXgtY29sIGJvcmRlci1zdWJ0bGUgYm9yZGVyLWIgYmctZGVmYXVsdCBweC04IHBiLTQiaXRlbS5wcm90b2NvbFZlcnNpb259LSR7aXRlbS5ob29rQWRkcmVzc30tJHtpdGVtLmZlZVRpZXJ9YAogICAgY2FzZSBPbmNoYWluSXRlbUxpc3RPcHRpb25UeXBlLlRva2VuOgogICAgICByZXR1cm4gYHRva2VuLSR7aXRlbS5jdXJyZW5jeUluZm8uY3VycmVuY3kuY2hhaW5JZH0tJHtpdGVtLmN1cnJlbmN5SW5mby5jdXJyZW5jeUlkfWAKICAgIGNhc2UgT25jaGFpbkl0ZW1MaXN0T3B0aW9uVHlwZS5XYWxsZXRCeUFkZHJlc3M6CiAgICAgIHJldHVybiBgd2FsbGV0LSR7aXRlbS5hZGRyZXNzfWAKICAgIGNhc2UgT25jaGFpbkl0ZW1MaXN0T3B0aW9uVHlwZS5FTlNBZGRyZXNzOgogICAgICByZXR1cm4gYGVucy0ke2l0ZW0uYWRkcmVzc31gCiAgICBjYXNlIE9uY2hhaW5JdGVtTGlzdE9wdGlvblR5cGUuVW5pdGFnOgogICAgICByZXR1cm4gYHVuaXRhZy0ke2l0ZW0uYWRkcmVzc31gCiAgICBjYXNlIE9uY2hhaW5JdGVtTGlzdE9wdGlvblR5cGUuTkZUQ29sbGVjdGlvbjoKICAgICAgcmV0dXJuIGBuZnQtJHtpdGVtLmNoYWluSWR9LSR7aXRlbS5hZGRyZXNzfWAKICB9Cn0KaW1wb3J0IHsgQ2hhaW5JZCB9IGZyb20gJ0BhYXZlL2NvbnRyYWN0LWhlbHBlcnMnOwppbXBvcnQgeyBHZXRVc2VyU3Rha2VVSURhdGFIdW1hbml6ZWQgfSBmcm9tICdAYWF2ZS9jb250cmFjdC1oZWxwZXJzL2Rpc3QvZXNtL1YzLXVpU3Rha2VEYXRhUHJvdmlkZXItY29udHJhY3QvdHlwZXMnOwppbXBvcnQgeyBSZWZyZXNoSWNvbiB9IGZyb20gJ0BoZXJvaWNvbnMvcmVhY3Qvb3V0bGluZSc7CmltcG9ydCB7IFRyYW5zIH0gZnJvbSAnQGxpbmd1aS9tYWNybyc7CmltcG9ydCB7CiAgQm94LAogIEJ1dHRvbiwKICBQYXBlciwKICBTdGFjaywKICBTdmdJY29uLAogIFR5cG9ncmFwaHksCiAgdXNlTWVkaWFRdWVyeSwKICB1c2VUaGVtZSwKfSBmcm9tICdAbXVpL21hdGVyaWFsJzsKaW1wb3J0IHsgQmlnTnVtYmVyIH0gZnJvbSAnZXRoZXJzJzsKaW1wb3J0IHsgZm9ybWF0RXRoZXIsIGZvcm1hdFVuaXRzIH0gZnJvbSAnZXRoZXJzL2xpYi91dGlscyc7CmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCc7CmltcG9ydCB7IE1lcml0SW5jZW50aXZlc0J1dHRvbiB9IGZyb20gJ3NyYy9jb21wb25lbnRzL2luY2VudGl2ZXMvSW5jZW50aXZlc0J1dHRvbic7CmltcG9ydCB7IERhcmtUb29sdGlwIH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvaW5mb1Rvb2x0aXBzL0RhcmtUb29sdGlwJzsKaW1wb3J0IHsgVG9rZW5Db250cmFjdFRvb2x0aXAgfSBmcm9tICdzcmMvY29tcG9uZW50cy9pbmZvVG9vbHRpcHMvVG9rZW5Db250cmFjdFRvb2x0aXAnOwppbXBvcnQgeyBGb3JtYXR0ZWROdW1iZXIgfSBmcm9tICdzcmMvY29tcG9uZW50cy9wcmltaXRpdmVzL0Zvcm1hdHRlZE51bWJlcic7CmltcG9ydCB7IFRva2VuSWNvbiB9IGZyb20gJ3NyYy9jb21wb25lbnRzL3ByaW1pdGl2ZXMvVG9rZW5JY29uJzsKaW1wb3J0IHsgU2Vjb25kc1RvU3RyaW5nIH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvU2Vjb25kc1RvU3RyaW5nJzsKaW1wb3J0IHsgVGV4dFdpdGhUb29sdGlwIH0gZnJvbSAnc3JjL2NvbXBvbmVudHMvVGV4dFdpdGhUb29sdGlwJzsKaW1wb3J0IHsgU3Rha2VUb2tlbkZvcm1hdHRlZCB9IGZyb20gJ3NyYy9ob29rcy9zdGFrZS91c2VHZW5lcmFsU3Rha2VVaURhdGEnOwppbXBvcnQgeyB1c2VDdXJyZW50VGltZXN0YW1wIH0gZnJvbSAnc3JjL2hvb2tzL3VzZUN1cnJlbnRUaW1lc3RhbXAnOwppbXBvcnQgeyB1c2VNb2RhbENvbnRleHQgfSBmcm9tICdzcmMvaG9va3MvdXNlTW9kYWwnOwppbXBvcnQgeyBDdXN0b21NYXJrZXQgfSBmcm9tICdzcmMvdWktY29uZmlnL21hcmtldHNDb25maWcnOwppbXBvcnQgeyBHRU5FUkFMIH0gZnJvbSAnc3JjL3V0aWxzL2V2ZW50cyc7CgppbXBvcnQgeyBTdGFrZUFjdGlvbkJveCB9IGZyb20gJy4vU3Rha2VBY3Rpb25Cb3gnOwppbXBvcnQgeyBTdGFraW5nUGFuZWxTa2VsZXRvbiB9b2NhbGUyNGggfSBmcm9tICJAY2FsY29tL2xpYi90aW1lRm9ybWF0IjsKaW1wb3J0IHsgQ1VSUkVOVF9USU1FWk9ORSB9IGZyb20gIkBjYWxjb20vbGliL3RpbWV6b25lQ29uc3RhbnRzIjsKaW1wb3J0IHsgbG9jYWxTdG9yYWdlIH0gZnJvbSAiQGNhbGNvbS9saWIvd2Vic3RvcmFnZSI7CgppbXBvcnQgeyBBdG9tc1dyYXBwZXIgfSBmcm9tICIuLi8uLi9zcmMvY29tcG9uZW50cy9hdG9tcy13cmFwcGVyIjsKaW1wb3J0IHsgY24gfSBmcm9tICIuLi8uLi9zcmMvbGliL3V0aWxzIjsKaW1wb3J0IHsgdXNlQXRvbXNFdmVudFR5cGVQYXltZW50SW5mbyB9IGZyb20gIi4uL2hvb2tzL3VzZUF0b21FdmVudFR5cGVQYXltZW50SW5mbyI7Cgpjb25zdCBTdHJpcGVQYXltZW50Rm9ybSA9IFJlYWN0LmxhenkoKCkgPT4gaW1wb3J0KCIuL1N0cmlwZVBheW1lbnRGb3JtIikpOwoKZXhwb3J0IGNvbnN0IFBheW1lbnRGb3JtID0gKHsKICBwYXltZW50VWlkLAogIG9uUGF5bWVudFN1Y2Nlc3MsCiAgb25QYXltZW50Q2FuY2VsbGF0aW9uLAogIG9uRXZlbnRUeXBlUGF5bWVudEluZm9TdWNjZXNzLAogIG9uRXZlbnRUeXBlUGF5bWVudEluZm9GYWlsdXJlLAp9OiB7CiAgcGF5bWVudFVpZDogc3RyaW5nOwogIG9uUGF5bWVudFN1Y2Nlc3M/OiAoaW5wdXQ6IFBheW1lbnRQYWdlUHJvcHMpID0+IHZvaWQ7CiAgb25QYXltZW50Q2FuY2VsbGF0aW9uPzogKGlucHV0OiBQYXltZW50UGFnZVByb3BzKSA9PiB2b2lkOwogIG9uRXZlbnRUeXBlUGF5bWVudEluZm9TdWNjZXNzPzogKCkgPT4gdm9pZDsKICBvbkV2ZW50VHlwZVBheW1lbnRJbmZvRmFpbHVyZT86ICgpID0+IHZvaWQ7Cn0pID0+IHsKICBjb25zdCB7IHQgfSA9IHVzZUxvY2FsZSgpOwogIGNvbnN0IHsgZGF0YTogcGF5bWVudEluZm8sIGlzTG9hZGluZyB9ID0gdXNlQXRvbXNFdmVudFR5cGVQYXltZW50SW5mbyh7CiAgICB1aWQ6IHBheW1lbnRVaWQsCiAgICBvbkV2ZW50VHlwZVBheW1lbnRJbmZvU3VjY2VzcywKICAgIG9uRXZlbnRUeXBlUGF5bWVudEluZm9GYWlsdXJlLAogIH0pOwoKICBjb25zdCBldmVudE5hbWUgPSBwYXltZW50SW5mbz8uYm9va2luZy50aXRsZTsKCiAgY29uc3QgaXMyNGggPSBpc0Jyb3dzZXJMb2NhbGUyNGgoKTsKICBjb25zdCB0aW1lem9uZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKCJ0aW1lT3B0aW9uLnByZWZlcnJlZFRpbWVab25lIikgfHwgQ1VSUkVOVF9USU1FWk9ORTsKICBjb25zdCBkYXRlID0gZGF5anMudXRjKHBheW1lbnRJbmZvPy5ib29raW5nLnN0YXJ0VGltZSkudHoodGltZXpvbmUpOwoKICBpZiAoaXNMb2FkaW5nKSByZXR1cm4gPGgxIGNsYXNzTmFtZT0icC00IHB0LTQgdGV4dC14bCI+TG9hZGluZy4uLjwvaDE+OwoKICBpZiAoIXBheW1lbnRJbmZvKSByZXR1cm4gPGgxIGNsYXNzTmFtZT0icC00IHRleHQteGwiPk5vIHBheW1lbnQgZm91bmQgd2l0aCBVSUQgLSB7cGF5bWVudFVpZH08L2gxPjsKCiAgY29uc3QgcGF5bWVudEFwcERhdGEgPSBnZXRQYXltZW50QXBwRGF0YShwYXltZW50SW5mbz8uZXZlbnRUeXBlKTsKCiAgcmV0dXJuICgKICAgIDxBdG9tc1dyYXBwZXI+CiAgICAgIDxkaXY+CiAgICAgICAgPFN1c3BlbnNlIGZhbGxiYWNrPXs8PjwvPn0+CiAgICAgICAgICA8bWFpbiBjbGFzc05hbWU9Im14LWF1dG8iPgogICAgICAgICAgICA8ZGl2PgogICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IG1pbi1oLXNjcmVlbiBpdGVtcy1lbmQganVzdGlmeS1jZW50ZXIgcHgtNCBwYi0yMCBwdC00IHRleHQtY2VudGVyIHNtOmJsb2NrIHNtOnAtMCI+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iaW5zZXQtMCBteS00IHRyYW5zaXRpb24tb3BhY2l0eSBzbTpteS0wIiBhcmlhLWhpZGRlbj0idHJ1ZSI+CiAgICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0iaGlkZGVuIHNtOmlubGluZS1ibG9jayBzbTpoLXNjcmVlbiBzbTphbGlnbi1taWRkbGUiIGFyaWFsb2dDYW5jZWw+CiAgICAgICAgICAgICAgICA8QWxlcnREaWFsb2dBY3Rpb24+QWxsb3c8L0FsZXJ0RGlhbG9nQWN0aW9uPgogICAgICAgICAgICAgIDwvQWxlcnREaWFsb2dGb290ZXI+CiAgICAgICAgICAgIDwvQWxlcnREaWFsb2dDb250ZW50PgogICAgICAgICAgPC9BbGVydERpYWxvZz4KICAgICAgICAgIDxCYWRnZSB2YXJpYW50PSJzZWNvbmRhcnkiIGNsYXNzTmFtZT0ibWwtYXV0byI+CiAgICAgICAgICAgIFdhcm5pbmcKICAgICAgICAgIDwvQmFkZ2U+CiAgICAgICAgPC9DYXJkRm9vdGVyPgogICAgICA8L0NhcmQ+CiAgICA8L0V4YW1wbGU+CiAgKQp9Cgpjb25zdCBmcmFtZXdvcmtzID0gWwogICJOZXh0LmpzIiwKICAiU3ZlbHRlS2l0IiwKICAiTnV4dC5qcyIsCiAgIlJlbWl4IiwKICAiQXN0cm8iLApdIGFzIGNvbnN0CgpmdW5jdGlvbiBGb3JtRXhhbXBsZSgpIHsKICBjb25zdCBbbm90aWZpY2F0aW9ucywgc2V0Tm90aWZpY2F0aW9uc10gPSBSZWFjdC51c2VTdGF0ZSh7CiAgICBlbWFpbDogdHJ1ZSwKICAgIHNtczogZmFsc2UsCiAgICBwdXNoOiB0cnVlLAogIH0pCiAgY29uc3QgW3RoZW1lLCBzZXRUaGVtZV0gPSBSZWFjdC51c2VTdGF0ZSgibGlnaHQiKQoKICByZXR1cm4gKAogICAgPEV4YW1wbGUgdGl0bGU9IkZvcm0iPgogICAgICA8Q2FyZCBjbGFzc05hbWU9InctZnVsbCBtYXgtdy1tZCI+CiAgICAgICAgPENhcmRIZWFkZXI+CiAgICAgICAgICA8Q2FyZFRpdGxlPlVzZXIgSW5mb3JtYXRpb248L0NhcmRUaXRsZT4KICAgICAgICAgIDxDYXJkRGVzY3JpcHRpb24+UGxlYXNlIGZpbGwgaW4geW91ciBkZXRhaWxzIGJlbG93PC9DYXJkRGVzY3JpcHRpb24+CiAgICAgICAgICA8Q2FyZEFjdGlvbj4KICAgICAgICAgICAgPERyb3Bkb3duTWVudT4KICAgICAgICAgICAgICA8RHJvcGRvd25NZW51VHJpZ2dlciBhc0NoaWxkPgogICAgICAgICAgICAgICAgPEJ1dHRvbiB2YXJpYW50PSJnaG9zdCIgc2l6ZT0iaWNvbiI+CiAgICAgICAgICAgICAgICAgIDxJY29uUGxhY2Vob2xkZXIKICAgICAgICAgICAgICAgICAgICBsdWNpZGU9Ik1vcmVWZXJ0aWNhbEljb24iCiAgICAgICAgICAgICAgICAgICAgdGFibGVyPSJJY29uRG90c1ZlcnRpY2FsIgogICAgICAgICAgICAgICAgICAgIGh1Z2VpY29ucz0iTW9yZVZlcnRpY2FsQ2lyY2xlMDFJY29uIgogICAgICAgICAgICAgICAgICAgIHBob3NwaG9yPSJEb3RzVGhyZWVWZXJ0aWNhbEljb24iCiAgICAgICAgICAgICAgICAgICAgcmVtaXhpY29uPSJSaU1vcmUyTGluZSIKICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSJzci1vbmx5Ij5Nb3JlIG9wdGlvbnM8L3NwYW4+CiAgICAgICAgICAgICAgICA8L0J1dHRvbj4KICAgICAgICAgICAgICA8L0Ryb3Bkb3duTWVudVRyaWdnZXI+CiAgICAgICAgICAgICAgPERyb3Bkb3duTWVudUNvbnRlbnQgYWxpZ249ImVuZCIgY2xhc3NOYW1lPSJ3LTU2Ij4KICAgICAgICAgICAgICAgIDxEcm9wZG93bk1lbnVHcm91cD4KICAgICAgICAgICAgICAgICAgPERyb3Bkb3duTWVudUxhYmVsPkZpbGU8L0Ryb3Bkb3duTWVudUxhYmVsPgogICAgICAgICAgICAgICAgICA8RHJvcGRvd25NZW51SXRlbT4KICAgICAgICAgICAgICAgICAgICA8SWNvblBsYWNlaG9sZGVyCiAgICAgICAgICAgICAgICAgICAgICBsdWNpZGU9IkZpbGVJY29uIgogICAgICAgICAgICAgICAgICAgICAgdGFibGVyPSJJY29uRmlsZSIKICAgICAgICAgICAgICAgICAgICAgIGh1Z2VpY29ucz0iRmlsZUljb24iCiAgICAgICAgICAgICAgICAgICAgICBwaG9zcGhvcj0iRmlsZUljb24iCiAgICAgICAgICAgICAgICAgICAgICByZW1peGljb249IlJpRmlsZUxpbmUiCiAgICAgICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICAgICAgICBOZXcgRmlsZQogICAgICAgICAgICAgICAgICAgIDxEcm9wZG93bk1lbnVTaG9ydGN1dD7ijJhOPC9Ecm9vbmFsIHNoYXBlcwogICAgLy8gZm9yIGV4YW1wbGUKICAgIC8vIGF3YWl0IGxvYWRIZWFydFNoYXBlKGVuZ2luZSk7IC8vIGl0IHJlcXVpcmVzICJ0c3BhcnRpY2xlcy1zaGFwZS1oZWFydCIgZGVwZW5kZW5jeQogICAgLy8gSU5URVJBQ1RJT05TCiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vbWF0dGVvYnJ1bmkvdHNwYXJ0aWNsZXMvdHJlZS9tYWluL2ludGVyYWN0aW9ucyBhbGwgb2ZmY2lhaWwgdHNQYXJ0aWNsZXMgYWRkaXRpb25hbCBpbnRlcmFjdGlvbnMKICAgIC8vIGZvciBleGFtcGxlCiAgICAvLyBhd2FpdCBsb2FkTGlnaHRJbnRlcmFjdGlvbihlbmdpbmUpOyAvLyBpdCByZXF1aXJlcyAidHNwYXJ0aWNsZXMtaW50ZXJhY3Rpb24tbGlnaHQiIGRlcGVuZGVuY3kKICAgIC8vIFVQREFURVJTCiAgICAvLyBodHRwczovL2dpdGh1Yi5jb20vbWF0dGVvYnJ1bmkvdHNwYXJ0aWNsZXMvdHJlZS9tYWluL3VwZGF0ZXJzIGFsbCBvZmZpY2lhbCB0c1BhcnRpY2xlcyBhZGRpdGlvbmFsIHVwZGF0ZXJzCiAgICAvLyBmb3IgZXhhbXBsZQogICAgLy8gYXdhaXQgbG9hZE9yYml0VXBkYXRlcihlbmdpbmUpOyAvLyBpdCByZXF1aXJlcyAidHNwYXJ0aWNsZXMtdXBkYXRlci1vcmJpdCIgZGVwZW5kZW5jeQogIH07CgogIGNvbnN0IHBhcnRpY2xlc0xvYWRlZCA9IGFzeW5jIChjb250YWluZXI6IENvbnRhaW5lcikgPT4gewogICAgLy8gdGhlIGNvbnRhaW5lciBpcyB0aGUgY3VycmVudCBwYXJ0aWNsZXMgaW5zdGFuY2UsIGl0IGhhcyBtZXRob2RzIGxpa2UgcmVmcmVzaCgpLCBzdGFydCgpLCBzdG9wKCksIHBsYXkoKSwgcGF1c2UoKQogICAgLy8gdGhlIGRvY3VtZW50YXRpb24gY2FuIGJlIGZvdW5kIGhlcmU6IGh0dHBzOi8vcGFydGljbGVzLmpzLm9yZy9kb2NzL21vZHVsZXMvQ29yZV9Db250YWluZXIuaHRtbAogIH07CgogIC8vIG9wdGlvbnMgdmFyaWFibGUgaXMgdGhlIHBhcnRpY2xlcyBjb25maWd1cmF0aW9uCiAgLy8gbWFueSBjb25maWd1cmF0aW9ucyBjYW4gYmUgZm91bmQgaGVyZTogaHR0cHM6Ly9wYXJ0aWNsZXMuanMub3JnCiAgLy8gb3RoZXIgY29uZmlndXJhdGlvbnMgY2FuIGJlIGZvdW5kIGluIHRoZSBvZmZpY2lhbCBDb2RlUGVuIGNvbGxlY3Rpb24gaGVyZTogaHR0cHM6Ly9jb2RlcGVuLmlvL2NvbGxlY3Rpb24vRFBPYWdlCiAgY29uc3Qgb3B0aW9uczogSVNvdXJjZU9wdGlvbnMgPSB7CiAgICBmdWxsU2NyZWVuOiB7CiAgICAgIGVuYWJsZTogdHJ1ZSwgLy8gc2V0IHRoaXMgdG8gZmFsc2UgdG8gdXNlIHRoZSBwYXJ0aWNsZXMgbGlrZSBhbnkgb3RoZXIgRE9NIGVsZW1lbnQsIHdpdGggdGhpcyB0cnVlIHRoZXkgYWN0IGxpa2UgYSBiYWNrZ3JvdW5kCiAgICAgIHpJbmRleDogLTEsCiAgICB9LAogICAgZnBzTGltaXQ6IDEyMCwKICAgIHBhcnRpY2xlczogewogICAgICBudW1iZXI6IHsKICAgICAgICB2YWx1ZTogODAsCiAgICAgICAgZGVuc2l0eTogewogICAgICAgICAgZW5hYmxlOiB0cnVlLAogICAgICAgICAgYXJlYTogODAwLAogICAgICAgIH0sCiAgICAgIH0sCiAgICAgIGNvbG9yOiB7CiAgICAgICAgdmFsdWU6IFsiIzJFQjY3RCIsICIjRUNCMjJFIiwgIiNFMDFFNUIiLCAiIzM2QzVGMCJdLAogICAgICB9LAogICAgICBzaGFwZTogewogICAgICAgIHR5cGU6ICJjaXJjbGUiLAogICAgICB9LAogICAgICBvcGFjaXR5OiB7CiAgICAgICAgdmFsdWU6IDEsCiAgICAgIH0sCiAgICAgIHNpemU6IHsKICAgICAgICB2YWx1ZTogeyBtaW46IDEsIG1heDogOCB9LAogICAgICB9LAogICAgICBsaW5rczogewogICAgICAgIGVuYWJsZTogdHJ1ZSwKICAgICAgICBkaXN0YW5jZTogMTUwLAogICAgICAgIGNvbG9yOiAiIzgwODA4MCIsCiAgICAgICAgb3BhY2l0eTogMC40LAogICAgICAgIHdpZHRoOiAxLAogICAgICB9LAogICAgICBtb3ZlOiB7CiAgICAgICAgZW5hYmxlOiB0cnVlLAogICAgICAgIHNwZWVkOiA1LAogICAgICAgIG91dE1vZGVzOiB7IG9uUmVhY3RpdmF0ZT8uKCkKICB9KQoKICBjb25zdCBzb3J0ZWREYXRhID0gWy4uLm5ldHdvcmtCYWxhbmNlc10uc29ydCgoYSwgYikgPT4gTnVtYmVyKGEuaGFzU3VmZmljaWVudEZ1bmRzKSAtIE51bWJlcihiLmhhc1N1ZmZpY2llbnRGdW5kcykpCiAgY29uc3Qgc3VmZmljaWVudEZ1bmRzQ291bnQgPSBzb3J0ZWREYXRhLmZpbHRlcigoY2hhaW4pID0+IGNoYWluLmhhc1N1ZmZpY2llbnRGdW5kcykubGVuZ3RoCiAgY29uc3QgY2FuQ29udGludWUgPSBzdWZmaWNpZW50RnVuZHNDb3VudCA+IDAKCiAgY29uc3QgaXNMb2FkaW5nID0gc29ydGVkRGF0YS5sZW5ndGggPT09IDAKCiAgY29uc3QgY3RhQnV0dG9uVGV4dCA9IGlzTG9hZGluZwogICAgPyB1bmRlZmluZWQKICAgIDogc3VmZmljaWVudEZ1bmRzQ291bnQgPT09IDAKICAgICAgPyB0KCdzbWFydFdhbGxldC5hY3Rpb25SZXF1aXJlZC5pbnN1ZmZpY2llbnRGdW5kcycpCiAgICAgIDogc3VmZmljaWVudEZ1bmRzQ291bnQgPiAxCiAgICAgICAgPyB0KCdzbWFydFdhbGxldC5hY3Rpb25SZXF1aXJlZC5jdGEucGx1cmFsJywgeyBhbW91bnQ6IHN1ZmZpY2llbnRGdW5kc0NvdW50IH0pCiAgICAgICAgOiB0KCdzbWFydFdhbGxldC5hY3Rpb25SZXF1aXJlZC5jdGEnKQoKICBjb25zdCB0aXRsZSA9IGlzTG9hZGluZwogICAgPyB0KCdzbWFydFdhbGxldC5hY3Rpb25SZXF1aXJlZC50aXRsZScpCiAgICA6IHNvcnRlZERhdGEubGVuZ3RoID4gMQogICAgICA/IHQoJ3NtYXJ0V2FsbGV0LmFjdGlvblJlcXVpcmVkLnRpdGxlLnBsdXJhbCcsIHsgYW1vdW50OiBzb3J0ZWREYXRhLmxlbmd0aCB9KQogICAgICA6IHQoJ3NtYXJ0V2FsbGV0LmFjdGlvblJlcXVpcmVkLnRpdGxlJykKCiAgcmV0dXJuICgKICAgIDxTbWFydFdhbGxldE1vZGFsCiAgICAgIGlzT3Blbj17aXNPcGVufQogICAgICBpY29uPXs8SW5zdWZmaWNpZW50R2FzIHNpemU9IiRpY29uLjI0IiAvPn0KICAgICAgaWNvbkJhY2tncm91bmRDb2xvcj0iJHN0YXR1c0NyaXRpY2FsMiIKICAgICAgdGl0bGU9e3RpdGxlfQogICAgICB0aXRsZUlzTG9hZGluZz17aXNMb2FkaW5nfQogICAgICB0aXRsZUxvYWRpbmdQbGFjZWhvbGRlclRleHQ9e3QoJ3NtYXJ0V2FsbGV0LmFjdGlvblJlcXVpcmVkLnRpdGxlJyl9CiAgICAgIHN1YnRleHQ9e3QoJ3NtYXJ0V2FsbGV0LmFjdGlvblJlcXVpcmVkLmRlc2NyaXB0aW9uJyl9CiAgICAgIG1vZGFsTmFtZT17TW9kYWxOYW1lLlNtYXJ0V2FsbGV0QWN0aW9uUmVxdWlyZWRNb2RhbH0KICAgICAgcHJpbWFyeUJ1dHRvbj17ewogICAgICAgIHRleHQ6IGN0YUJ1dHRvblRleHQgfHwgJycsCiAgICAgICAgb25DbGljazogb25Db25maXJtQ2FsbGJhY2ssCiAgICAgICAgdmFyaWFudDogJ2RlZmF1bHQnLAogICAgICAgIGRpc2FibGVkOiAhY2FuQ29udGludWUgfHwgaXNMb2FkaW5nLAogICAgICAgIGxvYWRpbmc6IGlzTG9hZGluZywKICAgICAgfX0KICAgICAgc2Vjb25kYXJ5QnV0dG9uPXt7CiAgICAgICAgdGV4dDogdCgnc21hcnRXYWxsZXQuYWN0aW9uUmVxdWlyZWQucmVhY3RpdmF0ZScpLAogICAgICAgIG9uQ2xpY2s6IG9uUmVhY3RpdmF0ZUNhbGxiYWNrLAogICAgICAgIGVtcGhhc2lzOiAndGV4dC1vbmx5JywKICAgICAgfX0KICAgICAgYWxpZ25tZW50PSJ0b3AiCiAgICAgIG9uQ2xvc2U9e29uQ2xvc2V9CiAgICA+CiAgICAgIDxGbGV4IG1heEhlaWdodD17bWF4SGVpZ2h0TGlzdH0gZmxleD17MX0+CiAgICAgICAge2lzTG9hZGluZyAmJiA8TG9hZGVyLkluc3VmZmljaWVudEZ1bmRzTmV0d29ya1JvdyByZXBlYXQ9e2RlbGVnYXRlZENoYWluc0NvdW50fSAvPn0KICAgICAgICA8RmxhdExpc3QKICAgICAgICAgIGRhdGE9e3NvcnRlZERhdGF9CiAgICAgICAgICByZW5kZXJJdGVtPXtyZW5kZXJJdGVtfQogICAgICAgICAga2V5RXh0cmFjdG9yPXsoaXRlbSwgaW5kZXgpID0+IGAke2luZGV4fS0ke2l0ZW0uY2hhaW5JZH1gfQogZXMucmVxdWVzdE5leHRQZXJpb2QoKTsKICAgIH0sCgogICAgbmF2aWdhdGVQcmV2aW91czogYXN5bmMgKCkgPT4gewogICAgICBjb25zdCBzdGF0ZSA9IGdldCgpOwoKICAgICAgLy8gVHJ5IG5hdmlnYXRpbmcgd2l0aGluIGN1cnJlbnQgYXJyYXkgZmlyc3QKICAgICAgaWYgKHN0YXRlLmhhc1ByZXZpb3VzSW5BcnJheSgpKSB7CiAgICAgICAgY29uc3QgcHJldkluZGV4ID0gc3RhdGUuZ2V0Q3VycmVudEluZGV4KCkgLSAxOwogICAgICAgIHNldCh7IHNlbGVjdGVkQm9va2luZ1VpZDogc3RhdGUuYm9va2luZ3NbcHJldkluZGV4XS51aWQgfSk7CiAgICAgICAgcmV0dXJuOwogICAgICB9CgogICAgICAvLyBOZWVkIHRvIG5hdmlnYXRlIHRvIHByZXZpb3VzIHBlcmlvZAogICAgICBpZiAoIXN0YXRlLmNhcGFiaWxpdGllcz8uY2FuTmF2aWdhdGVUb1ByZXZpb3VzUGVyaW9kKCkpIHsKICAgICAgICByZXR1cm47CiAgICAgIH0KCiAgICAgIC8vIFNldCBwZW5kaW5nIHNlbGVjdGlvbiB0byAibGFzdCIgYW5kIG1hcmsgYXMgdHJhbnNpdGlvbmluZwogICAgICBzZXQoeyBpc1RyYW5zaXRpb25pbmc6IHRydWUsIHBlbmRpbmdTZWxlY3Rpb246ICJsYXN0IiB9KTsKICAgICAgLy8gVHJpZ2dlciBwYWdlL3dlZWsgY2hhbmdlIHN5bmNocm9ub3VzbHkgLSB0aGUgcGFyZW50IGNvbXBvbmVudCB3aWxsIGhhbmRsZSB0aGUgZGF0YSBmZXRjaAogICAgICBzdGF0ZS5jYXBhYmlsaXRpZXMucmVxdWVzdFByZXZpb3VzUGVyaW9kKCk7CiAgICB9LAogIH0pKTsKfTsKCmNvbnN0IEJvb2tpbmdEZXRhaWxzU2hlZXRTdG9yZUNvbnRleHQgPSBSZWFjdC5jcmVhdGVDb250ZXh0PEJvb2tpbmdEZXRhaWxzU2hlZXRTdG9yZVR5cGUgfCBudWxsPihudWxsKTsKCi8vIFRPRE86IFRvIEF2b2lkIHRoaXMgdXNlRWZmZWN0IGJhc2VkIGRvdWJsZSBzeW5jLCB3ZSBzaG91bGQgcmV0dXJuIGEgd3JhcHBlciBzdG9yZSBvdmVyIFp1c3RhbmQgYW5kIE51cXMuCi8vIENlcnRhaW4gc3RhdGVzIHRoYXQgYXJlIHN0b3JlZCBpbiBxdWVyeSBwYXJhbXMgd291bGQgYmUgZnVsbHkgcG93ZXJlZCBieSBOdXFzIGFuZCBvdGhlciBzdGF0ZXMgd291bGQgYmUgZnVsbHkgcG93ZXJlZCBieSBadXN0YW5kIGFuZCB0aGUgd3JhcHBlciBzdG9yZSBwcm92aWRlcyBhIGdlbmVyaWMgaW50ZXJmYWNlIHRvIHdvcmsgd2l0aCBib3RoCmZ1bmN0aW9uIHVzZUJpRGlyZWN0aW9uYWxTeW5jQmV0d2VlblN0b3JlQW5kVXJsKHsgc3RvcmUgfTogeyBzdG9yZTogQm9va2luZ0RldGFpbHNTaGVldFN0b3JlVHlwZSB9KSB7CiAgY29uc3QgW3NlbGVjdGVkQm9va2luZ1VpZEZyb21VcmwsIHNldFNlbGVjdGVkQm9va2luZ1VpZFRvVXJsXSA9IHVzZVNlbGVjdGVkQm9va2luZ1VpZCgpOwogIGNvbnN0IFthY3RpdmVTZWdtZW50RnJvbVVybCwgc2V0QWN0aXZlU2VnbWVudFRvVXJsXSA9IHVzZUFjdGl2ZVNlZ21lbnRGcm9tVXJsKCk7CiAgY29uc3QgaXNTeW5jZWRGcm9tVXJsVG9TdG9yZVJlZiA9IHVzZVJlZihmYWxzZSk7CgogIC8vIFN5bmMgU3RvcmUg4oaSIFVSTAogIHVzZUVmZmVjdCgoKSA9PiB7CiAgICAvLyBXZSBjYW4ndCBzeW5jIGZyb20gU3RvcmUgdG8gVVJMIGlmIFVSTCBoYXNuJ3QgZmlyc3QgYmVlbiBzeW5jZWQgdG8gU3RvcmUKICAgIC8vIFRoaXMgaXMgdG8gcHJldmVudCBvdmVycmlkZSBvZiBhbnkgdXNlciBjb25maWd1cmF0aW9uIHByb3ZpZGVkIGJ5IFVSTCBxdWVyeSBwYXJhbXMuIFRoaW5rIGFib3V0IHBhZ2UgYmVpbmcgcmVmcmVzaGVkCiAgICBpZiAoIWlzU3luY2VkRnJvbVVybFRvU3RvcmVSZWYuY3VycmVudCkgcmV0dXJuOwoKICAgIGNvbnN0IHVuc3Vic2NyaWJlID0gc3RvcmUuc3Vic2NyaWJlKChzdGF0ZSkgPT4gewogICAgICBpZiAoc3RhdGUuc2VsZWN0ZWRCb29raW5nVWlkICE9PSBzZWxlY3RlZEJvb2tpbmdVaWRGcm9tVXJsKSB7CiAgICAgICAgc2V0U2VsZWN0ZWRCb29raW5nVWlkVG9Vcmwoc3RhdCovCiAgb25TZWFyY2hDaGFuZ2U6IChxdWVyeTogc3RyaW5nKSA9PiB2b2lkOwogIC8qKiBQbGFjZWhvbGRlciB0ZXh0IGZvciBzZWFyY2ggaW5wdXQgKGRlZmF1bHQ6ICJTZWFyY2giKSAqLwogIHBsYWNlaG9sZGVyPzogc3RyaW5nOwogIC8qKiBDYWxsYmFjayB3aGVuIE5ldyBidXR0b24gaXMgcHJlc3NlZCAqLwogIG9uTmV3UHJlc3M6ICgpID0+IHZvaWQ7CiAgLyoqIFRleHQgZm9yIHRoZSBOZXcgYnV0dG9uIChkZWZhdWx0OiAiTmV3IikgKi8KICBuZXdCdXR0b25UZXh0Pzogc3RyaW5nOwp9CgovKioKICogUmV1c2FibGUgc2VhcmNoIGhlYWRlciBjb21wb25lbnQgd2l0aCBhIHNlYXJjaCBpbnB1dCBhbmQgIk5ldyIgYnV0dG9uLgogKiBVc2VkIGNvbnNpc3RlbnRseSBhY3Jvc3MgQW5kcm9pZCBsaXN0IHNjcmVlbnMuCiAqCiAqIEBleGFtcGxlCiAqIGBgYHRzeAogKiA8U2VhcmNoSGVhZGVyCiAqICAgc2VhcmNoUXVlcnk9e3NlYXJjaFF1ZXJ5fQogKiAgIG9uU2VhcmNoQ2hhbmdlPXtzZXRTZWFyY2hRdWVyeX0KICogICBwbGFjZWhvbGRlcj0iU2VhcmNoIGV2ZW50IHR5cGVzIgogKiAgIG9uTmV3UHJlc3M9e2hhbmRsZUNyZWF0ZU5ld30KICogLz4KICogYGBgCiAqLwpleHBvcnQgZnVuY3Rpb24gU2VhcmNoSGVhZGVyKHsKICBzZWFyY2hRdWVyeSwKICBvblNlYXJjaENoYW5nZSwKICBwbGFjZWhvbGRlciA9ICJTZWFyY2giLAogIG9uTmV3UHJlc3MsCiAgbmV3QnV0dG9uVGV4dCA9ICJOZXciLAp9OiBTZWFyY2hIZWFkZXJQcm9wcykgewogIGNvbnN0IGNvbG9yU2NoZW1lID0gdXNlQ29sb3JTY2hlbWUoKTsKICBjb25zdCBpc0RhcmsgPSBjb2xvclNjaGVtZSA9PT0gImRhcmsiOwoKICByZXR1cm4gKAogICAgPFZpZXcgY2xhc3NOYW1lPSJmbGV4LXJvdyBpdGVtcy1jZW50ZXIgZ2FwLTMgYm9yZGVyLWIgYm9yZGVyLWdyYXktMzAwIGJnLWdyYXktMTAwIHB4LTQgcHktMiBkYXJrOmJvcmRlci1bIzRENEQ0RF0gZGFyazpiZy1ibGFjayI+CiAgICAgIDxUZXh0SW5wdXQKICAgICAgICBjbGFzc05hbWU9ImZsZXgtMSByb3VuZGVkLWxnIGJvcmRlciBib3JkZXItZ3JheS0yMDAgYmctd2hpdGUgcHgtMyBweS0yIHRleHQtWzE3cHhdIHRleHQtYmxhY2sgZm9jdXM6Ym9yZGVyLWJsYWNrIGZvY3VzOnJpbmctMiBmb2N1czpyaW5nLWJsYWNrIGRhcms6Ym9yZGVyLVsjNEQ0RDREXSBkYXJrOmJnLVsjMTcxNzE3XSBkYXJrOnRleHQtd2hpdGUiCiAgICAgICAgcGxhY2Vob2xkZXI9e3BsYWNlaG9sZGVyfQogICAgICAgIHBsYWNlaG9sZGVyVGV4dENvbG9yPSIjOUNBM0FGIgogICAgICAgIHZhbHVlPXtzZWFyY2hRdWVyeX0KICAgICAgICBvbkNoYW5nZVRleHQ9e29uU2VhcmNoQ2hhbmdlfQogICAgICAgIGF1dG9DYXBpdGFsaXplPSJub25lIgogICAgICAgIGF1dG9Db3JyZWN0PXtmYWxzZX0KICAgICAgLz4KICAgICAgPFRvdWNoYWJsZU9wYWNpdHkKICAgICAgICBjbGFzc05hbWU9Im1pbi13LVs2MHB4XSBmbGV4LXJvdyBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgZ2FwLTEgcm91bmRlZC1sZyBiZy1ibGFjayBweC0yLjUgcHktMiBkYXJrOmJnLXdoaXRlIgogICAgICAgIG9uUHJlc3M9e29uTmV3UHJlc3N9CiAgICAgID4KICAgICAgICA8SW9uaWNvbnMgbmFtZT0iYWRkIiBzaXplPXsxOH0gY29sb3I9e2lzRGFyayA/ICIjMDAwIiA6ICIjZmZmIn0gLz4KICAgICAgICA8VGV4dCBjbGFzc05hbWU9InRleHQtYmFzZSBmb250LXNlbWlib2xkIHRleHQtd2hpdGUgZGFyazp0ZXh0LWJsYWNrIj57bmV3QnV0dG9uVGV4dH08L1RleHQ+CiAgICAgIDwvVG91Y2hhYmxlT3BhY2l0eT4KICAgIDwvVmlldz4KICApOwp9CgpleHBvcnQgdHlwZSB7IFNlYXJjaEhlYWRlclByb3BzIH07CiJ1c2UgY2xpZW50IgoKaW1wb3J0IHsgVHJlbmRpbmdVcCB9IGZyb20gImx1Y2lkZS1yZWFjdCIKaW1wb3J0IHsgUG9sYXJBbmdsZUF4aXMsIFBvbGFyR3JpZCwgUmFkYXIsIFJhZGFyQ2hhYTogUGF5bWVudFtdID0gWwogIHsKICAgIGlkOiAibTVncjg0aTkiLAogICAgYW1vdW50OiAzMTYsCiAgICBzdGF0dXM6ICJzdWNjZXNzIiwKICAgIGVtYWlsOiAia2VuOTlAZXhhbXBsZS5jb20iLAogIH0sCiAgewogICAgaWQ6ICIzdTFyZXV2NCIsCiAgICBhbW91bnQ6IDI0MiwKICAgIHN0YXR1czogInN1Y2Nlc3MiLAogICAgZW1haWw6ICJBYmU0NUBleGFtcGxlLmNvbSIsCiAgfSwKICB7CiAgICBpZDogImRlcnYxd3MwIiwKICAgIGFtb3VudDogODM3LAogICAgc3RhdHVzOiAicHJvY2Vzc2luZyIsCiAgICBlbWFpbDogIk1vbnNlcnJhdDQ0QGV4YW1wbGUuY29tIiwKICB9LAogIHsKICAgIGlkOiAiYmhxZWNqNHAiLAogICAgYW1vdW50OiA3MjEsCiAgICBzdGF0dXM6ICJmYWlsZWQiLAogICAgZW1haWw6ICJjYXJtZWxsYUBleGFtcGxlLmNvbSIsCiAgfSwKICB7CiAgICBpZDogIms5ZjJtM240IiwKICAgIGFtb3VudDogNDUwLAogICAgc3RhdHVzOiAicGVuZGluZyIsCiAgICBlbWFpbDogImphc29uNzhAZXhhbXBsZS5jb20iLAogIH0sCiAgewogICAgaWQ6ICJwNXE2cjdzOCIsCiAgICBhbW91bnQ6IDEyODAsCiAgICBzdGF0dXM6ICJzdWNjZXNzIiwKICAgIGVtYWlsOiAic2FyYWgyM0BleGFtcGxlLmNvbSIsCiAgfSwKXQoKZXhwb3J0IHR5cGUgUGF5bWVudCA9IHsKICBpZDogc3RyaW5nCiAgYW1vdW50OiBudW1iZXIKICBzdGF0dXM6ICJwZW5kaW5nIiB8ICJwcm9jZXNzaW5nIiB8ICJzdWNjZXNzIiB8ICJmYWlsZWQiCiAgZW1haWw6IHN0cmluZwp9CgpleHBvcnQgY29uc3QgY29sdW1uczogQ29sdW1uRGVmPFBheW1lbnQ+W10gPSBbCiAgewogICAgaWQ6ICJzZWxlY3QiLAogICAgaGVhZGVyOiAoeyB0YWJsZSB9KSA9PiAoCiAgICAgIDxDaGVja2JveAogICAgICAgIGNoZWNrZWQ9ewogICAgICAgICAgdGFibGUuZ2V0SXNBbGxQYWdlUm93c1NlbGVjdGVkKCkgfHwKICAgICAgICAgICh0YWJsZS5nZXRJc1NvbWVQYWdlUm93c1NlbGVjdGVkKCkgJiYgImluZGV0ZXJtaW5hdGUiKQogICAgICAgIH0KICAgICAgICBvbkNoZWNrZWRDaGFuZ2U9eyh2YWx1ZSkgPT4gdGFibGUudG9nZ2xlQWxsUGFnZVJvd3NTZWxlY3RlZCghIXZhbHVlKX0KICAgICAgICBhcmlhLWxhYmVsPSJTZWxlY3QgYWxsIgogICAgICAvPgogICAgKSwKICAgIGNlbGw6ICh7IHJvdyB9KSA9PiAoCiAgICAgIDxDaGVja2JveAogICAgICAgIGNoZWNrZWQ9e3Jvdy5nZXRJc1NlbGVjdGVkKCl9CiAgICAgICAgb25DaGVja2VkQ2hhbmdlPXsodmFsdWUpID0+IHJvdy50b2dnbGVTZWxlY3RlZCghIXZhbHVlKX0KICAgICAgICBhcmlhLWxhYmVsPSJTZWxlY3Qgcm93IgogICAgICAvPgogICAgKSwKICAgIGVuYWJsZVNvcnRpbmc6IGZhbHNlLAogICAgZW5hYmxlSGlkaW5nOiBmYWxzZSwKICB9LAogIHsKICAgIGFjY2Vzc29yS2V5OiAic3RhdHVzIiwKICAgIGhlYWRlcjogIlN0YXR1cyIsCiAgICBjZWxsOiAoeyByb3cgfSkgPT4gKAogICAgICA8ZGl2IGNsYXNzTmFtZT0iY2FwaXRhbGl6ZSI+e3Jvdy5nZXRWYWx1ZSgic3RhdHVzIil9PC9kaXY+CiAgICApLAogIH0sCiAgewogICAgYWNjZXNzb3JLZXk6ICJlbWFpbCIsCiAgICBoZWFkZXI6ICJFbWFpbCIsCiAgICBjZWxsOiAoeyByb3cgfSkgPT4gPGRpdiBjbGFzc05hbWU9Imxvd2VyY2FzZSI+e3Jvdy5nZXRWYWx1ZSgiZW1haWwiKX08L2Rpdj4sCiAgfSwKICB7CiAgICBhY2Nlc3NvcktleTogImFtb3VudCIsCiAgICBoZWFkZXI6ICgpID0+IDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LXJpZ2h0Ij5BbW91bnQ8L2Rpdj4sCiAgICBjZWxsOiAoeyByb3cgfSkgPT4gewogICAgICBjb25zdCBhbW91bnQgPSBwYXJzZUZsb2F0KHJvdy5nZXRWYWx1ZSgiYW1vdW50IikpCgogICAgICAvLyBGb3JtYXQgdGhlIGFtb3VudCBhcyBhIGRvbGxhciBhbW91bnQKICAgICAgY29uc3QgZm9ybWF0dGVkID0gbmV3IEludGwuTnVtYmVyRm9ybWF0KCJlbi1kYWxzL1dhcm5pbmdNb2RhbC90eXBlcycKaW1wb3J0IFdhcm5pbmdJY29uIGZyb20gJ3VuaXN3YXAvc3JjL2NvbXBvbmVudHMvd2FybmluZ3MvV2FybmluZ0ljb24nCmltcG9ydCB7IEN1cnJlbmN5SW5mbyB9IGZyb20gJ3VuaXN3YXAvc3JjL2ZlYXR1cmVzL2RhdGFBcGkvdHlwZXMnCmltcG9ydCB7IHVzZUxvY2FsaXphdGlvbkNvbnRleHQgfSBmcm9tICd1bmlzd2FwL3NyYy9mZWF0dXJlcy9sYW5ndWFnZS9Mb2NhbGl6YXRpb25Db250ZXh0JwppbXBvcnQgeyBFbGVtZW50TmFtZSwgVW5pc3dhcEV2ZW50TmFtZSB9IGZyb20gJ3VuaXN3YXAvc3JjL2ZlYXR1cmVzL3RlbGVtZXRyeS9jb25zdGFudHMnCmltcG9ydCBUcmFjZSBmcm9tICd1bmlzd2FwL3NyYy9mZWF0dXJlcy90ZWxlbWV0cnkvVHJhY2UnCmltcG9ydCB7IGdldFRva2VuV2FybmluZ1NldmVyaXR5IH0gZnJvbSAndW5pc3dhcC9zcmMvZmVhdHVyZXMvdG9rZW5zL3dhcm5pbmdzL3NhZmV0eVV0aWxzJwppbXBvcnQgeyBzaG9ydGVuQWRkcmVzcyB9IGZyb20gJ3V0aWxpdGllcy9zcmMvYWRkcmVzc2VzJwppbXBvcnQgeyBOdW1iZXJUeXBlIH0gZnJvbSAndXRpbGl0aWVzL3NyYy9mb3JtYXQvdHlwZXMnCmltcG9ydCB7IGN1cnJlbmN5S2V5IH0gZnJvbSAndXRpbHMvY3VycmVuY3lLZXknCgpmdW5jdGlvbiBjdXJyZW5jeUxpc3RSb3dLZXkoZGF0YTogQ3VycmVuY3kpOiBzdHJpbmcgewogIHJldHVybiBjdXJyZW5jeUtleShkYXRhKQp9Cgpjb25zdCBUZXh0T3ZlcmZsb3dTdHlsZSA9IHsKICB3aGl0ZVNwYWNlOiAnbm93cmFwJywKICBvdmVyZmxvdzogJ2hpZGRlbicsCiAgdGV4dE92ZXJmbG93OiAnZWxsaXBzaXMnLAp9IHNhdGlzZmllcyBUZXh0U3R5bGUKCmNvbnN0IFN0eWxlZEJhbGFuY2VUZXh0ID0gc3R5bGVkKFRleHQsIHsKICAuLi5UZXh0T3ZlcmZsb3dTdHlsZSwKICBtYXhXaWR0aDogJzgwcHgnLAogIHRleHRBbGlnbjogJ3JpZ2h0JywKfSkKCmNvbnN0IEN1cnJlbmN5TmFtZSA9IHN0eWxlZChUZXh0LCBUZXh0T3ZlcmZsb3dTdHlsZSkKCmNvbnN0IFRhZyA9IHN0eWxlZChUZXh0LCB7CiAgYmFja2dyb3VuZENvbG9yOiAnJHN1cmZhY2UyJywKICBjb2xvcjogJyRuZXV0cmFsMicsCiAgZm9udFNpemU6ICcxNHB4JywKICBib3JkZXJSYWRpdXM6ICckcm91bmRlZDQnLAogIHA6ICckc3BhY2luZzQnLAogIG1heFdpZHRoOiAnMTAwcHgnLAogIG92ZXJmbG93OiAnaGlkZGVuJywKICB0ZXh0T3ZlcmZsb3c6ICdlbGxpcHNpcycsCiAgd2hpdGVTcGFjZTogJ25vd3JhcCcsCiAgYWxpZ25TZWxmOiAnZmxleC1lbmQnLAogIG1yOiAnJHNwYWNpbmc0JywKfSkKCmZ1bmN0aW9uIFRva2VuVGFncyh7IGN1cnJlbmN5IH06IHsgY3VycmVuY3k6IEN1cnJlbmN5IH0pIHsKICBpZiAoIShjdXJyZW5jeSBpbnN0YW5jZW9mIFRva2VuRnJvbUxpc3QpKSB7CiAgICByZXR1cm4gbnVsbAogIH0KCiAgY29uc3QgdGFncyA9IGN1cnJlbmN5LnRhZ3MKICBpZiAodGFncy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiA8c3BhbiAvPgogIH0KCiAgY29uc3QgdGFnID0gdGFnc1swXQoKICByZXR1cm4gKAogICAgPEZsZXgganVzdGlmeUNvbnRlbnQ9ImZsZXgtZW5kIj4KICAgICAgPE1vdXNlb3ZlclRvb2x0aXAgdGV4dD17dGFnLmRlc2NyaXB0aW9ufT4KICAgICAgICA8VGFnIGtleT17dGFnLmlkfT57dGFnLm5hbWV9PC9UYWc+CiAgICAgIDwvTW91c2VvdmVyVG9vbHRpcD4KICAgICAge3RhZ3MubGVuZ3RoID4gMSA/ICgKICAgICAgICA8TW91c2VvdmVyVG9vbHRpcAogICAgICAgICAgdGV4dD17dGFncwogICAgICAgICAgICAuc2xpY2UoMSkKICAgICAgICAgICAgLm1hcCgoeyBuYW1lLCBkZXNjcmlwdGlvbiB9KSA9PiBgJHtuYW1lfTogJHtkZXNjcmlwdGlvbn1gKQogICAgICAgICAgICAuam9pbignOyBcbicpfQogICAgICAgID4KICAgICAgICAgIDxUYWc+Li4uPC9UYWcgICAibWluLWgtc3ZoIGJnLWJhY2tncm91bmQgZm9udC1zYW5zIGFudGlhbGlhc2VkIiwKICAgICAgICAgICAgZm9udFNhbnMudmFyaWFibGUsCiAgICAgICAgICAgIGZvbnRNb25vLnZhcmlhYmxlCiAgICAgICAgICApfQogICAgICAgID4KICAgICAgICAgIDxUaGVtZVByb3ZpZGVyCiAgICAgICAgICAgIGF0dHJpYnV0ZT0iY2xhc3MiCiAgICAgICAgICAgIGRlZmF1bHRUaGVtZT0ic3lzdGVtIgogICAgICAgICAgICBlbmFibGVTeXN0ZW0KICAgICAgICAgICAgZGlzYWJsZVRyYW5zaXRpb25PbkNoYW5nZQogICAgICAgICAgICBlbmFibGVDb2xvclNjaGVtZQogICAgICAgICAgPgogICAgICAgICAgICA8ZGl2IHZhdWwtZHJhd2VyLXdyYXBwZXI9IiI+CiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InJlbGF0aXZlIGZsZXggbWluLWgtc3ZoIGZsZXgtY29sIGJnLWJhY2tncm91bmQiPgogICAgICAgICAgICAgICAge2NoaWxkcmVufQogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPFRhaWx3aW5kSW5kaWNhdG9yIC8+CiAgICAgICAgICAgIDxUaGVtZVN3aXRjaGVyIC8+CiAgICAgICAgICAgIDxBbmFseXRpY3MgLz4KICAgICAgICAgICAgPE5ld1lvcmtUb2FzdGVyIC8+CiAgICAgICAgICAgIDxEZWZhdWx0VG9hc3RlciAvPgogICAgICAgICAgICA8TmV3WW9ya1Nvbm5lciAvPgogICAgICAgICAgPC9UaGVtZVByb3ZpZGVyPgogICAgICAgIDwvYm9keT4KICAgICAgPC9odG1sPgogICAgPC8+CiAgKQp9CmltcG9ydCB7IEcsIFBhdGgsIFN2ZyB9IGZyb20gJ3JlYWN0LW5hdGl2ZS1zdmcnCgovLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVsYXRpdmUtaW1wb3J0LXBhdGhzL25vLXJlbGF0aXZlLWltcG9ydC1wYXRocwppbXBvcnQgeyBjcmVhdGVJY29uIH0gZnJvbSAnLi4vZmFjdG9yaWVzL2NyZWF0ZUljb24nCgpleHBvcnQgY29uc3QgW1NpZ25hdHVyZSwgQW5pbWF0ZWRTaWduYXR1cmVdID0gY3JlYXRlSWNvbih7CiAgbmFtZTogJ1NpZ25hdHVyZScsCiAgZ2V0SWNvbjogKHByb3BzKSA9PiAoCiAgICA8U3ZnIHZpZXdCb3g9IjAgMCAxNiAxNiIgZmlsbD0ibm9uZSIgey4uLnByb3BzfT4KICAgICAgPEcgaWQ9InNpZ25hdHVyZSI+CiAgICAgICAgPFBhdGgKICAgICAgICAgIGlkPSJWZWN0b3IiCiAgICAgICAgICBkPSJNMC4zMzk1MTQgMTIuNDI0OUgzLjkxMjQzQzMuODQyMzcgMTIuNjk0MyAzLjgwNDYzIDEyLjk1ODQgMy44MDQ2MyAxMy4yMDA5QzMuODA0NjMgMTQuMDY4NSA0LjI4OTY2IDE0LjY4ODMgNS4zMDgxNyAxNC42ODgzQzYuNTQ3NjYgMTQuNjg4MyA3LjU1IDEzLjgxNTMgOC4xOTY2OSAxMi40MjQ5SDE1LjY2MDVDMTUuODQ5MSAxMi40MjQ5IDE2IDEyLjI3OTQgMTYgMTIuMDkwOEMxNiAxMS45MDIyIDE1Ljg0OTEgMTEuNzYyMSAxNS42NjA1IDExLjc2MjFIOC40NjYxNEM4Ljc2NzkxIDEwLjg3ODMgOC45NTExNCA5Ljg0MzU3IDguOTg4ODkgOC43MjI2M0M5LjMyODQgOC42NDcyIDkuNjg0MDMgOC42MDk0NiAxMC4wNTA1IDguNjA5NDZDMTAuMjM5MiA4LjYwOTQ2IDEwLjM0NjkgOC42OTAzMSAxMC4zNDY5IDguODMwNDNDMTAuMzQ2OSA5LjI5OTI2IDEwLjA5MzYgOS42NjU3MSAxMC4wOTM2IDEwLjEzNDZDMTAuMDkzNiAxMC41NDQxIDEwLjM5NTUgMTAuNzkyIDEwLjc4ODggMTAuNzkyQzExLjg4MjcgMTAuNzkyIDEzLjIwMzEgOC45MjIwMyAxMy42Mzk2IDguOTIyMDNDMTQuMDM4MyA4LjkyMjAzIDEzLjU0MjYgMTAuNjAzNCAxNC45MDA2IDEwLjYwMzRDMTUuMTIxNiAxMC42MDM0IDE1LjQwNzIgMTAuNTQ0MSAxNS42MjgyIDEwLjQwNEMxNS43NTc1IDEwLjMxMjQgMTUuODQ5MSAxMC4xODMxIDE1Ljg0OTEgMTAuMDE2QzE1Ljg0OTEgOS44MTEyMyAxNS43MTk4IDkuNjQ0MTcgMTUuNTA0MiA5LjY0NDE3QzE1LjMxNTYgOS42NDQxNyAxNS4xNTkzIDkuODAwNDMgMTQuOTc2MSA5LjgwMDQzQzE0ICAgICJiZy1wb3BvdmVyIHRleHQtcG9wb3Zlci1mb3JlZ3JvdW5kIGRhdGEtb3BlbjphbmltYXRlLWluIGRhdGEtY2xvc2VkOmFuaW1hdGUtb3V0IGRhdGEtY2xvc2VkOmZhZGUtb3V0LTAgZGF0YS1vcGVuOmZhZGUtaW4tMCBkYXRhLWNsb3NlZDp6b29tLW91dC05NSBkYXRhLW9wZW46em9vbS1pbi05NSBkYXRhLVtzaWRlPWJvdHRvbV06c2xpZGUtaW4tZnJvbS10b3AtMiBkYXRhLVtzaWRlPWxlZnRdOnNsaWRlLWluLWZyb20tcmlnaHQtMiBkYXRhLVtzaWRlPXJpZ2h0XTpzbGlkZS1pbi1mcm9tLWxlZnQtMiBkYXRhLVtzaWRlPXRvcF06c2xpZGUtaW4tZnJvbS1ib3R0b20tMiByaW5nLWZvcmVncm91bmQvMTAgKjpkYXRhLVtzbG90PWlucHV0LWdyb3VwXTpiZy1pbnB1dC8zMCAqOmRhdGEtW3Nsb3Q9aW5wdXQtZ3JvdXBdOmJvcmRlci1pbnB1dC8zMCBkYXRhLVtzaWRlPWlubGluZS1zdGFydF06c2xpZGUtaW4tZnJvbS1yaWdodC0yIGRhdGEtW3NpZGU9aW5saW5lLWVuZF06c2xpZGUtaW4tZnJvbS1sZWZ0LTIgY24tbWVudS10YXJnZXQgZ3JvdXAvY29tYm9ib3gtY29udGVudCByZWxhdGl2ZSBtYXgtaC0oLS1hdmFpbGFibGUtaGVpZ2h0KSBtYXgtaC03MiB3LSgtLWFuY2hvci13aWR0aCkgbWF4LXctKC0tYXZhaWxhYmxlLXdpZHRoKSBtaW4tdy0zNiBtaW4tdy1bY2FsYyh2YXIoLS1hbmNob3Itd2lkdGgpKy0tc3BhY2luZyg3KSldIG9yaWdpbi0oLS10cmFuc2Zvcm0tb3JpZ2luKSBvdmVyZmxvdy1oaWRkZW4gcm91bmRlZC1sZyBzaGFkb3ctbWQgcmluZy0xIGR1cmF0aW9uLTEwMCBkYXRhLVtjaGlwcz10cnVlXTptaW4tdy0oLS1hbmNob3Itd2lkdGgpICo6ZGF0YS1bc2xvdD1pbnB1dC1ncm91cF06bS0xICo6ZGF0YS1bc2xvdD1pbnB1dC1ncm91cF06bWItMCAqOmRhdGEtW3Nsb3Q9aW5wdXQtZ3JvdXBdOmgtOCAqOmRhdGEtW3Nsb3Q9aW5wdXQtZ3JvdXBdOnNoYWRvdy1ub25lIiwKICAgICAgICAgICAgY2xhc3NOYW1lCiAgICAgICAgICApfQogICAgICAgICAgey4uLnByb3BzfQogICAgICAgIC8+CiAgICAgIDwvQ29tYm9ib3hQcmltaXRpdmUuUG9zaXRpb25lcj4KICAgIDwvQ29tYm9ib3hQcmltaXRpdmUuUG9ydGFsPgogICkKfQoKZnVuY3Rpb24gQ29tYm9ib3hMaXN0KHsgY2xhc3NOYW1lLCAuLi5wcm9wcyB9OiBDb21ib2JveFByaW1pdGl2ZS5MaXN0LlByb3BzKSB7CiAgcmV0dXJuICgKICAgIDxDb21ib2JveFByaW1pdGl2ZS5MaXN0CiAgICAgIGRhdGEtc2xvdD0iY29tYm9ib3gtbGlzdCIKICAgICAgY2xhc3NOYW1lPXtjbigKICAgICAgICAibm8tc2Nyb2xsYmFyIG1heC1oLVttaW4oY2FsYygtLXNwYWNpbmcoNzIpLS0tc3BhY2luZyg5KSksY2FsYyh2YXIoLS1hdmFpbGFibGUtaGVpZ2h0KS0tLXNwYWNpbmcoOSkpKV0gc2Nyb2xsLXB5LTEgb3ZlcmZsb3cteS1hdXRvIG92ZXJzY3JvbGwtY29udGFpbiBwLTEgZGF0YS1lbXB0eTpwLTAiLAogICAgICAgIGNsYXNzTmFtZQogICAgICApfQogICAgICB7Li4ucHJvcHN9CiAgICAvPgogICkKfQoKZnVuY3Rpb24gQ29tYm9ib3hJdGVtKHsKICBjbGFzc05hbWUsCiAgY2hpbGRyZW4sCiAgLi4ucHJvcHMKfTogQ29tYm9ib3hQcmltaXRpdmUuSXRlbS5Qcm9wcykgewogIHJldHVybiAoCiAgICA8Q29tYm9ib3hQcmltaXRpdmUuSXRlbQogICAgICBkYXRhLXNsb3Q9ImNvbWJvYm94LWl0ZW0iCiAgICAgIGNsYXNzTmFtZT17Y24oCiAgICAgICAgImRhdGEtaGlnaGxpZ2h0ZWQ6YmctYWNjZW50IGRhdGEtaGlnaGxpZ2h0ZWQ6dGV4dC1hY2NlbnQtZm9yZWdyb3VuZCBub3QtZGF0YS1bdmFyaWFudD1kZXN0cnVjdGl2ZV06ZGF0YS1oaWdobGlnaHRlZDoqKjp0ZXh0LWFjY2VudC1mb3JlZ3JvdW5kIHJlbGF0aXZlIGZsZXggdy1mdWxsIGN1cnNvci1kZWZhdWx0IGl0ZW1zLWNlbnRlciBnYXAtMiByb3VuZGVkLW1kIHB5LTEgcHItOCBwbC0xLjUgdGV4dC1zbSBvdXRsaW5lLWhpZGRlbiBzZWx5SWQnCmltcG9ydCB7IGdldFRva2VuRGV0YWlsc1VSTCB9IGZyb20gJ3VuaXN3YXAvc3JjL3V0aWxzL2xpbmtpbmcnCmltcG9ydCB7IHVzZUV2ZW50IH0gZnJvbSAndXRpbGl0aWVzL3NyYy9yZWFjdC9ob29rcycKaW1wb3J0IHsgbm9vcCB9IGZyb20gJ3V0aWxpdGllcy9zcmMvcmVhY3Qvbm9vcCcKaW1wb3J0IHsgZ2V0Q2hhaW5VcmxQYXJhbSB9IGZyb20gJ3V0aWxzL2NoYWluUGFyYW1zJwoKZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gVG9rZW5zVGFiKHsKICBldm1Pd25lciwKICBzdm1Pd25lciwKfTogewogIGV2bU93bmVyOiBBZGRyZXNzIHwgdW5kZWZpbmVkCiAgc3ZtT3duZXI6IEFkZHJlc3MgfCB1bmRlZmluZWQKfSk6IEpTWC5FbGVtZW50IHsKICBjb25zdCBhY2NvdW50RHJhd2VyID0gdXNlQWNjb3VudERyYXdlcigpCiAgY29uc3QgeyBpc1Rlc3RuZXRNb2RlRW5hYmxlZCB9ID0gdXNlRW5hYmxlZENoYWlucygpCiAgY29uc3QgbmF2aWdhdGUgPSB1c2VOYXZpZ2F0ZSgpCgogIGNvbnN0IHsgb3Blbk1vZGFsIH0gPSB1c2VNb2RhbFN0YXRlKE1vZGFsTmFtZS5SZXBvcnRUb2tlbklzc3VlKQogIGNvbnN0IFssIHNldE1vZGFsUHJvcHNdID0gdXNlQXRvbShSZXBvcnRUb2tlbklzc3VlTW9kYWxQcm9wc0F0b20pCiAgY29uc3Qgb3BlblJlcG9ydFRva2VuTW9kYWwgPSB1c2VFdmVudCgoY3VycmVuY3k6IEN1cnJlbmN5LCBpc01hcmtlZFNwYW06IE1heWJlPGJvb2xlYW4+KSA9PiB7CiAgICBzZXRNb2RhbFByb3BzKHsgc291cmNlOiAncG9ydGZvbGlvJywgY3VycmVuY3ksIGlzTWFya2VkU3BhbSB9KQogICAgb3Blbk1vZGFsKCkKICB9KQoKICBjb25zdCBuYXZpZ2F0ZVRvVG9rZW5EZXRhaWxzID0gdXNlQ2FsbGJhY2soCiAgICBhc3luYyAoY3VycmVuY3lJZDogQ3VycmVuY3lJZCkgPT4gewogICAgICBjb25zdCBhZGRyZXNzID0gY3VycmVuY3lJZFRvQWRkcmVzcyhjdXJyZW5jeUlkKQogICAgICBjb25zdCBjaGFpbiA9IGN1cnJlbmN5SWRUb0NoYWluKGN1cnJlbmN5SWQpCgogICAgICBpZiAoaXNUZXN0bmV0TW9kZUVuYWJsZWQgfHwgIWNoYWluKSB7CiAgICAgICAgcmV0dXJuCiAgICAgIH0KCiAgICAgIG5hdmlnYXRlKAogICAgICAgIGdldFRva2VuRGV0YWlsc1VSTCh7CiAgICAgICAgICBhZGRyZXNzLAogICAgICAgICAgY2hhaW4sCiAgICAgICAgICBjaGFpblVybFBhcmFtOiBnZXRDaGFpblVybFBhcmFtKGNoYWluKSwKICAgICAgICAgIGlucHV0QWRkcmVzczogYWRkcmVzcywKICAgICAgICB9KSwKICAgICAgKQogICAgICBhY2NvdW50RHJhd2VyLmNsb3NlKCkKICAgIH0sCiAgICBbYWNjb3VudERyYXdlciwgaXNUZXN0bmV0TW9kZUVuYWJsZWQsIG5hdmlnYXRlXSwKICApCgogIHJldHVybiAoCiAgICA8RmxleCBteD0iJHNwYWNpbmc4Ij4KICAgICAgPFRva2VuQmFsYW5jZUxpc3RXZWIKICAgICAgICBldm1Pd25lcj17ZXZtT3duZXJ9CiAgICAgICAgc3ZtT3duZXI9e3N2bU93bmVyfQogICAgICAgIG9uUHJlc3NSZWNlaXZlPXtub29wfQogICAgICAgIG9uUHJlc3NCdXk9e25vb3B9CiAgICAgICAgb25QcmVzc1Rva2VuPXtuYXZpZ2F0ZVRvVG9rZW5EZXRhaWxzfQogICAgICAgIG9wZW5SZXBvcnRUb2tlbk1vZGFsPXtvcGVuUmVwb3J0VG9rZW5Nb2RhbH0KICAgICAgLz4KICAgIDwvRmxleD4KICApCn0KaW1wb3J0IHsgTmF0aXZlU3RhY2tTY3JlZW5Qcm9wcyB9IGZyb20gJ0ByZWFjdC1uYXZpZ2F0aW9uL25hdGl2ZS1zdGFjaycKaW1wb3J0IFJlYWN0LCB7IHVzZUNhbGxiYWNrLCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JwppbXBvcnQgeyB1c2VUcmFuc2xhdGlvbiB9IGZyb20gJ3JlYWN0LWkxOG5leHQnCmltcG9ydCB7IEFjdGl2aXR5SW5kaWNhdG9yLCBJbWFnZSwgUGxhdGZvcm0sIFN0eWxlU2hlZXQgfSBmcm9tICdyZWFjdC1uYXRpdmUnCmltcG9ydCB7IHVzZURpc3BhdGNoIH0gZnJvbSAncmVhY3QtcmVkdXgnCmltcGUiCgppbXBvcnQgewogIFRhYmxlLAogIFRhYmxlQm9keSwKICBUYWJsZUNlbGwsCiAgVGFibGVIZWFkLAogIFRhYmxlSGVhZGVyLAogIFRhYmxlUm93LAp9IGZyb20gIkAvcmVnaXN0cnkvbmV3LXlvcmstdjQvdWkvdGFibGUiCgppbXBvcnQgeyBEYXRhVGFibGVQYWdpbmF0aW9uIH0gZnJvbSAiLi9kYXRhLXRhYmxlLXBhZ2luYXRpb24iCmltcG9ydCB7IERhdGFUYWJsZVRvb2xiYXIgfSBmcm9tICIuL2RhdGEtdGFibGUtdG9vbGJhciIKCmludGVyZmFjZSBEYXRhVGFibGVQcm9wczxURGF0YSwgVFZhbHVlPiB7CiAgY29sdW1uczogQ29sdW1uRGVmPFREYXRhLCBUVmFsdWU+W10KICBkYXRhOiBURGF0YVtdCn0KCmV4cG9ydCBmdW5jdGlvbiBEYXRhVGFibGU8VERhdGEsIFRWYWx1ZT4oewogIGNvbHVtbnMsCiAgZGF0YSwKfTogRGF0YVRhYmxlUHJvcHM8VERhdGEsIFRWYWx1ZT4pIHsKICBjb25zdCBbcm93U2VsZWN0aW9uLCBzZXRSb3dTZWxlY3Rpb25dID0gUmVhY3QudXNlU3RhdGUoe30pCiAgY29uc3QgW2NvbHVtblZpc2liaWxpdHksIHNldENvbHVtblZpc2liaWxpdHldID0KICAgIFJlYWN0LnVzZVN0YXRlPFZpc2liaWxpdHlTdGF0ZT4oe30pCiAgY29uc3QgW2NvbHVtbkZpbHRlcnMsIHNldENvbHVtbkZpbHRlcnNdID0gUmVhY3QudXNlU3RhdGU8Q29sdW1uRmlsdGVyc1N0YXRlPigKICAgIFtdCiAgKQogIGNvbnN0IFtzb3J0aW5nLCBzZXRTb3J0aW5nXSA9IFJlYWN0LnVzZVN0YXRlPFNvcnRpbmdTdGF0ZT4oW10pCgogIGNvbnN0IHRhYmxlID0gdXNlUmVhY3RUYWJsZSh7CiAgICBkYXRhLAogICAgY29sdW1ucywKICAgIHN0YXRlOiB7CiAgICAgIHNvcnRpbmcsCiAgICAgIGNvbHVtblZpc2liaWxpdHksCiAgICAgIHJvd1NlbGVjdGlvbiwKICAgICAgY29sdW1uRmlsdGVycywKICAgIH0sCiAgICBpbml0aWFsU3RhdGU6IHsKICAgICAgcGFnaW5hdGlvbjogewogICAgICAgIHBhZ2VTaXplOiAyNSwKICAgICAgfSwKICAgIH0sCiAgICBlbmFibGVSb3dTZWxlY3Rpb246IHRydWUsCiAgICBvblJvd1NlbGVjdGlvbkNoYW5nZTogc2V0Um93U2VsZWN0aW9uLAogICAgb25Tb3J0aW5nQ2hhbmdlOiBzZXRTb3J0aW5nLAogICAgb25Db2x1bW5GaWx0ZXJzQ2hhbmdlOiBzZXRDb2x1bW5GaWx0ZXJzLAogICAgb25Db2x1bW5WaXNpYmlsaXR5Q2hhbmdlOiBzZXRDb2x1bW5WaXNpYmlsaXR5LAogICAgZ2V0Q29yZVJvd01vZGVsOiBnZXRDb3JlUm93TW9kZWwoKSwKICAgIGdldEZpbHRlcmVkUm93TW9kZWw6IGdldEZpbHRlcmVkUm93TW9kZWwoKSwKICAgIGdldFBhZ2luYXRpb25Sb3dNb2RlbDogZ2V0UGFnaW5hdGlvblJvd01vZGVsKCksCiAgICBnZXRTb3J0ZWRSb3dNb2RlbDogZ2V0U29ydGVkUm93TW9kZWwoKSwKICAgIGdldEZhY2V0ZWRSb3dNb2RlbDogZ2V0RmFjZXRlZFJvd01vZGVsKCksCiAgICBnZXRGYWNldGVkVW5pcXVlVmFsdWVzOiBnZXRGYWNldGVkVW5pcXVlVmFsdWVzKCksCiAgfSkKCiAgcmV0dXJuICgKICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGZsZXgtY29sIGdhcC00Ij4KICAgICAgPERhdGFUYWJsZVRvb2xiYXIgdGFibGU9e3RhYmxlfSAvPgogICAgICA8ZGl2IGNsYXNzTmFtZT0ib3ZlcmZsb3ctaGlkZGVuIHJvdW5kZWQtbWQgYm9yZGVyIj4KICAgICAgICA8VGFibGU+CiAgICAgICAgICA8VGFibGVIZWFkZXI+CiAgICAgICAgICAgIHt0YWJsZS5nZXRIZWFkZXJHcm91cHMoKS5tYXAoKGhlYWRlckdyb3VwKSA9PiAoCiAgICAgICAgICAgICAgPFRhYmxlUm93IGtleT17aGVhZGVyR3JvdXAuaWR9PgogICAgICAgICAgICAgICAge2hlYWRlckdyb3VwLmhlYWRlcnMubWFwKChoZWFkZXIpID0+IHsKICAgICAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgICAgICA8VGFibGVIZWFkIGtleT17aGVhZGVyLmlkfSBjb2xTcGFuPXtoZWFkZXIuY29sU3Bhbn0+CiAgICAgICAgICAgICAgICAgICAgICB7aGVhZGVyLmlzUGxhY2Vpb24gVGVhbVN3aXRjaGVyKHsKICB0ZWFtcywKfTogewogIHRlYW1zOiB7CiAgICBuYW1lOiBzdHJpbmcKICAgIGxvZ286IFJlYWN0LkVsZW1lbnRUeXBlCiAgICBwbGFuOiBzdHJpbmcKICB9W10KfSkgewogIGNvbnN0IHsgaXNNb2JpbGUgfSA9IHVzZVNpZGViYXIoKQogIGNvbnN0IFthY3RpdmVUZWFtLCBzZXRBY3RpdmVUZWFtXSA9IFJlYWN0LnVzZVN0YXRlKHRlYW1zWzBdKQoKICBpZiAoIWFjdGl2ZVRlYW0pIHsKICAgIHJldHVybiBudWxsCiAgfQoKICByZXR1cm4gKAogICAgPFNpZGViYXJNZW51PgogICAgICA8U2lkZWJhck1lbnVJdGVtPgogICAgICAgIDxEcm9wZG93bk1lbnU+CiAgICAgICAgICA8RHJvcGRvd25NZW51VHJpZ2dlciBhc0NoaWxkPgogICAgICAgICAgICA8U2lkZWJhck1lbnVCdXR0b24KICAgICAgICAgICAgICBzaXplPSJsZyIKICAgICAgICAgICAgICBjbGFzc05hbWU9ImRhdGEtW3N0YXRlPW9wZW5dOmJnLXNpZGViYXItYWNjZW50IGRhdGEtW3N0YXRlPW9wZW5dOnRleHQtc2lkZWJhci1hY2NlbnQtZm9yZWdyb3VuZCIKICAgICAgICAgICAgPgogICAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGFzcGVjdC1zcXVhcmUgc2l6ZS04IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciByb3VuZGVkLWxnIGJnLXNpZGViYXItcHJpbWFyeSB0ZXh0LXNpZGViYXItcHJpbWFyeS1mb3JlZ3JvdW5kIj4KICAgICAgICAgICAgICAgIDxhY3RpdmVUZWFtLmxvZ28gY2xhc3NOYW1lPSJzaXplLTQiIC8+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImdyaWQgZmxleC0xIHRleHQtbGVmdCB0ZXh0LXNtIGxlYWRpbmctdGlnaHQiPgogICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSJ0cnVuY2F0ZSBmb250LXNlbWlib2xkIj4KICAgICAgICAgICAgICAgICAge2FjdGl2ZVRlYW0ubmFtZX0KICAgICAgICAgICAgICAgIDwvc3Bhbj4KICAgICAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0idHJ1bmNhdGUgdGV4dC14cyI+e2FjdGl2ZVRlYW0ucGxhbn08L3NwYW4+CiAgICAgICAgICAgICAgPC9kaXY+CiAgICAgICAgICAgICAgPENoZXZyb25zVXBEb3duIGNsYXNzTmFtZT0ibWwtYXV0byIgLz4KICAgICAgICAgICAgPC9TaWRlYmFyTWVudUJ1dHRvbj4KICAgICAgICAgIDwvRHJvcGRvd25NZW51VHJpZ2dlcj4KICAgICAgICAgIDxEcm9wZG93bk1lbnVDb250ZW50CiAgICAgICAgICAgIGNsYXNzTmFtZT0idy1bLS1yYWRpeC1kcm9wZG93bi1tZW51LXRyaWdnZXItd2lkdGhdIG1pbi13LTU2IHJvdW5kZWQtbGciCiAgICAgICAgICAgIGFsaWduPSJzdGFydCIKICAgICAgICAgICAgc2lkZT17aXNNb2JpbGUgPyAiYm90dG9tIiA6ICJyaWdodCJ9CiAgICAgICAgICAgIHNpZGVPZmZzZXQ9ezR9CiAgICAgICAgICA+CiAgICAgICAgICAgIDxEcm9wZG93bk1lbnVMYWJlbCBjbGFzc05hbWU9InRleHQteHMgdGV4dC1tdXRlZC1mb3JlZ3JvdW5kIj4KICAgICAgICAgICAgICBUZWFtcwogICAgICAgICAgICA8L0Ryb3Bkb3duTWVudUxhYmVsPgogICAgICAgICAgICB7dGVhbXMubWFwKCh0ZWFtLCBpbmRleCkgPT4gKAogICAgICAgICAgICAgIDxEcm9wZG93bk1lbnVJdGVtCiAgICAgICAgICAgICAgICBrZXk9e3RlYW0ubmFtZX0KICAgICAgICAgICAgICAgIG9uQ2xpY2s9eygpID0+IHNldEFjdGl2ZVRlYW0odGVhbSl9CiAgICAgICAgICAgICAgICBjbGFzc05hbWU9ImdhcC0yIHAtMiIKICAgICAgICAgICAgICA+CiAgICAgICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBzaXplLTYgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIHJvdW5kZWQtc20gYm9yZGVyIj4KICAgICAgICAgICAgICAgICAgPHRlYW0ubG9nbyBjbGFzc05hbWU9InNpemUtNCBzaHJpbmstMCIgL3RlbnQgIT09ICd1bmRlZmluZWQnICYmIGNvbnRlbnQgIT09IG51bGwgJiYgY29udGVudCAhPT0gJycpIHsKICAgIHJldHVybiAoCiAgICAgIDxtZXRhCiAgICAgICAgey4uLihuYW1lID8geyBuYW1lIH0gOiB7IHByb3BlcnR5IH0pfQogICAgICAgIHsuLi4obWVkaWEgPyB7IG1lZGlhIH0gOiB1bmRlZmluZWQpfQogICAgICAgIGNvbnRlbnQ9e3R5cGVvZiBjb250ZW50ID09PSAnc3RyaW5nJyA/IGNvbnRlbnQgOiBjb250ZW50LnRvU3RyaW5nKCl9CiAgICAgIC8+CiAgICApCiAgfQogIHJldHVybiBudWxsCn0KCmV4cG9ydCBmdW5jdGlvbiBNZXRhRmlsdGVyPFQgZXh0ZW5kcyB7fSB8IHt9W10+KAogIGl0ZW1zOiAoVCB8IG51bGwpW10KKTogTm9uTnVsbGFibGU8VD5bXSB7CiAgY29uc3QgYWNjOiBOb25OdWxsYWJsZTxUPltdID0gW10KICBmb3IgKGNvbnN0IGl0ZW0gb2YgaXRlbXMpIHsKICAgIGlmIChBcnJheS5pc0FycmF5KGl0ZW0pKSB7CiAgICAgIGFjYy5wdXNoKC4uLml0ZW0uZmlsdGVyKG5vbk51bGxhYmxlKSkKICAgIH0gZWxzZSBpZiAobm9uTnVsbGFibGUoaXRlbSkpIHsKICAgICAgYWNjLnB1c2goaXRlbSkKICAgIH0KICB9CiAgcmV0dXJuIGFjYwp9Cgp0eXBlIEV4dGVuZE1ldGFDb250ZW50ID0gUmVjb3JkPAogIHN0cmluZywKICB1bmRlZmluZWQgfCBzdHJpbmcgfCBVUkwgfCBudW1iZXIgfCBib29sZWFuIHwgbnVsbCB8IHVuZGVmaW5lZAo+CnR5cGUgTXVsdGlNZXRhQ29udGVudCA9CiAgfCAoRXh0ZW5kTWV0YUNvbnRlbnQgfCBzdHJpbmcgfCBVUkwgfCBudW1iZXIpW10KICB8IG51bGwKICB8IHVuZGVmaW5lZAoKZnVuY3Rpb24gY2FtZWxUb1NuYWtlKGNhbWVsQ2FzZVN0cjogc3RyaW5nKSB7CiAgcmV0dXJuIGNhbWVsQ2FzZVN0ci5yZXBsYWNlKC8oW0EtWl0pL2csIGZ1bmN0aW9uIChtYXRjaCkgewogICAgcmV0dXJuICdfJyArIG1hdGNoLnRvTG93ZXJDYXNlKCkKICB9KQp9Cgpjb25zdCBhbGlhc1Byb3BQcmVmaXhlcyA9IG5ldyBTZXQoWwogICdvZzppbWFnZScsCiAgJ3R3aXR0ZXI6aW1hZ2UnLAogICdvZzp2aWRlbycsCiAgJ29nOmF1ZGlvJywKXSkKZnVuY3Rpb24gZ2V0TWV0YUtleShwcmVmaXg6IHN0cmluZywga2V5OiBzdHJpbmcpIHsKICAvLyBVc2UgYHR3aXR0ZXI6aW1hZ2VgIGFuZCBgb2c6aW1hZ2VgIGluc3RlYWQgb2YgYHR3aXR0ZXI6aW1hZ2U6dXJsYCBhbmQgYG9nOmltYWdlOnVybGAKICAvLyB0byBiZSBtb3JlIGNvbXBhdGlibGUgYXMgaXQncyBhIG1vcmUgY29tbW9uIGZvcm1hdC4KICAvLyBgb2c6dmlkZW9gICYgYG9nOmF1ZGlvYCBkbyBub3QgaGF2ZSBhIGA6dXJsYCBzdWZmaXggYWxpYXMKICBpZiAoYWxpYXNQcm9wUHJlZml4ZXMuaGFzKHByZWZpeCkgJiYga2V5ID09PSAndXJsJykgewogICAgcmV0dXJuIHByZWZpeAogIH0KICBpZiAocHJlZml4LnN0YXJ0c1dpdGgoJ29nOicpIHx8IHByZWZpeC5zdGFydHNXaXRoKCd0d2l0dGVyOicpKSB7CiAgICBrZXkgPSBjYW1lbFRvU25ha2Uoa2V5KQogIH0KICByZXR1cm4gcHJlZml4ICsgJzonICsga2V5Cn0KCmZ1bmN0aW9uIEV4dGVuZE1ldGEoewogIGNvbnRlbnQsCiAgbmFtZVByZWZpeCwKICBwcm9wZXJ0eVByZWZpeCwKfTogewogIGNvbnRlbnQ/OiBFeHRlbmRNZXRhQ29udGVudAogIG5hbWVQcmVmaXg/OiBzdHJpbmcKICBwcm9wZXJ0eVByZWZpeD86IHN0cmluZwp9KSB7CiAgaWYgKCFjb250ZW50KSByZXR1cm4gbnVsbAogIHJldHVybiBNZXRhRmlsdGVyKAogICAgT2JqZWN0LmVudHJpZXMoY29udGVudCkubWFwKChbaywgdl0pID0+IHsKICAgICAgcmV0dXJuIHR5cGVvZiB2ID09PSAndW5kZWZpbmVkJwogICAgICAgID8gbnVsbAogICAgICAgIDogTWV0YSh7CiAgICAgICAgICAgIC4uLihwcm9wZXJ0eVByZWZpeCAmJiB7IHByb3BlcnR5OiBnZXRNZXRhS2V5KHByb3BlcnR5UHJlZml4LCBrKSB9KSwKICAgICAgICAgICAgLi4uKG5hbWVQcmVmaXggJiYgeyBuYaDXldefIiwKICAgIGJldGE6ICLXkdeY15AiLAogICAgd29ya3NwYWNlOiAi16HXkdeZ15HXqiDXoteR15XXk9eUIiwKICAgIG1lZXRpbmdOb3RlczogIteU16LXqNeV16og16TXkteZ16nXlCIsCiAgICBwcm9qZWN0RGFzaGJvYXJkOiAi15zXldeXINee15fXldeV16DXmdedINec16TXqNeV15nXp9eYIiwKICAgIGlkZWFzQnJhaW5zdG9ybWluZzogIteo16LXmdeV16DXldeqINeV16HXmdei15XXqCDXnteV15fXldeqIiwKICAgIGNhbGVuZGFyRXZlbnRzOiAi15nXldee158g15XXkNeZ16jXldei15nXnSIsCiAgICBkb2N1bWVudGF0aW9uOiAi16rXmdei15XXkyIsCiAgICBnb2Fsc09iamVjdGl2ZXM6ICLXnteY16jXldeqINeV15nXoteT15nXnSIsCiAgICBidWRnZXRQbGFubmluZzogIteq15vXoNeV158g16rXp9em15nXkSIsCiAgICB0ZWFtRGlyZWN0b3J5OiAi16HXpNeo15nXmdeqINem15XXldeqIiwKICAgIHRlY2huaWNhbFNwZWNzOiAi157XpNeo15gg15jXm9eg15kiLAogICAgYW5hbHl0aWNzUmVwb3J0OiAi15PXldeXINeQ16DXnNeZ15jXmden15QiLAogIH0sCn0KCmZ1bmN0aW9uIE1lbnRpb25hYmxlSWNvbih7CiAgaXRlbSwKfTogewogIGl0ZW06IHsgdHlwZTogc3RyaW5nOyB0aXRsZTogc3RyaW5nOyBpbWFnZTogc3RyaW5nIH0KfSkgewogIHJldHVybiBpdGVtLnR5cGUgPT09ICJwYWdlIiA/ICgKICAgIDxzcGFuIGNsYXNzTmFtZT0iZmxleCBzaXplLTQgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIj4KICAgICAge2l0ZW0uaW1hZ2V9CiAgICA8L3NwYW4+CiAgKSA6ICgKICAgIDxBdmF0YXIgY2xhc3NOYW1lPSJzaXplLTQiPgogICAgICA8QXZhdGFySW1hZ2Ugc3JjPXtpdGVtLmltYWdlfSAvPgogICAgICA8QXZhdGFyRmFsbGJhY2s+e2l0ZW0udGl0bGVbMF19PC9BdmF0YXJGYWxsYmFjaz4KICAgIDwvQXZhdGFyPgogICkKfQoKZXhwb3J0IGZ1bmN0aW9uIE5vdGlvblByb21wdEZvcm0oKSB7CiAgY29uc3QgY29udGV4dCA9IHVzZUxhbmd1YWdlQ29udGV4dCgpCiAgY29uc3QgbGFuZyA9IGNvbnRleHQ/Lmxhbmd1YWdlID09PSAiaGUiID8gImhlIiA6ICJhciIKICBjb25zdCB0ID0gdHJhbnNsYXRpb25zW2xhbmddCgogIGNvbnN0IFNBTVBMRV9EQVRBID0gdXNlTWVtbygKICAgICgpID0+ICh7CiAgICAgIG1lbnRpb25hYmxlOiBbCiAgICAgICAgeyB0eXBlOiAicGFnZSIsIHRpdGxlOiB0Lm1lZXRpbmdOb3RlcywgaW1hZ2U6ICLwn5OdIiB9LAogICAgICAgIHsgdHlwZTogInBhZ2UiLCB0aXRsZTogdC5wcm9qZWN0RGFzaGJvYXJkLCBpbWFnZTogIvCfk4oiIH0sCiAgICAgICAgeyB0eXBlOiAicGFnZSIsIHRpdGxlOiB0LmlkZWFzQnJhaW5zdG9ybWluZywgaW1hZ2U6ICLwn5KhIiB9LAogICAgICAgIHsgdHlwZTogInBhZ2UiLCB0aXRsZTogdC5jYWxlbmRhckV2ZW50cywgaW1hZ2U6ICLwn5OFIiB9LAogICAgICAgIHsgdHlwZTogInBhZ2UiLCB0aXRsZTogdC5kb2N1bWVudGF0aW9uLCBpbWFnZTogIvCfk5oiIH0sCiAgICAgICAgeyB0eXBlOiAicGFnZSIsIHRpdGxlOiB0LmdvYWxzT2JqZWN0aXZlcywgaW1hZ2U6ICLwn46vIiB9LAogICAgICAgIHsgdHlwZTogInBhZ2UiLCB0aXRsZTogdC5idWRnZXRQbGFubmluZywgaW1hZ2U6ICLwn5KwIiB9LAogICAgICAgIHsgdHlwZTogInBhZ2UiLCB0aXRsZTogdC50ZWFtRGlyZWN0b3J5LCBpbWFnZTogIvCfkaUiIH0sCiAgICAgICAgeyB0eXBlOiAicGFnZSIsIHRpdGxlOiB0LnRlY2huaWNhbFNwZWNzLCBpbWFnZTogIvCflKciIH0sCiAgICAgICAgeyB0eXBlOiAicGFnZSIsIHRpdGxlOiB0LmFuYWx5dGljc1JlcG9ydCwgaW1hZ2U6ICLwn5OIIiB9LAogICAgICAgIHsKICAgICAgICAgIHR5cGU6ICJ1c2VyIiwKICAgICAgICAgIHRpdGxlOiAic2hhZGNuIiwKICAgICAgICAgIGltYWdlOiAiaHR0cHM6Ly9naXRodWIuY29tL3NoYWRjbi5wbmciLAogICAgICAgICAgd29ya3NwYWNlOiB0Lndvcmsge2hhc0F0dGVtcHRlZEF1dG9Td2l0Y2gKICAgICAgICAgICAgICA/IGBBdXRvLXN3aXRjaCBmYWlsZWQuIFBsZWFzZSBtYW51YWxseSBzd2l0Y2ggdG8gJHtuZXR3b3JrTmFtZX0uYAogICAgICAgICAgICAgIDogYFBsZWFzZSBzd2l0Y2ggdG8gJHtuZXR3b3JrTmFtZX0uYH0KICAgICAgICAgIDwvVHJhbnM+eycgJ30KICAgICAgICAgIHshYXNrTWFudWFsU3dpdGNoICYmICgKICAgICAgICAgICAgPEJ1dHRvbgogICAgICAgICAgICAgIHZhcmlhbnQ9InRleHQiCiAgICAgICAgICAgICAgc3g9e3sgbWw6ICcycHgnLCB2ZXJ0aWNhbEFsaWduOiAndG9wJyB9fQogICAgICAgICAgICAgIG9uQ2xpY2s9e2hhbmRsZU1hbnVhbFN3aXRjaE5ldHdvcmt9CiAgICAgICAgICAgICAgZGlzYWJsZVJpcHBsZQogICAgICAgICAgICA+CiAgICAgICAgICAgICAgPFR5cG9ncmFwaHkgdmFyaWFudD0iZGVzY3JpcHRpb24iPgogICAgICAgICAgICAgICAgPFRyYW5zPlN3aXRjaCBOZXR3b3JrPC9UcmFucz4KICAgICAgICAgICAgICA8L1R5cG9ncmFwaHk+CiAgICAgICAgICAgIDwvQnV0dG9uPgogICAgICAgICAgKX0KICAgICAgICA8L1R5cG9ncmFwaHk+CiAgICAgICl9CiAgICA8L1dhcm5pbmc+CiAgKTsKfTsKaW1wb3J0IHVzZXIgZnJvbSAnQHRlc3RpbmctbGlicmFyeS91c2VyLWV2ZW50JzsKaW1wb3J0IFJlYWN0LCB7IEZyYWdtZW50IH0gZnJvbSAncmVhY3QnOwppbXBvcnQgeyBkZXNjcmliZSwgZXhwZWN0LCBpdCB9IGZyb20gJ3ZpdGVzdCc7CmltcG9ydCB7IHVzZUNvbm5lY3QgfSBmcm9tICd3YWdtaSc7CmltcG9ydCB7IHR5cGUgQ2hhaW4sIGFyYml0cnVtLCBtYWlubmV0LCBvcHRpbWlzbSB9IGZyb20gJ3dhZ21pL2NoYWlucyc7CmltcG9ydCB7IHJlbmRlcldpdGhQcm92aWRlcnMgfSBmcm9tICcuLi8uLi8uLi90ZXN0Lyc7CmltcG9ydCB7IENoYWluTW9kYWwgfSBmcm9tICcuL0NoYWluTW9kYWwnOwoKY29uc3QgQ2hhaW5Nb2RhbFdpdGhDb25uZWN0QnV0dG9uID0gKHsgb25DbG9zZSB9OiB7IG9uQ2xvc2U/OiAoKSA9PiB2b2lkIH0pID0+IHsKICBjb25zdCB7IGNvbm5lY3QsIGNvbm5lY3RvcnMgfSA9IHVzZUNvbm5lY3QoKTsKCiAgcmV0dXJuICgKICAgIDxGcmFnbWVudD4KICAgICAgPENoYWluTW9kYWwKICAgICAgICBvbkNsb3NlPXsoKSA9PiB7CiAgICAgICAgICBpZiAob25DbG9zZSkgb25DbG9zZSgpOwogICAgICAgIH19CiAgICAgICAgb3BlbgogICAgICAvPgogICAgICA8YnV0dG9uCiAgICAgICAgb25DbGljaz17KCkgPT4gY29ubmVjdCh7IGNvbm5lY3RvcjogY29ubmVjdG9yc1swXSB9KX0KICAgICAgICBkYXRhLXRlc3RpZD0icmstY29ubmVjdC1idG4iCiAgICAgID4KICAgICAgICBjb25uZWN0CiAgICAgIDwvYnV0dG9uPgogICAgPC9GcmFnbWVudD4KICApOwp9OwoKZGVzY3JpYmUoJzxDaGFpbk1vZGFsIC8+JywgKCkgPT4gewogIGNvbnN0IHJlbmRlckNoYWluTW9kYWxXaXRoQ29ubmVjdGVkV2FsbGV0ID0gYXN5bmMgKAogICAgY2hhaW5zPzogcmVhZG9ubHkgW0NoYWluLCAuLi5DaGFpbltdXSwKICAgIG9uQ2xvc2U/OiAoKSA9PiB2b2lkLAogICkgPT4gewogICAgY29uc3QgbW9kYWwgPSByZW5kZXJXaXRoUHJvdmlkZXJzKAogICAgICA8Q2hhaW5Nb2RhbFdpdGhDb25uZWN0QnV0dG9uIG9uQ2xvc2U9e29uQ2xvc2V9IC8+LAogICAgICB7CiAgICAgICAgY2hhaW5zLAogICAgICB9LAogICAgKTsKCiAgICBjb25zdCBjb25uZWN0QnV0dG9uT3B0aW9uID0gYXdhaXQgbW9kYWwuZmluZEJ5VGVzdElkKCdyay1jb25uZWN0LWJ0bicpOwoKICAgIGF3YWl0IHVzZXIuY2xpY2soY29ubmVjdEJ1dHRvbk9wdGlvbik7CgogICAgcmV0dXJuIG1vZGFsOwogIH07CgogIGl0KCdTaG93IGN1cnJlbnQgY29ubmVjdGVkIGNoYWluIGluZGljYXRvcicsIGFzeW5jICgpID0+IHsKICAgIGNvbnN0IG1vZGFsID0gYXdhaXQgcmVuMC4wMjc1IDguMjgyMDNDMTAuMDEzMSA4LjUwMDc4IDkuMjQzMTMgOS4yNTM5MSA4Ljk3Mzc1IDkuMjUzOTFDNi40ODI1IDkuMjUzOTEgNi4wNzgxMiAxMC43NjM5IDYuMDc4MTIgMTAuNzYzOUM2LjE4NzUgMTIuMDM2NCA3LjA3MTg4IDEzLjA4MzkgOC4xNDE4OCAxMy42MzgzQzguMTkxMDQgMTMuNjYyOSA4LjIzOTU4IDEzLjY4NjQgOC4yODc1IDEzLjcwODlDOC4zNzMzMyAxMy43NDU2IDguNDU5MTcgMTMuNzgwOCA4LjU0NSAxMy44MTQ1QzguOTExODYgMTMuOTQ0MyA5LjI5NjE3IDE0LjAxOCA5LjY4NSAxNC4wMzMzQzE0LjA1MTkgMTQuMjM4OSAxNC44OTgxIDguODAwNzggMTEuNzQ2OSA3LjIyMTQxQzEyLjU1MzEgNy4wODA3OCAxMy4zOTA2IDcuNDA2NDEgMTMuODU5NCA3LjczNTc4QzEzLjA5MzEgNi4zOTQ1MyAxMS42NjE5IDUuNDg4MjggMTAuMDE5NCA1LjQ4ODI4QzkuOTE1NjIgNS40ODgyOCA5LjgxMzc1IDUuNDk3MDMgOS43MTE4OCA1LjUwMzkxQzguODMyNTQgNS41NjQ3NCA3Ljk5MjA5IDUuODg5NzcgNy4zMDA2MyA2LjQzNjQxQzcuNDM0MzggNi41NTAxNiA3LjU4NTYzIDYuNzAxNDEgNy45MDMxMyA3LjAxNDUzQzguNDk4NzUgNy42MDM5MSAxMC4wMjMxIDguMjEwMTYgMTAuMDI2OSA4LjI4MTQxIgogICAgICAgIGZpbGw9InVybCgjcGFpbnQzX3JhZGlhbF9maXJlZm94KSIKICAgICAgLz4KICAgICAgPHBhdGgKICAgICAgICBkPSJNNi44OTI2NiA2LjE0MjgxTDcuMDc1MTYgNi4yNjM0NEM2Ljg3NDU2IDUuNTYzMiA2Ljg2NTkzIDQuODIxOTEgNy4wNTAxNiA0LjExNzE5QzYuMTUwMTYgNC41Mjg0NCA1LjQ1MDE2IDUuMTc3MTkgNC45NDE0MSA1Ljc1MDk0QzQuOTgyNjYgNS43NDk2OSA2LjI1MzkxIDUuNzI2NTYgNi44OTI2NiA2LjE0MzQ0IgogICAgICAgIGZpbGw9InVybCgjcGFpbnQ0X3JhZGlhbF9maXJlZm94KSIKICAgICAgLz4KICAgICAgPHBhdGgKICAgICAgICBkPSJNMS4zMzE2NyAxMC4xNzg4QzIuMDA3OTIgMTQuMTgyNSA1LjYyOTE3IDE3LjI0IDkuNzM5NzkgMTcuMzU3NUMxMy41NDQ4IDE3LjQ2NTcgMTUuOTczNSAxNS4yNTE5IDE2Ljk3OTIgMTMuMDkyNUMxNy42Mjc5IDExLjY5NjkgMTguMDc5MiA5LjQxMjU0IDE3LjI1MTcgNy4xNjYyOVY3LjE0OTQxTDE3LjI1MzUgNy4xNjQ0MUMxNy41NjQyIDkuMTk4MTYgMTYuNTMyMyAxMS4xNjg4IDE0LjkxODUgMTIuNTAxM0wxNC45MTQyIDEyLjUxMjVDMTEuNzY5OCAxNS4wNzgyIDguNzYxMDQgMTQuMDYwNyA4LjE1MTY3IDEzLjY0NUw4LjAyNDE3IDEzLjU4MTNDNi4xOTEwNCAxMi43MDQ0IDUuNDMzNTQgMTEuMDI5NCA1LjU5NjA0IDkuNTkzNzlDNC4wNDg1NCA5LjU5Mzc5IDMuNTIwNDIgOC4yODUwNCAzLjUyMDQyIDguMjg1MDRDMy41MjA0MiA4LjI4NTA0IDQuOTEwNDIgNy4yOTE5MSA2Ljc0MTY3IDguMTU1NjZDOC40Mzc5MiA4Ljk1NTY2IDEwLjAzMSA4LjI4NTY2IDEwLjAzMSA4LjI4NTA0QzEwLjAyNzkgOC4yMTM3OSA4LjUwMzU0IDcuNjA1NjYgNy45MDg1NCA3LjAxODc5QzcuNTkxMDQgNi43MDUwNCA3LjQzOTc5IDYuNTUzNzkgNy4zMDY2NyA2LjQ0MDY2QzcuMjM0MzcgNi4zNzkxMSA3LjE1ODYyIDYuMzIxNzIgNy4wNzk3OSA2LjI2ODc5QzcuMDI3MjkgNi4yMzE5MSA2Ljk3MDQyIDYuMTk1NjYgNi44OTcyOSA2LjE0ODE2QzYuMjU4NTQgNS43MzE5MSA0Ljk4NzI5IDUuNzU0NDEgNC45NDU0MiA1Ljc1NjI5SDQuOTQxNjdDNC41OTQxNyA1LjMxNTA0IDQuNjE4NTQgMy44NjA2NiA0LjYzNzkyIDMuNTU2MjlDNC42MzQxNyAzLjUzNzU0IDQuMzc5MTcgMy42ODk0MSA0LjM0NjY3IDMuNzEyNTRDNC4wNDA0MiAzLjkzMTI5IDMuNzUyOTIgNC4xNzc1NCAzLjQ5MDQyIDQuNDQ3NTRDMy4xOSA0Ljc1MjU0IDIuOTE3MDggNS4wODAyNCAyLjY3MTY3IDUuNDMwNjZDMi4xMDg3MiA2LjIzMTU2IDEuNzA5NDIgNy4xMzU3MiAxLjQ5NjY3IDguMDkxMjlDMS40ODkxNyA4LjEwODE2IDEuMTc3OTIgOSAgICA8ZyBjbGlwUGF0aD0idXJsKCNjbGlwMF9wbGF5c3RvcmUpIj4KICAgICAgICA8ZyBmaWx0ZXI9InVybCgjZmlsdGVyMF9kZF9wbGF5c3RvcmUpIj4KICAgICAgICAgIDxwYXRoCiAgICAgICAgICAgIGQ9Ik0xLjgyMDk0IDAuMzA3QzEuNTk0OTQgMC41NDcgMS40NjA5NCAwLjkxNyAxLjQ2MDk0IDEuMzk5VjE4LjU5NkMxLjQ2MDk0IDE5LjA3OCAxLjU5NDk0IDE5LjQ0OSAxLjgyMDk0IDE5LjY4OUwxLjg3ODk0IDE5Ljc0NUwxMS41MTI5IDEwLjExMVY5Ljg4NEwxLjg3ODk0IDAuMjVMMS44MjA5NCAwLjMwN1oiCiAgICAgICAgICAgIGZpbGw9InVybCgjcGFpbnQwX2xpbmVhcl9wbGF5c3RvcmUpIgogICAgICAgICAgLz4KICAgICAgICAgIDxwYXRoCiAgICAgICAgICAgIGQ9Ik0xNC43MjE3IDEzLjMyNjhMMTEuNTExNyAxMC4xMTM4VjkuODg2NzhMMTQuNzIyNyA2LjY3NTc4TDE0Ljc5NTcgNi43MTY3OEwxOC42MDA3IDguODc4NzhDMTkuNjg2NyA5LjQ5NTc4IDE5LjY4NjcgMTAuNTA1OCAxOC42MDA3IDExLjEyMzhMMTQuNzk1NyAxMy4yODU4TDE0LjcyMTcgMTMuMzI2OFoiCiAgICAgICAgICAgIGZpbGw9InVybCgjcGFpbnQxX2xpbmVhcl9wbGF5c3RvcmUpIgogICAgICAgICAgLz4KICAgICAgICAgIDxnIGZpbHRlcj0idXJsKCNmaWx0ZXIxX2RfcGxheXN0b3JlKSI+CiAgICAgICAgICAgIDxwYXRoCiAgICAgICAgICAgICAgZD0iTTE0Ljc5NTMgMTMuMjg0TDExLjUxMDMgMTBMMS44MjAzMSAxOS42OUMyLjE3NzMxIDIwLjA3IDIuNzY5MzEgMjAuMTE3IDMuNDM1MzEgMTkuNzM5TDE0Ljc5NTMgMTMuMjg0WiIKICAgICAgICAgICAgICBmaWxsPSJ1cmwoI3BhaW50Ml9saW5lYXJfcGxheXN0b3JlKSIKICAgICAgICAgICAgLz4KICAgICAgICAgIDwvZz4KICAgICAgICAgIDxwYXRoCiAgICAgICAgICAgIGQ9Ik0xNC43OTYzIDYuNzE0NTRMMy40MzYzMSAwLjI2MDUzN0MyLjc3MDMxIC0wLjExNzQ2MyAyLjE3ODMxIC0wLjA2OTQ2MjkgMS44MjAzMSAwLjMwOTUzN0wxMS41MTIzIDkuOTk5NTRMMTQuNzk2MyA2LjcxNDU0WiIKICAgICAgICAgICAgZmlsbD0idXJsKCNwYWludDNfbGluZWFyX3BsYXlzdG9yZSkiCiAgICAgICAgICAvPgogICAgICAgIDwvZz4KICAgICAgPC9nPgogICAgICA8ZGVmcz4KICAgICAgICA8ZmlsdGVyCiAgICAgICAgICBpZD0iZmlsdGVyMF9kZF9wbGF5c3RvcmUiCiAgICAgICAgICB4PSIxLjQ2MDk0IgogICAgICAgICAgeT0iLTAuMTE3IgogICAgICAgICAgd2lkdGg9IjE3Ljk1MzEiCiAgICAgICAgICBoZWlnaHQ9IjIwLjIzNCIKICAgICAgICAgIGZpbHRlclVuaXRzPSJ1c2VyU3BhY2VPblVzZSIKICAgICAgICAgIGNvbG9ySW50ZXJwb2xhdGlvbkZpbHRlcnM9InNSR0IiPgogICAgICAgICAgPGZlRmxvb2QgZmxvb2RPcGFjaXR5PSIwIiByZXN1bHQ9IkJhY2tncm91bmRJbWFnZUZpeCIgLz4KICAgICAgICAgIDxmZUNvbG9yTWF0cml4CiAgICAgICAgICAgIGluPSJTb3VyY2VBbHBoYSIKICAgICAgICAgICAgdHlwZT0ibWF0cml4IgogICAgICAgICAgICB2YWx1ZXM9IjAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDEyNyAwIgogICAgICAgICAgICByZXN1bHQ9ImhhcmRBbHBoYSIKICAgICAgICAgIC8+CiAgICAgICAgICA8ZmVPZmZzZXQgZHk9Ii0wLjExNyIgLz4KICAgICAgICAgIDxmZUNvbXBvc2l0ZSBpbjI9ImhhcmRBbHBoYSIgb3BlcmF0b3I9Im91dCIgLz4KICAgICAgICAgIDxmZUNvbG9yTWF0cml4IHR5cGU9Im1hdHJpeCIgdmFsdWVzPSIwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwIDAgMCAwLjEyIDAiIC8+CiAgICAgICAgICA8ZmVCbGVuZCBtb2RlPSJub3JtYWwiIGluMj0iQmFja2dyb3VuZEltYWdlRml4IiByZXN1bHQ9ImVmZmVjdDFfZHJvcFNoYWRvd19wbGF5c3RvcmUiIC8+YXV0byAgbGc6cm91bmRlZC14bCBsZzpib3JkZXIgbGc6YmctZ3JheS0yMDAgbGc6cC00IGxnOmRhcms6YmctemluYy04MDAvMzAiPgogICAgICAgICAgR2V0IHN0YXJ0ZWQgYnkgZWRpdGluZyZuYnNwOwogICAgICAgICAgPGNvZGUgY2xhc3NOYW1lPSJmb250LW1vbm8gZm9udC1ib2xkIj5zcmMvYXBwL3BhZ2UudHN4PC9jb2RlPgogICAgICAgIDwvcD4KICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZml4ZWQgYm90dG9tLTAgbGVmdC0wIGZsZXggaC00OCB3LWZ1bGwgaXRlbXMtZW5kIGp1c3RpZnktY2VudGVyIGJnLWdyYWRpZW50LXRvLXQgZnJvbS13aGl0ZSB2aWEtd2hpdGUgZGFyazpmcm9tLWJsYWNrIGRhcms6dmlhLWJsYWNrIGxnOnN0YXRpYyBsZzpoLWF1dG8gbGc6dy1hdXRvIGxnOmJnLW5vbmUiPgogICAgICAgICAgPGEKICAgICAgICAgICAgY2xhc3NOYW1lPSJwb2ludGVyLWV2ZW50cy1ub25lIGZsZXggcGxhY2UtaXRlbXMtY2VudGVyIGdhcC0yIHAtOCBsZzpwb2ludGVyLWV2ZW50cy1hdXRvIGxnOnAtMCIKICAgICAgICAgICAgaHJlZj0iaHR0cHM6Ly92ZXJjZWwuY29tP3V0bV9zb3VyY2U9Y3JlYXRlLW5leHQtYXBwJnV0bV9tZWRpdW09YXBwZGlyLXRlbXBsYXRlJnV0bV9jYW1wYWlnbj1jcmVhdGUtbmV4dC1hcHAiCiAgICAgICAgICAgIHRhcmdldD0iX2JsYW5rIgogICAgICAgICAgICByZWw9Im5vb3BlbmVyIG5vcmVmZXJyZXIiCiAgICAgICAgICA+CiAgICAgICAgICAgIEJ5eycgJ30KICAgICAgICAgICAgPEltYWdlCiAgICAgICAgICAgICAgc3JjPSIvdmVyY2VsLnN2ZyIKICAgICAgICAgICAgICBhbHQ9IlZlcmNlbCBMb2dvIgogICAgICAgICAgICAgIGNsYXNzTmFtZT0iZGFyazppbnZlcnQiCiAgICAgICAgICAgICAgd2lkdGg9ezEwMH0KICAgICAgICAgICAgICBoZWlnaHQ9ezI0fQogICAgICAgICAgICAgIHByaW9yaXR5CiAgICAgICAgICAgIC8+CiAgICAgICAgICA8L2E+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgoKICAgICAgPGRpdiBjbGFzc05hbWU9InJlbGF0aXZlIGZsZXggcGxhY2UtaXRlbXMtY2VudGVyIGJlZm9yZTphYnNvbHV0ZSBiZWZvcmU6aC1bMzAwcHhdIGJlZm9yZTp3LVs0ODBweF0gYmVmb3JlOi10cmFuc2xhdGUteC0xLzIgYmVmb3JlOnJvdW5kZWQtZnVsbCBiZWZvcmU6YmctZ3JhZGllbnQtcmFkaWFsIGJlZm9yZTpmcm9tLXdoaXRlIGJlZm9yZTp0by10cmFuc3BhcmVudCBiZWZvcmU6Ymx1ci0yeGwgYmVmb3JlOmNvbnRlbnQtWycnXSBhZnRlcjphYnNvbHV0ZSBhZnRlcjotei0yMCBhZnRlcjpoLVsxODBweF0gYWZ0ZXI6dy1bMjQwcHhdIGFmdGVyOnRyYW5zbGF0ZS14LTEvMyBhZnRlcjpiZy1ncmFkaWVudC1jb25pYyBhZnRlcjpmcm9tLXNreS0yMDAgYWZ0ZXI6dmlhLWJsdWUtMjAwIGFmdGVyOmJsdXItMnhsIGFmdGVyOmNvbnRlbnQtWycnXSBiZWZvcmU6ZGFyazpiZy1ncmFkaWVudC10by1iciBiZWZvcmU6ZGFyazpmcm9tLXRyYW5zcGFyZW50IGJlZm9yZTpkYXJrOnRvLWJsdWUtNzAwIGJlZm9yZTpkYXJrOm9wYWNpdHktMTAgYWZ0ZXI6ZGFyazpmcm9tLXNreS05MDAgYWZ0ZXI6ZGFyazp2aWEtWyMwMTQxZmZdIGFmdGVyOmRhcms6b3BhY2l0eS00MCBiZWZvcmU6bGc6aC1bMzYwcHhdIHotWy0xXSI+CiAgICAgICAgPEltYWdlCiAgICAgICAgICBjbGFzc05hbWU9InJlbGF0aXZlIGRhcms6ZHJvcC1zaGFkb3ctWzBfMF8wLjNyZW1fI2ZmZmZmZjcwXSBkYXJrOmludmVydCIKICAgICAgICAgIHNyYz0iL25leHQuc3ZnIgogICAgICAgICAgYWx0PSJOZXh0LmpzIExvZ28iCiAgICAgICAgICB3aWR0aD17MTgwfQogICAgICAgICAgaGVpZ2h0PXszN30KICAgICAgICAgIHByaW9yaXR5CiAgICAgICAgLz4KICAgICAgPC9kaXY+CgogICAgICA8ZGl2IGNsYXNzTmFtZT0ibWItMzIgZ3JpZCB0ZXh0LWNlbnRlciBsZzptYXgtdy01eGwgbGc6dy1mdWxsIGxnOm1iLTAgbGc6Z3JpZC1jb2xzLTQgbGc6dGV4dG9uUmVmfT4KICAgICAgICA8Rm9ybSBmb3JtPXtmb3JtTWV0aG9kc30gaWQ9ImV2ZW50LXR5cGUtZm9ybSIgaGFuZGxlU3VibWl0PXtoYW5kbGVTdWJtaXR9PgogICAgICAgICAgPGRpdiByZWY9e2FuaW1hdGlvblBhcmVudFJlZn0+e3RhYk1hcFt0YWJOYW1lXX08L2Rpdj4KICAgICAgICA8L0Zvcm0+CiAgICAgIDwvRXZlbnRUeXBlU2luZ2xlTGF5b3V0PgogICAgICB7Y2hpbGRyZW59CiAgICA8Lz4KICApOwp9OwoidXNlIGNsaWVudCIKCmltcG9ydCAqIGFzIFJlYWN0IGZyb20gInJlYWN0IgoKaW1wb3J0IHsKICBJdGVtLAogIEl0ZW1Db250ZW50LAogIEl0ZW1EZXNjcmlwdGlvbiwKICBJdGVtVGl0bGUsCn0gZnJvbSAiQC9yZWdpc3RyeS9iYXNlcy9yYWRpeC91aS9pdGVtIgppbXBvcnQgeyB0eXBlIEZvbnRWYWx1ZSB9IGZyb20gIkAvcmVnaXN0cnkvY29uZmlnIgppbXBvcnQgeyBMb2NrQnV0dG9uIH0gZnJvbSAiQC9hcHAvKGNyZWF0ZSkvY29tcG9uZW50cy9sb2NrLWJ1dHRvbiIKaW1wb3J0IHsKICBQaWNrZXIsCiAgUGlja2VyQ29udGVudCwKICBQaWNrZXJHcm91cCwKICBQaWNrZXJSYWRpb0dyb3VwLAogIFBpY2tlclJhZGlvSXRlbSwKICBQaWNrZXJTZXBhcmF0b3IsCiAgUGlja2VyVHJpZ2dlciwKfSBmcm9tICJAL2FwcC8oY3JlYXRlKS9jb21wb25lbnRzL3BpY2tlciIKaW1wb3J0IHsgdHlwZSBGb250IH0gZnJvbSAiQC9hcHAvKGNyZWF0ZSkvbGliL2ZvbnRzIgppbXBvcnQgeyB1c2VEZXNpZ25TeXN0ZW1TZWFyY2hQYXJhbXMgfSBmcm9tICJAL2FwcC8oY3JlYXRlKS9saWIvc2VhcmNoLXBhcmFtcyIKCmV4cG9ydCBmdW5jdGlvbiBGb250UGlja2VyKHsKICBmb250cywKICBpc01vYmlsZSwKICBhbmNob3JSZWYsCn06IHsKICBmb250czogcmVhZG9ubHkgRm9udFtdCiAgaXNNb2JpbGU6IGJvb2xlYW4KICBhbmNob3JSZWY6IFJlYWN0LlJlZk9iamVjdDxIVE1MRGl2RWxlbWVudCB8IG51bGw+Cn0pIHsKICBjb25zdCBbcGFyYW1zLCBzZXRQYXJhbXNdID0gdXNlRGVzaWduU3lzdGVtU2VhcmNoUGFyYW1zKCkKCiAgY29uc3QgY3VycmVudEZvbnQgPSBSZWFjdC51c2VNZW1vKAogICAgKCkgPT4gZm9udHMuZmluZCgoZm9udCkgPT4gZm9udC52YWx1ZSA9PT0gcGFyYW1zLmZvbnQpLAogICAgW2ZvbnRzLCBwYXJhbXMuZm9udF0KICApCgogIHJldHVybiAoCiAgICA8ZGl2IGNsYXNzTmFtZT0iZ3JvdXAvcGlja2VyIHJlbGF0aXZlIj4KICAgICAgPFBpY2tlcj4KICAgICAgICA8UGlja2VyVHJpZ2dlcj4KICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGZsZXgtY29sIGp1c3RpZnktc3RhcnQgdGV4dC1sZWZ0Ij4KICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9InRleHQtbXV0ZWQtZm9yZWdyb3VuZCB0ZXh0LXhzIj5Gb250PC9kaXY+CiAgICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LWZvcmVncm91bmQgdGV4dC1zbSBmb250LW1lZGl1bSI+CiAgICAgICAgICAgICAge2N1cnJlbnRGb250Py5uYW1lfQogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPGRpdgogICAgICAgICAgICBjbGFzc05hbWU9InRleHQtZm9yZWdyb3VuZCBwb2ludGVyLWV2ZW50cy1ub25lIGFic29sdXRlIHRvcC0xLzIgcmlnaHQtNCBmbGV4IHNpemUtNCAtdHJhbnNsYXRlLXktMS8yIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciB0ZXh0LWJhc2Ugc2VsZWN0LW5vbmUiCiAgICAgICAgICAgIHN0eWxlPXt7IGZvbnRGYW1pbHk6IGN1cnJlbnRGb250Py5mb250LnN0eWxlLmZvbnRGYW1pbHkgfX0KICAgICAgICAgID4KICAgICAgICAgICAgQWEKICAgICAgICAgIDwvZGl2PgogICAgICAgIDwvUGlja2VyVHJpZ2dlcj4KICAgICAgICA8UGlja2VyQ29udGVudAogICAgICAgICAgYW5jaG9yPXtpc01vYmlsZSA/IGFuY2hvclJlZiA6IHVuZGVmaW5lZH0KICAgICAgICAgIHNpZGU9e2lzTW9iaWxlID8gInRvcCIgOiAicmlnaHQifQogIC8gVXNlZCB0byB0cmFjayB3aGljaCBsYXN0IHdhbGxldCB1c2VyIGhhcyBjbGlja2VkCiAgICAgICAgICAvLyB3ZSBjYW4gdGhlbiB1c2UgdGhpcyB2YWx1ZSB0byBzaG93IGNvbm5lY3RlZCBncmVlbiBiYWRnZQogICAgICAgICAgLy8gZm9yIG91ciBjdXN0b20gV2FsbGV0IEJ1dHRvbiBBUEkKICAgICAgICAgIGFkZExhdGVzdFdhbGxldElkKGZpcnN0Q29ubmVjdG9yPy5pZCB8fCAnJyk7CgogICAgICAgICAgLy8gSWYgb3BlbkNvbm5lY3RNb2RhbCBpcyB0cnVlIGFuZCB1c2VyIGlzIG9uIG1vYmlsZSBvcgogICAgICAgICAgLy8gaWYgdXNlciBoYXNuJ3QgaW5zdGFsbGVkIHRoZSBjb25uZWN0b3IgdGhlbiB3ZSBwcm9tcHQgdGhlbQogICAgICAgICAgLy8gdG8gcmFpbmJvd2tpdCBjb25uZWN0IG1vZGFsCiAgICAgICAgICBpZiAobW9iaWxlIHx8IGlzTm90U3VwcG9ydGVkKSB7CiAgICAgICAgICAgIG9wZW5Db25uZWN0TW9kYWw/LigpOwogICAgICAgICAgICBzZXRDb25uZWN0b3IoZmlyc3RDb25uZWN0b3IpOwogICAgICAgICAgICByZXR1cm47CiAgICAgICAgICB9CgogICAgICAgICAgYXdhaXQgY29ubmVjdFdhbGxldCgpOwogICAgICAgIH0sCiAgICAgIH0pfQogICAgPC8+CiAgKTsKfQppbXBvcnQgdHlwZSB7IEhUTUxQcm9wcyB9IGZyb20gJ3JlYWN0JwoKZXhwb3J0IGNvbnN0IERJU0FMTE9XRURfRk9STV9QUk9QUyA9IFsnbWV0aG9kJywgJ2VuY1R5cGUnLCAndGFyZ2V0J10gYXMgY29uc3QKCnR5cGUgSFRNTEZvcm1Qcm9wcyA9IEhUTUxQcm9wczxIVE1MRm9ybUVsZW1lbnQ+CnR5cGUgRGlzYWxsb3dlZEZvcm1Qcm9wcyA9ICh0eXBlb2YgRElTQUxMT1dFRF9GT1JNX1BST1BTKVtudW1iZXJdCgp0eXBlIEludGVybmFsRm9ybVByb3BzID0gewogIC8qKgogICAqIGBhY3Rpb25gIGNhbiBiZSBlaXRoZXIgYSBgc3RyaW5nYCBvciBhIGZ1bmN0aW9uLgogICAqIC0gSWYgYGFjdGlvbmAgaXMgYSBzdHJpbmcsIGl0IHdpbGwgYmUgaW50ZXJwcmV0ZWQgYXMgYSBwYXRoIG9yIFVSTCB0byBuYXZpZ2F0ZSB0byB3aGVuIHRoZSBmb3JtIGlzIHN1Ym1pdHRlZC4KICAgKiAgIFRoZSBwYXRoIHdpbGwgYmUgcHJlZmV0Y2hlZCB3aGVuIHRoZSBmb3JtIGJlY29tZXMgdmlzaWJsZS4KICAgKiAtIElmIGBhY3Rpb25gIGlzIGEgZnVuY3Rpb24sIGl0IHdpbGwgYmUgY2FsbGVkIHdoZW4gdGhlIGZvcm0gaXMgc3VibWl0dGVkLiBTZWUgdGhlIFtSZWFjdCBkb2NzXShodHRwczovL3JlYWN0LmRldi9yZWZlcmVuY2UvcmVhY3QtZG9tL2NvbXBvbmVudHMvZm9ybSNwcm9wcykgZm9yIG1vcmUuCiAgICovCiAgYWN0aW9uOiBOb25OdWxsYWJsZTxIVE1MRm9ybVByb3BzWydhY3Rpb24nXT4KICAvKioKICAgKiBDb250cm9scyBob3cgdGhlIHJvdXRlIHNwZWNpZmllZCBieSBgYWN0aW9uYCBpcyBwcmVmZXRjaGVkLgogICAqIEFueSBgPEZvcm0gLz5gIHRoYXQgaXMgaW4gdGhlIHZpZXdwb3J0IChpbml0aWFsbHkgb3IgdGhyb3VnaCBzY3JvbGwpIHdpbGwgYmUgcHJlZmV0Y2hlZC4KICAgKiBQcmVmZXRjaCBjYW4gYmUgZGlzYWJsZWQgYnkgcGFzc2luZyBgcHJlZmV0Y2g9e2ZhbHNlfWAuIFByZWZldGNoaW5nIGlzIG9ubHkgZW5hYmxlZCBpbiBwcm9kdWN0aW9uLgogICAqCiAgICogT3B0aW9uczoKICAgKiAtICJhdXRvIiwgbnVsbCwgdW5kZWZpbmVkIChkZWZhdWx0KTogRm9yIHN0YXRpY2FsbHkgZ2VuZXJhdGVkIHBhZ2VzLCB0aGlzIHdpbGwgcHJlZmV0Y2ggdGhlIGZ1bGwgUmVhY3QgU2VydmVyIENvbXBvbmVudCBkYXRhLiBGb3IgZHluYW1pYyBwYWdlcywgdGhpcyB3aWxsIHByZWZldGNoIHVwIHRvIHRoZSBuZWFyZXN0IHJvdXRlIHNlZ21lbnQgd2l0aCBhIFtgbG9hZGluZy5qc2BdKGh0dHBzOi8vbmV4dGpzLm9yZy9kb2NzL2FwcC9hcGktcmVmZXJlbmNlL2ZpbGUtY29udmVudGlvbnMvbG9hZGluZykgZmlsZS4gSWYgdGhlcmUgaXMgbm8gbG9hZGluZyBmaWxlLCBpdCBpb25zL0NvbGxhdGVyYWxDaGFuZ2UvQ29sbGF0ZXJhbENoYW5nZU1vZGFsJykudGhlbigKICAgIChtb2R1bGUpID0+IG1vZHVsZS5Db2xsYXRlcmFsQ2hhbmdlTW9kYWwKICApCik7CgovLyBDbGllbnQtc2lkZSBjYWNoZSwgc2hhcmVkIGZvciB0aGUgd2hvbGUgc2Vzc2lvbiBvZiB0aGUgdXNlciBpbiB0aGUgYnJvd3Nlci4KY29uc3QgY2xpZW50U2lkZUVtb3Rpb25DYWNoZSA9IGNyZWF0ZUVtb3Rpb25DYWNoZSgpOwoKdHlwZSBOZXh0UGFnZVdpdGhMYXlvdXQgPSBOZXh0UGFnZSAmIHsKICBnZXRMYXlvdXQ/OiAocGFnZTogUmVhY3QuUmVhY3RFbGVtZW50KSA9PiBSZWFjdC5SZWFjdE5vZGU7Cn07CgpleHBvcnQgY29uc3QgY2xpZW50ID0gQWF2ZUNsaWVudC5jcmVhdGUoKTsKCmludGVyZmFjZSBNeUFwcFByb3BzIGV4dGVuZHMgQXBwUHJvcHMgewogIGVtb3Rpb25DYWNoZT86IEVtb3Rpb25DYWNoZTsKICBDb21wb25lbnQ6IE5leHRQYWdlV2l0aExheW91dDsKfQpleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBNeUFwcChwcm9wczogTXlBcHBQcm9wcykgewogIGNvbnN0IHsgQ29tcG9uZW50LCBlbW90aW9uQ2FjaGUgPSBjbGllbnRTaWRlRW1vdGlvbkNhY2hlLCBwYWdlUHJvcHMgfSA9IHByb3BzOwogIGNvbnN0IGdldExheW91dCA9IENvbXBvbmVudC5nZXRMYXlvdXQgPz8gKChwYWdlOiBSZWFjdE5vZGUpID0+IHBhZ2UpOwogIGNvbnN0IFtpbml0aWFsaXplRXZlbnRzVHJhY2tpbmcsIHNldFdhbGxldFR5cGVdID0gdXNlUm9vdFN0b3JlKAogICAgdXNlU2hhbGxvdygoc3RvcmUpID0+IFtzdG9yZS5pbml0aWFsaXplRXZlbnRzVHJhY2tpbmcsIHN0b3JlLnNldFdhbGxldFR5cGVdKQogICk7CiAgY29uc3QgW3F1ZXJ5Q2xpZW50XSA9IHVzZVN0YXRlKAogICAgKCkgPT4KICAgICAgbmV3IFF1ZXJ5Q2xpZW50KHsKICAgICAgICBkZWZhdWx0T3B0aW9uczogewogICAgICAgICAgcXVlcmllczogewogICAgICAgICAgICByZWZldGNoT25XaW5kb3dGb2N1czogZmFsc2UsCiAgICAgICAgICB9LAogICAgICAgIH0sCiAgICAgIH0pCiAgKTsKCiAgdXNlRWZmZWN0KCgpID0+IHsKICAgIGlmIChwcm9jZXNzLmVudi5ORVhUX1BVQkxJQ19BTVBMSVRVREVfQVBJX0tFWSkgewogICAgICBpbml0aWFsaXplRXZlbnRzVHJhY2tpbmcoKTsKICAgIH0gZWxzZSB7CiAgICAgIGNvbnNvbGUuZGVidWcoJ25vIGFuYWx5dGljcyB0cmFja2luZycpOwogICAgfQogIH0sIFtdKTsKCiAgY29uc3QgY2xlYW5Mb2NhbFN0b3JhZ2UgPSAoKSA9PiB7CiAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgncmVhZE9ubHlNb2RlQWRkcmVzcycpOwogIH07CgogIHJldHVybiAoCiAgICA8Q2FjaGVQcm92aWRlciB2YWx1ZT17ZW1vdGlvbkNhY2hlfT4KICAgICAgPEhlYWQ+CiAgICAgICAgPG1ldGEgbmFtZT0idmlld3BvcnQiIGNvbnRlbnQ9ImluaXRpYWwtc2NhbGU9MSwgd2lkdGg9ZGV2aWNlLXdpZHRoIiAvPgogICAgICA8L0hlYWQ+CiAgICAgIDxNZXRhCiAgICAgICAgdGl0bGU9eydPcGVuIFNvdXJjZSBMaXF1aWRpdHkgUHJvdG9jb2wnfQogICAgICAgIGRlc2NyaXB0aW9uPXsKICAgICAgICAgICdBYXZlIGlzIGFuIE9wZW4gU291cmNlIFByb3RvY29sIHRvIGNyZWF0ZSBOb24tQ3VzdG9kaWFsIExpcXVpZGl0eSBNYXJrZXRzIHRvIGVhcm4gaW50ZXJlc3Qgb24gc3VwcGx5aW5nIGFuZCBib3Jyb3dpbmcgYXNzZXRzIHdpdGggYSB2YXJpYWJsZSBvciBzdGFibGUgaW50ZXJlc3QgcmF0ZS4gVGhlIHByb3RvY29sIGlzIGRlc2lnbmVkIGZvciBlYXN5IGludGVncmF0aW9uIGludG8geW91ciBwcm9kdWN0cyBhbmQgc2VydmljZXMuJwogICAgICAgIH0KICAgICAgICBpbWFnZVVybD0iaHR0cHM6Ly9hcHAuYWF2ZS5jb20vYWF2ZS1jb20tb3BlbmdyYXBoLnBuZyIKICAgICAgLz4KICAgICAgPE5vU3NyPgogICAgICAgIDxBYXZlUHJvdmlkZXIgY2xpZW50PXtjbGllbnR9PgogICAgICAgICAgPExhbmd1ZGF0YS5uYXZNYWlufSAvPgogICAgICAgIDxOYXZQcm9qZWN0cyBwcm9qZWN0cz17ZGF0YS5wcm9qZWN0c30gLz4KICAgICAgICA8TmF2U2Vjb25kYXJ5IGl0ZW1zPXtkYXRhLm5hdlNlY29uZGFyeX0gY2xhc3NOYW1lPSJtdC1hdXRvIiAvPgogICAgICA8L1NpZGViYXJDb250ZW50PgogICAgICA8U2lkZWJhckZvb3Rlcj4KICAgICAgICA8TmF2VXNlciB1c2VyPXtkYXRhLnVzZXJ9IC8+CiAgICAgIDwvU2lkZWJhckZvb3Rlcj4KICAgIDwvU2lkZWJhcj4KICApCn0KaW1wb3J0IHR5cGUgeyBNZXRhZGF0YSB9IGZyb20gIm5leHQiOwppbXBvcnQgeyBjb29raWVzLCBoZWFkZXJzIH0gZnJvbSAibmV4dC9oZWFkZXJzIjsKaW1wb3J0IHsgbm90Rm91bmQsIHJlZGlyZWN0IH0gZnJvbSAibmV4dC9uYXZpZ2F0aW9uIjsKCmltcG9ydCB7IF9nZW5lcmF0ZU1ldGFkYXRhIH0gZnJvbSAiYXBwL191dGlscyI7CgppbXBvcnQgeyBnZXRTZXJ2ZXJTZXNzaW9uIH0gZnJvbSAiQGNhbGNvbS9mZWF0dXJlcy9hdXRoL2xpYi9nZXRTZXJ2ZXJTZXNzaW9uIjsKaW1wb3J0IHsgUmVzb3VyY2UgfSBmcm9tICJAY2FsY29tL2ZlYXR1cmVzL3BiYWMvZG9tYWluL3R5cGVzL3Blcm1pc3Npb24tcmVnaXN0cnkiOwppbXBvcnQgeyBnZXRSZXNvdXJjZVBlcm1pc3Npb25zIH0gZnJvbSAiQGNhbGNvbS9mZWF0dXJlcy9wYmFjL2xpYi9yZXNvdXJjZS1wZXJtaXNzaW9ucyI7CmltcG9ydCB7IE1lbWJlcnNoaXBSb2xlIH0gZnJvbSAiQGNhbGNvbS9wcmlzbWEvZW51bXMiOwppbXBvcnQgcHJpc21hIGZyb20gIkBjYWxjb20vcHJpc21hIjsKCmltcG9ydCB7IGJ1aWxkTGVnYWN5UmVxdWVzdCB9IGZyb20gIkBsaWIvYnVpbGRMZWdhY3lDdHgiOwoKaW1wb3J0IFRlYW1GZWF0dXJlc1ZpZXcgZnJvbSAifi9zZXR0aW5ncy90ZWFtcy9baWRdL2ZlYXR1cmVzLXZpZXciOwoKdHlwZSBQYWdlUGFyYW1zID0geyBwYXJhbXM6IFByb21pc2U8eyBpZDogc3RyaW5nIH0+IH07CgpleHBvcnQgY29uc3QgZ2VuZXJhdGVNZXRhZGF0YSA9IGFzeW5jICh7IHBhcmFtcyB9OiBQYWdlUGFyYW1zKTogUHJvbWlzZTxNZXRhZGF0YT4gPT4KICBhd2FpdCBfZ2VuZXJhdGVNZXRhZGF0YSgKICAgICh0KSA9PiB0KCJmZWF0dXJlcyIpLAogICAgKHQpID0+IHQoImZlYXR1cmVfb3B0X2luX3RlYW1fZGVzY3JpcHRpb24iKSwKICAgIHVuZGVmaW5lZCwKICAgIHVuZGVmaW5lZCwKICAgIGAvc2V0dGluZ3MvdGVhbXMvJHsoYXdhaXQgcGFyYW1zKS5pZH0vZmVhdHVyZXNgCiAgKTsKCmNvbnN0IFBhZ2UgPSBhc3luYyAoeyBwYXJhbXMgfTogUGFnZVBhcmFtcykgPT4gewogIGNvbnN0IHsgaWQgfSA9IGF3YWl0IHBhcmFtczsKICBjb25zdCB0ZWFtSWQgPSBOdW1iZXIoaWQpOwoKICBpZiAoTnVtYmVyLmlzTmFOKHRlYW1JZCkpIHsKICAgIHJldHVybiBub3RGb3VuZCgpOwogIH0KCiAgY29uc3Qgc2Vzc2lvbiA9IGF3YWl0IGdldFNlcnZlclNlc3Npb24oeyByZXE6IGJ1aWxkTGVnYWN5UmVxdWVzdChhd2FpdCBoZWFkZXJzKCksIGF3YWl0IGNvb2tpZXMoKSkgfSk7CgogIGlmICghc2Vzc2lvbj8udXNlcj8uaWQpIHsKICAgIHJldHVybiBub3RGb3VuZCgpOwogIH0KCiAgY29uc3QgbWVtYmVyc2hpcCA9IGF3YWl0IHByaXNtYS5tZW1iZXJzaGlwLmZpbmRGaXJzdCh7CiAgICB3aGVyZTogewogICAgICB0ZWFtSWQsCiAgICAgIHVzZXJJZDogc2Vzc2lvbi51c2VyLmlkLAogICAgICBhY2NlcHRlZDogdHJ1ZSwKICAgIH0sCiAgICBzZWxlY3Q6IHsKICAgICAgcm9sZTogdHJ1ZSwKICAgIH0sCiAgfSk7CgogIGlmICghbWVtYmVyc2hpcCkgewogICAgcmV0dXJuIG5vdEZvdW5kKCk7CiAgfQoKICBjb25zdCB7IGNhblJlYWQsIGNhbkVkaXQgfSA9IGF3YWl0IGdldFJlc291cmNlUGVybWlzc2lvbnMoewogICAgdXNlcklkOiBzZXNzaW9uLnVzZXIuaWQsCiAgICB0ZWFtSWQsCiAgICByZXNvdXJjZTogUmVzb3VyY2UuRmVhdHVyZU9wdEluLAogIGUgYXMgYW4gaW50ZWdlci4gSS5lLiBmZWVQZXJjZW50ID0gNSBtZWFucyA1JQpmdW5jdGlvbiBGZWVSb3coeyBmZWVUeXBlLCBmZWVQZXJjZW50ID0gMCB9OiB7IGZlZVR5cGU6ICdidXknIHwgJ3NlbGwnOyBmZWVQZXJjZW50PzogbnVtYmVyIH0pOiBKU1guRWxlbWVudCB7CiAgY29uc3QgeyB0IH0gPSB1c2VUcmFuc2xhdGlvbigpCiAgY29uc3QgeyBmb3JtYXRQZXJjZW50IH0gPSB1c2VMb2NhbGl6YXRpb25Db250ZXh0KCkKICBjb25zdCB0ZXh0Q29sb3IgPSBnZXRGZWVDb2xvcihmZWVQZXJjZW50KQogIHJldHVybiAoCiAgICA8RmxleCByb3cgd2lkdGg9IjEwMCUiIGp1c3RpZnlDb250ZW50PSJzcGFjZS1iZXR3ZWVuIiBnYXA9IiRzcGFjaW5nNCI+CiAgICAgIDxUZXh0IHZhcmlhbnQ9ImJvZHkzIiBjb2xvcj0iJG5ldXRyYWwyIj4KICAgICAgICB7ZmVlVHlwZSA9PT0gJ2J1eScgPyBjYXBpdGFsaXplKHQoJ3Rva2VuLmZlZS5idXkubGFiZWwnKSkgOiBjYXBpdGFsaXplKHQoJ3Rva2VuLmZlZS5zZWxsLmxhYmVsJykpfQogICAgICA8L1RleHQ+CiAgICAgIDxUZXh0IHZhcmlhbnQ9ImJvZHkzIiBjb2xvcj17dGV4dENvbG9yfT4KICAgICAgICB7Zm9ybWF0UGVyY2VudChmZWVQZXJjZW50KX0KICAgICAgPC9UZXh0PgogICAgPC9GbGV4PgogICkKfQppbXBvcnQgeyBDZWxsLCBmbGV4UmVuZGVyLCBSb3csIFJvd0RhdGEgfSBmcm9tICdAdGFuc3RhY2svcmVhY3QtdGFibGUnCmltcG9ydCB7IFJPV19IRUlHSFRfREVTS1RPUCwgUk9XX0hFSUdIVF9NT0JJTEVfV0VCIH0gZnJvbSAnY29tcG9uZW50cy9UYWJsZS9jb25zdGFudHMnCmltcG9ydCB7IENlbGxDb250YWluZXIsIERhdGFSb3csIFRhYmxlUm93TGluayB9IGZyb20gJ2NvbXBvbmVudHMvVGFibGUvc3R5bGVkJwppbXBvcnQgeyB1c2VUYWJsZVNpemUgfSBmcm9tICdjb21wb25lbnRzL1RhYmxlL1RhYmxlU2l6ZVByb3ZpZGVyJwppbXBvcnQgeyBnZXRDb21tb25QaW5uaW5nU3R5bGVzIH0gZnJvbSAnY29tcG9uZW50cy9UYWJsZS91dGlscycKaW1wb3J0IHsgbWVtbywgdXNlTWVtbyB9IGZyb20gJ3JlYWN0JwppbXBvcnQgeyBMaW5rUHJvcHMgfSBmcm9tICdyZWFjdC1yb3V0ZXInCmltcG9ydCB7IEZsZXggfSBmcm9tICd1aS9zcmMnCmltcG9ydCB7IFVzZVNwb3JlQ29sb3JzUmV0dXJuLCB1c2VTcG9yZUNvbG9ycyB9IGZyb20gJ3VpL3NyYy9ob29rcy91c2VTcG9yZUNvbG9ycycKaW1wb3J0IHsgYnJlYWtwb2ludHMgfSBmcm9tICd1aS9zcmMvdGhlbWUnCmltcG9ydCB7IEVsZW1lbnROYW1lIH0gZnJvbSAndW5pc3dhcC9zcmMvZmVhdHVyZXMvdGVsZW1ldHJ5L2NvbnN0YW50cycKaW1wb3J0IFRyYWNlIGZyb20gJ3VuaXN3YXAvc3JjL2ZlYXR1cmVzL3RlbGVtZXRyeS9UcmFjZScKaW1wb3J0IHsgdXNlVHJhY2UgfSBmcm9tICd1dGlsaXRpZXMvc3JjL3RlbGVtZXRyeS90cmFjZS9UcmFjZUNvbnRleHQnCgppbnRlcmZhY2UgVGFibGVDZWxsUHJvcHM8VCBleHRlbmRzIFJvd0RhdGE+IHsKICBjZWxsOiBDZWxsPFQsIHVua25vd24+CiAgY29sb3JzOiBVc2VTcG9yZUNvbG9yc1JldHVybgogIHYyPzogYm9vbGVhbgp9CgpmdW5jdGlvbiBUYWJsZUNlbGxDb21wb25lbnQ8VCBleHRlbmRzIFJvd0RhdGE+KHsgY2VsbCwgY29sb3JzLCB2MiA9IHRydWUgfTogVGFibGVDZWxsUHJvcHM8VD4pOiBKU1guRWxlbWVudCB7CiAgY29uc3QgaXNQaW5uZWQgPSBjZWxsLmNvbHVtbi5nZXRJc1Bpbm5lZCgpCiAgY29uc3QgaXNGaXJzdFBpbm5lZENvbHVtbiA9IGlzUGlubmVkICYmIGNlbGwuY29sdW1uLmdldElzRmlyc3RDb2x1bW4oJ2xlZnQnKQogIGNvbnN0IHBpbm5lZFN0eWxlcyA9IGdldENvbW1vblBpbm5pbmdTdHlsZXMoeyBjb2x1bW46IGNlbGwuY29sdW1uLCBjb2xvcnMsIHYyLCBpc0hlYWRlcjogZmFsc2UgfSkKCiAgcmV0dXJuICgKICAgIDxDZWxsQ29udGFpbmVyCiAgICAgIHN0eWxlPXtwaW5uZWRTdHlsZXN9CiAgICAgQ2FuY2VsCiAgICAgICAgICAgICAgPC9EaWFsb2dDbG9zZT4KICAgICAgICAgICAgICA8QnV0dG9uIHR5cGU9InN1Ym1pdCI+U2F2ZSBjaGFuZ2VzPC9CdXR0b24+CiAgICAgICAgICAgIDwvRGlhbG9nRm9vdGVyPgogICAgICAgICAgPC9EaWFsb2dDb250ZW50PgogICAgICAgIDwvZm9ybT4KICAgICAgPC9EaWFsb2c+CiAgICA8L0V4YW1wbGU+CiAgKQp9CgpmdW5jdGlvbiBEaWFsb2dTY3JvbGxhYmxlQ29udGVudCgpIHsKICByZXR1cm4gKAogICAgPEV4YW1wbGUgdGl0bGU9IlNjcm9sbGFibGUgQ29udGVudCIgY2xhc3NOYW1lPSJpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIiPgogICAgICA8RGlhbG9nPgogICAgICAgIDxEaWFsb2dUcmlnZ2VyIHJlbmRlcj17PEJ1dHRvbiB2YXJpYW50PSJvdXRsaW5lIiAvPn0+CiAgICAgICAgICBTY3JvbGxhYmxlIENvbnRlbnQKICAgICAgICA8L0RpYWxvZ1RyaWdnZXI+CiAgICAgICAgPERpYWxvZ0NvbnRlbnQ+CiAgICAgICAgICA8RGlhbG9nSGVhZGVyPgogICAgICAgICAgICA8RGlhbG9nVGl0bGU+U2Nyb2xsYWJsZSBDb250ZW50PC9EaWFsb2dUaXRsZT4KICAgICAgICAgICAgPERpYWxvZ0Rlc2NyaXB0aW9uPgogICAgICAgICAgICAgIFRoaXMgaXMgYSBkaWFsb2cgd2l0aCBzY3JvbGxhYmxlIGNvbnRlbnQuCiAgICAgICAgICAgIDwvRGlhbG9nRGVzY3JpcHRpb24+CiAgICAgICAgICA8L0RpYWxvZ0hlYWRlcj4KICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJzdHlsZS1ub3ZhOi1teC00IHN0eWxlLW5vdmE6cHgtNCBuby1zY3JvbGxiYXIgc3R5bGUtdmVnYTpweC02IHN0eWxlLW1pcmE6cHgtNCBzdHlsZS1tYWlhOnB4LTYgc3R5bGUtdmVnYTotbXgtNiBzdHlsZS1tYWlhOi1teC02IHN0eWxlLW1pcmE6LW14LTQgc3R5bGUtbHlyYTotbXgtNCBzdHlsZS1seXJhOnB4LTQgbWF4LWgtWzcwdmhdIG92ZXJmbG93LXktYXV0byI+CiAgICAgICAgICAgIHtBcnJheS5mcm9tKHsgbGVuZ3RoOiAxMCB9KS5tYXAoKF8sIGluZGV4KSA9PiAoCiAgICAgICAgICAgICAgPHAKICAgICAgICAgICAgICAgIGtleT17aW5kZXh9CiAgICAgICAgICAgICAgICBjbGFzc05hbWU9InN0eWxlLWx5cmE6bWItMiBzdHlsZS1seXJhOmxlYWRpbmctcmVsYXhlZCBtYi00IGxlYWRpbmctbm9ybWFsIgogICAgICAgICAgICAgID4KICAgICAgICAgICAgICAgIExvcmVtIGlwc3VtIGRvbG9yIHNpdCBhbWV0LCBjb25zZWN0ZXR1ciBhZGlwaXNjaW5nIGVsaXQuIFNlZCBkbwogICAgICAgICAgICAgICAgZWl1c21vZCB0ZW1wb3IgaW5jaWRpZHVudCB1dCBsYWJvcmUgZXQgZG9sb3JlIG1hZ25hIGFsaXF1YS4gVXQKICAgICAgICAgICAgICAgIGVuaW0gYWQgbWluaW0gdmVuaWFtLCBxdWlzIG5vc3RydWQgZXhlcmNpdGF0aW9uIHVsbGFtY28gbGFib3JpcwogICAgICAgICAgICAgICAgbmlzaSB1dCBhbGlxdWlwIGV4IGVhIGNvbW1vZG8gY29uc2VxdWF0LiBEdWlzIGF1dGUgaXJ1cmUgZG9sb3IKICAgICAgICAgICAgICAgIGluIHJlcHJlaGVuZGVyaXQgaW4gdm9sdXB0YXRlIHZlbGl0IGVzc2UgY2lsbHVtIGRvbG9yZSBldSBmdWdpYXQKICAgICAgICAgICAgICAgIG51bGxhIHBhcmlhdHVyLiBFeGNlcHRldXIgc2ludCBvY2NhZWNhdCBjdXBpZGF0YXQgbm9uIHByb2lkZW50LAogICAgICAgICAgICAgICAgc3VudCBpbiBjdWxwYSBxdWkgb2ZmaWNpYSBkZXNlcnVudCBtb2xsaXQgYW5pbSBpZCBlc3QgbGFib3J1bS4KICAgICAgICAgICAgICA8L3A+CiAgICAgICAgICAgICkpfQogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9EaWFsb2dDb250ZW50PgogICAgICA8L0RpYWxvZz4KICAgIDwvRXhhbXBsZT4KICApCn0KCmZ1bmN0aW9uIERpYWxvZ1dpdGhTdGlja3lGb290ZXIoKSB7CiAgcmV0dXJuICgKICAgIDxFeGFtcGxlIHRpdGxlPSJXaXRoIFN0aWNreSBGb290ZXIiIGNHcm91cFRleHQ+aHR0cHM6Ly88L0lucHV0R3JvdXBUZXh0PgogICAgICAgICAgICAgICAgPC9JbnB1dEdyb3VwQWRkb24+CiAgICAgICAgICAgICAgICA8SW5wdXRHcm91cElucHV0IGlkPSJ3ZWJzaXRlLWlucHV0IiBwbGFjZWhvbGRlcj0iZXhhbXBsZS5jb20iIC8+CiAgICAgICAgICAgICAgICA8SW5wdXRHcm91cEFkZG9uIGFsaWduPSJpbmxpbmUtZW5kIj4KICAgICAgICAgICAgICAgICAgPEljb25QbGFjZWhvbGRlcgogICAgICAgICAgICAgICAgICAgIGx1Y2lkZT0iRXh0ZXJuYWxMaW5rSWNvbiIKICAgICAgICAgICAgICAgICAgICB0YWJsZXI9Ikljb25FeHRlcm5hbExpbmsiCiAgICAgICAgICAgICAgICAgICAgaHVnZWljb25zPSJMaW5rU3F1YXJlMDJJY29uIgogICAgICAgICAgICAgICAgICAgIHBob3NwaG9yPSJBcnJvd1NxdWFyZU91dEljb24iCiAgICAgICAgICAgICAgICAgICAgcmVtaXhpY29uPSJSaUV4dGVybmFsTGlua0xpbmUiCiAgICAgICAgICAgICAgICAgIC8+CiAgICAgICAgICAgICAgICA8L0lucHV0R3JvdXBBZGRvbj4KICAgICAgICAgICAgICA8L0lucHV0R3JvdXA+CiAgICAgICAgICAgIDwvRmllbGQ+CiAgICAgICAgICAgIDxGaWVsZD4KICAgICAgICAgICAgICA8RmllbGRMYWJlbCBodG1sRm9yPSJmZWVkYmFjay10ZXh0YXJlYSI+CiAgICAgICAgICAgICAgICBGZWVkYmFjayAmIENvbW1lbnRzCiAgICAgICAgICAgICAgPC9GaWVsZExhYmVsPgogICAgICAgICAgICAgIDxJbnB1dEdyb3VwPgogICAgICAgICAgICAgICAgPElucHV0R3JvdXBUZXh0YXJlYQogICAgICAgICAgICAgICAgICBpZD0iZmVlZGJhY2stdGV4dGFyZWEiCiAgICAgICAgICAgICAgICAgIHBsYWNlaG9sZGVyPSJTaGFyZSB5b3VyIHRob3VnaHRzLi4uIgogICAgICAgICAgICAgICAgICBjbGFzc05hbWU9Im1pbi1oLVsxMDBweF0iCiAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgPElucHV0R3JvdXBBZGRvbiBhbGlnbj0iYmxvY2stZW5kIj4KICAgICAgICAgICAgICAgICAgPElucHV0R3JvdXBUZXh0PjAvNTAwIGNoYXJhY3RlcnM8L0lucHV0R3JvdXBUZXh0PgogICAgICAgICAgICAgICAgPC9JbnB1dEdyb3VwQWRkb24+CiAgICAgICAgICAgICAgPC9JbnB1dEdyb3VwPgogICAgICAgICAgICA8L0ZpZWxkPgogICAgICAgICAgPC9GaWVsZEdyb3VwPgogICAgICAgIDwvQ2FyZENvbnRlbnQ+CiAgICAgICAgPENhcmRGb290ZXIgY2xhc3NOYW1lPSJqdXN0aWZ5LWVuZCBnYXAtMiI+CiAgICAgICAgICA8QnV0dG9uIHZhcmlhbnQ9Im91dGxpbmUiPkNhbmNlbDwvQnV0dG9uPgogICAgICAgICAgPEJ1dHRvbj5TdWJtaXQ8L0J1dHRvbj4KICAgICAgICA8L0NhcmRGb290ZXI+CiAgICAgIDwvQ2FyZD4KICAgIDwvRXhhbXBsZT4KICApCn0KCmZ1bmN0aW9uIElucHV0R3JvdXBUZXh0YXJlYUV4YW1wbGVzKCkgewogIHJldHVybiAoCiAgICA8RXhhbXBsZSB0aXRsZT0iVGV4dGFyZWEiPgogICAgICA8RmllbGRHcm91cD4KICAgICAgICA8RmllbGQ+CiAgICAgICAgICA8RmllbGRMYWJlbCBodG1sRm9yPSJ0ZXh0YXJlYS1oZWFkZXItZm9vdGVyLTEyIj4KICAgICAgICAgICAgRGVmYXVsdCBUZXh0YXJlYSAoTm8gSW5wdXQgR3JvdXApCiAgICAgICAgICA8L0ZpZWxkTGFiZWw+CiAgICAgICAgICA8VGV4dGFyZWEKICAgICAgICAgICAgaWQ9InRleHRhcmVhLWhlYWRlci1mb290ZXItMTIiCiAgICAgICAgICAgIHBsYWNlaG9sZGVyPSJFbnRlciB5b3VyIHRleHQgaGVyZS4uLiIKICAgICAgICAgIC8+CiAgICAgICAgPC9GaWVsZD4KICAgICAgICA8RmllbGQ+CiAgICAgICAgICA8RmllbGRMYWJlbCBodG1sRm9yPSJ0ZXh0YXJlYS1oZWFkZXItZm9vdGVyLTEzIj4KICAgICAgICAgICAgSW5wdXQgR3JvdXAKICAgICAgYXJlQ3VycmVuY2llc0VxdWFsKHByZXZpb3VzSW5pdGlhbElucHV0Q3VycmVuY3ksIGluaXRpYWxJbnB1dEN1cnJlbmN5KQogICAgKSB7CiAgICAgIC8vIGlmIHNldHRpbmcgaW5pdGlhbCBFVEggaW5wdXQgY2hhaW4gYmFzZWQgb24gdXNlcidzIGJhbGFuY2UKICAgICAgc2V0Q3VycmVuY3lTdGF0ZShwcmVmaWxsZWRTdGF0ZSkKICAgIH0KICB9LCBbaW5pdGlhbElucHV0Q3VycmVuY3ksIGlzVXNlclNlbGVjdGVkVG9rZW4sIHByZWZpbGxlZFN0YXRlLCBwcmV2aW91c0luaXRpYWxJbnB1dEN1cnJlbmN5XSkKCiAgLy8gYmlvbWUtaWdub3JlIGxpbnQvY29ycmVjdG5lc3MvdXNlRXhoYXVzdGl2ZURlcGVuZGVuY2llczogK3ByZWZpbGxlZFN0YXRlCiAgdXNlRWZmZWN0KCgpID0+IHsKICAgIGlmICghaXNVc2VyU2VsZWN0ZWRUb2tlbiAmJiBpbml0aWFsQ2hhaW5JZCAmJiBwcmV2aW91c0luaXRpYWxDaGFpbklkICE9PSBpbml0aWFsQ2hhaW5JZCkgewogICAgICBzZXRTZWxlY3RlZENoYWluSWQoaW5pdGlhbENoYWluSWQpCiAgICB9CiAgfSwgW2luaXRpYWxDaGFpbklkLCBpc1VzZXJTZWxlY3RlZFRva2VuLCBwcmVmaWxsZWRTdGF0ZSwgcHJldmlvdXNJbml0aWFsQ2hhaW5JZCwgc2V0U2VsZWN0ZWRDaGFpbklkXSkKCiAgY29uc3QgdmFsdWUgPSB1c2VNZW1vKCgpID0+IHsKICAgIHJldHVybiB7CiAgICAgIGN1cnJlbmN5U3RhdGUsCiAgICAgIHNldEN1cnJlbmN5U3RhdGUsCiAgICAgIGN1cnJlbnRUYWIsCiAgICAgIHNldEN1cnJlbnRUYWIsCiAgICAgIGlzU3dhcEFuZExpbWl0Q29udGV4dDogdHJ1ZSwKICAgIH0KICB9LCBbY3VycmVuY3lTdGF0ZSwgY3VycmVudFRhYl0pCgogIHVzZVJlcG9ydFRvdGFsQmFsYW5jZXNVc2RGb3JBbmFseXRpY3MoKQoKICByZXR1cm4gPFN3YXBBbmRMaW1pdENvbnRleHQuUHJvdmlkZXIgdmFsdWU9e3ZhbHVlfT57Y2hpbGRyZW59PC9Td2FwQW5kTGltaXRDb250ZXh0LlByb3ZpZGVyPgp9CmltcG9ydCB7IENsaXBQYXRoLCBEZWZzLCBHLCBQYXRoLCBSZWN0LCBTdmcgfSBmcm9tICdyZWFjdC1uYXRpdmUtc3ZnJwoKLy8gZXNsaW50LWRpc2FibGUtbmV4dC1saW5lIG5vLXJlbGF0aXZlLWltcG9ydC1wYXRocy9uby1yZWxhdGl2ZS1pbXBvcnQtcGF0aHMKaW1wb3J0IHsgY3JlYXRlSWNvbiB9IGZyb20gJy4uL2ZhY3Rvcmllcy9jcmVhdGVJY29uJwoKZXhwb3J0IGNvbnN0IFtPcEV0aGVyc2NhbkxvZ29EYXJrLCBBbmltYXRlZE9wRXRoZXJzY2FuTG9nb0RhcmtdID0gY3JlYXRlSWNvbih7CiAgbmFtZTogJ09wRXRoZXJzY2FuTG9nb0RhcmsnLAogIGdldEljb246IChwcm9wcykgPT4gKAogICAgPFN2ZyB2aWV3Qm94PSIwIDAgNTAgNTAiIGZpbGw9Im5vbmUiIHsuLi5wcm9wc30+CiAgICAgIDxHIGNsaXBQYXRoPSJ1cmwoI2NsaXAwXzgxMzBfNTA5NTYpIj4KICAgICAgICA8UGF0aAogICAgICAgICAgZD0iTTI1IDUwQzM4LjgwNzEgNTAgNTAgMzguODA3MSA1MCAyNUM1MCAxMS4xOTI5IDM4LjgwNzEgMCAyNSAwQzExLjE5MjkgMCAwIDExLjE5MjkgMCAyNUMwIDM4LjgwNzEgMTEuMTkyOSA1MCAyNSA1MFoiCiAgICAgICAgICBmaWxsPSJjdXJyZW50Q29sb3IiCiAgICAgICAgLz4KICAgICAgICA8UGF0aAogICAgICAgICAgZD0iTTI1IDUwQzM4LjgwNzEgNTAgNTAgMzguODA3MSA1MCAyNUM1MCAxMS4xOTI5IDM4LjgwNzEgMCAyNSAwQzExLjE5MjkgMCAwIDExLjE5MjkgMCAyNUMwIDM4LjgwNzEgMTEuMTkyOSA1MCAyNSA1MFpNMTUuNTkxIDMxLjg2N0MxNi4yNzUgMzIuMDgyMyAxNy4wMTYgMzIuMTkgMTcuODE0IDMyLjE5QzE5LjY1MDcgMzIuMTkgMjEuMTEzNyAzMS43NjU3IDIyLjIwMyAzMC45MTdDMjMuMjkyMyAzMC4wNTU3IDI0LjA1MjMgMjguNzU3MyAyNC40ODMgMjcuMDIyQzI0LjYwOTcgMjYuNDc3MyAyNC43MyAyNS45MzI3IDI0Ljg0NCAyNS4zODhDMjQuOTcwNyAyNC44NDMzIDI1LjA3ODMgMjQuMjkyMyAyNS4xNjcgMmF0YSwgaGFzRXhpc3RpbmdGZWVUaWVycyB9ID0gdXNlQWxsRmVlVGllclBvb2xEYXRhKHsKICAgIGNoYWluSWQ6IHRva2VuMD8uY2hhaW5JZCwKICAgIHByb3RvY29sVmVyc2lvbiwKICAgIHNka0N1cnJlbmNpZXM6IGN1cnJlbmNpZXMuc2RrLAogICAgaG9vazogaG9vayA/PyBaRVJPX0FERFJFU1MsCiAgfSkKCiAgY29uc3QgZmVlVGllckhhc0xwUmV3YXJkcyA9IHVzZU1lbW8oCiAgICAoKSA9PiBPYmplY3QudmFsdWVzKGZlZVRpZXJEYXRhKS5zb21lKCh0aWVyKSA9PiB0aWVyLmJvb3N0ZWRBcHIgJiYgdGllci5ib29zdGVkQXByID4gMCkgJiYgaXNMcEluY2VudGl2ZXNFbmFibGVkLAogICAgW2ZlZVRpZXJEYXRhLCBpc0xwSW5jZW50aXZlc0VuYWJsZWRdLAogICkKCiAgY29uc3QgbW9zdFVzZWRGZWVUaWVyID0gdXNlTWVtbygoKSA9PiB7CiAgICBpZiAoaGFzRXhpc3RpbmdGZWVUaWVycyAmJiBPYmplY3Qua2V5cyhmZWVUaWVyRGF0YSkubGVuZ3RoID4gMCkgewogICAgICByZXR1cm4gT2JqZWN0LnZhbHVlcyhmZWVUaWVyRGF0YSkucmVkdWNlKChoaWdoZXN0LCBjdXJyZW50KSA9PiB7CiAgICAgICAgcmV0dXJuIGN1cnJlbnQucGVyY2VudGFnZS5ncmVhdGVyVGhhbihoaWdoZXN0LnBlcmNlbnRhZ2UpID8gY3VycmVudCA6IGhpZ2hlc3QKICAgICAgfSkKICAgIH0KCiAgICByZXR1cm4gdW5kZWZpbmVkCiAgfSwgW2hhc0V4aXN0aW5nRmVlVGllcnMsIGZlZVRpZXJEYXRhXSkKCiAgdXNlRWZmZWN0KCgpID0+IHsKICAgIC8vIElmIGEgZmVlIHRpZXIgaXMgYWxyZWFkeSBzZXQsIHJldHVybgogICAgaWYgKGZlZSkgewogICAgICByZXR1cm4KICAgIH0KCiAgICBpZiAobW9zdFVzZWRGZWVUaWVyKSB7CiAgICAgIHNldFBvc2l0aW9uU3RhdGUoKHByZXZTdGF0ZSkgPT4gKHsKICAgICAgICAuLi5wcmV2U3RhdGUsCiAgICAgICAgZmVlOiBtb3N0VXNlZEZlZVRpZXIuZmVlLAogICAgICB9KSkKICAgICAgc2VuZEFuYWx5dGljc0V2ZW50KExpcXVpZGl0eUV2ZW50TmFtZS5TZWxlY3RMaXF1aWRpdHlQb29sRmVlVGllciwgewogICAgICAgIGFjdGlvbjogRmVlUG9vbFNlbGVjdEFjdGlvbi5SZWNvbW1lbmRlZCwKICAgICAgICBmZWVfdGllcjogbW9zdFVzZWRGZWVUaWVyLmZlZS5mZWVBbW91bnQsCiAgICAgICAgLi4udHJhY2UsCiAgICAgIH0pCiAgICB9CiAgfSwgW21vc3RVc2VkRmVlVGllciwgZmVlLCBzZXRQb3NpdGlvblN0YXRlLCB0cmFjZV0pCgogIGNvbnN0IHsgY2hhaW5zIH0gPSB1c2VFbmFibGVkQ2hhaW5zKHsgcGxhdGZvcm06IFBsYXRmb3JtLkVWTSB9KQogIGNvbnN0IHN1cHBvcnRlZENoYWlucyA9IHVzZU1lbW8oKCkgPT4gewogICAgcmV0dXJuIHByb3RvY29sVmVyc2lvbiA9PT0gUHJvdG9jb2xWZXJzaW9uLlY0CiAgICAgID8gY2hhaW5zLmZpbHRlcigoY2hhaW4pID0+ICFpc1Y0VW5zdXBwb3J0ZWRDaGFpbihjaGFpbikpCiAgICAgIDogcHJvdG9jb2xWZXJzaW9uID09PSBQcm90b2NvbFZlcnNpb24uVjIKICAgICAgICA/IGNoYWlucy5maWx0ZXIoKGNoYWluKSA9PiBTVVBQT1JURURfVjJQT09MX0NIQUlOX0lEUy5pbmNsdWRlcyhjaGFpbikpCiAgICAgICAgOiB1bmRlZmluZWQKICB9LCBbcHJvdG9jb2xWZXJzaW9uLCBjaGFpbnNdKQoKICBjb25zdCBoYW5kbGVPbkNvbnRpbnVlID0gKCkgPT4gewogICAgaWYgKHdyYXBwZWROYXRpdmVXYXJuaW5nKSB7CiAgICAgIHNldFNob3dXcmFwcGVkTmF0aXZlV2FybmluZyh0cnVlKQogICAgICByZXR1cm4KICAgIH0KCiAgICBpZiAoaG9vayAhPT0gdXNlckFwcHJvdmVkSG9vaykgewogICAgICBzZXRIb29rTW9kYWxPcGVuKHRydWUpCiAgICB9IGVsc2UgewogICAgICBvbkNvbnRpbnVlKCkKICAgIH0KICB9CgogIGNvbnN0IHdyYXBwZWROYXRpdmVXYXJuaW5nID0gdXNlTWVtbygoKTogV3JhcHBlZE5hdGl2ZVdhcm5pbmcgfCB1bmRlZmluZWQgPT4gewogICAgaWYgKHByb3RvY29sVmVyc2lvbiAhPT0gUHJja2VkOmJvcmRlci1wcmltYXJ5LzMwIGRhcms6aGFzLWRhdGEtY2hlY2tlZDpib3JkZXItcHJpbWFyeS8yMCBkYXJrOmhhcy1kYXRhLWNoZWNrZWQ6YmctcHJpbWFyeS8xMCBncm91cC9maWVsZC1sYWJlbCBwZWVyL2ZpZWxkLWxhYmVsIGZsZXggdy1maXQgZ2FwLTIgbGVhZGluZy1zbnVnIGdyb3VwLWRhdGEtW2Rpc2FibGVkPXRydWVdL2ZpZWxkOm9wYWNpdHktNTAgaGFzLVs+W2RhdGEtc2xvdD1maWVsZF1dOnJvdW5kZWQtbGcgaGFzLVs+W2RhdGEtc2xvdD1maWVsZF1dOmJvcmRlciBbJj4qXTpkYXRhLVtzbG90PWZpZWxkXTpwLTIuNSIsCiAgICAgICAgImhhcy1bPltkYXRhLXNsb3Q9ZmllbGRdXTp3LWZ1bGwgaGFzLVs+W2RhdGEtc2xvdD1maWVsZF1dOmZsZXgtY29sIiwKICAgICAgICBjbGFzc05hbWUKICAgICAgKX0KICAgICAgey4uLnByb3BzfQogICAgLz4KICApCn0KCmZ1bmN0aW9uIEZpZWxkVGl0bGUoeyBjbGFzc05hbWUsIC4uLnByb3BzIH06IFJlYWN0LkNvbXBvbmVudFByb3BzPCJkaXYiPikgewogIHJldHVybiAoCiAgICA8ZGl2CiAgICAgIGRhdGEtc2xvdD0iZmllbGQtbGFiZWwiCiAgICAgIGNsYXNzTmFtZT17Y24oCiAgICAgICAgImZsZXggdy1maXQgaXRlbXMtY2VudGVyIGdhcC0yIHRleHQtc20gbGVhZGluZy1zbnVnIGZvbnQtbWVkaXVtIGdyb3VwLWRhdGEtW2Rpc2FibGVkPXRydWVdL2ZpZWxkOm9wYWNpdHktNTAiLAogICAgICAgIGNsYXNzTmFtZQogICAgICApfQogICAgICB7Li4ucHJvcHN9CiAgICAvPgogICkKfQoKZnVuY3Rpb24gRmllbGREZXNjcmlwdGlvbih7IGNsYXNzTmFtZSwgLi4ucHJvcHMgfTogUmVhY3QuQ29tcG9uZW50UHJvcHM8InAiPikgewogIHJldHVybiAoCiAgICA8cAogICAgICBkYXRhLXNsb3Q9ImZpZWxkLWRlc2NyaXB0aW9uIgogICAgICBjbGFzc05hbWU9e2NuKAogICAgICAgICJ0ZXh0LW11dGVkLWZvcmVncm91bmQgdGV4dC1zdGFydCB0ZXh0LXNtIGxlYWRpbmctbm9ybWFsIGZvbnQtbm9ybWFsIGdyb3VwLWhhcy1bW2RhdGEtb3JpZW50YXRpb249aG9yaXpvbnRhbF1dL2ZpZWxkOnRleHQtYmFsYW5jZSBbW2RhdGEtdmFyaWFudD1sZWdlbmRdKyZdOi1tdC0xLjUiLAogICAgICAgICJsYXN0Om10LTAgbnRoLWxhc3QtMjotbXQtMSIsCiAgICAgICAgIlsmPmE6aG92ZXJdOnRleHQtcHJpbWFyeSBbJj5hXTp1bmRlcmxpbmUgWyY+YV06dW5kZXJsaW5lLW9mZnNldC00IiwKICAgICAgICBjbGFzc05hbWUKICAgICAgKX0KICAgICAgey4uLnByb3BzfQogICAgLz4KICApCn0KCmZ1bmN0aW9uIEZpZWxkU2VwYXJhdG9yKHsKICBjaGlsZHJlbiwKICBjbGFzc05hbWUsCiAgLi4ucHJvcHMKfTogUmVhY3QuQ29tcG9uZW50UHJvcHM8ImRpdiI+ICYgewogIGNoaWxkcmVuPzogUmVhY3QuUmVhY3ROb2RlCn0pIHsKICByZXR1cm4gKAogICAgPGRpdgogICAgICBkYXRhLXNsb3Q9ImZpZWxkLXNlcGFyYXRvciIKICAgICAgZGF0YS1jb250ZW50PXshIWNoaWxkcmVufQogICAgICBjbGFzc05hbWU9e2NuKAogICAgICAgICJyZWxhdGl2ZSAtbXktMiBoLTUgdGV4dC1zbSBncm91cC1kYXRhLVt2YXJpYW50PW91dGxpbmVdL2ZpZWxkLWdyb3VwOi1tYi0yIiwKICAgICAgICBjbGFzc05hbWUKICAgICAgKX0KICAgICAgey4uLnByb3BzfQogICAgPgogICAgICA8U2VwYXJhdG9yIGNsYXNzTmFtZT0iYWJzb2x1dGUgaW5zZXQtMCB0b3AtMS8yIiAvPgogICAgICB7Y2hpbGRyZW4gJiYgKAogICAgICAgIDxzcGFuCiAgICAgICAgICBjbGFzc05hbWU9InRleHQtbXV0ZWQtZm9yZWdyb3VuZCBiZy1iYWNrZ3JvdW5kIHJlbGF0aXZlIG14LWF1dG8gYmxvY2sgdy1maXQgcHgtMiIKICAgICAgICAgIGRhdGEtc2xvdD0iZmllbGQtc2VwYXJhdG9yLWNvbnRlbnQiCiAgICAgICAgPgogICAgICAgICAge2NoaWxkcmVufQogICAgICAgIDwvc3Bhbj4KICAgICAgKX0KICAgIDwvZGl2PgogICkKfQoKZnVuY3Rpb24gRmllbGRFcnJvcih7Cj0iTTEyOCAyNTZhMTI4Ljk3NiAxMjguOTc2IDAgMCAxLTI1LjgtMi42IDEyNy4zMDkgMTI3LjMwOSAwIDAgMS00NS43Ny0xOS4yNjEgMTI4LjM2NiAxMjguMzY2IDAgMCAxLTQ2LjM3NS01Ni4zMTVBMTI3LjM1NyAxMjcuMzU3IDAgMCAxIDIuNiAxNTMuOGExMjkuMjUxIDEyOS4yNTEgMCAwIDEgMC01MS41OTMgMTI3LjMxIDEyNy4zMSAwIDAgMSAxOS4yNi00NS43NyAxMjguMzcyIDEyOC4zNzIgMCAwIDEgNTYuMzE3LTQ2LjM3OEExMjcuMzMgMTI3LjMzIDAgMCAxIDEwMi4yIDIuNmExMjkuMjQ0IDEyOS4yNDQgMCAwIDEgNTEuNTkzIDAgMTI3LjMwOCAxMjcuMzA4IDAgMCAxIDQ1Ljc3IDE5LjI2IDEyOC4zNjcgMTI4LjM2NyAwIDAgMSA0Ni4zNzUgNTYuMzE2QTEyNy4zNDMgMTI3LjM0MyAwIDAgMSAyNTMuNCAxMDIuMmExMjkuMjQ4IDEyOS4yNDggMCAwIDEgMCA1MS41OTMgMTI3LjMgMTI3LjMgMCAwIDEtMTkuMjYgNDUuNzcgMTI4LjM4MiAxMjguMzgyIDAgMCAxLTU2LjMxNiA0Ni4zNzVBMTI3LjQgMTI3LjQgMCAwIDEgMTUzLjggMjUzLjQgMTI4Ljk3NyAxMjguOTc3IDAgMCAxIDEyOCAyNTZ6bTAtMjQyLjI4N2ExMTUuMTQ1IDExNS4xNDUgMCAwIDAtMjMuMDMzIDIuMzIyQTExMy42NTcgMTEzLjY1NyAwIDAgMCA2NC4xIDMzLjIzMmExMTQuNjIyIDExNC42MjIgMCAwIDAtNDEuNCA1MC4yODMgMTEzLjcgMTEzLjcgMCAwIDAtNi42NTkgMjEuNDUyIDExNS40IDExNS40IDAgMCAwIDAgNDYuMDY1IDExMy42NiAxMTMuNjYgMCAwIDAgMTcuMiA0MC44NjYgMTE0LjYyNyAxMTQuNjI3IDAgMCAwIDUwLjI4MiA0MS40MDcgMTEzLjc1IDExMy43NSAwIDAgMCAyMS40NTMgNi42NTggMTE1LjM4MSAxMTUuMzgxIDAgMCAwIDQ2LjA2NSAwIDExMy42MDkgMTEzLjYwOSAwIDAgMCA0MC44NjYtMTcuMiAxMTQuNjIyIDExNC42MjIgMCAwIDAgNDEuMzkzLTUwLjI3OCAxMTMuNzQxIDExMy43NDEgMCAwIDAgNi42NTktMjEuNDUzIDExNS40IDExNS40IDAgMCAwIDAtNDYuMDY1IDExMy42NjIgMTEzLjY2MiAwIDAgMC0xNy4yLTQwLjg2NUExMTQuNjE5IDExNC42MTkgMCAwIDAgMTcyLjQ4NSAyMi43YTExMy43NCAxMTMuNzQgMCAwIDAtMjEuNDUzLTYuNjU5QTExNS4xNDUgMTE1LjE0NSAwIDAgMCAxMjggMTMuNzE0eiIKICAgICAgICAgIC8+CiAgICAgICAgKX0KICAgICAgICB7c3ltYm9sICYmICgKICAgICAgICAgIDxpbWFnZQogICAgICAgICAgICB4PSIyNSIKICAgICAgICAgICAgeT0iMjUiCiAgICAgICAgICAgIGhyZWY9e2AvaWNvbnMvdG9rZW5zLyR7c3ltYm9sLnRvTG93ZXJDYXNlKCl9LnN2Z2B9CiAgICAgICAgICAgIHdpZHRoPSIyMDYiCiAgICAgICAgICAgIGhlaWdodD0iMjA2IgogICAgICAgICAgLz4KICAgICAgICApfQogICAgICA8L2c+CiAgICA8L3N2Zz4KICApOwp9KTsKVG9rZW5SaW5nLmRpc3BsYXlOYW1lID0gJ1Rva2VuUmluZyc7CgppbnRlcmZhY2UgVG9rZW5JY29uUHJvcHMgZXh0ZW5kcyBJY29uUHJvcHMgewogIHN5bWJvbDogc3RyaW5nOwogIGFUb2tlbj86IGJvb2xlYW47CiAgd2FUb2tlbj86IGJvb2xlYW47CiAgYVRva2Vucz86IGJvb2xlYW5bXTsKICB3YVRva2Vucz86IGJvb2xlYW5bXTsKfQoKZnVuY3Rpb24gU2luZ2xlVG9rZW5JY29uKHsgc3ltYm9sLCBhVG9rZW4sIHdhVG9rZW4sIC4uLnJlc3QgfTogVG9rZW5JY29uUHJvcHMpIHsKICBjb25zdCBbdG9rZW5TeW1ib2wsIHNldFRva2VuU3ltYm9sXSA9IHVzZVN0YXRlKHN5bWJvbC50b0xvd2VyQ2FzZSgpKTsKCiAgdXNlRWZmZWN0KCgpID0+IHsKICAgIHNldFRva2VuU3ltYm9sKHN5bWJvbC50b0xvd2VyQ2FzZSgpKTsKICB9LCBbc3ltYm9sXSk7CgogIHJldHVybiAoCiAgICA8SWNvbiB7Li4ucmVzdH0gc3g9e3sgZGlzcGxheTogJ2ZsZXgnLCBwb3NpdGlvbjogJ3JlbGF0aXZlJywgYm9yZGVyUmFkaXVzOiAnNTAlJywgLi4ucmVzdC5zeCB9fT4KICAgICAge2FUb2tlbiB8fCB3YVRvcmVzcyh2YWxpZEFkZHJlc3NXaXRoRW5zQW5kVW5pdGFnKSwKICAgICAgZW5zTmFtZSwKICAgICAgdW5pdGFnOiBmYWxsYmFja1VuaXRhZ05hbWUsCiAgICB9KQogIH0pCgogIGl0KCdyZXR1cm5zIHZhbGlkYXRlZCByZWNpcGllbnREYXRhIHdoZW4gaXQgZXhpc3RzJywgKCkgPT4gewogICAgY29uc3QgdmFsaWRBZGRyZXNzID0gJzB4MTIzNDU2Nzg5YWJjZGVmMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMCcKCiAgICBjb25zdCB2YWxpZGF0ZWRSZWNpcGllbnREYXRhID0gewogICAgICBhZGRyZXNzOiAnMHg1MjQ0NTE3ODlhYmNkZWYwMDAwMDAwMDAwMDAwMDAwMDAwMDAwMDAwJywKICAgICAgZW5zTmFtZTogJ215LXZhbGlkYXRlZC1lbnMuZXRoJywKICAgICAgdW5pdGFnOiAnbXl2YWxpZGF0ZWR1bml0YWcnLAogICAgfQoKICAgIGNvbnN0IG1vY2tTZW5kU3RhdGU6IFNlbmRTdGF0ZSA9IHsKICAgICAgLi4uZGVmYXVsdFNlbmRTdGF0ZSwKICAgICAgcmVjaXBpZW50OiB2YWxpZEFkZHJlc3MsCiAgICAgIHZhbGlkYXRlZFJlY2lwaWVudERhdGEsCiAgICB9CgogICAgY29uc3QgeyByZXN1bHQgfSA9IHJlbmRlckhvb2soKCkgPT4gdXNlRGVyaXZlZFNlbmRJbmZvKG1vY2tTZW5kU3RhdGUpKQogICAgY29uc3QgaW5mbyA9IHJlc3VsdC5jdXJyZW50CgogICAgZXhwZWN0KGluZm8ucmVjaXBpZW50RGF0YSkudG9FcXVhbCh2YWxpZGF0ZWRSZWNpcGllbnREYXRhKQogIH0pCn0pCmltcG9ydCB7IEJveCwgU3RhY2ssIFR5cG9ncmFwaHksIHVzZVRoZW1lIH0gZnJvbSAnQG11aS9tYXRlcmlhbCc7CmltcG9ydCB7IEFubm90YXRpb24sIEh0bWxMYWJlbCB9IGZyb20gJ0B2aXN4L2Fubm90YXRpb24nOwppbXBvcnQgeyBBeGlzQm90dG9tLCBBeGlzTGVmdCB9IGZyb20gJ0B2aXN4L2F4aXMnOwppbXBvcnQgeyBjdXJ2ZU1vbm90b25lWCB9IGZyb20gJ0B2aXN4L2N1cnZlJzsKaW1wb3J0IHsgbG9jYWxQb2ludCB9IGZyb20gJ0B2aXN4L2V2ZW50JzsKaW1wb3J0IHsgR3JpZFJvd3MgfSBmcm9tICdAdmlzeC9ncmlkJzsKaW1wb3J0IHsgR3JvdXAgfSBmcm9tICdAdmlzeC9ncm91cCc7CmltcG9ydCB7IHNjYWxlTGluZWFyLCBzY2FsZVRpbWUgfSBmcm9tICdAdmlzeC9zY2FsZSc7CmltcG9ydCB7IEJhciwgTGluZSwgTGluZVBhdGggfSBmcm9tICdAdmlzeC9zaGFwZSc7CmltcG9ydCB7IGRlZmF1bHRTdHlsZXMsIFRvb2x0aXBXaXRoQm91bmRzLCB3aXRoVG9vbHRpcCB9IGZyb20gJ0B2aXN4L3Rvb2x0aXAnOwppbXBvcnQgeyBXaXRoVG9vbHRpcFByb3ZpZGVkUHJvcHMgfSBmcm9tICdAdmlzeC90b29sdGlwL2xpYi9lbmhhbmNlcnMvd2l0aFRvb2x0aXAnOwppbXBvcnQgeyBiaXNlY3RvciwgZXh0ZW50LCBtYXggfSBmcm9tICdkMy1hcnJheSc7CmltcG9ydCB7IHRpbWVGb3JtYXQgfSBmcm9tICdkMy10aW1lLWZvcm1hdCc7CmltcG9ydCBSZWFjdCwgeyB1c2VDYWxsYmFjaywgdXNlTWVtbyB9IGZyb20gJ3JlYWN0JzsKCmV4cG9ydCB0eXBlIE1lcml0QXB5RGF0YUl0ZW0gPSB7CiAgZGF5OiB7CiAgICB2YWx1ZTogc3RyaW5nOwogIH07CiAgbWVyaXRfYXB5OiBudW1iZXI7Cn07Cgp0eXBlIFRvb2x0aXBEYXRhID0gTWVyaXRBcHlEYXRhSXRlbTsKCi8qKgogKiBGb3JtYXRzIHRoZSBnaXZlbiBkYXRlIGZvciBkaXNwbGF5IGluIHRoZSB0b29sdGlwLgogKiBSZXR1cm5zIGZvcm1hdCBsaWtlICdKdWwgMjQsIDIwMjUnIGZvciBzdGFuZGFyZCBkaXNwbGF5LgogKi8KY29uc3QgZm9ybWF0RGF0ZSA9IChkOiBEYXRlKSA9PiB7CiAgY29uc3QgZm9ybWF0dGVkID0gdGltZUZvcm1hdCgnJWIgJWQsICVZJyk7CiAgcmV0dXJuIGZvcm1hdHRlZChkKTsKfTsKCi8vIGFjY2Vzc29ycwpjb25zdCBnZXREYXRlID0gKGQ6IE1lcml0QXB5RGF0YUl0ZW0pID0+IG5ldyBEYXRlKGQuZGF5LnZhbHVlKTsKY29uc3QgYmlzZWN0RGF0ZSA9IGJpc2VjdG9yPE1lcml0QXB5RGF0YUl0ZW0sIERhdGU+KChkKXN0IG9uSW5wdXQgPSAoZXZlbnQ6IEZvcm1FdmVudDxIVE1MSW5wdXRFbGVtZW50PikgPT4gew0KICAgIGNvbnN0IHRhcmdldCA9IGV2ZW50LnRhcmdldCBhcyBIVE1MSW5wdXRFbGVtZW50Ow0KICAgIGNvbnN0IGZ1bGxWYWx1ZSA9IHRhcmdldC52YWx1ZTsNCiAgICBzZXRDdXJyZW50VmFsdWUoZnVsbFZhbHVlKTsNCiAgICB0YXJnZXQudmFsdWUgPSBmdWxsVmFsdWU7DQogIH07DQoNCiAgcmV0dXJuICgNCiAgICA8ZGl2IGNsYXNzTmFtZT17Y2xhc3NOYW1lcyhjb250YWluZXJDbGFzc05hbWUpfT4NCiAgICAgIHshIWxhYmVsICYmICFub0xhYmVsICYmICgNCiAgICAgICAgPFNrZWxldG9uDQogICAgICAgICAgYXM9e0xhYmVsfQ0KICAgICAgICAgIGh0bWxGb3I9e2lkfQ0KICAgICAgICAgIGxvYWRpbmdDbGFzc05hbWU9InctMTYiDQogICAgICAgICAgey4uLmxhYmVsUHJvcHN9DQogICAgICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWVzKGxhYmVsQ2xhc3NOYW1lLCBsYWJlbFNyT25seSAmJiAic3Itb25seSIsIHByb3BzLmVycm9yICYmICJ0ZXh0LWVycm9yIil9Pg0KICAgICAgICAgIHtsYWJlbH0NCiAgICAgICAgICB7c2hvd0FzdGVyaXNrSW5kaWNhdG9yICYmICFyZWFkT25seSAmJiBwYXNzVGhyb3VnaC5yZXF1aXJlZCA/ICgNCiAgICAgICAgICAgIDxzcGFuIGNsYXNzTmFtZT0idGV4dC1kZWZhdWx0IG1sLTEgZm9udC1tZWRpdW0iPio8L3NwYW4+DQogICAgICAgICAgKSA6IG51bGx9DQogICAgICAgICAge0xvY2tlZEljb259DQogICAgICAgIDwvU2tlbGV0b24+DQogICAgICApfQ0KDQogICAgICA8ZGl2DQogICAgICAgIGRpcj0ibHRyIg0KICAgICAgICBjbGFzc05hbWU9ImZvY3VzLXdpdGhpbjpyaW5nLWJyYW5kLWRlZmF1bHQgZ3JvdXAgcmVsYXRpdmUgbWItMSBmbGV4IGl0ZW1zLWNlbnRlciByb3VuZGVkLW1kIHRyYW5zaXRpb24gZm9jdXMtd2l0aGluOm91dGxpbmUtbm9uZSBmb2N1cy13aXRoaW46cmluZy0yIj4NCiAgICAgICAge2FkZE9uTGVhZGluZyAmJiAoDQogICAgICAgICAgPEFkZG9uIGNsYXNzTmFtZT17Y2xhc3NOYW1lcygibHRyOnJvdW5kZWQtbC1tZCBydGw6cm91bmRlZC1yLW1kIiwgYWRkT25DbGFzc25hbWUpfT4NCiAgICAgICAgICAgIHthZGRPbkxlYWRpbmd9DQogICAgICAgICAgPC9BZGRvbj4NCiAgICAgICAgKX0NCiAgICAgICAgPElucHV0DQogICAgICAgICAgaWQ9e2lkfQ0KICAgICAgICAgIHR5cGU9InRleHQiDQogICAgICAgICAgcGxhY2Vob2xkZXI9e3BsYWNlaG9sZGVyfQ0KICAgICAgICAgIGlzRnVsbFdpZHRoPXtpbnB1dElzRnVsbFdpZHRofQ0KICAgICAgICAgIGNsYXNzTmFtZT17Y2xhc3NOYW1lcygNCiAgICAgICAgICAgIGNsYXNzTmFtZSwNCiAgICAgICAgICAgICJkaXNhYmxlZDpiZy1zdWJ0bGUgZGlzYWJsZWQ6aG92ZXI6Ym9yZGVyLXN1YnRsZSBtYi0wIHJvdW5kZWQtci1ub25lIGJvcmRlci1yLTAgZGlzYWJsZWQ6Y3Vyc29yLW5vdC1hbGxvd2VkIiwNCiAgICAgICAgICAgIGFkZE9uTGVhZGluZyAmJiAicm91bmRlZC1sLW5vbmUgYm9yZGVyLWwtMCIsDQogICAgICAgICAgICBpc1Bhc3N3b3JkVmlzaWJsZSAmJiAiaW5saW5lLWJsb2NrIiwNCiAgICAgICAgICAgICFpc1Bhc3N3b3JkVmlzaWJsZSAmJiAiaGlkZGVuIiwNCiAgICAgICAgICAgICJteS0wISByaW5nLTAhIg0KICAgICAgICAgICl9DQogICAgICAgICAgey4uLnBhc3NUaHJvdWdofQ0KICAgICAgICAgIHJlZj17cmVmfQ0KICAgICAgICAgIG9uSW5wdXQ9e29uSW5wdXR9DQogIGlvbjogLTguNXB4IC04LjVweDsKYApjb25zdCBTcHJpdGVDb250YWluZXIgPSBtb3Rpb24oZGVwcmVjYXRlZFN0eWxlZC5kaXZgCiAgcG9pbnRlci1ldmVudHM6IG5vbmU7CiAgZGlwbGF5OiBmbGV4OwogIGZsZXgtZGlyZWN0aW9uOiBjb2x1bW47CiAgY29sb3I6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUubmV1dHJhbDJ9OwpgKQoKY29uc3QgcHVsc2F0ZSA9IChjb2xvcjogc3RyaW5nKSA9PiBrZXlmcmFtZXNgCiAgMCUgewogICAgYm94LXNoYWRvdzogMCAwIDAgMCAke29wYWNpZnkoMjQsIGNvbG9yKX07CiAgfQogIDEwMCUgewogICAgYm94LXNoYWRvdzogMCAwIDAgNHB4ICR7b3BhY2lmeSgyNCwgY29sb3IpfTsKICB9CmAKZXhwb3J0IGNvbnN0IExpdmVJY29uID0gZGVwcmVjYXRlZFN0eWxlZC5kaXY8eyBkaXNwbGF5OiBzdHJpbmcgfT5gCiAgZGlzcGxheTogJHsoeyBkaXNwbGF5IH0pID0+IGRpc3BsYXl9OwogIHdpZHRoOiA2cHg7CiAgaGVpZ2h0OiA2cHg7CiAgYm9yZGVyLXJhZGl1czogNTAlOwogIGJhY2tncm91bmQ6ICR7KHsgdGhlbWUgfSkgPT4gdGhlbWUuc3VjY2Vzc307CiAgYW5pbWF0aW9uLW5hbWU6ICR7KHsgdGhlbWUgfSkgPT4gcHVsc2F0ZSh0aGVtZS5zdWNjZXNzKX07CiAgYW5pbWF0aW9uLWZpbGwtbW9kZTogZm9yd2FyZHM7CiAgYW5pbWF0aW9uLWRpcmVjdGlvbjogYWx0ZXJuYXRlOwogIGFuaW1hdGlvbi1kdXJhdGlvbjogMTAwMG1zOwogIGFuaW1hdGlvbi1pdGVyYXRpb24tY291bnQ6IGluZmluaXRlOwogIGFuaW1hdGlvbi10aW1pbmctZnVuY3Rpb246IGVhc2UtaW4tb3V0OwpgCgpjb25zdCBUaXRsZSA9IGRlcHJlY2F0ZWRTdHlsZWQuaDM8eyBjb2xvcjogc3RyaW5nIH0+YAogIHBhZGRpbmc6IDA7CiAgbWFyZ2luOiAwOwogIGZvbnQtZmFtaWx5OiBCYXNlbDsKICBmb250LXNpemU6IDI0cHg7CiAgZm9udC1zdHlsZTogbm9ybWFsOwogIGZvbnQtd2VpZ2h0OiA1MzU7CiAgbGluZS1oZWlnaHQ6IDMycHg7IC8qIDEzMy4zMzMlICovCiAgY29sb3I6ICR7KHsgY29sb3IgfSkgPT4gY29sb3J9OwogIEBtZWRpYSAobWF4LXdpZHRoOiAxMDI0cHgpIHsKICAgIGZvbnQtc2l6ZTogMThweDsKICAgIGxpbmUtaGVpZ2h0OiAyNnB4OwogIH0KICBAbWVkaWEgKG1heC13aWR0aDogNzY4cHgpIHsKICAgIGZvbnQtc2l6ZTogMThweDsKICAgIGxpbmUtaGVpZ2h0OiAyMHB4OwogIH0KYAp0eXBlIFN0YXRDYXJkUHJvcHMgPSB7CiAgdGl0bGU6IHN0cmluZwogIHZhbHVlOiBzdHJpbmcKICBsaXZlPzogYm9vbGVhbgogIHByZWZpeD86IHN0cmluZwogIHN1ZmZpeD86IHN0cmluZwogIGRlbGF5PzogbnVtYmVyCiAgaW5WaWV3PzogYm9vbGVhbgp9CgpmdW5jdGlvbiByb3RhdGVBcnJheTxUPihhcnI6IFRbXSwgbjogbnVtYmVyKSB7CiAgcmV0dXJuIGFyci5zbGljZShuLCBhcnIubGVuZ3RoKS5jb25jYXQoYXJyLnNsaWNlKDAsIG4pKQp9Cgpjb25zdCBudW1lcmljID0gWycwJywgJzEnLCAnMicsICczJywgJzQnLCAnNScsICc2JywgJzcnLCAnOCcsICc5J10KY29uc3QgY3VycmVuY3kgPSBbJ8KlJywgJ8KjJywgJ+KCrCcsICckJ10KY29uc3Qgc3VmZml4ZXMgPSBbJyAnLCAnSycsICdNJywgJ0InLCAnVCddCmNvbnN0IGRlbGluZWF0b3JzID0gWycsJywgJy4nXQoKZXhwb3J0IGZ1bmN0aW9uIFN0YXRDYXJkKHByb3BzOiBTdGF0Q2FyZFByb3BzKSB7CiAgY29uc3QgY29sb3JzID0gdXNlU3BvcmVDb2xvcnMoKQoKICByZXR1cm4gKAogICAgPENvbnRhaW5lciBsaXZlPXtwcm9wcy5saXZlfT4KICAgICAgPEZsZXggcm93IGFsaWduSXRlbXM9ImNlbnRlciIgZ2FwPSIkZ2FwNCI+CiAgICAgICAgPFRpdGxlIGNvbG9yPXtwcm9wcy5saXZlID8gY29sb3JzLnN0YXR1c1N1Y2Nlc3MudmFsIDogY29sb3JzLm5ldXRyYWwyLnZhbH0+e3Byb3BzLnRpdGxlfTwvVGl0bGU+CiAgICAgIDwvRmxleD4KICAgICAgPFN0cmluZ0ludGVycG9sYXRpb25XaXRoTW90aW9uClN0eWxlUHJvcDxWaWV3U3R5bGU+PigKICAgICgpID0+IFtUQUJfU1RZTEVTLmhlYWRlckNvbnRhaW5lciwgeyBwYWRkaW5nVG9wOiBpbnNldHMudG9wIH0sIHRyYW5zbGF0ZWRTdHlsZV0sCiAgICBbaW5zZXRzLnRvcCwgdHJhbnNsYXRlZFN0eWxlXSwKICApCgogIGNvbnN0IHN0YXR1c0JhclN0eWxlID0gdXNlQW5pbWF0ZWRTdHlsZSgoKSA9PiAoewogICAgYmFja2dyb3VuZENvbG9yOiBzaG91bGRTaG93V3JhcHBlZEJhbm5lcgogICAgICA/IGRhcmtDb2xvcnMuc3VyZmFjZTEudmFsCiAgICAgIDogaW50ZXJwb2xhdGVDb2xvcihjdXJyZW50U2Nyb2xsVmFsdWUudmFsdWUsIFswLCBoZWFkZXJIZWlnaHREaWZmXSwgW2NvbG9ycy5zdXJmYWNlMS52YWwsIGNvbG9ycy5zdXJmYWNlMS52YWxdKSwKICB9KSkKCiAgY29uc3QgYXBvbGxvQ2xpZW50ID0gdXNlQXBvbGxvQ2xpZW50KCkKCiAgY29uc3QgcmVuZGVyVGFiTGFiZWwgPSB1c2VDYWxsYmFjaygKICAgICh7IHJvdXRlLCBmb2N1c2VkLCBpc0V4dGVybmFsUHJvZmlsZSB9OiB7IHJvdXRlOiBIb21lUm91dGU7IGZvY3VzZWQ6IGJvb2xlYW47IGlzRXh0ZXJuYWxQcm9maWxlPzogYm9vbGVhbiB9KSA9PiB7CiAgICAgIGNvbnN0IHsgdGV4dFN0eWxlVHlwZTogdGhlbWUsIGVuYWJsZU5vdGlmaWNhdGlvbkJhZGdlLCAuLi5yZXN0IH0gPSByb3V0ZQogICAgICByZXR1cm4gKAogICAgICAgIDxUYWJMYWJlbAogICAgICAgICAgZW5hYmxlTm90aWZpY2F0aW9uQmFkZ2U9e2lzQm90dG9tVGFic0VuYWJsZWQgPyBmYWxzZSA6IGVuYWJsZU5vdGlmaWNhdGlvbkJhZGdlfQogICAgICAgICAgZm9jdXNlZD17Zm9jdXNlZH0KICAgICAgICAgIGlzRXh0ZXJuYWxQcm9maWxlPXtpc0V4dGVybmFsUHJvZmlsZX0KICAgICAgICAgIHJvdXRlPXtyZXN0fQogICAgICAgICAgdGV4dFN0eWxlVHlwZT17dGhlbWV9CiAgICAgICAgLz4KICAgICAgKQogICAgfSwKICAgIFtpc0JvdHRvbVRhYnNFbmFibGVkXSwKICApCgogIGNvbnN0IHJlbmRlclRhYkJhciA9IHVzZUNhbGxiYWNrKAogICAgKHNjZW5lUHJvcHM6IFNjZW5lUmVuZGVyZXJQcm9wcykgPT4gewogICAgICBjb25zdCBzdHlsZTogVmlld1N0eWxlID0geyB3aWR0aDogJ2F1dG8nIH0KICAgICAgaWYgKCFpc0xheW91dFJlYWR5KSB7CiAgICAgICAgcmV0dXJuIG51bGwKICAgICAgfQogICAgICByZXR1cm4gKAogICAgICAgIDxBbmltYXRlZC5WaWV3IGVudGVyaW5nPXtGYWRlSW59IHN0eWxlPXtbVEFCX1NUWUxFUy5oZWFkZXIsIHRhYkJhclN0eWxlXX0+CiAgICAgICAgICA8VGFiQmFyCiAgICAgICAgICAgIHsuLi5zY2VuZVByb3BzfQogICAgICAgICAgICBpbmRpY2F0b3JTdHlsZT17VEFCX1NUWUxFUy5hY3RpdmVUYWJJbmRpY2F0b3J9CiAgICAgICAgICAgIG5hdmlnYXRpb25TdGF0ZT17eyBpbmRleDogdGFiSW5kZXgsIHJvdXRlcyB9fQogICAgICAgICAgICBwcmVzc0NvbG9yPSJ0cmFuc3BhcmVudCIgLy8gQW5kcm9pZCBvbmx5CiAgICAgICAgICAgIHJlbmRlckxhYmVsPXtyZW5kZXJUYWJMYWJlbH0KICAgICAgICAgICAgc3R5bGU9e1sKICAgICAgICAgICAgICBUQUJfU1RZTEVTLnRhYkJhciwKICAgICAgICAgICAgICB7CiAgICAgICAgICAgICAgICBiYWNrZ3JvdW5kQ29sb3I6IGNvbG9ycy5zdXJmYWNlMS5nZXQoKSwKICAgICAgICAgICAgICAgIGJvcmRlckJvdHRvbUNvbG9yOiBjb2xvcnMuc3VyZmFjZTMuZ2V0KCksCiAgICAgICAgICAgICAgICBwYWRkaW5nTGVmdDogc3BhY2luZy5zcGFjaW5nMTIsCiAgICAgICAgICAgICAgfSwKICAgICAgICAgICAgXX0KICAgICAgICAgICAgdGFiU3R5bGU9e3N0eWxlfQogICAgICAgICAgLz4KICAgICAgICA8L0FuaW1hdGVkLlZpZXc+CiAgICAgICkKICAgIH0sCiAgICBbY29sb3JzLnN1cmZhY2UxLCBjb2xvcnMuc3VyZmFjZTMsIGlzTGF5b3V0UmVhZHksIHJlbmRlclRhYkxhYmVsLCByb3V0ZXMsIHRhYkJhclN0eWxlLCB0YWJkZXggPT09IDIgJiYgaGFzTm90aWZpY2F0aW9ucykgewogICAgICBkaXNwYXRjaChzZXROb3RpZmljYXRpb25TdGF0dXMoeyBhZGRyZXNzOiBhY3RpdmVBY2NvdW50LmFkZHJlc3MsIGhhc05vdGlmaWNhdGlvbnM6IGZhbHNlIH0pKQogICAgfQogIH0sIFtkaXNwYXRjaCwgYWN0aXZlQWNjb3VudC5hZGRyZXNzLCB0YWJJbmRleCwgaGFzTm90aWZpY2F0aW9ucywgaXNCb3R0b21UYWJzRW5hYmxlZF0pCgogIC8vIElmIGFjY291bnRzIGFyZSBzd2l0Y2hlZCwgd2Ugd2FudCB0byBzY3JvbGwgdG8gdG9wIGFuZCBzaG93IGZ1bGwgaGVhZGVyCiAgLy8gYmlvbWUtaWdub3JlIGxpbnQvY29ycmVjdG5lc3MvdXNlRXhoYXVzdGl2ZURlcGVuZGVuY2llczogd2Ugd2FudCB0byB0cmlnZ2VyIHRoaXMgZWZmZWN0IGFsc28gd2hlbiBhY3RpdmVBY2NvdW50IGNoYW5nZXMKICB1c2VFZmZlY3QoKCkgPT4gewogICAgcmVzZXRTY3JvbGxTdGF0ZSgpCiAgfSwgW2FjdGl2ZUFjY291bnQsIHJlc2V0U2Nyb2xsU3RhdGVdKQoKICAvLyBOZWVkIHRvIGNyZWF0ZSBhIGRlcml2ZWQgdmFsdWUgZm9yIHRhYiBpbmRleCBzbyBpdCBjYW4gYmUgcmVmZXJlbmNlZCBmcm9tIGEgc3RhdGljIHJlZgogIGNvbnN0IGN1cnJlbnRUYWJJbmRleCA9IHVzZURlcml2ZWRWYWx1ZSgoKSA9PiB0YWJJbmRleCwgW3RhYkluZGV4XSkKCiAgY29uc3QgdHJhbnNsYXRlWSA9IHVzZURlcml2ZWRWYWx1ZSgoKSA9PiB7CiAgICAvLyBBbGxvdyBoZWFkZXIgdG8gc2Nyb2xsIHZlcnRpY2FsbHkgd2l0aCBsaXN0CiAgICByZXR1cm4gLU1hdGgubWluKGN1cnJlbnRTY3JvbGxWYWx1ZS52YWx1ZSwgaGVhZGVySGVpZ2h0RGlmZikKICB9KQoKICBjb25zdCB0cmFuc2xhdGVkU3R5bGUgPSB1c2VBbmltYXRlZFN0eWxlKCgpID0+ICh7CiAgICB0cmFuc2Zvcm06IFt7IHRyYW5zbGF0ZVk6IHRyYW5zbGF0ZVkudmFsdWUgfV0sCiAgfSkpCgogIGNvbnN0IHNjcm9sbFBhaXJzID0gdXNlTWVtbzxTY3JvbGxQYWlyW10+KAogICAgKCkgPT4gWwogICAgICB7IGxpc3Q6IHRva2Vuc1RhYlNjcm9sbFJlZiwgcG9zaXRpb246IHRva2Vuc1RhYlNjcm9sbFZhbHVlLCBpbmRleDogMCB9LAogICAgICB7IGxpc3Q6IG5mdHNUYWJTY3JvbGxSZWYsIHBvc2l0aW9uOiBuZnRzVGFiU2Nyb2xsVmFsdWUsIGluZGV4OiAxIH0sCiAgICAgIC4uLighaXNCb3R0b21UYWJzRW5hYmxlZCA/IFt7IGxpc3Q6IGFjdGl2aXR5VGFiU2Nyb2xsUmVmLCBwb3NpdGlvbjogYWN0aXZpdHlUYWJTY3JvbGxWYWx1ZSwgaW5kZXg6IDIgfV0gOiBbXSksCiAgICBdLAogICAgWwogICAgICBhY3Rpdml0eVRhYlNjcm9sbFJlZiwKICAgICAgYWN0aXZpdHlUYWJTY3JvbGxWYWx1ZSwKICAgICAgaXNCb3R0b21UYWJzRW5hYmxlZCwKICAgICAgbmZ0c1RhYlNjcm9sbFJlZiwKICAgICAgbmZ0c1RhYlNjcm9sbFZhbHVlLAogICAgICB0b2tlbnNUYWJTY3JvbGxSZWYsCiAgICAgIHRva2Vuc1RhYlNjcm9sbFZhbHVlLAogICAgXSwKICApCgogIGNvbnN0IHsgc3luYyB9ID0gdXNlU2Nyb2xsU3luYyh7IGN1cnJlbnRUYWJJbmRleCwgc2Nyb2xsUGFpcnMsIGhlYWRlckNvbmZpZyB9KQoKICBjb25zdCBvblByZXNzVmlld09ubHlMYWJlbCA9IHVzZUNhbGxiYWNrKCgpID0+IG5hdmlnYXRlKE1vZGFsTmFtZS5WaWV3T25seUV4cGxhaW5lciksIFtdKQoKICAvLyBIaWRlIGFjdGlvbnMgd2hlbiBhY3RpdmUgYWNjb3VudCBpc24ndCBhIHNpZ25lciBhY2NvdW50LgogIGNvbnN0IGlzU2lnbmVyQWNjb3VudCA9IGFjdGl2ZUFjY291bnQudHlwZSA9PT0gQWNjb3VudFR5cGUuU2lnbmVyTW5lbW9uaWMKCiAgLy8gVGhpcyBob29rcyBoYW5kbGVzIHRoZSBsb2dpYyBmb3Igd2hlbiB0byBvcGVuIHRoZSBCYWNrdXBSZW1pbmRlck1vZGFsCiAgdXNlT3BlbkJhY2t1cFJlbWluZGVyTW9kYWwoYWN0aXZlQWNjb3VudCkKCiAgY29uc3Qgdmlld09ubHlMYWJlbCA9IHQoJ2hvbWUud2FybmluZy52YXJyYXk6IGAke3N0cm9rZVBlcmNlbnR9ICR7Y2lyY3VtZmVyZW5jZX1gLAogICAgICAgIH19CiAgICAgIC8+CiAgICA8L3N2Zz4KICApCn0KCmNvbnN0IGFnZW50RmVhdHVyZXMgPSBbCiAgewogICAgaWQ6ICJjb2RlLXJldmlld3MiLAogICAgY29udGVudDogKAogICAgICA8PgogICAgICAgIDxzdHJvbmc+Q29kZSByZXZpZXdzPC9zdHJvbmc+IHdpdGggZnVsbCBjb2RlYmFzZSBjb250ZXh0IHRvIGNhdGNoeyIgIn0KICAgICAgICA8c3Ryb25nPmhhcmQtdG8tZmluZDwvc3Ryb25nPiBidWdzLiBidWdzLgogICAgICA8Lz4KICAgICksCiAgfSwKICB7CiAgICBpZDogImNvZGUtc3VnZ2VzdGlvbnMiLAogICAgY29udGVudDogKAogICAgICA8PgogICAgICAgIDxzdHJvbmc+Q29kZSBzdWdnZXN0aW9uczwvc3Ryb25nPiB2YWxpZGF0ZWQgaW4gc2FuZGJveGVzIGJlZm9yZSB5b3UKICAgICAgICBtZXJnZS4KICAgICAgPC8+CiAgICApLAogIH0sCiAgewogICAgaWQ6ICJyb290LWNhdXNlIiwKICAgIGNvbnRlbnQ6ICgKICAgICAgPD4KICAgICAgICA8c3Ryb25nPlJvb3QtY2F1c2UgYW5hbHlzaXM8L3N0cm9uZz4gZm9yIHByb2R1Y3Rpb24gaXNzdWVzIHdpdGgKICAgICAgICBkZXBsb3ltZW50IGNvbnRleHQueyIgIn0KICAgICAgICA8QmFkZ2UKICAgICAgICAgIHZhcmlhbnQ9InNlY29uZGFyeSIKICAgICAgICAgIGNsYXNzTmFtZT0iYmctYmx1ZS0xMDAgdGV4dC1ibHVlLTcwMCBob3ZlcjpiZy1ibHVlLTEwMCIKICAgICAgICA+CiAgICAgICAgICBSZXF1aXJlcyBPYnNlcnZhYmlsaXR5IFBsdXMKICAgICAgICA8L0JhZGdlPgogICAgICA8Lz4KICAgICksCiAgfSwKXQoKZnVuY3Rpb24gQWN0aXZhdGVBZ2VudERpYWxvZygpIHsKICByZXR1cm4gKAogICAgPEV4YW1wbGUgdGl0bGU9IkFjdGl2YXRlIEFnZW50IiBjbGFzc05hbWU9Iml0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciI+CiAgICAgIDxEaWFsb2c+CiAgICAgICAgPERpYWxvZ1RyaWdnZXIgYXNDaGlsZD4KICAgICAgICAgIDxCdXR0b24gdmFyaWFudD0ib3V0bGluZSI+QWN0aXZhdGUgQWdlbnQ8L0J1dHRvbj4KICAgICAgICA8L0RpYWxvZ1RyaWdnZXI+CiAgICAgICAgPERpYWxvZ0NvbnRlbnQgc2hvd0Nsb3NlQnV0dG9uPXtmYWxzZX0+CiAgICAgICAgICA8RGlhbG9nSGVhZGVyPgogICAgICAgICAgICA8RGlhbG9nVGl0bGU+U2hpcCBmYXN0ZXIgJiBzYWZlciB3aXRoIFZlcmNlbCBBZ2VudDwvRGlhbG9nVGl0bGU+CiAgICAgICAgICAgIDxEaWFsb2dEZXNjcmlwdGlvbj4KICAgICAgICAgICAgICBZb3VyIHVzZSBpcyBzdWJqZWN0IHRvIFZlcmNlbCZhcG9zO3N7IiAifQogICAgICAgICAgICAgIDxhIGhyZWY9IiMiPlB1YmxpYyBCZXRhIEFncmVlbWVudDwvYT4gYW5keyIgIn0KICAgICAgICAgICAgICA8YSBocmVmPSIjIj5BSSBQcm9kdWN0IFRlcm1zPC9hPi4KICAgICAgICAgICAgPC9EaWFsb2dEZXNjcmlwdGlvbj4KICAgICAgICAgIDwvRGlhbG9nSGVhZGVyPgogICAgICAgICAgPGRpdiBjbGFzc05hbWU9Im5vLXNjcm9sbGJhciBmbGV4IG1heC1oLVs1MHZoXSBmbGV4LWNvbCBnYXAtNCBvdmVyZmxvdy15LWF1dG8iPgogICAgICAgICAgICA8SXRlbUdyb3VwIGNsYXNzTmFtZT0iZ2FwLTAgcHItMiI+CiAgICAgICAgICAgICAge2FnZW50RmVhdHVyZXMubWFwKChmZWF0dXJlKSA9PiAoCiAgICAgICAgICAgICAgICA8SXRlbSBrZXk9e2ZlYXR1cmUuaWR9IHNpemU9InhzIiBjbGFzc05hbWU9InB4LTAiPgogICAgICAgICAgICAgICAgICA8SXRlbU1lZGlhIHZhcmlhbnQ9Imljb24iIGNsYXNzTmFtZT0ic2VsZi1zdGFydCI+CiAgICAgICAgICAgICAgICAgICAgPEljb25QbGFjZWhvbGRlcgogICAgICAgICAgICAgICAgICAgICAgbHVjaWRlPSJDaGVja0NpcmNsZTJJY29uIgogICAgICAgICAgICAgICAgICAgICAgdGFibGVyPSJJY29uQ2lyY2xlQ2hlY2tGaWxsZWQiCiAteW9yay12NC91aS90b29sdGlwIgoKZXhwb3J0IGZ1bmN0aW9uIENvZGVCbG9ja0NvbW1hbmQoewogIF9fbnBtX18sCiAgX195YXJuX18sCiAgX19wbnBtX18sCiAgX19idW5fXywKfTogUmVhY3QuQ29tcG9uZW50UHJvcHM8InByZSI+ICYgewogIF9fbnBtX18/OiBzdHJpbmcKICBfX3lhcm5fXz86IHN0cmluZwogIF9fcG5wbV9fPzogc3RyaW5nCiAgX19idW5fXz86IHN0cmluZwp9KSB7CiAgY29uc3QgW2NvbmZpZywgc2V0Q29uZmlnXSA9IHVzZUNvbmZpZygpCiAgY29uc3QgW2hhc0NvcGllZCwgc2V0SGFzQ29waWVkXSA9IFJlYWN0LnVzZVN0YXRlKGZhbHNlKQoKICBSZWFjdC51c2VFZmZlY3QoKCkgPT4gewogICAgaWYgKGhhc0NvcGllZCkgewogICAgICBjb25zdCB0aW1lciA9IHNldFRpbWVvdXQoKCkgPT4gc2V0SGFzQ29waWVkKGZhbHNlKSwgMjAwMCkKICAgICAgcmV0dXJuICgpID0+IGNsZWFyVGltZW91dCh0aW1lcikKICAgIH0KICB9LCBbaGFzQ29waWVkXSkKCiAgY29uc3QgcGFja2FnZU1hbmFnZXIgPSBjb25maWcucGFja2FnZU1hbmFnZXIgfHwgInBucG0iCiAgY29uc3QgdGFicyA9IFJlYWN0LnVzZU1lbW8oKCkgPT4gewogICAgcmV0dXJuIHsKICAgICAgcG5wbTogX19wbnBtX18sCiAgICAgIG5wbTogX19ucG1fXywKICAgICAgeWFybjogX195YXJuX18sCiAgICAgIGJ1bjogX19idW5fXywKICAgIH0KICB9LCBbX19ucG1fXywgX19wbnBtX18sIF9feWFybl9fLCBfX2J1bl9fXSkKCiAgY29uc3QgY29weUNvbW1hbmQgPSBSZWFjdC51c2VDYWxsYmFjaygoKSA9PiB7CiAgICBjb25zdCBjb21tYW5kID0gdGFic1twYWNrYWdlTWFuYWdlcl0KCiAgICBpZiAoIWNvbW1hbmQpIHsKICAgICAgcmV0dXJuCiAgICB9CgogICAgY29weVRvQ2xpcGJvYXJkV2l0aE1ldGEoY29tbWFuZCwgewogICAgICBuYW1lOiAiY29weV9ucG1fY29tbWFuZCIsCiAgICAgIHByb3BlcnRpZXM6IHsKICAgICAgICBjb21tYW5kLAogICAgICAgIHBtOiBwYWNrYWdlTWFuYWdlciwKICAgICAgfSwKICAgIH0pCiAgICBzZXRIYXNDb3BpZWQodHJ1ZSkKICB9LCBbcGFja2FnZU1hbmFnZXIsIHRhYnNdKQoKICByZXR1cm4gKAogICAgPGRpdiBjbGFzc05hbWU9Im92ZXJmbG93LXgtYXV0byI+CiAgICAgIDxUYWJzCiAgICAgICAgdmFsdWU9e3BhY2thZ2VNYW5hZ2VyfQogICAgICAgIGNsYXNzTmFtZT0iZ2FwLTAiCiAgICAgICAgb25WYWx1ZUNoYW5nZT17KHZhbHVlKSA9PiB7CiAgICAgICAgICBzZXRDb25maWcoewogICAgICAgICAgICAuLi5jb25maWcsCiAgICAgICAgICAgIHBhY2thZ2VNYW5hZ2VyOiB2YWx1ZSBhcyAicG5wbSIgfCAibnBtIiB8ICJ5YXJuIiB8ICJidW4iLAogICAgICAgICAgfSkKICAgICAgICB9fQogICAgICA+CiAgICAgICAgPGRpdiBjbGFzc05hbWU9ImJvcmRlci1ib3JkZXIvNTAgZmxleCBpdGVtcy1jZW50ZXIgZ2FwLTIgYm9yZGVyLWIgcHgtMyBweS0xIj4KICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJiZy1mb3JlZ3JvdW5kIGZsZXggc2l6ZS00IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciByb3VuZGVkLVsxcHhdIG9wYWNpdHktNzAiPgogICAgICAgICAgICA8SWNvblRlcm1pbmFsIGNsYXNzTmFtZT0idGV4dC1jb2RlIHNpemUtMyIgLz4KICAgICAgICAgIDwvZGl2PgogICAgICAgICAgPFRhYnNMaXN0IGNsYXNzTmFtZT0icm91bmRlZC1ub25lIGJnLXRyYW5zcGFyZW50IHAtMCI+CiAgICAgICAgICAgIHtPYmplY3QuZW50cmllcyh0YWJzKS5tYXAoKFtrZXldKSA9PiB7CiAgICAgICAgICAgICAgcmV0dXJuICgKICAgICAgICAgICAgICAgIDxUYWJzVHJpZ2dlcgogICAgICAgICAgICAgICAgICBrZXk9e2tleX0KICAgICAgICAgICAgICAgICAgdmFsdWU9e2tleX0KICAgICAgICAgICAgICAgICAgY2xhc3NOYW1lPSJkYXRhLVtzdGF0ZT1hY3RpdmVdOmJnLWJhY2tncm91bmQhIGRhdGEtW3N0YXRlPWFjdGl2ZV06Ym9yZGVyLWlucHV0IGgtdW0iPnt0KCJzbG90c190YWtlbiIsIHsgdGFrZW5TZWF0cywgdG90YWxTZWF0cyB9KX08L3A+CiAgICA8L1NlY3Rpb24+CiAgKTsKfQoKZnVuY3Rpb24gQ3VzdG9tUXVlc3Rpb25zU2VjdGlvbih7CiAgY3VzdG9tUmVzcG9uc2VzLAogIGJvb2tpbmdGaWVsZHM6IHJhd0Jvb2tpbmdGaWVsZHMsCn06IHsKICBjdXN0b21SZXNwb25zZXM6IFtzdHJpbmcsIHVua25vd25dW107CiAgYm9va2luZ0ZpZWxkcz86IHVua25vd247Cn0pIHsKICBjb25zdCB7IHQgfSA9IHVzZUxvY2FsZSgpOwoKICAvLyBQYXJzZSBhbmQgbWVtb2l6ZSBib29raW5nIGZpZWxkcwogIGNvbnN0IGJvb2tpbmdGaWVsZHMgPSB1c2VNZW1vKCgpID0+IHsKICAgIGlmICghcmF3Qm9va2luZ0ZpZWxkcykgcmV0dXJuIHVuZGVmaW5lZDsKICAgIGNvbnN0IHBhcnNlZCA9IGV2ZW50VHlwZUJvb2tpbmdGaWVsZHMuc2FmZVBhcnNlKHJhd0Jvb2tpbmdGaWVsZHMpOwogICAgcmV0dXJuIHBhcnNlZC5zdWNjZXNzID8gcGFyc2VkLmRhdGEgOiB1bmRlZmluZWQ7CiAgfSwgW3Jhd0Jvb2tpbmdGaWVsZHNdKTsKCiAgLy8gRmlsdGVyIG91dCByZXNwb25zZXMgd2l0aCBmYWxzeSBhbnN3ZXJzIG9yIGVtcHR5IGFycmF5cwogIGNvbnN0IHZhbGlkUmVzcG9uc2VzID0gdXNlTWVtbygKICAgICgpOiBbc3RyaW5nLCB1bmtub3duXVtdID0+CiAgICAgIGN1c3RvbVJlc3BvbnNlcy5maWx0ZXIoKFssIGFuc3dlcl0pID0+IHsKICAgICAgICBpZiAoIWFuc3dlcikgcmV0dXJuIGZhbHNlOwogICAgICAgIGlmIChBcnJheS5pc0FycmF5KGFuc3dlcikgJiYgYW5zd2VyLmxlbmd0aCA9PT0gMCkgcmV0dXJuIGZhbHNlOwogICAgICAgIHJldHVybiB0cnVlOwogICAgICB9KSwKICAgIFtjdXN0b21SZXNwb25zZXNdCiAgKTsKCiAgLy8gTWVtb2l6ZSBmaWVsZCBsYWJlbCBsb29rdXBzCiAgY29uc3QgZmllbGRMYWJlbHMgPSB1c2VNZW1vKCgpID0+IHsKICAgIGlmICghYm9va2luZ0ZpZWxkcykgcmV0dXJuIG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KCk7CgogICAgcmV0dXJuIG5ldyBNYXA8c3RyaW5nLCBzdHJpbmc+KAogICAgICBib29raW5nRmllbGRzLm1hcCgKICAgICAgICAoZmllbGQpID0+IFtmaWVsZC5uYW1lLCBmaWVsZC5sYWJlbCB8fCB0KGZpZWxkLmRlZmF1bHRMYWJlbCB8fCBmaWVsZC5uYW1lKV0gYXMgW3N0cmluZywgc3RyaW5nXQogICAgICApCiAgICApOwogIH0sIFtib29raW5nRmllbGRzLCB0XSk7CgogIGlmICh2YWxpZFJlc3BvbnNlcy5sZW5ndGggPT09IDApIHsKICAgIHJldHVybiBudWxsOwogIH0KCiAgcmV0dXJuICgKICAgIDw+CiAgICAgIHt2YWxpZFJlc3BvbnNlcy5tYXAoKFtmaWVsZE5hbWUsIGFuc3dlcl0sIGlkeCkgPT4gewogICAgICAgIGNvbnN0IGZpZWxkTmFtZVN0ciA9IFN0cmluZyhmaWVsZE5hbWUpOwogICAgICAgIGNvbnN0IHRpdGxlOiBzdHJpbmcgPSBmaWVsZExhYmVscy5nZXQoZmllbGROYW1lU3RyKSA/PyBmaWVsZE5hbWVTdHI7CiAgICAgICAgcmV0dXJuICgKICAgICAgICAgIDxTZWN0aW9uIGtleT17aWR4fSB0aXRsZT17dGl0bGV9PgogICAgICAgICAgICA8cCBjbGFzc05hbWU9InRleHQtZW1waGFzaXMgdGV4dC1zbSBmb250LW1lZGl1bSI+e1N0cmluZyhhbnN3ZXIpfTwvcD4KICAgICAgICAgIDwvU2VjdGlvbj4KICAgICAgICApOwogICAgICB9KX0KICAgIDwvPgogICk7Cn0KCi8vIE9sZCBib29raW5nIHRoYXQgd2FzIHJlc2NoZWR1bGVkIGF3YXkKZnVuY3Rpb24gT2xkUmVzY2hlZHVsZWRCb29raW5nSW5mbyh7CiAgYm9va2luZywKICByZXNjaGVkdWxlZFRvQm9va2luZywKfTogewogIGJvb2tpbmc6IEJvb2tpbmdPdXRwdXQ7CiAgcmVzY2hlZHVsZWRUb0Jvb2tpbmc/OiB7IHVpZDogc3RyaW5nIH0gfCBudWxsOwp9KSB7CiAgY29uc3QgeyB0IH0gPSB1c2VMb2NhbGUoKTsKCiAgLy8gT25seSBzaG93IGZvciBvbGQgcmVzY2hlZHVsZWQgYm9va2luZ3MKICBpcmVuY3lGcm9tVVJMUGFyYW1ldGVyKAogICAgcGFyc2VkUXMub3V0cHV0Q3VycmVuY3kgfHwgcGFyc2VkUXMub3V0cHV0Y3VycmVuY3ksCiAgICBjaGFpbklkVG9QbGF0Zm9ybShvdXRwdXRDaGFpbklkID8/IFVuaXZlcnNlQ2hhaW5JZC5NYWlubmV0KSwKICApCiAgY29uc3Qgb3V0cHV0Q3VycmVuY3lBZGRyZXNzID0KICAgIHBhcnNlZE91dHB1dEN1cnJlbmN5QWRkcmVzcyA9PT0gcGFyc2VkSW5wdXRDdXJyZW5jeUFkZHJlc3MgJiYgb3V0cHV0Q2hhaW5JZCA9PT0gY2hhaW5JZAogICAgICA/IHVuZGVmaW5lZAogICAgICA6IHBhcnNlZE91dHB1dEN1cnJlbmN5QWRkcmVzcwogIGNvbnN0IGhhc0N1cnJlbmN5SW5wdXQgPSBwYXJzZWRJbnB1dEN1cnJlbmN5QWRkcmVzcyB8fCBvdXRwdXRDdXJyZW5jeUFkZHJlc3MKICBjb25zdCB2YWx1ZSA9IGhhc0N1cnJlbmN5SW5wdXQgPyBwYXJzZUZyb21VUkxQYXJhbWV0ZXIocGFyc2VkUXMudmFsdWUpIDogdW5kZWZpbmVkCiAgY29uc3QgZmllbGQgPSB2YWx1ZSA/IHBhcnNlRnJvbVVSTFBhcmFtZXRlcihwYXJzZWRRcy5maWVsZCkgOiB1bmRlZmluZWQKCiAgcmV0dXJuIHsKICAgIGlucHV0Q3VycmVuY3lBZGRyZXNzOiBwYXJzZWRJbnB1dEN1cnJlbmN5QWRkcmVzcywKICAgIG91dHB1dEN1cnJlbmN5QWRkcmVzcywKICAgIHZhbHVlLAogICAgZmllbGQsCiAgICBjaGFpbklkLAogICAgb3V0cHV0Q2hhaW5JZCwKICB9Cn0KCi8vIERlc3BpdGUgYSBsaWdodGVyIFF1aWNrVG9rZW5CYWxhbmNlcyBxdWVyeSB3ZSd2ZSByZWNlaXZlZCBmZWVkYmFjayB0aGF0IHRoZSBpbml0aWFsIGxvYWQgdGltZSBpcyB0b28gc2xvdy4KLy8gUmVtb3ZpbmcgdGhlIGxvZ2ljIHRoYXQgdXNlcyB1c2VyJ3MgYmFsYW5jZSB0byBkZXRlcm1pbmUgdGhlIGluaXRpYWwgY3VycmVuY3kuCi8vIFdlIGNhbiByZXZpc2l0IHRoaXMgaWYgd2UgZmluZCBhIHdheSB0byBtYWtlIHRoZSBpbml0aWFsIGxvYWQgdGltZSBmYXN0ZXIuCgovLyBXaGVuIHdlIGdldCB0aGUgc3BlZWQgdXAgaGVyZSBpcyB0aGUgUFIgdGhhdCByZW1vdmVkIHRoZSBiZWF1dGlmdWwgY29kZToKLy8gaHR0cHM6Ly9hcHAuZ3JhcGhpdGUuZGV2L2dpdGh1Yi9wci9Vbmlzd2FwL3VuaXZlcnNlLzExMDY4L2ZpeC13ZWItZGVmYXVsdC10by1ldGgtbWFpbm5ldC1vbi1tdWx0aWNoYWluCmV4cG9ydCBmdW5jdGlvbiB1c2VJbml0aWFsQ3VycmVuY3lTdGF0ZSgpOiB7CiAgaW5pdGlhbElucHV0Q3VycmVuY3k/OiBDdXJyZW5jeQogIGluaXRpYWxPdXRwdXRDdXJyZW5jeT86IEN1cnJlbmN5CiAgaW5pdGlhbFR5cGVkVmFsdWU/OiBzdHJpbmcKICBpbml0aWFsRmllbGQ/OiBDdXJyZW5jeUZpZWxkCiAgaW5pdGlhbElucHV0Q2hhaW5JZD86IFVuaXZlcnNlQ2hhaW5JZAogIGluaXRpYWxPdXRwdXRDaGFpbklkPzogVW5pdmVyc2VDaGFpbklkCiAgdHJpZ2dlckNvbm5lY3Q6IGJvb2xlYW4KfSB7CiAgY29uc3QgeyBzZXRJc1VzZXJTZWxlY3RlZFRva2VuIH0gPSB1c2VNdWx0aWNoYWluQ29udGV4dCgpCiAgY29uc3QgeyBkZWZhdWx0Q2hhaW5JZCwgaXNUZXN0bmV0TW9kZUVuYWJsZWQgfSA9IHVzZUVuYWJsZWRDaGFpbnMoKQogIGNvbnN0IHBlcnNpc3RlZEZpbHRlcmVkQ2hhaW5JZHMgPSB1c2VTZWxlY3RvcihzZWxlY3RGaWx0ZXJlZENoYWluSWRzKQoKICBjb25zdCB7IHVzZVBhcnNlZFF1ZXJ5U3RyaW5nIH0gPSB1c2VVcmxDb250ZXh0KCkKICBjb25zdCBwYXJzZWRRcyA9IHVzZVBhcnNlZFF1ZXJ5U3RyaW5nKCkKICBjb25zdCBwYXJzZWRDdXJyZW5jeVN0YXRlID0gdXNlTWVtbygoKSA9PiB7CiAgICByZXR1cm4gcXVlcnlQYXJhbWV0ZXJzVG9DdXJyZW5jeVN0YXRlKHBhcnNlZFFzKQogIH0sIFtwYXJzZWRRc10pCgogIGNvbnN0IHN1cHBvcnRlZENoYWluSWQgPSB1c2VTdXBwb3J0ZWRDaGFpbklkKHBhcnNlZEN1cnJlbmN5U3RhdGUuY2hhaW5JZCA/PyBkZWZhdWx0Q2hhaW5JZCkgPz8gVW1hcnkgZm9udC1tZWRpdW0gdW5kZXJsaW5lIHVuZGVybGluZS1vZmZzZXQtNCIKICAgICAgICA+CiAgICAgICAgICBhIGJyaWxsaWFudCBwbGFuCiAgICAgICAgPC9hPgogICAgICAgIDogaGUgd291bGQgdGF4IHRoZSBqb2tlcyBpbiB0aGUga2luZ2RvbS4KICAgICAgPC9wPgogICAgICA8YmxvY2txdW90ZSBjbGFzc05hbWU9Im10LTYgYm9yZGVyLWwtMiBwbC02IGl0YWxpYyI+CiAgICAgICAgJnF1b3Q7QWZ0ZXIgYWxsLCZxdW90OyBoZSBzYWlkLCAmcXVvdDtldmVyeW9uZSBlbmpveXMgYSBnb29kIGpva2UsIHNvCiAgICAgICAgaXQmYXBvcztzIG9ubHkgZmFpciB0aGF0IHRoZXkgc2hvdWxkIHBheSBmb3IgdGhlIHByaXZpbGVnZS4mcXVvdDsKICAgICAgPC9ibG9ja3F1b3RlPgogICAgICA8aDMgY2xhc3NOYW1lPSJtdC04IHNjcm9sbC1tLTIwIHRleHQtMnhsIGZvbnQtc2VtaWJvbGQgdHJhY2tpbmctdGlnaHQiPgogICAgICAgIFRoZSBKb2tlIFRheAogICAgICA8L2gzPgogICAgICA8cCBjbGFzc05hbWU9ImxlYWRpbmctNyBbJjpub3QoOmZpcnN0LWNoaWxkKV06bXQtNiI+CiAgICAgICAgVGhlIGtpbmcmYXBvcztzIHN1YmplY3RzIHdlcmUgbm90IGFtdXNlZC4gVGhleSBncnVtYmxlZCBhbmQgY29tcGxhaW5lZCwKICAgICAgICBidXQgdGhlIGtpbmcgd2FzIGZpcm06CiAgICAgIDwvcD4KICAgICAgPHVsIGNsYXNzTmFtZT0ibXktNiBtbC02IGxpc3QtZGlzYyBbJj5saV06bXQtMiI+CiAgICAgICAgPGxpPjFzdCBsZXZlbCBvZiBwdW5zOiA1IGdvbGQgY29pbnM8L2xpPgogICAgICAgIDxsaT4ybmQgbGV2ZWwgb2Ygam9rZXM6IDEwIGdvbGQgY29pbnM8L2xpPgogICAgICAgIDxsaT4zcmQgbGV2ZWwgb2Ygb25lLWxpbmVycyA6IDIwIGdvbGQgY29pbnM8L2xpPgogICAgICA8L3VsPgogICAgICA8cCBjbGFzc05hbWU9ImxlYWRpbmctNyBbJjpub3QoOmZpcnN0LWNoaWxkKV06bXQtNiI+CiAgICAgICAgQXMgYSByZXN1bHQsIHBlb3BsZSBzdG9wcGVkIHRlbGxpbmcgam9rZXMsIGFuZCB0aGUga2luZ2RvbSBmZWxsIGludG8gYQogICAgICAgIGdsb29tLiBCdXQgdGhlcmUgd2FzIG9uZSBwZXJzb24gd2hvIHJlZnVzZWQgdG8gbGV0IHRoZSBraW5nJmFwb3M7cwogICAgICAgIGZvb2xpc2huZXNzIGdldCBoaW0gZG93bjogYSBjb3VydCBqZXN0ZXIgbmFtZWQgSm9rZXN0ZXIuCiAgICAgIDwvcD4KICAgICAgPGgzIGNsYXNzTmFtZT0ibXQtOCBzY3JvbGwtbS0yMCB0ZXh0LTJ4bCBmb250LXNlbWlib2xkIHRyYWNraW5nLXRpZ2h0Ij4KICAgICAgICBKb2tlc3RlciZhcG9zO3MgUmV2b2x0CiAgICAgIDwvaDM+CiAgICAgIDxwIGNsYXNzTmFtZT0ibGVhZGluZy03IFsmOm5vdCg6Zmlyc3QtY2hpbGQpXTptdC02Ij4KICAgICAgICBKb2tlc3RlciBiZWdhbiBzbmVha2luZyBpbnRvIHRoZSBjYXN0bGUgaW4gdGhlIG1pZGRsZSBvZiB0aGUgbmlnaHQgYW5kCiAgICAgICAgbGVhdmluZyBqb2tlcyBhbGwgb3ZlciB0aGUgcGxhY2U6IHVuZGVyIHRoZSBraW5nJmFwb3M7cyBwaWxsb3csIGluIGhpcwogICAgICAgIHNvdXAsIGV2ZW4gaW4gdGhlIHJveWFsIHRvaWxldC4gVGhlIGtpbmcgd2FzIGZ1cmlvdXMsIGJ1dCBoZQogICAgICAgIGNvdWxkbiZhcG9zO3Qgc2VlbSB0byBzdG9wIEpva2VzdGVyLgogICAgICA8L3A+CiAgICAgIDxwIGNsYXNzTmFtZT0ibGVhZGluZy03IFsmOm5vdCg6Zmlyc3QtY2hpbGQpXTptdC02Ij4KICAgICAgICBBbmQgdGhlbiwgb25lIGRheSwgdGhlIHBlb3BsZSBvZiB0aGUga2luZ2RvbSBkaXNjb3ZlcmVkIHRoYXQgdGhlIGpva2VzCiAgICAgICAgbGVmdCBieSBKb2tlc3RlciB3ZXJlIHNvIGZ1bm55IHRoYXQgdGhleSBjb3VsZG4mYXBvczt0IGhlbHAgYnV0IGxhdWdoLgogICAgICAgIEFuZCBvbmNlIHRoZXkgc3RhcnRlZCBsYXVnaGluZywgdGhleSBjb3VsZG4mYXBvczt0IHN0b3AuCiAgIHInIH19PgogICAgICA8VGhlbWVkVGV4dC5EZXByZWNhdGVkQm9keT57bWVzc2FnZX08L1RoZW1lZFRleHQuRGVwcmVjYXRlZEJvZHk+CiAgICA8L0F1dG9Db2x1bW4+CiAgKQp9CgovLyBxdWljayBoYWNrIGJlY2F1c2Ugc3VzaGkgaW5pdCBjb2RlIGhhc2ggaXMgZGlmZmVyZW50CmNvbnN0IGNvbXB1dGVTdXNoaVBhaXJBZGRyZXNzID0gKHsgdG9rZW5BLCB0b2tlbkIgfTogeyB0b2tlbkE6IFRva2VuOyB0b2tlbkI6IFRva2VuIH0pOiBzdHJpbmcgPT4gewogIGNvbnN0IFt0b2tlbjAsIHRva2VuMV0gPSB0b2tlbkEuc29ydHNCZWZvcmUodG9rZW5CKSA/IFt0b2tlbkEsIHRva2VuQl0gOiBbdG9rZW5CLCB0b2tlbkFdIC8vIGRvZXMgc2FmZXR5IGNoZWNrcwogIHJldHVybiBnZXRDcmVhdGUyQWRkcmVzcygKICAgICcweEMwQUVlNDc4ZTM2NThlMjYxMGM1RjdBNEEyRTE3NzdjRTllNGYyQWMnLAogICAga2VjY2FrMjU2KFsnYnl0ZXMnXSwgW3BhY2soWydhZGRyZXNzJywgJ2FkZHJlc3MnXSwgW3Rva2VuMC5hZGRyZXNzLCB0b2tlbjEuYWRkcmVzc10pXSksCiAgICAnMHhlMThhMzRlYjBlMDRiMDRmN2EwYWMyOWE2ZTgwNzQ4ZGNhOTYzMTliNDJjNTRkNjc5Y2I4MjFkY2E5MGM2MzAzJywKICApCn0KCi8qKgogKiBHaXZlbiB0d28gdG9rZW5zIHJldHVybiB0aGUgc3VzaGlzd2FwIGxpcXVpZGl0eSB0b2tlbiB0aGF0IHJlcHJlc2VudHMgaXRzIGxpcXVpZGl0eSBzaGFyZXMKICogQHBhcmFtIHRva2VuQSBvbmUgb2YgdGhlIHR3byB0b2tlbnMKICogQHBhcmFtIHRva2VuQiB0aGUgb3RoZXIgdG9rZW4KICovCmZ1bmN0aW9uIHRvU3VzaGlMaXF1aWRpdHlUb2tlbihbdG9rZW5BLCB0b2tlbkJdOiBbVG9rZW4sIFRva2VuXSk6IFRva2VuIHsKICByZXR1cm4gbmV3IFRva2VuKHRva2VuQS5jaGFpbklkLCBjb21wdXRlU3VzaGlQYWlyQWRkcmVzcyh7IHRva2VuQSwgdG9rZW5CIH0pLCAxOCwgJ1NMUCcsICdTdXNoaVN3YXAgTFAgVG9rZW4nKQp9CgpleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBNaWdyYXRlVjIoKSB7CiAgY29uc3QgYWNjb3VudCA9IHVzZUFjY291bnQoKQogIGNvbnN0IG5hdmlnYXRlID0gdXNlTmF2aWdhdGUoKQogIGNvbnN0IHsgc3RhdGUgfSA9IHVzZUxvY2F0aW9uKCkKCiAgY29uc3QgdjJGYWN0b3J5QWRkcmVzcyA9IGFjY291bnQuY2hhaW5JZCA/IFYyX0ZBQ1RPUllfQUREUkVTU0VTW2FjY291bnQuY2hhaW5JZF0gOiB1bmRlZmluZWQKCiAgLy8gZmV0Y2ggdGhlIHVzZXIncyBiYWxhbmNlcyBvZiBhbGwgdHJhY2tlZCBWMiBMUCB0b2tlbnMKICBjb25zdCB0cmFja2VkVG9rZW5QYWlycyA9IHVzZVRyYWNrZWRUb2tlblBhaXJzKCkKCiAgLy8gY2FsY3VsYXRlIHYyICsgc3VzaGkgcGFpciBjb250cmFjdCBhZGRyZXNzZXMgZm9yIGFsbCB0b2tlbiBwYWlycwogIGNvbnN0IHRva2VuUGFpcnNXaXRoTGlxdWlkaXR5VG9rZW5zID0gdXNlTWVtbygKICAgICgpID0+CiAgICAgIHRyYWNrZWRUb2tlblBhaXJzLm1hcCgodG9rZW5zKSA9PiB7CiAgICAgICAgLy8gc3VzaGkgbGlxdWlkaXR5IHRva2VuIG9yIG51bGwKICAgICAgICBjb25zdCBzdXNoaUxpcXVpZGl0eVRva2VuID0gYWNjb3VudC5jaGFpbklkID09PSAxID8gdG9TdXNoaUxpcXVpZGl0eVRva2VuKHRva2VucykgOiBudWxsCiAgICAgICAgcmV0dXJuIHsKICAgICAgICAgIHYybGlxdWlkaXR5VG9rZW46IHYyRmFjdG9yeUFkZHJlc3MgPyB0b1YyTGlxdWlkaXR5VG9rZW4odG9rZW5zKSA6IHVuZGVmaW5lZCwKICAgICAgICAgIHN1c2hpTGlxdWlkaXR5VG9rZW4sCiAgICAgICAgICB0b2tlbnMsCiAgICAgICAgfQogICAgICB9KSwKICAgIFt0cmFja2VkVG9rZW5QYWlycywgYWNjb3VudC5jaGFpbklkLCB2MkZhY3RvcnlBZGRyZXNzXSwKICApCgogIC8vICBnZXQgcGFpciBsaXF1aWRpdHkgdG9rZW4gYWRkcmVzc2VzIGZvciBiYWxhbmNlLWZldGNoaW5nIHB1cnBvc2VzCiAgY29uc3QgYWxsTGlxdWlscy9tYXRjaE1lZGlhJwoKY29uc3QgVEhFTUVfVVBEQVRFX0RFTEFZID0gbXMoYDAuMXNgKQpjb25zdCBEQVJLTU9ERV9NRURJQV9RVUVSWSA9IHdpbmRvdy5tYXRjaE1lZGlhKCcocHJlZmVycy1jb2xvci1zY2hlbWU6IGRhcmspJykKCmV4cG9ydCBlbnVtIFRoZW1lTW9kZSB7CiAgTElHSFQgPSAnTGlnaHQnLAogIERBUksgPSAnRGFyaycsCiAgQVVUTyA9ICdBdXRvJywKfQoKY29uc3QgT3B0aW9uUGlsbCA9IHN0eWxlZChGbGV4LCB7CiAgcHk6ICckcGFkZGluZzYnLAogIHB4OiAnJHBhZGRpbmcxMCcsCiAgcm93OiB0cnVlLAogIGp1c3RpZnlDb250ZW50OiAnY2VudGVyJywKICBhbGlnbkl0ZW1zOiAnY2VudGVyJywKfSkKCmNvbnN0IENvbXBhY3RPcHRpb25QaWxsID0gc3R5bGVkKEZsZXgsIHsKICBweDogJyRwYWRkaW5nOCcsCiAgaGVpZ2h0OiAnJHNwYWNpbmcyOCcsCiAganVzdGlmeUNvbnRlbnQ6ICdjZW50ZXInLAogIGFsaWduSXRlbXM6ICdjZW50ZXInLAp9KQoKLy8gVHJhY2tzIHRoZSBkZXZpY2UgdGhlbWUKY29uc3Qgc3lzdGVtVGhlbWVBdG9tID0gYXRvbTxUaGVtZU1vZGUuTElHSFQgfCBUaGVtZU1vZGUuREFSSz4oCiAgREFSS01PREVfTUVESUFfUVVFUlkubWF0Y2hlcyA/IFRoZW1lTW9kZS5EQVJLIDogVGhlbWVNb2RlLkxJR0hULAopCgovLyBUcmFja3MgdGhlIHVzZXIncyBzZWxlY3RlZCB0aGVtZSBtb2RlCmNvbnN0IHRoZW1lTW9kZUF0b20gPSBhdG9tV2l0aFN0b3JhZ2U8VGhlbWVNb2RlPignaW50ZXJmYWNlX2NvbG9yX3RoZW1lJywgVGhlbWVNb2RlLkFVVE8pCgpleHBvcnQgZnVuY3Rpb24gU3lzdGVtVGhlbWVVcGRhdGVyKCkgewogIGNvbnN0IHNldFN5c3RlbVRoZW1lID0gdXNlVXBkYXRlQXRvbShzeXN0ZW1UaGVtZUF0b20pCgogIGNvbnN0IGxpc3RlbmVyID0gdXNlQ2FsbGJhY2soCiAgICAoZXZlbnQ6IE1lZGlhUXVlcnlMaXN0RXZlbnQpID0+IHsKICAgICAgc2V0U3lzdGVtVGhlbWUoZXZlbnQubWF0Y2hlcyA/IFRoZW1lTW9kZS5EQVJLIDogVGhlbWVNb2RlLkxJR0hUKQogICAgfSwKICAgIFtzZXRTeXN0ZW1UaGVtZV0sCiAgKQoKICB1c2VFZmZlY3QoKCkgPT4gewogICAgYWRkTWVkaWFRdWVyeUxpc3RlbmVyKERBUktNT0RFX01FRElBX1FVRVJZLCBsaXN0ZW5lcikKICAgIHJldHVybiAoKSA9PiByZW1vdmVNZWRpYVF1ZXJ5TGlzdGVuZXIoREFSS01PREVfTUVESUFfUVVFUlksIGxpc3RlbmVyKQogIH0sIFtsaXN0ZW5lcl0pCgogIHJldHVybiBudWxsCn0KCmV4cG9ydCBmdW5jdGlvbiBUaGVtZUNvbG9yTWV0YVVwZGF0ZXIoKSB7CiAgY29uc3QgaXNEYXJrID0gdXNlSXNEYXJrTW9kZSgpCgogIHVzZUVmZmVjdCgoKSA9PiB7CiAgICBjb25zdCBtZXRhID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcignbWV0YVtuYW1lPXRoZW1lLWNvbG9yXScpCiAgICBpZiAoIW1ldGEpIHsKICAgICAgcmV0dXJuCiAgICB9CgogICAgaWYgKGlzRGFyaykgewogICAgICAvLyB0aGlzIGNvbG9yIGNvbWVzIGZyb20gI2JhY2tncm91bmQtcmFkaWFsLWdyYWRpZW50CiAgICAgIG1ldGEuc2V0QXR0cmlidXRlKCdjb250ZW50JywgJ3JnYigxOSwgMTksIDE5KScpCiAgICB9IGVsc2UgewogICAgICBtZXRhLnNldEF0dHJpYnV0ZSgnY29udGVudCcsICcjZmZmJykKICAgIH0KICB9LCBbaXNEYXJrXSkKCiAgcmV0dXJuIG51bGwKfQoKZXhwb3J0IGZ1bmN0aW9uIHVzZUlzRGFya01vZGUoKTogYm9vbGVhbiB7CiAgY29uc3QgbW9kZSA9IHVzZUF0b21WYWx1ZSh0aGVtZU1vZGVBdG9tKQogIGNvbnN0IHN5c3RlbVRoZW1lID0gdXNlQXRvbVZhbHVlKHN5c3RlbVRoZW1lQXRvbSkKCiAgcmV0dXJuIChtb2RlID09PSBUaGVtZU1vZGUuQVVUTyA/IHN5c3RlbVRoZW1lIDogbW9kZSkgPT09IFRoZW1lTW9kZS5EQVJLCn0KCmV4cG9ydCBmdW5jdGlvbiB1c2VEYXJrTW9kZU1hbmFnZXIoKTogW2Jvb2xlYW4sIChtb2RlOiBUaGVtZU1vZGUpID0+IHZvaWRdIHsKICAuZm9ybS5yZWdpc3RlcigicGFzc3dvcmQiKX0KICAgICAgICAgICAgICAgICAgbGFiZWw9IlBhc3N3b3JkIgogICAgICAgICAgICAgICAgICBwbGFjZWhvbGRlcj0i4oCi4oCi4oCi4oCi4oCi4oCi4oCi4oCi4oCi4oCi4oCi4oCi4oCiIgogICAgICAgICAgICAgICAgICBhdXRvQ29tcGxldGU9InBhc3N3b3JkIgogICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICA8L2ZpZWxkc2V0PgoKICAgICAgICAgICAgICB7ZXJyb3JNZXNzYWdlICYmIDxBbGVydCBzZXZlcml0eT0iZXJyb3IiIHRpdGxlPXtlcnJvck1lc3NhZ2V9IGNsYXNzTmFtZT0ibXktNCIgLz59CiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9Im10LTUganVzdGlmeS1lbmQgc3BhY2UteC0yIHJ0bDpzcGFjZS14LXJldmVyc2Ugc206bXQtNCBzbTpmbGV4Ij4KICAgICAgICAgICAgICAgIDxCdXR0b24gdHlwZT0iYnV0dG9uIiBjb2xvcj0ic2Vjb25kYXJ5IiBvbkNsaWNrPXsoKSA9PiByb3V0ZXIuYmFjaygpfT4KICAgICAgICAgICAgICAgICAge3QoImNhbmNlbCIpfQogICAgICAgICAgICAgICAgPC9CdXR0b24+CiAgICAgICAgICAgICAgICA8QnV0dG9uIHR5cGU9InN1Ym1pdCIgbG9hZGluZz17Zm9ybS5mb3JtU3RhdGUuaXNTdWJtaXR0aW5nfT4KICAgICAgICAgICAgICAgICAge3QoInNhdmUiKX0KICAgICAgICAgICAgICAgIDwvQnV0dG9uPgogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L0Zvcm0+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9kaXY+CiAgICAgIDxUb2FzdGVyIHBvc2l0aW9uPSJib3R0b20tcmlnaHQiIC8+CiAgICA8L2Rpdj4KICApOwp9CmltcG9ydCB7IE1ldGFkYXRhIH0gZnJvbSAibmV4dCIKaW1wb3J0IEltYWdlIGZyb20gIm5leHQvaW1hZ2UiCmltcG9ydCB7IFBsdXNDaXJjbGUgfSBmcm9tICJsdWNpZGUtcmVhY3QiCgppbXBvcnQgeyBCdXR0b24gfSBmcm9tICJAL3JlZ2lzdHJ5L25ldy15b3JrL3VpL2J1dHRvbiIKaW1wb3J0IHsgU2Nyb2xsQXJlYSwgU2Nyb2xsQmFyIH0gZnJvbSAiQC9yZWdpc3RyeS9uZXcteW9yay91aS9zY3JvbGwtYXJlYSIKaW1wb3J0IHsgU2VwYXJhdG9yIH0gZnJvbSAiQC9yZWdpc3RyeS9uZXcteW9yay91aS9zZXBhcmF0b3IiCmltcG9ydCB7CiAgVGFicywKICBUYWJzQ29udGVudCwKICBUYWJzTGlzdCwKICBUYWJzVHJpZ2dlciwKfSBmcm9tICJAL3JlZ2lzdHJ5L25ldy15b3JrL3VpL3RhYnMiCgppbXBvcnQgeyBBbGJ1bUFydHdvcmsgfSBmcm9tICIuL2NvbXBvbmVudHMvYWxidW0tYXJ0d29yayIKaW1wb3J0IHsgTWVudSB9IGZyb20gIi4vY29tcG9uZW50cy9tZW51IgppbXBvcnQgeyBQb2RjYXN0RW1wdHlQbGFjZWhvbGRlciB9IGZyb20gIi4vY29tcG9uZW50cy9wb2RjYXN0LWVtcHR5LXBsYWNlaG9sZGVyIgppbXBvcnQgeyBTaWRlYmFyIH0gZnJvbSAiLi9jb21wb25lbnRzL3NpZGViYXIiCmltcG9ydCB7IGxpc3Rlbk5vd0FsYnVtcywgbWFkZUZvcllvdUFsYnVtcyB9IGZyb20gIi4vZGF0YS9hbGJ1bXMiCmltcG9ydCB7IHBsYXlsaXN0cyB9IGZyb20gIi4vZGF0YS9wbGF5bGlzdHMiCgpleHBvcnQgY29uc3QgbWV0YWRhdGE6IE1ldGFkYXRhID0gewogIHRpdGxlOiAiTXVzaWMgQXBwIiwKICBkZXNjcmlwdGlvbjogIkV4YW1wbGUgbXVzaWMgYXBwIHVzaW5nIHRoZSBjb21wb25lbnRzLiIsCn0KCmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIE11c2ljUGFnZSgpIHsKICByZXR1cm4gKAogICAgPD4KICAgICAgPGRpdiBjbGFzc05hbWU9Im1kOmhpZGRlbiI+CiAgICAgICAgPEltYWdlCiAgICAgICAgICBzcmM9Ii9leGFtcGxlcy9tdXNpYy1saWdodC5wbmciCiAgICAgICAgICB3aWR0aD17MTI4MH0KICAgICAgICAgIGhlaWdodD17MTExNH0KICAgICAgICAgIGFsdD0iTXVzaWMiCiAgICAgICAgICBjbGFzc05hbWU9ImJsb2NrIGRhcms6aGlkZGVuIgogY2tib3hJdGVtIGNoZWNrZWQ+U2hvdyBMeXJpY3M8L01lbnViYXJDaGVja2JveEl0ZW0+CiAgICAgICAgICA8TWVudWJhclNlcGFyYXRvciAvPgogICAgICAgICAgPE1lbnViYXJJdGVtIGluc2V0IGRpc2FibGVkPgogICAgICAgICAgICBTaG93IFN0YXR1cyBCYXIKICAgICAgICAgIDwvTWVudWJhckl0ZW0+CiAgICAgICAgICA8TWVudWJhclNlcGFyYXRvciAvPgogICAgICAgICAgPE1lbnViYXJJdGVtIGluc2V0PkhpZGUgU2lkZWJhcjwvTWVudWJhckl0ZW0+CiAgICAgICAgICA8TWVudWJhckl0ZW0gZGlzYWJsZWQgaW5zZXQ+CiAgICAgICAgICAgIEVudGVyIEZ1bGwgU2NyZWVuCiAgICAgICAgICA8L01lbnViYXJJdGVtPgogICAgICAgIDwvTWVudWJhckNvbnRlbnQ+CiAgICAgIDwvTWVudWJhck1lbnU+CiAgICAgIDxNZW51YmFyTWVudT4KICAgICAgICA8TWVudWJhclRyaWdnZXIgY2xhc3NOYW1lPSJoaWRkZW4gbWQ6YmxvY2siPkFjY291bnQ8L01lbnViYXJUcmlnZ2VyPgogICAgICAgIDxNZW51YmFyQ29udGVudCBmb3JjZU1vdW50PgogICAgICAgICAgPE1lbnViYXJMYWJlbCBpbnNldD5Td2l0Y2ggQWNjb3VudDwvTWVudWJhckxhYmVsPgogICAgICAgICAgPE1lbnViYXJTZXBhcmF0b3IgLz4KICAgICAgICAgIDxNZW51YmFyUmFkaW9Hcm91cCB2YWx1ZT0iYmVub2l0Ij4KICAgICAgICAgICAgPE1lbnViYXJSYWRpb0l0ZW0gdmFsdWU9ImFuZHkiPkFuZHk8L01lbnViYXJSYWRpb0l0ZW0+CiAgICAgICAgICAgIDxNZW51YmFyUmFkaW9JdGVtIHZhbHVlPSJiZW5vaXQiPkJlbm9pdDwvTWVudWJhclJhZGlvSXRlbT4KICAgICAgICAgICAgPE1lbnViYXJSYWRpb0l0ZW0gdmFsdWU9Ikx1aXMiPkx1aXM8L01lbnViYXJSYWRpb0l0ZW0+CiAgICAgICAgICA8L01lbnViYXJSYWRpb0dyb3VwPgogICAgICAgICAgPE1lbnViYXJTZXBhcmF0b3IgLz4KICAgICAgICAgIDxNZW51YmFySXRlbSBpbnNldD5NYW5hZ2UgRmFtaWx5Li4uPC9NZW51YmFySXRlbT4KICAgICAgICAgIDxNZW51YmFyU2VwYXJhdG9yIC8+CiAgICAgICAgICA8TWVudWJhckl0ZW0gaW5zZXQ+QWRkIEFjY291bnQuLi48L01lbnViYXJJdGVtPgogICAgICAgIDwvTWVudWJhckNvbnRlbnQ+CiAgICAgIDwvTWVudWJhck1lbnU+CiAgICA8L01lbnViYXI+CiAgKQp9CmltcG9ydCB7IEV4cGVyaW1lbnRzLCBnZXRPdmVycmlkZUFkYXB0ZXIsIExheWVyUHJvcGVydGllcywgTGF5ZXJzLCB1c2VFeHBlcmltZW50LCB1c2VMYXllciB9IGZyb20gJ0B1bml2ZXJzZS9nYXRpbmcnCmltcG9ydCB7IHVzZUNhbGxiYWNrIH0gZnJvbSAncmVhY3QnCmltcG9ydCB7IEZsZXgsIElucHV0LCBTd2l0Y2gsIFRleHQgfSBmcm9tICd1aS9zcmMnCgpleHBvcnQgZnVuY3Rpb24gTGF5ZXJSb3coewogIHZhbHVlOiBsYXllck5hbWUsCiAgbGF5ZXJEZWZhdWx0ID0gZmFsc2UsCn06IHsKICB2YWx1ZTogTGF5ZXJzCiAgbGF5ZXJEZWZhdWx0PzogdW5rbm93bgp9KTogSlNYLkVsZW1lbnQgewogIGNvbnN0IHsgZ2V0OiBnZXRMYXllclZhbHVlIH0gPSB1c2VMYXllcihsYXllck5hbWUpCgogIGNvbnN0IHZhbHVlID0gT2JqZWN0LnZhbHVlcyhMYXllclByb3BlcnRpZXNbbGF5ZXJOYW1lXSkucmVkdWNlKAogICAgKGFjYywga2V5KSA9PiAoeyAuLi5hY2MsIFtrZXldOiBnZXRMYXllclZhbHVlKGtleSkgPz8gbGF5ZXJEZWZhdWx0IH0pLAogICAge30sCiAgKQoKICBjb25zdCBvdmVycmlkZVZhbHVlID0gdXNlQ2FsbGJhY2soCiAgICA8VCw+KG5ld1BhaXJzOiBSZWNvcmQ8c3RyaW5nLCBUPikgPT4gewogICAgICBnZXRPdmVycmlkZUFkYXB0ZXIoKS5vdmVycmlkZUxheWVyKGxheWVyTmFtZSwgeyAuLi52YWx1ZSwgLi4ubmV3UGFpcnMgfSkKICAgIH0sCiAgICBbbGF5ZXJOYW1lLCB2YWx1ZV0sCiAgKQoKICByZXR1cm4gPFJvdyB0YXJnZXQ9e2xheWVyTmFtZX0gdmFsdWVzPXt2YWx1ZX0gb3ZlcnJpZGVWYWx1ZT17b3ZlcnJuIHBhcmFtcy5vbkNyb3NzaGFpck1vdmUgc28gd2Ugb25seSBldmVyIGhhdmUgdG8gbWFrZSBvbmUgc3Vic2NyaWJlQ3Jvc3NoYWlyTW92ZSBjYWxsCiAgICAgICAgdGhpcy5vblNlcmllc0hvdmVyKG5ld0hvdmVyRGF0YSkKICAgICAgfQogICAgfSkKICB9CgogIC8qKgogICAqIFVwZGF0ZXMgUmVhY3Qgc3RhdGUgd2l0aCB0aGUgY3VycmVudCBjcm9zc2hhaXIgZGF0YS4KICAgKiBUaGlzIG1ldGhvZCBzaG91bGQgYmUgb3ZlcnJpZGRlbiBpbiBzdWJjbGFzc2VzIHRvIHByb3ZpZGUgc3BlY2lmaWMgaG92ZXIgZnVuY3Rpb25hbGl0eS4KICAgKiBXaGVuIG92ZXJyaWRpbmcsIGNhbGwgYHN1cGVyLm9uU2VyaWVzSG92ZXIoZGF0YSlgIHRvIG1haW50YWluIGJhc2UgZnVuY3Rpb25hbGl0eS4KICAgKi8KICBwcm90ZWN0ZWQgb25TZXJpZXNIb3Zlcihob3ZlckRhdGE/OiBDaGFydEhvdmVyRGF0YTxURGF0YVR5cGU+KSB7CiAgICB0aGlzLm9uQ3Jvc3NoYWlyTW92ZT8uKGhvdmVyRGF0YT8uaXRlbSwgaG92ZXJEYXRhPy5sb2dpY2FsSW5kZXgpCgogICAgaWYgKCFob3ZlckRhdGEpIHsKICAgICAgcmV0dXJuCiAgICB9CgogICAgLy8gVG9vbHRpcCBwb3NpdGlvbmluZyBtb2RpZmllZCBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS90cmFkaW5ndmlldy9saWdodHdlaWdodC1jaGFydHMvYmxvYi9tYXN0ZXIvcGx1Z2luLWV4YW1wbGVzL3NyYy9wbHVnaW5zL3Rvb2x0aXAvdG9vbHRpcC50cwogICAgY29uc3QgeCA9IGhvdmVyRGF0YS54ICsgdGhpcy5hcGkucHJpY2VTY2FsZSgnbGVmdCcpLndpZHRoKCkgKyAxMAogICAgY29uc3QgZGVhZHpvbmVXaWR0aCA9IHRoaXMuX2xhc3RUb29sdGlwV2lkdGggPyBNYXRoLmNlaWwodGhpcy5fbGFzdFRvb2x0aXBXaWR0aCkgOiA0NQogICAgY29uc3QgeEFkanVzdGVkID0gTWF0aC5taW4oeCwgdGhpcy5hcGkucGFuZVNpemUoKS53aWR0aCAtIGRlYWR6b25lV2lkdGgpCgogICAgY29uc3QgdHJhbnNmb3JtWCA9IGBjYWxjKCR7eEFkanVzdGVkfXB4KWAKCiAgICBjb25zdCB5ID0gaG92ZXJEYXRhLnkKICAgIGNvbnN0IGZsaXAgPSB5IDw9IDIwICsgMTAwCiAgICAvLyBBZGQgZXh0cmEgb2Zmc2V0IHdoZW4gaW4gdXBwZXIgbGVmdCB0byBwcmV2ZW50IGN1cnNvciBvdmVybGFwCiAgICBjb25zdCBleHRyYU9mZnNldCA9IHkgPCA1MCAmJiBob3ZlckRhdGEueCA8IDEwMCA/IDEwIDogMAogICAgY29uc3QgeVB4ID0geSArIChmbGlwID8gMSA6IC0xKSAqICgyMCArIGV4dHJhT2Zmc2V0KQogICAgY29uc3QgeVBjdCA9IGZsaXAgPyAnJyA6ICcgLSAxMDAlJwogICAgY29uc3QgdHJhbnNmb3JtWSA9IGBjYWxjKCR7eVB4fXB4JHt5UGN0fSlgCgogICAgY29uc3QgdG9vbHRpcCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKHRoaXMudG9vbHRpcElkKQogICAgY29uc3QgbGVnZW5kID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoUFJPVE9DT0xfTEVHRU5EX0VMRU1FTlRfSUQpCgogICAgaWYgKHRvb2x0aXApIHsKICAgICAgdG9vbHRpcC5zdHlsZS50cmFuc2Zvcm0gPSBgdHJhbnNsYXRlKCR7dHJhbnNmb3JtWH0sICR7dHJhbnNmb3JtWX0pYAoKICAgICAgY29uc3QgdG9vbHRpcE1lYXN1cmVtZW50ID0gdG9vbHRpcC5nZXRCb3VuZGluZ0NsaWVudFJlY3QoKQogICAgICB0aGlzLl9sYXN0VG9vbHRpcFdpZHRoID0gdG9vbHRpcE1lYXN1cmVtZW50LndpZHRoIHx8IG51bGwKICAgIH0KICAgIGlmIChsZWdlbmQpIHsKICAgICAgLy8ga2VlcCBsZWdlbmQgY2VudGVyZWQgb24gbW91c2UgY3Vyc29yIGlmIGhvdmVyZWQKICAgICAgbGVnZW5kLnN0eWxlLmxlZnQgPSBgJHt4fXB4YAogICAgICBjb25zdCBoZXJvV2lkdGggPSAyMzAKICAgICAgLy8gYWRqdXN0IGhlaWdodCBvZiB0b29sdGlwIGlmIGhvdmVyaW5nIGJlbG93IHRoZSBoZXJvIHRleHQKICAgICAgaWYgKHggPCBoZXJvV2lkdGgpIHsKICAgICAgICBsZWdlbmQuc3R5bGUudG9wID0gJzgwcHgnCiAgb246ICJwaG9uZS1vdXRnb2luZyIsCiAgICAgIHRpdGxlOiB0KCJyZW1pbmRfYXR0ZW5kZWVzX3RvX2JyaW5nX2lkIiksCiAgICAgIGRlc2NyaXB0aW9uOiB0KCJyZW1pbmRfYXR0ZW5kZWVzX3RvX2JyaW5nX2lkX2Rlc2NyaXB0aW9uIiksCiAgICAgIGljb25XcmFwcGVyQ2xhc3NOYW1lOiAiYmctWyMyQTI5NDddIiwKICAgICAgaW1hZ2U6ICIvY2FsbC1vdXRnb2luZy5zdmciLAogICAgfSwKICBdOwogIC8vIG5ldyB3b3JrZmxvdyBleGFtcGxlIHdoZW4gJ2FmdGVyIG1lZXRpbmdzIGVuZHMnIHRyaWdnZXIgaXMgaW1wbGVtZW50ZWQ6IFNlbmQgY3VzdG9tIHRoYW5rIHlvdSBlbWFpbCB0byBhdHRlbmRlZSBhZnRlciBldmVudCAoU21pbGUgaWNvbiksCgogIGlmIChwcm9wcy5pc0ZpbHRlcmVkVmlldykgewogICAgcmV0dXJuIDxDbGFzc2ljRW1wdHlTY3JlZW4gSWNvbj0iemFwIiBoZWFkbGluZT17dCgibm9fd29ya2Zsb3dzIil9IGRlc2NyaXB0aW9uPXt0KCJjaGFuZ2VfZmlsdGVyIil9IC8+OwogIH0KCiAgcmV0dXJuICgKICAgIDw+CiAgICAgIDxkaXYgY2xhc3NOYW1lPSJtaW4taC04MCBmbGV4IHctZnVsbCBmbGV4LWNvbCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgcm91bmRlZC1tZCAiPgogICAgICAgIDxkaXYgY2xhc3NOYW1lPSJiZy1lbXBoYXNpcyBmbGV4IGgtWzcycHhdIHctWzcycHhdIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciByb3VuZGVkLWZ1bGwiPgogICAgICAgICAgPEljb24gbmFtZT0iemFwIiBjbGFzc05hbWU9ImRhcms6dGV4dC1kZWZhdWx0IGlubGluZS1ibG9jayBoLTEwIHctMTAgc3Ryb2tlLVsxLjNweF0iIC8+CiAgICAgICAgPC9kaXY+CiAgICAgICAgPGRpdiBjbGFzc05hbWU9Im1heC13LVs0MjBweF0gdGV4dC1jZW50ZXIiPgogICAgICAgICAgPGgyIGNsYXNzTmFtZT0idGV4dC1zZW1pYm9sZCBmb250LWNhbCBtdC02IHRleHQteGwgZGFyazp0ZXh0LWdyYXktMzAwIj57dCgid29ya2Zsb3dzIil9PC9oMj4KICAgICAgICAgIDxwIGNsYXNzTmFtZT0idGV4dC1kZWZhdWx0IGxpbmUtY2xhbXAtMiBtdC0zIHRleHQtc20gZm9udC1ub3JtYWwgbGVhZGluZy02IGRhcms6dGV4dC1ncmF5LTMwMCI+CiAgICAgICAgICAgIHt0KCJub193b3JrZmxvd3NfZGVzY3JpcHRpb24iKX0KICAgICAgICAgIDwvcD4KICAgICAgICAgIDxkaXYgY2xhc3NOYW1lPSJtdC04ICI+CiAgICAgICAgICAgIDxDcmVhdGVCdXR0b25XaXRoVGVhbXNMaXN0CiAgICAgICAgICAgICAgc3VidGl0bGU9e3QoIm5ld193b3JrZmxvd19zdWJ0aXRsZSIpLnRvVXBwZXJDYXNlKCl9CiAgICAgICAgICAgICAgZGlzYWJsZU1vYmlsZUJ1dHRvbj17dHJ1ZX0KICAgICAgICAgICAgICBjcmVhdGVGdW5jdGlvbj17b3BlbkRpYWxvZ30KICAgICAgICAgICAgICBidXR0b25UZXh0PXt0KCJjcmVhdGVfd29ya2Zsb3ciKX0KICAgICAgICAgICAgICBpbmNsdWRlT3JnPXt0cnVlfQogICAgICAgICAgICAvPgogICAgICAgICAgPC9kaXY+CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgoKICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggZmxleC1jb2wgZ2FwLTQiPgogICAgICAgIDxUZW1wbGF0ZVNlY3Rpb24gdGl0bGU9e3QoImNhbF9haV90ZW1wbGF0ZXMiKX0gZXhhbXBsZXM9e2NhbEFJVGVtcGxhdGVzfSAvPgogICAgICAgIDxUZW1wbGF0ZVNlY3Rpb24gdGl0bGU9e3QoInN0YW5kYXJkX3RlbXBsYXRlcyIpfSBleGFtcGxlcz17d29ya2Zsb3dzRXhhbXBsZXN9IC8+CiAgICAgIDwvZGl2PgoKICAgICAgPFdvcmtmbG93Q3JlYXRpb25EaWFsb2cgb3Blbj17c2hvd0RpYWxvZ30gb25PcGVuQ2hhbmdlPXtzZXRTaG93RGlhbG9nfSB0ZWFtSWQ9e3BlbmRpbmdUZWFtSWR9IC8+CiAgICA8Lz4KICApOwp9Cgpjb25zdCBUZW1wbGF0ZVNlY3Rpb24gPSAoeyB0aXRsZSwgZXhhbXBsZXMgfTogeyB0aXRsZTogc3RyaW5nOyBleGFtcGxlczogV29ya2Zsb3dFeGFtcGxlVHlwZVtycm9yXSA9IHVzZVN0YXRlKCcnKTsKICBjb25zdCBbZGlydHlFbWFpbEZpZWxkLCBzZXREaXJ0eUVtYWlsRmllbGRdID0gdXNlU3RhdGUoZmFsc2UpOwogIGNvbnN0IFtpc1NoYXJlV2FsbGV0QXBwcm92ZWQsIHNldElzU2hhcmVXYWxsZXRBcHByb3ZlZF0gPSB1c2VTdGF0ZShmYWxzZSk7CiAgY29uc3QgW2NvdW50cnksIHNldENvdW50cnldID0gdXNlU3RhdGU8c3RyaW5nIHwgbnVsbD4obnVsbCk7CiAgY29uc3QgaGFzT3B0ZWRJbiA9IGlzVHJhY2tpbmdFbmFibGVkOwogIGNvbnN0IG9uQmx1ciA9ICgpID0+IHsKICAgIGlmICghZGlydHlFbWFpbEZpZWxkKSBzZXREaXJ0eUVtYWlsRmllbGQodHJ1ZSk7CiAgfTsKCiAgdXNlRWZmZWN0KCgpID0+IHsKICAgIGlmIChmZWVkYmFja0RpYWxvZ09wZW4pIHsKICAgICAgc2V0U3VjY2VzcyhmYWxzZSk7CiAgICAgIHNldEVycm9yKGZhbHNlKTsKICAgICAgc2V0RW1haWxFcnJvcignJyk7CiAgICB9CiAgfSwgW2ZlZWRiYWNrRGlhbG9nT3Blbl0pOwoKICBjb25zdCBoYW5kbGVFbWFpbENoYW5nZSA9IChlOiBSZWFjdC5DaGFuZ2VFdmVudDxIVE1MSW5wdXRFbGVtZW50PikgPT4gewogICAgY29uc3QgZW1haWxWYWx1ZSA9IGUudGFyZ2V0LnZhbHVlOwogICAgc2V0RW1haWwoZW1haWxWYWx1ZSk7CgogICAgY29uc3QgZW1haWxSZWdleCA9IC9eW15cc0BdK0BbXlxzQF0rXC5bXlxzQF0rJC87CiAgICBpZiAoIWVtYWlsUmVnZXgudGVzdChlbWFpbFZhbHVlKSkgewogICAgICBzZXRFbWFpbEVycm9yKCdQbGVhc2UgZW50ZXIgYSB2YWxpZCBlbWFpbCBhZGRyZXNzJyk7CiAgICB9IGVsc2UgewogICAgICBzZXRFbWFpbEVycm9yKCcnKTsKICAgIH0KICB9OwoKICBjb25zdCBoYW5kbGVTdXBwb3J0U3VibWl0ID0gYXN5bmMgKGU6IEZvcm1FdmVudDxIVE1MRm9ybUVsZW1lbnQ+KSA9PiB7CiAgICBlLnByZXZlbnREZWZhdWx0KCk7CgogICAgaWYgKGVtYWlsRXJyb3IgfHwgIWVtYWlsKSB7CiAgICAgIHNldEVtYWlsRXJyb3IoJ1BsZWFzZSBlbnRlciBhIHZhbGlkIGVtYWlsIGFkZHJlc3MnKTsKICAgICAgcmV0dXJuOwogICAgfQoKICAgIHNldElzTG9hZGluZyh0cnVlKTsKCiAgICBjb25zdCB1cmwgPSAnL2FwaS9zdXBwb3J0LWNyZWF0ZS10aWNrZXQnOwogICAgY29uc3QgcGF5bG9hZCA9IHsKICAgICAgdGV4dDogdmFsdWUsCiAgICAgIGVtYWlsOiBlbWFpbCwKICAgICAgY291bnRyeTogY291bnRyeSB8fCB1bmRlZmluZWQsCiAgICAgIHdhbGxldEFkZHJlc3M6IChoYXNPcHRlZEluIHx8IGlzU2hhcmVXYWxsZXRBcHByb3ZlZCkgJiYgYWNjb3VudCA/IGFjY291bnQgOiB1bmRlZmluZWQsCiAgICB9OwoKICAgIHRyeSB7CiAgICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgZmV0Y2godXJsLCB7CiAgICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkocGF5bG9hZCksCiAgICAgICAgbWV0aG9kOiAnUE9TVCcsCiAgICAgICAgaGVhZGVyczogewogICAgICAgICAgJ0NvbnRlbnQtVHlwZSc6ICdhcHBsaWNhdGlvbi9qc29uJywKICAgICAgICB9LAogICAgICB9KTsKICAgICAgaWYgKCFyZXNwb25zZS5vaykgewogICAgICAgIHNldEVycm9yKHRydWUpOwogICAgICAgIHNldElzTG9hZGluZyhmYWxzZSk7CiAgICAgICAgc2V0VmFsdWUoJycpOwogICAgICAgIHNldEVtYWlsKCcnKTsKICAgICAgICBzZXRJc1NoYXJlV2FsbGV0QXBwcm92ZWQoZmFsc2UpOwogICAgICAgIHJldHVybjsKICAgICAgfQogICAgICBzZXRTdWNjZXNzKHRydWUpOwogICAgICB0cmFja0V2ZW50KFNVUFBPUlQuVElDS0VUX0NSRUFURUQsIHsKICAgICAgICB0eXBlOiAnRm9ybScsCiAgICAgICAgaGFzV2FsbGV0Q29ubmVjdGVkOiAhIWFjY291bnQsCiAgICAgIH0pOwogICAgfSBjYXRjaCAoZXJyb3IpIHsKICAgICAgc2V0RXJyb3IodHJ1ZSk7CiAgICAgIHNldElzU2hhcmVXYWxsZXRBcHByb3ZlZChmYWxzZSk7CiAgICB9IGZpbmFsbHkgewogbmZpcm1SaXNrPXtzZXRDb25maXJtZWRSaXNrfQogICAgICAgIG9uUmlza0xldmVsQ2hhbmdlPXtzZXRSaXNrTGV2ZWx9CiAgICAgIC8+CiAgICA8L0RhcHBSZXF1ZXN0Q29udGVudD4KICApCn0KCi8qKgogKiBMZWdhY3kgaW1wbGVtZW50YXRpb24gKGV4aXN0aW5nIGJlaGF2aW9yIHdoZW4gZmVhdHVyZSBmbGFnIGlzIG9mZikKICovCmZ1bmN0aW9uIFNlbmRDYWxsc1JlcXVlc3RDb250ZW50TGVnYWN5KHsKICBkYXBwUmVxdWVzdCwKICB0cmFuc2FjdGlvbkdhc0ZlZVJlc3VsdCwKICBzaG93U21hcnRXYWxsZXRBY3RpdmF0aW9uLAogIG9uQ29uZmlybSwKICBvbkNhbmNlbCwKfTogU2VuZENhbGxzUmVxdWVzdENvbnRlbnRQcm9wcyk6IEpTWC5FbGVtZW50IHsKICBjb25zdCB7IHQgfSA9IHVzZVRyYW5zbGF0aW9uKCkKICBjb25zdCB7IGRhcHBVcmwgfSA9IHVzZURhcHBSZXF1ZXN0UXVldWVDb250ZXh0KCkKICBjb25zdCBjaGFpbklkID0gdXNlRGFwcExhc3RDaGFpbklkKGRhcHBVcmwpCgogIHJldHVybiAoCiAgICA8RGFwcFJlcXVlc3RDb250ZW50CiAgICAgIGNoYWluSWQ9e2NoYWluSWR9CiAgICAgIGNvbmZpcm1UZXh0PXt0KCdjb21tb24uYnV0dG9uLmNvbmZpcm0nKX0KICAgICAgdGl0bGU9e3QoJ2RhcHAucmVxdWVzdC5iYXNlLnRpdGxlJyl9CiAgICAgIHRyYW5zYWN0aW9uR2FzRmVlUmVzdWx0PXt0cmFuc2FjdGlvbkdhc0ZlZVJlc3VsdH0KICAgICAgc2hvd05ldHdvcmtDb3N0CiAgICAgIGRpc2FibGVDb25maXJtPXshdHJhbnNhY3Rpb25HYXNGZWVSZXN1bHQudmFsdWV9CiAgICAgIG9uQ2FuY2VsPXtvbkNhbmNlbH0KICAgICAgb25Db25maXJtPXsoKSA9PiBvbkNvbmZpcm0oKX0KICAgICAgY29udGVudEhvcml6b250YWxQYWRkaW5nPSIkbm9uZSIKICAgICAgc2hvd1NtYXJ0V2FsbGV0QWN0aXZhdGlvbj17c2hvd1NtYXJ0V2FsbGV0QWN0aXZhdGlvbn0KICAgID4KICAgICAgPEJhdGNoZWRSZXF1ZXN0RGV0YWlsc0NvbnRlbnQgY2FsbHM9e2RhcHBSZXF1ZXN0LmNhbGxzfSBjaGFpbklkPXtjaGFpbklkfSAvPgogICAgPC9EYXBwUmVxdWVzdENvbnRlbnQ+CiAgKQp9CgpleHBvcnQgZnVuY3Rpb24gU2VuZENhbGxzUmVxdWVzdEhhbmRsZXIoeyByZXF1ZXN0IH06IHsgcmVxdWVzdDogRGFwcFJlcXVlc3RTdG9yZUl0ZW1Gb3JTZW5kQ2FsbHNUeG4gfSk6IEpTWC5FbGVtZW50IHsKICBjb25zdCB7IGRhcHBVcmwsIGN1cnJlbnRBY2NvdW50LCBvbkNvbmZpcm0sIG9uQ2FuY2VsIH0gPSB1c2VEYXBwUmVxdWVzdFF1ZXVlQ29udGV4dCgpCiAgY29uc3QgY2hhaW5JZCA9IHVzZURhcHBMYXN0Q2hhaW5JZChkYXBwVXJsKSA/PyByZXF1ZXN0LmRhcHBJbmZvPy5sYXN0Q2hhaW5JZAogIGNvbnN0IGJsb2NrYWlkVHJhbnNhY3Rpb25TY2FubmluZyA9IHVzZUZlYXR1cmVGbGFnKEZlYXR1cmVGbGFncy5CbG9ja2FpZFRyYW5zYWN0aW9uU2Nhbm5pbmcpCgogIGNvbnN0IHsgZGFwcFJlcXVlc3QgfSA9IHJlcXVlc3QKCiAgY29uc3QgcGFyc2VkU3dhcENhbGxkYXRhID0gdXNlTWVtbygoKSA9PiB7CiAgICByZXR1cm4gaXNCYXRjaGVkU3dhcFJlcXVlc3QoZGFwcFJlcXVlc3QpCiAgICAgID8gZGFwcFJlcXVlc3QuY2FsbHMKICAgICAgICAgIC5maWx0ZXIoKGNhbGwpOiBjYWxsIGlzIFBhcnNlZENhbGwgPT4gJ3BhcnNlZENhbGxkYXRhJyBpbiBjYWxsKQogICAgICAgICAgLmZpbmQoKGNhbGwpID0+IGNhbGwuY29udHJhY3RJbnRlcmFjdGlvbnMgPT09IEV0aFNlbmRUcmFuc2FjdGlvblJQQ0FjdGlvbnMuU3dhcCk/LnBhcnNlZENhbGxkYXRhCiAgICAgIDogdW5kZWZpbmVkCiAgfSwgW2RhcHBSZXF1ZXN0XSkKCiAgY29uc3QgeyBnYXNGZWVSZXN1bHQsIGVuY29kZWRUcmFuc2FjdGlvblJlcXVlc3QsIGVuY29kZWRSZXF1ZXN0SWQsIHNob3dTbWFydFdhbGxldEFjdGl2YXRpb24sIHByZVNpZ25lZFRyYW5zYWN0aW9uIH0gPQogICAgdXNlUHJlcGFyZUFuZFNpZ25TZW5kQ3lwZSBWb3RlcnNMaXN0SXRlbVByb3BzID0gewogIGNvbXBhY3Q6IGJvb2xlYW47CiAgdm90ZXI6IEVuaGFuY2VkUHJvcG9zYWxWb3RlOwp9OwoKZXhwb3J0IGNvbnN0IFZvdGVyc0xpc3RJdGVtID0gKHsgY29tcGFjdCwgdm90ZXIgfTogVm90ZXJzTGlzdEl0ZW1Qcm9wcyk6IEpTWC5FbGVtZW50IHwgbnVsbCA9PiB7CiAgY29uc3QgeyB2b3RlcjogYWRkcmVzcywgZW5zTmFtZSB9ID0gdm90ZXI7CiAgY29uc3QgYmxvY2tpZUF2YXRhciA9IGJsbyhhZGRyZXNzICE9PSAnJyA/IChhZGRyZXNzIGFzIGAweCR7c3RyaW5nfWApIDogJzB4Jyk7CiAgY29uc3QgdHJhY2tFdmVudCA9IHVzZVJvb3RTdG9yZSgoc3RvcmUpID0+IHN0b3JlLnRyYWNrRXZlbnQpOwoKICAvLyBUaGlzIGZ1bmN0aW9uIGhlbHBzIGRldGVybWluZSBob3cgdG8gZGlzcGxheSBlaXRoZXIgdGhlIGFkZHJlc3Mgb3IgRU5TIG5hbWUsIGluIGEgd2F5IHdoZXJlIHRoZSBsaXN0IGxvb2tzIGdvb2QgYW5kIG5hbWVzIGFyZSBhYm91dCBlcXVhbCBsZW5ndGguCiAgLy8gVGhpcyB0YWtlcyBpbnRvIGFjY291bnQgaWYgdGhlIGxpc3Qgc2hvdWxkIGJlIGNvbXBhY3Qgb3Igbm90LCBhbmQgYWRqdXN0cyBhY2NvcmRpbmdseSB0byBrZWVwIGl0ZW1zIG9mIGFib3V0IGVxdWFsIGxlbmd0aC4KICBjb25zdCBkaXNwbGF5TmFtZSA9IChuYW1lPzogc3RyaW5nKSA9PiB7CiAgICBpZiAoY29tcGFjdCkgewogICAgICAvLyBBZGRyZXNzZXMgd2hlbiBjb21wYWN0CiAgICAgIGlmICghbmFtZSkgewogICAgICAgIHJldHVybiB0ZXh0Q2VudGVyRWxsaXBzaXMoYWRkcmVzcywgMywgMyk7CiAgICAgIH0KICAgICAgLy8gRU5TIG5hbWVzIHdoZW4gY29tcGFjdAogICAgICBjb25zdCBjb21wYWN0TmFtZSA9IG5hbWUubGVuZ3RoIDw9IDEwID8gbmFtZSA6IHRleHRDZW50ZXJFbGxpcHNpcyhuYW1lLCA0LCAzKTsKICAgICAgcmV0dXJuIGNvbXBhY3ROYW1lOwogICAgfQogICAgLy8gQWRkcmVzc2VzCiAgICBpZiAoIW5hbWUpIHsKICAgICAgcmV0dXJuIHRleHRDZW50ZXJFbGxpcHNpcyhhZGRyZXNzLCA5LCAzKTsKICAgIH0KICAgIC8vIEVOUyBuYW1lcwogICAgcmV0dXJuIG5hbWUubGVuZ3RoIDwgMTYgPyBuYW1lIDogdGV4dENlbnRlckVsbGlwc2lzKG5hbWUsIDEyLCAzKTsKICB9OwoKICAvLyBWb3RpbmcgcG93ZXIgLSBBZGp1c3QgZGVjaW1hbHMgYmFzZWQgb2ZmIG9mIGxhcmdlIGFuZCBzbWFsbCB2YWx1ZXMuCiAgLy8gRGVjaW1hbHMgaW5jcmVhc2UgaW4gcHJlY2lzaW9uIGFzIHZhbHVlcyBiZWNvbWUgbG93ZXI6CiAgLy8gRm91ciBmb3IgMDxuPDEuCiAgLy8gVGhyZWUgZm9yIDE8PW48MTAuCiAgLy8gVHdvIGZvciAxMDw9bjwxMDAwLgogIC8vIFplcm8gZGVjaW1hbHMgZm9yIDEwMDA8PW48SW5maW5pdHkuCiAgY29uc3QgZGlzcGxheVZvdGluZ1Bvd2VyID0gTnVtYmVyKHZvdGVyLnZvdGluZ1Bvd2VyKTsKICBjb25zdCBkaXNwbGF5Vm90aW5nUG93ZXJEZWNpbWFscyA9CiAgICBkaXNwbGF5Vm90aW5nUG93ZXIgPCAxCiAgICAgID8gNAogICAgICA6IGRpc3BsYXlWb3RpbmdQb3dlciA8IDEwCiAgICAgID8gMwogICAgICA6IGRpc3BsYXlWb3RpbmdQb3dlciA8IDEwMDAgfHwgZGlzcGxheVZvdGluZ1Bvd2VyID4gMTAwMDAwMAogICAgICA/IDIKICAgICAgOiBkaXNwbGF5Vm90aW5nUG93ZXIgPiAxMDAwMDAKICAgICAgPyAxCiAgICAgIDogMDsKCiAgLy8gRG9uJ3Qgc2hvdyBhbnkgcmVzdWx0cyB0aGF0IGNvbWUgYmFjayB3aXRoIHplcm8gb3IgbmVnYXRpdmUgdm90aW5nIHBvd2VyCiAgaWYgKE51bWJlcih2b3Rlci52b3RpbmdQb3dlcikgPD0gMCkgcmV0dXJuIG51bGw7CgogIHJldHVybiAoCiAgICA8Qm94IHN4PXt7IG15OiA2LCAnJjpmaXJzdC1vZi10eXBlJzogeyBtdDogMCB9LCAnJjpsYXN0LW9mLXR5cGUnOiB7IG1iOiAwIH0gfX0+CiAgICAgIDxCb3ggc3g9e3sgZGlzcGxheTogJ2ZsZXgnLCBhbGlnZD0iTTEyLjE1MiA2Ljg5NmMtLjk0OCAwLTIuNDE1LTEuMDc4LTMuOTYtMS4wNC0yLjA0LjAyNy0zLjkxIDEuMTgzLTQuOTYxIDMuMDE0LTIuMTE3IDMuNjc1LS41NDYgOS4xMDMgMS41MTkgMTIuMDkgMS4wMTMgMS40NTQgMi4yMDggMy4wOSAzLjc5MiAzLjAzOSAxLjUyLS4wNjUgMi4wOS0uOTg3IDMuOTM1LS45ODcgMS44MzEgMCAyLjM1Ljk4NyAzLjk2Ljk0OCAxLjYzNy0uMDI2IDIuNjc2LTEuNDggMy42NzYtMi45NDggMS4xNTYtMS42ODggMS42MzYtMy4zMjUgMS42NjItMy40MTUtLjAzOS0uMDEzLTMuMTgyLTEuMjIxLTMuMjItNC44NTctLjAyNi0zLjA0IDIuNDgtNC40OTQgMi41OTctNC41NTktMS40MjktMi4wOS0zLjYyMy0yLjMyNC00LjM5LTIuMzc2LTItLjE1Ni0zLjY3NSAxLjA5LTQuNjEgMS4wOXpNMTUuNTMgMy44M2MuODQzLTEuMDEyIDEuNC0yLjQyNyAxLjI0NS0zLjgzLTEuMjA3LjA1Mi0yLjY2Mi44MDUtMy41MzIgMS44MTgtLjc4Ljg5Ni0xLjQ1NCAyLjMzOC0xLjI3MyAzLjcxNCAxLjMzOC4xMDQgMi43MTUtLjY4OCAzLjU1OS0xLjcwMSIKICAgICAgICAgICAgICAgICAgZmlsbD0iY3VycmVudENvbG9yIgogICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICA8L3N2Zz4KICAgICAgICAgICAgICBDb250aW51ZSB3aXRoIEFwcGxlCiAgICAgICAgICAgIDwvQnV0dG9uPgogICAgICAgICAgICA8QnV0dG9uIHZhcmlhbnQ9Im91dGxpbmUiIHR5cGU9ImJ1dHRvbiI+CiAgICAgICAgICAgICAgPHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAyNCAyNCI+CiAgICAgICAgICAgICAgICA8cGF0aAogICAgICAgICAgICAgICAgICBkPSJNMTIuNDggMTAuOTJ2My4yOGg3Ljg0Yy0uMjQgMS44NC0uODUzIDMuMTg3LTEuNzg3IDQuMTMzLTEuMTQ3IDEuMTQ3LTIuOTMzIDIuNC02LjA1MyAyLjQtNC44MjcgMC04LjYtMy44OTMtOC42LTguNzJzMy43NzMtOC43MiA4LjYtOC43MmMyLjYgMCA0LjUwNyAxLjAyNyA1LjkwNyAyLjM0N2wyLjMwNy0yLjMwN0MxOC43NDcgMS40NCAxNi4xMzMgMCAxMi40OCAwIDUuODY3IDAgLjMwNyA1LjM4Ny4zMDcgMTJzNS41NiAxMiAxMi4xNzMgMTJjMy41NzMgMCA2LjI2Ny0xLjE3MyA4LjM3My0zLjM2IDIuMTYtMi4xNiAyLjg0LTUuMjEzIDIuODQtNy42NjcgMC0uNzYtLjA1My0xLjQ2Ny0uMTczLTIuMDUzSDEyLjQ4eiIKICAgICAgICAgICAgICAgICAgZmlsbD0iY3VycmVudENvbG9yIgogICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICA8L3N2Zz4KICAgICAgICAgICAgICBDb250aW51ZSB3aXRoIEdvb2dsZQogICAgICAgICAgICA8L0J1dHRvbj4KICAgICAgICAgIDwvRmllbGQ+CiAgICAgICAgPC9GaWVsZEdyb3VwPgogICAgICA8L2Zvcm0+CiAgICAgIDxGaWVsZERlc2NyaXB0aW9uIGNsYXNzTmFtZT0icHgtNiB0ZXh0LWNlbnRlciI+CiAgICAgICAgQnkgY2xpY2tpbmcgY29udGludWUsIHlvdSBhZ3JlZSB0byBvdXIgPGEgaHJlZj0iIyI+VGVybXMgb2YgU2VydmljZTwvYT57IiAifQogICAgICAgIGFuZCA8YSBocmVmPSIjIj5Qcml2YWN5IFBvbGljeTwvYT4uCiAgICAgIDwvRmllbGREZXNjcmlwdGlvbj4KICAgIDwvZGl2PgogICkKfQoidXNlIGNsaWVudCI7CgppbXBvcnQgTGluayBmcm9tICJuZXh0L2xpbmsiOwppbXBvcnQgeyB1c2VFZmZlY3QsIHVzZVN0YXRlIH0gZnJvbSAicmVhY3QiOwppbXBvcnQgUVJDb2RlIGZyb20gInJlYWN0LXFyLWNvZGUiOwppbXBvcnQgeiBmcm9tICJ6b2QiOwoKaW1wb3J0IHsgdXNlQm9va2luZ1N1Y2Nlc3NSZWRpcmVjdCB9IGZyb20gIkBjYWxjb20vZmVhdHVyZXMvYm9va2luZ3MvbGliL2Jvb2tpbmdTdWNjZXNzUmVkaXJlY3QiOwppbXBvcnQgdHlwZSB7IFBheW1lbnRQYWdlUHJvcHMgfSBmcm9tICJAY2FsY29tL2ZlYXR1cmVzL2VlL3BheW1lbnRzL3BhZ2VzL3BheW1lbnQiO2lkCiAgb25SZWplY3Q/OiAoKSA9PiB2b2lkCiAgb25BY2tub3dsZWRnZT86ICgpID0+IHZvaWQKICBzZW5kUmVwb3J0PzogKHJlcG9ydFRleHQ6IHN0cmluZykgPT4gdm9pZAogIGhpZGVIYW5kbGViYXI/OiBib29sZWFuCiAgbW9kYWxOYW1lOiBNb2RhbE5hbWVUeXBlCiAgdGl0bGU/OiBzdHJpbmcKICB0aXRsZUNvbXBvbmVudD86IFJlYWN0Tm9kZQogIGNhcHRpb24/OiBzdHJpbmcKICBjYXB0aW9uQ29tcG9uZW50PzogUmVhY3ROb2RlCiAgcmVqZWN0VGV4dD86IHN0cmluZwogIGFja25vd2xlZGdlVGV4dD86IHN0cmluZwogIHNldmVyaXR5PzogV2FybmluZ1NldmVyaXR5CiAgaWNvbj86IFJlYWN0Tm9kZQogIC8vIHdoZW4gaWNvbiBpcyB1bmRlZmluZWQgd2UgZGVmYXVsdCBpdCB0byB0cmlhbmdsZSwgdGhpcyBhbGxvd3MgdXMgdG8gaGlkZSBpdAogIGhpZGVJY29uPzogYm9vbGVhbgogIC8vIGB1bmRlZmluZWRgIG1lYW5zIHdlIHVzZSB0aGUgZGVmYXVsdCBjb2xvciwgYGZhbHNlYCBtZWFucyBubyBiYWNrZ3JvdW5kIGNvbG9yCiAgYmFja2dyb3VuZEljb25Db2xvcj86IENvbG9yVmFsdWUgfCBmYWxzZQogIG1heFdpZHRoPzogbnVtYmVyCiAgYW5hbHl0aWNzUHJvcGVydGllcz86IFJlY29yZDxzdHJpbmcsIHVua25vd24+CiAgYnV0dG9uU2l6ZT86IEJ1dHRvblByb3BzWydzaXplJ10KICBzaG93Q2xvc2VCdXR0b24/OiBib29sZWFuCiAgYWNrbm93bGVkZ2VCdXR0b25FbXBoYXNpcz86IEJ1dHRvbkVtcGhhc2lzCiAgY2xvc2VIZWFkZXJDb21wb25lbnQ/OiBSZWFjdE5vZGUKfSAmIEZsZXhQcm9wcwoKZXhwb3J0IHR5cGUgV2FybmluZ01vZGFsUHJvcHMgPSB7CiAgaXNPcGVuOiBib29sZWFuCiAgaXNEaXNtaXNzaWJsZT86IGJvb2xlYW4KICB6SW5kZXg/OiBudW1iZXIKfSAmIFdhcm5pbmdNb2RhbENvbnRlbnRQcm9wcwoKZnVuY3Rpb24gV2FybmluZ01vZGFsSWNvbih7CiAgaGlkZUljb24sCiAgaWNvbiwKICBiYWNrZ3JvdW5kSWNvbkNvbG9yLAogIGFsZXJ0SGVhZGVyVGV4dENvbG9yLAp9OiB7CiAgaGlkZUljb24/OiBib29sZWFuCiAgaWNvbj86IFJlYWN0Tm9kZQogIGJhY2tncm91bmRJY29uQ29sb3I/OiBDb2xvclZhbHVlIHwgZmFsc2UKICBhbGVydEhlYWRlclRleHRDb2xvcjogc3RyaW5nCn0pOiBKU1guRWxlbWVudCB8IG51bGwgewogIGNvbnN0IGNvbG9ycyA9IHVzZVNwb3JlQ29sb3JzKCkKCiAgaWYgKGhpZGVJY29uKSB7CiAgICByZXR1cm4gbnVsbAogIH0KCiAgcmV0dXJuICgKICAgIDxGbGV4CiAgICAgIGNlbnRlcmVkCiAgICAgIGFsaWduSXRlbXM9ImNlbnRlciIKICAgICAgbWluSGVpZ2h0PSIkc3BhY2luZzQ4IgogICAgICBtaW5XaWR0aD0iJHNwYWNpbmc0OCIKICAgICAgYm9yZGVyUmFkaXVzPSIkcm91bmRlZDEyIgogICAgICBtYj0iJHNwYWNpbmc4IgogICAgICBwPXtiYWNrZ3JvdW5kSWNvbkNvbG9yID09PSBmYWxzZSA/ICckbm9uZScgOiAnJHNwYWNpbmcxMid9CiAgICAgIHN0eWxlPXsKICAgICAgICBiYWNrZ3JvdW5kSWNvbkNvbG9yID09PSBmYWxzZQogICAgICAgICAgPyB1bmRlZmluZWQKICAgICAgICAgIDogewogICAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjoKICAgICAgICAgICAgICAgIGJhY2tncm91bmRJY29uQ29sb3IgPz8gb3BhY2lmeSgxMiwgY29sb3JzW2FsZXJ0SGVhZGVyVGV4dENvbG9yIGFzIGtleW9mIHR5cGVvZiBjb2xvcnNdLnZhbCksCiAgICAgICAgICAgIH0KICAgICAgfQogICAgPgogICAgICB7aWNvbiA/PyA8QWxlcnRUcmlhbmdsZUZpbGxlZCBjb2xvcj17YWxlcnRIZWFkZXJUZXh0Q29sb3J9IHNpemU9IiRpY29uLjI0IiAvPn0KICAgIDwvRmxleD4KICApCn0KCmZ1bmN0aW9uIFJlcG9ydFdhcm5pbmdNb2RhbENvbnRlbnQoewogIG9uQmFjaywKICBvblNlbmRSZXBvcnQsCiAgd3JhcHBlclByb3BzLAogIGNoaWxkcmVuLAp9OiBQcm9wc1dpdGhDaGlsZHJlbjx7CiAgb25CYWNrOiAoKSAgZGF0YT86IHsKICAgICAgc3Vic2V0T2ZVc2VyczogUGljazxVc2VyLCAid2Vla1N0YXJ0Ij5bXTsKICAgICAgcGVyaW9kVHlwZT86IFBlcmlvZERhdGFbInBlcmlvZFR5cGUiXTsKICAgICAgcGVyaW9kU3RhcnREYXRlPzogUGVyaW9kRGF0YVsicGVyaW9kU3RhcnREYXRlIl07CiAgICAgIHBlcmlvZEVuZERhdGU/OiBQZXJpb2REYXRhWyJwZXJpb2RFbmREYXRlIl07CiAgICAgIHBlcmlvZERheXM/OiBQZXJpb2REYXRhWyJwZXJpb2REYXlzIl07CiAgICAgIHBlcmlvZENvdW50Q2FsZW5kYXJEYXlzPzogUGVyaW9kRGF0YVsicGVyaW9kQ291bnRDYWxlbmRhckRheXMiXTsKICAgIH0gfCBudWxsOwogIH07CiAgc2xvdHM/OiBTbG90czsKICBpc0xvYWRpbmc/OiBib29sZWFuOwogIGNsYXNzTmFtZXM/OiBEYXRlUGlja2VyQ2xhc3NOYW1lczsKICBzY3JvbGxUb1RpbWVTbG90cz86ICgpID0+IHZvaWQ7CiAgc2hvd05vQXZhaWxhYmlsaXR5RGlhbG9nPzogYm9vbGVhbjsKICBvbkRhdGVDaGFuZ2U/OiAoKSA9PiB2b2lkOwp9KSA9PiB7CiAgY29uc3QgeyBpMThuIH0gPSB1c2VMb2NhbGUoKTsKICBjb25zdCBbbW9udGgsIHNlbGVjdGVkRGF0ZSwgbGF5b3V0XSA9IHVzZUJvb2tlclN0b3JlQ29udGV4dCgKICAgIChzdGF0ZSkgPT4gW3N0YXRlLm1vbnRoLCBzdGF0ZS5zZWxlY3RlZERhdGUsIHN0YXRlLmxheW91dF0sCiAgICBzaGFsbG93CiAgKTsKCiAgY29uc3QgW3NldFNlbGVjdGVkRGF0ZSwgc2V0TW9udGgsIHNldERheUNvdW50XSA9IHVzZUJvb2tlclN0b3JlQ29udGV4dCgKICAgIChzdGF0ZSkgPT4gW3N0YXRlLnNldFNlbGVjdGVkRGF0ZSwgc3RhdGUuc2V0TW9udGgsIHN0YXRlLnNldERheUNvdW50XSwKICAgIHNoYWxsb3cKICApOwoKICBjb25zdCBzbG90c1ZpZXdPblNtYWxsU2NyZWVuID0gdXNlU2xvdHNWaWV3T25TbWFsbFNjcmVlbigpOwoKICBjb25zdCBvbk1vbnRoQ2hhbmdlID0gKGRhdGU6IERheWpzKSA9PiB7CiAgICBzZXRNb250aChkYXRlLmZvcm1hdCgiWVlZWS1NTSIpKTsKICAgIGlmICghc2xvdHNWaWV3T25TbWFsbFNjcmVlbikgewogICAgICBzZXRTZWxlY3RlZERhdGUoeyBkYXRlOiBkYXRlLmZvcm1hdCgiWVlZWS1NTS1ERCIpIH0pOwogICAgfQogICAgc2V0RGF5Q291bnQobnVsbCk7IC8vIFdoZW5ldmVyIHRoZSBtb250aCBpcyBjaGFuZ2VkLCB3ZSBudWxsaWZ5IGdldHRpbmcgWCBkYXlzCiAgfTsKCiAgY29uc3Qgbm9uRW1wdHlTY2hlZHVsZURheXMgPSB1c2VOb25FbXB0eVNjaGVkdWxlRGF5cyhzbG90cyk7CiAgY29uc3QgYnJvd3NpbmdEYXRlID0gbW9udGggPyBkYXlqcyhtb250aCkgOiBkYXlqcygpLnN0YXJ0T2YoIm1vbnRoIik7CgogIGNvbnN0IHsgbW92ZVRvTmV4dE1vbnRoT25Ob0F2YWlsYWJpbGl0eSB9ID0KICAgIHVzZU1vdmVUb05leHRNb250aE9uTm9BdmFpbGFiaWxpdHkoewogICAgICBicm93c2luZ0RhdGUsCiAgICAgIG5vbkVtcHR5U2NoZWR1bGVEYXlzLAogICAgICBvbk1vbnRoQ2hhbmdlLAogICAgICBpc0xvYWRpbmc6IGlzTG9hZGluZyA/PyB0cnVlLAogICAgfSk7CiAgbW92ZVRvTmV4dE1vbnRoT25Ob0F2YWlsYWJpbGl0eSgpOwoKICAvLyBEZXRlcm1pbmUgaWYgdGhpcyBpcyBhIGNvbXBhY3Qgc2lkZWJhciB2aWV3IGJhc2VkIG9uIGxheW91dAogIGNvbnN0IGlzQ29tcGFjdCA9IGxheW91dCAhPT0gIm1vbnRoX3ZpZXciICYmIGxheW91dCAhPT0gIm1vYmlsZSI7CgogIGNvbnN0IHBlcmlvZERhdGE6IFBlcmlvZERhdGEgPSB7CiAgICAuLi57CiAgICAgIHBlcmlvZFR5cGU6ICJVTkxJTUlURUQiLAogICAgICBwZXJpb2RTdGFydERhdGU6IG51bGwsCiAgICAgIHBlcmlvZEVuZERhdGU6IG51bGwsCiAgICAgIHBlcmlvZERheXM6IG51bGwsCiAgICAgIHBlcmlvZENvdW50Q2FsZW5kYXJEYXlzOiBmYWxzZSwKICAgIH0sCiAgICAuLi4oZXZlbnQ/LmRhdGEgJiYgewogICAgICBwZXJpb2RUeXBlOiBldmVudC5kYXRhaXZpdHlUYWIuVHhzICYmICgKICAgICAgICA8VHJhbnNhY3Rpb25zVGFibGUgY2hhaW5JZD17cmVmZXJlbmNlQ3VycmVuY3kuY2hhaW5JZH0gcmVmZXJlbmNlVG9rZW49e3JlZmVyZW5jZUN1cnJlbmN5LndyYXBwZWR9IC8+CiAgICAgICl9CiAgICAgIHthY3Rpdml0eUluVmlldyA9PT0gQWN0aXZpdHlUYWIuUG9vbHMgJiYgIWlzU29sYW5hVG9rZW4gJiYgKAogICAgICAgIDxUb2tlbkRldGFpbHNQb29sc1RhYmxlIHJlZmVyZW5jZUN1cnJlbmN5PXtyZWZlcmVuY2VDdXJyZW5jeX0gLz4KICAgICAgKX0KICAgIDwvQ29udGFpbmVyPgogICkKfQppbXBvcnQgUmVhY3QsIHsgdHlwZSBSZWFjdE5vZGUsIHVzZUNvbnRleHQsIHVzZUVmZmVjdCB9IGZyb20gJ3JlYWN0JzsKaW1wb3J0IHsgdG91Y2hhYmxlU3R5bGVzIH0gZnJvbSAnLi4vLi4vY3NzL3RvdWNoYWJsZVN0eWxlcyc7CmltcG9ydCB7IHVzZVdpbmRvd1NpemUgfSBmcm9tICcuLi8uLi9ob29rcy91c2VXaW5kb3dTaXplJzsKaW1wb3J0IHsgQnJvd3NlclR5cGUsIGdldEJyb3dzZXIsIGlzU2FmYXJpIH0gZnJvbSAnLi4vLi4vdXRpbHMvYnJvd3NlcnMnOwppbXBvcnQgeyBnZXRHcmFkaWVudFJHQkFzIH0gZnJvbSAnLi4vLi4vdXRpbHMvY29sb3JzJzsKaW1wb3J0IHsgUGxhdGZvcm1UeXBlLCBnZXRQbGF0Zm9ybSB9IGZyb20gJy4uLy4uL3V0aWxzL3BsYXRmb3Jtcyc7CmltcG9ydCB0eXBlIHsgSW5zdHJ1Y3Rpb25TdGVwTmFtZSB9IGZyb20gJy4uLy4uL3dhbGxldHMvV2FsbGV0JzsKaW1wb3J0IHsKICB0eXBlIFdhbGxldENvbm5lY3RvciwKICB1c2VXYWxsZXRDb25uZWN0b3JzLAp9IGZyb20gJy4uLy4uL3dhbGxldHMvdXNlV2FsbGV0Q29ubmVjdG9ycyc7CmltcG9ydCB7IEFzeW5jSW1hZ2UgfSBmcm9tICcuLi9Bc3luY0ltYWdlL0FzeW5jSW1hZ2UnOwppbXBvcnQgeyBsb2FkSW1hZ2VzIH0gZnJvbSAnLi4vQXN5bmNJbWFnZS91c2VBc3luY0ltYWdlJzsKaW1wb3J0IHsgQm94LCB0eXBlIEJveFByb3BzIH0gZnJvbSAnLi4vQm94L0JveCc7CmltcG9ydCB7IEFjdGlvbkJ1dHRvbiB9IGZyb20gJy4uL0J1dHRvbi9BY3Rpb25CdXR0b24nOwppbXBvcnQgeyBDb25uZWN0SWNvbiwgcHJlbG9hZENvbm5lY3RJY29uIH0gZnJvbSAnLi4vSWNvbnMvQ29ubmVjdCc7CmltcG9ydCB7IENyZWF0ZUljb24sIHByZWxvYWRDcmVhdGVJY29uIH0gZnJvbSAnLi4vSWNvbnMvQ3JlYXRlJzsKaW1wb3J0IHsgUmVmcmVzaEljb24sIHByZWxvYWRSZWZyZXNoSWNvbiB9IGZyb20gJy4uL0ljb25zL1JlZnJlc2gnOwppbXBvcnQgeyBTY2FuSWNvbiwgcHJlbG9hZFNjYW5JY29uIH0gZnJvbSAnLi4vSWNvbnMvU2Nhbic7CmltcG9ydCB7IFNwaW5uZXJJY29uIH0gZnJvbSAnLi4vSWNvbnMvU3Bpbm5lcic7CmltcG9ydCB7IFFSQ29kZSB9IGZyb20gJy4uL1FSQ29kZS9RUkNvZGUnOwppbXBvcnQgeyBJMThuQ29udGV4dCB9IGZyb20gJy4uL1JhaW5ib3dLaXRQcm92aWRlci9JMThuQ29udGV4dCc7CmltcG9ydCB7IE1vZGFsU2l6ZUNvbnRleHQgfSBmcm9tICcuLi9SYWluYm93S2l0UHJvdmlkZXIvTW9kYWxTaXplQ29udGV4dCc7CmltcG9ydCB7IFRleHQgfSBmcm9tICcuLi9UZXh0L1RleHQnOwppbXBvcnQgeyBXYWxsZXRTdGVwIH0gZnJvbSAnLi9EZXNrdG9wT3B0aW9ucyc7Cgpjb25zdCBnZXRCcm93c2VyU3JjOiAoKSA9PiBQcm9taXNlPHN0cmluZz4gPSBhc3luYyAoKSA9PiB7CiAgY29uc3QgYnJvd3NlciA9IGdldEJyb3dzZXIoKTsKICBzd2l0Y2ggKGJyb3dzZXIpIHsKICAgIGNhc2UgQnJvd3NlclR5cGUuQXJjOgogICAgICByZXR1cm4gKGF3YWl0IGltcG9ydCgnLi4vSWNvbnMvQXJjLnN2ZycpKS5kZWZhdWx0OwogICAgY2FzZSBCcm93c2VyVHlwZS5CcmF2ZToKICAgICAgcmV0dXJuIChhd2FpdCBpbXBvcnQoJy4uL0ljb25zL0JyYXZlLnN2ZycpKS5kZWZhdWx0OwogICAgY2FzZSBCcm93c2VyVHlwZS5DaHJvbWU6CiAgb25zLAp9IGZyb20gIkAvY29tcG9uZW50cy9sYW5ndWFnZS1zZWxlY3RvciIKCmNvbnN0IHRyYW5zbGF0aW9uczogVHJhbnNsYXRpb25zID0gewogIGVuOiB7CiAgICBkaXI6ICJsdHIiLAogICAgdmFsdWVzOiB7CiAgICAgIHBheW1lbnRUaXRsZTogIlBheW1lbnQgc3VjY2Vzc2Z1bCIsCiAgICAgIHBheW1lbnREZXNjcmlwdGlvbjoKICAgICAgICAiWW91ciBwYXltZW50IG9mICQyOS45OSBoYXMgYmVlbiBwcm9jZXNzZWQuIEEgcmVjZWlwdCBoYXMgYmVlbiBzZW50IHRvIHlvdXIgZW1haWwgYWRkcmVzcy4iLAogICAgICBmZWF0dXJlVGl0bGU6ICJOZXcgZmVhdHVyZSBhdmFpbGFibGUiLAogICAgICBmZWF0dXJlRGVzY3JpcHRpb246CiAgICAgICAgIldlJ3ZlIGFkZGVkIGRhcmsgbW9kZSBzdXBwb3J0LiBZb3UgY2FuIGVuYWJsZSBpdCBpbiB5b3VyIGFjY291bnQgc2V0dGluZ3MuIiwKICAgIH0sCiAgfSwKICBhcjogewogICAgZGlyOiAicnRsIiwKICAgIHZhbHVlczogewogICAgICBwYXltZW50VGl0bGU6ICLYqtmFINin2YTYr9mB2Lkg2KjZhtis2KfYrSIsCiAgICAgIHBheW1lbnREZXNjcmlwdGlvbjoKICAgICAgICAi2KrZhdiqINmF2LnYp9mE2KzYqSDYr9mB2LnYqtmDINin2YTYqNin2YTYutipIDI5Ljk5INiv2YjZhNin2LHZi9inLiDYqtmFINil2LHYs9in2YQg2KXZiti12KfZhCDYpdmE2Ykg2LnZhtmI2KfZhiDYqNix2YrYr9mDINin2YTYpdmE2YPYqtix2YjZhtmKLiIsCiAgICAgIGZlYXR1cmVUaXRsZTogItmF2YrYstipINis2K/Zitiv2Kkg2YXYqtin2K3YqSIsCiAgICAgIGZlYXR1cmVEZXNjcmlwdGlvbjoKICAgICAgICAi2YTZgtivINij2LbZgdmG2Kcg2K/YudmFINin2YTZiNi22Lkg2KfZhNiv2KfZg9mGLiDZitmF2YPZhtmDINiq2YHYudmK2YTZhyDZgdmKINil2LnYr9in2K/Yp9iqINit2LPYp9io2YMuIiwKICAgIH0sCiAgfSwKICBoZTogewogICAgZGlyOiAicnRsIiwKICAgIHZhbHVlczogewogICAgICBwYXltZW50VGl0bGU6ICLXlNeq16nXnNeV150g15HXldem16Ig15HXlNem15zXl9eUIiwKICAgICAgcGF5bWVudERlc2NyaXB0aW9uOgogICAgICAgICLXlNeq16nXnNeV150g16nXnNeaINeR16HXmiAyOS45OSDXk9eV15zXqCDXoteV15HXky4g16fXkdec15Qg16DXqdec15fXlCDXnNeb16rXldeR16og15TXkNeZ157XmdeZ15wg16nXnNeaLiIsCiAgICAgIGZlYXR1cmVUaXRsZTogIteq15vXldeg15Qg15fXk9ep15Qg15bXnteZ16DXlCIsCiAgICAgIGZlYXR1cmVEZXNjcmlwdGlvbjoKICAgICAgICAi15TXldeh16TXoNeVINeq157Xmdeb15Qg15HXntem15Eg15vXlNeULiDXkNeq15Qg15nXm9eV15wg15zXlNek16LXmdecINeQ15XXqteVINeR15TXkteT16jXldeqINeU15fXqdeR15XXnyDXqdec15ouIiwKICAgIH0sCiAgfSwKfQoKY29uc3QgYWxlcnRzID0gWwogIHsKICAgIGljb246IENoZWNrQ2lyY2xlMkljb24sCiAgICB0aXRsZUtleTogInBheW1lbnRUaXRsZSIgYXMgY29uc3QsCiAgICBkZXNjcmlwdGlvbktleTogInBheW1lbnREZXNjcmlwdGlvbiIgYXMgY29uc3QsCiAgfSwKICB7CiAgICBpY29uOiBJbmZvSWNvbiwKICAgIHRpdGxlS2V5OiAiZmVhdHVyZVRpdGxlIiBhcyBjb25zdCwKICAgIGRlc2NyaXB0aW9uS2V5OiAiZmVhdHVyZURlc2NyaXB0aW9uIiBhcyBjb25zdCwKICB9LApdIGFzIGNvbnN0CgpleHBvcnQgZnVuY3Rpb24gQWxlcnRSdGwoKSB7CiAgY29uc3QgeyBkaXIsIHQgfSA9IHVzZVRyYW5zbGF0aW9uKHRyYW5zbGF0aW9ucywgImFyIikKCiAgcmV0dXJuICgKICAgIDxkaXYgY2xhc3NOYW1lPSJncmlkIHctZnVsbCBtYXgtdy1tZCBpdGVtcy1zdGFydCBnYXAtNCIgZGlyPXtkaXJ9PgogICAgICB7YWxlcnRzLm1hcCgoYWxlcnQsIGluZGV4KSA9PiB7CiAgICAgICAgY29uc3QgSWNvbiA9IGFsZXJ0Lmljb24KICAgICAgICByZXR1cm4gKAogICAgICAgICAgPEFsZXJ0IGtleT17aW5kZXh9PgogIHRvcDogNDA5LCBtb2JpbGU6IDMyMCB9LAogIHsgZGF0ZTogIjIwMjQtMDQtMDkiLCBkZXNrdG9wOiA1OSwgbW9iaWxlOiAxMTAgfSwKICB7IGRhdGU6ICIyMDI0LTA0LTEwIiwgZGVza3RvcDogMjYxLCBtb2JpbGU6IDE5MCB9LAogIHsgZGF0ZTogIjIwMjQtMDQtMTEiLCBkZXNrdG9wOiAzMjcsIG1vYmlsZTogMzUwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNC0xMiIsIGRlc2t0b3A6IDI5MiwgbW9iaWxlOiAyMTAgfSwKICB7IGRhdGU6ICIyMDI0LTA0LTEzIiwgZGVza3RvcDogMzQyLCBtb2JpbGU6IDM4MCB9LAogIHsgZGF0ZTogIjIwMjQtMDQtMTQiLCBkZXNrdG9wOiAxMzcsIG1vYmlsZTogMjIwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNC0xNSIsIGRlc2t0b3A6IDEyMCwgbW9iaWxlOiAxNzAgfSwKICB7IGRhdGU6ICIyMDI0LTA0LTE2IiwgZGVza3RvcDogMTM4LCBtb2JpbGU6IDE5MCB9LAogIHsgZGF0ZTogIjIwMjQtMDQtMTciLCBkZXNrdG9wOiA0NDYsIG1vYmlsZTogMzYwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNC0xOCIsIGRlc2t0b3A6IDM2NCwgbW9iaWxlOiA0MTAgfSwKICB7IGRhdGU6ICIyMDI0LTA0LTE5IiwgZGVza3RvcDogMjQzLCBtb2JpbGU6IDE4MCB9LAogIHsgZGF0ZTogIjIwMjQtMDQtMjAiLCBkZXNrdG9wOiA4OSwgbW9iaWxlOiAxNTAgfSwKICB7IGRhdGU6ICIyMDI0LTA0LTIxIiwgZGVza3RvcDogMTM3LCBtb2JpbGU6IDIwMCB9LAogIHsgZGF0ZTogIjIwMjQtMDQtMjIiLCBkZXNrdG9wOiAyMjQsIG1vYmlsZTogMTcwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNC0yMyIsIGRlc2t0b3A6IDEzOCwgbW9iaWxlOiAyMzAgfSwKICB7IGRhdGU6ICIyMDI0LTA0LTI0IiwgZGVza3RvcDogMzg3LCBtb2JpbGU6IDI5MCB9LAogIHsgZGF0ZTogIjIwMjQtMDQtMjUiLCBkZXNrdG9wOiAyMTUsIG1vYmlsZTogMjUwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNC0yNiIsIGRlc2t0b3A6IDc1LCBtb2JpbGU6IDEzMCB9LAogIHsgZGF0ZTogIjIwMjQtMDQtMjciLCBkZXNrdG9wOiAzODMsIG1vYmlsZTogNDIwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNC0yOCIsIGRlc2t0b3A6IDEyMiwgbW9iaWxlOiAxODAgfSwKICB7IGRhdGU6ICIyMDI0LTA0LTI5IiwgZGVza3RvcDogMzE1LCBtb2JpbGU6IDI0MCB9LAogIHsgZGF0ZTogIjIwMjQtMDQtMzAiLCBkZXNrdG9wOiA0NTQsIG1vYmlsZTogMzgwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNS0wMSIsIGRlc2t0b3A6IDE2NSwgbW9iaWxlOiAyMjAgfSwKICB7IGRhdGU6ICIyMDI0LTA1LTAyIiwgZGVza3RvcDogMjkzLCBtb2JpbGU6IDMxMCB9LAogIHsgZGF0ZTogIjIwMjQtMDUtMDMiLCBkZXNrdG9wOiAyNDcsIG1vYmlsZTogMTkwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNS0wNCIsIGRlc2t0b3A6IDM4NSwgbW9iaWxlOiA0MjAgfSwKICB7IGRhdGU6ICIyMDI0LTA1LTA1IiwgZGVza3RvcDogNDgxLCBtb2JpbGU6IDM5MCB9LAogIHsgZGF0ZTogIjIwMjQtMDUtMDYiLCBkZXNrdG9wOiA0OTgsIG1vYmlsZTogNTIwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNS0wNyIsIGRlc2t0b3A6IDM4OCwgbW9iaWxlOiAzMDAgfSwKICB7IGRhdGU6ICIyMDI0LTA1LTA4IiwgZGVza3RvcDogMTQ5LCBtb2JpbGU6IDIxMCB9LAogIHsgZGF0ZTogIjIwMjQtMDUtMDkiLCBkZXNrdG9wOiAyMjcsIG1vYmlsZTogMTgwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNS0xMCIsIGRlc2t0b3A6IDI5MywgbW9iaWxlOiAzMzAgfSwKICB7IGRhdGU6ICIyMDI0LTA1LTExIiwgZGVza3RvcDogMzM1LCBtb2JpbGU6IDI3MCB9LAogIHsgZGF0ZTogIjIwMjQtMDUtMTIiLCBkZXNrdG9wOiAxOTcsIG1vYmlsZTogMjQwIH0sCiAgeyBkYXRlOiAiMjAyNC0wNS0xMyIsIGRlc2t0b3A6IDE5NywgbW9iaWxlOiAxNjAgfSwKICB7IGRhdGU6ICIyMDI0LTA1LTE0IiwgZGVza3RvcDogNDQ4LCBtb2JpbGU6IDQ5MCB9LAogIHsgZGF0ZTogIjIwMjQtMDUtMTUiLCBkZXNrdG9wOiA0NzMsIG1OYW1lcygic2hyaW5rLTAiKX0+e0NUQX08L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgPC9oZWFkZXI+CiAgICAgIDxTdXNwZW5zZSBmYWxsYmFjaz17PEljb24gbmFtZT0ibG9hZGVyIiBjbGFzc05hbWU9Im14LWF1dG8gbXktNSBhbmltYXRlLXNwaW4iIC8+fT57Y2hpbGRyZW59PC9TdXNwZW5zZT4KICAgIDwvZGl2PgogICk7Cn0KCmV4cG9ydCBjb25zdCBDb25mZXJlbmNpbmdBcHBzVmlld1BsYXRmb3JtV3JhcHBlciA9ICh7CiAgZGlzYWJsZVRvYXN0cyA9IGZhbHNlLAogIHJldHVyblRvLAogIG9uRXJyb3JSZXR1cm5UbywKICB0ZWFtSWQsCiAgYXBwcywKICBkaXNhYmxlQnVsa1VwZGF0ZUV2ZW50VHlwZXMgPSBmYWxzZSwKICBjdXN0b21DbGFzc05hbWVzLAp9OiBDb25mZXJlbmNpbmdBcHBzVmlld1BsYXRmb3JtV3JhcHBlclByb3BzKSA9PiB7CiAgY29uc3QgeyB0IH0gPSB1c2VMb2NhbGUoKTsKICBjb25zdCBxdWVyeUNsaWVudCA9IHVzZVF1ZXJ5Q2xpZW50KCk7CiAgY29uc3QgeyB0b2FzdCB9ID0gdXNlVG9hc3QoKTsKCiAgY29uc3Qgc2hvd1RvYXN0ID0gKG1lc3NhZ2U6IHN0cmluZywgdmFyaWFudDogInN1Y2Nlc3MiIHwgIndhcm5pbmciIHwgImVycm9yIikgPT4gewogICAgaWYgKCFkaXNhYmxlVG9hc3RzKSB7CiAgICAgIHRvYXN0KHsgZGVzY3JpcHRpb246IG1lc3NhZ2UgfSk7CiAgICB9CiAgfTsKCiAgY29uc3QgW21vZGFsLCB1cGRhdGVNb2RhbF0gPSB1c2VSZWR1Y2VyKAogICAgKGRhdGE6IE1vZGFsU3RhdGUsIHBhcnRpYWxEYXRhOiBQYXJ0aWFsPE1vZGFsU3RhdGU+KSA9PiAoeyAuLi5kYXRhLCAuLi5wYXJ0aWFsRGF0YSB9KSwKICAgIHsKICAgICAgaXNPcGVuOiBmYWxzZSwKICAgICAgY3JlZGVudGlhbElkOiBudWxsLAogICAgICBhcHA6IG51bGwsCiAgICB9CiAgKTsKCiAgY29uc3QgW2lzQWNjb3VudE1vZGFsT3Blbiwgc2V0SXNBY2NvdW50TW9kYWxPcGVuXSA9IHVzZVN0YXRlKGZhbHNlKTsKCiAgY29uc3QgaGFuZGxlTW9kZWxDbG9zZSA9ICgpID0+IHsKICAgIHVwZGF0ZU1vZGFsKHsgaXNPcGVuOiBmYWxzZSwgY3JlZGVudGlhbElkOiBudWxsLCBhcHA6IG51bGwgfSk7CiAgfTsKCiAgY29uc3QgaGFuZGxlRGlzY29ubmVjdCA9IChjcmVkZW50aWFsSWQ6IG51bWJlciwgYXBwOiBBcHBbInNsdWciXSkgPT4gewogICAgdXBkYXRlTW9kYWwoeyBpc09wZW46IHRydWUsIGNyZWRlbnRpYWxJZCwgYXBwIH0pOwogIH07CgogIGNvbnN0IGluc3RhbGxlZEludGVncmF0aW9uc1F1ZXJ5ID0gdXNlQXRvbXNHZXRJbnN0YWxsZWRDb25mZXJlbmNpbmdBcHBzKHRlYW1JZCk7CiAgY29uc3QgeyBkYXRhOiBkZWZhdWx0Q29uZmVyZW5jaW5nQXBwIH0gPSB1c2VHZXREZWZhdWx0Q29uZmVyZW5jaW5nQXBwKHRlYW1JZCk7CiAgY29uc3QgeyBkYXRhOiBldmVudFR5cGVzUXVlcnksIGlzRmV0Y2hpbmc6IGlzRXZlbnRUeXBlc0ZldGNoaW5nIH0gPSB1c2VBdG9tR2V0RXZlbnRUeXBlcygKICAgIHRlYW1JZCwKICAgIGRpc2FibGVCdWxrVXBkYXRlRXZlbnRUeXBlcwogICk7CgogIGNvbnN0IGRlbGV0ZUNyZWRlbnRpYWxNdXRhdGlvbiA9IHVzZURlbGV0ZUNyZWRlbnRpYWwoewogICAgb25TdWNjZXNzOiAoKSA9PiB7CiAgICAgIHNob3dUb2FzdCh0KCJhcHBfcmVtb3ZlZF9zdWNjZXNzZnVsbHkiKSwgInN1Y2Nlc3MiKTsKICAgICAgaGFuZGxlTW9kZWxDbG9zZSgpOwogICAgICBxdWVyeUNsaWVudC5pbnZhbGlkYXRlUXVlcmllcyh7CiAgICAgICAgcXVlcnlLZXk6IFthdG9tc0NvbmZlcmVuY2luZ0FwcHNRdWVyeUtleV0sCiAgICAgIH0pOwogICAgICBxdWVyeUNsaWVudC5yZXNldFF1ZXJpZXMoewogICAgICAgIHF1ZXJ5S2V5OiBbZGVmYXVsdENvbmZlcmVuY2luZ0FwcFF1ZXJ5S2V5XSwKICAgICAgfSk7CiAgICB9LAogICAgb25FcnJvcjogKCkgPT4gewogICAgICBzaG93VG9hc3QodCgiZXJyb3JfcmVtb3ZpbmdfYXBwIiksICJlcnJvciIpOwogc2luZyBwYXNzd29yZAogICAgYXN5bmMgZnVuY3Rpb24gY2hlY2tDb3JyZWN0UGFzc3dvcmQoKTogUHJvbWlzZTx2b2lkPiB7CiAgICAgIHRyeSB7CiAgICAgICAgc2V0SXNMb2FkaW5nKHRydWUpCiAgICAgICAgYXdhaXQgcmVzdG9yZU1uZW1vbmljRnJvbUNsb3VkU3RvcmFnZShwYXJhbXMubW5lbW9uaWNJZCwgZW50ZXJlZFBhc3N3b3JkKQogICAgICAgIGF3YWl0IGdlbmVyYXRlSW1wb3J0ZWRBY2NvdW50cyh7IG1uZW1vbmljSWQ6IHBhcmFtcy5tbmVtb25pY0lkLCBiYWNrdXBUeXBlOiBCYWNrdXBUeXBlLkNsb3VkIH0pCgogICAgICAgIGRpc3BhdGNoKHJlc2V0UGFzc3dvcmRBdHRlbXB0cygpKQogICAgICAgIHNldElzTG9hZGluZyhmYWxzZSkKICAgICAgICBvblJlc3RvcmVDb21wbGV0ZSh7CiAgICAgICAgICBpc1Jlc3RvcmluZ01uZW1vbmljLAogICAgICAgICAgZGlzcGF0Y2gsCiAgICAgICAgICBwYXJhbXMsCiAgICAgICAgICBuYXZpZ2F0aW9uLAogICAgICAgICAgc2NyZWVuOiBPbmJvYXJkaW5nU2NyZWVucy5SZXN0b3JlQ2xvdWRCYWNrdXBQYXNzd29yZCwKICAgICAgICB9KQogICAgICB9IGNhdGNoIHsKICAgICAgICBzZXRJc0xvYWRpbmcoZmFsc2UpCiAgICAgICAgZGlzcGF0Y2goaW5jcmVtZW50UGFzc3dvcmRBdHRlbXB0cygpKQogICAgICAgIGNvbnN0IHVwZGF0ZWRMb2Nrb3V0RW5kVGltZSA9IGNhbGN1bGF0ZUxvY2tvdXRFbmRUaW1lKHBhc3N3b3JkQXR0ZW1wdENvdW50ICsgMSkKICAgICAgICBpZiAodXBkYXRlZExvY2tvdXRFbmRUaW1lKSB7CiAgICAgICAgICBkaXNwYXRjaChzZXRMb2Nrb3V0RW5kVGltZSh7IGxvY2tvdXRFbmRUaW1lOiB1cGRhdGVkTG9ja291dEVuZFRpbWUgfSkpCiAgICAgICAgfSBlbHNlIHsKICAgICAgICAgIHNldEVycm9yTWVzc2FnZSh0KCdhY2NvdW50LmNsb3VkLmVycm9yLnBhc3N3b3JkLnRpdGxlJykpCiAgICAgICAgICBpbnB1dFJlZi5jdXJyZW50Py5mb2N1cygpCiAgICAgICAgfQogICAgICB9CiAgICB9CgogICAgYXdhaXQgY2hlY2tDb3JyZWN0UGFzc3dvcmQoKQogICAgc2V0RW50ZXJlZFBhc3N3b3JkKCcnKQogICAgZGlzbWlzc05hdGl2ZUtleWJvYXJkKCkKICB9CgogIGNvbnN0IG5hdmlnYXRlVG9FbnRlclJlY292ZXJ5UGhyYXNlID0gKCk6IHZvaWQgPT4gewogICAgbmF2aWdhdGlvbi5yZXBsYWNlKE9uYm9hcmRpbmdTY3JlZW5zLlNlZWRQaHJhc2VJbnB1dCwgcGFyYW1zKQogIH0KCiAgcmV0dXJuICgKICAgIDxTYWZlS2V5Ym9hcmRPbmJvYXJkaW5nU2NyZWVuCiAgICAgIEljb249e0Nsb3VkfQogICAgICBzdWJ0aXRsZT17dCgnYWNjb3VudC5jbG91ZC5wYXNzd29yZC5zdWJ0aXRsZScsIHsgY2xvdWRQcm92aWRlck5hbWU6IGdldENsb3VkUHJvdmlkZXJOYW1lKCkgfSl9CiAgICAgIHRpdGxlPXt0KCdhY2NvdW50LmNsb3VkLnBhc3N3b3JkLnRpdGxlJyl9CiAgICAgIGZvb3Rlcj17CiAgICAgICAgPEZsZXggcm93PgogICAgICAgICAgPEJ1dHRvbgogICAgICAgICAgICBpc0Rpc2FibGVkPXshZW50ZXJlZFBhc3N3b3JkIHx8IGlzTG9ja2VkT3V0IHx8IGlzTG9hZGluZ30KICAgICAgICAgICAgdGVzdElEPXtUZXN0SUQuQ29udGludWV9CiAgICAgICAgICAgIHZhcmlhbnQ9ImJyYW5kZWQiCiAgICAgICAgICAgIHNpemU9ImxhcmdlIgogICAgICAgICAgICBteT0iJHNwYWNpbmcxMiIKICAgICAgICAgICAgbXg9IiRzcGFjaW5nMTYiCiAgICAgICAgICAgIG9uUHJlc3M9e29uUGFzc3dvcmRTdWJtaXR9CiAgICAgICAgICA+CiAgICAgICAgICAgIHt0KCdjb21tb24uYnV0dG9uLmNvbnRpbnVlJyl9CiAgICAgICAgICA8L0J1dHRvbj4KICAgICAgICA8L0ZsZXg+CiAgICAgIH0KICAgID4KICAgICAgPEZsZXg+CiAgICAgICAgPFBhc3N3b3JkSW5wdXQKICAgICAgICAgIHJlZj17aW5wdXRSZWZ9CiAgICAgICAgICBhdXRvRm9jdXM9eyFpc0xvY2tlZE91dH0KICAgICAgICAgIGVkaXRhYmxlPXshaXNhYXZlL21hdGgtdXRpbHMnOwppbXBvcnQgeyBTeFByb3BzIH0gZnJvbSAnQG11aS9tYXRlcmlhbCc7CmltcG9ydCB7IERpc3BhdGNoLCB1c2VFZmZlY3QgfSBmcm9tICdyZWFjdCc7CgppbXBvcnQgewogIEFjdGlvbnNCbG9ja2VkUmVhc29uLAogIFByb3RvY29sU3dhcFN0YXRlLAogIFN3YXBFcnJvciwKICBTd2FwU3RhdGUsCiAgU3dhcFR5cGUsCn0gZnJvbSAnLi4vLi4vdHlwZXMnOwppbXBvcnQgeyBpc1Byb3RvY29sU3dhcFN0YXRlIH0gZnJvbSAnLi4vLi4vdHlwZXMvc3RhdGUudHlwZXMnOwppbXBvcnQgeyBTdXBwbHlDYXBCbG9ja2luZ0Vycm9yIH0gZnJvbSAnLi9TdXBwbHlDYXBCbG9ja2luZ0Vycm9yJzsKCmV4cG9ydCBjb25zdCBoYXNTdXBwbHlDYXBCbG9ja2luZyA9IChzdGF0ZTogU3dhcFN0YXRlKSA9PiB7CiAgaWYgKCFpc1Byb3RvY29sU3dhcFN0YXRlKHN0YXRlKSB8fCBzdGF0ZS5zd2FwVHlwZSAhPT0gU3dhcFR5cGUuQ29sbGF0ZXJhbFN3YXApIHJldHVybiBmYWxzZTsKICBjb25zdCByZXNlcnZlID0gc3RhdGUuaXNJbnZlcnRlZFN3YXAKICAgID8gc3RhdGUuc291cmNlUmVzZXJ2ZT8ucmVzZXJ2ZQogICAgOiBzdGF0ZS5kZXN0aW5hdGlvblJlc2VydmU/LnJlc2VydmU7CiAgY29uc3QgYnV5QW1vdW50ID0gc3RhdGUuYnV5QW1vdW50Rm9ybWF0dGVkOwogIGlmICghcmVzZXJ2ZSB8fCAhYnV5QW1vdW50KSByZXR1cm4gZmFsc2U7CgogIGlmIChyZXNlcnZlLnN1cHBseUNhcCA9PT0gJzAnKSByZXR1cm4gZmFsc2U7CgogIGNvbnN0IHJlbWFpbmluZ0NhcCA9IHZhbHVlVG9CaWdOdW1iZXIocmVzZXJ2ZS5zdXBwbHlDYXApLm1pbnVzKAogICAgdmFsdWVUb0JpZ051bWJlcihyZXNlcnZlLnRvdGFsTGlxdWlkaXR5KQogICk7CgogIC8vIElmIHJlbWFpbmluZyBjYXAgaXMgZXhoYXVzdGVkIG9yIHRoZSBpbnRlbmRlZCBidXkgZXhjZWVkcyByZW1haW5pbmcsIGJsb2NrCiAgcmV0dXJuIHJlbWFpbmluZ0NhcC5sdGUoMCkgfHwgdmFsdWVUb0JpZ051bWJlcihidXlBbW91bnQpLmd0KHJlbWFpbmluZ0NhcCk7Cn07CgpleHBvcnQgY29uc3QgU3VwcGx5Q2FwQmxvY2tpbmdHdWFyZCA9ICh7CiAgc3RhdGUsCiAgc2V0U3RhdGUsCiAgc3gsCiAgaXNTd2FwRmxvd1NlbGVjdGVkLAp9OiB7CiAgc3RhdGU6IFByb3RvY29sU3dhcFN0YXRlOwogIHNldFN0YXRlOiBEaXNwYXRjaDxQYXJ0aWFsPFN3YXBTdGF0ZT4+OwogIHN4PzogU3hQcm9wczsKICBpc1N3YXBGbG93U2VsZWN0ZWQ6IGJvb2xlYW47Cn0pID0+IHsKICB1c2VFZmZlY3QoKCkgPT4gewogICAgY29uc3QgaXNCbG9ja2luZyA9IGhhc1N1cHBseUNhcEJsb2NraW5nKHN0YXRlKTsKCiAgICBpZiAoaXNCbG9ja2luZykgewogICAgICBjb25zdCBpc0FscmVhZHlCbG9ja2luZ0Vycm9yID0KICAgICAgICBzdGF0ZS5lcnJvcj8ucmF3RXJyb3IgaW5zdGFuY2VvZiBFcnJvciAmJgogICAgICAgIHN0YXRlLmVycm9yLnJhd0Vycm9yLm1lc3NhZ2UgPT09ICdTdXBwbHlDYXBCbG9ja2luZ0Vycm9yJzsKCiAgICAgIGlmICghaXNBbHJlYWR5QmxvY2tpbmdFcnJvcikgewogICAgICAgIGNvbnN0IGJsb2NraW5nRXJyb3I6IFN3YXBFcnJvciA9IHsKICAgICAgICAgIHJhd0Vycm9yOiBuZXcgRXJyb3IoJ1N1cHBseUNhcEJsb2NraW5nRXJyb3InKSwKICAgICAgICAgIG1lc3NhZ2U6ICdTdXBwbHkgY2FwIHJlYWNoZWQgZm9yIHRhcmdldCBhc3NldC4nLAogICAgICAgICAgYWN0aW9uQmxvY2tlZDogdHJ1ZSwKICAgICAgICB9OwogICAgICAgIHNldFN0YXRlKHsKICAgICAgICAgIGVycm9yOiBibG9ja2luZ0Vycm9yLAogICAgICAgICAgYWN0aW9uc0Jsb2NrZWQ6IHsKICAgICAgICAgICAgW0FjdGlvbnNCbG9ja2VkUmVhc29uLlNVUFBMWV9DQVBfQkxPQ0tJTkddOiB0cnVrLkhlYWRlci5NZW51PgogICAgICAgICAgPC9TdGFjay5IZWFkZXIuTWVudT4KCiAgICAgICAgICB7LyogUHJvZmlsZSBCdXR0b24gLSBPcGVucyBib3R0b20gc2hlZXQgKi99CiAgICAgICAgICB7dXNlclByb2ZpbGU/LmF2YXRhclVybCA/ICgKICAgICAgICAgICAgPFN0YWNrLkhlYWRlci5WaWV3PgogICAgICAgICAgICAgIDxQcmVzc2FibGUgb25QcmVzcz17KCkgPT4gcm91dGVyLnB1c2goIi9wcm9maWxlLXNoZWV0Iil9PgogICAgICAgICAgICAgICAgPEltYWdlCiAgICAgICAgICAgICAgICAgIHNvdXJjZT17eyB1cmk6IGdldEF2YXRhclVybCh1c2VyUHJvZmlsZS5hdmF0YXJVcmwpIH19CiAgICAgICAgICAgICAgICAgIHN0eWxlPXt7IHdpZHRoOiAzMiwgaGVpZ2h0OiAzMiwgYm9yZGVyUmFkaXVzOiAxNiB9fQogICAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICA8L1ByZXNzYWJsZT4KICAgICAgICAgICAgPC9TdGFjay5IZWFkZXIuVmlldz4KICAgICAgICAgICkgOiAoCiAgICAgICAgICAgIDxTdGFjay5IZWFkZXIuQnV0dG9uIG9uUHJlc3M9eygpID0+IHJvdXRlci5wdXNoKCIvcHJvZmlsZS1zaGVldCIpfT4KICAgICAgICAgICAgICA8U3RhY2suSGVhZGVyLkljb24gc2Y9InBlcnNvbi5jaXJjbGUuZmlsbCIgLz4KICAgICAgICAgICAgPC9TdGFjay5IZWFkZXIuQnV0dG9uPgogICAgICAgICAgKX0KICAgICAgICA8L1N0YWNrLkhlYWRlci5SaWdodD4KCiAgICAgICAgey8qIFNlYXJjaCBCYXIgKi99CiAgICAgICAgPFN0YWNrLkhlYWRlci5TZWFyY2hCYXIKICAgICAgICAgIHBsYWNlaG9sZGVyPSJTZWFyY2ggZXZlbnQgdHlwZXMiCiAgICAgICAgICBvbkNoYW5nZVRleHQ9eyhlKSA9PiBoYW5kbGVTZWFyY2goZS5uYXRpdmVFdmVudC50ZXh0KX0KICAgICAgICAgIG9ic2N1cmVCYWNrZ3JvdW5kPXtmYWxzZX0KICAgICAgICAgIGJhclRpbnRDb2xvcj17aXNEYXJrID8gIiMxNzE3MTciIDogIiNmZmYifQogICAgICAgIC8+CiAgICAgIDwvU3RhY2suSGVhZGVyPgoKICAgICAgey8qIEV2ZW50IFR5cGVzIExpc3QgKi99CiAgICAgIDxTY3JvbGxWaWV3CiAgICAgICAgc3R5bGU9e3sgYmFja2dyb3VuZENvbG9yOiB0aGVtZS5iYWNrZ3JvdW5kIH19CiAgICAgICAgY29udGVudENvbnRhaW5lclN0eWxlPXt7IHBhZGRpbmdCb3R0b206IDEyMCB9fQogICAgICAgIHJlZnJlc2hDb250cm9sPXs8UmVmcmVzaENvbnRyb2wgcmVmcmVzaGluZz17ZmFsc2V9IG9uUmVmcmVzaD17b25SZWZyZXNofSAvPn0KICAgICAgICBzaG93c1ZlcnRpY2FsU2Nyb2xsSW5kaWNhdG9yPXtmYWxzZX0KICAgICAgICBjb250ZW50SW5zZXRBZGp1c3RtZW50QmVoYXZpb3I9ImF1dG9tYXRpYyIKICAgICAgPgogICAgICAgIHtyZWZyZXNoaW5nID8gKAogICAgICAgICAgPEV2ZW50VHlwZUxpc3RTa2VsZXRvbiAvPgogICAgICAgICkgOiBmaWx0ZXJlZEV2ZW50VHlwZXMubGVuZ3RoID09PSAwICYmIHNlYXJjaFF1ZXJ5LnRyaW0oKSAhPT0gIiIgPyAoCiAgICAgICAgICA8VmlldwogICAgICAgICAgICBjbGFzc05hbWU9ImZsZXgtMSBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgYmctZ3JheS01MCBwLTUgcHQtMjAiCiAgICAgICAgICAgIHN0eWxlPXt7IGJhY2tncm91bmRDb2xvcjogdGhlbWUuYmFja2dyb3VuZFNlY29uZGFyeSB9fQogICAgICAgICAgPgogICAgICAgICAgICA8RW1wdHlTY3JlZW4KICAgICAgICAgICAgICBpY29uPSJzZWFyY2gtb3V0bGluZSIKICAgICAgICAgICAgICBoZWFkbGluZT17YE5vIHJlc3VsdHMgZm91bmQgZm9yICIke3NlYXJjaFF1ZXJ5fSJgfQogICAgICAgICAgICAgIGRlc2NyaXB0aW9uPSJUcnkgc2VhcmNoaW5nIHdpdGggZGlmZmVyZW50IGtleXdvcmRzIgogICAgICAgICAgICAvPgogICAgICAgICAgPC9WaWV3PgogICAgICAgICkgOiBmaWx0ZXJlZEV2ZW50VHlwZXMubGVuZ3RoID09PSAwICYmIGFjdGl2ZUZpbHRlckNvdW50ID4gMCA/ICgKKDMwKTsKCiAgLy8gRGVyaXZlIHBheW1lbnQgZmFpbGVkIHN0YXR1cyBmcm9tIHBheW1lbnQgc3RhdHVzCiAgY29uc3QgaGFzUGF5bWVudEZhaWxlZCA9IHBheW1lbnRTdGF0dXMgIT09IHVuZGVmaW5lZCAmJiBwYXltZW50U3RhdHVzICE9PSAicGFpZCI7CiAgY29uc3QgaXNQcmVtaXVtVXNlcm5hbWUgPSAhIXBheW1lbnRTdGF0dXM7IC8vIElmIHBheW1lbnRTdGF0dXMgZXhpc3RzLCBpdCdzIGZyb20gcHJlbWl1bSB1c2VybmFtZSBmbG93CgogIC8vIE9ubHkgc2VuZCB2ZXJpZmljYXRpb24gbG9naW4gaWYgd2UgRE9OJ1QgaGF2ZSB0aGUgZW1haWwgeWV0IChmb3IgcmVzZW5kIGJ1dHRvbikKICAvLyBUaGUgZW1haWwgaXMgYWxyZWFkeSBzZW50IHNlcnZlci1zaWRlIGluIHBheW1lbnRDYWxsYmFjawogIHVzZVNlbmRGaXJzdFZlcmlmaWNhdGlvbkxvZ2luKHsKICAgIGVtYWlsOiAhaXNQcmVtaXVtVXNlcm5hbWUgPyBlbWFpbCA6IHVuZGVmaW5lZCwKICAgIHVzZXJuYW1lOiAhaXNQcmVtaXVtVXNlcm5hbWUgPyB1c2VybmFtZSA6IHVuZGVmaW5lZCwKICB9KTsKICAvLyBAbm90ZTogY2hlY2sgZm9yIHQ9dGltZXN0YW1wIGFuZCBhcHBseSBkaXNhYmxlZCBzdGF0ZSBhbmQgc2Vjb25kc0xlZnQgYWNjb3JkaW5nbHkKICAvLyB0byBhdm9pZCByZWZyZXNoIHRvIHNraXAgd2FpdGluZyAzMCBzZWNvbmRzIHRvIHJlLXNlbmQgZW1haWwKICB1c2VFZmZlY3QoKCkgPT4gewogICAgY29uc3QgbGFzdFNlbnQgPSBuZXcgRGF0ZShwYXJzZUludChgJHt0fWApKTsKICAgIC8vIEBub3RlOiBUaGlzIGRvdWJsZSByb3VuZCgpIGxvb2tzIHVnbHkgYnV0IGl0J3MgdGhlIG9ubHkgd2F5IEkgY2FtZSB1cCB0byBnZXQgdGhlIHRpbWUgZGlmZmVyZW5jZSBpbiBzZWNvbmRzCiAgICBjb25zdCBkaWZmZXJlbmNlID0gTWF0aC5yb3VuZChNYXRoLnJvdW5kKG5ldyBEYXRlKCkuZ2V0VGltZSgpIC0gbGFzdFNlbnQuZ2V0VGltZSgpKSAvIDEwMDApOwogICAgaWYgKGRpZmZlcmVuY2UgPCAzMCkgewogICAgICAvLyBJZiBsZXNzIHRoYW4gMzAgc2Vjb25kcywgc2V0IHRoZSBzZWNvbmRzIGxlZnQgdG8gMzAgLSBkaWZmZXJlbmNlCiAgICAgIHNldFNlY29uZHNMZWZ0KDMwIC0gZGlmZmVyZW5jZSk7CiAgICB9IGVsc2UgewogICAgICAvLyBlbHNlIHNldCB0aGUgc2Vjb25kcyBsZWZ0IHRvIDAgYW5kIGRpc2FibGVkIGZhbHNlCiAgICAgIHNldFNlY29uZHNMZWZ0KDApOwogICAgfQogIH0sIFt0XSk7CiAgLy8gQG5vdGU6IGhlcmUgd2UgbWFrZSBzdXJlIGVhY2ggc2Vjb25kIGlzIGRlY3JlbWVudGVkIGlmIGRpc2FibGVkIHVwIHRvIDAuCiAgdXNlRWZmZWN0KCgpID0+IHsKICAgIGlmIChzZWNvbmRzTGVmdCA+IDApIHsKICAgICAgY29uc3QgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7CiAgICAgICAgaWYgKHNlY29uZHNMZWZ0ID4gMCkgewogICAgICAgICAgc2V0U2Vjb25kc0xlZnQoc2Vjb25kc0xlZnQgLSAxKTsKICAgICAgICB9CiAgICAgIH0sIDEwMDApOwogICAgICByZXR1cm4gKCkgPT4gY2xlYXJJbnRlcnZhbChpbnRlcnZhbCk7CiAgICB9CiAgfSwgW3NlY29uZHNMZWZ0XSk7CgogIGlmICghZW1haWwpIHsKICAgIHJldHVybiA8ZGl2Pnt0KCJpbnZhbGlkX2xpbmsiKX08L2Rpdj47CiAgfQoKICByZXR1cm4gKAogICAgPGRpdiBjbGFzc05hbWU9InRleHQtZGVmYXVsdCBiZy1jYWwtbXV0ZWQvOTAgYmFja2Ryb3AtYmx1ci1tZCBiYWNrZHJvcC1ncmF5c2NhbGUgYmFja2Ryb3AtZmlsdGVyIj4KICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggbWluLWgtc2NyZWVuIGZsZXgtY29sIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBweC02Ij4KICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iYm9yZGVyLXN1YnRsZSBiZy1kZWZhdWx0IG0tMTAgZmxleCBtYXgtdy0yeGwgZmxleC1jb2wgaXRlbXMtY2VudGVyIHJvdW5kZWQteGwgYm9yZGVyIHB4LTggcHktMTQgdGV4dC1sZWZ0Ij4KIGJqZWN0OiAiTWVldGluZyBUb21vcnJvdyIsCiAgICAgIGRhdGU6ICIwOTozNCBBTSIsCiAgICAgIHRlYXNlcjoKICAgICAgICAiSGkgdGVhbSwganVzdCBhIHJlbWluZGVyIGFib3V0IG91ciBtZWV0aW5nIHRvbW9ycm93IGF0IDEwIEFNLlxuUGxlYXNlIGNvbWUgcHJlcGFyZWQgd2l0aCB5b3VyIHByb2plY3QgdXBkYXRlcy4iLAogICAgfSwKICAgIHsKICAgICAgbmFtZTogIkFsaWNlIFNtaXRoIiwKICAgICAgZW1haWw6ICJhbGljZXNtaXRoQGV4YW1wbGUuY29tIiwKICAgICAgc3ViamVjdDogIlJlOiBQcm9qZWN0IFVwZGF0ZSIsCiAgICAgIGRhdGU6ICJZZXN0ZXJkYXkiLAogICAgICB0ZWFzZXI6CiAgICAgICAgIlRoYW5rcyBmb3IgdGhlIHVwZGF0ZS4gVGhlIHByb2dyZXNzIGxvb2tzIGdyZWF0IHNvIGZhci5cbkxldCdzIHNjaGVkdWxlIGEgY2FsbCB0byBkaXNjdXNzIHRoZSBuZXh0IHN0ZXBzLiIsCiAgICB9LAogICAgewogICAgICBuYW1lOiAiQm9iIEpvaG5zb24iLAogICAgICBlbWFpbDogImJvYmpvaG5zb25AZXhhbXBsZS5jb20iLAogICAgICBzdWJqZWN0OiAiV2Vla2VuZCBQbGFucyIsCiAgICAgIGRhdGU6ICIyIGRheXMgYWdvIiwKICAgICAgdGVhc2VyOgogICAgICAgICJIZXkgZXZlcnlvbmUhIEknbSB0aGlua2luZyBvZiBvcmdhbml6aW5nIGEgdGVhbSBvdXRpbmcgdGhpcyB3ZWVrZW5kLlxuV291bGQgeW91IGJlIGludGVyZXN0ZWQgaW4gYSBoaWtpbmcgdHJpcCBvciBhIGJlYWNoIGRheT8iLAogICAgfSwKICAgIHsKICAgICAgbmFtZTogIkVtaWx5IERhdmlzIiwKICAgICAgZW1haWw6ICJlbWlseWRhdmlzQGV4YW1wbGUuY29tIiwKICAgICAgc3ViamVjdDogIlJlOiBRdWVzdGlvbiBhYm91dCBCdWRnZXQiLAogICAgICBkYXRlOiAiMiBkYXlzIGFnbyIsCiAgICAgIHRlYXNlcjoKICAgICAgICAiSSd2ZSByZXZpZXdlZCB0aGUgYnVkZ2V0IG51bWJlcnMgeW91IHNlbnQgb3Zlci5cbkNhbiB3ZSBzZXQgdXAgYSBxdWljayBjYWxsIHRvIGRpc2N1c3Mgc29tZSBwb3RlbnRpYWwgYWRqdXN0bWVudHM/IiwKICAgIH0sCiAgICB7CiAgICAgIG5hbWU6ICJNaWNoYWVsIFdpbHNvbiIsCiAgICAgIGVtYWlsOiAibWljaGFlbHdpbHNvbkBleGFtcGxlLmNvbSIsCiAgICAgIHN1YmplY3Q6ICJJbXBvcnRhbnQgQW5ub3VuY2VtZW50IiwKICAgICAgZGF0ZTogIjEgd2VlayBhZ28iLAogICAgICB0ZWFzZXI6CiAgICAgICAgIlBsZWFzZSBqb2luIHVzIGZvciBhbiBhbGwtaGFuZHMgbWVldGluZyB0aGlzIEZyaWRheSBhdCAzIFBNLlxuV2UgaGF2ZSBzb21lIGV4Y2l0aW5nIG5ld3MgdG8gc2hhcmUgYWJvdXQgdGhlIGNvbXBhbnkncyBmdXR1cmUuIiwKICAgIH0sCiAgICB7CiAgICAgIG5hbWU6ICJTYXJhaCBCcm93biIsCiAgICAgIGVtYWlsOiAic2FyYWhicm93bkBleGFtcGxlLmNvbSIsCiAgICAgIHN1YmplY3Q6ICJSZTogRmVlZGJhY2sgb24gUHJvcG9zYWwiLAogICAgICBkYXRlOiAiMSB3ZWVrIGFnbyIsCiAgICAgIHRlYXNlcjoKICAgICAgICAiVGhhbmsgeW91IGZvciBzZW5kaW5nIG92ZXIgdGhlIHByb3Bvc2FsLiBJJ3ZlIHJldmlld2VkIGl0IGFuZCBoYXZlIHNvbWUgdGhvdWdodHMuXG5Db3VsZCB3ZSBzY2hlZHVsZSBhIG1lZXRpbmcgdG8gZGlzY3VzcyBteSBmZWVkYmFjayBpbiBkZXRhaWw/IiwKICAgIH0sCiAgICB7CiAgICAgIG5hbWU6ICJEYXZpZCBMZWUiLAogICAgICBlbWFpbDogImRhdmlkbGVlQGV4YW1wbGUuY29tIiwKICAgICAgc3ViamVjdDogIk5ldyBQcm9qZWN0IElkZWEiLAogICAgICBkYXRlOiAiMSB3ZWVrIGFnbyIsCiAgICAgIHRlYXNlcjoKICAgICAgICAiSSd2ZSBiZWVuIGJyYWluc3Rvcm1pbmcgYW5kIGNhbWUgdXAgd2l0aCBhbiBpbnRlcmVzdGluZyBwcm9qZWN0IGNvbmNlcHQuXG5EbyB5b3UgaGF2ZSB0aW1lIHRoaXMgd2VlayB0byBkaXNjdXNzIGl0cyBwb3RlbnRpYWwgaW1wYWN0IGFuZCBmZWFzaWJpbGl0eT8iLAoxIDEyLjE1MjQgOC42NDMyNCAxMi4zMTY1IDguNDM3NDFMMTMuMjM0IDcuMjkxNThDMTMuNTUxNSA2Ljg5NDA4IDE0LjAyNTcgNi42NjY1OCAxNC41MzQ5IDYuNjY2NThIMTUuNDg5TDE1LjI0NDggNi45MTA3MkMxNC45MTkgNy4yMzY1NSAxNC45MTkgNy43NjMyNyAxNS4yNDQ4IDguMDg5MUMxNS40MDczIDguMjUxNiAxNS42MjA3IDguMzMzMjQgMTUuODM0IDguMzMzMjRDMTYuMDQ3MyA4LjMzMzI0IDE2LjI2MDcgOC4yNTE2IDE2LjQyMzIgOC4wODkxTDE4LjA4OSA2LjQyMzI1QzE4LjE2NjUgNi4zNDU3NSAxOC4yMjczIDYuMjU0MTQgMTguMjY5OCA2LjE1MTY0QzE4LjM1NCA1Ljk0ODMxIDE4LjM1NCA1LjcxODE4IDE4LjI2OTggNS41MTQ4NEMxOC4yMjczIDUuNDEyMzQgMTguMTY2NSA1LjMyMDc0IDE4LjA4OSA1LjI0MzI0TDE2LjQyMzIgMy41NzczOEMxNi4wOTczIDMuMjUxNTUgMTUuNTcwNiAzLjI1MTU1IDE1LjI0NDggMy41NzczOEMxNC45MTkgMy45MDMyMiAxNC45MTkgNC40Mjk5MyAxNS4yNDQ4IDQuNzU1NzdMMTUuNDg5IDQuOTk5OTFIMTQuNTM0OUMxMy41MTY1IDQuOTk5OTEgMTIuNTY5IDUuNDU1NzIgMTEuOTMzMSA2LjI1MDcyTDExLjAxNjUgNy4zOTU3NEMxMC43MjgxIDcuNzU0OTEgMTAuNzg3MyA4LjI3OTkxIDExLjE0NTcgOC41Njc0MUMxMS4yOTk4IDguNjg5OTEgMTEuNDgzMiA4Ljc0OTkxIDExLjY2NTcgOC43NDk5MVpNNy42ODMxNSAxMS41NjI0TDYuNzY1NjkgMTIuNzA4MkM2LjQ0ODE5IDEzLjEwNTcgNS45NzM5OSAxMy4zMzMyIDUuNDY0ODIgMTMuMzMzMkgyLjQ5OTg0QzIuMDM5IDEzLjMzMzIgMS42NjY1IDEzLjcwNjYgMS42NjY1IDE0LjE2NjZDMS42NjY1IDE0LjYyNjYgMi4wMzkgMTQuOTk5OSAyLjQ5OTg0IDE0Ljk5OTlINS40NjU2NEM2LjQ4Mzk3IDE0Ljk5OTkgNy40MzE1MyAxNC41NDQxIDguMDY3MzYgMTMuNzQ5MUw4Ljk4NDAxIDEyLjYwNDFDOS4yNzIzNCAxMi4yNDQ5IDkuMjEzMTUgMTEuNzE5OSA4Ljg1NDgyIDExLjQzMjRDOC40OTMxNSAxMS4xNDU3IDcuOTY5ODEgMTEuMjA0MSA3LjY4MzE1IDExLjU2MjRaIgogICAgICAgIGZpbGw9ImN1cnJlbnRDb2xvciIKICAgICAgICBzdHJva2U9ImN1cnJlbnRDb2xvciIKICAgICAgICBzdHJva2VXaWR0aD0iMC41IgogICAgICAvPgogICAgPC9Tdmc+CiAgKSwKICBkZWZhdWx0RmlsbDogJyM5QjlCOUInLAp9KQppbXBvcnQgeyB1c2VQb29sRGF0YSB9IGZyb20gJ2FwcEdyYXBocWwvZGF0YS9wb29scy91c2VQb29sRGF0YScKaW1wb3J0IFBvb2xEZXRhaWxzIGZyb20gJ3BhZ2VzL1Bvb2xEZXRhaWxzJwppbXBvcnQgUmVhY3QgZnJvbSAncmVhY3QnCmltcG9ydCB7IHVzZVBhcmFtcyB9IGZyb20gJ3JlYWN0LXJvdXRlcicKaW1wb3J0IHN0b3JlIGZyb20gJ3N0YXRlJwppbXBvcnQgeyBtb2NrZWQgfSBmcm9tICd0ZXN0LXV0aWxzL21vY2tlZCcKaW1wb3J0IHsgdmFsaWRQYXJhbXMsIHZhbGlkUG9vbERhdGFSZXNwb25zZSB9IGZyb20gJ3Rlc3QtdXRpbHMvcG9vbHMvZml4dHVyZXMnCmltcG9ydCB7IGFjdCwgcmVuZGVyLCB3YWl0Rm9yIH0gZnJvbSAndGVzdC11dGlscy9yZW5kZXInCmltcG9ydCB7IGRpc21pc3NUb2tlbldhcm5pbmcgfSBmcm9tICd1bmlzd2FwL3NyYy9mZWF0dXJlcy90b2tlbnMvd2FybmluZ3Mvc2xpY2Uvc2xpY2UnCmltcG9ydCB7IFRva2VuUHJvdGVjdGlvbldhcm5pbmcgfSBmcm9tICd1bmlzd2FwL3NyYy9mZWF0dXJlcy90b2tlbnMvd2FybmluZ3MvdHlwZXMnCgovLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgaW1wb3J0L25vLXVudXNlZC1tb2R1bGVzLCBqZXN0L25vLWV4cG9ydApleHBvcnQgY29uc3QgbW9ja05hdmlnYXRlID0gdmkuZm4oKQoKdmkubW9jaygncmVhY3Qtcm91dGVyJywgYXN5bmMgKCkgPT4gewogIGNvbnN0IGFjdHVhbCA9IGF3YWl0IHZpLmltcG9ydEFjdHVhbCgncmVhY3Qtcm91dGVyJykKICByZXR1cm4gewogICAgLi4uYWN0dWFsLAogbGxldCA9IGFzeW5jICgpOiBQcm9taXNlPHZvaWQ+ID0+IHsKICAgIG5hdmlnYXRlQmFjaygpCiAgICBhd2FpdCBkaXNwYXRjaChhdXRoQWN0aW9ucy50cmlnZ2VyKHsgdHlwZTogQXV0aEFjdGlvblR5cGUuTG9jayB9KSkKICB9CgogIC8vIFRPRE8oV0FMTC00OTA4KTogY29uc2lkZXIgd3JhcHBpbmcgaGFuZGxlcnMgaW4gdXNlQ2FsbGJhY2sKICBjb25zdCB7IGlzVGVzdG5ldE1vZGVFbmFibGVkIH0gPSB1c2VFbmFibGVkQ2hhaW5zKCkKICBjb25zdCBoYW5kbGVUZXN0bmV0TW9kZVRvZ2dsZSA9IGFzeW5jIChpc0NoZWNrZWQ6IGJvb2xlYW4pOiBQcm9taXNlPHZvaWQ+ID0+IHsKICAgIGNvbnN0IGZpcmVBbmFseXRpYyA9ICgpOiB2b2lkID0+IHsKICAgICAgc2VuZEFuYWx5dGljc0V2ZW50KFdhbGxldEV2ZW50TmFtZS5UZXN0bmV0TW9kZVRvZ2dsZWQsIHsKICAgICAgICBlbmFibGVkOiBpc0NoZWNrZWQsCiAgICAgICAgbG9jYXRpb246ICdzZXR0aW5ncycsCiAgICAgIH0pCiAgICB9CgogICAgLy8gdHJpZ2dlciBiZWZvcmUgdG9nZ2xpbmcgb24gKGllIGRpc2FibGluZyBhbmFseXRpY3MpCiAgICBpZiAoaXNDaGVja2VkKSB7CiAgICAgIC8vIGRvZXNuJ3QgZmlyZSBvbiB0aW1lIHdpdGhvdXQgYXdhaXQgYW5kIGkgaGF2ZSBubyBpZGVhIHdoeQogICAgICBhd2FpdCBmaXJlQW5hbHl0aWMoKQogICAgfQoKICAgIGRpc3BhdGNoKHNldElzVGVzdG5ldE1vZGVFbmFibGVkKGlzQ2hlY2tlZCkpCiAgICBzZXRJc1Rlc3RuZXRNb2RhbE9wZW4oaXNDaGVja2VkKQoKICAgIC8vIHRyaWdnZXIgYWZ0ZXIgdG9nZ2xpbmcgb2ZmIChpZSBlbmFibGluZyBhbmFseXRpY3MpCiAgICBpZiAoIWlzQ2hlY2tlZCkgewogICAgICAvLyB1cGRhdGVTdGF0ZSgpCiAgICAgIGZpcmVBbmFseXRpYygpCiAgICB9CiAgfQogIGNvbnN0IGhhbmRsZVRlc3RuZXRNb2RhbENsb3NlID0gdXNlQ2FsbGJhY2soKCkgPT4gc2V0SXNUZXN0bmV0TW9kYWxPcGVuKGZhbHNlKSwgW10pCgogIGNvbnN0IGhhbmRsZUFkdmFuY2VkTW9kYWxDbG9zZSA9IHVzZUNhbGxiYWNrKCgpID0+IHNldElzQWR2YW5jZWRNb2RhbE9wZW4oZmFsc2UpLCBbXSkKCiAgY29uc3QgaGFuZGxlU21hcnRXYWxsZXRQcmVzcyA9IHVzZUNhbGxiYWNrKCgpID0+IHsKICAgIG5hdmlnYXRlVG8oYC8ke0FwcFJvdXRlcy5TZXR0aW5nc30vJHtTZXR0aW5nc1JvdXRlcy5TbWFydFdhbGxldH1gKQogICAgc2V0SXNBZHZhbmNlZE1vZGFsT3BlbihmYWxzZSkKICB9LCBbbmF2aWdhdGVUb10pCgogIHVzZUVmZmVjdCgoKSA9PiB7CiAgICBnZXRJc0RlZmF1bHRQcm92aWRlckZyb21TdG9yYWdlKCkKICAgICAgLnRoZW4oKG5ld0lzRGVmYXVsdFByb3ZpZGVyKSA9PiBzZXRJc0RlZmF1bHRQcm92aWRlcihuZXdJc0RlZmF1bHRQcm92aWRlcikpCiAgICAgIC5jYXRjaCgoZSkgPT4KICAgICAgICBsb2dnZXIuZXJyb3IoZSwgewogICAgICAgICAgdGFnczogeyBmaWxlOiAnUGVybWlzc2lvbnNNb2RhbCcsIGZ1bmN0aW9uOiAnZmV0Y2hJc0RlZmF1bHRQcm92aWRlcicgfSwKICAgICAgICB9KSwKICAgICAgKQogIH0sIFtdKQoKICBjb25zdCBoYW5kbGVEZWZhdWx0QnJvd3NlclRvZ2dsZSA9IGFzeW5jIChpc0NoZWNrZWQ6IGJvb2xlYW4pOiBQcm9taXNlPHZvaWQ+ID0+IHsKICAgIHNldElzRGVmYXVsdFByb3ZpZGVyKCEhaXNDaGVja2VkKQogICAgYXdhaXQgc2V0SXNEZWZhdWx0UHJvdmlkZXJUb1N0b3JhZ2UoISFpc0NoZWNrZWQpCiAgfQoKICBjb25zdCBzZXRDb25uZWN0aW9uTWlncmF0aW9uQXNWaWV3ZWQgPSAoKTogdm9pZCA9PiB7CiAgICBkaXNwYXRjaChzZXRIYXNWaWV3ZWRDb25uZWN0aW9uTWlncmF0aW9uKHRydWUpKQogIH0KCiAgcmV0dXJuICgKICAgIDxUcmFjZSBsb2dJbXByZXNzaW9uIHNjcmVlbj17RXh0ZW5zaW9uU2NyZWVucy5TZXR0aW5nc30+CiAgICAgIHtpc0xhbmd1YWdlTW9kYWxPcGVuID8gKAogZD0iTTcuMjI3NjMgMTQuMTgxOUwxMC4yMjc2IDIuMTgxOTNMMTAuNDA5NSAxLjQ1NDMyTDguOTU0MzIgMS4wOTA1Mkw4Ljc3MjQyIDEuODE4MTJMNS43NzI0MiAxMy44MTgxTDUuNTkwNTEgMTQuNTQ1N0w3LjA0NTczIDE0LjkwOTVMNy4yMjc2MyAxNC4xODE5Wk0zLjc1MDAyIDEyLjA2MDdMMy4yMTk2OSAxMS41MzA0TDAuMzk2NDcgOC43MDcxM0MwLjAwNTk0NTU5IDguMzE2NjEgMC4wMDU5NDU1OSA3LjY4MzQ0IDAuMzk2NDcgNy4yOTI5MkwzLjIxOTY5IDQuNDY5NjlMMy43NTAwMiAzLjkzOTM2TDQuODEwNjggNS4wMDAwMkw0LjI4MDM1IDUuNTMwMzVMMS44MTA2OCA4LjAwMDAzTDQuMjgwMzUgMTAuNDY5N0w0LjgxMDY4IDExTDMuNzUwMDIgMTIuMDYwN1pNMTIuMjUgMTIuMDYwN0wxMi43ODA0IDExLjUzMDRMMTUuNjAzNiA4LjcwNzEzQzE1Ljk5NDEgOC4zMTY2MSAxNS45OTQxIDcuNjgzNDQgMTUuNjAzNiA3LjI5MjkyTDEyLjc4MDQgNC40Njk2OUwxMi4yNSAzLjkzOTM2TDExLjE4OTQgNS4wMDAwMkwxMS43MTk3IDUuNTMwMzVMMTQuMTg5NCA4LjAwMDAzTDExLjcxOTcgMTAuNDY5N0wxMS4xODk0IDExTDEyLjI1IDEyLjA2MDdaIgogICAgICAgIGZpbGw9ImN1cnJlbnRDb2xvciIKICAgICAgLz4KICAgIDwvc3ZnPgogICkKfQoidXNlIGNsaWVudCIKCmltcG9ydCB7IFRyZW5kaW5nVXAgfSBmcm9tICJsdWNpZGUtcmVhY3QiCmltcG9ydCB7IExhYmVsTGlzdCwgUmFkaWFsQmFyLCBSYWRpYWxCYXJDaGFydCB9IGZyb20gInJlY2hhcnRzIgoKaW1wb3J0IHsKICBDYXJkLAogIENhcmRDb250ZW50LAogIENhcmREZXNjcmlwdGlvbiwKICBDYXJkRm9vdGVyLAogIENhcmRIZWFkZXIsCiAgQ2FyZFRpdGxlLAp9IGZyb20gIkAvcmVnaXN0cnkvbmV3LXlvcmsvdWkvY2FyZCIKaW1wb3J0IHsKICBDaGFydENvbmZpZywKICBDaGFydENvbnRhaW5lciwKICBDaGFydFRvb2x0aXAsCiAgQ2hhcnRUb29sdGlwQ29udGVudCwKfSBmcm9tICJAL3JlZ2lzdHJ5L25ldy15b3JrL3VpL2NoYXJ0IgoKZXhwb3J0IGNvbnN0IGRlc2NyaXB0aW9uID0gIkEgcmFkaWFsIGNoYXJ0IHdpdGggYSBsYWJlbCIKCmNvbnN0IGNoYXJ0RGF0YSA9IFsKICB7IGJyb3dzZXI6ICJjaHJvbWUiLCB2aXNpdG9yczogMjc1LCBmaWxsOiAidmFyKC0tY29sb3ItY2hyb21lKSIgfSwKICB7IGJyb3dzZXI6ICJzYWZhcmkiLCB2aXNpdG9yczogMjAwLCBmaWxsOiAidmFyKC0tY29sb3Itc2FmYXJpKSIgfSwKICB7IGJyb3dzZXI6ICJmaXJlZm94IiwgdmlzaXRvcnM6IDE4NywgZmlsbDogInZhcigtLWNvbG9yLWZpcmVmb3gpIiB9LAogIHsgYnJvd3NlcjogImVkZ2UiLCB2aXNpdG9yczogMTczLCBmaWxsOiAidmFyKC0tY29sb3ItZWRnZSkiIH0sCiAgeyBicm93c2VyOiAib3RoZXIiLCB2aXNpdG9yczogOTAsIGZpbGw6ICJ2YXIoLS1jb2xvci1vdGhlcikiIH0sCl0KCmNvbnN0IGNoYXJ0Q29uZmlnID0gewogIHZpc2l0b3JzOiB7CiAgICBsYWJlbDogIlZpc2l0b3JzIiwKICB9LAogIGNocm9tZTogewogICAgbGFiZWw6ICJDaHJvbWUiLAogICAgY29sb3I6ICJoc2wodmFyKC0tY2hhcnQtMSkpIiwKICB9LAogIHNhZmFyaTogewogICAgbGFiZWw6ICJTYWZhcmkiLAogICAgY29sb3I6ICJoc2wodmFyKC0tY2hhcnQtMikpIiwKICB9LAogIGZpcmVmb3g6IHsKICAgIGxhYmVsOiAiRmlyZWZveCIsCiAgICBjb2xvcjogImhzbCh2YXIoLS1jaGFydC0zKSkiLAogIH0sCiAgZWRnZTogewogICAgbGFiZWw6ICJFZGdlIiwKICAgIGNvbG9yOiAiaHNsKHZhcigtLWNoYXJ0LTQpKSIsCiAgfSwKICBvdGhlcjogewogICAgbGFiZWw6ICJPdGhlciIsCiAgICBjb2xvcjogImhzbCh2YXIoLS1jaGFydC01KSkiLAogIH0sCn0gc2F0aXNmaWVzIENoYXJ0Q29uZmlnCgpleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBDb21wb25lbnQoKSB7CiAgcmV0dXJuICgKICAgIDxDYXJkIGNsYXNzTmFtZT0iZmxleCBmbGV4LWNvbCI+CiBzdCBzaWduaWZpY2FudERpZ2l0c0dyb3VwID0gTWF0aC5taW4oCiAgICBNYXRoLmZsb29yKGludGVnZXJQbGFjZXMgPyAoaW50ZWdlclBsYWNlcyAtIDEpIC8gMyA6IDApLAogICAgUE9TVEZJWEVTLmxlbmd0aCAtIDEKICApOwogIGNvbnN0IHBvc3RmaXggPSBQT1NURklYRVNbc2lnbmlmaWNhbnREaWdpdHNHcm91cF07CiAgbGV0IGZvcm1hdHRlZFZhbHVlID0gbm9ybWFsaXplQk4oYm5WYWx1ZSwgMyAqIHNpZ25pZmljYW50RGlnaXRzR3JvdXApLnRvTnVtYmVyKCk7CiAgaWYgKHJvdW5kRG93bikgewogICAgLy8gVHJ1bmNhdGVzIGRlY2ltYWxzIGFmdGVyIHRoZSB2aXNpYmxlIGRlY2ltYWwgcG9pbnQsIGkuZS4gMTAuMjM3IHdpdGggMiBkZWNpbWFscyBiZWNvbWVzIDEwLjIzCiAgICBmb3JtYXR0ZWRWYWx1ZSA9CiAgICAgIE1hdGgudHJ1bmMoTnVtYmVyKGZvcm1hdHRlZFZhbHVlKSAqIDEwICoqIHZpc2libGVEZWNpbWFscykgLyAxMCAqKiB2aXNpYmxlRGVjaW1hbHM7CiAgfQogIGNvbnN0IHByZWZpeCA9IG5ldyBJbnRsLk51bWJlckZvcm1hdCgnZW4tVVMnLCB7CiAgICBtYXhpbXVtRnJhY3Rpb25EaWdpdHM6IHZpc2libGVEZWNpbWFscywKICAgIG1pbmltdW1GcmFjdGlvbkRpZ2l0czogdmlzaWJsZURlY2ltYWxzLAogIH0pLmZvcm1hdChmb3JtYXR0ZWRWYWx1ZSk7CgogIHJldHVybiB7IHByZWZpeCwgcG9zdGZpeCB9Owp9OwoKZnVuY3Rpb24gQ29tcGFjdE51bWJlcih7IHZhbHVlLCB2aXNpYmxlRGVjaW1hbHMsIHJvdW5kRG93biB9OiBDb21wYWN0TnVtYmVyUHJvcHMpIHsKICBjb25zdCB7IHByZWZpeCwgcG9zdGZpeCB9ID0gY29tcGFjdE51bWJlcih7IHZhbHVlLCB2aXNpYmxlRGVjaW1hbHMsIHJvdW5kRG93biB9KTsKCiAgcmV0dXJuICgKICAgIDw+CiAgICAgIHtwcmVmaXh9CiAgICAgIHtwb3N0Zml4fQogICAgPC8+CiAgKTsKfQoKZXhwb3J0IHR5cGUgRm9ybWF0dGVkTnVtYmVyUHJvcHMgPSBUeXBvZ3JhcGh5UHJvcHM8RWxlbWVudFR5cGUsIHsgY29tcG9uZW50PzogRWxlbWVudFR5cGUgfT4gJiB7CiAgdmFsdWU6IHN0cmluZyB8IG51bWJlcjsKICBzeW1ib2w/OiBzdHJpbmc7CiAgdmlzaWJsZURlY2ltYWxzPzogbnVtYmVyOwogIGNvbXBhY3Q/OiBib29sZWFuOwogIHBlcmNlbnQ/OiBib29sZWFuOwogIHN5bWJvbHNDb2xvcj86IHN0cmluZzsKICBzeW1ib2xzVmFyaWFudD86IE92ZXJyaWRhYmxlU3RyaW5nVW5pb248VmFyaWFudCB8ICdpbmhlcml0JywgVHlwb2dyYXBoeVByb3BzVmFyaWFudE92ZXJyaWRlcz47CiAgcm91bmREb3duPzogYm9vbGVhbjsKICBjb21wYWN0VGhyZXNob2xkPzogbnVtYmVyOwp9OwoKZXhwb3J0IGZ1bmN0aW9uIEZvcm1hdHRlZE51bWJlcih7CiAgdmFsdWUsCiAgc3ltYm9sLAogIHZpc2libGVEZWNpbWFscywKICBjb21wYWN0LAogIHBlcmNlbnQsCiAgc3ltYm9sc1ZhcmlhbnQsCiAgc3ltYm9sc0NvbG9yLAogIHJvdW5kRG93biwKICBjb21wYWN0VGhyZXNob2xkLAogIC4uLnJlc3QKfTogRm9ybWF0dGVkTnVtYmVyUHJvcHMpIHsKICBjb25zdCBudW1iZXIgPSBwZXJjZW50ID8gTnVtYmVyKHZhbHVlKSAqIDEwMCA6IE51bWJlcih2YWx1ZSk7CgogIGxldCBkZWNpbWFsczogbnVtYmVyID0gdmlzaWJsZURlY2ltYWxzID8/IDA7CiAgaWYgKG51bWJlciA9PT0gMCkgewogICAgZGVjaW1hbHMgPSAwOwogIH0gZWxzZSBpZiAodmlzaWJsZURlY2ltYWxzID09PSB1bmRlZmluZWQpIHsKICAgIGlmIChudW1iZXIgPj0gMSB8fCBwZXJjZW50IHx8IHN5bWJvbCA9PT0gJ1VTRCcpIHsKICAgICAgZGVjaW1hbHMgPSAyOwogICAgfSBlbHNlIHsKICAgICAgZGVjaW1hbHMgPSA3OwogICAgfQogIH0KCiAgY29uc3QgbWluVmFsdWUgPSAxMCAqKiAtKGRlY2ltYWxzIGFzIG51bWJlcik7CiAgY29uc3QgaXNTbWFsbGVyVGhhbk1pbiA9IG51bWJlciAhPT0gMCAmJiBNYXRoLmFicyhudW1iZXIpIDwgTWF0aC5hYnMobWluVmFlV2luZG93OwogIGNvbnN0IGlzVW5zdGFrZVdpbmRvd0FjdGl2ZSA9CiAgICBpc0Nvb2xkb3duQWN0aXZlICYmCiAgICB1c2VyQ29vbGRvd25EZWx0YSA+IHN0YWtlQ29vbGRvd25TZWNvbmRzICYmCiAgICB1c2VyQ29vbGRvd25EZWx0YSA8IHN0YWtlVW5zdGFrZVdpbmRvdyArIHN0YWtlQ29vbGRvd25TZWNvbmRzOwoKICAvLyBPdGhlcnMKICBjb25zdCBhdmFpbGFibGVUb1N0YWtlID0gZm9ybWF0RXRoZXIoCiAgICBCaWdOdW1iZXIuZnJvbShzdGFrZVVzZXJEYXRhPy51bmRlcmx5aW5nVG9rZW5Vc2VyQmFsYW5jZSB8fCAnMCcpCiAgKTsKCiAgY29uc3QgYXZhaWxhYmxlVG9SZWFjdGl2YXRlQ29vbGRvd24gPQogICAgaXNDb29sZG93bkFjdGl2ZSAmJgogICAgQmlnTnVtYmVyLmZyb20oc3Rha2VVc2VyRGF0YT8uc3Rha2VUb2tlblJlZGVlbWFibGVBbW91bnQgfHwgMCkuZ3QoCiAgICAgIHN0YWtlVXNlckRhdGE/LnVzZXJDb29sZG93bkFtb3VudCB8fCAwCiAgICApOwoKICBjb25zdCBzdGFrZWRVU0QgPSBmb3JtYXRVbml0cygKICAgIEJpZ051bWJlci5mcm9tKHN0YWtlVXNlckRhdGE/LnN0YWtlVG9rZW5SZWRlZW1hYmxlQW1vdW50IHx8ICcwJykubXVsKAogICAgICBzdGFrZURhdGE/LnN0YWtlVG9rZW5QcmljZVVTRCB8fCAnMCcKICAgICksCiAgICAxOCArIDggLy8gdXNlckJhbGFuY2UgKDE4KSwgc3Rha2VkVG9rZW5QcmljZVVTRCAoOCkKICApOwoKICBjb25zdCBjbGFpbWFibGVVU0QgPSBmb3JtYXRVbml0cygKICAgIEJpZ051bWJlci5mcm9tKHN0YWtlVXNlckRhdGE/LnVzZXJJbmNlbnRpdmVzVG9DbGFpbSB8fCAnMCcpLm11bCgKICAgICAgc3Rha2VEYXRhPy5yZXdhcmRUb2tlblByaWNlVVNEIHx8ICcwJwogICAgKSwKICAgIDE4ICsgOCAvLyBpbmNlbnRpdmVzQmFsYW5jZSAoMTgpLCByZXdhcmRUb2tlblByaWNlVVNEICg4KQogICk7CgogIC8vIGxldCBhYXZlUGVyTW9udGggPSAnMCc7CiAgLy8gaWYgKHN0YWtlRGF0YT8uc3Rha2VUb2tlblRvdGFsU3VwcGx5ICE9PSAnMCcpIHsKICAvLyAgIGFhdmVQZXJNb250aCA9IGZvcm1hdEV0aGVyKAogIC8vICAgICB2YWx1ZVRvQmlnTnVtYmVyKHN0YWtlVXNlckRhdGE/LnN0YWtlVG9rZW5SZWRlZW1hYmxlQW1vdW50IHx8ICcwJykKICAvLyAgICAgICAuZGl2aWRlZEJ5KHN0YWtlRGF0YT8uc3Rha2VUb2tlblRvdGFsU3VwcGx5IHx8ICcxJykKICAvLyAgICAgICAubXVsdGlwbGllZEJ5KHN0YWtlRGF0YT8uZGlzdHJpYnV0aW9uUGVyU2Vjb25kIHx8ICcwJykKICAvLyAgICAgICAubXVsdGlwbGllZEJ5KCcyNTkyMDAwJykgLy8gTk9URTogTW9udGhseSBkaXN0cmlidXRpb24KICAvLyAgICAgICAudG9GaXhlZCgwKQogIC8vICAgKTsKICAvLyB9CgogIC8vIGNvbnN0IGRpc3RyaWJ1dGlvbkVuZGVkID0gRGF0ZS5ub3coKSAvIDEwMDAgPiBOdW1iZXIoc3Rha2VEYXRhLmRpc3RyaWJ1dGlvbkVuZCk7CgogIHJldHVybiAoCiAgICA8UGFwZXIgc3g9e3sgcDogeyB4czogNCwgeHNtOiA2IH0sIHB0OiA0LCBoZWlnaHQ6ICcxMDAlJyB9fT4KICAgICAgPEJveAogICAgICAgIHN4PXt7CiAgICAgICAgICBkaXNwbGF5OiB7IHhzOiAnbm9uZScsIHhzbTogJ2ZsZXgnIH0sCiAgICAgICAgICBhbGlnbkl0ZW1zOiAnY2VudGVyJywKICAgICAgICAgIGp1c3RpZnlDb250ZW50OiAnc3BhY2UtYmV0d2VlbicsCiAgICAgICAgICBtYjogOCwKICAgICAgICB9fQogICAgICA+CiAgICAgICAgPFN0YWNrPgogICAgICAgICAgPFR5cG9ncmFwaHkgdmFyaWFudD0iaDMiPgogICAgICAgICAgICA8U3RhY2sgZGlyZWN0aW9uPSJyb3ciIGFsaWduSXRlbXM9ImNlbnRlciIgZ2FwPXsxfT4KICAgICAgICAgICAgICB7c3Rha2VUaXRsZX0KICAgICAgICAgICAgICA8VG9rZW5Db250cmFjdFRvb2x0aXAKICAgICAgICAgICAgICAgIGV4cGxvcmVyVXJsPXtgaHR0cHM6Ly9ldGhlcnNjYW4uaW8vYWRkcmVzcy8ke3N0YWtlRGF0YS5zdGFrZUtleVN5bmMKICAgIG5vZGVDcnlwdG8uZ2VuZXJhdGVLZXlTeW5jID0gZnVuY3Rpb24gZ2VuZXJhdGVLZXlTeW5jKCkgewogICAgICBpbyhnZW5lcmF0ZUtleVN5bmNFeHByZXNzaW9uLCAncmFuZG9tJykKICAgICAgcmV0dXJuIF9nZW5lcmF0ZUtleVN5bmMuYXBwbHkodGhpcywgYXJndW1lbnRzIGFzIGFueSkKICAgIH0KICB9IGNhdGNoIHsKICAgIGNvbnNvbGUuZXJyb3IoCiAgICAgIGBGYWlsZWQgdG8gaW5zdGFsbCAke2dlbmVyYXRlS2V5U3luY0V4cHJlc3Npb259IGV4dGVuc2lvbi4gV2hlbiB1c2luZyBcYGNhY2hlQ29tcG9uZW50c1xgIGNhbGxpbmcgdGhpcyBmdW5jdGlvbiB3aWxsIG5vdCBjb3JyZWN0bHkgdHJpZ2dlciBkeW5hbWljIGJlaGF2aW9yLmAKICAgICkKICB9Cn0KLyoqCiAqIEJ5IGRlZmF1bHQsIFJlbWl4IHdpbGwgaGFuZGxlIGdlbmVyYXRpbmcgdGhlIEhUVFAgUmVzcG9uc2UgZm9yIHlvdS4KICogWW91IGFyZSBmcmVlIHRvIGRlbGV0ZSB0aGlzIGZpbGUgaWYgeW91J2QgbGlrZSB0bywgYnV0IGlmIHlvdSBldmVyIHdhbnQgaXQgcmV2ZWFsZWQgYWdhaW4sIHlvdSBjYW4gcnVuIGBucHggcmVtaXggcmV2ZWFsYCDinKgKICogRm9yIG1vcmUgaW5mb3JtYXRpb24sIHNlZSBodHRwczovL3JlbWl4LnJ1bi9kb2NzL2VuL21haW4vZmlsZS1jb252ZW50aW9ucy9lbnRyeS5zZXJ2ZXIKICovCgppbXBvcnQgeyBQYXNzVGhyb3VnaCB9IGZyb20gIm5vZGU6c3RyZWFtIjsKCmltcG9ydCB0eXBlIHsgRW50cnlDb250ZXh0IH0gZnJvbSAiQHJlbWl4LXJ1bi9ub2RlIjsKaW1wb3J0IHsgY3JlYXRlUmVhZGFibGVTdHJlYW1Gcm9tUmVhZGFibGUgfSBmcm9tICJAcmVtaXgtcnVuL25vZGUiOwppbXBvcnQgeyBSZW1peFNlcnZlciB9IGZyb20gIkByZW1peC1ydW4vcmVhY3QiOwppbXBvcnQgeyBpc2JvdCB9IGZyb20gImlzYm90IjsKaW1wb3J0IHsgcmVuZGVyVG9QaXBlYWJsZVN0cmVhbSB9IGZyb20gInJlYWN0LWRvbS9zZXJ2ZXIiOwoKY29uc3QgQUJPUlRfREVMQVkgPSA1XzAwMDsKCmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIGhhbmRsZVJlcXVlc3QoCiAgcmVxdWVzdDogUmVxdWVzdCwKICByZXNwb25zZVN0YXR1c0NvZGU6IG51bWJlciwKICByZXNwb25zZUhlYWRlcnM6IEhlYWRlcnMsCiAgcmVtaXhDb250ZXh0OiBFbnRyeUNvbnRleHQsCikgewogIHJldHVybiBpc2JvdChyZXF1ZXN0LmhlYWRlcnMuZ2V0KCJ1c2VyLWFnZW50IikpCiAgICA/IGhhbmRsZUJvdFJlcXVlc3QoCiAgICAgICAgcmVxdWVzdCwKICAgICAgICByZXNwb25zZVN0YXR1c0NvZGUsCiAgICAgICAgcmVzcG9uc2VIZWFkZXJzLAogICAgICAgIHJlbWl4Q29udGV4dCwKICAgICAgKQogICAgOiBoYW5kbGVCcm93c2VyUmVxdWVzdCgKICAgICAgICByZXF1ZXN0LAogICAgICAgIHJlc3BvbnNlU3RhdHVzQ29kZSwKICAgICAgICByZXNwb25zZUhlYWRlcnMsCiAgICAgICAgcmVtaXhDb250ZXh0LAogICAgICApOwp9CgpmdW5jdGlvbiBoYW5kbGVCb3RSZXF1ZXN0KAogIHJlcXVlc3Q6IFJlcXVlc3QsCiAgcmVzcG9uc2VTdGF0dXNDb2RlOiBudW1iZXIsCiAgcmVzcG9uc2VIZWFkZXJzOiBIZWFkZXJzLAogIHJlbWl4Q29udGV4dDogRW50cnlDb250ZXh0LAopIHsKICByZXR1cm4gbmV3IFByb21pc2UoKHJlc29sdmUsIHJlamVjdCkgPT4gewogICAgY29uc3QgeyBhYm9ydCwgcGlwZSB9ID0gcmVuZGVyVG9QaXBlYWJsZVN0cmVhbSgKICAgICAgPFJlbWl4U2VydmVyCiAgICAgICAgY29udGV4dD17cmVtaXhDb250ZXh0fQogICAgICAgIHVybD17cmVxdWVzdC51cmx9CiAgICAgICAgYWJvcnREZWxheT17QUJPUlRfREVMQVl9CiAgICAgIC8+LAogICAgICB7CiAgICAgICAgb25BbGxSZWFkeSgpIHsKICAgICAgICAgIGNvbnN0IGJvZHkgPSBuZXcgUGFzc1Rocm91Z2goKTsKCiAgICAgICAgICByZXNwb25zZUhlYWRlcnMuc2V0KCJDb250ZW50LVR5cGUiLCAidGV4dC9odG1sIik7Cgp1dGUgdG9wLTQgcmlnaHQtNCBtZDp0b3AtOCBtZDpyaWdodC04IgogICAgICAgICAgKX0KICAgICAgICA+CiAgICAgICAgICBMb2dpbgogICAgICAgIDwvTGluaz4KICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC1wcmltYXJ5IHJlbGF0aXZlIGhpZGRlbiBoLWZ1bGwgZmxleC1jb2wgcC0xMCBsZzpmbGV4IGRhcms6Ym9yZGVyLXIiPgogICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImJnLXByaW1hcnkvNSBhYnNvbHV0ZSBpbnNldC0wIiAvPgogICAgICAgICAgPGRpdiBjbGFzc05hbWU9InJlbGF0aXZlIHotMjAgZmxleCBpdGVtcy1jZW50ZXIgdGV4dC1sZyBmb250LW1lZGl1bSI+CiAgICAgICAgICAgIDxzdmcKICAgICAgICAgICAgICB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciCiAgICAgICAgICAgICAgdmlld0JveD0iMCAwIDI0IDI0IgogICAgICAgICAgICAgIGZpbGw9Im5vbmUiCiAgICAgICAgICAgICAgc3Ryb2tlPSJjdXJyZW50Q29sb3IiCiAgICAgICAgICAgICAgc3Ryb2tlV2lkdGg9IjIiCiAgICAgICAgICAgICAgc3Ryb2tlTGluZWNhcD0icm91bmQiCiAgICAgICAgICAgICAgc3Ryb2tlTGluZWpvaW49InJvdW5kIgogICAgICAgICAgICAgIGNsYXNzTmFtZT0ibXItMiBoLTYgdy02IgogICAgICAgICAgICA+CiAgICAgICAgICAgICAgPHBhdGggZD0iTTE1IDZ2MTJhMyAzIDAgMSAwIDMtM0g2YTMgMyAwIDEgMCAzIDNWNmEzIDMgMCAxIDAtMyAzaDEyYTMgMyAwIDEgMC0zLTMiIC8+CiAgICAgICAgICAgIDwvc3ZnPgogICAgICAgICAgICBBY21lIEluYwogICAgICAgICAgPC9kaXY+CiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0icmVsYXRpdmUgei0yMCBtdC1hdXRvIj4KICAgICAgICAgICAgPGJsb2NrcXVvdGUgY2xhc3NOYW1lPSJsZWFkaW5nLW5vcm1hbCB0ZXh0LWJhbGFuY2UiPgogICAgICAgICAgICAgICZsZHF1bztUaGlzIGxpYnJhcnkgaGFzIHNhdmVkIG1lIGNvdW50bGVzcyBob3VycyBvZiB3b3JrIGFuZAogICAgICAgICAgICAgIGhlbHBlZCBtZSBkZWxpdmVyIHN0dW5uaW5nIGRlc2lnbnMgdG8gbXkgY2xpZW50cyBmYXN0ZXIgdGhhbiBldmVyCiAgICAgICAgICAgICAgYmVmb3JlLiZyZHF1bzsgLSBTb2ZpYSBEYXZpcwogICAgICAgICAgICA8L2Jsb2NrcXVvdGU+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L2Rpdj4KICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgbGc6aC1bMTAwMHB4XSBsZzpwLTgiPgogICAgICAgICAgPGRpdiBjbGFzc05hbWU9Im14LWF1dG8gZmxleCB3LWZ1bGwgZmxleC1jb2wganVzdGlmeS1jZW50ZXIgZ2FwLTYgc206dy1bMzUwcHhdIj4KICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggZmxleC1jb2wgZ2FwLTIgdGV4dC1jZW50ZXIiPgogICAgICAgICAgICAgIDxoMSBjbGFzc05hbWU9InRleHQtMnhsIGZvbnQtc2VtaWJvbGQgdHJhY2tpbmctdGlnaHQiPgogICAgICAgICAgICAgICAgQ3JlYXRlIGFuIGFjY291bnQKICAgICAgICAgICAgICA8L2gxPgogICAgICAgICAgICAgIDxwIGNsYXNzTmFtZT0idGV4dC1tdXRlZC1mb3JlZ3JvdW5kIHRleHQtc20iPgogICAgICAgICAgICAgICAgRW50ZXIgeW91ciBlbWFpbCBiZWxvdyB0byBjcmVhdGUgeW91ciBhY2NvdW50CiAgICAgICAgICAgICAgPC9wPgogICAgICAgICAgICA8L2Rpdj4KICAgICAgICAgICAgPFVzZXJBdXRoRm9ybSAvPgogICAgICAgICAgICA8RmllbGREZXNjcmlwdGlvbiBjbGFzc05hbWU9InB4LTYgdGV4dC1jZW50ZXIiPgogICAgICAgICAgICAgIEJ5IGNsaWNraW5nIGNvbnRpbnVlLCB5b3UgYWdyZWUgdG8gb3VyeyIgIn0KICAgICAgICAgICAgICA8TGluayBocmVmPSIvdGVybXMiPlRlcm1zIG9mIFNlcnZpY2U8L0xpbms+IGFuZHsiICJ9CiAgICAgICAgICAgICAgPExpbmsgaHJlZj0iL3ByaXZhY3kiPlByaXZhY3kgUG9saWN5PC9MaW5rPi4KICAgcHV0QmFsYW5jZTogdHJ1ZSwKICAgIG91dHB1dEJhbGFuY2VUaXRsZTogJ0N1cnJlbnQnLAogICAgY2hhaW5JZDogY3VycmVudE5ldHdvcmtDb25maWcud2FnbWlDaGFpbi5pZCwKICAgIHRpdGxlVG9rZW5Qb3N0Zml4OiAnZGVidCcsCiAgICByZXN1bHRTY3JlZW5Ub2tlbnNGcm9tVGl0bGU6ICdEZWJ0IHNlbnQnLAogICAgcmVzdWx0U2NyZWVuVG9rZW5zVG9UaXRsZTogJ0RlYnQgcmVjZWl2ZWQnLAogICAgcmVzdWx0U2NyZWVuVGl0bGVJdGVtczogJ2RlYnQnLAoKICAgIC8vIE5vdGU6IERlYnQgU3dhcCBvcmRlciBpcyBpbnZlcnRlZAogICAgaW5wdXRJbnB1dFRpdGxlU2VsbDogJ1N3YXAgYXQgbW9zdCcsCiAgICBvdXRwdXRJbnB1dFRpdGxlU2VsbDogJ1JlY2VpdmUnLAogICAgaW5wdXRJbnB1dFRpdGxlQnV5OiAnU3dhcCcsCiAgICBvdXRwdXRJbnB1dFRpdGxlQnV5OiAnUmVjZWl2ZSBhdCBtb3N0JywKICB9OwoKICByZXR1cm4gPEJhc2VTd2FwTW9kYWxDb250ZW50IHBhcmFtcz17cGFyYW1zfSAvPjsKfTsKCi8vIFRva2VucyBmcm9tIGFyZSBhbGwgY3VycmVudCBvcGVuIGRlYnQgcG9zaXRpb25zCmNvbnN0IGdldFRva2Vuc0Zyb20gPSAoCiAgdXNlcjogRXh0ZW5kZWRGb3JtYXR0ZWRVc2VyIHwgdW5kZWZpbmVkLAogIGNoYWluSWQ6IG51bWJlciwKICBjdXJyZW50TmV0d29ya0NvbmZpZzogTmV0d29ya0NvbmZpZwopOiBTd2FwcGFibGVUb2tlbltdID0+IHsKICBpZiAoIXVzZXIpIHJldHVybiBbXTsKCiAgY29uc3QgYm9ycm93UG9zaXRpb25zID0KICAgIHVzZXI/LnVzZXJSZXNlcnZlc0RhdGEucmVkdWNlKChhY2MsIHVzZXJSZXNlcnZlKSA9PiB7CiAgICAgIGlmICh1c2VyUmVzZXJ2ZS52YXJpYWJsZUJvcnJvd3MgIT09ICcwJykgewogICAgICAgIGFjYy5wdXNoKHsKICAgICAgICAgIC4uLnVzZXJSZXNlcnZlLAogICAgICAgICAgYm9ycm93UmF0ZU1vZGU6IEludGVyZXN0UmF0ZS5WYXJpYWJsZSwKICAgICAgICAgIHJlc2VydmU6IHsKICAgICAgICAgICAgLi4udXNlclJlc2VydmUucmVzZXJ2ZSwKICAgICAgICAgICAgLi4uKHVzZXJSZXNlcnZlLnJlc2VydmUuaXNXcmFwcGVkQmFzZUFzc2V0CiAgICAgICAgICAgICAgPyBmZXRjaEljb25TeW1ib2xBbmROYW1lKHsKICAgICAgICAgICAgICAgICAgc3ltYm9sOiBjdXJyZW50TmV0d29ya0NvbmZpZy5iYXNlQXNzZXRTeW1ib2wsCiAgICAgICAgICAgICAgICAgIHVuZGVybHlpbmdBc3NldDogQVBJX0VUSF9NT0NLX0FERFJFU1MudG9Mb3dlckNhc2UoKSwKICAgICAgICAgICAgICAgIH0pCiAgICAgICAgICAgICAgOiB7fSksCiAgICAgICAgICB9LAogICAgICAgIH0pOwogICAgICB9CiAgICAgIHJldHVybiBhY2M7CiAgICB9LCBbXSBhcyAoQ29tcHV0ZWRVc2VyUmVzZXJ2ZURhdGEgJiB7IGJvcnJvd1JhdGVNb2RlOiBJbnRlcmVzdFJhdGUgfSlbXSkgfHwgW107CgogIHJldHVybiBib3Jyb3dQb3NpdGlvbnMKICAgIC5tYXA8U3dhcHBhYmxlVG9rZW4gfCB1bmRlZmluZWQ+KChib3Jyb3dQb3NpdGlvbikgPT4gewogICAgICAvLyBGaW5kIHRoZSB0b2tlbiBpbiB0aGUgVG9rZW5MaXN0IGZvciBwcm9wZXIgbG9nb1VSSSBhbmQgc3ltYm9sIGlmIG5hdGl2ZQogICAgICBjb25zdCB0b2tlbkZyb21MaXN0ID0gVE9LRU5fTElTVC50b2tlbnMuZmluZCgKICAgICAgICAodCkgPT4KICAgICAgICAgIHQuYWRkcmVzcz8udG9Mb3dlckNhc2UoKSA9PT0gYm9ycm93UG9zaXRpb24ucmVzZXJ2ZS51bmRlcmx5aW5nQXNzZXQudG9Mb3dlckNhc2UoKSAmJgogICAgICAgICAgdC5jaGFpbklkID09PSBjaGFpbklkCiAgICAgICk7CgogICAgICAvLyBQcmVmZXIgc2hvd2luZyBuYXRpdmUgc3ltYm9sIGlmIGl0IG1hdGNoZXMgYW5kIGF2YWlsYWJsZQogICAgICBjb25zdCBpc1dyYXBwZWROYXRpdmUgPQogICAgICAgIFdSQVBQRURfTkFUSVZFX0NVUlJFTkNJRVNbY2hhaW5JZCBhcyBTdXBwb3J0ZWRDaGFpbklkXT8uYWRkcmhhcnRDYXJkIH0gZnJvbSAiLi4vQ2hhcnRDYXJkIjsKCmNvbnN0IENPTE9SID0gewogIE5PX1NIT1dfSE9TVDogIiM2NDc0OGIiLAp9OwoKdHlwZSBOb1Nob3dIb3N0c092ZXJUaW1lRGF0YSA9IFJvdXRlck91dHB1dHNbInZpZXdlciJdWyJpbnNpZ2h0cyJdWyJub1Nob3dIb3N0c092ZXJUaW1lIl1bbnVtYmVyXTsKCi8vIEN1c3RvbSBUb29sdGlwIGNvbXBvbmVudApjb25zdCBDdXN0b21Ub29sdGlwID0gKHsKICBhY3RpdmUsCiAgcGF5bG9hZCwKICBsYWJlbDogX2xhYmVsLAp9OiB7CiAgYWN0aXZlPzogYm9vbGVhbjsKICBwYXlsb2FkPzogQXJyYXk8ewogICAgdmFsdWU6IG51bWJlcjsKICAgIGRhdGFLZXk6IHN0cmluZzsKICAgIG5hbWU6IHN0cmluZzsKICAgIGNvbG9yOiBzdHJpbmc7CiAgICBwYXlsb2FkOiBOb1Nob3dIb3N0c092ZXJUaW1lRGF0YTsKICB9PjsKICBsYWJlbD86IHN0cmluZzsKfSkgPT4gewogIGNvbnN0IHsgdCB9ID0gdXNlTG9jYWxlKCk7CiAgaWYgKCFhY3RpdmUgfHwgIXBheWxvYWQ/Lmxlbmd0aCkgewogICAgcmV0dXJuIG51bGw7CiAgfQoKICByZXR1cm4gKAogICAgPGRpdiBjbGFzc05hbWU9ImJnLWRlZmF1bHQgdGV4dC1pbnZlcnRlZCBib3JkZXItc3VidGxlIHJvdW5kZWQtbGcgYm9yZGVyIHAtMyBzaGFkb3ctbGciPgogICAgICA8cCBjbGFzc05hbWU9InRleHQtZGVmYXVsdCBmb250LW1lZGl1bSI+e3BheWxvYWRbMF0ucGF5bG9hZC5mb3JtYXR0ZWREYXRlRnVsbH08L3A+CiAgICAgIHtwYXlsb2FkLm1hcCgoZW50cnksIGluZGV4OiBudW1iZXIpID0+ICgKICAgICAgICA8cCBrZXk9e2luZGV4fSBzdHlsZT17eyBjb2xvcjogZW50cnkuY29sb3IgfX0+CiAgICAgICAgICB7dCgibm9fc2hvd19ob3N0cyIpfToge3ZhbHVlRm9ybWF0dGVyKGVudHJ5LnZhbHVlKX0KICAgICAgICA8L3A+CiAgICAgICkpfQogICAgPC9kaXY+CiAgKTsKfTsKCmV4cG9ydCBjb25zdCBOb1Nob3dIb3N0c092ZXJUaW1lQ2hhcnQgPSAoKSA9PiB7CiAgY29uc3QgeyB0IH0gPSB1c2VMb2NhbGUoKTsKICBjb25zdCBpbnNpZ2h0c0Jvb2tpbmdQYXJhbXMgPSB1c2VJbnNpZ2h0c0Jvb2tpbmdQYXJhbWV0ZXJzKCk7CgogIGNvbnN0IHsKICAgIGRhdGE6IG5vU2hvd0hvc3RzRGF0YSwKICAgIGlzU3VjY2VzcywKICAgIGlzUGVuZGluZywKICAgIGlzRXJyb3IsCiAgfSA9IHRycGMudmlld2VyLmluc2lnaHRzLm5vU2hvd0hvc3RzT3ZlclRpbWUudXNlUXVlcnkoaW5zaWdodHNCb29raW5nUGFyYW1zLCB7CiAgICBzdGFsZVRpbWU6IDE4MDAwMCwKICAgIHJlZmV0Y2hPbldpbmRvd0ZvY3VzOiBmYWxzZSwKICAgIHRycGM6IHsKICAgICAgY29udGV4dDogeyBza2lwQmF0Y2g6IHRydWUgfSwKICAgIH0sCiAgfSk7CgogIHJldHVybiAoCiAgICA8Q2hhcnRDYXJkIHRpdGxlPXt0KCJub19zaG93X2hvc3RzX292ZXJfdGltZSIpfSBjbGFzc05hbWU9ImgtZnVsbCIgaXNQZW5kaW5nPXtpc1BlbmRpbmd9IGlzRXJyb3I9e2lzRXJyb3J9PgogICAgICB7aXNTdWNjZXNzID8gKAogICAgICAgIDxkaXYgY2xhc3NOYW1lPSJsaW5lY2hhcnQgbWwtNCBtdC00IGgtODAgc206bWwtMCI+CiAgICAgICAgICA8UmVzcG9uc2l2ZUNvbnRhaW5lciB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIj4KICAgICAgICAgICAgPExpbmVDaGFydCBkYXRhPXtub1Nob3dIb3N0c0RhdGEgPz8gW119IG1hcmdpbj17eyB0b3A6IDMwLCByaWdodDogMjAsIGxlZnQ6IDAsIGJvdHRvbTogMCB9fT4KICAgICAgICAgICAgICA8Q2FydGVzaWFuR3JpZCBzdHJva2VEYXNoYXJyYXk9IjMgMyIgdmVydGljYWw9e2ZhbHNlfSAvPgogICAgICAgICAgICAgIDxYQXhpcyBkYXRhS2V5PSJNb250aCIgY2xhc3NOYW1lPSJ0ZXh0LXhzIiBheGlzTGluZT17ZmFsc2V9IHRpY2tMaW5lPXtmYWxzZX0gLz4KICAgICAgICAgICAgICA8WUF4aXMKICAgICAgICAgICAgICAgIGFsbG93RGVjaW1hbHM9e2ZhbGQ9Ik0xMS43NDk4IDE1LjYwNjNDMTEuMjU4OCAxNi41MjQ5IDExLjMyMjYgMTcuNTMyNiAxMS43NjA0IDE4LjMzMzdIOC4xNjc5NkM3Ljk5MjAzIDE4LjMzMzcgNy44NTMxNSAxOC4xOTQ4IDcuODUzMTUgMTguMDE4OEM3Ljg1MzE1IDE3LjAyODEgNy4zMjUzOCAxNi4xMjA3IDYuNDczNTMgMTUuNjIwN0M1LjYxMjQyIDE1LjEyMDcgNC41NDc2MSAxNS4xMjA3IDMuNjc3MjQgMTUuNjExNEMzLjYzMDk0IDE1LjYzOTIgMy41NzUzOCAxNS42NTc3IDMuNTE5ODIgMTUuNjU3N0MzLjQxNzk3IDE1LjY1NzcgMy4zMTYxMiAxNS42MDIyIDMuMjYwNTYgMTUuNTAwM0wxLjcxNDI1IDEyLjgzMzdDMS42MjE2NiAxMi42ODU1IDEuNjc3MjQgMTIuNTAwMyAxLjgyNTM5IDEyLjQwNzdIMS44MzQ2M0MyLjY4NjQ4IDExLjkwNzcgMy4yMTQyOCAxMC45OTExIDMuMjE0MjggOS45OTEwNkMzLjIxNDI4IDkuMDAwMzIgMi42ODY1IDguMDkyOTEgMS44MjUzOSA3LjU5MjkxQzEuNzIzNTQgNy41MjgxIDEuNjY3OTcgNy40MjYyNiAxLjY2Nzk3IDcuMzE1MTVDMS42Njc5NyA3LjI2ODg1IDEuNjc3MjQgNy4yMTMyOSAxLjcwNTAxIDcuMTY2OTlMMy4yNjA1NiA0LjUwMDMyQzMuMzQzOSA0LjM1MjE4IDMuNTI5MDkgNC4yOTY2MiAzLjY3NzI0IDQuMzg5MjJDNC4xMDMxNyA0LjYyOTk2IDQuNTg0NjUgNC43NTk1OCA1LjA2NjEzIDQuNzU5NThDNS41NTY4NyA0Ljc1OTU4IDYuMDM4MzQgNC42Mjk5NSA2LjQ3MzUzIDQuMzc5OTVDNy4zMzQ2NCAzLjg3OTk1IDcuODYyNDIgMi45NzI1NCA3Ljg2MjQyIDEuOTgxOEM3Ljg2MjQyIDEuODA1ODggOC4wMDEyOSAxLjY2Njk5IDguMTY3OTYgMS42NjY5OUgxMS44MzQ2QzEyLjAwMTMgMS42NjY5OSAxMi4xNDAyIDEuODA1ODggMTIuMTQwMiAxLjk4MThDMTIuMTQwMiAyLjk3MjU0IDEyLjY2OCAzLjg3OTk1IDEzLjUyOTEgNC4zNzk5NUMxMy45NjQzIDQuNjI5OTUgMTQuNDQ1NyA0Ljc1OTU4IDE0LjkzNjUgNC43NTk1OEMxNS40MTggNC43NTk1OCAxNS44OTk0IDQuNjI5OTYgMTYuMzI1NCA0LjM4OTIyQzE2LjM3MTcgNC4zNjE0NCAxNi40MjcyIDQuMzQyOTMgMTYuNDgyOCA0LjM0MjkzQzE2LjU4NDYgNC4zNDI5MyAxNi42ODY1IDQuMzk4NDcgMTYuNzQyIDQuNTAwMzJMMTguMjg4NCA3LjE2Njk5QzE4LjM4MDkgNy4zMTUxNCAxOC4zMjU0IDcuNTAwMzIgMTguMTc3MiA3LjU5MjkxQzE3LjY0NDYgNy45MDIxNiAxNy4yMzk1IDguMzcwNzkgMTcuMDA4IDguOTE3NzZDMTYuMDE5MSA4Ljk0MDI0IDE1LjA0MDEgOS40NTM1OSAxNC41MDMgMTAuNDU3NEwxMS43NDk4IDE1LjYwNjNaTTcuMjIzNTIgMTAuMDAwM0M3LjIyMzUyIDExLjUzNzQgOC40NjQyNyAxMi43NzgxIDEwLjAwMTMgMTIuNzc4MUMxMS41MzgzIDEyLjc3ODEgMTIuNzc5MSAxMS41Mzc0IDEyLjc3OTEgMTAuMDAwM0MxMi43NzkxIDguNDYzMjkgMTEuNTM4MyA3LjIyMjU1IDEwLjAwMTMgNy4yMjI1NUM4LjQ2NDI3IDcuMjIyNTUgNy4yMjM1MiA4LjQ2MzI5IDcuMjIzNTIgMTAuMDAwM1oiCiAgICAgICAgZmlsbD0iY3VycmVudENvbG9yIgogICAgICAgIGZpbGxSdWxlPSJldmVub2RkIgogICAgICAgIGNsaXBSdWxlPSJldmVub2RkIgogICAgICAvPgogICAgICA8UGF0aAogICAgICAgIGQ9Ik0yMS4wNzc5IDE2LjMxMzVMMTguMzI1IDExLjE2NTFDMTcuNzkxNyAxMC4xNjc2IDE2LjM1ODggMTAuMTY3NiAxNS44MjUgMTEuMTY1MUwxMy4wNzIyIDE2LjMxMzVDMTIuNTgzIDE3LjIyODUgMTMuMjQ3MiAxOC4zMzM1IDE0LjI4NjggMTguMzMzNUgxOS44NjMzQzIwLjkwMjUgMTguMzMzNSAyMS41NjcxIDE3LjIyODEgMjEuMDc3OSAxNi4zMTM1Wk0xNy4wNzUgMTMuMDIxQzE2LjkwMjUgMTMuMDIxIDE2Ljc2MjUgMTMuMTYxIDE2Ljc2MjUgMTMuMzMzNVYxNS4wMDAyQzE2Ljc2MjUgMTUuMTcyNyAxNi45MDI1IDE1LjMxMjcgMTcuMDc1IDE1LjMxMjdDMTcuMjQ3NSAxNS4zMTI3IDE3LjM4NzUgMTVySW5wdXRUeXBlID09PSAicGhvbmUiKSB7CiAgICAgIGxvY2F0aW9uLnBob25lTnVtYmVyID0gaW5wdXRWYWx1ZTsKICAgIH0KCiAgICBvbkxvY2F0aW9uQ2hhbmdlKGhvc3QudXNlcklkLCBsb2NhdGlvbik7CiAgICBzZXRQZW5kaW5nTG9jYXRpb25PcHRpb24obnVsbCk7CiAgfTsKCiAgY29uc3QgaGFuZGxlRGlhbG9nQ2xvc2UgPSAoKSA9PiB7CiAgICBzZXRJc0RpYWxvZ09wZW4oZmFsc2UpOwogICAgc2V0UGVuZGluZ0xvY2F0aW9uT3B0aW9uKG51bGwpOwogIH07CgogIHJldHVybiAoCiAgICA8PgogICAgICA8ZGl2IGNsYXNzTmFtZT0iYm9yZGVyLXN1YnRsZSBmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMyBib3JkZXItYiBweC0zIHB5LTMgbGFzdDpib3JkZXItYi0wIj4KICAgICAgICA8QXZhdGFyIHNpemU9InNtIiBpbWFnZVNyYz17YXZhdGFyVXJsfSBhbHQ9e2Rpc3BsYXlOYW1lfSAvPgogICAgICAgIDxkaXYgY2xhc3NOYW1lPSJtaW4tdy0wIGZsZXgtMSI+CiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0idGV4dC1lbXBoYXNpcyB0cnVuY2F0ZSB0ZXh0LXNtIGZvbnQtbWVkaXVtIj57ZGlzcGxheU5hbWV9PC9kaXY+CiAgICAgICAgICB7aG9zdERhdGE/LmVtYWlsICYmIDxkaXYgY2xhc3NOYW1lPSJ0ZXh0LXN1YnRsZSB0cnVuY2F0ZSB0ZXh0LXhzIj57aG9zdERhdGEuZW1haWx9PC9kaXY+fQogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGl0ZW1zLWNlbnRlciBnYXAtMiI+CiAgICAgICAgICB7Y3VycmVudExvY2F0aW9uICYmICFoYXNBcHBJbnN0YWxsZWQgJiYgKAogICAgICAgICAgICA8QmFkZ2UgdmFyaWFudD0ib3JhbmdlIiBjbGFzc05hbWU9IndoaXRlc3BhY2Utbm93cmFwIj4KICAgICAgICAgICAgICA8SWNvbiBuYW1lPSJ0cmlhbmdsZS1hbGVydCIgY2xhc3NOYW1lPSJtci0xIGgtMyB3LTMiIC8+CiAgICAgICAgICAgICAge3QoImFwcF9ub3RfaW5zdGFsbGVkIil9CiAgICAgICAgICAgIDwvQmFkZ2U+CiAgICAgICAgICApfQogICAgICAgICAgPExvY2F0aW9uU2VsZWN0CiAgICAgICAgICAgIHBsYWNlaG9sZGVyPXt0KCJzZWxlY3RfbG9jYXRpb24iKX0KICAgICAgICAgICAgb3B0aW9ucz17bG9jYXRpb25PcHRpb25zfQogICAgICAgICAgICB2YWx1ZT17c2VsZWN0ZWRPcHRpb259CiAgICAgICAgICAgIGlzU2VhcmNoYWJsZT17ZmFsc2V9CiAgICAgICAgICAgIGNsYXNzTmFtZT0idy03MiB0ZXh0LXNtIgogICAgICAgICAgICBtZW51UGxhY2VtZW50PSJhdXRvIgogICAgICAgICAgICBtZW51UG9ydGFsVGFyZ2V0PXt0eXBlb2YgZG9jdW1lbnQgIT09ICJ1bmRlZmluZWQiID8gZG9jdW1lbnQuYm9keSA6IG51bGx9CiAgICAgICAgICAgIHN0eWxlcz17ewogICAgICAgICAgICAgIG1lbnVQb3J0YWw6IChiYXNlKSA9PiAoeyAuLi5iYXNlLCB6SW5kZXg6IDk5OTkgfSkgYXMgQ1NTT2JqZWN0V2l0aExhYmVsLAogICAgICAgICAgICB9fQogICAgICAgICAgICBvbkNoYW5nZT17aGFuZGxlTG9jYXRpb25TZWxlY3R9CiAgICAgICAgICAvPgogICAgICAgICAge2hhc09yZ2FuaXplcklucHV0ICYmIGN1cnJlbnRMb2NhdGlvbiAmJiAoCiAgICAgICAgICAgIDxCdXR0b24gY29sb3I9Im1pbmltYWwiIHR5cGU9ImJ1dHRvbiIgU3RhcnRJY29uPSJwZW5jaWwiIG9uQ2xpY2s9e2hhbmRsZUVkaXRDbGlja30gLz4KICAgICAgICAgICl9CiAgICAgICAgPC9kaXY+CiAgICAgIDwvZGl2PgogICAgICA8TG9jYXRpb25JbnB1dERpYWxvZwogICAgICAgIGlzT3Blbj17aXNEaWFsb2dPcGVufQogICAgICAgIG9uQ2xvc2U9e2hhbmRsZURpYWxvZ0Nsb3NlfQogICAgICAgIGxvY2F0aW9uT3B0aW9uPXtwZW5kaW5nTG9jYXRpb25PcHRpb259CiAgICAgICAgb25TYXZlPXtoYW5kbGVEaWFsb2dTYXZlfQogICAgICAgIHRpdGxlPSJzZXRfbG9jYXRpb24iCiAgICAgICAgc2F2ZUJ1dHRvblRleHQ9InNhdmUiCiAgICAgICAgaW5pdGlhbFZhbHVlb3Q9ImNvbW1hbmQtc2hvcnRjdXQiCiAgICAgIGNsYXNzTmFtZT17Y24oCiAgICAgICAgInRleHQtbXV0ZWQtZm9yZWdyb3VuZCBtbC1hdXRvIHRleHQteHMgdHJhY2tpbmctd2lkZXN0IiwKICAgICAgICBjbGFzc05hbWUKICAgICAgKX0KICAgICAgey4uLnByb3BzfQogICAgLz4KICApCn0KCmV4cG9ydCB7CiAgQ29tbWFuZCwKICBDb21tYW5kRGlhbG9nLAogIENvbW1hbmRJbnB1dCwKICBDb21tYW5kTGlzdCwKICBDb21tYW5kRW1wdHksCiAgQ29tbWFuZEdyb3VwLAogIENvbW1hbmRJdGVtLAogIENvbW1hbmRTaG9ydGN1dCwKICBDb21tYW5kU2VwYXJhdG9yLAp9CiJ1c2UgY2xpZW50IjsKCmltcG9ydCBwb3N0aG9nIGZyb20gInBvc3Rob2ctanMiOwppbXBvcnQgeyB1c2VTdGF0ZSB9IGZyb20gInJlYWN0IjsKaW1wb3J0IHsgQ29udHJvbGxlciwgdXNlRm9ybSB9IGZyb20gInJlYWN0LWhvb2stZm9ybSI7CgppbXBvcnQgeyB1c2VPcmdCcmFuZGluZyB9IGZyb20gIkBjYWxjb20vZmVhdHVyZXMvZWUvb3JnYW5pemF0aW9ucy9jb250ZXh0L3Byb3ZpZGVyIjsKaW1wb3J0IHsgc3ViZG9tYWluU3VmZml4IH0gZnJvbSAiQGNhbGNvbS9mZWF0dXJlcy9lZS9vcmdhbml6YXRpb25zL2xpYi9vcmdEb21haW5zIjsKaW1wb3J0IHR5cGUgeyBOZXdUZWFtRm9ybVZhbHVlcyB9IGZyb20gIkBjYWxjb20vZmVhdHVyZXMvZWUvdGVhbXMvbGliL3R5cGVzIjsKaW1wb3J0IHsgdXNlTG9jYWxlIH0gZnJvbSAiQGNhbGNvbS9saWIvaG9va3MvdXNlTG9jYWxlIjsKaW1wb3J0IHNsdWdpZnkgZnJvbSAiQGNhbGNvbS9saWIvc2x1Z2lmeSI7CmltcG9ydCB0eXBlIHsgUm91dGVyT3V0cHV0cyB9IGZyb20gIkBjYWxjb20vdHJwYy9yZWFjdCI7CmltcG9ydCB7IHRycGMgfSBmcm9tICJAY2FsY29tL3RycGMvcmVhY3QiOwppbXBvcnQgeyBBbGVydCB9IGZyb20gIkBjYWxjb20vdWkvY29tcG9uZW50cy9hbGVydCI7CmltcG9ydCB7IEJ1dHRvbiB9IGZyb20gIkBjYWxjb20vdWkvY29tcG9uZW50cy9idXR0b24iOwppbXBvcnQgeyBEaWFsb2dGb290ZXIgfSBmcm9tICJAY2FsY29tL3VpL2NvbXBvbmVudHMvZGlhbG9nIjsKaW1wb3J0IHsgRm9ybSB9IGZyb20gIkBjYWxjb20vdWkvY29tcG9uZW50cy9mb3JtIjsKaW1wb3J0IHsgVGV4dEZpZWxkIH0gZnJvbSAiQGNhbGNvbS91aS9jb21wb25lbnRzL2Zvcm0iOwppbXBvcnQgeyByZXZhbGlkYXRlRXZlbnRUeXBlc0xpc3QgfSBmcm9tICJAY2FsY29tL3dlYi9hcHAvKHVzZS1wYWdlLXdyYXBwZXIpLyhtYWluLW5hdikvZXZlbnQtdHlwZXMvYWN0aW9ucyI7CmltcG9ydCB7IHJldmFsaWRhdGVUZWFtc0xpc3QgfSBmcm9tICJAY2FsY29tL3dlYi9hcHAvKHVzZS1wYWdlLXdyYXBwZXIpLyhtYWluLW5hdikvdGVhbXMvYWN0aW9ucyI7CgppbnRlcmZhY2UgQ3JlYXRlQU5ld1RlYW1Gb3JtUHJvcHMgewogIG9uQ2FuY2VsOiAoKSA9PiB2b2lkOwogIHN1Ym1pdExhYmVsOiBzdHJpbmc7CiAgb25TdWNjZXNzOiAoZGF0YTogUm91dGVyT3V0cHV0c1sidmlld2VyIl1bInRlYW1zIl1bImNyZWF0ZSJdKSA9PiB2b2lkOwogIGluRGlhbG9nPzogYm9vbGVhbjsKICBzbHVnPzogc3RyaW5nOwp9CgpleHBvcnQgY29uc3QgQ3JlYXRlQU5ld1RlYW1Gb3JtID0gKHByb3BzOiBDcmVhdGVBTmV3VGVhbUZvcm1Qcm9wcykgPT4gewogIGNvbnN0IHsgaW5EaWFsb2csIG9uQ2FuY2VsLCBzbHVnLCBzdWJtaXRMYWJlbCwgb25TdWNjZXNzIH0gPSBwcm9wczsKICBjb25zdCB7IHQsIGlzTG9jYWxlUmVhZHkgfSA9IHVzZUxvY2FsZSgpOwogIGNvbnN0IFtzZXJ2ZXJFcnJvck1lc3NhZ2UsIHNldFNlcnZlckVycm9yTWVzc2FnZV0gPSB1c2VTdGF0ZTxzdHJpbmcgfCBudWxsPihudWxsKTsKICBjb25zdCBvcmdCcmFuZGluZyA9IHVzZU9yZ0JyYW5kaW5nKCk7CgogIGNvbnN0IG5ld1RlYW1Gb3JtTWV0aG9kcyA9IHVzZUZvcm08TmV3VGVuc3Qga2V5ID0gY3VycmVuY3lMaXN0Um93S2V5KGN1cnJlbmN5KQoKICBjb25zdCB3YXJuaW5nU2V2ZXJpdHkgPSBnZXRUb2tlbldhcm5pbmdTZXZlcml0eShjdXJyZW5jeUluZm8pCiAgY29uc3QgaXNCbG9ja2VkVG9rZW4gPSB3YXJuaW5nU2V2ZXJpdHkgPT09IFdhcm5pbmdTZXZlcml0eS5CbG9ja2VkCiAgY29uc3QgYmxvY2tlZFRva2VuT3BhY2l0eSA9ICcwLjYnCgogIGNvbnN0IHsgYmFsYW5jZU1hcCB9ID0gdXNlVG9rZW5CYWxhbmNlcyh7IGNhY2hlT25seTogdHJ1ZSB9KQogIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tdW5uZWNlc3NhcnktY29uZGl0aW9uCiAgY29uc3QgeyB1c2RWYWx1ZSwgYmFsYW5jZTogY2FjaGVkQmFsYW5jZSB9ID0gYmFsYW5jZU1hcFtjdXJyZW5jeUtleShjdXJyZW5jeSldID8/IHt9CiAgY29uc3QgdG9rZW5CYWxhbmNlID0gYmFsYW5jZSA/IGJhbGFuY2UudG9FeGFjdCgpIDogY2FjaGVkQmFsYW5jZQoKICBjb25zdCBXcmFwcGVyID0gdG9vbHRpcCA/IE1vdXNlb3ZlclRvb2x0aXAgOiBSb3dXcmFwcGVyCgogIC8vIG9ubHkgc2hvdyBhZGQgb3IgcmVtb3ZlIGJ1dHRvbnMgaWYgbm90IG9uIHNlbGVjdGVkIGxpc3QKICByZXR1cm4gKAogICAgPFRyYWNlCiAgICAgIGxvZ1ByZXNzCiAgICAgIGxvZ0tleVByZXNzCiAgICAgIGV2ZW50T25UcmlnZ2VyPXtVbmlzd2FwRXZlbnROYW1lLlRva2VuU2VsZWN0ZWR9CiAgICAgIHByb3BlcnRpZXM9e3sgLi4uZXZlbnRQcm9wZXJ0aWVzLCB0b2tlbl9iYWxhbmNlX3VzZDogdXNkVmFsdWUgfX0KICAgICAgZWxlbWVudD17RWxlbWVudE5hbWUuVG9rZW5TZWxlY3RvclJvd30KICAgID4KICAgICAgPFdyYXBwZXIKICAgICAgICBzdHlsZT17c3R5bGV9CiAgICAgICAgdGV4dD17PFRoZW1lZFRleHQuQ2FwdGlvbiB0ZXh0QWxpZ249ImNlbnRlciI+e3Rvb2x0aXB9PC9UaGVtZWRUZXh0LkNhcHRpb24+fQogICAgICAgIHNpemU9e1Rvb2x0aXBTaXplLkV4dHJhU21hbGx9CiAgICAgID4KICAgICAgICA8TWVudUl0ZW0KICAgICAgICAgIHRhYkluZGV4PXswfQogICAgICAgICAgY2xhc3NOYW1lPXtgdG9rZW4taXRlbS0ke2tleX1gfQogICAgICAgICAgb25LZXlEb3duPXsoZSkgPT4gKGUua2V5ID09PSAnRW50ZXInID8gb25TZWxlY3Qod2FybmluZ1NldmVyaXR5ID09PSBXYXJuaW5nU2V2ZXJpdHkuTm9uZSkgOiBudWxsKX0KICAgICAgICAgIG9uQ2xpY2s9eygpID0+IG9uU2VsZWN0KHdhcm5pbmdTZXZlcml0eSA9PT0gV2FybmluZ1NldmVyaXR5Lk5vbmUpfQogICAgICAgICAgc2VsZWN0ZWQ9e290aGVyU2VsZWN0ZWQgfHwgaXNTZWxlY3RlZH0KICAgICAgICAgIGRpbT17aXNCbG9ja2VkVG9rZW59CiAgICAgICAgICBkaXNhYmxlZD17ZGlzYWJsZWR9CiAgICAgICAgICBzdHlsZT17eyBvdXRsaW5lOiAnbm9uZScgfX0KICAgICAgICA+CiAgICAgICAgICA8Q3VycmVuY3lMb2dvIGN1cnJlbmN5PXtjdXJyZW5jeX0gc2l6ZT17MzZ9IHN0eWxlPXt7IG9wYWNpdHk6IGlzQmxvY2tlZFRva2VuID8gYmxvY2tlZFRva2VuT3BhY2l0eSA6ICcxJyB9fSAvPgogICAgICAgICAgPEZsZXggc3R5bGU9e3sgb3BhY2l0eTogaXNCbG9ja2VkVG9rZW4gPyBibG9ja2VkVG9rZW5PcGFjaXR5IDogJzEnIH19IGdhcD0iJHNwYWNpbmcyIj4KICAgICAgICAgICAgPEZsZXggcm93IGFsaWduSXRlbXM9ImNlbnRlciIgZ2FwPSIkc3BhY2luZzQiPgogICAgICAgICAgICAgIDxDdXJyZW5jeU5hbWUgdmFyaWFudD0iYm9keTIiPntjdXJyZW5jeS5uYW1lfTwvQ3VycmVuY3lOYW1lPgogICAgICAgICAgICAgIDxXYXJuaW5nSWNvbiBzZXZlcml0eT17d2FybmluZ1NldmVyaXR5fSBzaXplPSIkaWNvbi4xNiIgbWw9IiRzcGFjaW5nNCIgLz4KICAgICAgICAgICAgPC9GbGV4PgogICAgICAgICAgICA8RmxleCByb3cgYWxpZ25JdGVtcz0iY2VudGVyIiBnYXA9IiRzcGFjaW5nOCI+CiAgQzE0LjM5NDEgOS44MDA0MyAxNC45NDkxIDguMDExMjggMTMuODc2OCA4LjAxMTI4QzEyLjkzOTEgOC4wMTEyOCAxMS40NzMyIDkuODMyNzcgMTEuMTAxNCA5LjgzMjc3QzExLjA1MjkgOS44MzI3NyAxMS4wMTUyIDkuODA1ODMgMTEuMDE1MiA5Ljc0MTE3QzExLjAxNTIgOS41NDcxNyAxMS4yNTc2IDkuMTEwNjYgMTEuMjU3NiA4LjY3NDE0QzExLjI1NzYgOC4xMzUyNiAxMC44MTAzIDcuNzkwMzQgMTAuMTA5OCA3Ljc5MDM0QzkuNzI3MTcgNy43OTAzNCA5LjM0OTk0IDcuODI4MDYgOC45ODg4OSA3Ljg5ODExQzguODcwMzEgNS4wNTgxMSA3LjUyMzA2IDIuODIxNjYgNS40NjQ0NiAyLjgyMTY2QzQuMDc5NDkgMi44MjE2NiAzLjAxMjQ2IDQuMDAxODYgMy4wMTI0NiA1LjUwNTRDMy4wMTI0NiA3LjI2MjIzIDQuMTU0OTQgOC43NjU3NCA1LjU3NzYzIDkuNzYyNzFDNC45NDcxMSAxMC4zODI1IDQuNDU2NzEgMTEuMDg4NCA0LjE1NDk0IDExLjc2MjFIMC4zMzk1MTRDMC4xNTA4ODYgMTEuNzYyMSAwIDExLjkwMjIgMCAxMi4wOTA4QzAgMTIuMjc5NCAwLjE1MDg4NiAxMi40MjQ5IDAuMzM5NTE0IDEyLjQyNDlaTTMuODMxNiA1LjUwNTRDMy44MzE2IDQuNDU0NTQgNC41NDI5NCAzLjY0MDggNS40NjQ0NiAzLjY0MDhDNy4wODExNyAzLjY0MDggOC4xMjY2MyA1LjY1MDkxIDguMTc1MTQgOC4xMTkwOEM3LjQzMTQ2IDguMzc3NzQgNi43NTI0MyA4Ljc3MTE0IDYuMTY1MDMgOS4yMzk5N0M1LjA0NDExIDguNDYzOTcgMy44MzE2IDcuMTgxNCAzLjgzMTYgNS41MDU0Wk0wLjE4MzIyOSAxMC42MTQyQzAuMzIzMzQzIDEwLjc1NDMgMC41MzM1MTQgMTAuNzQ4OSAwLjY3OSAxMC42MTQyTDEuMzUyNjMgOS45NDA1N0wyLjAyNjI2IDEwLjYxNDJDMi4xNjYzNyAxMC43NTQzIDIuMzgxOTQgMTAuNzU0MyAyLjUyMjA2IDEwLjYxNDJDMi42NjIxNyAxMC40NzQxIDIuNjYyMTcgMTAuMjU4NSAyLjUyMjA2IDEwLjExODRMMS44NDg0MyA5LjQ1MDE3TDIuNTIyMDYgOC43NzY1NEMyLjY2MjE3IDguNjM2NDMgMi42NjIxNyA4LjQyNjI2IDIuNTIyMDYgOC4yODYxMUMyLjM4MTk0IDguMTQwNjMgMi4xNjYzNyA4LjE0NjAzIDIuMDI2MjYgOC4yODYxMUwxLjM1MjYzIDguOTU0MzdMMC42NzkgOC4yODYxMUMwLjUzMzUxNCA4LjE0MDYzIDAuMzIzMzQzIDguMTQwNjMgMC4xODMyMjkgOC4yODYxMUMwLjA0MzExNDMgOC40MjYyNiAwLjA0MzExNDMgOC42NDE4IDAuMTgzMjI5IDguNzc2NTRMMC44NTY4NTcgOS40NTAxN0wwLjE4MzIyOSAxMC4xMTg0QzAuMDQzMTE0MyAxMC4yNjM5IDAuMDQzMTE0MyAxMC40NzQxIDAuMTgzMjI5IDEwLjYxNDJaTTYuNzUyNDMgMTAuNDQxN0M2LjgyMjQ5IDEwLjQ3NDEgNi44ODcxNyAxMC40OTAyIDYuOTUxODMgMTAuNDkwMkM3LjE3Mjc3IDEwLjQ5MDIgNy4zMjkwNiAxMC4zMTc4IDcuMzI5MDYgMTAuMTM0NkM3LjMyOTA2IDkuOTk5ODMgNy4yNjQ0IDkuODcwNTEgNy4xMDgxMSA5Ljc5NTA2QzcuMDMyNjYgOS43NTczNCA2Ljk1NzIzIDkuNzE5NiA2Ljg3NjQgOS42NzY0OEM3LjI2NDQgOS40MDE2NiA3LjY5NTUxIDkuMTU5MTQgOC4xNTg5NyA4Ljk3NTkxQzguMDk0MjkgMTAuMDE2IDcuODk0OTEgMTAuOTc1MyA3LjU4Nzc0IDExLjc2MjFINS4wMjI1N0M1LjMwMjc3IDExLjIzMzkgNS43MjMxMSAxMC42Nzg5IDYuMjU2NjMgMTAuMTg4NUM2LjQxODMxIDEwLjI4MDEgNi41ODUzNyAxMC4zNjA5IDYuNzUyNDMgMTAuNDQxN1pNNC42NDUzMSAxMy4wNDQ2QzQuNjQ1MzEgMTIuODU2IDQuNjc3NjYgMTIuNjQ1OSA0Ljc0NzcxIDEyLjQyNDlINy4yODA1N0M2Ljc5NTU0IDEzLjMxOTUgNi4xNDM0OSAxMy44NjkxIDUuMzk5OCAxMy44NjkxQzQuODgyNDYgMTMuODY5MSA0LjY0NTMxIDEzLjUyOTcgNC42NDUzMSAxMy4wNDQ2WiIKICAgICAgICAgIGZpbGw9ImN1cnJlbnRDb2xvciIKICAgICAgICAvPgogICAgICA8L0c+CiAgICA8L1N2Zz4KICApLAogIGRlZmF1bHRGaWxsOiAnI0lkID0gY29ubmVjdGVkQWNjb3VudC5jaGFpbklkCiAgY29uc3QgYWNjb3VudCA9IHVzZVdhbGxldCgpLmV2bUFjY291bnQKICBjb25zdCB0cmFjZSA9IHVzZVRyYWNlKCkKICBjb25zdCB7IG5lZWRzUGFzc2tleVNpZ25pbiB9ID0gdXNlR2V0UGFzc2tleUF1dGhTdGF0dXMoY29ubmVjdGVkQWNjb3VudC5jb25uZWN0b3I/LmlkKQogIGNvbnN0IGRpc2FibGVPbmVDbGlja1N3YXAgPSB1c2VTZXRPdmVycmlkZU9uZUNsaWNrU3dhcEZsYWcoKQoKICBjb25zdCB7IGZvcm1hdEN1cnJlbmN5QW1vdW50LCBmb3JtYXRQZXJjZW50LCBjb252ZXJ0RmlhdEFtb3VudEZvcm1hdHRlZCB9ID0gdXNlTG9jYWxpemF0aW9uQ29udGV4dCgpCgogIGNvbnN0IHsKICAgIHNldFN0ZXAsCiAgICBkZXJpdmVkSW5jcmVhc2VMaXF1aWRpdHlJbmZvLAogICAgaW5jcmVhc2VMaXF1aWRpdHlTdGF0ZSwKICAgIGN1cnJlbnRUcmFuc2FjdGlvblN0ZXAsCiAgICBzZXRDdXJyZW50VHJhbnNhY3Rpb25TdGVwLAogIH0gPSB1c2VJbmNyZWFzZUxpcXVpZGl0eUNvbnRleHQoKQogIGNvbnN0IHsgdHhJbmZvLCBnYXNGZWVFc3RpbWF0ZVVTRCwgZGVwZW5kZW50QW1vdW50LCBzZXRUcmFuc2FjdGlvbkVycm9yIH0gPSB1c2VJbmNyZWFzZUxpcXVpZGl0eVR4Q29udGV4dCgpCgogIGNvbnN0IHsgZXhhY3RGaWVsZCB9ID0gaW5jcmVhc2VMaXF1aWRpdHlTdGF0ZQogIGNvbnN0IHsgY3VycmVuY3lBbW91bnRzLCBjdXJyZW5jeUFtb3VudHNVU0RWYWx1ZSB9ID0gZGVyaXZlZEluY3JlYXNlTGlxdWlkaXR5SW5mbwoKICBjb25zdCB7IHVwZGF0ZWRDdXJyZW5jeUFtb3VudHMsIHVwZGF0ZWRVU0RBbW91bnRzIH0gPSB1c2VVcGRhdGVkQW1vdW50c0Zyb21EZXBlbmRlbnRBbW91bnQoewogICAgdG9rZW4wOiBjdXJyZW5jeUFtb3VudHM/LlRPS0VOMD8uY3VycmVuY3ksCiAgICB0b2tlbjE6IGN1cnJlbmN5QW1vdW50cz8uVE9LRU4xPy5jdXJyZW5jeSwKICAgIGRlcGVuZGVudEFtb3VudCwKICAgIGV4YWN0RmllbGQsCiAgICBjdXJyZW5jeUFtb3VudHMsCiAgICBjdXJyZW5jeUFtb3VudHNVU0RWYWx1ZSwKICB9KQoKICBjb25zdCBbc3RlcHMsIHNldFN0ZXBzXSA9IHVzZVN0YXRlPFRyYW5zYWN0aW9uU3RlcFtdPihbXSkKCiAgaWYgKCFpbmNyZWFzZUxpcXVpZGl0eVN0YXRlLnBvc2l0aW9uKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoJ0luY3JlYXNlTGlxdWlkaXR5TW9kYWwgbXVzdCBoYXZlIGFuIGluaXRpYWwgc3RhdGUgd2hlbiBvcGVuaW5nJykKICB9CgogIGNvbnN0IHsKICAgIHZlcnNpb24sCiAgICBwb29sSWQsCiAgICBjdXJyZW5jeTBBbW91bnQsCiAgICBjdXJyZW5jeTFBbW91bnQsCiAgICBmZWUwQW1vdW50LAogICAgZmVlMUFtb3VudCwKICAgIGZlZVRpZXIsCiAgICB2NGhvb2ssCiAgICB0aWNrU3BhY2luZywKICAgIHRpY2tMb3dlciwKICAgIHRpY2tVcHBlciwKICAgIGNoYWluSWQsCiAgfSA9IGluY3JlYXNlTGlxdWlkaXR5U3RhdGUucG9zaXRpb24KCiAgY29uc3QgZmlhdEZlZVZhbHVlMCA9IHVzZVVTRENWYWx1ZShmZWUwQW1vdW50LCBQb2xsaW5nSW50ZXJ2YWwuU2xvdykKICBjb25zdCBmaWF0RmVlVmFsdWUxID0gdXNlVVNEQ1ZhbHVlKGZlZTFBbW91bnQsIFBvbGxpbmdJbnRlcnZhbC5TbG93KQoKICBjb25zdCBjdXJyZW50UHJpY2UgPSBpbmNyZWFzZUxpcXVpZGl0eVN0YXRlLnBvc2l0aW9uLnBvb2xPclBhaXI/LnRva2VuMVByaWNlCiAgY29uc3QgcG9vbFRva2VuUGVyY2VudGFnZSA9IHVzZUdldFBvb2xUb2tlblBlcmNlbnRhZ2UoaW5jcmVhc2VMaXF1aWRpdHlTdGF0ZS5wb3NpdGlvbikKCiAgY29uc3QgY3VycmVuY3kwQ3VycmVuY3lJbmZvID0gdXNlQ3VycmVuY3lJbmZvKGN1cnJlbmN5MEFtb3VudC5jdXJyZW5jeSkKICBjb25zdCBjdXJyZW5jeTFDdXJyZW5jeUluZm8gPSB1c2VDdXJyZW5jeUluZm8oY3VycmVuY3kxQW1vdW50LmN1cnJlbmN5KQoKICBjb25zdCBuZXdUb2tlbjBBbW9hbXMuaW1wb3J0VHlwZSA9PT0gSW1wb3J0VHlwZS5XYXRjaCkgewogICAgICBhd2FpdCBvblByZXNzTmV4dCgpCiAgICB9IGVsc2UgewogICAgICBzZXRTaG93V2FybmluZ01vZGFsKHRydWUpCiAgICB9CiAgfSwgW29uUHJlc3NOZXh0LCBwYXJhbXMuaW1wb3J0VHlwZV0pCgogIGNvbnN0IG9uUHJlc3NFbmFibGVTZWN1cml0eSA9IHVzZUNhbGxiYWNrKGFzeW5jICgpID0+IHsKICAgIGNvbnN0IGlzT1NCaW9tZXRyaWNBdXRoRW5hYmxlZCA9IGF3YWl0IGNoZWNrT3NCaW9tZXRyaWNBdXRoRW5hYmxlZCgpCiAgICBjb25zdCBhdXRoU3RhdHVzID0gYXdhaXQgdHJ5TG9jYWxBdXRoZW50aWNhdGUoKQoKICAgIGlmICghaXNPU0Jpb21ldHJpY0F1dGhFbmFibGVkIHx8IGF1dGhTdGF0dXMgPT09IEJpb21ldHJpY0F1dGhlbnRpY2F0aW9uU3RhdHVzLlJlamVjdGVkKSB7CiAgICAgIHNob3dCaW9tZXRyaWNzQWxlcnQoYmlvbWV0cmljc01ldGhvZCkKICAgICAgcmV0dXJuCiAgICB9CgogICAgaWYgKGJpb21ldHJpY0F1dGhlbnRpY2F0aW9uU3VjY2Vzc2Z1bChhdXRoU3RhdHVzKSkgewogICAgICBkaXNwYXRjaChzZXRSZXF1aXJlZEZvclRyYW5zYWN0aW9ucyh0cnVlKSkKICAgICAgYXdhaXQgb25QcmVzc05leHQoKQogICAgfQogIH0sIFtiaW9tZXRyaWNzTWV0aG9kLCBkaXNwYXRjaCwgb25QcmVzc05leHQsIHNob3dCaW9tZXRyaWNzQWxlcnRdKQoKICBjb25zdCBvbkNsb3NlTW9kYWwgPSB1c2VDYWxsYmFjaygoKSA9PiBzZXRTaG93V2FybmluZ01vZGFsKGZhbHNlKSwgW10pCgogIHJldHVybiAoCiAgICA8PgogICAgICA8QmlvbWV0cmljQXV0aFdhcm5pbmdNb2RhbAogICAgICAgIGlzT3Blbj17c2hvd1dhcm5pbmdNb2RhbH0KICAgICAgICBpc1RvdWNoSWREZXZpY2U9e2lzVG91Y2hJZERldmljZX0KICAgICAgICBvbkNsb3NlPXtvbkNsb3NlTW9kYWx9CiAgICAgICAgb25Db25maXJtPXtvblByZXNzTmV4dH0KICAgICAgLz4KICAgICAge2lzTG9hZGluZ0FjY291bnQgJiYgKAogICAgICAgIDxGbGV4IGNlbnRlcmVkIG10PSIkc3BhY2luZzYwIiBwb3NpdGlvbj0iYWJzb2x1dGUiIHB0PSIkc3BhY2luZzM2IiB3aWR0aD0iMTAwJSIgekluZGV4PXsxMDB9PgogICAgICAgICAgPEFjdGl2aXR5SW5kaWNhdG9yIGNvbG9yPXtjb2xvcnMud2hpdGUudmFsfSAvPgogICAgICAgIDwvRmxleD4KICAgICAgKX0KICAgICAgPE9uYm9hcmRpbmdTY3JlZW4KICAgICAgICBJY29uPXtMb2NrfQogICAgICAgIGNoaWxkcmVuR2FwPSIkbm9uZSIKICAgICAgICBzdWJ0aXRsZT17CiAgICAgICAgICBpc0lPUwogICAgICAgICAgICA/IHQoJ29uYm9hcmRpbmcuc2VjdXJpdHkuc3VidGl0bGUuaW9zJywgewogICAgICAgICAgICAgICAgYmlvbWV0cmljc01ldGhvZCwKICAgICAgICAgICAgICB9KQogICAgICAgICAgICA6IHQoJ29uYm9hcmRpbmcuc2VjdXJpdHkuc3VidGl0bGUuYW5kcm9pZCcpCiAgICAgICAgfQogICAgICAgIHRpdGxlPXt0KCdvbmJvYXJkaW5nLnNlY3VyaXR5LnRpdGxlJyl9CiAgICAgICAgb25Ta2lwPXtvblNraXBQcmVzc2VkfQogICAgICA+CiAgICAgICAgPEZsZXggY2VudGVyZWQgc2hyaW5rIGdhcD0iJHNwYWNpbmcxNiI+CiAgICAgICAgICA8RmxleD4KICAgICAgICAgICAgPFNlY3VyaXR5QmFja2dyb3VuZEltYWdlIC8+CiAgICAgICAgICA8L0ZsZXg+CiAgICAgICAgPC9GbGV4PgogICAgICAgIDxUcmFjZSBsb2dQcmVzcyBlbGVtZW50PXtFbGVtZW50TmFtZS5FbmFibGV9PgogICAgICAgICAgPEZsZXggY2VudGVyZWQgcm93PgogICAgICAgICAgICA8QnV0dG9uIHNpemU9ImxhcmdlIiB2YXJpYW50PSJicmFuZGVkIiBvblByZXNzPXtvblByZXNzRW5hYmxlU2VjdXJpdHl9PgogICAgICAgICAgICAgIHtpc0lPUwogICAgICAgICAgICAgICAgPyB0KCdvbmJvYXJkaW5nLnNlY3VyaXR5LmJ1dHRvbi5jb25maXJtLmlvcycsIHsgYmlvbWV0cmljc01ldGhvZCB9KQogYXJ5OiBbCiAgICB7CiAgICAgIHRpdGxlOiAiU3VwcG9ydCIsCiAgICAgIHVybDogIiMiLAogICAgICBpY29uOiBMaWZlQnVveSwKICAgIH0sCiAgICB7CiAgICAgIHRpdGxlOiAiRmVlZGJhY2siLAogICAgICB1cmw6ICIjIiwKICAgICAgaWNvbjogU2VuZCwKICAgIH0sCiAgXSwKICBwcm9qZWN0czogWwogICAgewogICAgICBuYW1lOiAiRGVzaWduIEVuZ2luZWVyaW5nIiwKICAgICAgdXJsOiAiIyIsCiAgICAgIGljb246IEZyYW1lLAogICAgfSwKICAgIHsKICAgICAgbmFtZTogIlNhbGVzICYgTWFya2V0aW5nIiwKICAgICAgdXJsOiAiIyIsCiAgICAgIGljb246IFBpZUNoYXJ0LAogICAgfSwKICAgIHsKICAgICAgbmFtZTogIlRyYXZlbCIsCiAgICAgIHVybDogIiMiLAogICAgICBpY29uOiBNYXAsCiAgICB9LAogIF0sCn0KCmNvbnN0IGNvbXBvbmVudHM6IHsgdGl0bGU6IHN0cmluZzsgaHJlZjogc3RyaW5nOyBkZXNjcmlwdGlvbjogc3RyaW5nIH1bXSA9IFsKICB7CiAgICB0aXRsZTogIkFsZXJ0IERpYWxvZyIsCiAgICBocmVmOiAiL2RvY3MvcHJpbWl0aXZlcy9hbGVydC1kaWFsb2ciLAogICAgZGVzY3JpcHRpb246CiAgICAgICJBIG1vZGFsIGRpYWxvZyB0aGF0IGludGVycnVwdHMgdGhlIHVzZXIgd2l0aCBpbXBvcnRhbnQgY29udGVudCBhbmQgZXhwZWN0cyBhIHJlc3BvbnNlLiIsCiAgfSwKICB7CiAgICB0aXRsZTogIkhvdmVyIENhcmQiLAogICAgaHJlZjogIi9kb2NzL3ByaW1pdGl2ZXMvaG92ZXItY2FyZCIsCiAgICBkZXNjcmlwdGlvbjoKICAgICAgIkZvciBzaWdodGVkIHVzZXJzIHRvIHByZXZpZXcgY29udGVudCBhdmFpbGFibGUgYmVoaW5kIGEgbGluay4iLAogIH0sCiAgewogICAgdGl0bGU6ICJQcm9ncmVzcyIsCiAgICBocmVmOiAiL2RvY3MvcHJpbWl0aXZlcy9wcm9ncmVzcyIsCiAgICBkZXNjcmlwdGlvbjoKICAgICAgIkRpc3BsYXlzIGFuIGluZGljYXRvciBzaG93aW5nIHRoZSBjb21wbGV0aW9uIHByb2dyZXNzIG9mIGEgdGFzaywgdHlwaWNhbGx5IGRpc3BsYXllZCBhcyBhIHByb2dyZXNzIGJhci4iLAogIH0sCiAgewogICAgdGl0bGU6ICJTY3JvbGwtYXJlYSIsCiAgICBocmVmOiAiL2RvY3MvcHJpbWl0aXZlcy9zY3JvbGwtYXJlYSIsCiAgICBkZXNjcmlwdGlvbjogIlZpc3VhbGx5IG9yIHNlbWFudGljYWxseSBzZXBhcmF0ZXMgY29udGVudC4iLAogIH0sCiAgewogICAgdGl0bGU6ICJUYWJzIiwKICAgIGhyZWY6ICIvZG9jcy9wcmltaXRpdmVzL3RhYnMiLAogICAgZGVzY3JpcHRpb246CiAgICAgICJBIHNldCBvZiBsYXllcmVkIHNlY3Rpb25zIG9mIGNvbnRlbnTigJRrbm93biBhcyB0YWIgcGFuZWxz4oCUdGhhdCBhcmUgZGlzcGxheWVkIG9uZSBhdCBhIHRpbWUuIiwKICB9LAogIHsKICAgIHRpdGxlOiAiVG9vbHRpcCIsCiAgICBocmVmOiAiL2RvY3MvcHJpbWl0aXZlcy90b29sdGlwIiwKICAgIGRlc2NyaXB0aW9uOgogICAgICAiQSBwb3B1cCB0aGF0IGRpc3BsYXlzIGluZm9ybWF0aW9uIHJlbGF0ZWQgdG8gYW4gZWxlbWVudCB3aGVuIHRoZSBlbGVtZW50IHJlY2VpdmVzIGtleWJvYXJkIGZvY3VzIG9yIHRoZSBtb3VzZSBob3ZlcnMgb3ZlciBpdC4iLAogIH0sCl0KCmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIFBhZ2UoKSB7CiAgY29uc3QgW29wZW4sIHNldE9wZW5dID0gUmVhY3QudXNlU3RhdGUodHJ1ZSkKICBjb25zdCB7IGlzTW9iaWxlIH0gPSB1c2VTaWRlYmFyKCkKCiAgcmV0dXJuICgKICAgIDxkaXYKICAgICAgc3R5bGU9ewogICAgICAgIHsKICAgICAgICAgICItLWhlYWRlci1oZWlnaHQiOiBIRUFERVJfSEVJR0hULAogICAgICAgIH0gYXMgUmVhY3QuQ1NTUHJvcGVydGllcwogICAgICB9CiAgICA+CiAgICAgIDxoZWFkZXIgY2xhc3NOYW1lPSJzdGlja3kgdG9wLTAgYmctc2lkZWJhciBmbGV4IGgtWy0taGVhZGVyLWhlaWdodF0gc2hyaW5rLTAgaXRlbXMtY2VudGVyIGdhcC0yIGJvcmRlci1iIHB4LTQgaXNvbHJvbSAibmV4dC1hdXRoL3JlYWN0IjsKaW1wb3J0IHsgdXNlTWVtbyB9IGZyb20gInJlYWN0IjsKCmltcG9ydCB7IHVzZUlzRW1iZWQgfSBmcm9tICJAY2FsY29tL2VtYmVkLWNvcmUvZW1iZWQtaWZyYW1lIjsKaW1wb3J0IHsKICB1c2VPcmdCcmFuZGluZywKICB0eXBlIE9yZ2FuaXphdGlvbkJyYW5kaW5nLAp9IGZyb20gIkBjYWxjb20vZmVhdHVyZXMvZWUvb3JnYW5pemF0aW9ucy9jb250ZXh0L3Byb3ZpZGVyIjsKaW1wb3J0IHsgdXNlSXNTdGFuZGFsb25lIH0gZnJvbSAiQGNhbGNvbS9saWIvaG9va3MvdXNlSXNTdGFuZGFsb25lIjsKaW1wb3J0IGNsYXNzTmFtZXMgZnJvbSAiQGNhbGNvbS91aS9jbGFzc05hbWVzIjsKaW1wb3J0IHsgdXNlSGFzUGFpZFBsYW4gfSBmcm9tICJAY2FsY29tL3dlYi9tb2R1bGVzL2JpbGxpbmcvaG9va3MvdXNlSGFzUGFpZFBsYW4iOwoKaW1wb3J0IFVuY29uZmlybWVkQm9va2luZ0JhZGdlIGZyb20gIi4uLy4uL2Jvb2tpbmdzL2NvbXBvbmVudHMvVW5jb25maXJtZWRCb29raW5nQmFkZ2UiOwppbXBvcnQgeyBLQmFyVHJpZ2dlciB9IGZyb20gIi4uL0tiYXIiOwppbXBvcnQgeyBUZWFtSW52aXRlQmFkZ2UgfSBmcm9tICIuLi9UZWFtSW52aXRlQmFkZ2UiOwppbXBvcnQgdHlwZSB7IE5hdmlnYXRpb25JdGVtVHlwZSB9IGZyb20gIi4vTmF2aWdhdGlvbkl0ZW0iOwppbXBvcnQgeyBOYXZpZ2F0aW9uSXRlbSwgTW9iaWxlTmF2aWdhdGlvbkl0ZW0sIE1vYmlsZU5hdmlnYXRpb25Nb3JlSXRlbSB9IGZyb20gIi4vTmF2aWdhdGlvbkl0ZW0iOwoKZXhwb3J0IGNvbnN0IE1PUkVfU0VQQVJBVE9SX05BTUUgPSAibW9yZSI7Cgpjb25zdCBnZXROYXZpZ2F0aW9uSXRlbXMgPSAoCiAgb3JnQnJhbmRpbmc6IE9yZ2FuaXphdGlvbkJyYW5kaW5nLAogIGhhc0luc2lnaHRzQWNjZXNzOiBib29sZWFuCik6IE5hdmlnYXRpb25JdGVtVHlwZVtdID0+IFsKICB7CiAgICBuYW1lOiAiZXZlbnRfdHlwZXNfcGFnZV90aXRsZSIsCiAgICBocmVmOiAiL2V2ZW50LXR5cGVzIiwKICAgIGljb246ICJsaW5rIiwKICB9LAogIHsKICAgIG5hbWU6ICJib29raW5ncyIsCiAgICBocmVmOiAiL2Jvb2tpbmdzL3VwY29taW5nIiwKICAgIGljb246ICJjYWxlbmRhciIsCiAgICBiYWRnZTogPFVuY29uZmlybWVkQm9va2luZ0JhZGdlIC8+LAogICAgaXNDdXJyZW50OiAoeyBwYXRobmFtZSB9KSA9PiBwYXRobmFtZT8uc3RhcnRzV2l0aCgiL2Jvb2tpbmdzIikgPz8gZmFsc2UsCiAgfSwKICB7CiAgICBuYW1lOiAiYXZhaWxhYmlsaXR5IiwKICAgIGhyZWY6ICIvYXZhaWxhYmlsaXR5IiwKICAgIGljb246ICJjbG9jayIsCiAgfSwKICAuLi4ob3JnQnJhbmRpbmcKICAgID8gWwogICAgICAgIHsKICAgICAgICAgIG5hbWU6ICJtZW1iZXJzIiwKICAgICAgICAgIGhyZWY6IGAvc2V0dGluZ3Mvb3JnYW5pemF0aW9ucy8ke29yZ0JyYW5kaW5nLnNsdWd9L21lbWJlcnNgLAogICAgICAgICAgaWNvbjogImJ1aWxkaW5nIiwKICAgICAgICAgIG1vcmVPbk1vYmlsZTogdHJ1ZSwKICAgICAgICB9IHNhdGlzZmllcyBOYXZpZ2F0aW9uSXRlbVR5cGUsCiAgICAgIF0KICAgIDogW10pLAogIHsKICAgIG5hbWU6ICJ0ZWFtcyIsCiAgICBocmVmOiAiL3RlYW1zIiwKICAgIGljb246ICJ1c2VycyIsCiAgICBiYWRnZTogPFRlYW1JbnZpdGVCYWRnZSAvPiwKICAgIG1vcmVPbk1vYmlsZTogdHJ1ZSwKICB9LAogIHsKICAgIG5hbWU6ICJhcHBzIiwKICAgIGhyZWY6ICIvYXBwcyIsCiAgICBpY29uOiAiZ3JpZC0zeDMiLAogICAgbW9yZU9uTW9iaWxlOiB0cnVlLAogICAgaXNDdXJyZW50OiAoeyBwYXRobmFtZTogcGF0aCwgaXRlbSB9KSA9PiB7CiAgICAgIC8vIER1cmluZyBTZXJ2ZXIgcmVuZGVyaW5nIHBhdGggaXMgL3YyL2FwcHMgYnV0IG9uIGNsaWVudCBpdCBiZWNvbWVzIC9hcHBzKHdlaXJkLi4pCiAgICAgIHJldHVybiAocGF0aD8uc3RhcnRzV2l0aChpdGVtLmhyZWYpID8/IG9tICdAYWF2ZS9jb250cmFjdC1oZWxwZXJzJzsKaW1wb3J0IHsKICBBYXZlVjJBdmFsYW5jaGUsCiAgQWF2ZVYyRXRoZXJldW0sCiAgQWF2ZVYyRnVqaSwKICBBYXZlVjJQb2x5Z29uLAogIEFhdmVWM0FyYml0cnVtLAogIEFhdmVWM0F2YWxhbmNoZSwKICBBYXZlVjNCYXNlLAogIEFhdmVWM0Jhc2VTZXBvbGlhLAogIEFhdmVWM0JOQiwKICBBYXZlVjNDZWxvLAogIEFhdmVWM0V0aGVyZXVtLAogIEFhdmVWM0V0aGVyZXVtRXRoZXJGaSwKICBBYXZlVjNFdGhlcmV1bUxpZG8sCiAgQWF2ZVYzR25vc2lzLAogIEFhdmVWM0lua1doaXRlbGFiZWwsCiAgQWF2ZVYzTGluZWEsCiAgQWF2ZVYzTWV0aXMsCiAgQWF2ZVYzT3B0aW1pc20sCiAgQWF2ZVYzUGxhc21hLAogIEFhdmVWM1BvbHlnb24sCiAgQWF2ZVYzU2Nyb2xsLAogIEFhdmVWM1NvbmVpdW0sCiAgQWF2ZVYzU29uaWMsCiAgQWF2ZVYzWmtTeW5jLAp9IGZyb20gJ0BiZ2QtbGFicy9hYXZlLWFkZHJlc3MtYm9vayc7CmltcG9ydCB7IFJlYWN0Tm9kZSB9IGZyb20gJ3JlYWN0JzsKCi8vIEVuYWJsZSBmb3IgcHJlbWlzc2lvbmVkIG1hcmtldAovLyBpbXBvcnQgeyBQZXJtaXNzaW9uVmlldyB9IGZyb20gJ3NyYy9jb21wb25lbnRzL3RyYW5zYWN0aW9ucy9GbG93Q29tbW9ucy9QZXJtaXNzaW9uVmlldyc7CmV4cG9ydCB0eXBlIE1hcmtldERhdGFUeXBlID0gewogIHYzPzogYm9vbGVhbjsKICBtYXJrZXRUaXRsZTogc3RyaW5nOwogIG1hcmtldDogQ3VzdG9tTWFya2V0OwogIC8vIHRoZSBuZXR3b3JrIHRoZSBtYXJrZXQgb3BlcmF0ZXMgb24KICBjaGFpbklkOiBDaGFpbklkOwogIGVuYWJsZWRGZWF0dXJlcz86IHsKICAgIGxpcXVpZGl0eVN3YXA/OiBib29sZWFuOwogICAgc3Rha2luZz86IGJvb2xlYW47CiAgICBnb3Zlcm5hbmNlPzogYm9vbGVhbjsKICAgIGZhdWNldD86IGJvb2xlYW47CiAgICBjb2xsYXRlcmFsUmVwYXk/OiBib29sZWFuOwogICAgaW5jZW50aXZlcz86IGJvb2xlYW47CiAgICBwZXJtaXNzaW9ucz86IGJvb2xlYW47CiAgICBkZWJ0U3dpdGNoPzogYm9vbGVhbjsKICAgIHdpdGhkcmF3QW5kU3dpdGNoPzogYm9vbGVhbjsKICAgIHN3aXRjaD86IGJvb2xlYW47CiAgICBsaW1pdD86IGJvb2xlYW47CiAgfTsKICBwZXJtaXREaXNhYmxlZD86IGJvb2xlYW47IC8vIGludGVuZGVkIHRvIGJlIHVzZWQgZm9yIHRlc3RuZXRzCiAgaXNGb3JrPzogYm9vbGVhbjsKICBwZXJtaXNzaW9uQ29tcG9uZW50PzogUmVhY3ROb2RlOwogIHN1YmdyYXBoVXJsPzogc3RyaW5nOwogIGxvZ28/OiBzdHJpbmc7CiAgZXh0ZXJuYWxVcmw/OiBzdHJpbmc7IC8vIFVSTCBmb3IgZXh0ZXJuYWwgbWFya2V0cyBsaWtlIEFwdG9zCiAgYWRkcmVzc2VzOiB7CiAgICBMRU5ESU5HX1BPT0xfQUREUkVTU19QUk9WSURFUjogc3RyaW5nOwogICAgTEVORElOR19QT09MOiBzdHJpbmc7CiAgICBXRVRIX0dBVEVXQVk/OiBzdHJpbmc7CiAgICBTV0FQX0NPTExBVEVSQUxfQURBUFRFUj86IHN0cmluZzsKICAgIFJFUEFZX1dJVEhfQ09MTEFURVJBTF9BREFQVEVSPzogc3RyaW5nOwogICAgREVCVF9TV0lUQ0hfQURBUFRFUj86IHN0cmluZzsKICAgIFdJVEhEUkFXX1NXSVRDSF9BREFQVEVSPzogc3RyaW5nOwogICAgRkFVQ0VUPzogc3RyaW5nOwogICAgUEVSTUlTU0lPTl9NQU5BR0VSPzogc3RyaW5nOwogICAgV0FMTEVUX0JBTEFOQ0VfUFJPVklERVI6IHN0cmluZzsKICAgIEwyX0VOQ09ERVI/OiBzdHJpbmc7CiAgICBVSV9QT09MX0RBVEFfUFJPVklERVI6IHN0cmluZzsKICAgIFVJX0lOQ0VOVElWRV9EQVRBX1BST1ZJREVSPzogc3RyaW5nOwogICAgQ09MTEVDVE9SPzogc3RyaW5nOwogICAgVjNfTUlHUkFUT1I/OiBzdHJpbmc7CiAgICBHSE9fVE9LRU5fQUREUkVTUz86IHN0cmluZzsKICB9Owp9OwpleHBvcnQgZW51bSBDdXN0b21NYXJrZXQgewogIC8vIHYzIHRlc3QgbmV0d29ya3MsIGFsbCB2My4wLjEKICBwcm90b19iYXNlX3NlcG/ZhNiq2Yog2YrZhdmD2YbZhtmKINin2YTZiNi12YjZhCDYpdmE2YrZh9inIiwKICAgIGZpbmRLbm93bGVkZ2U6ICLYp9io2K3YqyDYo9mIINin2LPYqtiu2K/ZhSDYp9mE2YXYudix2YHYqSDZgdmKLi4uIiwKICAgIG5vS25vd2xlZGdlRm91bmQ6ICLZhNmFINmK2KrZhSDYp9mE2LnYq9mI2LEg2LnZhNmJINmF2LnYsdmB2KkiLAogICAgaGVscENlbnRlcjogItmF2LHZg9iyINin2YTZhdiz2KfYudiv2KkiLAogICAgY29ubmVjdEFwcHM6ICLYsdio2Lcg2KfZhNiq2LfYqNmK2YLYp9iqIiwKICAgIHNlYXJjaFNvdXJjZXNOb3RlOiAi2LPZhtio2K3YqyDZgdmC2Lcg2YHZiiDYp9mE2YXYtdin2K/YsSDYp9mE2YXYrdiv2K/YqSDZh9mG2KcuIiwKICAgIHNlbmQ6ICLYpdix2LPYp9mEIiwKICAgIGFsbFNvdXJjZXM6ICLYrNmF2YrYuSDYp9mE2YXYtdin2K/YsSIsCiAgICBhdXRvOiAi2KrZhNmC2KfYptmKIiwKICAgIGFnZW50TW9kZTogItmI2LbYuSDYp9mE2YjZg9mK2YQiLAogICAgcGxhbk1vZGU6ICLZiNi22Lkg2KfZhNiq2K7Yt9mK2LciLAogICAgYmV0YTogItiq2KzYsdmK2KjZiiIsCiAgICB3b3Jrc3BhY2U6ICLZhdiz2KfYrdipINin2YTYudmF2YQiLAogICAgbWVldGluZ05vdGVzOiAi2YXZhNin2K3YuNin2Kog2KfZhNin2KzYqtmF2KfYuSIsCiAgICBwcm9qZWN0RGFzaGJvYXJkOiAi2YTZiNit2Kkg2KfZhNmF2LTYsdmI2LkiLAogICAgaWRlYXNCcmFpbnN0b3JtaW5nOiAi2KPZgdmD2KfYsSDZiNi52LXZgSDYsNmH2YbZiiIsCiAgICBjYWxlbmRhckV2ZW50czogItin2YTYqtmC2YjZitmFINmI2KfZhNij2K3Yr9in2KsiLAogICAgZG9jdW1lbnRhdGlvbjogItin2YTYqtmI2KvZitmCIiwKICAgIGdvYWxzT2JqZWN0aXZlczogItin2YTYo9mH2K/Yp9mBINmI2KfZhNi62KfZitin2KoiLAogICAgYnVkZ2V0UGxhbm5pbmc6ICLYqtiu2LfZiti3INin2YTZhdmK2LLYp9mG2YrYqSIsCiAgICB0ZWFtRGlyZWN0b3J5OiAi2K/ZhNmK2YQg2KfZhNmB2LHZitmCIiwKICAgIHRlY2huaWNhbFNwZWNzOiAi2KfZhNmF2YjYp9i12YHYp9iqINin2YTYqtmC2YbZitipIiwKICAgIGFuYWx5dGljc1JlcG9ydDogItiq2YLYsdmK2LEg2KfZhNiq2K3ZhNmK2YTYp9iqIiwKICB9LAogIGhlOiB7CiAgICBkaXI6ICJydGwiIGFzIGNvbnN0LAogICAgcHJvbXB0OiAi16TXp9eV15PXlCIsCiAgICBwbGFjZWhvbGRlcjogItep15DXnCwg15fXpNepLCDXkNeVINem15XXqCDXntep15TXlS4uLiIsCiAgICBhZGRDb250ZXh0OiAi15TXldeh16Mg15TXp9ep16giLAogICAgbWVudGlvblRvb2x0aXA6ICLXlNeW15vXqCDXkNeT150sINei157XldeTINeQ15Ug16rXkNeo15nXmiIsCiAgICBzZWFyY2hQYWdlczogIteX16TXqSDXotee15XXk9eZ150uLi4iLAogICAgbm9QYWdlc0ZvdW5kOiAi15zXkCDXoNee16bXkNeVINei157XldeT15nXnSIsCiAgICBwYWdlczogItei157XldeT15nXnSIsCiAgICB1c2VyczogItee16nXqtee16nXmdedIiwKICAgIGF0dGFjaEZpbGU6ICLXpteo16Mg16fXldeR16UiLAogICAgc2VsZWN0TW9kZWw6ICLXkdeX16gg157XldeT15wgQUkiLAogICAgc2VsZWN0QWdlbnRNb2RlOiAi15HXl9eoINee16bXkSDXodeV15vXnyIsCiAgICB3ZWJTZWFyY2g6ICLXl9eZ16TXldepINeR15DXmdeg15jXqNeg15giLAogICAgYXBwc0ludGVncmF0aW9uczogIteQ16TXnNeZ16fXpteZ15XXqiDXldeQ15nXoNeY15LXqNem15nXldeqIiwKICAgIGFsbFNvdXJjZXNBY2Nlc3M6ICLXm9ecINeU157Xp9eV16jXldeqINep15nXqSDXnNeZINeS15nXqdeUINeQ15zXmdeU150iLAogICAgZmluZEtub3dsZWRnZTogItee16bXkCDXkNeVINeU16nXqtee16kg15HXmdeT16Ig15EuLi4iLAogICAgbm9Lbm93bGVkZ2VGb3VuZDogItec15Ag16DXntem15Ag15nXk9eiIiwKICAgIGhlbHBDZW50ZXI6ICLXnteo15vXliDXoteW16jXlCIsCiAgICBjb25uZWN0QXBwczogIteX15HXqCDXNSAxNy41NTY5IDEzLjM3NjQgMTcuNTMzN0MxMy40ODUzIDE3LjUxIDEzLjU5MDkgMTcuNDY3NSAxMy42Nzc4IDE3LjQwMDZDMTMuODA4IDE3LjMwMDYgMTMuODkxIDE3LjE0OTQgMTMuOTIxNSAxNi45OTE5QzEzLjk1MTkgMTYuODM0NCAxMy45MzMxIDE2LjY3IDEzLjg4NTIgMTYuNTE2MkMxMy43ODkyIDE2LjIwODcgMTMuNTgzOCAxNS45NDY5IDEzLjQxNCAxNS42NzEzQzEzLjM0NjUgMTUuNTYxOSAxMy4yODQzIDE1LjQ1MDYgMTMuMjE3NiAxNS4zNDEzQzEzLjcyOTYgMTQuNzg2OSAxNC4xNDE4IDE0LjE0NTYgMTQuMzgwMyAxMy40NDEyQzE0LjY0MDIgMTIuNjcyNSAxNC42ODgyIDExLjg0NDQgMTQuNTc4NyAxMS4wNDI1QzE0LjQ2OTEgMTAuMjQwNiAxNC4yMDUzIDkuNDYzMTIgMTMuODU4NiA4LjcyNjg3QzEzLjQyMyA3LjgwNDM3IDEzLjA1NjggNy40NzA2MiAxMi43OTExIDYuNjZDMTIuNTA0NiA1Ljc4Mzc1IDEyLjc0MTIgNC43NDY4NyAxMi41Mjc5IDMuOTUyNUMxMi40NTIxIDMuNjgyNSAxMi4zMzA5IDMuNDI0MzggMTIuMTc0NyAzLjE4ODEzQzExLjk5MTkgMi45MTEyNSAxMS43NTk5IDIuNjYzNzUgMTEuNDg0NCAyLjQ3MTI1QzExLjA0NSAyLjE2Mzc1IDEwLjQ5MjcgMiA5LjkzMTQ1IDJaIgogICAgICAgICAgZmlsbD0iIzAyMDIwNCIKICAgICAgICAvPgogICAgICAgIDxwYXRoCiAgICAgICAgICBkPSJNOC4zODU2OCA2LjYyNTg0QzguMzI3MzUgNi42OTY0NiA4LjI4OTc2IDYuNzgxNDYgOC4yNjY0MiA2Ljg2ODk2QzguMjQzNzQgNi45NTY0NiA4LjIzNTMxIDcuMDQ3MDkgOC4yMzE0MiA3LjEzNzcxQzguMjI0MjkgNy4zMTgzNCA4LjIzNTk2IDcuNTAyMDkgOC4xODYwNSA3LjY3NjQ2QzguMTMyOSA3Ljg2MjcxIDguMDE0MjkgOC4wMjQ1OSA3Ljg5ODI3IDguMTgxNDZDNy42OTY3IDguNDUzOTYgNy40OTMxOCA4LjczMzk2IDcuMzk0MDIgOS4wNTQ1OUM3LjMzMzc0IDkuMjQ4MzQgNy4zMTM2NCA5LjQ1Mzk2IDcuMzM1MDMgOS42NTU4NEM3LjExMDEzIDkuOTc0NTkgNi45MTUwMyAxMC4zMTQgNi43NTMgMTAuNjY3MUM2LjUwOCAxMS4yMDI3IDYuMzQwMTMgMTEuNzcyNyA2LjI4MTE0IDEyLjM1NTJDNi4yMDg1NSAxMy4wNjgzIDYuMzAzMTggMTMuODAyMSA2LjU5NTUgMTQuNDYwOEM2LjgwNjE0IDE0LjkzNzcgNy4xMjExNCAxNS4zNzMzIDcuNTI3NTMgMTUuNzEzM0M3LjczMzY0IDE1Ljg4NTggNy45NjMwOSAxNi4wMzI3IDguMjA4MDkgMTYuMTQ5QzkuMDU3ODEgMTYuNTUyMSAxMC4xMDc4IDE2LjU1MjcgMTAuOTQzMyAxNi4xMjMzQzExLjM4MDEgMTUuODk5IDExLjc0ODkgMTUuNTcwOCAxMi4xMDQxIDE1LjIzOUMxMi4zMTggMTUuMDM5IDEyLjUzMTIgMTQuODM0IDEyLjY5NDYgMTQuNTk0QzEzLjAwODkgMTQuMTMwOCAxMy4xMTg1IDEzLjU2ODMgMTMuMTg2NSAxMy4wMTlDMTMuMzA1MSAxMi4wNTkgMTMuMzA5IDExLjA0NCAxMi44NzIyIDEwLjE3MzNDMTIuNzIxOCA5Ljg3MzM0IDEyLjUyMTUgOS41OTcwOSAxMi4yODExIDkuMzU3NzFDMTIuMjE3NSA4LjkzODk2IDEyLjA5MTEgOC41MjgzNCAxMS45MDc3IDguMTQzOTZDMTEuNzc0OCA3Ljg2NTg0IDExLjYxMzUgNy42MDE0NiAxMS40OTAzIDcuMzIwMjFDMTEuNDM5OCA3LjIwNDU5IDExLjM5NTcgNy4wODU4NCAxMS4zMzk5IDYuOTcyNzFDMTEuMjgzNiA2Ljg1OTU5IDExLjIxNDggNi43NTA4NCAxMS4xMjAyIDYuNjYzOTZDMTEuMDI0MyA2LjU3NTIxIDEwLjkwNDQgNi41MTIwOSAxMC43NzggNi40NzIwOUMxMC42NTE2IDYuNDMxNDYgMTAuNTE4MSA2LjQxMzM0IDEwLjM4NTIgNi40MDcwOUMxMC4xMTg4IDYuMzkzOTYgOS44NTI0NCA2LjQyNzcxIDkuNTg2MDUgNi40MTcwOUM5LjM3NDExIDYuNDA4OTYgOS4xNjI4MSA2LjM3MzM0IDguOTUwODcgNi4zODUyMUM4Ljg0NTIyIDYuMzkxNDYgOC43Mzk1NyA2LjQwOTU5IDguNjQxMDUgNi40NDgzNEM4LjU0MjUzIDYuNDg2NDYgOC40NTE3OSA2LjU0NTg0IDguMzcuMTM4OCA2LjQyMTE2IDE3LjI0ODEgNy4xNDU1M0MxNy4yNDgxIDcuMTQ1NTMgMTcuMjQ4OCA3LjE1MDUzIDE3LjI1IDcuMTYwNTNDMTYuMjU5NCA0LjY4NTUzIDE0LjU3OTQgMy42ODc0MSAxMy4yMDc1IDEuNTE0MjhDMTMuMTM3NSAxLjQwNDkxIDEzLjA2ODEgMS4yOTU1MyAxMy4wMDA2IDEuMTc4MDNDMTIuOTY2IDEuMTE4MzQgMTIuOTMzOSAxLjA1NzI1IDEyLjkwNDQgMC45OTQ5MDVDMTIuODQ0OCAwLjg4MDMzMSAxMi43OTkgMC43NTkwNTkgMTIuNzY4MSAwLjYzMzY1NUMxMi43NjQ0IDAuNjI5Mzk3IDEyLjc1OTMgMC42MjY1MzIgMTIuNzUzOCAwLjYyNTUzQzEyLjc0ODQgMC42MjQ4MjMgMTIuNzQyOSAwLjYyNDgyMyAxMi43Mzc1IDAuNjI1NTNMMTIuNzMzMSAwLjYyODAzQzEyLjczMSAwLjYyODg2NCAxMi43MjkgMC42Mjk5MDUgMTIuNzI2OSAwLjYzMTE1NUwxMi43MzA2IDAuNjI2NzhDMTAuNTI5NCAxLjkxODY2IDkuNzgzMTMgNC4zMDgwMyA5LjcxNDM4IDUuNTA0MjhDOC44MzQ1MyA1LjU2NDM5IDcuOTkzMzggNS44ODg5OSA3LjMwMTI1IDYuNDM1NTNDNy4yMjg5NSA2LjM3Mzk4IDcuMTUzMiA2LjMxNjU5IDcuMDc0MzggNi4yNjM2NUM2Ljg3Mzk5IDUuNTYzMzYgNi44NjU1NyA0LjgyMjA3IDcuMDUgNC4xMTc0MUM2LjE1IDQuNTI4NjYgNS40NSA1LjE3NzQxIDQuOTQxMjUgNS43NTExNkg0LjkzNjg4QzQuNTg5MzggNS4zMDk5MSA0LjYxMzc1IDMuODU1NTMgNC42MzM3NSAzLjU1MTc4QzQuNjI5MzggMy41MzMwMyA0LjM3NSAzLjY4NDkgNC4zNDE4OCAzLjcwODAzQzQuMDM0NzkgMy45MjcyIDMuNzQ5MzggNC4xNzIyIDMuNDg1NjMgNC40NDMwM0MzLjE4NTY0IDQuNzQ2ODcgMi45MTIxNCA1LjA3NTc3IDIuNjY4MTMgNS40MjYxNUMyLjEwNDk1IDYuMjI3MDEgMS43MDU0NCA3LjEzMTE3IDEuNDkyNSA4LjA4Njc4TDEuNDgwNjMgOC4xNDQ5QzEuNDY0MzggOC4yMjE3OCAxLjQwNSA4LjYwODY1IDEuMzk0MzggOC42OTMwM1Y4LjcxMTc4QzEuMzE2ODggOS4xMTIyIDEuMjY4NzUgOS41MTYzNiAxLjI1IDkuOTI0MjhWOS45Njg2NUMxLjI0OTM4IDE0LjgxOCA1LjE3MTg4IDE4Ljc0OTMgMTAuMDEwNiAxOC43NDkzQzE0LjM0NDQgMTguNzQ5MyAxNy45NDE5IDE1LjU5NjIgMTguNjQ2OSAxMS40NTQzQzE4LjY2MSAxMS4zNDE4IDE4LjY3NDQgMTEuMjI4OSAxOC42ODY5IDExLjExNTVDMTguODYxMyA5LjYwOTI4IDE4LjY2NzUgOC4wMjY3OCAxOC4xMTgxIDYuNzAzMDNNOC4wMjA2MyAxMy41NzY4QzguMDYxMjUgMTMuNTk1NSA4LjEgMTMuNjE3NCA4LjE0MTg4IDEzLjYzNjhMOC4xNDgxMyAxMy42NDA1TDguMDIwNjMgMTMuNTc2OFpNMTcuMjUxMyA3LjE2NDI4VjcuMTU2MTZWNy4xNjU1M1Y3LjE2NDI4WiIKICAgICAgICBmaWxsPSJ1cmwoI3BhaW50MF9saW5lYXJfZmlyZWZveCkiCiAgICAgIC8+CiAgICAgIDxwYXRoCiAgICAgICAgZD0iTTE4LjExNzUgNi43MDM1OUMxNy43Mzc1IDUuNzg0ODQgMTYuOTY2MyA0Ljc5MzU5IDE2LjM2MDYgNC40ODA0N0MxNi44NTMxIDUuNDQ5MjIgMTcuMTM4MSA2LjQyMTA5IDE3LjI0NzUgNy4xNDU0N1Y3LjE2NDIyQzE4LjA3NDQgOS40MDk4NCAxNy42MjM3IDExLjY5NDIgMTYuOTc1IDEzLjA4OThDMTUuOTcwNiAxNS4yNDkyIDEzLjU0IDE3LjQ2MyA5LjczNSAxNy4zNTQ4QzUuNjI3NSAxNy4yMzggMi4wMDYyNSAxNC4xNzk4IDEuMzMgMTAuMTc2N0MxLjIwNjg4IDkuNTQ1NDcgMS4zMyA5LjIyNDg0IDEuMzkxODcgOC43MTIzNEMxLjMxNjg4IDkuMTA2NzIgMS4yODc1IDkuMjIxMDkgMS4yNSA5LjkyMzU5VjkuOTY4NTlDMS4yNSAxNC44MTggNS4xNzI1IDE4Ljc0OTIgMTAuMDExMyAxOC43NDkyQzE0LjM0NSAxOC43NDkyIDE3Ljk0MjUgMTUuNTk2MSAxOC42NDc1IDExLjQ1NDJDMTguNjYxNyAxMS4zNDE3IDE4LjY3NSAxMS4yMjg4IDE4LjY4NzUgMTEuMTE1NUMxOC44NjA2IDkuNjA5MjIgMTguNjY2OSA4LjAyNjcyIDE4LjEgICBzdHJpcGU9e2dldFN0cmlwZSgpfQogICAgICBvcHRpb25zPXt7CiAgICAgICAgYXBwZWFyYW5jZTogewogICAgICAgICAgdmFyaWFibGVzOiB7CiAgICAgICAgICAgIGNvbG9ySWNvbjogIiM2NzcyZTUiLAogICAgICAgICAgICBmb250RmFtaWx5OiAiUm9ib3RvLCBPcGVuIFNhbnMsIFNlZ29lIFVJLCBzYW5zLXNlcmlmIiwKICAgICAgICAgIH0sCiAgICAgICAgfSwKICAgICAgICBjdXJyZW5jeTogY29uZmlnLkNVUlJFTkNZLAogICAgICAgIG1vZGU6ICJwYXltZW50IiwKICAgICAgICBhbW91bnQ6IE1hdGgucm91bmQoY29uZmlnLk1BWF9BTU9VTlQgLyBjb25maWcuQU1PVU5UX1NURVApLAogICAgICB9fQogICAgPgogICAgICA8Q2hlY2tvdXRGb3JtIC8+CiAgICA8L0VsZW1lbnRzPgogICk7Cn0KZXhwb3J0IGZ1bmN0aW9uIEFwcGxlSWNvbih7IGNsYXNzTmFtZSB9OiB7IGNsYXNzTmFtZT86IHN0cmluZyB9KSB7CiAgcmV0dXJuICgKICAgIDxzdmcKICAgICAgd2lkdGg9IjE2IgogICAgICBoZWlnaHQ9IjE2IgogICAgICB2aWV3Qm94PSIwIDAgMjAgMjAiCiAgICAgIGZpbGw9Im5vbmUiCiAgICAgIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyIKICAgICAgY2xhc3NOYW1lPXtjbGFzc05hbWV9CiAgICAgIGFyaWEtaGlkZGVuPSJ0cnVlIj4KICAgICAgPHBhdGggZD0iTTE3LjM2OSAxNC4yODhDMTcuMTAxMiAxNC45MTA2IDE2Ljc3MDkgMTUuNTA0MyAxNi4zODMgMTYuMDZDMTUuODY1IDE2Ljc5ODcgMTUuNDQxNyAxNy4zMSAxNS4xMTMgMTcuNTk0QzE0LjYwNjMgMTguMDU5MyAxNC4wNjI3IDE4LjI5OSAxMy40ODIgMTguMzEzQzEzLjA2NCAxOC4zMTMgMTIuNTYxMyAxOC4xOTMgMTEuOTc0IDE3Ljk1M0MxMS4zODY3IDE3LjcxMyAxMC44NDU3IDE3LjU5MzMgMTAuMzUxIDE3LjU5NEM5LjgzMyAxNy41OTQgOS4yNzcgMTcuNzEzNyA4LjY4MyAxNy45NTNDOC4wODc2NyAxOC4xOTMgNy42MDcgMTguMzE5MyA3LjI0MSAxOC4zMzJDNi42ODMgMTguMzU2IDYuMTI2NjcgMTguMTEgNS41NzIgMTcuNTk0QzUuMjE4IDE3LjI4NTMgNC43NzUzMyAxNi43NTU3IDQuMjQ0IDE2LjAwNUMzLjY3NCAxNS4yMDUgMy4yMDYgMTQuMjc1IDIuODQgMTMuMjE1QzIuNDQ2NjcgMTIuMDcyMyAyLjI1IDEwLjk2NDMgMi4yNSA5Ljg5MUMyLjI1IDguNjYyMzMgMi41MTU2NyA3LjYwMzY3IDMuMDQ3IDYuNzE1QzMuNDQ5NzQgNi4wMTc5NCA0LjAyNDc4IDUuNDM2MDEgNC43MTcgNS4wMjVDNS4zOTk5MSA0LjYxNzI2IDYuMTc4NjggNC4zOTc4MSA2Ljk3NCA0LjM4OUM3LjQxNjY3IDQuMzg5NjcgNy45OTg2NyA0LjUyNSA4LjcyIDQuNzk1QzkuNDQwNjcgNS4wNjYzMyA5LjkwMjMzIDUuMjAyMzMgMTAuMTA1IDUuMjAzQzEwLjI1NzcgNS4yMDMgMTAuNzY5NyA1LjA0MyAxMS42NDEgNC43MjNDMTIuNDYzNyA0LjQyNyAxMy4xNTkzIDQuMzAzNjcgMTMuNzI4IDQuMzUzQzE1LjI3MiA0LjQ3NjMzIDE2LjQyOTMgNS4wODUzMyAxNy4yIDYuMThDMTUuODIgNy4wMTY2NyAxNS4xMzczIDguMTg2MzMgMTUuMTUyIDkuNjg5QzE1LjE2NTMgMTAuODU5NyAxNS41ODg3IDExLjgzMTcgMTYuNDIyIDEyLjYwNUMxNi44IDEyLjk2MyAxNy4yMjMzIDEzLjI0MDcgMTcuNjkyIDEzLjQzOEMxNy41OTA3IDEzLjczMjcgMTcuNDgzIDE0LjAxNiAxNy4zNjkgMTQuMjg4Wk0xMy44MyAwLjM2N0MxMy44MyAxLjI4NDMzIDEzLjQ5NiAyLjEzOTMzIDEyLjgyOCAyLjkzMkMxMi4wMjIgMy44NzQgMTEuMDQ4IDQuNDE5IDkuOTkxIDQuMzMyQzkuOTc2OTYgNC4yMTY4NiA5Ljk2OTYyIDQuMTAwOTkgOS45NjkgMy45ODVDOS45NjkgMy4xMDUgMTAuMzUyIDIuMTYzIDExLjAzMyAxLjM5M0MxMS4zNzMgMS4wMDMgMTEuODA1IDAuNjc4NjY3IDEyLjMyOSAwLjQyQzEyLjg1MTcgMC4xNjQ2NjcgMTMuMzQ1NyAwLjAyNDY2NjcgMTMuODExIDBDMTMuODI0MyAwLjEyMjY2NyAxMy44MzEgMC4yNDUgMTMuOCB1c2VUb2tlblByaWNlQ2hhbmdlIH0gZnJvbSAndW5pc3dhcC9zcmMvZmVhdHVyZXMvZGF0YUFwaS90b2tlbkRldGFpbHMvdXNlVG9rZW5EZXRhaWxzRGF0YScKaW1wb3J0IHsgY3VycmVuY3lJZCB9IGZyb20gJ3VuaXN3YXAvc3JjL3V0aWxzL2N1cnJlbmN5SWQnCgpleHBvcnQgY29uc3QgVERQX0NIQVJUX0hFSUdIVF9QWCA9IDM1NgoKdHlwZSBUb2tlbkRldGFpbHNDaGFydFR5cGUgPSBDaGFydFR5cGUuUFJJQ0UgfCBDaGFydFR5cGUuVk9MVU1FIHwgQ2hhcnRUeXBlLlRWTApjb25zdCBUT0tFTl9ERVRBSUxTX0NIQVJUX09QVElPTlM6IFRva2VuRGV0YWlsc0NoYXJ0VHlwZVtdID0gW0NoYXJ0VHlwZS5QUklDRSwgQ2hhcnRUeXBlLlZPTFVNRSwgQ2hhcnRUeXBlLlRWTF0KCmV4cG9ydCBjb25zdCBERUZBVUxUX1BJTExfVElNRV9TRUxFQ1RPUl9PUFRJT05TID0gT1JERVJFRF9USU1FUy5tYXAoKHRpbWU6IFRpbWVQZXJpb2QpID0+ICh7CiAgdmFsdWU6IERJU1BMQVlTW3RpbWVdLAp9KSkgYXMgU2VnbWVudGVkQ29udHJvbE9wdGlvbltdCgpleHBvcnQgY29uc3QgQ2hhcnRBY3Rpb25zQ29udGFpbmVyID0gc3R5bGVkKEZsZXgsIHsKICBmbGV4RGlyZWN0aW9uOiAncm93LXJldmVyc2UnLAogIHdpZHRoOiAnMTAwJScsCiAganVzdGlmeUNvbnRlbnQ6ICdzcGFjZS1iZXR3ZWVuJywKICBhbGlnbkl0ZW1zOiAnY2VudGVyJywKICBtdDogMTIsCiAgJG1kOiB7CiAgICBmbGV4RGlyZWN0aW9uOiAnY29sdW1uJywKICAgIGdhcDogMTYsCiAgfSwKfSkKCi8qKiBSZXByZXNlbnRzIGEgdmFyaWV0eSBvZiBxdWVyeSByZXN1bHQgc2hhcGVzLCBkaXNjcmltaW5hdGVkIHZpYSBhZGRpdGlvbmFsIGBjaGFydFR5cGVgIGZpZWxkLiAqLwp0eXBlIEFjdGl2ZVF1ZXJ5ID0KICB8IENoYXJ0UXVlcnlSZXN1bHQ8UHJpY2VDaGFydERhdGEsIENoYXJ0VHlwZS5QUklDRT4KICB8IENoYXJ0UXVlcnlSZXN1bHQ8U2luZ2xlSGlzdG9ncmFtRGF0YSwgQ2hhcnRUeXBlLlZPTFVNRT4KICB8IENoYXJ0UXVlcnlSZXN1bHQ8U3RhY2tlZExpbmVEYXRhLCBDaGFydFR5cGUuVFZMPgoKZXhwb3J0IHR5cGUgVERQQ2hhcnRTdGF0ZSA9IHsKICAvKiogVGltZSBjb250cm9scyBmb3IgVERQIENoYXJ0cyAqLwogIHRpbWVQZXJpb2Q6IFRpbWVQZXJpb2QKICBzZXRUaW1lUGVyaW9kOiAodGltZVBlcmlvZDogVGltZVBlcmlvZCkgPT4gdm9pZAogIC8qKiBTZWxlY3RvcnMgZm9yIFREUCBDaGFydHMgKi8KICBzZXRDaGFydFR5cGU6IChjaGFydFR5cGU6IFRva2VuRGV0YWlsc0NoYXJ0VHlwZSkgPT4gdm9pZAogIHByaWNlQ2hhcnRUeXBlOiBQcmljZUNoYXJ0VHlwZQogIHNldFByaWNlQ2hhcnRUeXBlOiAocHJpY2VDaGFydFR5cGU6IFByaWNlQ2hhcnRUeXBlKSA9PiB2b2lkCiAgYWN0aXZlUXVlcnk6IEFjdGl2ZVF1ZXJ5CiAgLyoqIFNwZWNpYWwtY2FzZTogZmxhZyB0byBkaXNhYmxlIGNhbmRsZXN0aWNrIHRvZ2dsZSBvbiB0b2tlbnMgd2l0aCBpbnZhbGlkIE9ITEMgZGF0YSAgKi8KICBkaXNhYmxlQ2FuZGxlc3RpY2tVSTogYm9vbGVhbgp9Cgpjb25zdCBJbnZhbGlkQ2hhcnRNZXNzYWdlID0gKCkgPT4gPFRyYW5zIGkxOG5LZXk9ImNoYXJ0LmVycm9yLnRva2VucyIgLz4KCi8qKiBFeHBvcnRlZCB0byBgVERQQ29udGV4dGAgdG8gZmlyZSBxdWVyaWVzIG9uIHBhZ2Vsb2FkLiBgVERQQ2hhcnRTdGF0ZWAgc2hvdWxkIGJlIGFjY2Vzc2VkIHRocm91Z2ggYHVzZVREUENvbnRleHRgIHJhdGhlciB0aGFuIHRoaXMgaG9vay4gKi8KZXhwb3J0IGZ1bmN0aW9uIHVzZUNyZWF0ZVREUENoYXJ0U3RhdGUoCiAgdG9rZW5EQkFkZHJlc3M6IHN0cmluZyB8IHVuZGVmaW5lZCwKICBjdXJyZW5jeUNoYWluTmFtZTogR3JhcGhRTEFwaS5DaGFpbiwKKTogVERQQ2hhcnRTdGF0ZSB7CiAgY29uc3QgW3RpbWVQZXJpb2QsIHNldFRpbWVQZXJpb2RdID0gdXNlU3RhdGU8VGltZVBlcmlvZD4oVGltZVBlcmlvZC5EQVkpCgogIGlvcml0eTogbnVtYmVyOwogIHdlaWdodDogbnVtYmVyOwogIHNjaGVkdWxlSWQ/OiBudW1iZXIgfCBudWxsOwogIGdyb3VwSWQ6IHN0cmluZyB8IG51bGw7Cn07CgpleHBvcnQgdHlwZSBDdXN0b21JbnB1dFBhcnNlZCA9IHR5cGVvZiBjdXN0b21JbnB1dFNjaGVtYS5fb3V0cHV0OwoKY29uc3QgdGFicyA9IFsKICAic2V0dXAiLAogICJhdmFpbGFiaWxpdHkiLAogICJ0ZWFtIiwKICAibGltaXRzIiwKICAiYWR2YW5jZWQiLAogICJpbnN0YW50IiwKICAicmVjdXJyaW5nIiwKICAiYXBwcyIsCiAgIndvcmtmbG93cyIsCiAgIndlYmhvb2tzIiwKICAiYWkiLAogICJwYXltZW50cyIsCl0gYXMgY29uc3Q7CgpleHBvcnQgdHlwZSBFdmVudFR5cGVTZXR1cCA9IFJvdXRlck91dHB1dHNbInZpZXdlciJdWyJldmVudFR5cGVzIl1bImdldCJdWyJldmVudFR5cGUiXTsKZXhwb3J0IHR5cGUgVGVhbU1lbWJlcnMgPSBSb3V0ZXJPdXRwdXRzWyJ2aWV3ZXIiXVsiZXZlbnRUeXBlcyJdWyJnZXQiXVsidGVhbU1lbWJlcnMiXTsKCmV4cG9ydCB0eXBlIEV2ZW50VHlwZUNvbXBvbmVudFByb3BzID0gRXZlbnRUeXBlU2V0dXBQcm9wcyAmIHsKICBhbGxBY3RpdmVXb3JrZmxvd3M/OiBXb3JrZmxvd1tdOwogIHRhYk1hcDogVGFiTWFwOwogIG9uRGVsZXRlOiAoaWQ6IG51bWJlcikgPT4gdm9pZDsKICBpc0RlbGV0aW5nPzogYm9vbGVhbjsKICBvbkNvbmZsaWN0OiAoZXZlbnRUeXBlczogQ2hpbGRyZW5FdmVudFR5cGVbXSkgPT4gdm9pZDsKICBjaGlsZHJlbj86IFJlYWN0LlJlYWN0Tm9kZTsKICBoYW5kbGVTdWJtaXQ6ICh2YWx1ZXM6IEZvcm1WYWx1ZXMpID0+IHZvaWQ7CiAgZm9ybU1ldGhvZHM6IFVzZUZvcm1SZXR1cm48Rm9ybVZhbHVlcz47CiAgZXZlbnRUeXBlQXBwcz86IEV2ZW50VHlwZUFwcHM7CiAgaXNVcGRhdGluZzogYm9vbGVhbjsKICBpc1BsYXRmb3JtPzogYm9vbGVhbjsKICB0YWJOYW1lOiAodHlwZW9mIHRhYnMpW251bWJlcl07CiAgdGFic05hdmlnYXRpb246IFZlcnRpY2FsVGFiSXRlbVByb3BzW107CiAgYWxsb3dEZWxldGU/OiBib29sZWFuOwogIHNhdmVCdXR0b25SZWY/OiBSZWFjdC5SZWZPYmplY3Q8SFRNTEJ1dHRvbkVsZW1lbnQ+Owp9OwoKZXhwb3J0IGNvbnN0IEV2ZW50VHlwZSA9ICh7CiAgZm9ybU1ldGhvZHMsCiAgaXNQbGF0Zm9ybSwKICB0YWJOYW1lLAogIGV2ZW50VHlwZSwKICB0ZWFtLAogIGN1cnJlbnRVc2VyTWVtYmVyc2hpcCwKICB0YWJNYXAsCiAgaXNVcGRhdGluZywKICBpc1VzZXJPcmdhbml6YXRpb25BZG1pbiwKICBvbkRlbGV0ZSwKICBpc0RlbGV0aW5nLAogIHRhYnNOYXZpZ2F0aW9uLAogIGhhbmRsZVN1Ym1pdCwKICBjaGlsZHJlbiwKICBhbGxvd0RlbGV0ZSA9IHRydWUsCiAgc2F2ZUJ1dHRvblJlZiwKfTogRXZlbnRUeXBlQ29tcG9uZW50UHJvcHMpID0+IHsKICBjb25zdCBbYW5pbWF0aW9uUGFyZW50UmVmXSA9IHVzZUF1dG9BbmltYXRlPEhUTUxEaXZFbGVtZW50PigpOwoKICByZXR1cm4gKAogICAgPD4KICAgICAgPEV2ZW50VHlwZVNpbmdsZUxheW91dAogICAgICAgIGV2ZW50VHlwZT17ZXZlbnRUeXBlfQogICAgICAgIHRlYW09e3RlYW19CiAgICAgICAgaXNVcGRhdGVNdXRhdGlvbkxvYWRpbmc9e2lzVXBkYXRpbmd9CiAgICAgICAgZm9ybU1ldGhvZHM9e2Zvcm1NZXRob2RzfQogICAgICAgIC8vIGRpc2FibGVCb3JkZXI9e3RhYk5hbWUgPT09ICJhcHBzIiB8fCB0YWJOYW1lID09PSAid29ya2Zsb3dzIiB8fCB0YWJOYW1lID09PSAid2ViaG9va3MifQogICAgICAgIGRpc2FibGVCb3JkZXI9e3RydWV9CiAgICAgICAgY3VycmVudFVzZXJNZW1iZXJzaGlwPXtjdXJyZW50VXNlck1lbWJlcnNoaXB9CiAgICAgICAgYm9va2VyVXJsPXtldmVudFR5cGUuYm9va2VyVXJsfQogICAgICAgIGlzVXNlck9yZ2FuaXphdGlvbkFkbWluPXtpc1VzZXJPcmdhbml6YXRpb25BZG1pbn0KICAgICAgICBvbkRlbGV0ZT17b25EZWxldGV9CiAgICAqIE9ubHkgdmFsaWQgaWYgYGFjdGlvbmAgaXMgYSBzdHJpbmcuCiAgICoKICAgKiBAZGVmYXVsdFZhbHVlIGB0cnVlYAogICAqLwogIHNjcm9sbD86IGJvb2xlYW4KfSAmIE9taXQ8SFRNTEZvcm1Qcm9wcywgJ2FjdGlvbicgfCBEaXNhbGxvd2VkRm9ybVByb3BzPgoKLy8gYFJvdXRlSW5mZXJUeXBlYCBpcyBhIHN0dWIgaGVyZSB0byBhdm9pZCBicmVha2luZyBgdHlwZWRSb3V0ZXNgIHdoZW4gdGhlIHR5cGUKLy8gaXNuJ3QgZ2VuZXJhdGVkIHlldC4gSXQgd2lsbCBiZSByZXBsYWNlZCB3aGVuIHR5cGUgZ2VuZXJhdGlvbiBydW5zLgovLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLXVudXNlZC12YXJzCmV4cG9ydCB0eXBlIEZvcm1Qcm9wczxSb3V0ZUluZmVyVHlwZSA9IGFueT4gPSBJbnRlcm5hbEZvcm1Qcm9wcwoKZXhwb3J0IGZ1bmN0aW9uIGNyZWF0ZUZvcm1TdWJtaXREZXN0aW5hdGlvblVybCgKICBhY3Rpb246IHN0cmluZywKICBmb3JtRWxlbWVudDogSFRNTEZvcm1FbGVtZW50CikgewogIGxldCB0YXJnZXRVcmw6IFVSTAogIHRyeSB7CiAgICAvLyBOT1RFOiBJdCBtaWdodCBiZSBtb3JlIGNvcnJlY3QgdG8gcmVzb2x2ZSBVUkxzIHJlbGF0aXZlIHRvIGBkb2N1bWVudC5iYXNlVVJJYCwKICAgIC8vIGJ1dCB3ZSBhbHJlYWR5IGRvIGl0IHJlbGF0aXZlIHRvIGBsb2NhdGlvbi5ocmVmYCBlbHNld2hlcmU6CiAgICAvLyAgKHNlZSBlLmcuIGh0dHBzOi8vZ2l0aHViLmNvbS92ZXJjZWwvbmV4dC5qcy9ibG9iL2JiMGU2NzIyZjg3Y2ViMmQ0MzAxNWY1YjhhNDEzZDAwNzJmMmJhZGYvcGFja2FnZXMvbmV4dC9zcmMvY2xpZW50L2NvbXBvbmVudHMvYXBwLXJvdXRlci50c3gjTDE0NikKICAgIC8vIHNvIGl0J3MgYmV0dGVyIHRvIHN0YXkgY29uc2lzdGVudC4KICAgIGNvbnN0IGJhc2UgPSB3aW5kb3cubG9jYXRpb24uaHJlZgogICAgdGFyZ2V0VXJsID0gbmV3IFVSTChhY3Rpb24sIGJhc2UpCiAgfSBjYXRjaCAoZXJyKSB7CiAgICB0aHJvdyBuZXcgRXJyb3IoYENhbm5vdCBwYXJzZSBmb3JtIGFjdGlvbiAiJHthY3Rpb259IiBhcyBhIFVSTGAsIHsKICAgICAgY2F1c2U6IGVyciwKICAgIH0pCiAgfQogIGlmICh0YXJnZXRVcmwuc2VhcmNoUGFyYW1zLnNpemUpIHsKICAgIC8vIHVybC1lbmNvZGVkIEhUTUwgZm9ybXMgKm92ZXJ3cml0ZSogYW55IHNlYXJjaCBwYXJhbXMgaW4gdGhlIGBhY3Rpb25gIHVybDoKICAgIC8vCiAgICAvLyAgIkxldCBgcXVlcnlgIGJlIHRoZSByZXN1bHQgb2YgcnVubmluZyB0aGUgYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkIHNlcmlhbGl6ZXIgWy4uLl0iCiAgICAvLyAgIlNldCBwYXJzZWQgYWN0aW9uJ3MgcXVlcnkgY29tcG9uZW50IHRvIGBxdWVyeWAuIgogICAgLy8gICBodHRwczovL2h0bWwuc3BlYy53aGF0d2cub3JnL211bHRpcGFnZS9mb3JtLWNvbnRyb2wtaW5mcmFzdHJ1Y3R1cmUuaHRtbCNzdWJtaXQtbXV0YXRlLWFjdGlvbgogICAgLy8KICAgIC8vIFdlIG5lZWQgdG8gbWF0Y2ggdGhhdC4KICAgIC8vIChub3RlIHRoYXQgYWxsIG90aGVyIHBhcnRzIG9mIHRoZSBVUkwsIGxpa2UgYGhhc2hgLCBhcmUgcHJlc2VydmVkKQogICAgdGFyZ2V0VXJsLnNlYXJjaCA9ICcnCiAgfQoKICBjb25zdCBmb3JtRGF0YSA9IG5ldyBGb3JtRGF0YShmb3JtRWxlbWVudCkKCiAgZm9yIChsZXQgW25hbWUsIHZhbHVlXSBvZiBmb3JtRGF0YSkgewogICAgaWYgKHR5cGVvZiB2YWx1ZSAhPT0gJ3N0cmluZycpIHsKICAgICAgLy8gRm9yIGZpbGUgaW5wdXRzLCB0aGUgbmF0aXZlIGJyb3dzZXIgYmVoYXZpb3IgaXMgdG8gdXNlIHRoZSBmaWxlbmFtZSBhcyB0aGUgdmFsdWUgaW5zdGVhZDoKICAgICAgLy8KICAgICAgLy8gICAiSWYgZW50cnkncyB2YWx1ZSBpcyBhIEZpbGUgb2JqZWN0LCB0aGVuIGxldCB2YWx1ZSBiZSBlbnRyeSdzIHZhbHVlJ3MgbmFtZS4gT3RoZXJ3aXNlLCBsZXQgdXJuIGNvZGVgCiAgLy8gSW1wb3J0YW50OiBQbGVhc2UgYWRkIHRoZSBmb2xsb3dpbmcgYXR0cmlidXRlcyB0byB0aGUgZWxlbWVudCB0aGF0IHNob3VsZCB0cmlnZ2VyIHRoZSBjYWxlbmRhciB0byBvcGVuIHVwb24gY2xpY2tpbmcuCiAgLy8gXGBkYXRhLWNhbC1saW5rPSIke2NhbExpbmt9IlxgCiAgLy8gZGF0YS1jYWwtbmFtZXNwYWNlPSIke25hbWVzcGFjZX0iCiAgLy8gXGBkYXRhLWNhbC1jb25maWc9JyR7SlNPTi5zdHJpbmdpZnkocHJldmlld1N0YXRlLmNvbmZpZyl9J1xgCgogICR7dWlJbnN0cnVjdGlvbkNvZGV9YDsKICAgIH0sCiAgICBoZWFkbGVzczogKCkgPT4gewogICAgICByZXR1cm4gbnVsbDsKICAgIH0sCiAgfSwKfTsKCi8qKgogKiBJdCBhbGxvd3MgdXMgdG8gc2hvdyBjb2RlIHdpdGggY2VydGFpbiByZXVzYWJsZSBibG9ja3MgaW5kZW50ZWQgYWNjb3JkaW5nIHRvIHRoZSBibG9jayB2YXJpYWJsZSBwbGFjZW1lbnQKICogU28sIGlmIHlvdSBhZGQgYSB2YXJpYWJsZSAke2FiY30gd2l0aCBpbmRlbnRhdGlvbiBvZiA0IHNwYWNlcywgaXQgd2lsbCBhdXRvbWF0aWNhbGx5IGluZGVudCBhbGwgbmV3bGluZXMgaW4gYGFiY2Agd2l0aCB0aGUgc2FtZSBpbmRlbnQgYmVmb3JlIGNvbnN0cnVjdGluZyB0aGUgZmluYWwgc3RyaW5nCiAqIGBBJHt2YXJ9Q2Agd2l0aCB2YXIgPSAiQiIgLT4gICBwYXJ0c1dpdGhvdXRCbG9jaz1bJ0EnLCdDJ10gYmxvY2tzT3JWYXJpYWJsZXM9WydCJ10KICovCmNvbnN0IGNvZGUgPSAocGFydHNXaXRob3V0QmxvY2s6IFRlbXBsYXRlU3RyaW5nc0FycmF5LCAuLi5ibG9ja3NPclZhcmlhYmxlczogc3RyaW5nW10pID0+IHsKICBjb25zdCBjb25zdHJ1Y3RlZENvZGU6IHN0cmluZ1tdID0gW107CiAgZm9yIChsZXQgaSA9IDA7IGkgPCBwYXJ0c1dpdGhvdXRCbG9jay5sZW5ndGg7IGkrKykgewogICAgY29uc3QgcGFydFdpdGhvdXRCbG9jayA9IHBhcnRzV2l0aG91dEJsb2NrW2ldOwogICAgLy8gYmxvY2tzT3JWYXJpYWJsZXMgbGVuZ3RoIHdvdWxkIGFsd2F5cyBiZSAxIGxlc3MgdGhhbiBwYXJ0c1dpdGhvdXRCbG9jawogICAgLy8gU28sIGxhc3QgaXRlbSBzaG91bGQgYmUgY29uY2F0ZW5hdGVkIGFzIGlzLgogICAgaWYgKGkgPj0gYmxvY2tzT3JWYXJpYWJsZXMubGVuZ3RoKSB7CiAgICAgIGNvbnN0cnVjdGVkQ29kZS5wdXNoKHBhcnRXaXRob3V0QmxvY2spOwogICAgICBjb250aW51ZTsKICAgIH0KICAgIGNvbnN0IGJsb2NrID0gYmxvY2tzT3JWYXJpYWJsZXNbaV07CiAgICBjb25zdCBpbmRlbnRlZEJsb2NrOiBzdHJpbmdbXSA9IFtdOwogICAgbGV0IGluZGVudCA9ICIiOwogICAgYmxvY2suc3BsaXQoIlxuIikuZm9yRWFjaCgobGluZSkgPT4gewogICAgICBpbmRlbnRlZEJsb2NrLnB1c2gobGluZSk7CiAgICB9KTsKICAgIC8vIG5vbi1udWxsIGFzc2VydGlvbiBpcyBva2F5IGJlY2F1c2Ugd2Uga25vdyB0aGF0IHdlIGFyZSByZWZlcmVuY2luZyBsYXN0IGVsZW1lbnQuCiAgICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLW5vbi1udWxsLWFzc2VydGlvbgogICAgY29uc3QgaW5kZW50YXRpb25NYXRjaCA9IHBhcnRXaXRob3V0QmxvY2sKICAgICAgLnNwbGl0KCJcbiIpCiAgICAgIC5hdCgtMSkhCiAgICAgIC5tYXRjaCgvKF5bXHQgXSopLiokLyk7CiAgICBpZiAoaW5kZW50YXRpb25NYXRjaCkgewogICAgICBpbmRlbnQgPSBpbmRlbnRhdGlvbk1hdGNoWzFdOwogICAgfQogICAgY29uc3RydWN0ZWRDb2RlLnB1c2gocGFydFdpdGhvdXRCbG9jayArIGluZGVudGVkQmxvY2suam9pbihgXG4ke2luZGVudH1gKSk7CiAgfQogIHJldHVybiBjb25zdHJ1Y3RlZENvZGUuam9pbigiIik7Cn07CgpmdW5jdGlvbiBnZXRBcmd1bWVudEZvckdldENhbEFwaShuYW1lc3BhY2U6IHN0cmluZykgewogIGNvbnN0IGxpYlVybCA9IElTX1NFTEZfSE9TVEVEID8gZW1iZWRMaWJVcmwgOiB1bnRlciI+DQogICAgICAgICAgPFNwaW5uZXIgY2xhc3NOYW1lPSJtci0yIGgtNSB3LTUiIC8+DQogICAgICAgICAgPHA+TG9hZGluZyBwYXltZW50IHBhZ2UuLi48L3A+DQogICAgICAgIDwvZGl2Pg0KICAgICAgKX0NCg0KICAgICAgPGRpdiBjbGFzc05hbWU9e2B3LWZ1bGwgJHtpZnJhbWVMb2FkZWQgPyAiYmxvY2siIDogImhpZGRlbiJ9YH0+DQogICAgICAgIDxpZnJhbWUNCiAgICAgICAgICBzcmM9e2NoZWNrb3V0VXJsfQ0KICAgICAgICAgIHRpdGxlPSJCVENQYXkgUGF5bWVudCINCiAgICAgICAgICBjbGFzc05hbWU9ImgtWzEwMDBweF0gdy1mdWxsIHJvdW5kZWQtbWQgYm9yZGVyLTAiDQogICAgICAgICAgb25Mb2FkPXsoKSA9PiBzZXRJZnJhbWVMb2FkZWQodHJ1ZSl9DQogICAgICAgIC8+DQogICAgICA8L2Rpdj4NCg0KICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggZmxleC1yb3cgZmxleC13cmFwIGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBnYXAtNCI+DQogICAgICAgIDxCdXR0b24NCiAgICAgICAgICBzaXplPSJzbSINCiAgICAgICAgICBjb2xvcj0ic2Vjb25kYXJ5Ig0KICAgICAgICAgIG9uQ2xpY2s9eygpID0+IGNvcHlUb0NsaXBib2FyZChjaGVja291dFVybCl9DQogICAgICAgICAgY2xhc3NOYW1lPSJ0ZXh0LXN1YnRsZSByb3VuZGVkLW1kIg0KICAgICAgICAgIFN0YXJ0SWNvbj17aXNDb3BpZWQgPyAiY2xpcGJvYXJkLWNoZWNrIiA6ICJjbGlwYm9hcmQifT4NCiAgICAgICAgICBDb3B5IFBheW1lbnQgTGluaw0KICAgICAgICA8L0J1dHRvbj4NCg0KICAgICAgICA8QnV0dG9uIG9uQ2xpY2s9e2hhbmRsZU9wZW5Jbk5ld1RhYn0+T3BlbiBpbiBOZXcgVGFiPC9CdXR0b24+DQogICAgICA8L2Rpdj4NCiAgICA8L2Rpdj4NCiAgKTsNCn07DQoNCnR5cGUgUGF5bWVudENoZWNrZXJQcm9wcyA9IFBheW1lbnRQYWdlUHJvcHM7DQoNCmZ1bmN0aW9uIFBheW1lbnRDaGVja2VyKHByb3BzOiBQYXltZW50Q2hlY2tlclByb3BzKSB7DQogIC8vIFRPRE86IG1vdmUgYm9va2luZyBzdWNjZXNzIGNvZGUgdG8gYSBjb21tb24gbGliIGZ1bmN0aW9uDQogIC8vIFRPRE86IHN1YnNjcmliZSByYXRoZXIgdGhhbiBwb2xsaW5nDQogIGNvbnN0IHNlYXJjaFBhcmFtcyA9IHVzZUNvbXBhdFNlYXJjaFBhcmFtcygpOw0KICBjb25zdCBib29raW5nU3VjY2Vzc1JlZGlyZWN0ID0gdXNlQm9va2luZ1N1Y2Nlc3NSZWRpcmVjdCgpOw0KICBjb25zdCB1dGlscyA9IHRycGMudXNlVXRpbHMoKTsNCiAgY29uc3QgeyB0IH0gPSB1c2VMb2NhbGUoKTsNCg0KICB1c2VFZmZlY3QoKCkgPT4gew0KICAgIGlmIChzZWFyY2hQYXJhbXMgPT09IG51bGwpIHsNCiAgICAgIHJldHVybjsNCiAgICB9DQoNCiAgICAvLyB1c2UgY2xvc3VyZSB0byBlbnN1cmUgbm9uLW51bGxhYmlsaXR5DQogICAgY29uc3Qgc3AgPSBzZWFyY2hQYXJhbXM7DQogICAgY29uc3QgaW50ZXJ2YWwgPSBzZXRJbnRlcnZhbCgoKSA9PiB7DQogICAgICAoYXN5bmMgKCkgPT4gew0KICAgICAgICB0cnkgew0KICAgICAgICAgIGlmIChwcm9wcy5ib29raW5nLnN0YXR1cyA9PT0gIkFDQ0VQVEVEIikgew0KICAgICAgICAgICAgcmV0dXJuOw0KICAgICAgICAgIH0NCiAgICAgICAgICBjb25zdCB7IGJvb2tpbmc6IGJvb2tpbmdSZXN1bHQgfSA9IGF3YWl0IHV0aWxzLnZpZXdlci5ib29raW5ncy5maW5kLmZldGNoKHsNCiAgICAgICAgICAgIGJvb2tpbmdVaWQ6IHByb3BzLmJvb2tpbmcudWlkLA0KICAgICAgICAgIH0pOw0KDQogICAgICAgICAgaWYgKGJvb2tpbmdSZXN1bHQ/LnBhaWQpIHsNCiAgICAgICAgICAgIHNob3dUb2FzdCgiUGF5bWVudCBzdWNjZXNzZnVsIiwgInN1Y2Nlc3MiKTsNCg0KICAgICAgICAgICAgY29uc3QgcGFyYW1zOiB7DQogICAgICAgICAgICAgIHVpZDogc3RyaW5nOw0KICAgICAgICAgICAgICBlbWFpbDogc3RyaW5nIHwgbnVsbDsNCiAgICAgICAgICAgICAgbG9jYXRpb2UteC1bLTUwJV0gcnRsOmRhdGEtW3N0YXJ0aW5nLXN0eWxlXTpkYXRhLVthY3RpdmF0aW9uLWRpcmVjdGlvbj1yaWdodF06LXRyYW5zbGF0ZS14LVs1MCVdIiwKICAgICAgICBjbGFzc05hbWUKICAgICAgKX0KICAgICAgey4uLnByb3BzfQogICAgLz4KICApCn0KCmZ1bmN0aW9uIE5hdmlnYXRpb25NZW51UG9zaXRpb25lcih7CiAgY2xhc3NOYW1lLAogIHNpZGUgPSAiYm90dG9tIiwKICBzaWRlT2Zmc2V0ID0gOCwKICBhbGlnbiA9ICJzdGFydCIsCiAgYWxpZ25PZmZzZXQgPSAwLAogIC4uLnByb3BzCn06IE5hdmlnYXRpb25NZW51UHJpbWl0aXZlLlBvc2l0aW9uZXIuUHJvcHMpIHsKICByZXR1cm4gKAogICAgPE5hdmlnYXRpb25NZW51UHJpbWl0aXZlLlBvcnRhbD4KICAgICAgPE5hdmlnYXRpb25NZW51UHJpbWl0aXZlLlBvc2l0aW9uZXIKICAgICAgICBzaWRlPXtzaWRlfQogICAgICAgIHNpZGVPZmZzZXQ9e3NpZGVPZmZzZXR9CiAgICAgICAgYWxpZ249e2FsaWdufQogICAgICAgIGFsaWduT2Zmc2V0PXthbGlnbk9mZnNldH0KICAgICAgICBjbGFzc05hbWU9e2NuKAogICAgICAgICAgImlzb2xhdGUgei01MCBoLVt2YXIoLS1wb3NpdGlvbmVyLWhlaWdodCldIHctW3ZhcigtLXBvc2l0aW9uZXItd2lkdGgpXSBtYXgtdy1bdmFyKC0tYXZhaWxhYmxlLXdpZHRoKV0gdHJhbnNpdGlvbi1bdG9wLGxlZnQscmlnaHQsYm90dG9tXSBkdXJhdGlvbi0zMDAgZHVyYXRpb24tWzAuMzVzXSBlYXNlLVtjdWJpYy1iZXppZXIoMC4yMiwxLDAuMzYsMSldIGRhdGEtW2luc3RhbnRdOnRyYW5zaXRpb24tbm9uZSBkYXRhLVtzaWRlPWJvdHRvbV06YmVmb3JlOnN0YXJ0LTAgZGF0YS1bc2lkZT1ib3R0b21dOmJlZm9yZTplbmQtMCBkYXRhLVtzaWRlPWJvdHRvbV06YmVmb3JlOnRvcC1bLTEwcHhdIiwKICAgICAgICAgIGNsYXNzTmFtZQogICAgICAgICl9CiAgICAgICAgey4uLnByb3BzfQogICAgICA+CiAgICAgICAgPE5hdmlnYXRpb25NZW51UHJpbWl0aXZlLlBvcHVwIGNsYXNzTmFtZT0iYmctcG9wb3ZlciB0ZXh0LXBvcG92ZXItZm9yZWdyb3VuZCByaW5nLWZvcmVncm91bmQvMTAgZGF0YS1bZW5kaW5nLXN0eWxlXTplYXNpbmctW2Vhc2VdIHhzOnctKC0tcG9wdXAtd2lkdGgpIHJlbGF0aXZlIGgtKC0tcG9wdXAtaGVpZ2h0KSB3LSgtLXBvcHVwLXdpZHRoKSBvcmlnaW4tKC0tdHJhbnNmb3JtLW9yaWdpbikgcm91bmRlZC1sZyBzaGFkb3cgcmluZy0xIHRyYW5zaXRpb24tW29wYWNpdHksdHJhbnNmb3JtLHdpZHRoLGhlaWdodCxzY2FsZSx0cmFuc2xhdGVdIHRyYW5zaXRpb24tYWxsIGR1cmF0aW9uLVswLjM1c10gZWFzZS1bY3ViaWMtYmV6aWVyKDAuMjIsMSwwLjM2LDEpXSBvdXRsaW5lLW5vbmUgZGF0YS1bZW5kaW5nLXN0eWxlXTpzY2FsZS05MCBkYXRhLVtlbmRpbmctc3R5bGVdOm9wYWNpdHktMCBkYXRhLVtlbmRpbmctc3R5bGVdOmR1cmF0aW9uLTE1MCBkYXRhLVtzdGFydGluZy1zdHlsZV06c2NhbGUtOTAgZGF0YS1bc3RhcnRpbmctc3R5bGVdOm9wYWNpdHktMCI+CiAgICAgICAgICA8TmF2aWdhdGlvbk1lbnVQcmltaXRpdmUuVmlld3BvcnQgY2xhc3NOYW1lPSJyZWxhdGl2ZSBzaXplLWZ1bGwgb3ZlcmZsb3ctaGlkZGVuIiAvPgogICAgICAgIDwvTmF2aWdhdGlvbk1lbnVQcmltaXRpdmUuUG9wdXA+CiAgICAgIDwvTmF2aWdhdGlvbk1lbnVQcmltaXRpdmUuUG9zaXRpb25lcj4KICAgIDwvTmF2aWdhdGlvbk1lbnVQcmltaXRpdmUuUG9ydGFsPgogICkKfQoKZnVuY3Rpb24gTmF2aWdhdGlvbk1lbnVMaW5rKHsKICBjbGFzc05hbWUsCiAgLi4ucHJvcHMKfTogTmF2aWdhdGlvbk1lbnVQcmltaXRpdmUuTGluay5Qcm9wcykgewogIHJldHVybiAoCiAgICA8TmF2aWdhdGlvbk1lbnVQcmltaXRpdmUuTGluawogICAgICBkYXRhLXNsb3Q9Im5hdmlnYXRpb24tbWVudS1saW5rIgogICAgICBjbGFzc05hbWU9e2NuKAogICAgICAgICJkYXRhLWFjdGl2ZTpmb2N1czpiZy1UaGlzIGRpYWxvZyBkb2VzbiZhcG9zO3QgaGF2ZSBhIGNsb3NlIGJ1dHRvbiBpbiB0aGUgdG9wLXJpZ2h0CiAgICAgICAgICAgICAgY29ybmVyLgogICAgICAgICAgICA8L0RpYWxvZ0Rlc2NyaXB0aW9uPgogICAgICAgICAgPC9EaWFsb2dIZWFkZXI+CiAgICAgICAgICA8RGlhbG9nRm9vdGVyPgogICAgICAgICAgICA8RGlhbG9nQ2xvc2UgcmVuZGVyPXs8QnV0dG9uIHZhcmlhbnQ9Im91dGxpbmUiIC8+fT4KICAgICAgICAgICAgICBDbG9zZQogICAgICAgICAgICA8L0RpYWxvZ0Nsb3NlPgogICAgICAgICAgPC9EaWFsb2dGb290ZXI+CiAgICAgICAgPC9EaWFsb2dDb250ZW50PgogICAgICA8L0RpYWxvZz4KICAgIDwvRXhhbXBsZT4KICApCn0KCmNvbnN0IHNwb2tlbkxhbmd1YWdlcyA9IFsKICB7IGxhYmVsOiAiQXV0byIsIHZhbHVlOiAiYXV0byIgfSwKICB7IGxhYmVsOiAiRW5nbGlzaCIsIHZhbHVlOiAiZW4iIH0sCiAgeyBsYWJlbDogIlNwYW5pc2giLCB2YWx1ZTogImVzIiB9LAogIHsgbGFiZWw6ICJGcmVuY2giLCB2YWx1ZTogImZyIiB9LAogIHsgbGFiZWw6ICJHZXJtYW4iLCB2YWx1ZTogImRlIiB9LAogIHsgbGFiZWw6ICJJdGFsaWFuIiwgdmFsdWU6ICJpdCIgfSwKICB7IGxhYmVsOiAiUG9ydHVndWVzZSIsIHZhbHVlOiAicHQiIH0sCiAgeyBsYWJlbDogIlJ1c3NpYW4iLCB2YWx1ZTogInJ1IiB9LAogIHsgbGFiZWw6ICJDaGluZXNlIiwgdmFsdWU6ICJ6aCIgfSwKICB7IGxhYmVsOiAiSmFwYW5lc2UiLCB2YWx1ZTogImphIiB9LAogIHsgbGFiZWw6ICJLb3JlYW4iLCB2YWx1ZTogImtvIiB9LAogIHsgbGFiZWw6ICJBcmFiaWMiLCB2YWx1ZTogImFyIiB9LAogIHsgbGFiZWw6ICJIaW5kaSIsIHZhbHVlOiAiaGkiIH0sCiAgeyBsYWJlbDogIkJlbmdhbGkiLCB2YWx1ZTogImJuIiB9LAogIHsgbGFiZWw6ICJUZWx1Z3UiLCB2YWx1ZTogInRlIiB9LAogIHsgbGFiZWw6ICJNYXJhdGhpIiwgdmFsdWU6ICJtciIgfSwKICB7IGxhYmVsOiAiS2FubmFkYSIsIHZhbHVlOiAia24iIH0sCiAgeyBsYWJlbDogIk1hbGF5YWxhbSIsIHZhbHVlOiAibWwiIH0sCl0KCmNvbnN0IHZvaWNlcyA9IFsKICB7IGxhYmVsOiAiU2FtYW50aGEiLCB2YWx1ZTogInNhbWFudGhhIiB9LAogIHsgbGFiZWw6ICJBbGV4IiwgdmFsdWU6ICJhbGV4IiB9LAogIHsgbGFiZWw6ICJGcmVkIiwgdmFsdWU6ICJmcmVkIiB9LAogIHsgbGFiZWw6ICJWaWN0b3JpYSIsIHZhbHVlOiAidmljdG9yaWEiIH0sCiAgeyBsYWJlbDogIlRvbSIsIHZhbHVlOiAidG9tIiB9LAogIHsgbGFiZWw6ICJLYXJlbiIsIHZhbHVlOiAia2FyZW4iIH0sCiAgeyBsYWJlbDogIlNhbSIsIHZhbHVlOiAic2FtIiB9LAogIHsgbGFiZWw6ICJEYW5pZWwiLCB2YWx1ZTogImRhbmllbCIgfSwKXQoKY29uc3QgdGhlbWVzID0gWwogIHsgbGFiZWw6ICJMaWdodCIsIHZhbHVlOiAibGlnaHQiIH0sCiAgeyBsYWJlbDogIkRhcmsiLCB2YWx1ZTogImRhcmsiIH0sCiAgeyBsYWJlbDogIlN5c3RlbSIsIHZhbHVlOiAic3lzdGVtIiB9LApdCgpjb25zdCBhY2NlbnRzID0gWwogIHsgbGFiZWw6ICJEZWZhdWx0IiwgdmFsdWU6ICJkZWZhdWx0IiB9LAogIHsgbGFiZWw6ICJSZWQiLCB2YWx1ZTogInJlZCIgfSwKICB7IGxhYmVsOiAiQmx1ZSIsIHZhbHVlOiAiYmx1ZSIgfSwKICB7IGxhYmVsOiAiR3JlZW4iLCB2YWx1ZTogImdyZWVuIiB9LAogIHsgbGFiZWw6ICJQdXJwbGUiLCB2YWx1ZTogInB1cnBsZSIgfSwKICB7IGxhYmVsOiAiUGluayIsIHZhbHVlOiAicGluayIgfSwKXQoKZnVuY3Rpb24gRGlhbG9nQ2hhdFNldHRpbmdzKCkgewogIGNvbnN0IFt0YWIsIHNldFRhYl0gPSBSZWFjdC51c2VTdGF0ZSgiZ2VuZXJhbCIpCiAgY29uc3QgW3RoZW1lLCBzZXRUaGVtZV0gPSBSZWFjdC51c2VTdGF0ZSgic3lzdGVtIikKICBjb25zdCBbYWNjZW50Q29sb3IsIHNldEFjY2VudENvbG9yXSA9IFJlYWN0LnVzZVN0YXRlKCJkZWZhdWx0IikKZXI9IlR5cGUgdG8gc2VhcmNoLi4uIgogICAgICAgICAgICAvPgogICAgICAgICAgICA8SW5wdXRHcm91cEFkZG9uIGFsaWduPSJpbmxpbmUtc3RhcnQiPgogICAgICAgICAgICAgIDxJY29uUGxhY2Vob2xkZXIKICAgICAgICAgICAgICAgIGx1Y2lkZT0iU3BhcmtsZXNJY29uIgogICAgICAgICAgICAgICAgdGFibGVyPSJJY29uU2VydmVyU3BhcmsiCiAgICAgICAgICAgICAgICBodWdlaWNvbnM9IlNwYXJrbGVzSWNvbiIKICAgICAgICAgICAgICAgIHBob3NwaG9yPSJTcGFya2xlSWNvbiIKICAgICAgICAgICAgICAgIHJlbWl4aWNvbj0iUmlTcGFya2xpbmdMaW5lIgogICAgICAgICAgICAgIC8+CiAgICAgICAgICAgIDwvSW5wdXRHcm91cEFkZG9uPgogICAgICAgICAgICA8SW5wdXRHcm91cEFkZG9uIGFsaWduPSJpbmxpbmUtZW5kIj4KICAgICAgICAgICAgICA8S2JkR3JvdXA+CiAgICAgICAgICAgICAgICA8S2JkPkN0cmw8L0tiZD4KICAgICAgICAgICAgICAgIDxLYmQ+QzwvS2JkPgogICAgICAgICAgICAgIDwvS2JkR3JvdXA+CiAgICAgICAgICAgIDwvSW5wdXRHcm91cEFkZG9uPgogICAgICAgICAgPC9JbnB1dEdyb3VwPgogICAgICAgIDwvRmllbGQ+CiAgICAgICAgPEZpZWxkPgogICAgICAgICAgPEZpZWxkTGFiZWwgaHRtbEZvcj0iaW5wdXQtdXNlcm5hbWUtMjYiPlVzZXJuYW1lPC9GaWVsZExhYmVsPgogICAgICAgICAgPElucHV0R3JvdXA+CiAgICAgICAgICAgIDxJbnB1dEdyb3VwSW5wdXQgaWQ9ImlucHV0LXVzZXJuYW1lLTI2IiBkZWZhdWx0VmFsdWU9InNoYWRjbiIgLz4KICAgICAgICAgICAgPElucHV0R3JvdXBBZGRvbiBhbGlnbj0iaW5saW5lLWVuZCI+CiAgICAgICAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggc2l6ZS00IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciByb3VuZGVkLWZ1bGwgYmctZ3JlZW4tNTAwIGRhcms6YmctZ3JlZW4tODAwIj4KICAgICAgICAgICAgICAgIDxJY29uUGxhY2Vob2xkZXIKICAgICAgICAgICAgICAgICAgbHVjaWRlPSJDaGVja0ljb24iCiAgICAgICAgICAgICAgICAgIHRhYmxlcj0iSWNvbkNoZWNrIgogICAgICAgICAgICAgICAgICBodWdlaWNvbnM9IlRpY2swMkljb24iCiAgICAgICAgICAgICAgICAgIHBob3NwaG9yPSJDaGVja0ljb24iCiAgICAgICAgICAgICAgICAgIHJlbWl4aWNvbj0iUmlDaGVja0xpbmUiCiAgICAgICAgICAgICAgICAgIGNsYXNzTmFtZT0ic2l6ZS0zIHRleHQtd2hpdGUiCiAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgIDwvZGl2PgogICAgICAgICAgICA8L0lucHV0R3JvdXBBZGRvbj4KICAgICAgICAgIDwvSW5wdXRHcm91cD4KICAgICAgICAgIDxGaWVsZERlc2NyaXB0aW9uIGNsYXNzTmFtZT0idGV4dC1ncmVlbi03MDAiPgogICAgICAgICAgICBUaGlzIHVzZXJuYW1lIGlzIGF2YWlsYWJsZS4KICAgICAgICAgIDwvRmllbGREZXNjcmlwdGlvbj4KICAgICAgICA8L0ZpZWxkPgogICAgICAgIDxJbnB1dEdyb3VwPgogICAgICAgICAgPElucHV0R3JvdXBJbnB1dAogICAgICAgICAgICBpZD0iaW5wdXQtc2VhcmNoLWRvY3MtMjciCiAgICAgICAgICAgIHBsYWNlaG9sZGVyPSJTZWFyY2ggZG9jdW1lbnRhdGlvbi4uLiIKICAgICAgICAgIC8+CiAgICAgICAgICA8SW5wdXRHcm91cEFkZG9uPgogICAgICAgICAgICA8SWNvblBsYWNlaG9sZGVyCiAgICAgICAgICAgICAgbHVjaWRlPSJTZWFyY2hJY29uIgogICAgICAgICAgICAgIHRhYmxlcj0iSWNvblNlYXJjaCIKICAgICAgICAgICAgICBodWdlaWNvbnM9IlNlYXJjaEljb24iCiAgICAgICAgICAgICAgcGhvc3Bob3I9Ik1hZ25pZnlpbmdHbGFzc0ljb24iCiAgICAgICAgICAgICAgcmVtaXhpY29uPSJSaVNlYXJjaExpbmUiCiAgICAgICAgICAgIC8+CiAgICAgICAgICA8L0lucHV0R3JvdXBBZGRvbj4KICAgICAgICAgIDxJbnB1dEdyb3VwQWRkb24gYWxpZ249ImlubGluZS1lbmQiPjEyIHJlc3VsdHM8LzMuNzM1QzI1LjMxOSAyMi44NzM3IDI1LjI5MzcgMjIuMTIgMjUuMDkxIDIxLjQ3NEMyNC45MDEgMjAuODI4IDI0LjU2NTMgMjAuMjgzMyAyNC4wODQgMTkuODRDMjMuNjE1MyAxOS4zOTY3IDIzLjAzOSAxOS4wNjczIDIyLjM1NSAxOC44NTJDMjEuNjgzNyAxOC42MjQgMjAuOTQ5IDE4LjUxIDIwLjE1MSAxOC41MUMxOC4zMDE3IDE4LjUxIDE2LjgzMjMgMTguOTUzMyAxNS43NDMgMTkuODRDMTQuNjUzNyAyMC43MjY3IDEzLjkgMjIuMDI1IDEzLjQ4MiAyMy43MzVDMTMuMzU1MyAyNC4yOTIzIDEzLjIyODcgMjQuODQzMyAxMy4xMDIgMjUuMzg4QzEyLjk4OCAyNS45MzI3IDEyLjg4MDMgMjYuNDc3MyAxMi43NzkgMjcuMDIyQzEyLjYzOTcgMjcuODgzMyAxMi42NjUgMjguNjM3IDEyLjg1NSAyOS4yODNDMTMuMDU3NyAyOS45MjkgMTMuMzkzMyAzMC40NjczIDEzLjg2MiAzMC44OThDMTQuMzMwNyAzMS4zMjg3IDE0LjkwNyAzMS42NTE3IDE1LjU5MSAzMS44NjdaTTE5Ljg2NiAyOC44NDZDMTkuMzQ2NyAyOS4yNTEzIDE4Ljc0NSAyOS40NTQgMTguMDYxIDI5LjQ1NEMxNy4zNjQzIDI5LjQ1NCAxNi44NjQgMjkuMjUxMyAxNi41NiAyOC44NDZDMTYuMjU2IDI4LjQ0MDcgMTYuMTggMjcuNzk0NyAxNi4zMzIgMjYuOTA4QzE2LjQzMzMgMjYuMzUwNyAxNi41MzQ3IDI1LjgyNSAxNi42MzYgMjUuMzMxQzE2Ljc1IDI0LjgzNyAxNi44NzY3IDI0LjMyNCAxNy4wMTYgMjMuNzkyQzE3LjIzMTMgMjIuOTA1MyAxNy41OTIzIDIyLjI1OTMgMTguMDk5IDIxLjg1NEMxOC42MTgzIDIxLjQ0ODcgMTkuMjIgMjEuMjQ2IDE5LjkwNCAyMS4yNDZDMjAuNTg4IDIxLjI0NiAyMS4wODgzIDIxLjQ0ODcgMjEuNDA1IDIxLjg1NEMyMS43MjE3IDIyLjI1OTMgMjEuNzk3NyAyMi45MDUzIDIxLjYzMyAyMy43OTJDMjEuNTQ0MyAyNC4zMjQgMjEuNDQzIDI0LjgzNyAyMS4zMjkgMjUuMzMxQzIxLjIyNzcgMjUuODI1IDIxLjEwNzMgMjYuMzUwNyAyMC45NjggMjYuOTA4QzIwLjc1MjcgMjcuNzk0NyAyMC4zODUzIDI4LjQ0MDcgMTkuODY2IDI4Ljg0NlpNMjUuNjQwNCAzMS44NjdDMjUuNzE2NCAzMS45NTU3IDI1LjgxNzcgMzIgMjUuOTQ0NCAzMkgyOC41Mjg0QzI4LjY2NzcgMzIgMjguNzg4IDMxLjk1NTcgMjguODg5NCAzMS44NjdDMjkuMDAzNCAzMS43NzgzIDI5LjA3MyAzMS42NjQzIDI5LjA5ODQgMzEuNTI1TDI5Ljk3MjQgMjcuMzY0SDMyLjUzNzRDMzQuMTcxNCAyNy4zNjQgMzUuNDY5NyAyNy4wMTU3IDM2LjQzMjQgMjYuMzE5QzM3LjQwNzcgMjUuNjIyMyAzOC4wNTM3IDI0LjU0NTcgMzguMzcwNCAyMy4wODlDMzguNTIyNCAyMi4zNTQzIDM4LjUxNiAyMS43MTQ3IDM4LjM1MTQgMjEuMTdDMzguMTg2NyAyMC42MTI3IDM3Ljg5NTQgMjAuMTUwMyAzNy40Nzc0IDE5Ljc4M0MzNy4wNTk0IDE5LjQxNTcgMzYuNTMzNyAxOS4xNDMzIDM1LjkwMDQgMTguOTY2QzM1LjI3OTcgMTguNzg4NyAzNC41ODMgMTguNyAzMy44MTA0IDE4LjdIMjguNzU2NEMyOC42Mjk3IDE4LjcgMjguNTA5NCAxOC43NDQzIDI4LjM5NTQgMTguODMzQzI4LjI4MTQgMTguOTIxNyAyOC4yMTE3IDE5LjAzNTcgMjguMTg2NCAxOS4xNzVMMjUuNTY0NCAzMS41MjVDMjUuNTM5IDMxLjY2NDMgMjUuNTY0NCAzMS43NzgzIDI1LjY0MDQgMzEuODY3Wk0zMi42NTE0IDI0Ljc0MkgzMC40NjY0TDMxLjIwNzQgMjEuMzQxSDMzLjQ4NzRDMzMuOTQzNCAyMS4zNDEgMzQuMjc5IDIxLjQxNyAzNC40OTQ0IDIxLjU2OUMzNC43MjI0IDIxLjcyMSAzNC44NTU0IDIxLjkyMzcgMzQuODkzNCAyMi4xNzdDMzQuOTMxNCAyMi40MzAzIDM0LjkxODcgMjIuNzIxNyAzNC44NTU0IDIzLjA1MUMzNC43Mjg3IDIzLjYyMSAzNC40NTY0IDI0LjA0NTMgMzQuMDM4NCAyNC4zMjRDMzMuNjMzIDI0LjYwMjcgMzMuMTcwNyAyNC43NDIgMzIuNjUxNCAyNC43NDJaIgogICAgICAgICAgZmlsbD0id2hpdGUiCiAgICAgICAgICBmaWxsUnVsZT0iZXZlbm9kZCIKICBsb3I9InRleHQuc2Vjb25kYXJ5IgogICAgICAgICAgICAgICAgICAvPgogICAgICAgICAgICAgICAgPC8+CiAgICAgICAgICAgICAgKX0KICAgICAgICAgICAgPC9TdGFjaz4KICAgICAgICAgIDwvUm93PgogICAgICAgICAge3JlZGVlbVR5cGUgPT09IFJlZGVlbVR5cGUuQVRPS0VOICYmICgKICAgICAgICAgICAgPERldGFpbHNIRkxpbmUKICAgICAgICAgICAgICBoZWFsdGhGYWN0b3I9e3VzZXI/LmhlYWx0aEZhY3RvciB8fCAnLTEnfQogICAgICAgICAgICAgIGZ1dHVyZUhlYWx0aEZhY3Rvcj17aGZBZnRlclJlZGVlbX0KICAgICAgICAgICAgICB2aXNpYmxlSGZDaGFuZ2U9eyEhcmVkZWVtZWRBbW91bnR9CiAgICAgICAgICAgICAgbG9hZGluZz17aXNMb2FkaW5nfQogICAgICAgICAgICAvPgogICAgICAgICAgKX0KICAgICAgICA8L1R4TW9kYWxEZXRhaWxzPgogICAgICApIDogKAogICAgICAgIDxHYXNTdGF0aW9uIGdhc0xpbWl0PXtwYXJzZVVuaXRzKGdhc0xpbWl0IHx8ICcwJywgJ3dlaScpfSBjaGFpbklkPXtDaGFpbklkLm1haW5uZXR9IC8+CiAgICAgICl9CgogICAgICB7Lyoge2Jsb2NraW5nRXJyb3IgIT09IHVuZGVmaW5lZCAmJiAoCiAgICAgICAgPFR5cG9ncmFwaHkgdmFyaWFudD0iaGVscGVyVGV4dCIgY29sb3I9InJlZCI+CiAgICAgICAgICB7aGFuZGxlQmxvY2tlZCgpfQogICAgICAgIDwvVHlwb2dyYXBoeT4KICAgICAgKX0gKi99CgogICAgICB7dHhFcnJvciAmJiA8R2FzRXN0aW1hdGlvbkVycm9yIHR4RXJyb3I9e3R4RXJyb3J9IC8+fQoKICAgICAgPFVuU3Rha2VBY3Rpb25zCiAgICAgICAgc3g9e3sgbXQ6ICc0OHB4JyB9fQogICAgICAgIGFtb3VudFRvVW5TdGFrZT17YW1vdW50VG9SZWRlZW0gfHwgJzAnfQogICAgICAgIGlzV3JvbmdOZXR3b3JrPXtpc1dyb25nTmV0d29ya30KICAgICAgICBzeW1ib2w9e3N5bWJvbEZvcm1hdHRlZH0KICAgICAgICBibG9ja2VkPXtmYWxzZX0KICAgICAgICBzdGFrZURhdGE9e3N0YWtlRGF0YX0KICAgICAgICByZXNlcnZlPXtwb29sUmVzZXJ2ZX0KICAgICAgICByZWRlZW1UeXBlPXtyZWRlZW1UeXBlfQogICAgICAvPgogICAgPC8+CiAgKTsKfTsKLyogZXNsaW50LWRpc2FibGUgbWF4LWxpbmVzICovCmltcG9ydCB7IFByZWZldGNoQmFsYW5jZXNXcmFwcGVyIH0gZnJvbSAnYXBwR3JhcGhxbC9kYXRhL2Fwb2xsby9BZGFwdGl2ZVRva2VuQmFsYW5jZXNQcm92aWRlcicKaW1wb3J0IHsgUHJvdG9jb2xWZXJzaW9uIH0gZnJvbSAnQHVuaXN3YXAvY2xpZW50LWRhdGEtYXBpL2Rpc3QvZGF0YS92MS9wb29sVHlwZXNfcGInCmltcG9ydCB0eXBlIHsgQ3VycmVuY3ksIFBlcmNlbnQgfSBmcm9tICdAdW5pc3dhcC9zZGstY29yZScKaW1wb3J0IHsKICBBbGxvd2VkVjRXZXRoSG9va0FkZHJlc3Nlc0NvbmZpZ0tleSwKICBEeW5hbWljQ29uZmlncywKICBGZWF0dXJlRmxhZ3MsCiAgdXNlRHluYW1pY0NvbmZpZ1ZhbHVlLAogIHVzZUZlYXR1cmVGbGFnLAp9IGZyb20gJ0B1bml2ZXJzZS9nYXRpbmcnCmltcG9ydCBDcmVhdGluZ1Bvb2xJbmZvIGZyb20gJ2NvbXBvbmVudHMvQ3JlYXRpbmdQb29sSW5mby9DcmVhdGluZ1Bvb2xJbmZvJwppbXBvcnQgeyBFcnJvckNhbGxvdXQgfSBmcm9tICdjb21wb25lbnRzL0Vycm9yQ2FsbG91dCcKaW1wb3J0IHsgQWRkSG9vayB9IGZyb20gJ2NvbXBvbmVudHMvTGlxdWlkaXR5L0NyZWF0ZS9BZGRIb29rJwppbXBvcnQgeyBBZHZhbmNlZEJ1dHRvbiB9IGZyb20gJ2NvbXBvbmVudHMvTGlxdWlkaXR5L0NyZWF0ZS9BZHZhbmNlZEJ1dHRvbicKaW1wb3J0IHsgdXNlTGlxdWlkaXR5VXJsU3RhdGUgfSBmcm9tICdjb21wb25lbnRzL0xpcXVpZGl0eS9DcmVhdGUvaG9va3MvdXNlTGlxdWlkaXR5VXJsU3RhdGUnCmltcG9ydCB0eXBlIHsgRmVlRGF0YSB9IGZyb20gJ2NvbXBvbmVudHMvTGlxdWlkaXR5L0NyZWF0ZS90eXBlcycKaW1wb3J0IHsgREVGQVVMVF9QT1NJVElPTl9TVEFURSB9ZUFyZWEKICAgICAgICAgICAgICAgICAgICBoaXRTbG9wPXt7IHRvcDogOCwgYm90dG9tOiA4LCBsZWZ0OiA4LCByaWdodDogOCB9fQogICAgICAgICAgICAgICAgICAgIG9uUHJlc3M9eygpID0+IGhhbmRsZU9wZW5FeHBsb3JlcihzcGVuZGVyQWRkcmVzcywgYXNzZXQuY2hhaW5JZCl9CiAgICAgICAgICAgICAgICAgID4KICAgICAgICAgICAgICAgICAgICA8RXh0ZXJuYWxMaW5rIGNvbG9yPSIkbmV1dHJhbDIiIHNpemU9e2ljb25TaXplcy5pY29uMTZ9IC8+CiAgICAgICAgICAgICAgICAgIDwvVG91Y2hhYmxlQXJlYT4KICAgICAgICAgICAgICAgIDwvRmxleD4KICAgICAgICAgICAgICA8L0ZsZXg+CiAgICAgICAgICAgICkKICAgICAgICAgIH0pfQogICAgICAgIDxQb3BvdmVyLkFycm93CiAgICAgICAgICBzaXplPSIkc3BhY2luZzEyIgogICAgICAgICAgYmFja2dyb3VuZENvbG9yPXtjb2xvcnMuc3VyZmFjZTEudmFsfQogICAgICAgICAgYm9yZGVyV2lkdGg9ezF9CiAgICAgICAgICBib3JkZXJDb2xvcj17Y29sb3JzLnN1cmZhY2UzLnZhbH0KICAgICAgICAvPgogICAgICA8L1BvcG92ZXIuQ29udGVudD4KICAgIDwvUG9wb3Zlcj4KICApCn0KCi8qKgogKiBIZWxwZXIgZnVuY3Rpb24gdG8gZm9ybWF0IGFzc2V0IGFtb3VudCB3aXRoIGxvY2FsZS1zcGVjaWZpYyBudW1iZXIgZm9ybWF0dGluZwogKiBAcGFyYW0gYXNzZXQgLSBUaGUgdHJhbnNhY3Rpb24gYXNzZXQgdG8gZm9ybWF0CiAqIEBwYXJhbSBmb3JtYXROdW1iZXJPclN0cmluZyAtIExvY2FsZSBmb3JtYXR0ZXIgZnVuY3Rpb24KICogQHJldHVybnMgRm9ybWF0dGVkIGFtb3VudCB3aXRoIHN5bWJvbAogKi8KZnVuY3Rpb24gZm9ybWF0QW1vdW50V2l0aExvY2FsZSgKICBhc3NldDogVHJhbnNhY3Rpb25Bc3NldCwKICBmb3JtYXROdW1iZXJPclN0cmluZzogTG9jYWxpemF0aW9uQ29udGV4dFN0YXRlWydmb3JtYXROdW1iZXJPclN0cmluZyddLAopOiBzdHJpbmcgewogIGlmICghYXNzZXQuYW1vdW50KSB7CiAgICByZXR1cm4gYXNzZXQuc3ltYm9sID8/IGFzc2V0Lm5hbWUgPz8gJycKICB9CgogIGNvbnN0IGZvcm1hdHRlZEFtb3VudCA9IGZvcm1hdE51bWJlck9yU3RyaW5nKHsKICAgIHZhbHVlOiBhc3NldC5hbW91bnQsCiAgICB0eXBlOiBOdW1iZXJUeXBlLlRva2VuTm9uVHgsCiAgfSkKCiAgcmV0dXJuIGAke2Zvcm1hdHRlZEFtb3VudH0gJHthc3NldC5zeW1ib2wgPz8gJyd9YAp9Cgpjb25zdCBnZXRCb3JkZXJSYWRpdXMgPSAodHlwZTogVHJhbnNhY3Rpb25Bc3NldFsndHlwZSddKTogbnVtYmVyID0+IHsKICBpZiAodHlwZSA9PT0gJ0VSQzIwJyB8fCB0eXBlID09PSAnTkFUSVZFJykgewogICAgcmV0dXJuIGJvcmRlclJhZGlpLnJvdW5kZWRGdWxsCiAgfQogIHJldHVybiBib3JkZXJSYWRpaS5yb3VuZGVkMTIKfQoKaW50ZXJmYWNlIFRyYW5zYWN0aW9uQXNzZXRMaXN0UHJvcHMgewogIGFzc2V0czogVHJhbnNhY3Rpb25Bc3NldFtdCiAgaWNvbjogUmVhY3QuQ29tcG9uZW50VHlwZTxJY29uUHJvcHM+CiAgaWNvbkNvbG9yOiBDb2xvclRva2VucwogIHRpdGxlVGV4dDogc3RyaW5nCiAgZm9ybWF0QW1vdW50PzogKGFzc2V0OiBUcmFuc2FjdGlvbkFzc2V0KSA9PiBzdHJpbmcKICBzaG93VXNkVmFsdWU/OiBib29sZWFuCiAgZ3JvdXBlZEFzc2V0cz86IEdyb3VwZWRBcHByb3ZhbEFzc2V0W10KfQoKLyoqCiAqIFNoYXJlZCBjb21wb25lbnQgZm9yIHJlbmRlcmluZyB0cmFuc2FjdGlvbiBhc3NldCBsaXN0cyB3aXRoIGNvbmRpdGlvbmFsIGxheW91dDoKICogLSBTaW5nbGUgaXRlbTogSWNvbiBhbmQgdGl0bGUgaW5saW5lIHdpdGggYXNzZXQgZGV0YWlscwogKiAtIE11bHRpcGxlIGl0ZW1zOiBJY29uIGFuZCB0aXRsZSBhcyBoZWFkZXIsIHRoZW4gbGlzdCBvZiBhc3NldHMKICovCmV4cG9ydCBmdW5jdGlvbiBUcmFuc2FjdGlvbkFzc2V0TGlzdCh7CiAgYXNzZXRzLAogIGljb246IEljb24sCiAgaSAgIDxCYXNlUXVvdGVGaWF0QW1vdW50IHByaWNlPXtwcmljZX0gYmFzZT17cHJpY2UuYmFzZUN1cnJlbmN5fSBxdW90ZT17cHJpY2UucXVvdGVDdXJyZW5jeX0gLz4KICAgICAgICA8Lz4KICAgICAgKSA6ICgKICAgICAgICA8RmxleCByb3cgYWxpZ25JdGVtcz0iY2VudGVyIiBnYXA9IiRzcGFjaW5nNCI+CiAgICAgICAgICA8QWxlcnRUcmlhbmdsZUZpbGxlZCBzaXplPXsxNn0gY29sb3I9IiRuZXV0cmFsMiIgLz4KICAgICAgICAgIDxUZXh0IHZhcmlhbnQ9ImJvZHkzIiBjb2xvcj0iJG5ldXRyYWwyIj4KICAgICAgICAgICAgPFRyYW5zIGkxOG5LZXk9ImNvbW1vbi5tYXJrZXRQcmljZS51bmF2YWlsYWJsZSIgLz4KICAgICAgICAgIDwvVGV4dD4KICAgICAgICA8L0ZsZXg+CiAgICAgICl9CiAgICA8L0ZsZXg+CiAgKQp9CmltcG9ydCB7IEJhZGdlLCBCb3gsIEljb24sIEljb25Qcm9wcyB9IGZyb20gJ0BtdWkvbWF0ZXJpYWwnOwppbXBvcnQgeyBmb3J3YXJkUmVmLCB1c2VFZmZlY3QsIHVzZVJlZiwgdXNlU3RhdGUgfSBmcm9tICdyZWFjdCc7CmltcG9ydCBMYXp5TG9hZCBmcm9tICdyZWFjdC1sYXp5LWxvYWQnOwoKLyoqCiAqIFRvIHNhdmUgc29tZSBidW5kbGUgc2l6ZSB3ZSBzdG9wcGVkIGJhc2U2NCBlbmNvZGluZyAmIGlubGluaW5nIHN2Z3MgYXMgYmFzZSBlbmNvZGluZyBpbmNyZWFzZXMgc2l6ZSBieSB1cCB0byAzMCUKICogYW5kIG1vc3QgdXNlcnMgd2lsbCBuZXZlciBuZWVkIGFsbCB0b2tlbiBpY29ucy4KICogVGhlIGFUb2tlbiBpY29ucyBoYXZlIHByZXZpb3VzbHkgYmVlbiBzZXBhcmF0ZSBpY29ucyBhbHNvIGFkZGluZyB0byBidW5kbGUgc2l6ZS4gTm93IHRoZXkgYXJlIGNvbXBvc2VkIG9uIHRoZSBmbHkuCiAqIFdoZW4gYWRkaW5nIGEgdG9rZW4gdG8gbWV0YW1hc2ssIHlvdSBjYW4gZWl0aGVyIHN1cHBseSBhIHVybCBvciBhIGJhc2U2NCBlbmNvZGVkIHN0cmluZy4KICogU3VwcGx5aW5nIGEgdXJsIHNlZW1zIG5vdCB2ZXJ5IHJhdGlvbmFsLCBidXQgc3VwcGx5aW5nIGEgYmFzZTY0IGZvciBhbiBleHRlcm5hbCBzdmcgaW1hZ2UgdGhhdCBpcyBjb21wb3NlZCB3aXRoIGEgcmVhY3QgY29tcG9uZW50IGlzIG5vbiB0cml2aWFsLgogKiBUaGVyZWZvcmUgdGhlIHNvbHV0aW9uIHdlIGNhbWUgdXAgd2l0aCBpczoKICogMS4gcmVuZGVyaW5nIHRoZSBzdmcgY29tcG9uZW50IGFzIGFuIG9iamVjdAogKiAyLiByZW5kZXJpbmcgdGhlIGFUb2tlbiByaW5nIGFzIGEgcmVhY3QgY29tcG9uZW50CiAqIDMuIHVzaW5nIGpzIHRvIG1hbmlwdWxhdGUgdGhlIGRvbWUgdG8gaGF2ZSB0aGUgb2JqZWN0IHdpdGhvdXQgdGhlIHN1YmRvY3VtZW50IGluc2lkZSB0aGUgcmVhY3QgY29tcG9uZW50CiAqIDQuIGJhc2U2NCBlbmNvZGUgdGhlIGNvbXBvc2VkIGRvbSBzdmcKICoKICogVGhpcyBjb21wb25lbnQgaXMgcHJvYmFibHkgaHVnZWx5IG92ZXIgZW5naW5lZXJlZCAmIHVubmVjZXNzYXJ5LgogKiBJJ20gbG9va2luZyBmb3J3YXJkIGZvciB0aGUgcHIgd2hpY2ggZXZpY3RzIGl0LgogKi8KaW50ZXJmYWNlIEFUb2tlbkljb25Qcm9wcyB7CiAgc3ltYm9sPzogc3RyaW5nOwogIHdhVG9rZW4/OiBib29sZWFuOyAvLyBBZGQgd2FUb2tlbiBwcm9wCn0KCi8vIE1vZGlmaWVkIEJhc2U2NFRva2VuIHRvIHN1cHBvcnQgd2FUb2tlbgpleHBvcnQgZnVuY3Rpb24gQmFzZTY0VG9rZW4oewogIHN5bWJvbCwKICBvbkltYWdlR2VuZXJhdGVkLAogIGFUb2tlbiwKICB3YVRva2VuLAp9OiB7CiAgc3ltYm9sOiBzdHJpbmc7CiAgYVRva2VuPzogYm9vbGVhbjsKICB3YVRva2VuPzogYm9vbGVhbjsKICBvbkltYWdlR2VuZXJhdGVkOiAoYmFzZTY0OiBzdHJpbmcpID0+IHZvaWQ7Cn0pIHsKICBjb25zdCByZWYgPSB1c2VSZWY8SFRNTE9iamVjdEVsZW1lbnQ+KG51bGwpOwogIGNvbnN0IHRva2VuUmVmID0gdXNlUmVmPFNWR1NWR0VsZW1lbnQ+KG51bGwpOwoKICBjb25zdCBbbG9hZGk+KAogICh7CiAgICB3aWR0aCwKICAgIGhlaWdodCwKICAgIG1hcmdpbiA9IHsgdG9wOiAyMCwgcmlnaHQ6IDEwLCBib3R0b206IDIwLCBsZWZ0OiA0MCB9LAogICAgc2hvd1Rvb2x0aXAsCiAgICBoaWRlVG9vbHRpcCwKICAgIHRvb2x0aXBEYXRhLAogICAgdG9vbHRpcExlZnQgPSAwLAogICAgZGF0YSwKICAgIGxpbmVDb2xvciA9ICcjMkVCQUM2JywKICAgIHNob3dBdmVyYWdlID0gdHJ1ZSwKICB9OiBNZXJpdEFweUdyYXBoUHJvcHMgJiBXaXRoVG9vbHRpcFByb3ZpZGVkUHJvcHM8VG9vbHRpcERhdGE+KSA9PiB7CiAgICBpZiAod2lkdGggPCAxMCkgcmV0dXJuIG51bGw7CiAgICBjb25zdCB0aGVtZSA9IHVzZVRoZW1lKCk7CgogICAgLy8gVG9vbHRpcCBTdHlsZXMKICAgIGNvbnN0IGFjY2VudENvbG9yRGFyayA9IHRoZW1lLnBhbGV0dGUubW9kZSA9PT0gJ2xpZ2h0JyA/ICcjMzgzRDUxMUYnIDogJyNhNWE4YjY0Nyc7CiAgICBjb25zdCB0b29sdGlwU3R5bGVzID0gewogICAgICAuLi5kZWZhdWx0U3R5bGVzLAogICAgICBwYWRkaW5nOiAnOHB4IDEycHgnLAogICAgICBib3hTaGFkb3c6ICcwcHggMHB4IDJweCByZ2JhKDAsIDAsIDAsIDAuMiksIDBweCAycHggMTBweCByZ2JhKDAsIDAsIDAsIDAuMSknLAogICAgICBib3JkZXJSYWRpdXM6ICc0cHgnLAogICAgICBmb250U2l6ZTogJzEycHgnLAogICAgICBsaW5lSGVpZ2h0OiAnMTZweCcsCiAgICAgIGxldHRlclNwYWNpbmc6ICcwLjE1cHgnLAogICAgfTsKICAgIGNvbnN0IHRvb2x0aXBTdHlsZXNEYXJrID0gewogICAgICAuLi50b29sdGlwU3R5bGVzLAogICAgICBiYWNrZ3JvdW5kOiB0aGVtZS5wYWxldHRlLmJhY2tncm91bmQuZGVmYXVsdCwKICAgIH07CgogICAgLy8gYm91bmRzCiAgICBjb25zdCBpbm5lcldpZHRoID0gd2lkdGggLSBtYXJnaW4ubGVmdCAtIG1hcmdpbi5yaWdodDsKICAgIGNvbnN0IGlubmVySGVpZ2h0ID0gaGVpZ2h0IC0gbWFyZ2luLnRvcCAtIG1hcmdpbi5ib3R0b207CgogICAgLy8gc2NhbGVzCiAgICBjb25zdCBkYXRlU2NhbGUgPSB1c2VNZW1vKAogICAgICAoKSA9PgogICAgICAgIHNjYWxlVGltZSh7CiAgICAgICAgICByYW5nZTogWzAsIGlubmVyV2lkdGhdLAogICAgICAgICAgZG9tYWluOiBleHRlbnQoZGF0YSwgZ2V0RGF0ZSkgYXMgW0RhdGUsIERhdGVdLAogICAgICAgIH0pLAogICAgICBbaW5uZXJXaWR0aCwgZGF0YV0KICAgICk7CgogICAgY29uc3QgeVZhbHVlU2NhbGUgPSB1c2VNZW1vKCgpID0+IHsKICAgICAgY29uc3QgdmFsdWVNYXggPSBtYXgoZGF0YSwgZ2V0TWVyaXRBcHkpIGFzIG51bWJlcjsKICAgICAgcmV0dXJuIHNjYWxlTGluZWFyKHsKICAgICAgICByYW5nZTogW2lubmVySGVpZ2h0LCAwXSwKICAgICAgICBkb21haW46IFswLCAodmFsdWVNYXggfHwgMCkgKiAxLjFdLAogICAgICAgIG5pY2U6IHRydWUsCiAgICAgIH0pOwogICAgfSwgW2lubmVySGVpZ2h0LCBkYXRhXSk7CgogICAgLy8gdG9vbHRpcCBoYW5kbGVyCiAgICBjb25zdCBoYW5kbGVUb29sdGlwID0gdXNlQ2FsbGJhY2soCiAgICAgIChldmVudDogUmVhY3QuVG91Y2hFdmVudDxTVkdSZWN0RWxlbWVudD4gfCBSZWFjdC5Nb3VzZUV2ZW50PFNWR1JlY3RFbGVtZW50PikgPT4gewogICAgICAgIGNvbnN0IHsgeDogX3ggfSA9IGxvY2FsUG9pbnQoZXZlbnQpIHx8IHsgeDogMCB9OwogICAgICAgIGNvbnN0IHggPSBfeCAtIG1hcmdpbi5sZWZ0OwogICAgICAgIGNvbnN0IHgwID0gZGF0ZVNjYWxlLmludmVydCh4KTsKICAgICAgICBjb25zdCBpbmRleCA9IGJpc2VjdERhdGUoZGF0YSwgeDAsIDEpOwogICAgICAgIGNvbnN0IGQwID0gZGF0YVtpbmRleCAtIDFdOwogICAgICAgIGNvbnN0IGQxID0gZGF0YVtpbmRleF07CiAgICAgICAgbGV0IGQgPSBkMDsKICAgICAgICBpZiAoZDEgJiYgZ2V0RGF0ZShkMSkpIHsKICAgICAgICAgIGQgPSB4MC52YWx1ZU9mKCkgLSBnZXREYXRlKGQwKS52YWxzaXplLTE2cHgpOwogICAgICBoZWlnaHQ6IHZhcigtLXNpemUtMTZweCk7CiAgICB9CiAgfQoKICAub3Blbi1pbi1lZGl0b3ItYnV0dG9uLCAuc291cmNlLW1hcHBpbmctZXJyb3ItYnV0dG9uIHsKICAgIGRpc3BsYXk6IGZsZXg7CiAgICBhbGlnbi1pdGVtczogY2VudGVyOwogICAganVzdGlmeS1jb250ZW50OiBjZW50ZXI7CiAgICBib3JkZXItcmFkaXVzOiB2YXIoLS1yb3VuZGVkLWZ1bGwpOwogICAgcGFkZGluZzogNHB4OwogICAgY29sb3I6IHZhcigtLWNvbG9yLWZvbnQpOwoKICAgIHN2ZyB7CiAgICAgIHdpZHRoOiB2YXIoLS1zaXplLTE2KTsKICAgICAgaGVpZ2h0OiB2YXIoLS1zaXplLTE2KTsKICAgIH0KCiAgICAmOmZvY3VzLXZpc2libGUgewogICAgICBvdXRsaW5lOiB2YXIoLS1mb2N1cy1yaW5nKTsKICAgICAgb3V0bGluZS1vZmZzZXQ6IC0ycHg7CiAgICB9CgogICAgJjpob3ZlciB7CiAgICAgIGJhY2tncm91bmQ6IHZhcigtLWNvbG9yLWdyYXktMTAwKTsKICAgIH0KICB9CgogIC5jYWxsLXN0YWNrLWZyYW1lLWZpbGUgewogICAgY29sb3I6IHZhcigtLWNvbG9yLWdyYXktOTAwKTsKICAgIGZvbnQtc2l6ZTogdmFyKC0tc2l6ZS0xNCk7CiAgICBsaW5lLWhlaWdodDogdmFyKC0tc2l6ZS0yMCk7CiAgICB3b3JkLXdyYXA6IGJyZWFrLXdvcmQ7CiAgfQpgCmltcG9ydCB7IHVzZVN0YXRlLCB1c2VDYWxsYmFjayB9IGZyb20gJ3JlYWN0JwppbXBvcnQgeyBUaHVtYnNVcCB9IGZyb20gJy4uLy4uLy4uLy4uL2ljb25zL3RodW1icy90aHVtYnMtdXAnCmltcG9ydCB7IFRodW1ic0Rvd24gfSBmcm9tICcuLi8uLi8uLi8uLi9pY29ucy90aHVtYnMvdGh1bWJzLWRvd24nCmltcG9ydCB7IGN4IH0gZnJvbSAnLi4vLi4vLi4vLi4vdXRpbHMvY3gnCgppbnRlcmZhY2UgRXJyb3JGZWVkYmFja1Byb3BzIHsKICBlcnJvckNvZGU6IHN0cmluZwogIGNsYXNzTmFtZT86IHN0cmluZwp9CmV4cG9ydCBmdW5jdGlvbiBFcnJvckZlZWRiYWNrKHsgZXJyb3JDb2RlLCBjbGFzc05hbWUgfTogRXJyb3JGZWVkYmFja1Byb3BzKSB7CiAgY29uc3QgW3ZvdGVkTWFwLCBzZXRWb3RlZE1hcF0gPSB1c2VTdGF0ZTxSZWNvcmQ8c3RyaW5nLCBib29sZWFuPj4oe30pCiAgY29uc3Qgdm90ZWQgPSB2b3RlZE1hcFtlcnJvckNvZGVdCiAgY29uc3QgaGFzVm90ZWQgPSB2b3RlZCAhPT0gdW5kZWZpbmVkCiAgY29uc3QgZGlzYWJsZWQgPSBwcm9jZXNzLmVudi5fX05FWFRfVEVMRU1FVFJZX0RJU0FCTEVECgogIGNvbnN0IGhhbmRsZUZlZWRiYWNrID0gdXNlQ2FsbGJhY2soCiAgICBhc3luYyAod2FzSGVscGZ1bDogYm9vbGVhbikgPT4gewogICAgICAvLyBPcHRpbWlzdGljYWxseSBzZXQgZmVlZGJhY2sgc3RhdGUgd2l0aG91dCBsb2FkaW5nL2Vycm9yIHN0YXRlcyB0byBrZWVwIGltcGxlbWVudGF0aW9uIHNpbXBsZQogICAgICBzZXRWb3RlZE1hcCgocHJldikgPT4gKHsKICAgICAgICAuLi5wcmV2LAogICAgICAgIFtlcnJvckNvZGVdOiB3YXNIZWxwZnVsLAogICAgICB9KSkKCiAgICAgIHRyeSB7CiAgICAgICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBmZXRjaCgKICAgICAgICAgIGAke3Byb2Nlc3MuZW52Ll9fTkVYVF9ST1VURVJfQkFTRVBBVEggfHwgJyd9L19fbmV4dGpzX2Vycm9yX2ZlZWRiYWNrPyR7bmV3IFVSTFNlYXJjaFBhcmFtcygKICAgICAgICAgICAgewogICAgICAgICAgICAgIGVycm9yQ29kZSwKICAgICAgICAgICAgICB3YXNIZWxwZnVsOiB3YXNIZWxwZnVsLnRvU3RyaW5nKCksCiAgICAgICAgICAgIH0KICAgICAgICAgICl9YAogICAgICAgICkKCiAgICAgICAgaWYgKCFyZXNwb25zZS5vaykgewogICAgICAgICAgLy8gSGFuZGxlIG5vbi0yeHggSFRUUCByZXNwb25zZXMgaGVyZSBpZiBuZWVkZWQKICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byByZWNvcmQgZmVlZGJhY2sgb24gdGhlIHNlcnZlci4nKQogICAgICAgIH0KICAgICAgfSBjYXRjaCAoZXJydGl2ZSBNYXRlcmlhbCBEZXNpZ24gZGF0ZS90aW1lIHBpY2tlciBkaWFsb2dzLgogKi8KCmltcG9ydCB7IElvbmljb25zIH0gZnJvbSAiQGV4cG8vdmVjdG9yLWljb25zIjsKaW1wb3J0IHsgdXNlUm91dGVyIH0gZnJvbSAiZXhwby1yb3V0ZXIiOwppbXBvcnQgeyBmb3J3YXJkUmVmLCB1c2VDYWxsYmFjaywgdXNlRWZmZWN0LCB1c2VJbXBlcmF0aXZlSGFuZGxlLCB1c2VTdGF0ZSB9IGZyb20gInJlYWN0IjsKaW1wb3J0IHsKICBBbGVydCwKICBLZXlib2FyZEF2b2lkaW5nVmlldywKICBQcmVzc2FibGUsCiAgU2Nyb2xsVmlldywKICBUZXh0LAogIFRleHRJbnB1dCwKICB1c2VDb2xvclNjaGVtZSwKICBWaWV3LAp9IGZyb20gInJlYWN0LW5hdGl2ZSI7CmltcG9ydCB7IHVzZVNhZmVBcmVhSW5zZXRzIH0gZnJvbSAicmVhY3QtbmF0aXZlLXNhZmUtYXJlYS1jb250ZXh0IjsKaW1wb3J0IHsgQXBwUHJlc3NhYmxlIH0gZnJvbSAiQC9jb21wb25lbnRzL0FwcFByZXNzYWJsZSI7CmltcG9ydCB7IHVzZVJlc2NoZWR1bGVCb29raW5nIH0gZnJvbSAiQC9ob29rcy91c2VCb29raW5ncyI7CmltcG9ydCB0eXBlIHsgQm9va2luZyB9IGZyb20gIkAvc2VydmljZXMvY2FsY29tIjsKaW1wb3J0IHsgc2hvd0Vycm9yQWxlcnQgfSBmcm9tICJAL3V0aWxzL2FsZXJ0cyI7CmltcG9ydCB7IHNhZmVMb2dFcnJvciwgc2FmZUxvZ0luZm8gfSBmcm9tICJAL3V0aWxzL3NhZmVMb2dnZXIiOwppbXBvcnQgeyBEYXRlVGltZVBpY2tlckFuZHJvaWQgfSBmcm9tICJAcmVhY3QtbmF0aXZlLWNvbW11bml0eS9kYXRldGltZXBpY2tlciI7CgpleHBvcnQgaW50ZXJmYWNlIFJlc2NoZWR1bGVTY3JlZW5Qcm9wcyB7CiAgYm9va2luZzogQm9va2luZyB8IG51bGw7CiAgb25TdWNjZXNzOiAoKSA9PiB2b2lkOwogIG9uU2F2aW5nQ2hhbmdlPzogKGlzU2F2aW5nOiBib29sZWFuKSA9PiB2b2lkOwogIHVzZU5hdGl2ZUhlYWRlcj86IGJvb2xlYW47Cn0KCmV4cG9ydCBpbnRlcmZhY2UgUmVzY2hlZHVsZVNjcmVlbkhhbmRsZSB7CiAgc3VibWl0OiAoKSA9PiB2b2lkOwp9CgovLyBGb3JtYXQgdGltZSBpbiAxMi1ob3VyIGZvcm1hdApmdW5jdGlvbiBmb3JtYXRUaW1lMTJIb3VyKGRhdGU6IERhdGUpOiBzdHJpbmcgewogIGNvbnN0IGhvdXJzID0gZGF0ZS5nZXRIb3VycygpOwogIGNvbnN0IG1pbnV0ZXMgPSBkYXRlLmdldE1pbnV0ZXMoKTsKICBjb25zdCBhbXBtID0gaG91cnMgPj0gMTIgPyAiUE0iIDogIkFNIjsKICBjb25zdCBkaXNwbGF5SG91cnMgPSBob3VycyAlIDEyIHx8IDEyOwogIHJldHVybiBgJHtkaXNwbGF5SG91cnN9OiR7U3RyaW5nKG1pbnV0ZXMpLnBhZFN0YXJ0KDIsICIwIil9ICR7YW1wbX1gOwp9CgpleHBvcnQgY29uc3QgUmVzY2hlZHVsZVNjcmVlbiA9IGZvcndhcmRSZWY8UmVzY2hlZHVsZVNjcmVlbkhhbmRsZSwgUmVzY2hlZHVsZVNjcmVlblByb3BzPigKICBmdW5jdGlvbiBSZXNjaGVkdWxlU2NyZWVuKHsgYm9va2luZywgb25TdWNjZXNzLCBvblNhdmluZ0NoYW5nZSwgdXNlTmF0aXZlSGVhZGVyID0gZmFsc2UgfSwgcmVmKSB7CiAgICBjb25zdCByb3V0ZXIgPSB1c2VSb3V0ZXIoKTsKICAgIGNvbnN0IGluc2V0cyA9IHVzZVNhZmVBcmVhSW5zZXRzKCk7CiAgICBjb25zdCBjb2xvclNjaGVtZSA9IHVzZUNvbG9yU2NoZW1lKCk7CiAgICBjb25zdCBpc0RhcmsgPSBjb2xvclNjaGVtZSA9PT0gImRhcmsiOwoKICAgIGNvbnN0IGNvbG9ycyA9IHsKICAgICAgYmFja2dyb3VuZDogaXNEYXJrID8gIiMwMDAwMDAiIDogIiNGMkYyRjciLAogICAgICBjYXJkQmFja2dyb3VuZDogaXNEYXJrID8gIiMxNzE3MTciIDogIiNGRkZGRkYiLAogICAgICB0ZXh0OiBpc0RhcmsgPyAiI0ZGRkZGRiIgOiAiIzAwMDAwMCIsCiAgICAgIHRleHRTZWNvbmRhcnk6IGlzRGFyayA/ICIjQTNBM0EzIiA6ICIjNkI3MjgwIiwKICAgICAgYm9yZGVyOiBpc0RhcmsgPyAiIzRENEQ0RCIgOiAiI0U1RTVFQSIsCiBlaWdodEFuZFJhdGlvID0gY29tcHV0ZWRTaXplLmhlaWdodCAhPT0gdW5kZWZpbmVkICYmIGNvbXB1dGVkU2l6ZS5hc3BlY3RSYXRpbyAhPT0gdW5kZWZpbmVkCiAgY29uc3Qgc2l6ZUtub3duID0gaGFzV2lkdGhBbmRIZWlnaHQgfHwgaGFzSGVpZ2h0QW5kUmF0aW8KCiAgY29uc3QgaXNSZXF1aXJlU291cmNlID0gdHlwZW9mIHVyaSA9PT0gJ251bWJlcicKCiAgLy8gUHJvcGFnYXRlIHByb3AgdXBkYXRlcyB0byBzdGF0ZQogIHVzZUVmZmVjdCgoKSA9PiB7CiAgICBzZXRXaWR0aChzaXplLndpZHRoKQogICAgc2V0SGVpZ2h0KHNpemUuaGVpZ2h0KQogIH0sIFtzaXplLmhlaWdodCwgc2l6ZS53aWR0aF0pCgogIC8vIENhbGN1bGF0ZSB3aWR0aC9oZWlnaHQgYW5kIGNoZWNrIGZvciBhbiBlcnJvciBpbiB0aGUgaW1hZ2UgcmV0cmlldmFsIGZvciBmYXN0IGltYWdlcwogIC8vIGJpb21lLWlnbm9yZSBsaW50L2NvcnJlY3RuZXNzL3VzZUV4aGF1c3RpdmVEZXBlbmRlbmNpZXM6ICt3aWR0aCwgaGVpZ2h0CiAgdXNlRWZmZWN0KCgpID0+IHsKICAgIC8vIElmIHdlIGtub3cgZGltZW5zaW9uIG9yIHRoaXMgaXNuJ3QgYSBmYXN0IGltYWdlLCBza2lwIGNhbGN1bGF0aW5nIHdpZHRoL2hlaWdodAogICAgaWYgKCF1cmkgfHwgc2l6ZUtub3duIHx8ICFmYXN0SW1hZ2UgfHwgaXNSZXF1aXJlU291cmNlKSB7CiAgICAgIHJldHVybgogICAgfQoKICAgIC8vIENhbGN1bGF0ZSBzaXplIGlmIG5vdCBlbm91Z2ggaW5mbyBpcyBnaXZlbgogICAgSW1hZ2UuZ2V0U2l6ZSgKICAgICAgdXJpLAogICAgICAoY2FsY3VsYXRlZFdpZHRoOiBudW1iZXIsIGNhbGN1bGF0ZWRIZWlnaHQ6IG51bWJlcikgPT4gewogICAgICAgIHNldFdpZHRoKGNhbGN1bGF0ZWRXaWR0aCkKICAgICAgICBzZXRIZWlnaHQoY2FsY3VsYXRlZEhlaWdodCkKICAgICAgfSwKICAgICAgKCkgPT4gc2V0RXJyb3JlZCh0cnVlKSwKICAgICkKICB9LCBbd2lkdGgsIGhlaWdodCwgc2l6ZUtub3duLCB1cmksIGZhc3RJbWFnZSwgaXNSZXF1aXJlU291cmNlXSkKCiAgLy8gSGFuZGxlIGxvY2FsIFVSSQogIGlmIChpc1JlcXVpcmVTb3VyY2UpIHsKICAgIHJldHVybiA8SW1hZ2UgaGVpZ2h0PXtzaXplLmhlaWdodH0gc291cmNlPXt1cml9IHdpZHRoPXtzaXplLndpZHRofSAvPgogIH0KCiAgLy8gVXNlIHRoZSBmYWxsYmFjayBpZiBubyBVUkkgYXQgYWxsCiAgaWYgKCF1cmkgJiYgZmFsbGJhY2spIHsKICAgIHJldHVybiBmYWxsYmFjawogIH0KCiAgLy8gU2hvdyBhIGxvYWRlciB3aGlsZSB0aGUgVVJJIGlzIHBvcHVsYXRpbmcgb3Igc2l6ZSBpcyBjYWxjdWxhdGluZyB3aGVuIHRoZXJlJ3Mgbm8gZmFsbGJhY2sKICBpZiAoIXVyaSB8fCAoIXNpemVLbm93biAmJiAhZXJyb3JlZCkpIHsKICAgIGlmIChzdHlsZT8ubG9hZGluZ0NvbnRhaW5lcikgewogICAgICByZXR1cm4gPEZsZXggc3R5bGU9e3N0eWxlLmxvYWRpbmdDb250YWluZXJ9PntMT0FESU5HX0ZBTExCQUNLfTwvRmxleD4KICAgIH0KICAgIHJldHVybiBMT0FESU5HX0ZBTExCQUNLCiAgfQoKICAvLyBHZXQgdGhlIHNhbml0aXplZCB1cmwKICBjb25zdCBpbWFnZUh0dHBVcmwgPSB1cmlUb0h0dHBVcmxzKHVyaSwgeyBhbGxvd0xvY2FsVXJpIH0pWzBdCgogIC8vIExvZyBhbiBlcnJvciBhbmQgc2hvdyBhIGZhbGxiYWNrIChvciBudWxsKSB3aGVuIHRoZSBVUkkgaXMgYmFkIG9yIGFuIGVycm9yIGxvYWRpbmcgb2NjdXJzCiAgaWYgKCFpbWFnZUh0dHBVcmwgfHwgZXJyb3JlZCkgewogICAgY29uc3QgZXJyTXNnID0gZXJyb3JlZAogICAgICA/ICdjb3VsZCBub3QgY29tcHV0ZSBzaXppbmcgaW5mb3JtYXRpb24gZm9yIHVyaScKICAgICAgOiAnQ291bGQgbm90IHJldHJpZXZlIGFuZCBmb3JtYXQgcmVtb3RlIGltYWdlIGZvciB1cmknCiAgICBsb2dnZXIud2FybignVW5pdmVyc2FsSW1hZ2UnLCAnVW5pdmVyc2FsSW1hZ2UnLCBlcnJNc2csIHsgZGF0YTogdXJpIH0pCgplY3RvcnMnCmltcG9ydCB7CiAgc2V0SGFzU2VlblNtYXJ0V2FsbGV0Q3JlYXRlZFdhbGxldE1vZGFsLAogIHNldEluY3JlbWVudE51bVBvc3RTd2FwTnVkZ2UsCn0gZnJvbSAnd2FsbGV0L3NyYy9mZWF0dXJlcy9iZWhhdmlvckhpc3Rvcnkvc2xpY2UnCmltcG9ydCB7IHVzZUFjY291bnRDb3VudENoYW5nZWQsIHVzZUFjdGl2ZUFjY291bnRXaXRoVGhyb3cgfSBmcm9tICd3YWxsZXQvc3JjL2ZlYXR1cmVzL3dhbGxldC9ob29rcycKaW1wb3J0IHsgc2V0U21hcnRXYWxsZXRDb25zZW50IH0gZnJvbSAnd2FsbGV0L3NyYy9mZWF0dXJlcy93YWxsZXQvc2xpY2UnCgp0eXBlIEhvbWVSb3V0ZSA9IHsKICBrZXk6ICh0eXBlb2YgU2VjdGlvbk5hbWUpW2tleW9mIHR5cGVvZiBTZWN0aW9uTmFtZV0KICB0aXRsZTogc3RyaW5nCn0gJiBQaWNrPFRhYkxhYmVsUHJvcHMsICd0ZXh0U3R5bGVUeXBlJyB8ICdlbmFibGVOb3RpZmljYXRpb25CYWRnZSc+Cgpjb25zdCBDT05URU5UX0hFQURFUl9IRUlHSFRfRVNUSU1BVEUgPSAyNzAKCi8qKgogKiBBZGRpbmcgYGtleWAgZm9yY2VzIGEgZnVsbCByZS1yZW5kZXIgYW5kIHJlLW1vdW50IHdoZW4gc3dpdGNoaW5nIGFjY291bnRzCiAqIHRvIGF2b2lkIGlzc3VlcyB3aXRoIHdyb25nIGNhY2hlZCBkYXRhIGJlaW5nIHNob3duIGluIHNvbWUgbWVtb2l6ZWQgY29tcG9uZW50cyB0aGF0IGFyZSBhbHJlYWR5IG1vdW50ZWQuCiAqLwpleHBvcnQgZnVuY3Rpb24gV3JhcHBlZEhvbWVTY3JlZW4ocHJvcHM6IEFwcFN0YWNrU2NyZWVuUHJvcDxNb2JpbGVTY3JlZW5zLkhvbWU+KTogSlNYLkVsZW1lbnQgewogIGNvbnN0IGFjdGl2ZUFjY291bnQgPSB1c2VBY3RpdmVBY2NvdW50V2l0aFRocm93KCkKICByZXR1cm4gPEhvbWVTY3JlZW4ga2V5PXthY3RpdmVBY2NvdW50LmFkZHJlc3N9IHsuLi5wcm9wc30gLz4KfQoKLyoqCiAqIEhvbWUgU2NyZWVuIGhvc3RzIGJvdGggVG9rZW5zIGFuZCBORlRzIFRhYgogKiBNYW5hZ2VzIFRva2Vuc1RhYnMgYW5kIE5mdHNUYWIgc2Nyb2xsIG9mZnNldHMgd2hlbiBoZWFkZXIgaXMgY29sbGFwc2VkCiAqIEJvcnJvd2VkIGZyb206IGh0dHBzOi8vc3Rvcm1vdGlvbi5pby9ibG9nL2hvdy10by1jcmVhdGUtY29sbGFwc2luZy10YWItaGVhZGVyLXVzaW5nLXJlYWN0LW5hdGl2ZS8KICovCmZ1bmN0aW9uIEhvbWVTY3JlZW4ocHJvcHM/OiBBcHBTdGFja1NjcmVlblByb3A8TW9iaWxlU2NyZWVucy5Ib21lPik6IEpTWC5FbGVtZW50IHsKICBjb25zdCBhY3RpdmVBY2NvdW50ID0gdXNlQWN0aXZlQWNjb3VudFdpdGhUaHJvdygpCiAgY29uc3QgeyB0IH0gPSB1c2VUcmFuc2xhdGlvbigpCiAgY29uc3QgY29sb3JzID0gdXNlU3BvcmVDb2xvcnMoKQogIGNvbnN0IGRhcmtDb2xvcnMgPSB1c2VTcG9yZUNvbG9ycygnZGFyaycpCiAgY29uc3QgbWVkaWEgPSB1c2VNZWRpYSgpCiAgY29uc3QgaW5zZXRzID0gdXNlQXBwSW5zZXRzKCkKICBjb25zdCBkaW1lbnNpb25zID0gdXNlRGV2aWNlRGltZW5zaW9ucygpCiAgY29uc3QgZGlzcGF0Y2ggPSB1c2VEaXNwYXRjaCgpCiAgY29uc3QgaXNGb2N1c2VkID0gdXNlSXNGb2N1c2VkKCkKICBjb25zdCBpc01vZGFsT3BlbiA9IHVzZVNlbGVjdG9yKHNlbGVjdFNvbWVNb2RhbE9wZW4pCiAgY29uc3QgaXNIb21lU2NyZWVuQmx1ciA9ICFpc0ZvY3VzZWQgfHwgaXNNb2RhbE9wZW4KICBjb25zdCBoaWRlU3BsYXNoU2NyZWVuID0gdXNlSGlkZVNwbGFzaFNjcmVlbigpCiAgY29uc3QgaXNTbWFydFdhbGxldEVuYWJsZWQgPSB1c2VGZWF0dXJlRmxhZyhGZWF0dXJlRmxhZ3MuU21hcnRXYWxsZXQpCiAgY29uc3QgU21hcnRXYWxsZXREaXNhYmxlVmlkZW8gPSB1c2VGZWF0dXJlRmxhZyhGZWF0dXJlRmxhZ3MuU21hcnRXYWxsZXREaXNhYmxlVmlkZW8pCiAgY29uc3QgeyByZXF1aXJlZEZvclRyYW5zYWN0aW9uczogcmVxdWlyZXNCaW9tZXRyaWNzIH0gPSB1c2VCaW9tZXRyaWNBcHBTZXR0aXRpbmdzT3Blbj17KCkgPT4gewogICAgICAgICAgICAgICAgc2V0U2hvd01lbWJlckludml0YXRpb25Nb2RhbChmYWxzZSk7CiAgICAgICAgICAgICAgfX0KICAgICAgICAgICAgLz4KICAgICAgICAgICl9CiAgICAgICAgPC8+CiAgICAgICl9CiAgICA8Lz4KICApOwp9OwoKZXhwb3J0IGRlZmF1bHQgTWVtYmVyc1ZpZXc7CiJ1c2UgY2xpZW50IjsKCmltcG9ydCB7IHVzZVN0YXRlIH0gZnJvbSAicmVhY3QiOwoKaW1wb3J0IGRheWpzIGZyb20gIkBjYWxjb20vZGF5anMiOwppbXBvcnQgeyBDYWxlbmRhciB9IGZyb20gIkBjYWxjb20vd2ViL21vZHVsZXMvY2FsZW5kYXJzL3dlZWtseXZpZXcvY29tcG9uZW50cy9DYWxlbmRhciI7CmltcG9ydCB0eXBlIHsgQ2FsZW5kYXJFdmVudCB9IGZyb20gIkBjYWxjb20vZmVhdHVyZXMvY2FsZW5kYXJzL3dlZWtseXZpZXcvdHlwZXMvZXZlbnRzIjsKaW1wb3J0IHR5cGUgeyBDYWxlbmRhckNvbXBvbmVudFByb3BzLCBIb3VycyB9IGZyb20gIkBjYWxjb20vZmVhdHVyZXMvY2FsZW5kYXJzL3dlZWtseXZpZXcvdHlwZXMvc3RhdGUiOwoKY29uc3QgbWFrZURhdGUgPSAoZGF5T2Zmc2V0OiBudW1iZXIsIGhvdXI6IG51bWJlciwgbWludXRlOiBudW1iZXIgPSAwKSA9PiB7CiAgcmV0dXJuIGRheWpzKCIyMDI1LTAxLTA2IikuYWRkKGRheU9mZnNldCwgImRheSIpLmhvdXIoaG91cikubWludXRlKG1pbnV0ZSkuc2Vjb25kKDApLnRvRGF0ZSgpOwp9OwoKY29uc3QgZ2V0QmFzZVByb3BzID0gKHsKICBldmVudHMsCiAgc3RhcnRIb3VyID0gNiwKfTogewogIGV2ZW50czogQ2FsZW5kYXJFdmVudFtdOwogIHN0YXJ0SG91cj86IEhvdXJzOwp9KTogQ2FsZW5kYXJDb21wb25lbnRQcm9wcyA9PiAoewogIHN0YXJ0RGF0ZTogZGF5anMoIjIwMjUtMDEtMDYiKS50b0RhdGUoKSwgLy8gTW9uZGF5CiAgZW5kRGF0ZTogZGF5anMoIjIwMjUtMDEtMTIiKS50b0RhdGUoKSwgLy8gU3VuZGF5CiAgZXZlbnRzLAogIHN0YXJ0SG91ciwKICBlbmRIb3VyOiAxOCwKICBncmlkQ2VsbHNQZXJIb3VyOiA0LAogIHRpbWV6b25lOiAiVVRDIiwKICBzaG93QmFja2dyb3VuZFBhdHRlcm46IGZhbHNlLAogIHNob3dCb3JkZXI6IGZhbHNlLAogIGhpZGVIZWFkZXI6IHRydWUsCiAgYm9yZGVyQ29sb3I6ICJzdWJ0bGUiLAogIHNjcm9sbFRvQ3VycmVudFRpbWU6IGZhbHNlLAp9KTsKCnR5cGUgU2NlbmFyaW8gPSB7CiAgaWQ6IHN0cmluZzsKICB0aXRsZTogc3RyaW5nOwogIGRlc2NyaXB0aW9uOiBzdHJpbmc7CiAgZXhwZWN0ZWQ6IHN0cmluZzsKICBldmVudHM6IENhbGVuZGFyRXZlbnRbXTsKICBzdGFydEhvdXI6IEhvdXJzOwp9OwoKY29uc3Qgc2NlbmFyaW9zOiBTY2VuYXJpb1tdID0gWwogIHsKICAgIGlkOiAidHdvLW92ZXJsYXBwaW5nIiwKICAgIHRpdGxlOiAiVHdvIE92ZXJsYXBwaW5nIEV2ZW50cyIsCiAgICBkZXNjcmlwdGlvbjogIlR3byBldmVudHMgd2l0aCBvdmVybGFwcGluZyB0aW1lIHJhbmdlcyBvbiB0aGUgc2FtZSBkYXkiLAogICAgZXhwZWN0ZWQ6CiAgICAgICJGaXJzdCBldmVudCA4MCUgd2lkdGggYXQgbGVmdCBlZGdlICgwJSksIHNlY29uZCBldmVudCA1MCUgd2lkdGggYWxpZ25lZCB0byByaWdodCBlZGdlICg0OS41JSBvZmZzZXQpLiBFdmVudHMgc3ByZWFkIGFjcm9zcyBmdWxsIHdpZHRoIGZvciBtYXhpbXVtIHZpc3VhbCBkaXN0aW5jdGlvbi4gSG92ZXIgc2hvdWxkIGJyaW5nIGV2ZW50IHRvIGZyb250LiIsCiAgICBzdGFydEhvdXI6IDksCiAgICBldmVudHM6IFsKICAgICAgewogICAgICAgIGlkOiAxLAogICAgICAgIHRpdGxlOiAiTWVldGluZyBBIiwKICAgICAgICBzdGFydDogbWFrZURhdGUoMCwgMTAsIDApLAogICAgICAgIGVuZDogbWFrZURhdGUoMCwgMTEsIDApLAogICAgICAgIG9wdGlvbnM6IHsgc3RhdHVzOiAiQUNDRVBURUQiLCBjb2xvcjogIiMzYjgyZjYiIH0sCiAgICAgIH0sCiAgICAgIHsKICAgICAgICBpZDogMiwKICByb20gJ3RoZW1lL2NvbXBvbmVudHMnCmltcG9ydCB7IEZsZXggfSBmcm9tICd1aS9zcmMnCmltcG9ydCB7IGJyZWFrcG9pbnRzIH0gZnJvbSAndWkvc3JjL3RoZW1lJwoKZnVuY3Rpb24gVGFibGVCb2R5SW5uZXI8VCBleHRlbmRzIFJvd0RhdGE+KAogIHsKICAgIHRhYmxlLAogICAgbG9hZGluZywKICAgIGVycm9yLAogICAgdjIgPSB0cnVlLAogICAgcm93V3JhcHBlciwKICAgIGxvYWRpbmdSb3dzQ291bnQgPSAyMCwKICAgIHJvd0hlaWdodDogcHJvcFJvd0hlaWdodCwKICAgIGNvbXBhY3RSb3dIZWlnaHQ6IHByb3BDb21wYWN0Um93SGVpZ2h0LAogIH06IFRhYmxlQm9keVByb3BzPFQ+LAogIHJlZjogUmVhY3QuUmVmPEhUTUxEaXZFbGVtZW50PiwKKSB7CiAgY29uc3Qgcm93cyA9IHRhYmxlLmdldFJvd01vZGVsKCkucm93cwogIGNvbnN0IHsgd2lkdGg6IHRhYmxlV2lkdGggfSA9IHVzZVRhYmxlU2l6ZSgpCiAgY29uc3Qgc2tlbGV0b25Sb3dIZWlnaHQgPSB1c2VNZW1vKAogICAgKCkgPT4KICAgICAgdGFibGVXaWR0aCA8PSBicmVha3BvaW50cy5sZwogICAgICAgID8gKHByb3BDb21wYWN0Um93SGVpZ2h0ID8/IFJPV19IRUlHSFRfTU9CSUxFX1dFQikKICAgICAgICA6IChwcm9wUm93SGVpZ2h0ID8/IFJPV19IRUlHSFRfREVTS1RPUCksCiAgICBbdGFibGVXaWR0aCwgcHJvcFJvd0hlaWdodCwgcHJvcENvbXBhY3RSb3dIZWlnaHRdLAogICkKCiAgaWYgKGxvYWRpbmcgfHwgZXJyb3IpIHsKICAgIHJldHVybiAoCiAgICAgIDw+CiAgICAgICAgPEZsZXg+CiAgICAgICAgICB7QXJyYXkuZnJvbSh7IGxlbmd0aDogbG9hZGluZ1Jvd3NDb3VudCB9LCAoXywgcm93SW5kZXgpID0+ICgKICAgICAgICAgICAgPERhdGFSb3cga2V5PXtgc2tlbGV0b24tcm93LSR7cm93SW5kZXh9YH0gaGVpZ2h0PXtza2VsZXRvblJvd0hlaWdodH0gdjI9e3YyfT4KICAgICAgICAgICAgICB7dGFibGUuZ2V0QWxsQ29sdW1ucygpLm1hcCgoY29sdW1uLCBjb2x1bW5JbmRleCkgPT4gKAogICAgICAgICAgICAgICAgPENlbGxDb250YWluZXIKICAgICAgICAgICAgICAgICAga2V5PXtgc2tlbGV0b24tcm93LSR7cm93SW5kZXh9LWNvbHVtbi0ke2NvbHVtbkluZGV4fWB9CiAgICAgICAgICAgICAgICAgIHN0eWxlPXtnZXRDb2x1bW5TaXppbmdTdHlsZXMoY29sdW1uKX0KICAgICAgICAgICAgICAgID4KICAgICAgICAgICAgICAgICAge2ZsZXhSZW5kZXIoY29sdW1uLmNvbHVtbkRlZi5jZWxsLCB7fSBhcyBDZWxsQ29udGV4dDxULCBhbnk+KX0KICAgICAgICAgICAgICAgIDwvQ2VsbENvbnRhaW5lcj4KICAgICAgICAgICAgICApKX0KICAgICAgICAgICAgPC9EYXRhUm93PgogICAgICAgICAgKSl9CiAgICAgICAgPC9GbGV4PgogICAgICAgIHtlcnJvciAmJiAoCiAgICAgICAgICA8RXJyb3JNb2RhbAogICAgICAgICAgICBoZWFkZXI9ezxUcmFucyBpMThuS2V5PSJjb21tb24uZXJyb3JMb2FkaW5nRGF0YS5lcnJvciIgLz59CiAgICAgICAgICAgIHN1YnRpdGxlPXs8VHJhbnMgaTE4bktleT0iZXJyb3IuZGF0YVVuYXZhaWxhYmxlIiAvPn0KICAgICAgICAgIC8+CiAgICAgICAgKX0KICAgICAgPC8+CiAgICApCiAgfQoKICBpZiAoIXJvd3MubGVuZ3RoKSB7CiAgICByZXR1cm4gKAogICAgICA8Tm9EYXRhRm91bmRUYWJsZVJvdyBweT0iJHNwYWNpbmcyMCI+CiAgICAgICAgPFRoZW1lZFRleHQuQm9keVNlY29uZGFyeT4KICAgICAgICAgIDxUcmFucyBpMThuS2V5PSJlcnJvci5ub0RhdGEiIC8+CiAgICAgICAgPC9UaGVtZWRUZXh0LkJvZHlTZWNvbmRhcnk+CiAgICAgIDwvTm9EYXRhRm91bmRUYWJsZVJvdz4KICAgICkKICB9CgogIHJldHVybiAoCiAgICA8RmxleCByZWY9e3JlZn0gcG9zaXRpb249InJlbGF0aXZlIj4KICAgICAge3Jvd3MubWFwKChyb3cpID0+ICgKICAgICAgICA8VGFibGVSb3c8VD4KICAgICAgICAgIGtleT17cm93LmlkfQogICAgICAgICAgcm93PXtyb3d9CiAgIHN0LCBsYWJlbDogdCgicmVqZWN0ZWQiKSB9OwogICAgICBkZWZhdWx0OgogICAgICAgIHJldHVybiB7IHZhcmlhbnQ6ICJncmF5IiBhcyBjb25zdCwgbGFiZWw6IGJvb2tpbmcuc3RhdHVzIH07CiAgICB9CiAgfSwgW2Jvb2tpbmcuc3RhdHVzLCBib29raW5nLnJlc2NoZWR1bGVkLCB0XSk7CgogIGNvbnN0IGlzUGVuZGluZyA9IGJvb2tpbmcuc3RhdHVzID09PSBCb29raW5nU3RhdHVzLlBFTkRJTkc7CgogIGNvbnN0IHBhcnNlZE1ldGFkYXRhID0gYm9va2luZ01ldGFkYXRhU2NoZW1hLnNhZmVQYXJzZShib29raW5nLm1ldGFkYXRhID8/IG51bGwpOwogIGNvbnN0IGJvb2tpbmdNZXRhZGF0YSA9IHBhcnNlZE1ldGFkYXRhLnN1Y2Nlc3MgPyBwYXJzZWRNZXRhZGF0YS5kYXRhIDogbnVsbDsKCiAgY29uc3QgcmVjdXJyaW5nSW5mbyA9CiAgICBib29raW5nLnJlY3VycmluZ0V2ZW50SWQgJiYgYm9va2luZy5ldmVudFR5cGU/LnJlY3VycmluZ0V2ZW50CiAgICAgID8gewogICAgICAgIGNvdW50OiBib29raW5nLmV2ZW50VHlwZS5yZWN1cnJpbmdFdmVudC5jb3VudCwKICAgICAgICByZWN1cnJpbmdFdmVudDogYm9va2luZy5ldmVudFR5cGUucmVjdXJyaW5nRXZlbnQsCiAgICAgIH0KICAgICAgOiBudWxsOwoKICBjb25zdCBjdXN0b21SZXNwb25zZXMgPSBib29raW5nLnJlc3BvbnNlcwogICAgPyBPYmplY3QuZW50cmllcyhib29raW5nLnJlc3BvbnNlcyBhcyBSZWNvcmQ8c3RyaW5nLCB1bmtub3duPikKICAgICAgLmZpbHRlcigoW2ZpZWxkTmFtZV0pID0+IHNob3VsZFNob3dGaWVsZEluQ3VzdG9tUmVzcG9uc2VzKGZpZWxkTmFtZSkpCiAgICAgIC5tYXAoKFtxdWVzdGlvbiwgYW5zd2VyXSkgPT4gW3F1ZXN0aW9uLCBhbnN3ZXJdIGFzIFtzdHJpbmcsIHVua25vd25dKQogICAgOiBbXTsKCiAgY29uc3QgcmVhc29uID0gYm9va2luZy5hc3NpZ25tZW50UmVhc29uPy5bMF07CiAgY29uc3QgcmVhc29uVGl0bGUgPSByZWFzb24gJiYgYXNzaWdubWVudFJlYXNvbkJhZGdlVGl0bGVNYXAocmVhc29uLnJlYXNvbkVudW0pOwoKICByZXR1cm4gKAogICAgPFNoZWV0IG9wZW49e3RydWV9IG9uT3BlbkNoYW5nZT17aGFuZGxlQ2xvc2V9IG1vZGFsPXtmYWxzZX0+CiAgICAgIDxTaGVldENvbnRlbnQKICAgICAgICBjbGFzc05hbWU9Im92ZXJmbG93LXktYXV0byIKICAgICAgICBoaWRlT3ZlcmxheQogICAgICAgIG9uSW50ZXJhY3RPdXRzaWRlPXsoZSkgPT4gewogICAgICAgICAgLy8gQ2hlY2sgaWYgdGhlIGNsaWNrIGlzIG9uIGEgYm9va2luZyBsaXN0IGl0ZW0KICAgICAgICAgIGNvbnN0IHRhcmdldCA9IGUudGFyZ2V0IGFzIEhUTUxFbGVtZW50OwogICAgICAgICAgY29uc3QgaXNCb29raW5nTGlzdEl0ZW0gPSB0YXJnZXQuY2xvc2VzdCgiW2RhdGEtYm9va2luZy1saXN0LWl0ZW1dIik7CgogICAgICAgICAgaWYgKGlzQm9va2luZ0xpc3RJdGVtKSB7CiAgICAgICAgICAgIC8vIFByZXZlbnQgY2xvc2luZyB3aGVuIGNsaWNraW5nIGEgYm9va2luZyBsaXN0IGl0ZW0KICAgICAgICAgICAgLy8gVGhlIGl0ZW0ncyBvbkNsaWNrIHdpbGwgaGFuZGxlIG9wZW5pbmcgdGhlIHNoZWV0IHdpdGggdGhlIG5ldyBib29raW5nCiAgICAgICAgICAgIGUucHJldmVudERlZmF1bHQoKTsKICAgICAgICAgIH0KICAgICAgICAgIC8vIElmIGNsaWNraW5nIGVsc2V3aGVyZSwgYWxsb3cgdGhlIGRlZmF1bHQgYmVoYXZpb3IgKGNsb3NlIHRoZSBzaGVldCkKICAgICAgICB9fT4KICAgICAgICA8U2hlZXRIZWFkZXIgc2hvd0Nsb3NlQnV0dG9uPXtmYWxzZX0gY2xhc3NOYW1lPSJtdC0wIHctZnVsbCI+CiAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBpdGVtcy1jZW50ZXIganVzdGlmeS1iZXR3ZWVuIGdhcC14LTQiPgogICAgICAgICAgICA8ZGl2IGNsYXNzTmFtZT0iZmxleCBtaW4tdy0wIGZsZXgtY29sIGdhcC15LTEiPgogICAgICAgICAgICAgIDxCb29raW5nSGVhZGVyQmFkZ2VzCiBudGVycnVwdEN1cnJlbnRTdGFnZVdpdGhSZWFzb24oc3luY0lPRXJyb3IpCiAgICAgICAgfQogICAgICB9CiAgICAgIGJyZWFrCiAgICBjYXNlICdwcmVyZW5kZXItcHByJzoKICAgIGNhc2UgJ3ByZXJlbmRlci1sZWdhY3knOgogICAgY2FzZSAnY2FjaGUnOgogICAgY2FzZSAncHJpdmF0ZS1jYWNoZSc6CiAgICBjYXNlICd1bnN0YWJsZS1jYWNoZSc6CiAgICAgIGJyZWFrCiAgICBkZWZhdWx0OgogICAgICB3b3JrVW5pdFN0b3JlIHNhdGlzZmllcyBuZXZlcgogIH0KfQoKZnVuY3Rpb24gYXBwbHlPd25lclN0YWNrKGVycm9yOiBFcnJvcikgewogIC8vIFRPRE86IEluc3RlYWQgb2Ygc3RpdGNoaW5nIHRoZSBzdGFja3MgaGVyZSwgd2Ugc2hvdWxkIGxvZyB0aGUgb3JpZ2luYWwKICAvLyBlcnJvciBhcy1pcyB3aGVuIGl0IG9jY3VycywgYW5kIGxldCBgcGF0Y2hFcnJvckluc3BlY3RgIGhhbmRsZSBhZGRpbmcgdGhlCiAgLy8gb3duZXIgc3RhY2ssIGluc3RlYWQgb2YgbG9nZ2luZyBpdCBkZWZlcnJlZCBpbiB0aGUgYExvZ1NhZmVseWAgY29tcG9uZW50CiAgLy8gdmlhIGB0aHJvd0lmRGlzYWxsb3dlZER5bmFtaWNgLgogIGlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Byb2R1Y3Rpb24nKSB7CiAgICBjb25zdCBvd25lclN0YWNrID0KICAgICAgZ2V0Q2xpZW50UmVhY3QoKT8uY2FwdHVyZU93bmVyU3RhY2s/LigpID8/CiAgICAgIGdldFNlcnZlclJlYWN0KCk/LmNhcHR1cmVPd25lclN0YWNrPy4oKQoKICAgIGlmIChvd25lclN0YWNrKSB7CiAgICAgIGxldCBzdGFjayA9IG93bmVyU3RhY2sKCiAgICAgIGlmIChlcnJvci5zdGFjaykgewogICAgICAgIGNvbnN0IGZyYW1lczogc3RyaW5nW10gPSBbXQoKICAgICAgICBmb3IgKGNvbnN0IGZyYW1lIG9mIGVycm9yLnN0YWNrLnNwbGl0KCdcbicpLnNsaWNlKDEpKSB7CiAgICAgICAgICBpZiAoZnJhbWUuaW5jbHVkZXMoJ3JlYWN0X3N0YWNrX2JvdHRvbV9mcmFtZScpKSB7CiAgICAgICAgICAgIGJyZWFrCiAgICAgICAgICB9CgogICAgICAgICAgZnJhbWVzLnB1c2goZnJhbWUpCiAgICAgICAgfQoKICAgICAgICBzdGFjayA9ICdcbicgKyBmcmFtZXMuam9pbignXG4nKSArIHN0YWNrCiAgICAgIH0KCiAgICAgIGVycm9yLnN0YWNrID0gZXJyb3IubmFtZSArICc6ICcgKyBlcnJvci5tZXNzYWdlICsgc3RhY2sKICAgIH0KICB9CgogIHJldHVybiBlcnJvcgp9CmV4cG9ydCBkZWZhdWx0IGZ1bmN0aW9uIFNldHVwUGFnZSgpIHsKICByZXR1cm4gKAogICAgPGRpdiBjbGFzc05hbWU9Im1pbi1oLXNjcmVlbiBiZy1ncmF5LTEwMCBmbGV4IGZsZXgtY29sIGl0ZW1zLWNlbnRlciBweS0xMiBweC02Ij4KICAgICAgPGRpdiBjbGFzc05hbWU9Im1heC13LTN4bCB3LWZ1bGwgYmctd2hpdGUgcC04IHJvdW5kZWQtbGcgc2hhZG93LW1kIGJvcmRlciBib3JkZXItZ3JheS0zMDAgb3ZlcmZsb3cteS1hdXRvIGgtWzkwdmhdIj4KICAgICAgICA8ZGl2IGNsYXNzTmFtZT0ibWF4LXctM3hsIGJnLXdoaXRlIHAtOCByb3VuZGVkLWxnIHNoYWRvdy1tZCBib3JkZXIgYm9yZGVyLWdyYXktMzAwIj4KICAgICAgICAgIDxoMSBjbGFzc05hbWU9InRleHQtM3hsIGZvbnQtYm9sZCB0ZXh0LWdyYXktOTAwIG1iLTYiPgogICAgICAgICAgICDwn5ug77iPIFByaXNtYSBQb3N0Z3JlcyBTZXR1cCBHdWlkZQogICAgICAgICAgPC9oMT4KCiAgICAgICAgICA8cCBjbGFzc05hbWU9InRleHQtZ3JheS03MDAiPgogICAgICAgICAgICBDb25ncmF0dWxhdGlvbnMsIHlvdSBqdXN0IGRlcGxveWVkIHRoZSBOZXh0LmpzICsgUHJpc21hIFBvc3RncmVzCiAgICAgICAgICAgIHN0YXJ0ZXIgdGVtcGxhdGUg8J+OiQogICAgICAgICAgPC9wPgoKICAgICAgICAgIDxwIGNsYXNzTmFtZT0idGV4dC1ncmF5LTcwMCBtdC0yIj4KICAgICAgICAgICAgVG8gbWFrZSB0aGUgYXBwIHdvcmssIHlvdSBuZWVkIHRvIGNvbm5lY3QgaXQgdG8gYSBkYXRhYmFzZS4KICAgICBzY3JvbGxFdmVudFRocm90dGxlPXsxNn0KICAgICAgICBzaG93c0hvcml6b250YWxTY3JvbGxJbmRpY2F0b3I9e2ZhbHNlfQogICAgICAgIHNob3dzVmVydGljYWxTY3JvbGxJbmRpY2F0b3I9e2ZhbHNlfQogICAgICAgIHN0eWxlPXtmbGV4U3R5bGVzLmZpbGx9CiAgICAgICAgb25TY3JvbGw9e3Njcm9sbEhhbmRsZXJ9CiAgICAgID4KICAgICAgICB7Y2hpbGRyZW59CiAgICAgIDwvVmlydHVhbGl6ZWRMaXN0PgoKICAgICAgPEhvcml6b250YWxFZGdlR2VzdHVyZVRhcmdldCAvPgogICAgPC9TY3JlZW4+CiAgKQp9CmltcG9ydCB7IHdvcmtBc3luY1N0b3JhZ2UgfSBmcm9tICcuLi9hcHAtcmVuZGVyL3dvcmstYXN5bmMtc3RvcmFnZS5leHRlcm5hbCcKaW1wb3J0IHsgd29ya1VuaXRBc3luY1N0b3JhZ2UgfSBmcm9tICcuLi9hcHAtcmVuZGVyL3dvcmstdW5pdC1hc3luYy1zdG9yYWdlLmV4dGVybmFsJwppbXBvcnQgeyBhYm9ydE9uU3luY2hyb25vdXNQbGF0Zm9ybUlPQWNjZXNzIH0gZnJvbSAnLi4vYXBwLXJlbmRlci9keW5hbWljLXJlbmRlcmluZycKaW1wb3J0IHsgSW52YXJpYW50RXJyb3IgfSBmcm9tICcuLi8uLi9zaGFyZWQvbGliL2ludmFyaWFudC1lcnJvcicKaW1wb3J0IHsgUmVuZGVyU3RhZ2UgfSBmcm9tICcuLi9hcHAtcmVuZGVyL3N0YWdlZC1yZW5kZXJpbmcnCgppbXBvcnQgeyBnZXRTZXJ2ZXJSZWFjdCwgZ2V0Q2xpZW50UmVhY3QgfSBmcm9tICcuLi9ydW50aW1lLXJlYWN0cy5leHRlcm5hbCcKCnR5cGUgQXBpVHlwZSA9ICd0aW1lJyB8ICdyYW5kb20nIHwgJ2NyeXB0bycKCmV4cG9ydCBmdW5jdGlvbiBpbyhleHByZXNzaW9uOiBzdHJpbmcsIHR5cGU6IEFwaVR5cGUpIHsKICBjb25zdCB3b3JrVW5pdFN0b3JlID0gd29ya1VuaXRBc3luY1N0b3JhZ2UuZ2V0U3RvcmUoKQogIGNvbnN0IHdvcmtTdG9yZSA9IHdvcmtBc3luY1N0b3JhZ2UuZ2V0U3RvcmUoKQoKICBpZiAoIXdvcmtVbml0U3RvcmUgfHwgIXdvcmtTdG9yZSkgewogICAgcmV0dXJuCiAgfQoKICBzd2l0Y2ggKHdvcmtVbml0U3RvcmUudHlwZSkgewogICAgY2FzZSAncHJlcmVuZGVyJzoKICAgIGNhc2UgJ3ByZXJlbmRlci1ydW50aW1lJzogewogICAgICBjb25zdCBwcmVyZW5kZXJTaWduYWwgPSB3b3JrVW5pdFN0b3JlLmNvbnRyb2xsZXIuc2lnbmFsCgogICAgICBpZiAocHJlcmVuZGVyU2lnbmFsLmFib3J0ZWQgPT09IGZhbHNlKSB7CiAgICAgICAgLy8gSWYgdGhlIHByZXJlbmRlciBzaWduYWwgaXMgYWxyZWFkeSBhYm9ydGVkIHdlIGRvbid0IG5lZWQgdG8gY29uc3RydWN0CiAgICAgICAgLy8gYW55IHN0YWNrcyBiZWNhdXNlIHNvbWV0aGluZyBlbHNlIGFjdHVhbGx5IHRlcm1pbmF0ZWQgdGhlIHByZXJlbmRlci4KICAgICAgICBsZXQgbWVzc2FnZTogc3RyaW5nCiAgICAgICAgc3dpdGNoICh0eXBlKSB7CiAgICAgICAgICBjYXNlICd0aW1lJzoKICAgICAgICAgICAgbWVzc2FnZSA9IGBSb3V0ZSAiJHt3b3JrU3RvcmUucm91dGV9IiB1c2VkICR7ZXhwcmVzc2lvbn0gYmVmb3JlIGFjY2Vzc2luZyBlaXRoZXIgdW5jYWNoZWQgZGF0YSAoZS5nLiBcYGZldGNoKClcYCkgb3IgUmVxdWVzdCBkYXRhIChlLmcuIFxgY29va2llcygpXGAsIFxgaGVhZGVycygpXGAsIFxgY29ubmVjdGlvbigpXGAsIGFuZCBcYHNlYXJjaFBhcmFtc1xgKS4gQWNjZXNzaW5nIHRoZSBjdXJyZW50IHRpbWUgaW4gYSBTZXJ2ZXIgQ29tcG9uZW50IHJlcXVpcmVzIHJlYWRpbmcgb25lIG9mIHRoZXNlIGRhdGEgc291cmNlcyBmaXJzdC4gQWx0ZXJuYXRpdmVseSwgY29uc2lkZXIgbW92aW5nIHRoaXMgZXhwcmVzc2lvbiBpbnRvIGEgQ2xpZW50IENvbXBvbmVudCBvciBDYWNoZSBDb21wb25lbnQuIFNlZSBtb3JlIGluZm8gaGVyZTogaHR0cHM6Ly9uZXh0anMub3JnL2RvY3MvbWVzc2FnZXMvbmV4dC1wcmVyZW5kZXItY3VycmVudC10aW1lYAogICAgICAgICAgICBicmVhawogICAgICAgICAgY2FzZSAncmFuZGFsKG9yZGVyKQogICAgICAgICAgfX0KICAgICAgICAgIGN1cnNvcj0icG9pbnRlciIKICAgICAgICA+CiAgICAgICAgICB7Y29udGVudH0KICAgICAgICA8L1RvdWNoYWJsZUFyZWE+CiAgICAgICkKICAgIH0sCiAgICBbb3Blbk9mZmNoYWluQWN0aXZpdHlNb2RhbCwgdHJhY2VdLAogICkKCiAgLy8gT25seSBzaG93IGxvYWRpbmcgc3RhdGUgaWYgd2UgZG9uJ3QgaGF2ZSBkYXRhIHlldAogIGNvbnN0IHRhYmxlTG9hZGluZyA9IGxvYWRpbmcgJiYgIWxpbWl0ZWRPcmRlcnMubGVuZ3RoCgogIGlmIChsaW1pdGVkT3JkZXJzLmxlbmd0aCA9PT0gMCAmJiAhbG9hZGluZykgewogICAgcmV0dXJuIG51bGwKICB9CgogIHJldHVybiAoCiAgICA8VGFibGVTZWN0aW9uSGVhZGVyCiAgICAgIHRpdGxlPXt0KCdjb21tb24ubGltaXRzLm9wZW4nKX0KICAgICAgc3VidGl0bGU9e3QoJ3BvcnRmb2xpby5vdmVydmlldy5saW1pdHMudGFibGUub3BlbkxpbWl0cycsIHsgY291bnQ6IG9wZW5MaW1pdE9yZGVycy5sZW5ndGggfSl9CiAgICA+CiAgICAgIDxUYWJsZQogICAgICAgIGhpZGVIZWFkZXIKICAgICAgICBjb2x1bW5zPXtjb2x1bW5zfQogICAgICAgIGRhdGE9e2xpbWl0ZWRPcmRlcnN9CiAgICAgICAgbG9hZGluZz17dGFibGVMb2FkaW5nfQogICAgICAgIGVycm9yPXtmYWxzZX0KICAgICAgICB2Mj17dHJ1ZX0KICAgICAgICByb3dXcmFwcGVyPXtyb3dXcmFwcGVyfQogICAgICAgIGxvYWRpbmdSb3dzQ291bnQ9e01BWF9MSU1JVFNfTE9BRElOR19ST1dTfQogICAgICAgIHJvd0hlaWdodD17UE9SVEZPTElPX1RBQkxFX1JPV19IRUlHSFR9CiAgICAgICAgY29tcGFjdFJvd0hlaWdodD17UE9SVEZPTElPX1RBQkxFX1JPV19IRUlHSFR9CiAgICAgIC8+CiAgICA8L1RhYmxlU2VjdGlvbkhlYWRlcj4KICApCn0pCiJ1c2UgY2xpZW50IjsKCmltcG9ydCB7IFRvZ2dsZSBhcyBUb2dnbGVQcmltaXRpdmUgfSBmcm9tICJAYmFzZS11aS9yZWFjdC90b2dnbGUiOwppbXBvcnQgeyBjdmEsIHR5cGUgVmFyaWFudFByb3BzIH0gZnJvbSAiY2xhc3MtdmFyaWFuY2UtYXV0aG9yaXR5IjsKCmltcG9ydCB7IGNuIH0gZnJvbSAiQGNvc3MvdWkvbGliL3V0aWxzIjsKCmNvbnN0IHRvZ2dsZVZhcmlhbnRzID0gY3ZhKAogICJbJl9zdmddOi1teC0wLjUgcmVsYXRpdmUgaW5saW5lLWZsZXggc2hyaW5rLTAgY3Vyc29yLXBvaW50ZXIgc2VsZWN0LW5vbmUgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIGdhcC0yIHdoaXRlc3BhY2Utbm93cmFwIHJvdW5kZWQtbGcgYm9yZGVyIGZvbnQtbWVkaXVtIHRleHQtYmFzZSBvdXRsaW5lLW5vbmUgdHJhbnNpdGlvbi1zaGFkb3cgYmVmb3JlOnBvaW50ZXItZXZlbnRzLW5vbmUgYmVmb3JlOmFic29sdXRlIGJlZm9yZTppbnNldC0wIGJlZm9yZTpyb3VuZGVkLVtjYWxjKHZhcigtLXJhZGl1cy1sZyktMXB4KV0gcG9pbnRlci1jb2Fyc2U6YWZ0ZXI6YWJzb2x1dGUgcG9pbnRlci1jb2Fyc2U6YWZ0ZXI6c2l6ZS1mdWxsIHBvaW50ZXItY29hcnNlOmFmdGVyOm1pbi1oLTExIHBvaW50ZXItY29hcnNlOmFmdGVyOm1pbi13LTExIGhvdmVyOmJnLWFjY2VudCBmb2N1cy12aXNpYmxlOnJpbmctMiBmb2N1cy12aXNpYmxlOnJpbmctcmluZyBmb2N1cy12aXNpYmxlOnJpbmctb2Zmc2V0LTEgZm9jdXMtdmlzaWJsZTpyaW5nLW9mZnNldC1iYWNrZ3JvdW5kIGRpc2FibGVkOnBvaW50ZXItZXZlbnRzLW5vbmUgZGlzYWJsZWQ6b3BhY2l0eS02NCBkYXRhLXByZXNzZWQ6YmctaW5wdXQvNjQgZGF0YS1wcmVzc2VkOnRleHQtYWNjZW50LWZvcmVncm91bmQgc206dGV4dC1zbSBbJl9zdmc6bm90KFtjbGFzcyo9J29wYWNpdHktJ10pXTpvcGFjaXR5LTgwIFsmX3N2Zzpub3QoW2NsYXNzKj0nc2l6ZS0nXSldOnNpemUtNC41IHNtOlsmX3N2Zzpub3QoW2NsYXNzKj0nc2l6ZS0nXSldOnNpemUtNCBbJl9zdmddOnBvaW50ZXItZXZlbnRzLW5vbmUgWyZfc3ZnXTpzaHJpbmstMCIsCiB9LCBbCiAgICBhY3RpdmVUYWIsCiAgICB0b3BQb29scz8ubGVuZ3RoLAogICAgdHJlbmRpbmdQb29sT3B0aW9ucy5sZW5ndGgsCiAgICB0b3BQb29sc0Vycm9yLAogICAgdG9wUG9vbHNMb2FkaW5nLAogICAgZmF2b3JpdGVXYWxsZXRzU2VjdGlvbiwKICAgIGxvYWRpbmdUb2tlbnMsCiAgICByZWNlbnRTZWFyY2hTZWN0aW9uLAogICAgcmVmZXRjaFBvb2xzLAogICAgcmVmZXRjaFRva2VucywKICAgIHRva2Vuc0Vycm9yLAogICAgdHJlbmRpbmdQb29sU2VjdGlvbiwKICAgIHRyZW5kaW5nVG9rZW5TZWN0aW9uLAogICAgd2FsbGV0U2VhcmNoRW5hYmxlZE9uV2ViLAogIF0pCn0KaW1wb3J0IFJlYWN0IGZyb20gInJlYWN0IjsKCmltcG9ydCB7IEhlYWRlciB9IGZyb20gIi4vSGVhZGVyIjsKaW1wb3J0ICIuL3BhZ2UuY3NzIjsKCnR5cGUgVXNlciA9IHsKICBuYW1lOiBzdHJpbmc7Cn07CgpleHBvcnQgY29uc3QgUGFnZTogUmVhY3QuRkMgPSAoKSA9PiB7CiAgY29uc3QgW3VzZXIsIHNldFVzZXJdID0gUmVhY3QudXNlU3RhdGU8VXNlcj4oKTsKCiAgcmV0dXJuICgKICAgIDxhcnRpY2xlPgogICAgICA8SGVhZGVyCiAgICAgICAgdXNlcj17dXNlcn0KICAgICAgICBvbkxvZ2luPXsoKSA9PiBzZXRVc2VyKHsgbmFtZTogIkphbmUgRG9lIiB9KX0KICAgICAgICBvbkxvZ291dD17KCkgPT4gc2V0VXNlcih1bmRlZmluZWQpfQogICAgICAgIG9uQ3JlYXRlQWNjb3VudD17KCkgPT4gc2V0VXNlcih7IG5hbWU6ICJKYW5lIERvZSIgfSl9CiAgICAgIC8+CgogICAgICA8c2VjdGlvbiBjbGFzc05hbWU9InN0b3J5Ym9vay1wYWdlIj4KICAgICAgICA8aDI+UGFnZXMgaW4gU3Rvcnlib29rPC9oMj4KICAgICAgICA8cD4KICAgICAgICAgIFdlIHJlY29tbWVuZCBidWlsZGluZyBVSXMgd2l0aCBheyIgIn0KICAgICAgICAgIDxhCiAgICAgICAgICAgIGhyZWY9Imh0dHBzOi8vY29tcG9uZW50ZHJpdmVuLm9yZyIKICAgICAgICAgICAgdGFyZ2V0PSJfYmxhbmsiCiAgICAgICAgICAgIHJlbD0ibm9vcGVuZXIgbm9yZWZlcnJlciIKICAgICAgICAgID4KICAgICAgICAgICAgPHN0cm9uZz5jb21wb25lbnQtZHJpdmVuPC9zdHJvbmc+CiAgICAgICAgICA8L2E+eyIgIn0KICAgICAgICAgIHByb2Nlc3Mgc3RhcnRpbmcgd2l0aCBhdG9taWMgY29tcG9uZW50cyBhbmQgZW5kaW5nIHdpdGggcGFnZXMuCiAgICAgICAgPC9wPgogICAgICAgIDxwPgogICAgICAgICAgUmVuZGVyIHBhZ2VzIHdpdGggbW9jayBkYXRhLiBUaGlzIG1ha2VzIGl0IGVhc3kgdG8gYnVpbGQgYW5kIHJldmlldwogICAgICAgICAgcGFnZSBzdGF0ZXMgd2l0aG91dCBuZWVkaW5nIHRvIG5hdmlnYXRlIHRvIHRoZW0gaW4geW91ciBhcHAuIEhlcmUgYXJlCiAgICAgICAgICBzb21lIGhhbmR5IHBhdHRlcm5zIGZvciBtYW5hZ2luZyBwYWdlIGRhdGEgaW4gU3Rvcnlib29rOgogICAgICAgIDwvcD4KICAgICAgICA8dWw+CiAgICAgICAgICA8bGk+CiAgICAgICAgICAgIFVzZSBhIGhpZ2hlci1sZXZlbCBjb25uZWN0ZWQgY29tcG9uZW50LiBTdG9yeWJvb2sgaGVscHMgeW91IGNvbXBvc2UKICAgICAgICAgICAgc3VjaCBkYXRhIGZyb20gdGhlICJhcmdzIiBvZiBjaGlsZCBjb21wb25lbnQgc3RvcmllcwogICAgICAgICAgPC9saT4KICAgICAgICAgIDxsaT4KICAgICAgICAgICAgQXNzZW1ibGUgZGF0YSBpbiB0aGUgcGFnZSBjb21wb25lbnQgZnJvbSB5b3VyIHNlcnZpY2VzLiBZb3UgY2FuIG1vY2sKICAgICAgICAgICAgdGhlc2Ugc2VydmljZXMgb3V0IHVzaW5nIFN0b3J5Ym9vay4KICAgICAgICAgIDwvbGk+CiAgICAgICAgPC91bD4KICAgICAgICA8cD4KICAgICAgICAgIEdldCBhIGd1aWRlZCB0dXRvcmlhbCBvbiBjb21wb25lbnQtZHJpdmVuIGRldmVsb3BtZW50IGF0eyIgIn0KICAgICAgICAgIDxhCiAgICAgICAgICAgIGhyZWY9Imh0dHBzOi8vc3Rvcnlib29rLmpzLm9yZy90dXRvcmlhbHMvIgogICBhd2VyL0RlZmF1bHRNZW51JwppbXBvcnQgeyB1c2VBY2NvdW50RHJhd2VyIH0gZnJvbSAnY29tcG9uZW50cy9BY2NvdW50RHJhd2VyL01pbmlQb3J0Zm9saW8vaG9va3MnCmltcG9ydCB7IHVzZVJlbmRlclVrQmFubmVyIH0gZnJvbSAnY29tcG9uZW50cy9Ub3BMZXZlbEJhbm5lcnMvVWtCYW5uZXInCmltcG9ydCB7IFdlYjNTdGF0dXNSZWYgfSBmcm9tICdjb21wb25lbnRzL1dlYjNTdGF0dXMnCmltcG9ydCB7IFdlYk5vdGlmaWNhdGlvblRvYXN0V3JhcHBlciB9IGZyb20gJ2ZlYXR1cmVzL25vdGlmaWNhdGlvbnMvV2ViTm90aWZpY2F0aW9uVG9hc3RXcmFwcGVyJwppbXBvcnQgdXNlRGlzYWJsZVNjcm9sbGluZyBmcm9tICdob29rcy91c2VEaXNhYmxlU2Nyb2xsaW5nJwppbXBvcnQgeyB1c2VJc1VuaXN3YXBFeHRlbnNpb25Db25uZWN0ZWQgfSBmcm9tICdob29rcy91c2VJc1VuaXN3YXBFeHRlbnNpb25Db25uZWN0ZWQnCmltcG9ydCB7IHVzZU9uQ2xpY2tPdXRzaWRlIH0gZnJvbSAnaG9va3MvdXNlT25DbGlja091dHNpZGUnCmltcG9ydCB1c2VQcmV2aW91cyBmcm9tICdob29rcy91c2VQcmV2aW91cycKaW1wb3J0IHsgdXNlQXRvbSB9IGZyb20gJ2pvdGFpJwppbXBvcnQgeyB1c2VFZmZlY3QsIHVzZVJlZiB9IGZyb20gJ3JlYWN0JwppbXBvcnQgeyBDaGV2cm9uc1JpZ2h0IH0gZnJvbSAncmVhY3QtZmVhdGhlcicKaW1wb3J0IHsKICBBbmltYXRlUHJlc2VuY2UsCiAgRmxleCwKICBGbGV4UHJvcHMsCiAgc3R5bGVkLAogIFRvdWNoYWJsZUFyZWEsCiAgdXNlTWVkaWEsCiAgdXNlU2Nyb2xsYmFyU3R5bGVzLAogIHVzZVNoYWRvd1Byb3BzTWVkaXVtLAogIHVzZVNwb3JlQ29sb3JzLAogIFdlYkJvdHRvbVNoZWV0LAp9IGZyb20gJ3VpL3NyYycKaW1wb3J0IHsgSU5URVJGQUNFX05BVl9IRUlHSFQsIHpJbmRleGVzIH0gZnJvbSAndWkvc3JjL3RoZW1lJwppbXBvcnQgeyB1c2VDb25uZWN0aW9uU3RhdHVzIH0gZnJvbSAndW5pc3dhcC9zcmMvZmVhdHVyZXMvYWNjb3VudHMvc3RvcmUvaG9va3MnCmltcG9ydCB7IFBsYXRmb3JtIH0gZnJvbSAndW5pc3dhcC9zcmMvZmVhdHVyZXMvcGxhdGZvcm1zL3R5cGVzL1BsYXRmb3JtJwppbXBvcnQgeyBJbnRlcmZhY2VFdmVudE5hbWUgfSBmcm9tICd1bmlzd2FwL3NyYy9mZWF0dXJlcy90ZWxlbWV0cnkvY29uc3RhbnRzJwppbXBvcnQgVHJhY2UgZnJvbSAndW5pc3dhcC9zcmMvZmVhdHVyZXMvdGVsZW1ldHJ5L1RyYWNlJwppbXBvcnQgeyBUZXN0SUQgfSBmcm9tICd1bmlzd2FwL3NyYy90ZXN0L2ZpeHR1cmVzL3Rlc3RJRHMnCgpjb25zdCBEUkFXRVJfU1BFQ1MgPSB7CiAgV0lEVEhfWEw6ICczOTBweCcsCiAgV0lEVEg6ICczMjBweCcsCiAgTUFSR0lOOiAnOHB4JywKICBPRkZTRVQ6ICcxMHB4JywKfQoKZXhwb3J0IGNvbnN0IE1PREFMX1dJRFRIID0gJzM2OHB4JwoKY29uc3QgQWNjb3VudERyYXdlclNjcm9sbFdyYXBwZXIgPSBzdHlsZWQoRmxleCwgewogICckcGxhdGZvcm0td2ViJzogewogICAgb3ZlcmZsb3dZOiAnYXV0bycsCiAgICBvdmVyZmxvd1g6ICdoaWRkZW4nLAogICAgb3ZlcnNjcm9sbEJlaGF2aW9yOiAnY29udGFpbicsCiAgfSwKICBib3JkZXJSYWRpdXM6ICckcm91bmRlZDIwJywKfSkKCmNvbnN0IEV4dGVuc2lvbkNvbnRhaW5lclN0eWxlczogRmxleFByb3BzID0gewogIGhlaWdodDogJ2F1dG8nLAogIHdpZHRoOiBNT0RBTF9XSURUSCwKICByaWdodDogJyRzcGFjaW5nMTInLAogIHRvcDogSU5URVJGQUNFX05BVl9IRUlHSFQsCn0gYXMgY29uc3QKCmNvbnN0IENvbnRhaW5lciA9IHN0eWxlZChGbGV4LCB7CiAgaGVpZ2h0OiAnMTAwJScsCiAgJyRwbGF0Zm9ybS13ZWInOiB7IHBvc2l0aW9uOiAnZml4ZWQnIH0sCiAgdG9wOiBEUkFXRVJfU1BFQ1MuTUFSR0lOLAogIHJpZ2h0OiAnMCcsCiAgekluZGV4OiB6SW5kZXhlcy5zaWRlYmFyLAogIHZhcmlhbnRzOiB7CiAgICBvcGVuOiB7CiAgICAgIHRydWU6IHsgcmVhZGNydW1iUGFnZSA9IFJlYWN0LmZvcndhcmRSZWY8CiAgSFRNTFNwYW5FbGVtZW50LAogIFJlYWN0LkNvbXBvbmVudFByb3BzV2l0aG91dFJlZjwic3BhbiI+Cj4oKHsgY2xhc3NOYW1lLCAuLi5wcm9wcyB9LCByZWYpID0+ICgKICA8c3BhbgogICAgcmVmPXtyZWZ9CiAgICByb2xlPSJsaW5rIgogICAgYXJpYS1kaXNhYmxlZD0idHJ1ZSIKICAgIGFyaWEtY3VycmVudD0icGFnZSIKICAgIGNsYXNzTmFtZT17Y24oImZvbnQtbm9ybWFsIHRleHQtZm9yZWdyb3VuZCIsIGNsYXNzTmFtZSl9CiAgICB7Li4ucHJvcHN9CiAgLz4KKSkKQnJlYWRjcnVtYlBhZ2UuZGlzcGxheU5hbWUgPSAiQnJlYWRjcnVtYlBhZ2UiCgpjb25zdCBCcmVhZGNydW1iU2VwYXJhdG9yID0gKHsKICBjaGlsZHJlbiwKICBjbGFzc05hbWUsCiAgLi4ucHJvcHMKfTogUmVhY3QuQ29tcG9uZW50UHJvcHM8ImxpIj4pID0+ICgKICA8bGkKICAgIHJvbGU9InByZXNlbnRhdGlvbiIKICAgIGFyaWEtaGlkZGVuPSJ0cnVlIgogICAgY2xhc3NOYW1lPXtjbigiWyY+c3ZnXTp3LTMuNSBbJj5zdmddOmgtMy41IiwgY2xhc3NOYW1lKX0KICAgIHsuLi5wcm9wc30KICA+CiAgICB7Y2hpbGRyZW4gPz8gPENoZXZyb25SaWdodCAvPn0KICA8L2xpPgopCkJyZWFkY3J1bWJTZXBhcmF0b3IuZGlzcGxheU5hbWUgPSAiQnJlYWRjcnVtYlNlcGFyYXRvciIKCmNvbnN0IEJyZWFkY3J1bWJFbGxpcHNpcyA9ICh7CiAgY2xhc3NOYW1lLAogIC4uLnByb3BzCn06IFJlYWN0LkNvbXBvbmVudFByb3BzPCJzcGFuIj4pID0+ICgKICA8c3BhbgogICAgcm9sZT0icHJlc2VudGF0aW9uIgogICAgYXJpYS1oaWRkZW49InRydWUiCiAgICBjbGFzc05hbWU9e2NuKCJmbGV4IGgtOSB3LTkgaXRlbXMtY2VudGVyIGp1c3RpZnktY2VudGVyIiwgY2xhc3NOYW1lKX0KICAgIHsuLi5wcm9wc30KICA+CiAgICA8TW9yZUhvcml6b250YWwgY2xhc3NOYW1lPSJoLTQgdy00IiAvPgogICAgPHNwYW4gY2xhc3NOYW1lPSJzci1vbmx5Ij5Nb3JlPC9zcGFuPgogIDwvc3Bhbj4KKQpCcmVhZGNydW1iRWxsaXBzaXMuZGlzcGxheU5hbWUgPSAiQnJlYWRjcnVtYkVsaXBzc2lzIgoKZXhwb3J0IHsKICBCcmVhZGNydW1iLAogIEJyZWFkY3J1bWJMaXN0LAogIEJyZWFkY3J1bWJJdGVtLAogIEJyZWFkY3J1bWJMaW5rLAogIEJyZWFkY3J1bWJQYWdlLAogIEJyZWFkY3J1bWJTZXBhcmF0b3IsCiAgQnJlYWRjcnVtYkVsbGlwc2lzLAp9CmltcG9ydCB7IFRyYW5zIH0gZnJvbSAnQGxpbmd1aS9tYWNybyc7CmltcG9ydCB7IEdpdEh1YiwgSW5zdGFncmFtLCBMaW5rZWRJbiwgWCB9IGZyb20gJ0BtdWkvaWNvbnMtbWF0ZXJpYWwnOwppbXBvcnQgeyBCb3gsIHN0eWxlZCwgU3ZnSWNvbiwgVHlwb2dyYXBoeSB9IGZyb20gJ0BtdWkvbWF0ZXJpYWwnOwppbXBvcnQgeyBEdW5lSWNvbiwgVGlrVG9rIH0gZnJvbSAncHVibGljL2ljb25zL2Zvb3Rlci9pY29ucyc7CmltcG9ydCB7IExpbmsgfSBmcm9tICdzcmMvY29tcG9uZW50cy9wcmltaXRpdmVzL0xpbmsnOwppbXBvcnQgeyB1c2VSb290U3RvcmUgfSBmcm9tICdzcmMvc3RvcmUvcm9vdCc7CmltcG9ydCB7IHVzZVNoYWxsb3cgfSBmcm9tICd6dXN0YW5kL3NoYWxsb3cnOwoKaW1wb3J0IERpc2NvcmRJY29uIGZyb20gJy9wdWJsaWMvaWNvbnMvZGlzY29yZC5zdmcnOwppbXBvcnQgTGVuc0xvZ29JY29uIGZyb20gJy9wdWJsaWMvaWNvbnMvbGVucy1sb2dvLnN2Zyc7CgppbnRlcmZhY2UgU3R5bGVkTGlua1Byb3BzIHsKICBvbkNsaWNrPzogUmVhY3QuTW91c2VFdmVudEhhbmRsZXI8SFRNTEFuY2hvckVsZW1lbnQ+Owp9Cgpjb25zdCBTdHlsZWRMaW5rID0gc3R5bGVkKExpbmspPFN0eWxlZExpbmtQcm9wcz4oKHsgdGhlbWUgfSkgPT4gKHsKICBjb2xvcjogdGhlbWUucGFsZXR0ZS50ZXh0Lm11dGVkLAogICcmOmhvdmVyJzogewogICAgY29sb3I6IHRoZW1lLnBhbGV0dGUudGV4dC5wcmltYXJ5LAogIH0sCiAgZCAgIHRoaXMuYXBpLmFwcGx5T3B0aW9ucyh7IC4uLmRlZmF1bHRPcHRpb25zLCAuLi5ub25EZWZhdWx0Q2hhcnRPcHRpb25zIH0pCiAgfQoKICAvKiogVXBkYXRlcyB2aXNpYmxlIHJhbmdlIHRvIGZpdCBhbGwgZGF0YSBmcm9tIGFsbCBzZXJpZXMuICovCiAgcHVibGljIGZpdENvbnRlbnQoKSB7CiAgICB0aGlzLmFwaS50aW1lU2NhbGUoKS5maXRDb250ZW50KCkKICB9CgogIC8qKiBSZW1vdmVzIHRoZSBpbmplY3RlZCBjYW52YXMgZnJvbSB0aGUgY2hhcnREaXYuICovCiAgcHVibGljIHJlbW92ZSgpIHsKICAgIHRoaXMuYXBpLnJlbW92ZSgpCiAgfQp9CgovLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbWF4LXBhcmFtcwpmdW5jdGlvbiBpc0JldHdlZW4obnVtOiBudW1iZXIsIGxvd2VyOiBudW1iZXIsIHVwcGVyOiBudW1iZXIpOiBib29sZWFuIHsKICByZXR1cm4gbnVtID4gbG93ZXIgJiYgbnVtIDwgdXBwZXIKfQoKLyoqIFJldHVybnMgYSBkaXYgaW5qZWN0ZWQgd2l0aCBhIGxpZ2h0d2VpZ2h0LWNoYXJ0LCBjb3JyZXNwb25kaW5nIHRvIHRoZSBnaXZlbiBNb2RlbCBhbmQgcGFyYW1zICovCmV4cG9ydCBmdW5jdGlvbiBDaGFydDxUUGFyYW1UeXBlIGV4dGVuZHMgQ2hhcnREYXRhUGFyYW1zPFREYXRhVHlwZT4sIFREYXRhVHlwZSBleHRlbmRzIFNlcmllc0RhdGFJdGVtVHlwZT4oewogIE1vZGVsLAogIFRvb2x0aXBCb2R5LAogIHBhcmFtcywKICBoZWlnaHQsCiAgY2hpbGRyZW4sCiAgY2xhc3NOYW1lLAogIGRpc2FibGVDaGFydFRvdWNoUGFubmluZywKICBzaG93RG90dGVkQmFja2dyb3VuZCA9IGZhbHNlLAogIHNob3dMZWZ0RmFkZU92ZXJsYXkgPSBmYWxzZSwKICBzaG93Q3VzdG9tSG92ZXJNYXJrZXIgPSBmYWxzZSwKICBvdmVycmlkZUNvbG9yLAp9OiB7CiAgTW9kZWw6IG5ldyAoY2hhcnREaXY6IEhUTUxEaXZFbGVtZW50LCBwYXJhbXM6IFRQYXJhbVR5cGUgJiBDaGFydFV0aWxQYXJhbXM8VERhdGFUeXBlPikgPT4gQ2hhcnRNb2RlbDxURGF0YVR5cGU+CiAgVG9vbHRpcEJvZHk/OiBDaGFydFRvb2x0aXBCb2R5Q29tcG9uZW50PFREYXRhVHlwZT4KICBwYXJhbXM6IFRQYXJhbVR5cGUKICBoZWlnaHQ/OiBudW1iZXIKICBjaGlsZHJlbj86IChjcm9zc2hhaXI/OiBURGF0YVR5cGUpID0+IFJlYWN0RWxlbWVudAogIGNsYXNzTmFtZT86IHN0cmluZwogIGRpc2FibGVDaGFydFRvdWNoUGFubmluZz86IGJvb2xlYW4gLy8gT24gdG91Y2ggZGV2aWNlcywgb3B0aW9uYWxseSBkaXNhYmxlcyBjaGFydCB0b3VjaCBwYW5uaW5nIG9uIG1vYmlsZSBkZXZpY2VzIHRvIGF2b2lkIGludGVyZmVyaW5nIHdpdGggdmVydGljYWwgc2Nyb2xsaW5nCiAgc2hvd0RvdHRlZEJhY2tncm91bmQ/OiBib29sZWFuCiAgc2hvd0xlZnRGYWRlT3ZlcmxheT86IGJvb2xlYW4KICBzaG93Q3VzdG9tSG92ZXJNYXJrZXI/OiBib29sZWFuCiAgb3ZlcnJpZGVDb2xvcj86IHN0cmluZyAvLyBPcHRpb25hbCB0b2tlbiBjb2xvciBvdmVycmlkZSBmb3IgYWNjZW50MQp9KSB7CiAgY29uc3Qgc2V0UmVmaXRDaGFydENvbnRlbnQgPSB1c2VVcGRhdGVBdG9tKHJlZml0Q2hhcnRDb250ZW50QXRvbSkKICAvLyBMaWdodHdlaWdodC1jaGFydHMgaW5qZWN0cyBhIGNhbnZhcyBpbnRvIHRoZSBwYWdlIHRocm91Z2ggdGhlIGRpdiByZWZlcmVuY2VkIGJlbG93CiAgLy8gSXQgaXMgc3RvcmVkIGluIHN0YXRlIHRvIGNhdXNlIGEgcmUtcmVuZGVyIHVwb24gZGl2IG1vdW50LCBhdm9pZGluZyBkZWxheSBpbiBjaGFydCBjcmVhdGlvbgogIGNvbnN0IFtjaGFydERpdkVsZW1lbnQsIHNldENoYXJ0RGl2RWxlbWVudF0gPSB1c2VTdGF0ZTxUYW1hZ3VpRWxlbWVudCB8IG51bGw+KG51bGwpCiAgY29uc3QgW2Nyb3NzaGFpckRhdGEsIHNldENyb3NzaGFpckRhdGFdID0gdXNlU3RhdGU8VERhdGFUeXBlIHwgdW5kZWZpbmVkPih1bmRlZmluZWQpCiAgY29uc3QgW2hvdmVyQ29vcmRpbmF0ZXMsIHNldEhvdmVyQ3RpbmdzQ29udGV4dH0+CiAgICAgICAgey8qIFJlLWNyZWF0ZSBhIG5ldyBTd2FwRm9ybVN0b3JlQ29udGV4dC5Qcm92aWRlciwgc2luY2UgUG9ydGFsIGNhbiBjYXVzZSBpdHMgY2hpbGRyZW4gdG8gYmUgaW4gYSBzZXBhcmF0ZSBjb21wb25lbnQgdHJlZS4gKi99CiAgICAgICAgPFN3YXBGb3JtU3RvcmVDb250ZXh0LlByb3ZpZGVyIHZhbHVlPXtzd2FwRm9ybVN0b3JlfT4KICAgICAgICAgIDxUcmFuc2FjdGlvblNldHRpbmdzTW9kYWxDb250ZW50CiAgICAgICAgICAgIGluaXRpYWxTZWxlY3RlZFNldHRpbmc9e2luaXRpYWxTZWxlY3RlZFNldHRpbmd9CiAgICAgICAgICAgIHNldHRpbmdzPXtzZXR0aW5nc30KICAgICAgICAgICAgb25DbG9zZT17b25DbG9zZX0KICAgICAgICAgIC8+CiAgICAgICAgPC9Td2FwRm9ybVN0b3JlQ29udGV4dC5Qcm92aWRlcj4KICAgICAgPC9UcmFuc2FjdGlvblNldHRpbmdzU3RvcmVDb250ZXh0LlByb3ZpZGVyPgogICAgPC9Nb2RhbD4KICApCn0KLyoqCiAqIFJlYWN0IFF1ZXJ5IENvbnRleHQgUHJvdmlkZXIKICoKICogVGhpcyBtb2R1bGUgc2V0cyB1cCBSZWFjdCBRdWVyeSB3aXRoOgogKiAtIE9wdGltaXplZCBkZWZhdWx0IGNvbmZpZ3VyYXRpb25zCiAqIC0gT2ZmbGluZSBwZXJzaXN0ZW5jZSBzdXBwb3J0CiAqIC0gRW52aXJvbm1lbnQtYmFzZWQgY2FjaGUgZHVyYXRpb24gc2V0dGluZ3MKICogLSBDcm9zcy1wbGF0Zm9ybSBjb21wYXRpYmlsaXR5IChtb2JpbGUgKyBleHRlbnNpb24pCiAqLwoKaW1wb3J0IHsgb25saW5lTWFuYWdlciwgUXVlcnlDbGllbnQgfSBmcm9tICJAdGFuc3RhY2svcmVhY3QtcXVlcnkiOwppbXBvcnQgeyBQZXJzaXN0UXVlcnlDbGllbnRQcm92aWRlciB9IGZyb20gIkB0YW5zdGFjay9yZWFjdC1xdWVyeS1wZXJzaXN0LWNsaWVudCI7CmltcG9ydCBSZWFjdCwgeyB0eXBlIFJlYWN0Tm9kZSwgdXNlQ2FsbGJhY2ssIHVzZUVmZmVjdCwgdXNlTWVtbywgdXNlU3RhdGUgfSBmcm9tICJyZWFjdCI7CmltcG9ydCB7IFBsYXRmb3JtIH0gZnJvbSAicmVhY3QtbmF0aXZlIjsKaW1wb3J0IHsgQ0FDSEVfQ09ORklHIH0gZnJvbSAiQC9jb25maWcvY2FjaGUuY29uZmlnIjsKaW1wb3J0IHsgY2xlYXJRdWVyeUNhY2hlLCBjcmVhdGVRdWVyeVBlcnNpc3RlciB9IGZyb20gIkAvdXRpbHMvcXVlcnlQZXJzaXN0ZXIiOwoKLyoqCiAqIENyZWF0ZSBhbmQgY29uZmlndXJlIHRoZSBRdWVyeUNsaWVudCBpbnN0YW5jZQogKi8KY29uc3QgY3JlYXRlUXVlcnlDbGllbnQgPSAoKTogUXVlcnlDbGllbnQgPT4gewogIHJldHVybiBuZXcgUXVlcnlDbGllbnQoewogICAgZGVmYXVsdE9wdGlvbnM6IHsKICAgICAgcXVlcmllczogewogICAgICAgIC8vIEhvdyBsb25nIGRhdGEgaXMgY29uc2lkZXJlZCBmcmVzaAogICAgICAgIHN0YWxlVGltZTogQ0FDSEVfQ09ORklHLmRlZmF1bHRTdGFsZVRpbWUsCgogICAgICAgIC8vIEhvdyBsb25nIHRvIGtlZXAgdW51c2VkIGRhdGEgaW4gY2FjaGUKICAgICAgICBnY1RpbWU6IENBQ0hFX0NPTkZJRy5nY1RpbWUsCgogICAgICAgIC8vIFJlZmV0Y2ggYmVoYXZpb3IKICAgICAgICByZWZldGNoT25XaW5kb3dGb2N1czogQ0FDSEVfQ09ORklHLnJlZmV0Y2gub25XaW5kb3dGb2N1cywKICAgICAgICByZWZldGNoT25SZWNvbm5lY3Q6IENBQ0hFX0NPTkZJRy5yZWZldGNoLm9uUmVjb25uZWN0LAogICAgICAgIHJlZmV0Y2hPbk1vdW50OiBDQUNIRV9DT05GSUcucmVmZXRjaC5vbk1vdW50LAoKICAgICAgICAvLyBSZXRyeSBjb25maWd1cmF0aW9uCiAgICAgICAgcmV0cnk6IENBQ0hFX0NPTkZJRy5yZXRyeS5jb3VudCwKICAgICAgICByZXRyeURlbGF5OiBDQUNIRV9DT05GSUcucmV0cnkuZGVsYXksCgogICAgICAgIC8vIE5ldHdvcmsgbW9kZSAtIGFsd2F5cyB0cnkgdG8gZmV0Y2gsIHVzZSBjYWNoZSBhcyBmYWxsYmFjawogICAgICAgIG5ldHdvcmtNb2RlOiAib2ZmbGluZUZpcnN0IiwKIHBsZXMvcmFkaXgvdWkvcG9wb3ZlciIKaW1wb3J0IHsgcGFyc2VEYXRlIH0gZnJvbSAiY2hyb25vLW5vZGUiCmltcG9ydCB7IENhbGVuZGFySWNvbiB9IGZyb20gImx1Y2lkZS1yZWFjdCIKCmZ1bmN0aW9uIGZvcm1hdERhdGUoZGF0ZTogRGF0ZSB8IHVuZGVmaW5lZCkgewogIGlmICghZGF0ZSkgewogICAgcmV0dXJuICIiCiAgfQoKICByZXR1cm4gZGF0ZS50b0xvY2FsZURhdGVTdHJpbmcoImVuLVVTIiwgewogICAgZGF5OiAiMi1kaWdpdCIsCiAgICBtb250aDogImxvbmciLAogICAgeWVhcjogIm51bWVyaWMiLAogIH0pCn0KCmV4cG9ydCBmdW5jdGlvbiBEYXRlUGlja2VyTmF0dXJhbExhbmd1YWdlKCkgewogIGNvbnN0IFtvcGVuLCBzZXRPcGVuXSA9IFJlYWN0LnVzZVN0YXRlKGZhbHNlKQogIGNvbnN0IFt2YWx1ZSwgc2V0VmFsdWVdID0gUmVhY3QudXNlU3RhdGUoIkluIDIgZGF5cyIpCiAgY29uc3QgW2RhdGUsIHNldERhdGVdID0gUmVhY3QudXNlU3RhdGU8RGF0ZSB8IHVuZGVmaW5lZD4oCiAgICBwYXJzZURhdGUodmFsdWUpIHx8IHVuZGVmaW5lZAogICkKCiAgcmV0dXJuICgKICAgIDxGaWVsZCBjbGFzc05hbWU9Im14LWF1dG8gbWF4LXcteHMiPgogICAgICA8RmllbGRMYWJlbCBodG1sRm9yPSJkYXRlLW9wdGlvbmFsIj5TY2hlZHVsZSBEYXRlPC9GaWVsZExhYmVsPgogICAgICA8SW5wdXRHcm91cD4KICAgICAgICA8SW5wdXRHcm91cElucHV0CiAgICAgICAgICBpZD0iZGF0ZS1vcHRpb25hbCIKICAgICAgICAgIHZhbHVlPXt2YWx1ZX0KICAgICAgICAgIHBsYWNlaG9sZGVyPSJUb21vcnJvdyBvciBuZXh0IHdlZWsiCiAgICAgICAgICBvbkNoYW5nZT17KGUpID0+IHsKICAgICAgICAgICAgc2V0VmFsdWUoZS50YXJnZXQudmFsdWUpCiAgICAgICAgICAgIGNvbnN0IGRhdGUgPSBwYXJzZURhdGUoZS50YXJnZXQudmFsdWUpCiAgICAgICAgICAgIGlmIChkYXRlKSB7CiAgICAgICAgICAgICAgc2V0RGF0ZShkYXRlKQogICAgICAgICAgICB9CiAgICAgICAgICB9fQogICAgICAgICAgb25LZXlEb3duPXsoZSkgPT4gewogICAgICAgICAgICBpZiAoZS5rZXkgPT09ICJBcnJvd0Rvd24iKSB7CiAgICAgICAgICAgICAgZS5wcmV2ZW50RGVmYXVsdCgpCiAgICAgICAgICAgICAgc2V0T3Blbih0cnVlKQogICAgICAgICAgICB9CiAgICAgICAgICB9fQogICAgICAgIC8+CiAgICAgICAgPElucHV0R3JvdXBBZGRvbiBhbGlnbj0iaW5saW5lLWVuZCI+CiAgICAgICAgICA8UG9wb3ZlciBvcGVuPXtvcGVufSBvbk9wZW5DaGFuZ2U9e3NldE9wZW59PgogICAgICAgICAgICA8UG9wb3ZlclRyaWdnZXIgYXNDaGlsZD4KICAgICAgICAgICAgICA8SW5wdXRHcm91cEJ1dHRvbgogICAgICAgICAgICAgICAgaWQ9ImRhdGUtcGlja2VyIgogICAgICAgICAgICAgICAgdmFyaWFudD0iZ2hvc3QiCiAgICAgICAgICAgICAgICBzaXplPSJpY29uLXhzIgogICAgICAgICAgICAgICAgYXJpYS1sYWJlbD0iU2VsZWN0IGRhdGUiCiAgICAgICAgICAgICAgPgogICAgICAgICAgICAgICAgPENhbGVuZGFySWNvbiAvPgogICAgICAgICAgICAgICAgPHNwYW4gY2xhc3NOYW1lPSJzci1vbmx5Ij5TZWxlY3QgZGF0ZTwvc3Bhbj4KICAgICAgICAgICAgICA8L0lucHV0R3JvdXBCdXR0b24+CiAgICAgICAgICAgIDwvUG9wb3ZlclRyaWdnZXI+CiAgICAgICAgICAgIDxQb3BvdmVyQ29udGVudAogICAgICAgICAgICAgIGNsYXNzTmFtZT0idy1hdXRvIG92ZXJmbG93LWhpZGRlbiBwLTAiCiAgICAgICAgICAgICAgYWxpZ249ImVuZCIKICAgICAgICAgICAgICBzaWRlT2Zmc2V0PXs4fQogICAgICAgICAgICA+CiAgICAgICAgICAgICAgPENhbGVuZGFyCiAgICAgICAgICAgICAgICBtb2RlPSJzaW5nbGUiCiAgICAgICAgICAgICAgICBzZWxlY3RlZD17ZGF0ZX0KICAgICAgICAgICAgICAgIGNhcHRpb25MYXlvdXQ9ImRyb3Bkb3duIgogICAgICAgICAgICAgICAgZGVmYXVsdE1vbnRoPXtkYXRuaW5nICYmICFoYXNTaG93blJlamVjdEFsZXJ0LmN1cnJlbnQpIHsKICAgICAgaGFzU2hvd25SZWplY3RBbGVydC5jdXJyZW50ID0gdHJ1ZTsKICAgICAgQWxlcnQucHJvbXB0KAogICAgICAgICJSZWplY3QgdGhlIGJvb2tpbmcgcmVxdWVzdD8iLAogICAgICAgICJBcmUgeW91IHN1cmUgeW91IHdhbnQgdG8gcmVqZWN0IHRoZSBib29raW5nPyBXZSdsbCBsZXQgdGhlIHBlcnNvbiB3aG8gdHJpZWQgdG8gYm9vayBrbm93LiBZb3UgY2FuIHByb3ZpZGUgYSByZWFzb24gYmVsb3cuIiwKICAgICAgICBbCiAgICAgICAgICB7CiAgICAgICAgICAgIHRleHQ6ICJDYW5jZWwiLAogICAgICAgICAgICBzdHlsZTogImNhbmNlbCIsCiAgICAgICAgICAgIG9uUHJlc3M6ICgpID0+IHsKICAgICAgICAgICAgICBoYXNTaG93blJlamVjdEFsZXJ0LmN1cnJlbnQgPSBmYWxzZTsKICAgICAgICAgICAgICBvblJlamVjdENsb3NlKCk7CiAgICAgICAgICAgIH0sCiAgICAgICAgICB9LAogICAgICAgICAgewogICAgICAgICAgICB0ZXh0OiAiUmVqZWN0IiwKICAgICAgICAgICAgc3R5bGU6ICJkZXN0cnVjdGl2ZSIsCiAgICAgICAgICAgIG9uUHJlc3M6IChyZWFzb24/OiBzdHJpbmcpID0+IHsKICAgICAgICAgICAgICBoYXNTaG93blJlamVjdEFsZXJ0LmN1cnJlbnQgPSBmYWxzZTsKICAgICAgICAgICAgICAvLyBQYXNzIHJlYXNvbiBkaXJlY3RseSB0byBhdm9pZCByYWNlIGNvbmRpdGlvbiB3aXRoIHN0YXRlIHVwZGF0ZXMKICAgICAgICAgICAgICBvblJlamVjdFN1Ym1pdChyZWFzb24pOwogICAgICAgICAgICB9LAogICAgICAgICAgfSwKICAgICAgICBdLAogICAgICAgICJwbGFpbi10ZXh0IiwKICAgICAgICByZWplY3RSZWFzb24sCiAgICAgICAgImRlZmF1bHQiCiAgICAgICk7CiAgICB9IGVsc2UgaWYgKCFzaG93UmVqZWN0TW9kYWwpIHsKICAgICAgaGFzU2hvd25SZWplY3RBbGVydC5jdXJyZW50ID0gZmFsc2U7CiAgICB9CiAgfSwgW3Nob3dSZWplY3RNb2RhbCwgaXNEZWNsaW5pbmcsIG9uUmVqZWN0Q2xvc2UsIG9uUmVqZWN0U3VibWl0LCByZWplY3RSZWFzb25dKTsKCiAgcmV0dXJuICgKICAgIDw+CiAgICAgIHtzaG93RmlsdGVyTW9kYWwgIT09IHVuZGVmaW5lZCAmJiBvbkZpbHRlckNsb3NlICYmIG9uRXZlbnRUeXBlU2VsZWN0ID8gKAogICAgICAgIDxGdWxsU2NyZWVuTW9kYWwKICAgICAgICAgIHZpc2libGU9e3Nob3dGaWx0ZXJNb2RhbH0KICAgICAgICAgIGFuaW1hdGlvblR5cGU9ImZhZGUiCiAgICAgICAgICBvblJlcXVlc3RDbG9zZT17b25GaWx0ZXJDbG9zZX0KICAgICAgICA+CiAgICAgICAgICA8VG91Y2hhYmxlT3BhY2l0eQogICAgICAgICAgICBjbGFzc05hbWU9ImZsZXgtMSBpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIgYmctW3JnYmEoMCwwLDAsMC41KV0iCiAgICAgICAgICAgIGFjdGl2ZU9wYWNpdHk9ezF9CiAgICAgICAgICAgIG9uUHJlc3M9e29uRmlsdGVyQ2xvc2V9CiAgICAgICAgICA+CiAgICAgICAgICAgIDxUb3VjaGFibGVPcGFjaXR5CiAgICAgICAgICAgICAgYWN0aXZlT3BhY2l0eT17MX0KICAgICAgICAgICAgICBvblByZXNzPXsoZSkgPT4gZS5zdG9wUHJvcGFnYXRpb24oKX0KICAgICAgICAgICAgICBjbGFzc05hbWU9InctWzg1JV0gbWF4LXctWzM1MHB4XSByb3VuZGVkLTJ4bCBiZy13aGl0ZSBwLTUiCiAgICAgICAgICAgID4KICAgICAgICAgICAgICA8VGV4dCBjbGFzc05hbWU9Im1iLTQgdGV4dC1jZW50ZXIgdGV4dC1sZyBmb250LXNlbWlib2xkIHRleHQtWyMzMzNdIj4KICAgICAgICAgICAgICAgIEZpbHRlciBieSBFdmVudCBUeXBlCiAgICAgICAgICAgICAgPC9UZXh0PgoKICAgICAgICAgICAgICB7ZXZlbnRUeXBlc0xvYWRpbmcgPyAoCiAgICAgICAgICAgICAgICA8VmlldyBjbGFzc05hbWU9Iml0ZW1zLWNlbnRlciBweS00Ij4KICAgICAgICAgICAgICAgICAgPEFjdGl2aXR5SW5kaWNhdG9yIHNpemU9InNtYWxsIiBjdGluZ3NUb2dnbGUKICAgICAgICB0b2dnbGVTd2l0Y2hBdFRoZUVuZD17dHJ1ZX0KICAgICAgICB0aXRsZT17dCgiZGlzYWJsZV9vcmdfdXJsX2xhYmVsIil9CiAgICAgICAgZGVzY3JpcHRpb249e3QoImRpc2FibGVfb3JnX3VybF9kZXNjcmlwdGlvbiIsIHsKICAgICAgICAgIG9yZ1NsdWc6IGN1cnJlbnRPcmc/LnNsdWcsCiAgICAgICAgICBkZXN0aW5hdGlvbjogY3VycmVudE9yZz8ub3JnYW5pemF0aW9uU2V0dGluZ3M/Lm9yZ0F1dG9BY2NlcHRFbWFpbCwKICAgICAgICB9KX0KICAgICAgICBkaXNhYmxlZD17bXV0YXRpb24uaXNQZW5kaW5nfQogICAgICAgIGNoZWNrZWQ9e29yZ1Byb2ZpbGVSZWRpcmVjdHNUb1ZlcmlmaWVkRG9tYWluVmFsdWV9CiAgICAgICAgb25DaGVja2VkQ2hhbmdlPXsoY2hlY2tlZCkgPT4gewogICAgICAgICAgc2V0T3JnUHJvZmlsZVJlZGlyZWN0c1RvVmVyaWZpZWREb21haW5WYWx1ZShjaGVja2VkKTsKICAgICAgICAgIG11dGF0aW9uLm11dGF0ZSh7IG9yZ1Byb2ZpbGVSZWRpcmVjdHNUb1ZlcmlmaWVkRG9tYWluOiBjaGVja2VkIH0pOwogICAgICAgIH19CiAgICAgICAgc3dpdGNoQ29udGFpbmVyQ2xhc3NOYW1lPSJtdC02IgogICAgICAvPgogICAgPC9kaXY+CiAgKTsKfTsKCmNvbnN0IE9yZ0FwcGVhcmFuY2VWaWV3V3JhcHBlciA9ICgpID0+IHsKICBjb25zdCByb3V0ZXIgPSB1c2VSb3V0ZXIoKTsKICBjb25zdCB7IGRhdGE6IGN1cnJlbnRPcmcsIGlzUGVuZGluZywgZXJyb3IgfSA9IHRycGMudmlld2VyLm9yZ2FuaXphdGlvbnMubGlzdEN1cnJlbnQudXNlUXVlcnkoKTsKICBjb25zdCBzZXNzaW9uID0gdXNlU2Vzc2lvbigpOwogIGNvbnN0IGlzQWRtaW5Pck93bmVyID0gY2hlY2tBZG1pbk9yT3duZXIoc2Vzc2lvbi5kYXRhPy51c2VyPy5vcmc/LnJvbGUpOwoKICB1c2VFZmZlY3QoCiAgICBmdW5jdGlvbiByZWZhY3Rvck1lV2l0aG91dEVmZmVjdCgpIHsKICAgICAgaWYgKGVycm9yKSB7CiAgICAgICAgcm91dGVyLnJlcGxhY2UoIi9lbnRlcnByaXNlIik7CiAgICAgIH0KICAgIH0sCiAgICBbZXJyb3JdCiAgKTsKCiAgaWYgKGlzUGVuZGluZykgewogICAgcmV0dXJuIDxBcHBlYXJhbmNlU2tlbGV0b25Mb2FkZXIgLz47CiAgfQoKICBpZiAoIWN1cnJlbnRPcmcpIHJldHVybiBudWxsOwoKICByZXR1cm4gPE9yZ0FwcGVhcmFuY2VWaWV3IGN1cnJlbnRPcmc9e2N1cnJlbnRPcmd9IGlzQWRtaW5Pck93bmVyPXtpc0FkbWluT3JPd25lcn0gLz47Cn07CgpleHBvcnQgZGVmYXVsdCBPcmdBcHBlYXJhbmNlVmlld1dyYXBwZXI7CmltcG9ydCB7IE5hdGl2ZVN0YWNrU2NyZWVuUHJvcHMgfSBmcm9tICdAcmVhY3QtbmF2aWdhdGlvbi9uYXRpdmUtc3RhY2snCmltcG9ydCBSZWFjdCBmcm9tICdyZWFjdCcKaW1wb3J0IHsgdXNlVHJhbnNsYXRpb24gfSBmcm9tICdyZWFjdC1pMThuZXh0JwppbXBvcnQgeyBTY3JvbGxWaWV3IH0gZnJvbSAncmVhY3QtbmF0aXZlLWdlc3R1cmUtaGFuZGxlcicKaW1wb3J0IHsgT25ib2FyZGluZ1N0YWNrUGFyYW1MaXN0IH0gZnJvbSAnc3JjL2FwcC9uYXZpZ2F0aW9uL3R5cGVzJwppbXBvcnQgeyBDbG91ZFN0b3JhZ2VNbmVtb25pY0JhY2t1cCB9IGZyb20gJ3NyYy9mZWF0dXJlcy9DbG91ZEJhY2t1cC90eXBlcycKaW1wb3J0IHsgT25ib2FyZGluZ1NjcmVlbiB9IGZyb20gJ3NyYy9mZWF0dXJlcy9vbmJvYXJkaW5nL09uYm9hcmRpbmdTY3JlZW4nCmltcG9ydCB7IHVzZU5hdmlnYXRpb25IZWFkZXIgfSBmcm9tICdzcmMvdXRpbHMvdXNlTmF2aWdhdGlvbkhlYWRlcicKaW1wb3J0IHsgRmxleCwgVGV4dCwgVG91Y2hhYmxlQXJlYSwgdXNlSXNEYXJrTW9kZSB9IGZyb20gJ3VpL3NyYycKaW1wb3J0IHsgRG93bmxvYWRBbHQsIFJvdGF0YWJsZUNoZXZyb24sIFVuaXRhZyB9IGZyb20gJ3VpL3NyYy9jb21wb25lbnRzL2ljb25zJwppbXBvcnQgeyBpY29uU2l6ZXMgfSBmcm9tICd1aS9zcmMvdGhlbWUnCmltaW9ucy9ob29rcy91c2VVU0RDUHJpY2UnCmltcG9ydCB7IE51bWJlclR5cGUgfSBmcm9tICd1dGlsaXRpZXMvc3JjL2Zvcm1hdC90eXBlcycKCmZ1bmN0aW9uIGZvcm1hdERhdGVSYW5nZSh7CiAgc3RhcnRUaW1lc3RhbXAsCiAgZW5kVGltZXN0YW1wLAogIGxvY2FsZSwKfTogewogIHN0YXJ0VGltZXN0YW1wPzogbnVtYmVyCiAgZW5kVGltZXN0YW1wPzogbnVtYmVyCiAgbG9jYWxlOiBSZXR1cm5UeXBlPHR5cGVvZiB1c2VDdXJyZW50TGFuZ3VhZ2U+Cn0pOiBzdHJpbmcgewogIGlmICghc3RhcnRUaW1lc3RhbXAgfHwgIWVuZFRpbWVzdGFtcCkgewogICAgcmV0dXJuICcnCiAgfQogIGNvbnN0IHN0YXJ0ID0gbmV3IERhdGUoc3RhcnRUaW1lc3RhbXAgKiAxMDAwKQogIGNvbnN0IGVuZCA9IG5ldyBEYXRlKGVuZFRpbWVzdGFtcCAqIDEwMDApCiAgY29uc3Qgb3B0aW9uczogSW50bC5EYXRlVGltZUZvcm1hdE9wdGlvbnMgPSB7IG1vbnRoOiAnc2hvcnQnLCBkYXk6ICdudW1lcmljJyB9CgogIGNvbnN0IHN0YXJ0RGF0ZVN0ciA9IG5ldyBJbnRsLkRhdGVUaW1lRm9ybWF0KGxvY2FsZSwgb3B0aW9ucykuZm9ybWF0KHN0YXJ0KQogIGNvbnN0IGVuZERhdGVTdHIgPSBuZXcgSW50bC5EYXRlVGltZUZvcm1hdChsb2NhbGUsIG9wdGlvbnMpLmZvcm1hdChlbmQpCiAgcmV0dXJuIGAke3N0YXJ0RGF0ZVN0cn0gLSAke2VuZERhdGVTdHJ9YAp9Cgpjb25zdCBnZXREYXlzUmVtYWluaW5nID0gKGVuZFRpbWVzdGFtcDogbnVtYmVyIHwgdW5kZWZpbmVkLCB0OiBURnVuY3Rpb24pOiBzdHJpbmcgPT4gewogIGlmICghZW5kVGltZXN0YW1wKSB7CiAgICByZXR1cm4gJycKICB9CiAgY29uc3Qgbm93ID0gRGF0ZS5ub3coKQogIGNvbnN0IGVuZCA9IGVuZFRpbWVzdGFtcCAqIDEwMDAKICBjb25zdCBkaWZmID0gZW5kIC0gbm93CiAgaWYgKGRpZmYgPD0gMCkgewogICAgcmV0dXJuIHQoJ2NvbW1vbi5lbmRlZCcpCiAgfQogIGNvbnN0IGRheXMgPSBkaWZmIC8gbXMoJzFkJykKICBpZiAoZGF5cyA8IDEpIHsKICAgIHJldHVybiBgPCAxICR7dCgnY29tbW9uLmRheScpfWAKICB9CiAgcmV0dXJuIGAke01hdGguY2VpbChkYXlzKX0gJHt0KCdwb29sLmluY2VudGl2ZXMuZGF5c0xlZnQnKX1gCn0KCmludGVyZmFjZSBCYXJDaGFydFNpZGVQcm9wcyB7CiAgcGVyY2VudDogbnVtYmVyCiAgY29sb3I6IHN0cmluZwogIGlzTGVmdDogYm9vbGVhbgp9Cgpjb25zdCBCYXJDaGFydFNpZGUgPSAoeyBwZXJjZW50LCBjb2xvciwgaXNMZWZ0IH06IEJhckNoYXJ0U2lkZVByb3BzKSA9PiB7CiAgcmV0dXJuICgKICAgIDxGbGV4CiAgICAgIGhlaWdodD17OH0KICAgICAgd2lkdGg9e2Ake3BlcmNlbnQgKiAxMDB9JWB9CiAgICAgIGJhY2tncm91bmRDb2xvcj17Y29sb3J9CiAgICAgIHsuLi4oaXNMZWZ0CiAgICAgICAgPyB7IGJvcmRlclRvcExlZnRSYWRpdXM6IDUsIGJvcmRlckJvdHRvbUxlZnRSYWRpdXM6IDUsIGJvcmRlclJpZ2h0V2lkdGg6IDEsIGJvcmRlclJpZ2h0Q29sb3I6ICckc3VyZmFjZTInIH0KICAgICAgICA6IHsgYm9yZGVyVG9wUmlnaHRSYWRpdXM6IDUsIGJvcmRlckJvdHRvbVJpZ2h0UmFkaXVzOiA1LCBib3JkZXJMZWZ0V2lkdGg6IDEsIGJvcmRlckxlZnRDb2xvcjogJyRzdXJmYWNlMicgfSl9CiAgICAvPgogICkKfQoKZXhwb3J0IGNvbnN0IExwSW5jZW50aXZlc1Bvb2xEZXRhaWxzUmV3YXJkc0Rpc3RyaWJ1dGlvbiA9ICh7CiAgcmV3YXJkc0NhbXBhaWduLAp9OiB7CiAgcmV3YXJkc0NhbXBhaWduPzogR3JhcGhRTEFwaS5SZXdhcmRzQ2FtcGFpZ24KfSkgPT4gewogIGNvbnN0IHsgZm9ybWF0Q3VycmVuY3lBbW91bnQsIGNvbnZlcnRGaWF0QW1vdW50Rm9ybWF0dGVkIH0gPSB1c2VMb2NhbGl6YXRpb25Db250ZXh0KCkKICBjb25zdCB7IHByaWNlOiB1bmlQcmljZSB9ID0gdXNlVVNEQ1ByaWNlKExQX0lOQ0VOVElWRVNfUkVXQVJEX1RPS0VOKQogIGNsMiIgZmxleFNocmluaz17MX0gbnVtYmVyT2ZMaW5lcz17MX0gdmFyaWFudD0iYnV0dG9uTGFiZWwzIj4KICAgICAgICAgICAge3NlbGVjdGVkT3B0aW9uPy5sYWJlbCA/PwogICAgICAgICAgICAgIChzZWxlY3RlZE9wdGlvbiAmJiAndmFsdWUnIGluIHNlbGVjdGVkT3B0aW9uCiAgICAgICAgICAgICAgICA/IHNlbGVjdGVkT3B0aW9uLnZhbHVlCiAgICAgICAgICAgICAgICA6IEpTT04uc3RyaW5naWZ5KHNlbGVjdGVkT3B0aW9uPy5qc29uVmFsdWUpKX0KICAgICAgICAgIDwvVGV4dD4KICAgICAgICA8L0FjdGlvblNoZWV0RHJvcGRvd24+CiAgICAgIDwvRmxleD4KICAgIDwvRmxleD4KICApCn0KCmNvbnN0IERZTkFNSUNfQ09ORklHX1RSVUVfRkFMU0VfT1BUSU9OUyA9IFsKICB7IHZhbHVlOiB0cnVlLCBsYWJlbDogJ0VuYWJsZWQnIH0sCiAgeyB2YWx1ZTogZmFsc2UsIGxhYmVsOiAnRGlzYWJsZWQnIH0sCl0KCmV4cG9ydCBmdW5jdGlvbiBEeW5hbWljQ29uZmlnRHJvcGRvd25Cb29sZWFuPAogIENvbmYgZXh0ZW5kcyBrZXlvZiBEeW5hbWljQ29uZmlnS2V5cywKICBLZXkgZXh0ZW5kcyBEeW5hbWljQ29uZmlnS2V5c1tDb25mXSwKPih7IGNvbmZpZywgY29uZmlnS2V5LCBsYWJlbCB9OiB7IGNvbmZpZzogQ29uZjsgY29uZmlnS2V5OiBLZXk7IGxhYmVsOiBzdHJpbmcgfSk6IEpTWC5FbGVtZW50IHsKICByZXR1cm4gKAogICAgPER5bmFtaWNDb25maWdEcm9wZG93bgogICAgICBjb25maWc9e2NvbmZpZ30KICAgICAgY29uZmlnS2V5PXtjb25maWdLZXl9CiAgICAgIGxhYmVsPXtsYWJlbH0KICAgICAgb3B0aW9ucz17RFlOQU1JQ19DT05GSUdfVFJVRV9GQUxTRV9PUFRJT05TfQogICAgICBzZWxlY3RlZD17dXNlRHluYW1pY0NvbmZpZ1ZhbHVlKHsKICAgICAgICBjb25maWcsCiAgICAgICAga2V5OiBjb25maWdLZXksCiAgICAgICAgZGVmYXVsdFZhbHVlOiBmYWxzZSwKICAgICAgfSkudG9TdHJpbmcoKX0KICAgIC8+CiAgKQp9CiJ1c2UgY2xpZW50IgoKaW1wb3J0IHsKICBGb2xkZXIsCiAgTW9yZUhvcml6b250YWwsCiAgU2hhcmUsCiAgVHJhc2gyLAogIHR5cGUgTHVjaWRlSWNvbiwKfSBmcm9tICJsdWNpZGUtcmVhY3QiCgppbXBvcnQgewogIERyb3Bkb3duTWVudSwKICBEcm9wZG93bk1lbnVDb250ZW50LAogIERyb3Bkb3duTWVudUl0ZW0sCiAgRHJvcGRvd25NZW51U2VwYXJhdG9yLAogIERyb3Bkb3duTWVudVRyaWdnZXIsCn0gZnJvbSAiQC9yZWdpc3RyeS9kZWZhdWx0L3VpL2Ryb3Bkb3duLW1lbnUiCmltcG9ydCB7CiAgU2lkZWJhckdyb3VwLAogIFNpZGViYXJHcm91cExhYmVsLAogIFNpZGViYXJNZW51LAogIFNpZGViYXJNZW51QWN0aW9uLAogIFNpZGViYXJNZW51QnV0dG9uLAogIFNpZGViYXJNZW51SXRlbSwKICB1c2VTaWRlYmFyLAp9IGZyb20gIkAvcmVnaXN0cnkvZGVmYXVsdC91aS9zaWRlYmFyIgoKZXhwb3J0IGZ1bmN0aW9uIE5hdlByb2plY3RzKHsKICBwcm9qZWN0cywKfTogewogIHByb2plY3RzOiB7CiAgICBuYW1lOiBzdHJpbmcKICAgIHVybDogc3RyaW5nCiAgICBpY29uOiBMdWNpZGVJY29uCiAgfVtdCn0pIHsKICBjb25zdCB7IGlzTW9iaWxlIH0gPSB1c2VTaWRlYmFyKCkKCiAgcmV0dXJuICgKICAgIDxTaWRlYmFyR3JvdXAgY2xhc3NOYW1lPSJncm91cC1kYXRhLVtjb2xsYXBzaWJsZT1pY29uXTpoaWRkZW4iPgogICAgICA8U2lkZWJhckdyb3VwTGFiZWw+UHJvamVjdHM8L1NpZGViYXJHcm91cExhYmVsPgogICAgICA8U2lkZWJhck1lbnU+CiAgICAgICAge3Byb2plY3RzLm1hcCgoaXRlbSkgPT4gKAogICAgICAgICAgPFNpZGViYXJNZW51SXRlbSBrZXk9e2l0ZW0ubmFtZX0+CiAgICAgICAgICAgIDxTaWRlYmFyTWVudUJ1dHRvbiBhc0NoaWxkPgogICAgICAgICAgICAgIDxhIGhyZWY9e2l0ZW0udXJsfT4KICAgICAgICAgICAgICAgIDxpdGVtLmljb24gLz4KICAgICAgICAgICAgICAgIDxzcGFuPntpdGVtLm5hbWV9PC9zZXMvdGVzdElEcycKaW1wb3J0IHsgSW1wb3J0VHlwZSB9IGZyb20gJ3VuaXN3YXAvc3JjL3R5cGVzL29uYm9hcmRpbmcnCmltcG9ydCB7IE9uYm9hcmRpbmdTY3JlZW5zIH0gZnJvbSAndW5pc3dhcC9zcmMvdHlwZXMvc2NyZWVucy9tb2JpbGUnCmltcG9ydCB7IGxvZ2dlciB9IGZyb20gJ3V0aWxpdGllcy9zcmMvbG9nZ2VyL2xvZ2dlcicKCmNvbnN0IG9wdGlvbnM6IEltcG9ydE1ldGhvZE9wdGlvbltdID0gW3Jlc3RvcmVGcm9tQ2xvdWRCYWNrdXBPcHRpb24sIHJlc3RvcmVXYWxsZXRXaXRoU2VlZFBocmFzZU9wdGlvbl0KCnR5cGUgUHJvcHMgPSBOYXRpdmVTdGFja1NjcmVlblByb3BzPE9uYm9hcmRpbmdTdGFja1BhcmFtTGlzdCwgT25ib2FyZGluZ1NjcmVlbnMuUmVzdG9yZU1ldGhvZD4KCi8qKgogKiBUaGlzIHNjcmVlbiBpcyB1c2VkIHRvIHNlbGVjdCB0aGUgbWV0aG9kIG9mIHJlc3RvcmluZyBhIHdhbGxldC4KICovCmV4cG9ydCBmdW5jdGlvbiBSZXN0b3JlTWV0aG9kU2NyZWVuKHsgbmF2aWdhdGlvbiwgcm91dGU6IHsgcGFyYW1zIH0gfTogUHJvcHMpOiBKU1guRWxlbWVudCB7CiAgY29uc3QgeyB0IH0gPSB1c2VUcmFuc2xhdGlvbigpCiAgY29uc3QgaXNEYXJrTW9kZSA9IHVzZUlzRGFya01vZGUoKQogIGNvbnN0IHNob3VsZFNob3dQcml2YXRlS2V5cyA9IHVzZUZlYXR1cmVGbGFnKEZlYXR1cmVGbGFncy5FbmFibGVFeHBvcnRQcml2YXRlS2V5cykKICBjb25zdCBlbnRyeVBvaW50ID0gcGFyYW1zLmVudHJ5UG9pbnQKCiAgdXNlTmF2aWdhdGlvbkhlYWRlcihuYXZpZ2F0aW9uKQoKICBjb25zdCBoYW5kbGVPblByZXNzID0gYXN5bmMgKG5hdjogSW1wb3J0TWV0aG9kT3B0aW9uWyduYXYnXSwgaW1wb3J0VHlwZTogSW1wb3J0VHlwZSk6IFByb21pc2U8dm9pZD4gPT4gewogICAgaWYgKG5hdiA9PT0gT25ib2FyZGluZ1NjcmVlbnMuUGFzc2tleUltcG9ydCkgewogICAgICBjb25zdCBlcnJvciA9IG5ldyBFcnJvcignSW52YWxpZCBzY3JlZW4gcGFzc2VkIHRvIGhhbmRsZU9uUHJlc3MnKQogICAgICBsb2dnZXIuZXJyb3IoZXJyb3IsIHsKICAgICAgICB0YWdzOiB7IGZpbGU6ICdSZXN0b3JlTWV0aG9kU2NyZWVuJywgZnVuY3Rpb246ICdoYW5kbGVPblByZXNzJyB9LAogICAgICB9KQogICAgICB0aHJvdyBlcnJvcgogICAgfQoKICAgIGlmIChuYXYgIT09IE9uYm9hcmRpbmdTY3JlZW5zLlJlc3RvcmVDbG91ZEJhY2t1cCkgewogICAgICBuYXZpZ2F0aW9uLm5hdmlnYXRlKHsKICAgICAgICBuYW1lOiBuYXYsCiAgICAgICAgcGFyYW1zOiB7IC4uLnBhcmFtcywgaW1wb3J0VHlwZSwgZW50cnlQb2ludCB9LAogICAgICAgIG1lcmdlOiB0cnVlLAogICAgICB9KQogICAgfQogIH0KCiAgY29uc3Qgb25WaWV3UHJpdmF0ZUtleXMgPSAoKTogdm9pZCA9PiB7CiAgICBuYXZpZ2F0aW9uLm5hdmlnYXRlKE1vZGFsTmFtZS5Qcml2YXRlS2V5U3BlZWRCdW1wTW9kYWwpCiAgfQoKICByZXR1cm4gKAogICAgPE9uYm9hcmRpbmdTY3JlZW4gSWNvbj17V2FsbGV0RmlsbGVkfSB0aXRsZT17dCgnb25ib2FyZGluZy5pbXBvcnQubWV0aG9kLnJlc3RvcmVTZWVkUGhyYXNlLnRpdGxlJyl9PgogICAgICA8RmxleAogICAgICAgIGdyb3cKICAgICAgICBnYXA9IiRnYXAxMiIKICAgICAgICBtdD0iJHNwYWNpbmc0IgogICAgICAgIHNoYWRvd0NvbG9yPSIkc3VyZmFjZTMiCiAgICAgICAgc2hhZG93UmFkaXVzPXshaXNEYXJrTW9kZSA/ICckc3BhY2luZzgnIDogdW5kZWZpbmVkfQogICAgICA+CiAgICAgICAge29wdGlvbnMubWFwKCh7IHRpdGxlLCBibHVyYiwgaWNvbiwgbmF2LCBpbXBvcnRUeXBlLCBuYW1lLCB0ZXN0SUQgfSwgaSkgPT4gKAogICAgICAgICAgPE9wdGlvbkNhcmQKICAgICAgICAgICAga2V5PXsnY29ubmVjdGlvbi1vcHRpb24tJyArIG5hbWUgKyBpfQogICAgICAgICAgICBibHVyYj17Ymx1cmIodCl9CiAgICAgICAgICAgIGVsZW1lbnROYW1lPXtuYW1lfQogICAgIGFsaWduSXRlbXM9ImNlbnRlciIKICAgICAgICBib3JkZXJSYWRpdXM9IjEwIgogICAgICAgIGRpc3BsYXk9ImZsZXgiCiAgICAgICAgZmxleERpcmVjdGlvbj0iY29sdW1uIgogICAgICAgIGdhcD0iOCIKICAgICAgICBqdXN0aWZ5Q29udGVudD0ic3BhY2UtYmV0d2VlbiIKICAgICAgICBtYXJnaW5Cb3R0b209IjQiCiAgICAgICAgcGFkZGluZ1k9IjgiCiAgICAgICAgc3R5bGU9e3sgbWF4V2lkdGg6IDI3NSwgdGV4dEFsaWduOiAnY2VudGVyJyB9fQogICAgICA+CiAgICAgICAgPFRleHQgY29sb3I9Im1vZGFsVGV4dCIgc2l6ZT0iMTQiIHdlaWdodD0iYm9sZCI+CiAgICAgICAgICB7aTE4bi50KCdnZXQubG9va2luZ19mb3IudGl0bGUnKX0KICAgICAgICA8L1RleHQ+CiAgICAgICAgPFRleHQgY29sb3I9Im1vZGFsVGV4dFNlY29uZGFyeSIgc2l6ZT0iMTQiIHdlaWdodD0ibWVkaXVtIj4KICAgICAgICAgIHtjb21wYWN0TW9kZUVuYWJsZWQKICAgICAgICAgICAgPyBpMThuLnQoJ2dldC5sb29raW5nX2Zvci5kZXNrdG9wLmNvbXBhY3RfZGVzY3JpcHRpb24nKQogICAgICAgICAgICA6IGkxOG4udCgnZ2V0Lmxvb2tpbmdfZm9yLmRlc2t0b3Aud2lkZV9kZXNjcmlwdGlvbicpfQogICAgICAgIDwvVGV4dD4KICAgICAgPC9Cb3g+CiAgICA8L0JveD4KICApOwp9Cgpjb25zdCBMT0dPX1NJWkU6IEJveFByb3BzWydoZWlnaHQnXSA9ICc0NCc7IC8vIHNpemUgb2Ygd2FsbGV0IGxvZ28gaW4gQ29ubmVjdCB0YWIKZXhwb3J0IGZ1bmN0aW9uIENvbm5lY3REZXRhaWwoewogIGNoYW5nZVdhbGxldFN0ZXAsCiAgY29tcGFjdE1vZGVFbmFibGVkLAogIGNvbm5lY3Rpb25FcnJvciwKICBvbkNsb3NlLAogIHFyQ29kZVVyaSwKICByZWNvbm5lY3QsCiAgd2FsbGV0LAp9OiB7CiAgY2hhbmdlV2FsbGV0U3RlcDogKG5ld1dhbGxldFN0ZXA6IFdhbGxldFN0ZXApID0+IHZvaWQ7CiAgY29tcGFjdE1vZGVFbmFibGVkOiBib29sZWFuOwogIGNvbm5lY3Rpb25FcnJvcjogYm9vbGVhbjsKICBxckNvZGVVcmk/OiBzdHJpbmc7CiAgcmVjb25uZWN0OiAod2FsbGV0OiBXYWxsZXRDb25uZWN0b3IpID0+IHZvaWQ7CiAgd2FsbGV0OiBXYWxsZXRDb25uZWN0b3I7CiAgb25DbG9zZTogKCkgPT4gdm9pZDsKfSkgewogIGNvbnN0IHsKICAgIGRvd25sb2FkVXJscywKICAgIGljb25CYWNrZ3JvdW5kLAogICAgaWNvblVybCwKICAgIG5hbWUsCiAgICBxckNvZGUsCiAgICByZWFkeSwKICAgIHNob3dXYWxsZXRDb25uZWN0TW9kYWwsCiAgICBnZXREZXNrdG9wVXJpLAogIH0gPSB3YWxsZXQ7CiAgY29uc3QgaXNEZXNrdG9wRGVlcExpbmtBdmFpbGFibGUgPSAhIWdldERlc2t0b3BVcmk7CiAgY29uc3Qgc2FmYXJpID0gaXNTYWZhcmkoKTsKCiAgY29uc3QgeyBpMThuIH0gPSB1c2VDb250ZXh0KEkxOG5Db250ZXh0KTsKCiAgY29uc3QgaGFzRXh0ZW5zaW9uID0gISF3YWxsZXQuZXh0ZW5zaW9uRG93bmxvYWRVcmw7CiAgY29uc3QgaGFzUXJDb2RlQW5kRXh0ZW5zaW9uID0gZG93bmxvYWRVcmxzPy5xckNvZGUgJiYgaGFzRXh0ZW5zaW9uOwogIGNvbnN0IGhhc1FyQ29kZUFuZERlc2t0b3AgPQogICAgZG93bmxvYWRVcmxzPy5xckNvZGUgJiYgISF3YWxsZXQuZGVza3RvcERvd25sb2FkVXJsOwogIGNvbnN0IGhhc1FyQ29kZSA9IHFyQ29kZSAmJiBxckNvZGVVcmk7CgogIGNvbnN0IG9uRGVza3RvcFVyaSA9IGFzeW5jICgpID0+IHsKICAgIGNvbnN0IHVyaSA9IGF3YWl0IGdldERlc2t0b3BVcmk/LigpOwogICAgd2luZG93Lm9wZW4odXJpLCBzYWZhcmkgPyAnX2JsYW5rJyA6ICdfc2VsZicpOwogIH07CgogIGNvbnN0IHNlY29uZGFyeUFjdGlvbjogewogICAgZGVzY3JpcHRpb246IHN0cmluZzsKICAgIGxhYmVsOiBzdHJpbmc7CiAgICBvbkNsaWNrPzogKCkgPT4gdm9pZDsKICAgIGhyZWY/OiBzdHJpbmc7CiAgfSB8IG51bGwgPSBzaG93V2FsbGV0Q29ubmVjdE1vZGFsCiAgICA/IHsKICBoYW5nZT17aGFuZGxlQ2hhbmdlfQogICAgICAgIHZhbHVlPXt0ZWFtTWVtYmVyT3B0aW9ucy5maW5kKChvcHQpID0+IG9wdC52YWx1ZSA9PT0gZmllbGQudmFsdWUpIHx8IG51bGx9CiAgICAgICAgaXNDbGVhcmFibGUKICAgICAgLz4KICAgICk7CiAgfTsKCiAgY29uc3QgcmVuZGVyRW1haWxJbnB1dCA9ICh7CiAgICBmaWVsZCwKICB9OiB7CiAgICBmaWVsZDogQ29udHJvbGxlclJlbmRlclByb3BzPEZvcm1WYWx1ZXMsICJjb3JyZWN0QXNzaWduZWUiPjsKICB9KTogSlNYLkVsZW1lbnQgPT4gKAogICAgPGlucHV0CiAgICAgIHsuLi5maWVsZH0KICAgICAgdHlwZT0iZW1haWwiCiAgICAgIHBsYWNlaG9sZGVyPXtlbnRlckVtYWlsUGxhY2Vob2xkZXJ9CiAgICAgIGNsYXNzTmFtZT0iYm9yZGVyLWRlZmF1bHQgYmctZGVmYXVsdCB0ZXh0LWVtcGhhc2lzIHBsYWNlaG9sZGVyOnRleHQtbXV0ZWQgZm9jdXM6Ym9yZGVyLWVtcGhhc2lzIGZvY3VzOnJpbmctZW1waGFzaXMgYmxvY2sgdy1mdWxsIHJvdW5kZWQtbWQgYm9yZGVyIHB4LTMgcHktMiB0ZXh0LXNtIGZvY3VzOm91dGxpbmUtbm9uZSBmb2N1czpyaW5nLTEiCiAgICAvPgogICk7CgogIGxldCBhc3NpZ25lZUZpZWxkOiBKU1guRWxlbWVudDsKICBpZiAoc2hvd1RlYW1TZWxlY3RvcikgewogICAgYXNzaWduZWVGaWVsZCA9IDxDb250cm9sbGVyIG5hbWU9ImNvcnJlY3RBc3NpZ25lZSIgY29udHJvbD17Y29udHJvbH0gcmVuZGVyPXtyZW5kZXJUZWFtU2VsZWN0fSAvPjsKICB9IGVsc2UgewogICAgYXNzaWduZWVGaWVsZCA9IDxDb250cm9sbGVyIG5hbWU9ImNvcnJlY3RBc3NpZ25lZSIgY29udHJvbD17Y29udHJvbH0gcmVuZGVyPXtyZW5kZXJFbWFpbElucHV0fSAvPjsKICB9CgogIHJldHVybiAoCiAgICA8ZGl2IGNsYXNzTmFtZT0ibWItNCI+CiAgICAgIDxMYWJlbCBodG1sRm9yPSJjb3JyZWN0QXNzaWduZWUiIGNsYXNzTmFtZT0idGV4dC1lbXBoYXNpcyBtYi0yIGJsb2NrIHRleHQtc20gZm9udC1tZWRpdW0iPgogICAgICAgIHt3aG9TaG91bGRIYXZlUmVjZWl2ZWRJdExhYmVsfSA8c3BhbiBjbGFzc05hbWU9InRleHQtc3VidGxlIGZvbnQtbm9ybWFsIj4oe29wdGlvbmFsTGFiZWx9KTwvc3Bhbj4KICAgICAgPC9MYWJlbD4KICAgICAge2Fzc2lnbmVlRmllbGR9CiAgICA8L2Rpdj4KICApOwp9CgovLyBiaW9tZS1pZ25vcmUgbGludC9jb21wbGV4aXR5L25vRXhjZXNzaXZlTGluZXNQZXJGdW5jdGlvbjogRGlhbG9nIGNvbXBvbmVudCB3aXRoIGhvb2tzIGFuZCBzdGF0ZSBtYW5hZ2VtZW50IC0gYWxyZWFkeSBzcGxpdCBpbnRvIDMgc3ViLWNvbXBvbmVudHMKZXhwb3J0IGZ1bmN0aW9uIFdyb25nQXNzaWdubWVudERpYWxvZyhwcm9wczogSVdyb25nQXNzaWdubWVudERpYWxvZyk6IEpTWC5FbGVtZW50IHsKICBjb25zdCB7IHQgfSA9IHVzZUxvY2FsZSgpOwogIGNvbnN0IHV0aWxzID0gdHJwYy51c2VVdGlscygpOwogIGNvbnN0IHsgY29weVRvQ2xpcGJvYXJkLCBpc0NvcGllZCB9ID0gdXNlQ29weSgpOwogIGNvbnN0IHsKICAgIGlzT3BlbkRpYWxvZywKICAgIHNldElzT3BlbkRpYWxvZywKICAgIGJvb2tpbmdVaWQsCiAgICByb3V0aW5nUmVhc29uLAogICAgZ3Vlc3RFbWFpbCwKICAgIGhvc3RFbWFpbCwKICAgIGhvc3ROYW1lLAogICAgdGVhbUlkLAogIH0gPSBwcm9wczsKCiAgY29uc3QgewogICAgY29udHJvbCwKICAgIGhhbmRsZVN1Ym1pdCwKICAgIGZvcm1TdGF0ZTogeyBlcnJvcnMgfSwKICB9ID0gdXNlRm9ybTxGb3JtVmFsdWVzPih7CiAgICBkZWZhdWx0VmFsdWVzOiB7CiAgICAgIGNvcnJlY3RBc3NpZ25lZTogIiIsCiAgICAgIGFkZGl0aW9uYWxOb3RlczogIiIsCiAgICB9LAogIH0pOwoKICBjb25zdCB0ZWFtSWRGb3JRdWVyeSA9IHRlYW1JZCA/PyAwOwogIGNvbnN0IHsgZGF0YTogdGVhbU1lbWJlcnNEYXRhIH0gPSB0cnBjLnZpZXdlci50ZWFtcy5saXN0TWVtYmVycy51c2VRdWVyeSgKICAgdHdvcms6IGJvb2xlYW47CiAgY3VzdG9tR2FzUHJpY2U/OiBzdHJpbmc7CiAgc3ltYm9sOiBzdHJpbmc7CiAgYmxvY2tlZDogYm9vbGVhbjsKICBzdGFrZURhdGE6IE1lcmdlZFN0YWtlRGF0YTsKICBzZWxlY3RlZFRva2VuOiBTdGFrZUlucHV0QXNzZXQ7CiAgZXZlbnQ6IHN0cmluZzsKICBpc01heFNlbGVjdGVkOiBib29sZWFuOwogIHJlc2VydmU6IENvbXB1dGVkUmVzZXJ2ZURhdGE7Cn0KCmV4cG9ydCBjb25zdCBVbWJyZWxsYUFjdGlvbnMgPSAoewogIGFtb3VudFRvU3Rha2UsCiAgaXNXcm9uZ05ldHdvcmssCiAgc3gsCiAgc3ltYm9sLAogIGJsb2NrZWQsCiAgc2VsZWN0ZWRUb2tlbiwKICBldmVudCwKICBzdGFrZURhdGEsCiAgaXNNYXhTZWxlY3RlZCwKICByZXNlcnZlLAogIC4uLnByb3BzCn06IFN0YWtlQWN0aW9uUHJvcHMpID0+IHsKICBjb25zdCBxdWVyeUNsaWVudCA9IHVzZVF1ZXJ5Q2xpZW50KCk7CiAgY29uc3QgWwogICAgZXN0aW1hdGVHYXNMaW1pdCwKICAgIHRyeVBlcm1pdCwKICAgIHdhbGxldEFwcHJvdmFsTWV0aG9kUHJlZmVyZW5jZSwKICAgIGN1cnJlbnRNYXJrZXQsCiAgICBhZGRUcmFuc2FjdGlvbiwKICBdID0gdXNlUm9vdFN0b3JlKAogICAgdXNlU2hhbGxvdygoc3RhdGUpID0+IFsKICAgICAgc3RhdGUuZXN0aW1hdGVHYXNMaW1pdCwKICAgICAgc3RhdGUudHJ5UGVybWl0LAogICAgICBzdGF0ZS53YWxsZXRBcHByb3ZhbE1ldGhvZFByZWZlcmVuY2UsCiAgICAgIHN0YXRlLmN1cnJlbnRNYXJrZXQsCiAgICAgIHN0YXRlLmFkZFRyYW5zYWN0aW9uLAogICAgXSkKICApOwoKICBjb25zdCBjdXJyZW50Q2hhaW5JZCA9IHVzZVJvb3RTdG9yZSgoc3RvcmUpID0+IHN0b3JlLmN1cnJlbnRDaGFpbklkKTsKICBjb25zdCB1c2VyID0gdXNlUm9vdFN0b3JlKChzdG9yZSkgPT4gc3RvcmUuYWNjb3VudCk7CgogIGNvbnN0IHsKICAgIGFwcHJvdmFsVHhTdGF0ZSwKICAgIG1haW5UeFN0YXRlLAogICAgbG9hZGluZ1R4bnMsCiAgICBzZXRMb2FkaW5nVHhucywKICAgIHNldEFwcHJvdmFsVHhTdGF0ZSwKICAgIHNldE1haW5UeFN0YXRlLAogICAgc2V0R2FzTGltaXQsCiAgICBzZXRUeEVycm9yLAogIH0gPSB1c2VNb2RhbENvbnRleHQoKTsKCiAgY29uc3QgW3NpZ25hdHVyZVBhcmFtcywgc2V0U2lnbmF0dXJlUGFyYW1zXSA9IHVzZVN0YXRlPFNpZ25lZFBhcmFtcyB8IHVuZGVmaW5lZD4oKTsKCiAgY29uc3QgcGVybWl0QXZhaWxhYmxlID0KICAgIHNlbGVjdGVkVG9rZW4uYVRva2VuIHx8CiAgICB0cnlQZXJtaXQoewogICAgICByZXNlcnZlQWRkcmVzczogc2VsZWN0ZWRUb2tlbi5hZGRyZXNzLAogICAgICBpc1dyYXBwZWRCYXNlQXNzZXQ6IHNlbGVjdGVkVG9rZW4uYWRkcmVzcyA9PT0gQVBJX0VUSF9NT0NLX0FERFJFU1MsCiAgICB9KTsKICBjb25zdCB1c2VQZXJtaXQgPSBwZXJtaXRBdmFpbGFibGUgJiYgd2FsbGV0QXBwcm92YWxNZXRob2RQcmVmZXJlbmNlID09PSBBcHByb3ZhbE1ldGhvZC5QRVJNSVQ7CgogIGNvbnN0IHVzZVN0YWtlR2F0ZXdheSA9IHN0YWtlRGF0YS51bmRlcmx5aW5nSXNTdGF0YVRva2VuOwoKICBjb25zdCB7CiAgICBkYXRhOiBhcHByb3ZlZEFtb3VudCwKICAgIGlzRmV0Y2hpbmc6IGZldGNoaW5nQXBwcm92ZWRBbW91bnQsCiAgICByZWZldGNoOiBmZXRjaEFwcHJvdmVkQW1vdW50LAogIH0gPSB1c2VBcHByb3ZlZEFtb3VudCh7CiAgICBjaGFpbklkOiBjdXJyZW50Q2hhaW5JZCwKICAgIHRva2VuOiBzZWxlY3RlZFRva2VuLmFkZHJlc3MsCiAgICBzcGVuZGVyOiB1c2VTdGFrZUdhdGV3YXkKICAgICAgPyBzdGFrZVVtYnJlbGxhQ29uZmlnW2N1cnJlbnRNYXJrZXRdPy5iYXRjaEhlbHBlciB8fCAnJwogICAgICA6IHN0YWtlRGF0YS50b2tlbkFkZHJlc3MsCiAgfSk7CgogIHNldExvYWRpbmdUeG5zKGZldGNoaW5nQXBwcm92ZWRBbW91bnQpOwoKICBjb25zdCBhbW91bnRXaXRoTWFyZ2luID0gTnVtYmVyKGFtb3Vub24gPSB1c2VCb29rZXJTdG9yZUNvbnRleHQoKHN0YXRlKSA9PiBzdGF0ZS5zZWxlY3RlZER1cmF0aW9uKTsKICBjb25zdCBkaXNwbGF5T3ZlcmxheSA9CiAgICBnZXRRdWVyeVBhcmFtKCJvdmVybGF5Q2FsZW5kYXIiKSA9PT0gInRydWUiIHx8IGxvY2FsU3RvcmFnZT8uZ2V0SXRlbSgib3ZlcmxheUNhbGVuZGFyU3dpdGNoRGVmYXVsdCIpOwogIGNvbnN0IHsgdGltZXpvbmUgfSA9IHVzZUJvb2tlclRpbWUoKTsKCiAgY29uc3QgZXZlbnREdXJhdGlvbiA9IHNlbGVjdGVkRXZlbnREdXJhdGlvbiB8fCBldmVudD8uZGF0YT8ubGVuZ3RoIHx8IDMwOwoKICBjb25zdCBhdmFpbGFibGVTbG90cyA9IGF2YWlsYWJsZVRpbWVzbG90cyAhPT0gdW5kZWZpbmVkID8gYXZhaWxhYmxlVGltZXNsb3RzIDogdW5kZWZpbmVkOwoKICBjb25zdCBzdGFydERhdGUgPSBzZWxlY3RlZERhdGUgPyBkYXlqcyhzZWxlY3RlZERhdGUpLnRvRGF0ZSgpIDogZGF5anMoKS50b0RhdGUoKTsKICBjb25zdCBlbmREYXRlID0gZGF5anMoc3RhcnREYXRlKQogICAgLmFkZChleHRyYURheXMgLSAxLCAiZGF5IikKICAgIC50b0RhdGUoKTsKCiAgY29uc3QgeyBkYXRhOiBib29raW5ncywgaXNQZW5kaW5nOiBfaXNGZXRjaGluZ0Jvb2tpbmdzIH0gPSB1c2VCb29raW5ncyh7CiAgICB0YWtlOiAxNTAsCiAgICBza2lwOiAwLAogICAgZXZlbnRUeXBlSWQ6IGV2ZW50Py5kYXRhPy5pZCwKICAgIGFmdGVyU3RhcnQ6IHN0YXJ0RGF0ZS50b0lTT1N0cmluZygpLAogICAgYmVmb3JlRW5kOiBlbmREYXRlLnRvSVNPU3RyaW5nKCksCiAgICBzdGF0dXM6IFsidXBjb21pbmciLCAicGFzdCIsICJyZWN1cnJpbmciXSwKICB9KTsKCiAgY29uc3QgeyBkYXRhOiBjb25uZWN0ZWRDYWxlbmRhcnMsIGlzUGVuZGluZzogaXNGZXRjaGluZ0Nvbm5lY3RlZENhbGVuZGFycyB9ID0gdXNlQ29ubmVjdGVkQ2FsZW5kYXJzKHsKICAgIGVuYWJsZWQ6IHRydWUsCiAgfSk7CgogIGNvbnN0IGNhbGVuZGFyc1RvTG9hZCA9IGNvbm5lY3RlZENhbGVuZGFycz8uY29ubmVjdGVkQ2FsZW5kYXJzLmZsYXRNYXAoKGNvbm5lY3RlZENhbGVuZGFyKSA9PiB7CiAgICByZXR1cm4gKAogICAgICBjb25uZWN0ZWRDYWxlbmRhci5jYWxlbmRhcnMKICAgICAgICA/LmZpbHRlcigoY2FsZW5kYXIpID0+IGNhbGVuZGFyLmlzU2VsZWN0ZWQgPT09IHRydWUpCiAgICAgICAgLm1hcCgoY2FsKSA9PiAoewogICAgICAgICAgY3JlZGVudGlhbElkOiBjYWwuY3JlZGVudGlhbElkLAogICAgICAgICAgZXh0ZXJuYWxJZDogY2FsLmV4dGVybmFsSWQsCiAgICAgICAgfSkpID8/IFtdCiAgICApOwogIH0pOwoKICBjb25zdCB7IGRhdGE6IG92ZXJsYXlCdXN5RGF0ZXMgfSA9IHVzZUNhbGVuZGFyc0J1c3lUaW1lcyh7CiAgICBsb2dnZWRJblVzZXJzVHo6IHRpbWV6b25lLAogICAgZGF0ZUZyb206IHN0YXJ0RGF0ZS50b0lTT1N0cmluZygpLAogICAgZGF0ZVRvOiBlbmREYXRlLnRvSVNPU3RyaW5nKCksCiAgICBjYWxlbmRhcnNUb0xvYWQ6IGNhbGVuZGFyc1RvTG9hZCA/PyBbXSwKICAgIGVuYWJsZWQ6IEJvb2xlYW4oIWlzRmV0Y2hpbmdDb25uZWN0ZWRDYWxlbmRhcnMgJiYgISFjYWxlbmRhcnNUb0xvYWQ/Lmxlbmd0aCksCiAgfSk7CgogIC8vIEhBQ0s6IGZvcmNlIHJlcmVuZGVyIHdoZW4gb3ZlcmxheSBldmVudHMgY2hhbmdlCiAgLy8gU2luZSB3ZSBkb250IHVzZSByZWFjdCByb3V0ZXIgaGVyZSB3ZSBuZWVkIHRvIGZvcmNlIHJlcmVuZGVyIChBVE9NIFNVUFBPUlQpCgogIHVzZUVmZmVjdCgoKSA9PiB7fSwgW2Rpc3BsYXlPdmVybGF5XSk7CgogIGNvbnN0IHNvcnRlZEJvb2tpbmdSYW5nZXMgPSB1c2VNZW1vKAogICAgKCkgPT4KICAgICAgKGJvb2tpbmdzID8/IFtdKQogICAgICAgIC5tYXAoKGJvb2tpbmcpID0+ICh7CiAgICAgICAgICBib29raW5nLAogICAgICAgICAgc3RhcnRUaW1lOiBkYXlqcyhib29raW5nLnN0YXJ0KS52YWx1ZU9mKCksCiB0IHsgQXJlYSwgQXJlYUNoYXJ0LCBDYXJ0ZXNpYW5HcmlkLCBYQXhpcyB9IGZyb20gInJlY2hhcnRzIgoKaW1wb3J0IHsKICBDYXJkLAogIENhcmRDb250ZW50LAogIENhcmREZXNjcmlwdGlvbiwKICBDYXJkRm9vdGVyLAogIENhcmRIZWFkZXIsCiAgQ2FyZFRpdGxlLAp9IGZyb20gIkAvcmVnaXN0cnkvbmV3LXlvcmsvdWkvY2FyZCIKaW1wb3J0IHsKICBDaGFydENvbmZpZywKICBDaGFydENvbnRhaW5lciwKICBDaGFydFRvb2x0aXAsCiAgQ2hhcnRUb29sdGlwQ29udGVudCwKfSBmcm9tICJAL3JlZ2lzdHJ5L25ldy15b3JrL3VpL2NoYXJ0IgoKZXhwb3J0IGNvbnN0IGRlc2NyaXB0aW9uID0gIkFuIGFyZWEgY2hhcnQgd2l0aCBncmFkaWVudCBmaWxsIgoKY29uc3QgY2hhcnREYXRhID0gWwogIHsgbW9udGg6ICJKYW51YXJ5IiwgZGVza3RvcDogMTg2LCBtb2JpbGU6IDgwIH0sCiAgeyBtb250aDogIkZlYnJ1YXJ5IiwgZGVza3RvcDogMzA1LCBtb2JpbGU6IDIwMCB9LAogIHsgbW9udGg6ICJNYXJjaCIsIGRlc2t0b3A6IDIzNywgbW9iaWxlOiAxMjAgfSwKICB7IG1vbnRoOiAiQXByaWwiLCBkZXNrdG9wOiA3MywgbW9iaWxlOiAxOTAgfSwKICB7IG1vbnRoOiAiTWF5IiwgZGVza3RvcDogMjA5LCBtb2JpbGU6IDEzMCB9LAogIHsgbW9udGg6ICJKdW5lIiwgZGVza3RvcDogMjE0LCBtb2JpbGU6IDE0MCB9LApdCgpjb25zdCBjaGFydENvbmZpZyA9IHsKICBkZXNrdG9wOiB7CiAgICBsYWJlbDogIkRlc2t0b3AiLAogICAgY29sb3I6ICJoc2wodmFyKC0tY2hhcnQtMSkpIiwKICB9LAogIG1vYmlsZTogewogICAgbGFiZWw6ICJNb2JpbGUiLAogICAgY29sb3I6ICJoc2wodmFyKC0tY2hhcnQtMikpIiwKICB9LAp9IHNhdGlzZmllcyBDaGFydENvbmZpZwoKZXhwb3J0IGRlZmF1bHQgZnVuY3Rpb24gQ29tcG9uZW50KCkgewogIHJldHVybiAoCiAgICA8Q2FyZD4KICAgICAgPENhcmRIZWFkZXI+CiAgICAgICAgPENhcmRUaXRsZT5BcmVhIENoYXJ0IC0gR3JhZGllbnQ8L0NhcmRUaXRsZT4KICAgICAgICA8Q2FyZERlc2NyaXB0aW9uPgogICAgICAgICAgU2hvd2luZyB0b3RhbCB2aXNpdG9ycyBmb3IgdGhlIGxhc3QgNiBtb250aHMKICAgICAgICA8L0NhcmREZXNjcmlwdGlvbj4KICAgICAgPC9DYXJkSGVhZGVyPgogICAgICA8Q2FyZENvbnRlbnQ+CiAgICAgICAgPENoYXJ0Q29udGFpbmVyIGNvbmZpZz17Y2hhcnRDb25maWd9PgogICAgICAgICAgPEFyZWFDaGFydAogICAgICAgICAgICBhY2Nlc3NpYmlsaXR5TGF5ZXIKICAgICAgICAgICAgZGF0YT17Y2hhcnREYXRhfQogICAgICAgICAgICBtYXJnaW49e3sKICAgICAgICAgICAgICBsZWZ0OiAxMiwKICAgICAgICAgICAgICByaWdodDogMTIsCiAgICAgICAgICAgIH19CiAgICAgICAgICA+CiAgICAgICAgICAgIDxDYXJ0ZXNpYW5HcmlkIHZlcnRpY2FsPXtmYWxzZX0gLz4KICAgICAgICAgICAgPFhBeGlzCiAgICAgICAgICAgICAgZGF0YUtleT0ibW9udGgiCiAgICAgICAgICAgICAgdGlja0xpbmU9e2ZhbHNlfQogICAgICAgICAgICAgIGF4aXNMaW5lPXtmYWxzZX0KICAgICAgICAgICAgICB0aWNrTWFyZ2luPXs4fQogICAgICAgICAgICAgIHRpY2tGb3JtYXR0ZXI9eyh2YWx1ZSkgPT4gdmFsdWUuc2xpY2UoMCwgMyl9CiAgICAgICAgICAgIC8+CiAgICAgICAgICAgIDxDaGFydFRvb2x0aXAgY3Vyc29yPXtmYWxzZX0gY29udGVudD17PENoYXJ0VG9vbHRpcENvbnRlbnQgLz59IC8+CiAgICAgICAgICAgIDxkZWZzPgogICAgICAgICAgICAgIDxsaW5lYXJHcmFkaWVudCBpZD0iZmlsbERlc2t0b3AiIHgxPSIwIiB5MT0iMCIgeDI9IjAiIHkyPSIxIj4KICAgICAgICAgICAgICAgIDxzdG9wCiAgICAgICAgICAgICAgICAgIG9mZnNldD0iNSUiCiAgICAgICAgICAgICAgICAgIHN0b3BDb2xvcj0idmFyKC0tY29sb3ItZGVza3RvcCkiCiAgICAgICAgICAgICAgICAgIHN0b3BPcGFjaXR5PXswLjh9CiAgV2l0aExpdmVEb3QKICBpc0hvdmVyaW5nOiBib29sZWFuCiAgY2hhcnRDb250YWluZXI/OiBIVE1MRWxlbWVudCB8IG51bGwKICBvdmVycmlkZUNvbG9yPzogc3RyaW5nCiAgZGF0YUtleT86IHN0cmluZyB8IG51bWJlciAvLyBUcmFja3Mgd2hlbiBjaGFydCBkYXRhIGNoYW5nZXMgKGUuZy4sIHRpbWUgcGVyaW9kIGNoYW5nZSkKfQoKZXhwb3J0IGZ1bmN0aW9uIExpdmVEb3RSZW5kZXJlcih7CiAgY2hhcnRNb2RlbCwKICBpc0hvdmVyaW5nLAogIGNoYXJ0Q29udGFpbmVyLAogIG92ZXJyaWRlQ29sb3IsCiAgZGF0YUtleSwKfTogTGl2ZURvdFJlbmRlcmVyUHJvcHMpIHsKICBjb25zdCBjb2xvcnMgPSB1c2VTcG9yZUNvbG9ycygpCiAgY29uc3QgW2Nvb3JkaW5hdGVzLCBzZXRDb29yZGluYXRlc10gPSB1c2VTdGF0ZTx7IHg6IG51bWJlcjsgeTogbnVtYmVyIH0gfCBudWxsPihudWxsKQogIGNvbnN0IFtpc1Jlc2l6aW5nLCBzZXRJc1Jlc2l6aW5nXSA9IHVzZVN0YXRlKGZhbHNlKQoKICB1c2VFZmZlY3QoKCkgPT4gewogICAgLy8gT25seSByZW5kZXIgaWYgdGhlIGNoYXJ0IG1vZGVsIGhhcyBnZXRMYXN0UG9pbnRDb29yZGluYXRlcyBtZXRob2QKICAgIGlmICghKCdnZXRMYXN0UG9pbnRDb29yZGluYXRlcycgaW4gY2hhcnRNb2RlbCkgfHwgIWRhdGFLZXkpIHsKICAgICAgcmV0dXJuIHVuZGVmaW5lZAogICAgfQoKICAgIGNvbnN0IHVwZGF0ZUNvb3JkaW5hdGVzID0gKCkgPT4gewogICAgICBjb25zdCBjb29yZHMgPSBjaGFydE1vZGVsLmdldExhc3RQb2ludENvb3JkaW5hdGVzPy4oKQogICAgICAvLyBVcGRhdGUgY29vcmRpbmF0ZXMgd2hlbiBkYXRhIGNoYW5nZXMgKGRhdGFLZXkgdHJpZ2dlcnMgdGhpcyBlZmZlY3QpCiAgICAgIHNldENvb3JkaW5hdGVzKGNvb3JkcyA/PyBudWxsKQogICAgfQoKICAgIC8vIFRyeSBpbW1lZGlhdGVseQogICAgdXBkYXRlQ29vcmRpbmF0ZXMoKQoKICAgIC8vIExpc3RlbiB0byBjaGFydCBjb250YWluZXIgcmVzaXplIGV2ZW50cwogICAgbGV0IHJlc2l6ZU9ic2VydmVyOiBSZXNpemVPYnNlcnZlciB8IG51bGwgPSBudWxsCiAgICBsZXQgcmFmSWQ6IG51bWJlciB8IG51bGwgPSBudWxsCgogICAgaWYgKGNoYXJ0Q29udGFpbmVyKSB7CiAgICAgIHJlc2l6ZU9ic2VydmVyID0gbmV3IFJlc2l6ZU9ic2VydmVyKCgpID0+IHsKICAgICAgICAvLyBDYW5jZWwgcGVuZGluZyBSQUYgdG8gcHJldmVudCBtdWx0aXBsZSBjaGFpbnMKICAgICAgICBpZiAocmFmSWQgIT09IG51bGwpIHsKICAgICAgICAgIGNhbmNlbEFuaW1hdGlvbkZyYW1lKHJhZklkKQogICAgICAgIH0KCiAgICAgICAgLy8gSGlkZSBkb3Qgd2hlbiByZXNpemUgc3RhcnRzCiAgICAgICAgc2V0SXNSZXNpemluZyh0cnVlKQoKICAgICAgICAvLyBVc2UgbXVsdGlwbGUgcmVxdWVzdEFuaW1hdGlvbkZyYW1lIGNhbGxzIHRvIGVuc3VyZSBjaGFydCBoYXMgZnVsbHkgcmUtbGFpZCBvdXQsCiAgICAgICAgLy8gaW5jbHVkaW5nIGF4aXMgbGFiZWxzIHdoaWNoIGNhbiBjaGFuZ2UgdGhlIGF2YWlsYWJsZSBjaGFydCBhcmVhCiAgICAgICAgcmFmSWQgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4gewogICAgICAgICAgLy8gUmVmaXQgY2hhcnQgY29udGVudCB0byBwcmV2ZW50IG92ZXJmbG93IG9uIHJlc2l6ZQogICAgICAgICAgLy8gVGhpcyBuZWVkcyB0byBoYXBwZW4gYWZ0ZXIgYXhpcyBsYWJlbHMgaGF2ZSByZW5kZXJlZCBhbmQgbGF5b3V0IGlzIHN0YWJsZQogICAgICAgICAgaWYgKCdmaXRDb250ZW50JyBpbiBjaGFydE1vZGVsICYmIHR5cGVvZiBjaGFydE1vZGVsLmZpdENvbnRlbnQgPT09ICdmdW5jdGlvbicpIHsKICAgICAgICAgICAgY2hhcnRNb2RlbC5maXRDb250ZW50KCkKICAgICAgICAgIH0KICAgICAgICAgIC8vIFdhaXQgb25lIG1vcmUgZnJhbWUgZm9yIGZpdENvbnRlbnQgdG8gdGFrZSBlZmZlY3QgYmVmb3JlIHVwZGF0aW5nIGNvb3JkaW5hdGVzCiAgIHlwZSgpOwogIGNvbnN0IHsgbXV0YXRlOiBkdXBsaWNhdGVFdmVudFR5cGVNdXRhdGlvbiB9ID0gdXNlRHVwbGljYXRlRXZlbnRUeXBlKCk7CgogIC8vIENvbnZlcnQgcXVlcnkgZXJyb3IgdG8gc3RyaW5nCiAgLy8gRG9uJ3Qgc2hvdyBlcnJvciBVSSBmb3IgYXV0aGVudGljYXRpb24gZXJyb3JzICh1c2VyIHdpbGwgYmUgcmVkaXJlY3RlZCB0byBsb2dpbikKICAvLyBPbmx5IHNob3cgZXJyb3IgVUkgaW4gZGV2ZWxvcG1lbnQgbW9kZSBmb3Igb3RoZXIgZXJyb3JzCiAgY29uc3QgaXNBdXRoRXJyb3IgPQogICAgcXVlcnlFcnJvcj8ubWVzc2FnZT8uaW5jbHVkZXMoIkF1dGhlbnRpY2F0aW9uIikgfHwKICAgIHF1ZXJ5RXJyb3I/Lm1lc3NhZ2U/LmluY2x1ZGVzKCJzaWduIGluIikgfHwKICAgIHF1ZXJ5RXJyb3I/Lm1lc3NhZ2U/LmluY2x1ZGVzKCI0MDEiKTsKICBjb25zdCBlcnJvciA9IHF1ZXJ5RXJyb3IgJiYgIWlzQXV0aEVycm9yICYmIF9fREVWX18gPyAiRmFpbGVkIHRvIGxvYWQgZXZlbnQgdHlwZXMuIiA6IG51bGw7CgogIC8vIE5vIG1vZGFsIHN0YXRlIG5lZWRlZCBmb3IgaU9TIC0gdXNpbmcgbmF0aXZlIEFsZXJ0IGZvciBkZWxldGUgY29uZmlybWF0aW9uCgogIC8vIEhhbmRsZSBwdWxsLXRvLXJlZnJlc2ggKG9mZmxpbmUtYXdhcmUpCiAgY29uc3Qgb25SZWZyZXNoID0gKCkgPT4gb2ZmbGluZUF3YXJlUmVmcmVzaChyZWZldGNoKTsKCiAgLy8gRXZlbnQgdHlwZSBmaWx0ZXIgYW5kIHNvcnQgaG9vawogIGNvbnN0IHsKICAgIHNvcnRCeSwKICAgIGZpbHRlcnMsCiAgICBzZXRTb3J0QnksCiAgICB0b2dnbGVGaWx0ZXIsCiAgICByZXNldEZpbHRlcnMsCiAgICBmaWx0ZXJlZEFuZFNvcnRlZEV2ZW50VHlwZXMsCiAgICBhY3RpdmVGaWx0ZXJDb3VudCwKICB9ID0gdXNlRXZlbnRUeXBlRmlsdGVyKCk7CgogIC8vIEZpbHRlciBldmVudCB0eXBlcyBiYXNlZCBvbiBzZWFyY2ggcXVlcnkgYW5kIGZpbHRlci9zb3J0IG9wdGlvbnMKICBjb25zdCBmaWx0ZXJlZEV2ZW50VHlwZXMgPSB1c2VNZW1vKCgpID0+IHsKICAgIC8vIEZpcnN0IGFwcGx5IGZpbHRlci9zb3J0IGZyb20gdGhlIGhvb2sKICAgIGxldCBmaWx0ZXJlZCA9IGZpbHRlcmVkQW5kU29ydGVkRXZlbnRUeXBlcyhldmVudFR5cGVzKTsKCiAgICAvLyBUaGVuIGFwcGx5IHNlYXJjaCBxdWVyeSBmaWx0ZXIKICAgIGlmIChzZWFyY2hRdWVyeS50cmltKCkgIT09ICIiKSB7CiAgICAgIGNvbnN0IHNlYXJjaExvd2VyID0gc2VhcmNoUXVlcnkudG9Mb3dlckNhc2UoKTsKICAgICAgZmlsdGVyZWQgPSBmaWx0ZXJlZC5maWx0ZXIoCiAgICAgICAgKGV2ZW50VHlwZSkgPT4KICAgICAgICAgIGV2ZW50VHlwZS50aXRsZS50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHNlYXJjaExvd2VyKSB8fAogICAgICAgICAgZXZlbnRUeXBlLmRlc2NyaXB0aW9uPy50b0xvd2VyQ2FzZSgpLmluY2x1ZGVzKHNlYXJjaExvd2VyKQogICAgICApOwogICAgfQoKICAgIHJldHVybiBmaWx0ZXJlZDsKICB9LCBbZXZlbnRUeXBlcywgc2VhcmNoUXVlcnksIGZpbHRlcmVkQW5kU29ydGVkRXZlbnRUeXBlc10pOwoKICBjb25zdCBoYW5kbGVTZWFyY2ggPSAocXVlcnk6IHN0cmluZykgPT4gewogICAgc2V0U2VhcmNoUXVlcnkocXVlcnkpOwogIH07CgogIGNvbnN0IGhhbmRsZUV2ZW50VHlwZVByZXNzID0gKGV2ZW50VHlwZTogRXZlbnRUeXBlKSA9PiB7CiAgICBoYW5kbGVFZGl0KGV2ZW50VHlwZSk7CiAgfTsKCiAgY29uc3QgaGFuZGxlQ29weUxpbmsgPSBhc3luYyAoZXZlbnRUeXBlOiBFdmVudFR5cGUpID0+IHsKICAgIGlmICghZXZlbnRUeXBlLmJvb2tpbmdVcmwpIHsKICAgICAgc2hvd0Vycm9yQWxlcnQoIkVycm9yIiwgIkJvb2tpbmcgVVJMIG5vdCBhdmFpbGFibGUgZm9yIHRoaXMgZXZlbnQgdHlwZS4iKTsKICAgICAgcmV0dXJuOwogICAgfQogICAgdHJ5IHsKICAgICAgYXdhaXQgQ2xpcGJvYXJkLnNldFN0cmluZ0FzeW5jKGV2ZW5FbXB0eVRpdGxlLAogIEVtcHR5RGVzY3JpcHRpb24sCiAgRW1wdHlDb250ZW50LAogIEVtcHR5TWVkaWEsCn0KaW1wb3J0ICogYXMgUmVhY3QgZnJvbSAicmVhY3QiCmltcG9ydCB7IGNuIH0gZnJvbSAiQC9leGFtcGxlcy9iYXNlL2xpYi91dGlscyIKaW1wb3J0IHsgU2VwYXJhdG9yIH0gZnJvbSAiQC9leGFtcGxlcy9iYXNlL3VpL3NlcGFyYXRvciIKaW1wb3J0IHsgbWVyZ2VQcm9wcyB9IGZyb20gIkBiYXNlLXVpL3JlYWN0L21lcmdlLXByb3BzIgppbXBvcnQgeyB1c2VSZW5kZXIgfSBmcm9tICJAYmFzZS11aS9yZWFjdC91c2UtcmVuZGVyIgppbXBvcnQgeyBjdmEsIHR5cGUgVmFyaWFudFByb3BzIH0gZnJvbSAiY2xhc3MtdmFyaWFuY2UtYXV0aG9yaXR5IgoKZnVuY3Rpb24gSXRlbUdyb3VwKHsgY2xhc3NOYW1lLCAuLi5wcm9wcyB9OiBSZWFjdC5Db21wb25lbnRQcm9wczwiZGl2Ij4pIHsKICByZXR1cm4gKAogICAgPGRpdgogICAgICByb2xlPSJsaXN0IgogICAgICBkYXRhLXNsb3Q9Iml0ZW0tZ3JvdXAiCiAgICAgIGNsYXNzTmFtZT17Y24oCiAgICAgICAgImdyb3VwL2l0ZW0tZ3JvdXAgZmxleCB3LWZ1bGwgZmxleC1jb2wgZ2FwLTQgaGFzLVtbZGF0YS1zaXplPXNtXV06Z2FwLTIuNSBoYXMtW1tkYXRhLXNpemU9eHNdXTpnYXAtMiIsCiAgICAgICAgY2xhc3NOYW1lCiAgICAgICl9CiAgICAgIHsuLi5wcm9wc30KICAgIC8+CiAgKQp9CgpmdW5jdGlvbiBJdGVtU2VwYXJhdG9yKHsKICBjbGFzc05hbWUsCiAgLi4ucHJvcHMKfTogUmVhY3QuQ29tcG9uZW50UHJvcHM8dHlwZW9mIFNlcGFyYXRvcj4pIHsKICByZXR1cm4gKAogICAgPFNlcGFyYXRvcgogICAgICBkYXRhLXNsb3Q9Iml0ZW0tc2VwYXJhdG9yIgogICAgICBvcmllbnRhdGlvbj0iaG9yaXpvbnRhbCIKICAgICAgY2xhc3NOYW1lPXtjbigibXktMiIsIGNsYXNzTmFtZSl9CiAgICAgIHsuLi5wcm9wc30KICAgIC8+CiAgKQp9Cgpjb25zdCBpdGVtVmFyaWFudHMgPSBjdmEoCiAgIlthXTpob3ZlcjpiZy1tdXRlZCByb3VuZGVkLWxnIGJvcmRlciB0ZXh0LXNtIHctZnVsbCBncm91cC9pdGVtIGZvY3VzLXZpc2libGU6Ym9yZGVyLXJpbmcgZm9jdXMtdmlzaWJsZTpyaW5nLXJpbmcvNTAgZmxleCBpdGVtcy1jZW50ZXIgZmxleC13cmFwIG91dGxpbmUtbm9uZSB0cmFuc2l0aW9uLWNvbG9ycyBkdXJhdGlvbi0xMDAgZm9jdXMtdmlzaWJsZTpyaW5nLVszcHhdIFthXTp0cmFuc2l0aW9uLWNvbG9ycyIsCiAgewogICAgdmFyaWFudHM6IHsKICAgICAgdmFyaWFudDogewogICAgICAgIGRlZmF1bHQ6ICJib3JkZXItdHJhbnNwYXJlbnQiLAogICAgICAgIG91dGxpbmU6ICJib3JkZXItYm9yZGVyIiwKICAgICAgICBtdXRlZDogImJnLW11dGVkLzUwIGJvcmRlci10cmFuc3BhcmVudCIsCiAgICAgIH0sCiAgICAgIHNpemU6IHsKICAgICAgICBkZWZhdWx0OiAiZ2FwLTIuNSBweC0zIHB5LTIuNSIsCiAgICAgICAgc206ICJnYXAtMi41IHB4LTMgcHktMi41IiwKICAgICAgICB4czogImdhcC0yIHB4LTIuNSBweS0yIFtbZGF0YS1zbG90PWRyb3Bkb3duLW1lbnUtY29udGVudF1fJl06cC0wIiwKICAgICAgfSwKICAgIH0sCiAgICBkZWZhdWx0VmFyaWFudHM6IHsKICAgICAgdmFyaWFudDogImRlZmF1bHQiLAogICAgICBzaXplOiAiZGVmYXVsdCIsCiAgICB9LAogIH0KKQoKZnVuY3Rpb24gSXRlbSh7CiAgY2xhc3NOYW1lLAogIHZhcmlhbnQgPSAiZGVmYXVsdCIsCiAgc2l6ZSA9ICJkZWZhdWx0IiwKICByZW5kZXIsCiAgLi4ucHJvcHMKfTogdXNlUmVuZGVyLkNvbXBvbmVudFByb3BzPCJkaXYiPiAmIFZhcmlhbnRQcm9wczx0eXBlb2YgaXRlbVZhcmlhbnRzPikgewogIHJldHVybiB1c2VSZW5kZXIoewogICAgZGVmYXVsdFRhZ05hbWU6ICJkaXYiLAogICAgcHJvcHM6IG1lcmdlUHJvcHM8ImRpdiI+KAogICAgICB7CiAgICAgICAgY2xhc3NOYW1lOiBjbihpdGVtVmFyaWFudHMoeyB2YXJpYW50LCBzaXplLCBjcmVhdGVDb250ZXh0PHsKICBzaGFkb3dSb290OiBTaGFkb3dSb290CiAgc3RhdGU6IE92ZXJsYXlTdGF0ZSAmIHsKICAgIHJvdXRlclR5cGU6ICdwYWdlcycgfCAnYXBwJwogIH0KICBkaXNwYXRjaDogQWN0aW9uRGlzcGF0Y2g8W2FjdGlvbjogRGlzcGF0Y2hlckV2ZW50XT4KICBnZXRTcXVhc2hlZEh5ZHJhdGlvbkVycm9yRGV0YWlsczogKGVycm9yOiBFcnJvcikgPT4gSHlkcmF0aW9uRXJyb3JTdGF0ZSB8IG51bGwKfT4obnVsbCEpCmV4cG9ydCBjb25zdCB1c2VEZXZPdmVybGF5Q29udGV4dCA9ICgpID0+IHVzZUNvbnRleHQoRGV2T3ZlcmxheUNvbnRleHQpCgpsZXQgaXNQYWdlc01vdW50ZWQgPSBmYWxzZQpsZXQgaXNBcHBNb3VudGVkID0gZmFsc2UKCmZ1bmN0aW9uIGdldFNxdWFzaGVkSHlkcmF0aW9uRXJyb3JEZXRhaWxzQXBwKCkgewogIC8vIFdlIGRvbid0IHNxdWFzaCBoeWRyYXRpb24gZXJyb3JzIGluIHRoZSBBcHAgUm91dGVyLgogIHJldHVybiBudWxsCn0KCmV4cG9ydCBmdW5jdGlvbiByZW5kZXJBcHBEZXZPdmVybGF5KAogIGdldE93bmVyU3RhY2s6IChlcnJvcjogRXJyb3IpID0+IHN0cmluZyB8IG51bGwgfCB1bmRlZmluZWQsCiAgaXNSZWNvdmVyYWJsZUVycm9yOiAoZXJyb3I6IEVycm9yKSA9PiBib29sZWFuLAogIGVuYWJsZUNhY2hlSW5kaWNhdG9yOiBib29sZWFuCik6IHZvaWQgewogIGlmIChpc1BhZ2VzTW91bnRlZCkgewogICAgLy8gU3dpdGNoaW5nIGJldHdlZW4gQXBwIGFuZCBQYWdlcyBSb3V0ZXIgaXMgYWx3YXlzIGEgaGFyZCBuYXZpZ2F0aW9uCiAgICAvLyBUT0RPOiBTdXBwb3J0IHNvZnQgbmF2aWdhdGlvbiBiZXR3ZWVuIEFwcCBhbmQgUGFnZXMgUm91dGVyCiAgICB0aHJvdyBuZXcgRXJyb3IoCiAgICAgICdOZXh0IERldlRvb2xzOiBQYWdlcyBEZXYgT3ZlcmxheSBpcyBhbHJlYWR5IG1vdW50ZWQuIFRoaXMgaXMgYSBidWcgaW4gTmV4dC5qcycKICAgICkKICB9CgogIGlmICghaXNBcHBNb3VudGVkKSB7CiAgICAvLyBSZWFjdCAxOSB3aWxsIG5vdCB0aHJvdyBhd2F5IGA8c2NyaXB0PmAgZWxlbWVudHMgaW4gYSBjb250YWluZXIgaXQgb3ducy4KICAgIC8vIFRoaXMgZW5zdXJlcyB0aGUgYWN0dWFsIHVzZXItc3BhY2UgUmVhY3QgZG9lcyBub3QgdW5tb3VudCB0aGUgRGV2IE92ZXJsYXkuCiAgICBjb25zdCBzY3JpcHQgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdzY3JpcHQnKQogICAgc2NyaXB0LnN0eWxlLmRpc3BsYXkgPSAnYmxvY2snCiAgICAvLyBBbHRob3VnaCB0aGUgc3R5bGUgYXBwbGllZCB0byB0aGUgc2hhZG93IGhvc3QgaXMgaXNvbGF0ZWQsCiAgICAvLyB0aGUgZWxlbWVudCB0aGF0IGF0dGFjaGVkIHRoZSBzaGFkb3cgaG9zdCAoaS5lLiAic2NyaXB0IikKICAgIC8vIGlzIHN0aWxsIGFmZmVjdGVkIGJ5IHRoZSBwYXJlbnQncyBzdHlsZSAoZS5nLiAiYm9keSIpLiBUaGlzIG1heQogICAgLy8gb2NjdXIgc3R5bGUgY29uZmxpY3RzIGxpa2UgImRpc3BsYXk6IGZsZXgiLCB3aXRoIG90aGVyIGNoaWxkcmVuCiAgICAvLyBlbGVtZW50cyB0aGVyZWZvcmUgZ2l2ZSB0aGUgc2hhZG93IGhvc3QgYW4gYWJzb2x1dGUgcG9zaXRpb24uCiAgICBzY3JpcHQuc3R5bGUucG9zaXRpb24gPSAnYWJzb2x1dGUnCiAgICBzY3JpcHQuc2V0QXR0cmlidXRlKCdkYXRhLW5leHRqcy1kZXYtb3ZlcmxheScsICd0cnVlJykKCiAgICBjb25zdCBjb250YWluZXIgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCduZXh0anMtcG9ydGFsJykKCiAgICBzY3JpcHQuYXBwZW5kQ2hpbGQoY29udGFpbmVyKQogICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChzY3JpcHQpCgogICAgY29uc3Qgcm9vdCA9IGNyZWF0ZVJvb3QoY29udGFpbmVyLCB7CiAgICAgIGlkZW50aWZpZXJQcmVmaXg6ICduZHQtJywKICAgICAgLy8gV2UgZG9uJ3QgaGF2ZSBkZXNpZ24gZm9yIGEgZGVmYXVsdCBUcmFuc2l0aW9uIGluZGljYXRvciBmb3IgdGhlIE5EVCBmckVuYWJsZWQgPSB1c2VGZWF0dXJlRmxhZyhGZWF0dXJlRmxhZ3MuVW5pc3dhcFdyYXBwZWQyMDI1KQogIGNvbnN0IGlzRGlzbWlzc2VkID0gdXNlQXBwU2VsZWN0b3Ioc2VsZWN0SGFzRGlzbWlzc2VkVW5pc3dhcFdyYXBwZWQyMDI1QmFubmVyKQogIGNvbnN0IHsgdCB9ID0gdXNlVHJhbnNsYXRpb24oKQogIGNvbnN0IG5hdmlnYXRlID0gdXNlTmF2aWdhdGUoKQogIGNvbnN0IGRpc3BhdGNoID0gdXNlQXBwRGlzcGF0Y2goKQoKICBjb25zdCBoYW5kbGVQcmVzcyA9IHVzZUNhbGxiYWNrKCgpID0+IHsKICAgIGRpc3BhdGNoKHNldEhhc0Rpc21pc3NlZFVuaXN3YXBXcmFwcGVkMjAyNUJhbm5lcih0cnVlKSkKICAgIG5hdmlnYXRlKFdSQVBQRURfUEFUSCkKICB9LCBbZGlzcGF0Y2gsIG5hdmlnYXRlXSkKCiAgcmV0dXJuICgKICAgIGlzVW5pc3dhcFdyYXBwZWQyMDI1RW5hYmxlZCAmJgogICAgaXNEaXNtaXNzZWQgJiYgKAogICAgICA8PgogICAgICAgIDxzdHlsZT57c25vd2ZsYWtlSG92ZXJLZXlmcmFtZXN9PC9zdHlsZT4KICAgICAgICA8VG9vbHRpcCBwbGFjZW1lbnQ9ImJvdHRvbSIgb2Zmc2V0PXt7IG1haW5BeGlzOiA4IH19IGRlbGF5PXt7IG9wZW46IDMwMCB9fT4KICAgICAgICAgIDxUb29sdGlwLlRyaWdnZXI+CiAgICAgICAgICAgIDxUZXh0CiAgICAgICAgICAgICAgY2xhc3NOYW1lPSJzbm93Zmxha2UtaWNvbiIKICAgICAgICAgICAgICBjb2xvcj0iJG5ldXRyYWwyIgogICAgICAgICAgICAgIGhvdmVyU3R5bGU9e3sgY29sb3I6ICckYWNjZW50MScgfX0KICAgICAgICAgICAgICBoZWlnaHQ9IiRzcGFjaW5nMjQiCiAgICAgICAgICAgICAgb25QcmVzcz17aGFuZGxlUHJlc3N9CiAgICAgICAgICAgID4KICAgICAgICAgICAgICA8U25vd2ZsYWtlIHNpemU9IiRpY29uLjI0IiBjb2xvcj0iaW5oZXJpdCIgLz4KICAgICAgICAgICAgPC9UZXh0PgogICAgICAgICAgPC9Ub29sdGlwLlRyaWdnZXI+CiAgICAgICAgICA8VG9vbHRpcC5Db250ZW50IHpJbmRleD17ekluZGV4ZXMub3ZlcmxheX0gZGlzcGxheT17aXNNb2JpbGVXZWIgPyAnbm9uZScgOiAnZmxleCd9PgogICAgICAgICAgICA8VG9vbHRpcC5BcnJvdyAvPgogICAgICAgICAgICA8RmxleCBjZW50ZXJlZD4KICAgICAgICAgICAgICA8VGV4dCB2YXJpYW50PSJidXR0b25MYWJlbDQiIGNvbG9yPSIkYWNjZW50MSI+CiAgICAgICAgICAgICAgICB7dCgnaG9tZS5iYW5uZXIudW5pc3dhcFdyYXBwZWQyMDI1LnRpdGxlJyl9CiAgICAgICAgICAgICAgPC9UZXh0PgogICAgICAgICAgICAgIDxUZXh0IHZhcmlhbnQ9ImJvZHk0IiBjb2xvcj0iJG5ldXRyYWwyIj4KICAgICAgICAgICAgICAgIHt0KCdob21lLmJhbm5lci51bmlzd2FwV3JhcHBlZDIwMjUuc3VidGl0bGUnKX0KICAgICAgICAgICAgICA8L1RleHQ+CiAgICAgICAgICAgIDwvRmxleD4KICAgICAgICAgIDwvVG9vbHRpcC5Db250ZW50PgogICAgICAgIDwvVG9vbHRpcD4KICAgICAgPC8+CiAgICApCiAgKQp9CmltcG9ydCB7IFBhdGgsIFN2ZyB9IGZyb20gJ3JlYWN0LW5hdGl2ZS1zdmcnCgovLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgbm8tcmVsYXRpdmUtaW1wb3J0LXBhdGhzL25vLXJlbGF0aXZlLWltcG9ydC1wYXRocwppbXBvcnQgeyBjcmVhdGVJY29uIH0gZnJvbSAnLi4vZmFjdG9yaWVzL2NyZWF0ZUljb24nCgpleHBvcnQgY29uc3QgW1NodWZmbGUsIEFuaW1hdGVkU2h1ZmZsZV0gPSBjcmVhdGVJY29uKHsKICBuYW1lOiAnU2h1ZmZsZScsCiAgZ2V0SWNvbjogKHByb3BzKSA9PiAoCiAgICA8U3ZnIHZpZXdCb3g9IjAgMCAyMCAyMCIgZmlsbD0ibm9uZSIgey4uLnByb3BzfT4KICAgICAgPFBhdGgKICAgICAgICBkPSJNMTguMjY5IDE0LjQ4NUMxOC4yMjY1IDE0LjU4NzUgMTguMTY1NyAxNC42NzkxIDE4LjA4ODIgMTQuNzU2NkwxNi40MjI0IDE2LjQyMjRDMTYuMjU5OSAxNi41ODQ5IDE2LjA0NjUgMTYuNjY2NiAxNS44MzMyIDE2LjZpbmVDaGFydERvdHN9CiAgICAgICAgICAgICAgICB0aXRsZT17dCgnc2V0dGluZ3Muc2V0dGluZy5wZXJtaXNzaW9ucy50aXRsZScpfQogICAgICAgICAgICAgICAgb25QcmVzcz17KCk6IHZvaWQgPT4gc2V0SXNQZXJtaXNzaW9uc01vZGFsT3Blbih0cnVlKX0KICAgICAgICAgICAgICAvPgogICAgICAgICAgICA8L1NldHRpbmdzU2VjdGlvbj4KICAgICAgICAgIDwvRmxleD4KICAgICAgICAgIDxGbGV4IHB0PSIkcGFkZGluZzE2Ij4KICAgICAgICAgICAgPFNldHRpbmdzU2VjdGlvbiB0aXRsZT17dCgnc2V0dGluZ3Muc2VjdGlvbi5zdXBwb3J0Jyl9PgogICAgICAgICAgICAgIDxTZXR0aW5nc0l0ZW0KICAgICAgICAgICAgICAgIEljb249e0hlbHBDZW50ZXJ9CiAgICAgICAgICAgICAgICB0aXRsZT17dCgnc2V0dGluZ3Muc2V0dGluZy5oZWxwQ2VudGVyLnRpdGxlJyl9CiAgICAgICAgICAgICAgICB1cmw9e3VuaXN3YXBVcmxzLmhlbHBBcnRpY2xlVXJscy5leHRlbnNpb25IZWxwfQogICAgICAgICAgICAgICAgUmlnaHRJY29uPXtBcnJvd1VwUmlnaHR9CiAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgICA8VGV4dAogICAgICAgICAgICAgICAgY29sb3I9IiRuZXV0cmFsMyIKICAgICAgICAgICAgICAgIHB4PSIkc3BhY2luZzEyIgogICAgICAgICAgICAgICAgcHk9IiRzcGFjaW5nNCIKICAgICAgICAgICAgICAgIHZhcmlhbnQ9ImJvZHk0IgogICAgICAgICAgICAgID57YFZlcnNpb24gJHttYW5pZmVzdFZlcnNpb259YH08L1RleHQ+CiAgICAgICAgICAgIDwvU2V0dGluZ3NTZWN0aW9uPgogICAgICAgICAgPC9GbGV4PgogICAgICAgIDwvU2Nyb2xsVmlldz4KICAgICAgICA8RmxleCByb3c+CiAgICAgICAgICA8QnV0dG9uIGljb249ezxMb2NrIC8+fSBlbXBoYXNpcz0ic2Vjb25kYXJ5IiBvblByZXNzPXtvblByZXNzTG9ja1dhbGxldH0+CiAgICAgICAgICAgIHt0KCdzZXR0aW5ncy5hY3Rpb24ubG9jaycpfQogICAgICAgICAgPC9CdXR0b24+CiAgICAgICAgPC9GbGV4PgogICAgICA8L0ZsZXg+CiAgICA8L1RyYWNlPgogICkKfQppbXBvcnQgeyBPcmRlclN0YXR1cyB9IGZyb20gJ0Bjb3dwcm90b2NvbC9jb3ctc2RrJzsKaW1wb3J0IHsgVHJhbnMgfSBmcm9tICdAbGluZ3VpL21hY3JvJzsKaW1wb3J0IEFycm93T3V0d2FyZCBmcm9tICdAbXVpL2ljb25zLW1hdGVyaWFsL0Fycm93T3V0d2FyZCc7CmltcG9ydCB7IEJveCwgQnV0dG9uLCBTdmdJY29uLCBUeXBvZ3JhcGh5LCB1c2VUaGVtZSB9IGZyb20gJ0BtdWkvbWF0ZXJpYWwnOwppbXBvcnQgUmVhY3QsIHsgdXNlRWZmZWN0LCB1c2VTdGF0ZSB9IGZyb20gJ3JlYWN0JzsKaW1wb3J0IHsgTGlzdEl0ZW0gfSBmcm9tICdzcmMvY29tcG9uZW50cy9saXN0cy9MaXN0SXRlbSc7CmltcG9ydCB7IHVzZU1vZGFsQ29udGV4dCB9IGZyb20gJ3NyYy9ob29rcy91c2VNb2RhbCc7CmltcG9ydCB7IHVzZVJvb3RTdG9yZSB9IGZyb20gJ3NyYy9zdG9yZS9yb290JzsKaW1wb3J0IHsgR0VORVJBTCB9IGZyb20gJ3NyYy91dGlscy9ldmVudHMnOwppbXBvcnQgeyB1c2VTaGFsbG93IH0gZnJvbSAnenVzdGFuZC9zaGFsbG93JzsKCmltcG9ydCB7IEFjdGlvbkRldGFpbHMsIEFjdGlvblRleHRNYXAgfSBmcm9tICcuL2FjdGlvbnMvQWN0aW9uRGV0YWlscyc7CmltcG9ydCB7IGdldEV4cGxvcmVyTGluaywgZ2V0VHJhbnNhY3Rpb25BY3Rpb24sIHVuaXhUaW1lc3RhbXBUb0Zvcm1hdHRlZFRpbWUgfSBmcm9tICcuL2hlbHBlcnMnOwppbXBvcnQgewogIEFjdGlvbk5hbWUsCiAgaXNDb3dTd2FwU3Vic2V0LAogIGlzU3dhcFRyYW5zYWN0aW9uLAogIFRyYW5zYWN0aW9uSGlzdG9yeUl0ZW1VbmlvbiwKfSBmcm9tICcuL3R5cGVzJzsKCmZ1bmN0aW9uIEFjdGlvblRpdGxlKHsgYWN0aW9uIH06IHsgYWN0aW9uOiBBY3Rpb25OYW1lIH0pIHsKICByZXR1cm4gKAogICAgPFR5cG9ncmFwaHkgdmFyaWFudD0ic3ViaGVhZGVyMiIgY29sbnRlciBwYi0wIj4KICAgICAgICA8Q2FyZFRpdGxlPlJhZGlhbCBDaGFydCAtIExhYmVsPC9DYXJkVGl0bGU+CiAgICAgICAgPENhcmREZXNjcmlwdGlvbj5KYW51YXJ5IC0gSnVuZSAyMDI0PC9DYXJkRGVzY3JpcHRpb24+CiAgICAgIDwvQ2FyZEhlYWRlcj4KICAgICAgPENhcmRDb250ZW50IGNsYXNzTmFtZT0iZmxleC0xIHBiLTAiPgogICAgICAgIDxDaGFydENvbnRhaW5lcgogICAgICAgICAgY29uZmlnPXtjaGFydENvbmZpZ30KICAgICAgICAgIGNsYXNzTmFtZT0ibXgtYXV0byBhc3BlY3Qtc3F1YXJlIG1heC1oLVsyNTBweF0iCiAgICAgICAgPgogICAgICAgICAgPFJhZGlhbEJhckNoYXJ0CiAgICAgICAgICAgIGRhdGE9e2NoYXJ0RGF0YX0KICAgICAgICAgICAgc3RhcnRBbmdsZT17LTkwfQogICAgICAgICAgICBlbmRBbmdsZT17MzgwfQogICAgICAgICAgICBpbm5lclJhZGl1cz17MzB9CiAgICAgICAgICAgIG91dGVyUmFkaXVzPXsxMTB9CiAgICAgICAgICA+CiAgICAgICAgICAgIDxDaGFydFRvb2x0aXAKICAgICAgICAgICAgICBjdXJzb3I9e2ZhbHNlfQogICAgICAgICAgICAgIGNvbnRlbnQ9ezxDaGFydFRvb2x0aXBDb250ZW50IGhpZGVMYWJlbCBuYW1lS2V5PSJicm93c2VyIiAvPn0KICAgICAgICAgICAgLz4KICAgICAgICAgICAgPFJhZGlhbEJhciBkYXRhS2V5PSJ2aXNpdG9ycyIgYmFja2dyb3VuZD4KICAgICAgICAgICAgICA8TGFiZWxMaXN0CiAgICAgICAgICAgICAgICBwb3NpdGlvbj0iaW5zaWRlU3RhcnQiCiAgICAgICAgICAgICAgICBkYXRhS2V5PSJicm93c2VyIgogICAgICAgICAgICAgICAgY2xhc3NOYW1lPSJmaWxsLXdoaXRlIGNhcGl0YWxpemUgbWl4LWJsZW5kLWx1bWlub3NpdHkiCiAgICAgICAgICAgICAgICBmb250U2l6ZT17MTF9CiAgICAgICAgICAgICAgLz4KICAgICAgICAgICAgPC9SYWRpYWxCYXI+CiAgICAgICAgICA8L1JhZGlhbEJhckNoYXJ0PgogICAgICAgIDwvQ2hhcnRDb250YWluZXI+CiAgICAgIDwvQ2FyZENvbnRlbnQ+CiAgICAgIDxDYXJkRm9vdGVyIGNsYXNzTmFtZT0iZmxleC1jb2wgZ2FwLTIgdGV4dC1zbSI+CiAgICAgICAgPGRpdiBjbGFzc05hbWU9ImZsZXggaXRlbXMtY2VudGVyIGdhcC0yIGZvbnQtbWVkaXVtIGxlYWRpbmctbm9uZSI+CiAgICAgICAgICBUcmVuZGluZyB1cCBieSA1LjIlIHRoaXMgbW9udGggPFRyZW5kaW5nVXAgY2xhc3NOYW1lPSJoLTQgdy00IiAvPgogICAgICAgIDwvZGl2PgogICAgICAgIDxkaXYgY2xhc3NOYW1lPSJsZWFkaW5nLW5vbmUgdGV4dC1tdXRlZC1mb3JlZ3JvdW5kIj4KICAgICAgICAgIFNob3dpbmcgdG90YWwgdmlzaXRvcnMgZm9yIHRoZSBsYXN0IDYgbW9udGhzCiAgICAgICAgPC9kaXY+CiAgICAgIDwvQ2FyZEZvb3Rlcj4KICAgIDwvQ2FyZD4KICApCn0KInVzZSBjbGllbnQiOwoKaW1wb3J0IHR5cGUgeyBSZWFjdE5vZGUgfSBmcm9tICJyZWFjdCI7CgppbXBvcnQgeyB1c2VMb2NhbGUgfSBmcm9tICJAY2FsY29tL2xpYi9ob29rcy91c2VMb2NhbGUiOwoKaW1wb3J0IHsgQXZhdGFyIH0gZnJvbSAiQGNhbGNvbS91aS9jb21wb25lbnRzL2F2YXRhciI7CmltcG9ydCB7IEJhZGdlIH0gZnJvbSAiQGNhbGNvbS91aS9jb21wb25lbnRzL2JhZGdlIjsKaW1wb3J0IHsgSWNvbiB9IGZyb20gIkBjYWxjb20vdWkvY29tcG9uZW50cy9pY29uIjsKCmltcG9ydCB0eXBlIHsgT0F1dGhDbGllbnREZXRhaWxzIH0gZnJvbSAiLi92aWV3L09BdXRoQ2xpZW50RGV0YWlsc0RpYWxvZyI7Cgpjb25zdCBnZXRTdGF0dXNCYWRnZSA9IChzdGF0dXM6IHN0cmluZywgdDogKGtleTogc3RyaW5nKSA9PiBzdHJpbmcpOiBSZWFjdE5vZGUgPT4gewogIHN3aXRjaCAoc3RhdHVzKSB7CiAgICBjYXNlICJBUFBST1ZFRCI6CiAgICAgIHJldHVybiA8QmFkZ2UgdmFyaWFudD0ic3VjY2VzcyI+e3QoImFwcHJvdmVkIil9PC9CYWRnZT47CiAgICBjYXNlICJSRUpFQ1RFRCI6CiBmb3JtU2NoZW1hID0gei5vYmplY3QoewogIHJlc3BvbnNlczogei5ib29sZWFuKCksCiAgdGFza3M6IHoKICAgIC5hcnJheSh6LnN0cmluZygpKQogICAgLm1pbigxLCAiUGxlYXNlIHNlbGVjdCBhdCBsZWFzdCBvbmUgbm90aWZpY2F0aW9uIHR5cGUuIikKICAgIC5yZWZpbmUoCiAgICAgICh2YWx1ZSkgPT4gdmFsdWUuZXZlcnkoKHRhc2spID0+IHRhc2tzLnNvbWUoKHQpID0+IHQuaWQgPT09IHRhc2spKSwKICAgICAgewogICAgICAgIG1lc3NhZ2U6ICJJbnZhbGlkIG5vdGlmaWNhdGlvbiB0eXBlIHNlbGVjdGVkLiIsCiAgICAgIH0KICAgICksCn0pCgpleHBvcnQgZGVmYXVsdCBmdW5jdGlvbiBGb3JtUmhmQ2hlY2tib3goKSB7CiAgY29uc3QgZm9ybSA9IHVzZUZvcm08ei5pbmZlcjx0eXBlb2YgZm9ybVNjaGVtYT4+KHsKICAgIHJlc29sdmVyOiB6b2RSZXNvbHZlcihmb3JtU2NoZW1hKSwKICAgIGRlZmF1bHRWYWx1ZXM6IHsKICAgICAgcmVzcG9uc2VzOiB0cnVlLAogICAgICB0YXNrczogW10sCiAgICB9LAogIH0pCgogIGZ1bmN0aW9uIG9uU3VibWl0KGRhdGE6IHouaW5mZXI8dHlwZW9mIGZvcm1TY2hlbWE+KSB7CiAgICB0b2FzdCgiWW91IHN1Ym1pdHRlZCB0aGUgZm9sbG93aW5nIHZhbHVlczoiLCB7CiAgICAgIGRlc2NyaXB0aW9uOiAoCiAgICAgICAgPHByZSBjbGFzc05hbWU9ImJnLWNvZGUgdGV4dC1jb2RlLWZvcmVncm91bmQgbXQtMiB3LVszMjBweF0gb3ZlcmZsb3cteC1hdXRvIHJvdW5kZWQtbWQgcC00Ij4KICAgICAgICAgIDxjb2RlPntKU09OLnN0cmluZ2lmeShkYXRhLCBudWxsLCAyKX08L2NvZGU+CiAgICAgICAgPC9wcmU+CiAgICAgICksCiAgICAgIHBvc2l0aW9uOiAiYm90dG9tLXJpZ2h0IiwKICAgICAgY2xhc3NOYW1lczogewogICAgICAgIGNvbnRlbnQ6ICJmbGV4IGZsZXgtY29sIGdhcC0yIiwKICAgICAgfSwKICAgICAgc3R5bGU6IHsKICAgICAgICAiLS1ib3JkZXItcmFkaXVzIjogImNhbGModmFyKC0tcmFkaXVzKSAgKyA0cHgpIiwKICAgICAgfSBhcyBSZWFjdC5DU1NQcm9wZXJ0aWVzLAogICAgfSkKICB9CgogIHJldHVybiAoCiAgICA8Q2FyZCBjbGFzc05hbWU9InctZnVsbCBzbTptYXgtdy1tZCI+CiAgICAgIDxDYXJkSGVhZGVyPgogICAgICAgIDxDYXJkVGl0bGU+Tm90aWZpY2F0aW9uczwvQ2FyZFRpdGxlPgogICAgICAgIDxDYXJkRGVzY3JpcHRpb24+TWFuYWdlIHlvdXIgbm90aWZpY2F0aW9uIHByZWZlcmVuY2VzLjwvQ2FyZERlc2NyaXB0aW9uPgogICAgICA8L0NhcmRIZWFkZXI+CiAgICAgIDxDYXJkQ29udGVudD4KICAgICAgICA8Zm9ybSBpZD0iZm9ybS1yaGYtY2hlY2tib3giIG9uU3VibWl0PXtmb3JtLmhhbmRsZVN1Ym1pdChvblN1Ym1pdCl9PgogICAgICAgICAgPEZpZWxkR3JvdXA+CiAgICAgICAgICAgIDxDb250cm9sbGVyCiAgICAgICAgICAgICAgbmFtZT0icmVzcG9uc2VzIgogICAgICAgICAgICAgIGNvbnRyb2w9e2Zvcm0uY29udHJvbH0KICAgICAgICAgICAgICByZW5kZXI9eyh7IGZpZWxkLCBmaWVsZFN0YXRlIH0pID0+ICgKICAgICAgICAgICAgICAgIDxGaWVsZFNldCBkYXRhLWludmFsaWQ9e2ZpZWxkU3RhdGUuaW52YWxpZH0+CiAgICAgICAgICAgICAgICAgIDxGaWVsZExlZ2VuZCB2YXJpYW50PSJsYWJlbCI+UmVzcG9uc2VzPC9GaWVsZExlZ2VuZD4KICAgICAgICAgICAgICAgICAgPEZpZWxkRGVzY3JpcHRpb24+CiAgICAgICAgICAgICAgICAgICAgR2V0IG5vdGlmaWVkIGZvciByZXF1ZXN0cyB0aGF0IHRha2UgdGltZSwgbGlrZSByZXNlYXJjaCBvcgogICAgICAgICAgICAgICAgICAgIGltYWdlIGdlbmVyYXRpb24uCiAgICAgICAgICAgICAgICAgIDwvRmllbGREZXNjcmlwdGlvbj4KICAgICAgICAgICAgICAgICAgPEZpZWxkR3JvdXAgZGF0YS1zbG90PSJjaGVja2JveC1ncm91cCI+CiAgICAgICAgICAgICAgICAgICAgPEZpZWxkIG9yaWVudGF0aW9uPSJob3Jpem9udGFsIj4KICAgICAgPFN0YWtlQWN0aW9uQm94CiAgICAgICAgICB0aXRsZT17PFRyYW5zPkNsYWltYWJsZSBBQVZFPC9UcmFucz59CiAgICAgICAgICB2YWx1ZT17Zm9ybWF0RXRoZXIoc3Rha2VVc2VyRGF0YT8udXNlckluY2VudGl2ZXNUb0NsYWltIHx8ICcwJyl9CiAgICAgICAgICB2YWx1ZVVTRD17Y2xhaW1hYmxlVVNEfQogICAgICAgICAgYm90dG9tTGluZVRpdGxlPXs8PjwvPn0KICAgICAgICAgIGRhdGFDeT17YHJld2FyZEJveF8ke3N0YWtlZFRva2VufWB9CiAgICAgICAgICBib3R0b21MaW5lQ29tcG9uZW50PXs8Qm94IHN4PXt7IGhlaWdodDogJzE5cHgnIH19IC8+fQogICAgICAgID4KICAgICAgICAgIDxCb3gKICAgICAgICAgICAgc3g9e3sKICAgICAgICAgICAgICBkaXNwbGF5OiAnZmxleCcsCiAgICAgICAgICAgICAgZmxleERpcmVjdGlvbjogeyBzbTogJ3JvdycsIHhzOiAnY29sdW1uJyB9LAogICAgICAgICAgICAgIGp1c3RpZnlDb250ZW50OiAnc3BhY2UtYmV0d2VlbicsCiAgICAgICAgICAgIH19CiAgICAgICAgICA+CiAgICAgICAgICAgIDxCdXR0b24KICAgICAgICAgICAgICB2YXJpYW50PSJjb250YWluZWQiCiAgICAgICAgICAgICAgb25DbGljaz17b25TdGFrZVJld2FyZENsYWltQWN0aW9ufQogICAgICAgICAgICAgIGRpc2FibGVkPXtzdGFrZVVzZXJEYXRhPy51c2VySW5jZW50aXZlc1RvQ2xhaW0gPT09ICcwJ30KICAgICAgICAgICAgICBkYXRhLWN5PXtgY2xhaW1CdG5fJHtzdGFrZWRUb2tlbn1gfQogICAgICAgICAgICAgIHN4PXt7CiAgICAgICAgICAgICAgICBmbGV4OiAxLAogICAgICAgICAgICAgICAgbWI6IHsgeHM6IDIsIHNtOiAwIH0sCiAgICAgICAgICAgICAgICBtcjogeyB4czogMCwgc206IDEgfSwKICAgICAgICAgICAgICB9fQogICAgICAgICAgICA+CiAgICAgICAgICAgICAgPFRyYW5zPkNsYWltPC9UcmFucz4KICAgICAgICAgICAgPC9CdXR0b24+CiAgICAgICAgICA8L0JveD4KICAgICAgICA8L1N0YWtlQWN0aW9uQm94PgogICAgICA8L1N0YWNrPgogICAgICB7Y2hpbGRyZW59CiAgICA8L1BhcGVyPgogICk7Cn07CmltcG9ydCB7IHVzZUN1cnJlbmN5IH0gZnJvbSAnaG9va3MvVG9rZW5zJwppbXBvcnQgeyBTZW5kRm9ybSwgU2VuZEZvcm1Qcm9wcyB9IGZyb20gJ3BhZ2VzL1N3YXAvU2VuZC9TZW5kRm9ybScKaW1wb3J0IHsgdXNlTWVtbyB9IGZyb20gJ3JlYWN0JwppbXBvcnQgeyB1c2VUcmFuc2xhdGlvbiB9IGZyb20gJ3JlYWN0LWkxOG5leHQnCmltcG9ydCB7IHVzZVNlYXJjaFBhcmFtcyB9IGZyb20gJ3JlYWN0LXJvdXRlcicKaW1wb3J0IHsgU2VuZENvbnRleHRQcm92aWRlciB9IGZyb20gJ3N0YXRlL3NlbmQvU2VuZENvbnRleHQnCmltcG9ydCB7IFN3YXBBbmRMaW1pdENvbnRleHQgfSBmcm9tICdzdGF0ZS9zd2FwL3R5cGVzJwppbXBvcnQgeyBGbGV4LCBNb2RhbENsb3NlSWNvbiwgVGV4dCB9IGZyb20gJ3VpL3NyYycKaW1wb3J0IHsgTW9kYWwgfSBmcm9tICd1bmlzd2FwL3NyYy9jb21wb25lbnRzL21vZGFscy9Nb2RhbCcKaW1wb3J0IHsgbmF0aXZlT25DaGFpbiB9IGZyb20gJ3VuaXN3YXAvc3JjL2NvbnN0YW50cy90b2tlbnMnCmltcG9ydCB7IFVuaXZlcnNlQ2hhaW5JZCB9IGZyb20gJ3VuaXN3YXAvc3JjL2ZlYXR1cmVzL2NoYWlucy90eXBlcycKaW1wb3J0IHsgSW50ZXJmYWNlUGFnZU5hbWUsIE1vZGFsTmFtZSB9IGZyb20gJ3VuaXN3YXAvc3JjL2ZlYXR1cmVzL3RlbGVtZXRyeS9jb25zdGFudHMnCmltcG9ydCBUcmFjZSBmcm9tICd1bmlzd2FwL3NyYy9mZWF0dXJlcy90ZWxlbWV0cnkvVHJhY2UnCmltcG9ydCB7IFRyYW5zYWN0aW9uTW9kYWwgfSBmcm9tICd1bmlzd2FwL3NyYy9mZWF0dXJlcy90cmFuc2FjdGlvbnMvY29tcG9uZW50cy9UcmFuc2FjdGlvbk1vZGFsL1RyYW5zYWN0aW9uTW9kYWwnCmltcG9ydCB7CiAgVHJhbnNhY3Rpb25TY3JlZW4sCiAgdXNlVHJhbnNhY3Rpb25Nb2RhbENvbnRleHQsCn0gdGV4dCB9IGZyb20gJ3VuaXN3YXAvc3JjL2ZlYXR1cmVzL3NlYXJjaC9TZWFyY2hNb2RhbC9hbmFseXRpY3MvU2VhcmNoQ29udGV4dCcKaW1wb3J0IHsgaXNIb3ZlcmFibGUsIGlzV2ViUGxhdGZvcm0gfSBmcm9tICd1dGlsaXRpZXMvc3JjL3BsYXRmb3JtJwppbXBvcnQgeyB1c2VQcmV2aW91cyB9IGZyb20gJ3V0aWxpdGllcy9zcmMvcmVhY3QvaG9va3MnCmltcG9ydCB7IG5vb3AgfSBmcm9tICd1dGlsaXRpZXMvc3JjL3JlYWN0L25vb3AnCmltcG9ydCB7IHVzZUJvb2xlYW5TdGF0ZSB9IGZyb20gJ3V0aWxpdGllcy9zcmMvcmVhY3QvdXNlQm9vbGVhblN0YXRlJwoKY29uc3QgT3B0aW9uSXRlbU1vcmVCdXR0b24gPSBzdHlsZWQoVG91Y2hhYmxlQXJlYSwgewogIGJvcmRlcldpZHRoOiAxLAogIGJvcmRlclJhZGl1czogJyRyb3VuZGVkMTInLAogIGhvdmVyU3R5bGU6IHsKICAgIGJvcmRlckNvbG9yOiAnJHN1cmZhY2UzSG92ZXJlZCcsCiAgfSwKfSkKCmV4cG9ydCBpbnRlcmZhY2UgU2VhcmNoTW9kYWxMaXN0UHJvcHMgewogIHNlY3Rpb25zPzogT25jaGFpbkl0ZW1TZWN0aW9uPFNlYXJjaE1vZGFsT3B0aW9uPltdCiAgcmVmZXRjaD86ICgpID0+IHZvaWQKICBsb2FkaW5nPzogYm9vbGVhbgogIGhhc0Vycm9yPzogYm9vbGVhbgogIGVtcHR5RWxlbWVudD86IEpTWC5FbGVtZW50CiAgZXJyb3JUZXh0Pzogc3RyaW5nCiAgb25TZWxlY3Q/OiAoKSA9PiB2b2lkCiAgc2VhcmNoRmlsdGVyczogU2VhcmNoRmlsdGVyQ29udGV4dAogIHJlbmRlcmVkSW5Nb2RhbDogYm9vbGVhbgogIGNvbnRlbnRDb250YWluZXJTdHlsZT86IENvbnRlbnRTdHlsZQp9CgpleHBvcnQgY29uc3QgU2VhcmNoTW9kYWxMaXN0ID0gbWVtbyhmdW5jdGlvbiBfU2VhcmNoTW9kYWxMaXN0KHsKICBzZWN0aW9ucywKICByZWZldGNoLAogIGxvYWRpbmcsCiAgaGFzRXJyb3IsCiAgZW1wdHlFbGVtZW50LAogIGVycm9yVGV4dCwKICBvblNlbGVjdCwKICBzZWFyY2hGaWx0ZXJzLAogIHJlbmRlcmVkSW5Nb2RhbCwKICBjb250ZW50Q29udGFpbmVyU3R5bGUsCn06IFNlYXJjaE1vZGFsTGlzdFByb3BzKTogSlNYLkVsZW1lbnQgewogIGNvbnN0IHsgbmF2aWdhdGVUb1Rva2VuRGV0YWlscywgbmF2aWdhdGVUb0V4dGVybmFsUHJvZmlsZSwgbmF2aWdhdGVUb05mdENvbGxlY3Rpb24sIG5hdmlnYXRlVG9Qb29sRGV0YWlscyB9ID0KICAgIHVzZVVuaXN3YXBDb250ZXh0KCkKICBjb25zdCB7IHJlZ2lzdGVyU2VhcmNoSXRlbSB9ID0gdXNlQWRkVG9TZWFyY2hIaXN0b3J5KCkKCiAgY29uc3QgeyB2YWx1ZTogaXNDb250ZXh0TWVudU9wZW4sIHNldEZhbHNlOiBjbG9zZUNvbnRleHRNZW51LCB0b2dnbGU6IHRvZ2dsZUNvbnRleHRNZW51IH0gPSB1c2VCb29sZWFuU3RhdGUoZmFsc2UpCgogIGNvbnN0IFtmb2N1c2VkUm93SW5kZXgsIHNldEZvY3VzZWRSb3dJbmRleF0gPSB1c2VTdGF0ZTxudW1iZXIgfCB1bmRlZmluZWQ+KDEpIC8vIHNldCB0byAxc3QgaXRlbSBob3ZlcmVkIG9uIGZpcnN0IG9wZW4KCiAgLy8gdG8gaGFuZGxlIGNsb3NpbmcgdGhlIGxlZnQtY2xpY2sgJy4uLicgY29udGV4dCBtZW51IHdoZW4gdGhlIGZvY3VzZWQgcm93IGNoYW5nZXMKICBjb25zdCBwcmV2aW91c0ZvY3VzZWRSb3dJbmRleCA9IHVzZVByZXZpb3VzKGZvY3VzZWRSb3dJbmRleCkKICB1c2VFZmZlY3QoKCkgPT4gewogICAgaWYgKGlzV2ViUGxhdGZvcm0gJiYgcHJldmlvdXNGb2N1c2VkUm93SW5kZXggIT09IGZvY3VzZWRSb3dJbmRleCkgewogICAgICBjbG9zZUNvbnRleHRNZW51KCkKICAgIH0KICB9LCBbcHJldmlvdXNGb2N1c2VkUm93SW5kZXgsIGZvY3VzZWRSb3dJbmRleCwgY2xvc2VDb250ZXh0TWVudV0pCgogIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBjb25zaXN0ZW50LXJldHVybgogIGNvbnN0IHJlbmRlckl0ZW0gPSAoeyBpdGVtLCBzZWN0aW9uLCByb3dJbmRleCwgaW5kZXggfTogSXRlbVJvd0luZm88U2Vhci91aS9kcm9wZG93bi1tZW51IgppbXBvcnQgeyBGaWVsZCwgRmllbGRHcm91cCwgRmllbGRMYWJlbCB9IGZyb20gIkAvcmVnaXN0cnkvYmFzZXMvcmFkaXgvdWkvZmllbGQiCmltcG9ydCB7IElucHV0IH0gZnJvbSAiQC9yZWdpc3RyeS9iYXNlcy9yYWRpeC91aS9pbnB1dCIKaW1wb3J0IHsKICBTZWxlY3QsCiAgU2VsZWN0Q29udGVudCwKICBTZWxlY3RHcm91cCwKICBTZWxlY3RJdGVtLAogIFNlbGVjdFRyaWdnZXIsCiAgU2VsZWN0VmFsdWUsCn0gZnJvbSAiQC9yZWdpc3RyeS9iYXNlcy9yYWRpeC91aS9zZWxlY3QiCmltcG9ydCB7IFRleHRhcmVhIH0gZnJvbSAiQC9yZWdpc3RyeS9iYXNlcy9yYWRpeC91aS90ZXh0YXJlYSIKaW1wb3J0IHsgSWNvblBsYWNlaG9sZGVyIH0gZnJvbSAiQC9hcHAvKGNyZWF0ZSkvY29tcG9uZW50cy9pY29uLXBsYWNlaG9sZGVyIgoKZXhwb3J0IGZ1bmN0aW9uIENvbXBvbmVudEV4YW1wbGUoKSB7CiAgcmV0dXJuICgKICAgIDxFeGFtcGxlV3JhcHBlcj4KICAgICAgPENhcmRFeGFtcGxlIC8+CiAgICAgIDxGb3JtRXhhbXBsZSAvPgogICAgPC9FeGFtcGxlV3JhcHBlcj4KICApCn0KCmZ1bmN0aW9uIENhcmRFeGFtcGxlKCkgewogIHJldHVybiAoCiAgICA8RXhhbXBsZSB0aXRsZT0iQ2FyZCIgY2xhc3NOYW1lPSJpdGVtcy1jZW50ZXIganVzdGlmeS1jZW50ZXIiPgogICAgICA8Q2FyZCBjbGFzc05hbWU9InJlbGF0aXZlIHctZnVsbCBtYXgtdy1zbSBvdmVyZmxvdy1oaWRkZW4gcHQtMCI+CiAgICAgICAgPGRpdiBjbGFzc05hbWU9ImJnLXByaW1hcnkgYWJzb2x1dGUgaW5zZXQtMCB6LTMwIGFzcGVjdC12aWRlbyBvcGFjaXR5LTUwIG1peC1ibGVuZC1jb2xvciIgLz4KICAgICAgICA8aW1nCiAgICAgICAgICBzcmM9Imh0dHBzOi8vaW1hZ2VzLnVuc3BsYXNoLmNvbS9waG90by0xNjA0MDc2ODUwNzQyLTRjNzIyMWYzMTAxYj9xPTgwJnc9MTg4NyZhdXRvPWZvcm1hdCZmaXQ9Y3JvcCZpeGxpYj1yYi00LjEuMCZpeGlkPU0zd3hNakEzZkRCOE1IeHdhRzkwYnkxd1lXZGxmSHg4ZkdWdWZEQjhmSHg4ZkElM0QlM0QiCiAgICAgICAgICBhbHQ9IlBob3RvIGJ5IG15bWluZCBvbiBVbnNwbGFzaCIKICAgICAgICAgIHRpdGxlPSJQaG90byBieSBteW1pbmQgb24gVW5zcGxhc2giCiAgICAgICAgICBjbGFzc05hbWU9InJlbGF0aXZlIHotMjAgYXNwZWN0LXZpZGVvIHctZnVsbCBvYmplY3QtY292ZXIgYnJpZ2h0bmVzcy02MCBncmF5c2NhbGUiCiAgICAgICAgLz4KICAgICAgICA8Q2FyZEhlYWRlcj4KICAgICAgICAgIDxDYXJkVGl0bGU+T2JzZXJ2YWJpbGl0eSBQbHVzIGlzIHJlcGxhY2luZyBNb25pdG9yaW5nPC9DYXJkVGl0bGU+CiAgICAgICAgICA8Q2FyZERlc2NyaXB0aW9uPgogICAgICAgICAgICBTd2l0Y2ggdG8gdGhlIGltcHJvdmVkIHdheSB0byBleHBsb3JlIHlvdXIgZGF0YSwgd2l0aCBuYXR1cmFsCiAgICAgICAgICAgIGxhbmd1YWdlLiBNb25pdG9yaW5nIHdpbGwgbm8gbG9uZ2VyIGJlIGF2YWlsYWJsZSBvbiB0aGUgUHJvIHBsYW4gaW4KICAgICAgICAgICAgTm92ZW1iZXIsIDIwMjUKICAgICAgICAgIDwvQ2FyZERlc2NyaXB0aW9uPgogICAgICAgIDwvQ2FyZEhlYWRlcj4KICAgICAgICA8Q2FyZEZvb3Rlcj4KICAgICAgICAgIDxBbGVydERpYWxvZz4KICAgICAgICAgICAgPEFsZXJ0RGlhbG9nVHJpZ2dlciBhc0NoaWxkPgogICAgICAgICAgICAgIDxCdXR0b24+CiAgICAgICAgICAgICAgICA8SWNvblBsYWNlaG9sZGVyCiAgICAgICAgICAgICAgICAgIGx1Y2lkZT0iUGx1c0ljb24iCiAgICAgICAgICAgICAgICAgIHRhYmxlcj0iSWNvblBsdXMiCiAgICAgICAgICAgICAgICAgIGh1Z2VpY29ucz0iUGx1c1NpZ25JY29uIgogICAgICAgICAgICAgICAgICBwaG9zcGhvcj0iUGx1c0ljb24iCiAgICAgICAgICAgICAgICAgIHJlbWl4aWNvbj0iUmlBZGRMaW5lIgogICAgICAgICAgICAgICAgICBkYXRhLWljb249ImlubGluZS1vID0gZ2V0Q2hhaW5JbmZvKGNoYWluSWQpLmxvZ28KICBjb25zdCBpbWFnZVNpemUgPSBzaXplIC0gYm9yZGVyV2lkdGggKiAyIC8vIHRoaXMgcHJldmVudHMgdGhlIGJvcmRlciBmcm9tIGN1dHRpbmcgb2ZmIHRoZSBsb2dvCgogIHJldHVybiBsb2dvID8gKAogICAgPEZsZXggdGVzdElEPSJuZXR3b3JrLWxvZ28iIG92ZXJmbG93PSJoaWRkZW4iIHN0eWxlPXtpbWFnZVN0eWxlfSB6SW5kZXg9e3pJbmRleGVzLm1hc2t9PgogICAgICA8TmV0d29ya0ltYWdlIGxvZ289e2xvZ299IGltYWdlU2l6ZT17aW1hZ2VTaXplfSB0cmFuc2l0aW9uPXt0cmFuc2l0aW9ufSAvPgogICAgPC9GbGV4PgogICkgOiBudWxsCn0KCmZ1bmN0aW9uIE5ldHdvcmtJbWFnZSh7CiAgbG9nbywKICBpbWFnZVNpemUsCiAgdHJhbnNpdGlvbiwKfTogewogIGxvZ286IEltYWdlU291cmNlUHJvcFR5cGUKICBpbWFnZVNpemU6IG51bWJlcgogIHRyYW5zaXRpb24/OiBGbGV4UHJvcHNbJ3RyYW5zaXRpb24nXQp9KTogSlNYLkVsZW1lbnQgewogIC8vIEFzIG9mIGlPUyAxOC4zIG5ldHdvcmsgbG9nb3MgYXJlIG5vIGxvbmdlciBkaXNwbGF5aW5nIGJlY2F1c2UgcmVhY3QtbmF0aXZlLXdlYi1saXRlCiAgLy8gYWRkcyB6LWluZGV4OiAtMSB0byB0aGUgaW1hZ2UuIFRoaXMgaXMgYSB3b3JrYXJvdW5kIHRvIGRpc3BsYXkgdGhlIGxvZ29zIG9uIG1vYmlsZSB3ZWIuCiAgcmV0dXJuIGlzTW9iaWxlV2ViICYmIHR5cGVvZiBsb2dvID09PSAnc3RyaW5nJyA/ICgKICAgIDxpbWcgc3JjPXtsb2dvfSBzdHlsZT17eyB3aWR0aDogaW1hZ2VTaXplLCBoZWlnaHQ6IGltYWdlU2l6ZSwgdHJhbnNpdGlvbiB9fSAvPgogICkgOiAoCiAgICA8SW1hZ2UgcmVzaXplTW9kZT0iY29udGFpbiIgc291cmNlPXtsb2dvfSB3aWR0aD17aW1hZ2VTaXplfSBoZWlnaHQ9e2ltYWdlU2l6ZX0gdHJhbnNpdGlvbj17dHJhbnNpdGlvbn0gLz4KICApCn0KCmV4cG9ydCBjb25zdCBOZXR3b3JrTG9nbyA9IFJlYWN0Lm1lbW8oX05ldHdvcmtMb2dvKQppbXBvcnQgeyByZW5kZXIsIHNjcmVlbiwgZmlyZUV2ZW50IH0gZnJvbSAiQHRlc3RpbmctbGlicmFyeS9yZWFjdCI7CmltcG9ydCAqIGFzIFJlYWN0IGZyb20gInJlYWN0IjsKaW1wb3J0IHsgRm9ybVByb3ZpZGVyLCB1c2VGb3JtIH0gZnJvbSAicmVhY3QtaG9vay1mb3JtIjsKaW1wb3J0IHR5cGUgeyBVc2VGb3JtUmV0dXJuIH0gZnJvbSAicmVhY3QtaG9vay1mb3JtIjsKaW1wb3J0IHsgdmkgfSBmcm9tICJ2aXRlc3QiOwoKaW1wb3J0IHsgRm9ybUJ1aWxkZXJGaWVsZCB9IGZyb20gIi4vRm9ybUJ1aWxkZXJGaWVsZCI7Cgp2aS5tb2NrKCJAZm9ybWtpdC9hdXRvLWFuaW1hdGUvcmVhY3QiLCAoKSA9PiAoewogIHVzZUF1dG9BbmltYXRlOiAoKSA9PiBbbnVsbF0sCn0pKTsKCmNvbnN0IHJlbmRlckNvbXBvbmVudCA9ICh7CiAgcHJvcHM6IHByb3BzLAogIGZvcm1EZWZhdWx0VmFsdWVzLAp9OiB7CiAgcHJvcHM6IFBhcmFtZXRlcnM8dHlwZW9mIEZvcm1CdWlsZGVyRmllbGQ+WzBdOwogIC8vIGVzbGludC1kaXNhYmxlLW5leHQtbGluZSBAdHlwZXNjcmlwdC1lc2xpbnQvbm8tZXhwbGljaXQtYW55CiAgZm9ybURlZmF1bHRWYWx1ZXM/OiBhbnk7Cn0pID0+IHsKICAvLyBlc2xpbnQtZGlzYWJsZS1uZXh0LWxpbmUgQHR5cGVzY3JpcHQtZXNsaW50L25vLWV4cGxpY2l0LWFueQogIGxldCBmb3JtTWV0aG9kczogVXNlRm9ybVJldHVybjxhbnk+IHwgdW5kZWZpbmVkOwogIGNvbnN0IFdyYXBwZXIgPSAoeyBjaGlsZHJlbiB9OiB7IGNoaWxkcmVuOiBSZWFjdC5SZWFjdE5vZGUgfSkgPT4gewogICAgY29uc3QgZm9ybSA9IHVzZUZvcm0oewogICAgICBkZWZhdWx0VmFsdWVzOiBmb3JtRGVmYXVsdFZhbHVlcywKICAgIH0pOwogICAgZm9ybU1ldGhvZHMgPSBmb3JtOwogICAgcmV0dXJuIDxGb3JtUHJvdmlkZXIgey4uLmZvcm19PntjaGlsZHJlbn08L0Zvcm1Qcm92aWRlcj47CiAgfTsKICByZW5kdHRvbiB0eXBlPSJidXR0b24iIGNvbG9yPSJtaW5pbWFsIiBvbkNsaWNrPXsoKSA9PiBzZXRJc09wZW4oZmFsc2UpfT4KICAgICAgICAgICAgICAgIHt0KCJjYW5jZWwiKX0KICAgICAgICAgICAgICA8L0J1dHRvbj4KICAgICAgICAgICAgICA8QnV0dG9uIHR5cGU9InN1Ym1pdCI+e3QoInNhdmUiKX08L0J1dHRvbj4KICAgICAgICAgICAgPC9EaWFsb2dGb290ZXI+CiAgICAgICAgICA8L2Rpdj4KICAgICAgICA8L0Zvcm0+CiAgICAgIDwvRGlhbG9nQ29udGVudD4KICAgIDwvRGlhbG9nPgogICk7Cn0KInVzZSBjbGllbnQiCgppbXBvcnQgKiBhcyBSZWFjdCBmcm9tICJyZWFjdCIKaW1wb3J0IHsgTWludXMsIFBsdXMgfSBmcm9tICJsdWNpZGUtcmVhY3QiCmltcG9ydCB7IEJhciwgQmFyQ2hhcnQgfSBmcm9tICJyZWNoYXJ0cyIKCmltcG9ydCB7IEJ1dHRvbiB9IGZyb20gIkAvcmVnaXN0cnkvbmV3LXlvcmsvdWkvYnV0dG9uIgppbXBvcnQgewogIENhcmQsCiAgQ2FyZENvbnRlbnQsCiAgQ2FyZERlc2NyaXB0aW9uLAogIENhcmRGb290ZXIsCiAgQ2FyZEhlYWRlciwKICBDYXJkVGl0bGUsCn0gZnJvbSAiQC9yZWdpc3RyeS9uZXcteW9yay91aS9jYXJkIgppbXBvcnQgeyBDaGFydENvbmZpZywgQ2hhcnRDb250YWluZXIgfSBmcm9tICJAL3JlZ2lzdHJ5L25ldy15b3JrL3VpL2NoYXJ0IgoKY29uc3QgZGF0YSA9IFsKICB7CiAgICBnb2FsOiA0MDAsCiAgfSwKICB7CiAgICBnb2FsOiAzMDAsCiAgfSwKICB7CiAgICBnb2FsOiAyMDAsCiAgfSwKICB7CiAgICBnb2FsOiAzMDAsCiAgfSwKICB7CiAgICBnb2FsOiAyMDAsCiAgfSwKICB7CiAgICBnb2FsOiAyNzgsCiAgfSwKICB7CiAgICBnb2FsOiAxODksCiAgfSwKICB7CiAgICBnb2FsOiAyMzksCiAgfSwKICB7CiAgICBnb2FsOiAzMDAsCiAgfSwKICB7CiAgICBnb2FsOiAyMDAsCiAgfSwKICB7CiAgICBnb2FsOiAyNzgsCiAgfSwKICB7CiAgICBnb2FsOiAxODksCiAgfSwKICB7CiAgICBnb2FsOiAzNDksCiAgfSwKXQoKY29uc3QgY2hhcnRDb25maWcgPSB7CiAgZ29hbDogewogICAgbGFiZWw6ICJHb2FsIiwKICAgIGNvbG9yOiAiaHNsKHZhcigtLXByaW1hcnkpKSIsCiAgfSwKfSBzYXRpc2ZpZXMgQ2hhcnRDb25maWcKCmV4cG9ydCBmdW5jdGlvbiBDYXJkc0FjdGl2aXR5R29hbCgpIHsKICBjb25zdCBbZ29hbCwgc2V0R29hbF0gPSBSZWFjdC51c2VTdGF0ZSgzNTApCgogIGZ1bmN0aW9uIG9uQ2xpY2soYWRqdXN0bWVudDogbnVtYmVyKSB7CiAgICBzZXRHb2FsKE1hdGgubWF4KDIwMCwgTWF0aC5taW4oNDAwLCBnb2FsICsgYWRqdXN0bWVudCkpKQogIH0KCiAgcmV0dXJuICgKICAgIDxDYXJkPgogICAgICA8Q2FyZEhlYWRlciBjbGFzc05hbWU9InBiLTQiPgogICAgICAgIDxDYXJkVGl0bGU+TW92ZSBHb2FsPC9DYXJkVGl0bGU+CiAgICAgICAgPENhcmREZXNjcmlwdGlvbj5TZXQgeW91ciBkYWlseSBhY3Rpdml0eSBnb2FsLjwvQ2FyZERlc2NyaXB0aW9uPgogICAgICA8L0NhcmRIZWFkZXI+CiAgICAgIDxDYXJkQ29udGVudCBjbGFzc05hbWU9InBiLTIiPgogICAgICAgIDxkaXYgY2xhc3NOYW1lPSJmbGV4IGl0ZW1zLWNlbnRlciBqdXN0aWZ5LWNlbnRlciBzcGFjZS14LTIiPgogICAgICAgICAgPEJ1dHRvbgogICAgICAgICAgICB2YXJpYW50PSJvdXRsaW5lIgogICAgICAgICAgICBzaXplPSJpY29uIgogICAgICAgICAgICBjbGFzc05hbWU9ImgtOCB3LTggc2hyaW5rLTAgcm91bmRlZC1mdWxsIgogICAgICAgICAgICBvbkNsaWNrPXsoKSA9PiBvbkNsaWNrKC0xMCl9CiAgICAgICAgICAgIGRpc2FibGVkPXtnb2FsIDw9IDIwMH0KICA=';

let cachedDictionary: Buffer | null = null;

export function getReactDictionary(): Buffer {
  if (!cachedDictionary) {
    cachedDictionary = Buffer.from(DICTIONARY_BASE64, 'base64');
  }
  return cachedDictionary;
}

export const REACT_DICTIONARY_META: DictionaryMeta = {
  name: 'React/Next.js Dictionary',
  version: '2.0.0',
  description: 'Trained ZSTD dictionary optimized for React/Next.js code compression',
  frameworks: ["react","next.js","remix"],
  sizeBytes: 524288,
  patternCount: 0, // Trained dictionary - patterns are internal
  trainedOn: ['sample react files'],
};
